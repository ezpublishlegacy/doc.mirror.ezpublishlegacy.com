Message-ID: <1868479.2890.1485851133760.JavaMail.confluence@ip-10-127-227-164>
Subject: Exported From Confluence
MIME-Version: 1.0
Content-Type: multipart/related; 
	boundary="----=_Part_2889_1297298738.1485851133760"

------=_Part_2889_1297298738.1485851133760
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-Location: file:///C:/exported.html

<html xmlns:o=3D'urn:schemas-microsoft-com:office:office'
      xmlns:w=3D'urn:schemas-microsoft-com:office:word'
      xmlns:v=3D'urn:schemas-microsoft-com:vml'
      xmlns=3D'urn:w3-org-ns:HTML'>
<head>
    <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8=
">
    <title>Upgrading from 5.2 to 5.4</title>
    <!--[if gte mso 9]>
    <xml>
        <o:OfficeDocumentSettings>
            <o:TargetScreenSize>1024x640</o:TargetScreenSize>
            <o:PixelsPerInch>72</o:PixelsPerInch>
            <o:AllowPNG/>
        </o:OfficeDocumentSettings>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
                <!--
        @page Section1 {
            size: 8.5in 11.0in;
            margin: 1.0in;
            mso-header-margin: .5in;
            mso-footer-margin: .5in;
            mso-paper-source: 0;
        }

        td {
            page-break-inside: avoid;
        }

        tr {
            page-break-after: avoid;
        }

        div.Section1 {
            page: Section1;
        }

        /* Confluence print stylesheet. Common to all themes for print medi=
a */
/* Full of !important until we improve batching for print CSS */

@media print {
    #main {
        padding-bottom: 1em !important; /* The default padding of 6em is to=
o much for printouts */
    }

    body {
        font-family: Arial, Helvetica, FreeSans, sans-serif;
        font-size: 10pt;
        line-height: 1.2;
    }

    body, #full-height-container, #main, #page, #content, .has-personal-sid=
ebar #content {
        background: #fff !important;
        color: #000 !important;
        border: 0 !important;
        width: 100% !important;
        height: auto !important;
        min-height: auto !important;
        margin: 0 !important;
        padding: 0 !important;
        display: block !important;
    }

    a, a:link, a:visited, a:focus, a:hover, a:active {
        color: #000;
    }

    #content h1,
    #content h2,
    #content h3,
    #content h4,
    #content h5,
    #content h6 {
        font-family: Arial, Helvetica, FreeSans, sans-serif;
        page-break-after: avoid;
    }

    pre {
        font-family: Monaco, "Courier New", monospace;
    }

    #header,
    .aui-header-inner,
    #navigation,
    #sidebar,
    .sidebar,
    #personal-info-sidebar,
    .ia-fixed-sidebar,
    .page-actions,
    .navmenu,
    .ajs-menu-bar,
    .noprint,
    .inline-control-link,
    .inline-control-link a,
    a.show-labels-editor,
    .global-comment-actions,
    .comment-actions,
    .quick-comment-container,
    #addcomment {
        display: none !important;
    }

    .comment .date::before {
        content: none !important; /* remove middot for print view */
    }

    h1.pagetitle img {
        height: auto;
        width: auto;
    }

    .print-only {
        display: block;
    }

    #footer {
        position: relative !important; /* CONF-17506 Place the footer at en=
d of the content */
        margin: 0;
        padding: 0;
        background: none;
        clear: both;
    }

    #poweredby {
        border-top: none;
        background: none;
    }

    #poweredby li.print-only {
        display: list-item;
        font-style: italic;
    }

    #poweredby li.noprint {
        display: none;
    }

    /* no width controls in print */
    .wiki-content .table-wrap,
    .wiki-content p,
    .panel .codeContent,
    .panel .codeContent pre,
    .image-wrap {
        overflow: visible !important;
    }

    /* TODO - should this work? */
    #children-section,
    #comments-section .comment,
    #comments-section .comment .comment-body,
    #comments-section .comment .comment-content,
    #comments-section .comment p {
        page-break-inside: avoid;
    }

    #page-children a {
        text-decoration: none;
    }

    /**
     hide twixies

     the specificity here is a hack because print styles
     are getting loaded before the base styles. */
    #comments-section.pageSection .section-header,
    #comments-section.pageSection .section-title,
    #children-section.pageSection .section-header,
    #children-section.pageSection .section-title,
    .children-show-hide {
        padding-left: 0;
        margin-left: 0;
    }

    .children-show-hide.icon {
        display: none;
    }

    /* personal sidebar */
    .has-personal-sidebar #content {
        margin-right: 0px;
    }

    .has-personal-sidebar #content .pageSection {
        margin-right: 0px;
    }
}
-->
    </style>
</head>
<body>
    <h1>Upgrading from 5.2 to 5.4</h1>
    <div class=3D"Section1">
        <div class=3D"attribute-heading">
<p><span style=3D"color: rgb(51,51,51);font-size: 14.0px;line-height: 1.428=
5715;"><style type=3D"text/css">/*<![CDATA[*/
div.rbtoc1485851133710 {padding: 0px;}
div.rbtoc1485851133710 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1485851133710 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></span></p>
<div class=3D"toc-macro rbtoc1485851133710">=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Upgradingfrom5.2to5.4-NoteonPaths">Note on Paths</a></li>=
=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Checkforrequirements">Check for requi=
rements</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Upgradesteps">Upgrade steps</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step1:Upgradethelegacydistributionfil=
es">Step 1: Upgrade the legacy distribution files</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step2:upgradecustomlegacyextensions">=
Step 2: upgrade custom legacy extensions</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step3:upgradethedatabase">Step 3: upg=
rade the database</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Updatethedatabase/repositoryconfigura=
tion">Update the database/repository configuration</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-DefineaDoctrineconnection">Define a D=
octrine connection</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Defineoneorseveralrepositories">Defin=
e one or several repositories</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-(Optional)MakeyourSiteAccessconfigpoi=
nttotherightrepository">(Optional) Make your SiteAccess config point to the=
 right repository</a></li>=20
</ul> </li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step4:Apply5.4configurationchanges">S=
tep 4: Apply 5.4 configuration changes</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Upgradingfrom5.2to5.4-YAMLfiles">YAML files</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/config.yml">ezpublis=
h/config/config.yml&nbsp;</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/config_dev.yml">ezpu=
blish/config/config_dev.yml</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/config_prod.yml">ezp=
ublish/config/config_prod.yml</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/routing.yml">ezpubli=
sh/config/routing.yml</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/security.yml">ezpubl=
ish/config/security.yml</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/parameters.yml.dist"=
>ezpublish/config/parameters.yml.dist</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/config/ezpublish*.yml">ezpu=
blish/config/ezpublish*.yml</a></li>=20
</ul> </li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Templates">Templates</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-ezpublish/EzPublishKernel.php">ezpubl=
ish/EzPublishKernel.php</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-composer.json">composer.json</a></li>=
=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Varnish(ifapplicable)">Varnish (if ap=
plicable)</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-UpdatetheDFSclusterconfiguration">Upd=
ate the DFS cluster configuration</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Webserverconfiguration">Web server co=
nfiguration</a></li>=20
</ul> </li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step5:Runcomposerupdate">Step 5: Run =
composer update</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step6:Regeneratetheautoloadarrayforex=
tensions">Step 6: Regenerate the autoload array for extensions</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step7:Linkassets">Step 7: Link assets=
</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step8:Clearthecaches">Step 8: Clear t=
he caches</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-Step9:UpgradeExtensions(sitepackage)"=
>Step 9: Upgrade Extensions (site package)</a></li>=20
<li><a href=3D"#Upgradingfrom5.2to5.4-MinorVersionsUpdateWarning">Minor Ver=
sions Update Warning</a></li>=20
</ul> </li>=20
</ul>=20
</div>
<br>
<p></p>
<p><span style=3D"color: rgb(51,51,51);font-size: 14.0px;line-height: 1.428=
5715;">This section describes how to upgrade your existing eZ Publish 5.2 i=
nstallation to version 5.4. Make sure that you have a working backup of the=
 site before you do the actual upgrade, and make sure that the installation=
 you are performing the upgrade on is offline.</span></p>
</div>
<h2 id=3D"Upgradingfrom5.2to5.4-NoteonPaths">Note on Paths</h2>
<ul>
<li><em>/&lt;ezp5-root&gt;/</em>: The root directory where eZ Publish 5 is =
installed in, examples: "<em>/home/myuser/www</em>/" or "<em>/var/sites/ezp=
ublish/</em>"</li>
<li><em>/&lt;ezp5-root&gt;/ezpublish_legacy/</em>: &nbsp;Root&nbsp;director=
y&nbsp;of&nbsp;"Legacy" (aka "Legacy Stack", refers to the eZ Publish 4.x&n=
bsp;installation&nbsp;which is bundled with eZ Publish 5) normally inside "=
<em>ezpublish_legacy</em>/", example: "<em>/home/myuser/www/ezpublish_legac=
y/</em>"</li>
</ul>
<h2 id=3D"Upgradingfrom5.2to5.4-Checkforrequirements">Check for requirement=
s</h2>
<p>PHP 5.4.4 and higher is needed. Further information regarding system req=
uirements can be found on&nbsp;<a href=3D"https://confluence.ez.no/display/=
EZP/Requirements" class=3D"external-link" rel=3D"nofollow">Requirements Doc=
umentation Page</a>.<a name=3D"eztoc126882_2" rel=3D"nofollow"></a></p>
<h2 id=3D"Upgradingfrom5.2to5.4-Upgradesteps">Upgrade steps<a name=3D"eztoc=
126882_1" rel=3D"nofollow"></a></h2>
<h3 id=3D"Upgradingfrom5.2to5.4-Step1:Upgradethelegacydistributionfiles">St=
ep 1: Upgrade the legacy distribution files</h3>
<p>The easiest way to upgrade the distribution files is to unpack eZ Publis=
h 5.4 to a separate directory and then copy the directories that contain si=
te-specific files from the existing 5.2 installation into "<em>/&lt;ezp5-ro=
ot&gt;/</em>". Make sure you copy the following directories:</p>
<ul>
<li><code>ezpublish_legacy/design/&lt;your designs&gt;</code> (do NOT inclu=
de built-in designs: admin, base, standard or admin2)</li>
<li><code>ezpublish_legacy/var/&lt;your_var_dir&gt;/storage</code></li>
<li><code>ezpublish_legacy/var/storage/packages</code></li>
<li><code>ezpublish_legacy/settings/siteaccess/&lt;your_siteaccesses&gt;</c=
ode></li>
<li><code>ezpublish_legacy/settings/override/*</code></li>
<li><code>ezpublish_legacy/extension/*</code> (not including the built-in /=
 standalone ones: ezflow, ezjscore, ezoe, ezodf, ezie, ezmultiupload, ezmbp=
aex, ez_network, ezprestapiprovider, ezscriptmonitor, ezsi, ezfind)</li>
<li>src/</li>
<li><code><span>ezpublish_legacy/</span>config.php</code> &amp; <code><span=
>ezpublish_legacy/</span>config.cluster.php</code>, if applicable</li>
<li><code>ezpublish/config/*</code></li>
</ul>
<p><em><strong>NB:</strong>&nbsp;Since writable directories and files have =
been replaced / copied, their permissions might have changed. You may have =
to reconfigure webserver user permissions on specific folders as explained =
in the file&nbsp;<a href=3D"https://confluence.ez.no/pages/viewpage.action?=
pageId=3D7438581#InstallingeZPublishonaLinux%2FUNIXbasedsystem-Settingupfol=
derpermission" class=3D"external-link" rel=3D"nofollow">permissions chapter=
 of the installation process</a>.</em></p>
<h3 id=3D"Upgradingfrom5.2to5.4-Step2:upgradecustomlegacyextensions">Step 2=
: upgrade custom legacy extensions</h3>
<p>If you are using custom extensions, the sub-directories inside the "exte=
nsion" directory will also have to be copied from the existing 5.2 installa=
tion into "<em>/&lt;ezp5-root&gt;/ezpublish_legacy/extension/</em>". Howeve=
r, make sure that you do not overwrite any extensions that are included in =
eZ Publish&nbsp;distribution, which currently are (<em><strong>Note:</stron=
g>&nbsp;In eZ Publish Platform 5.4, extensions have version number 5.3 with=
 exception of ezdemo, ezoe, ezformtoken, ezjscore and ezfind</em>):</p>
<p>Note that upgrading the distribution files will overwrite the autoload a=
rrays for extensions. You will need to re-generate the autoload arrays for =
active extensions later.</p>
<p><em><strong>Important:&nbsp;</strong>If you plan to upgrade your eZ Webs=
ite Interface, eZ Flow or eZ Demo site package as well, then&nbsp;additiona=
l&nbsp;extensions will be updated and the step for&nbsp;re-generate the aut=
oload arrays can be skipped until that is done (links to documentation for =
upgrading these site packages can be found in the last step of this page).<=
/em><a name=3D"eztoc126882_4" rel=3D"nofollow"></a></p>
<h3 id=3D"Upgradingfrom5.2to5.4-Step3:upgradethedatabase">Step 3: upgrade t=
he database</h3>
<div class=3D"confluence-information-macro confluence-information-macro-inf=
ormation">
<span class=3D"aui-icon aui-icon-small aui-iconfont-info confluence-informa=
tion-macro-icon"></span>
<div class=3D"confluence-information-macro-body">
<p><span>This step assumes use of the built in database drivers, mysql (inc=
l mariadb) and PostgreSQL, for other databases supported via extension plea=
se use scripts and documentation provided by extension.</span></p>
</div>
</div>
<p>Import to your database the changes provided in</p>
<pre class=3D"wordwrap"><span class=3D"line">/&lt;ezp5-root&gt;/ezpublish_l=
egacy/update/database/&lt;mysql|postgresql&gt;/5.3/dbupdate-5.2.0-to-5.3.0.=
sql<br></span><span style=3D"font-family: Arial , sans-serif;font-size: 14.=
0px;line-height: 1.4285715;">and<br></span>/&lt;ezp5-root&gt;/ezpublish_leg=
acy/update/database/&lt;mysql|postgresql&gt;/5.4/dbupdate-5.3.0-to-5.4.0.sq=
l</pre>
<p><span>If the installation is using the DFS cluster, import the cluster d=
atabase changes provided in</span><br><code>/&lt;ezp5-root&gt;/ezpublish_le=
gacy/update/database/mysql/5.4/dbupdate-cluster-5.3.0-to-5.4.0.sql</code></=
p>
<h4 id=3D"Upgradingfrom5.2to5.4-Updatethedatabase/repositoryconfiguration">=
Update the database/repository configuration</h4>
<p><code>ezpublish.system.&lt;siteAccessName&gt;.database</code> has been r=
emoved for defining database settings. You now need to:</p>
<ul>
<li><h4 id=3D"Upgradingfrom5.2to5.4-DefineaDoctrineconnection">Define a Doc=
trine connection</h4>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>MySQL settings : ezpublish.yml or config.yml</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: bash; gutter: false; theme: Eclipse" style=3D"font-siz=
e:12px;">doctrine:
    dbal:
        connections:
            my_connection:
                driver:   pdo_mysql
                host:     localhost
                port:     3306
                dbname:   my_database
                user:     my_user
                password: my_password
                charset:  UTF8</pre>=20
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">=20
<div class=3D"codeHeader panelHeader pdl hide-border-bottom" style=3D"borde=
r-bottom-width: 1px;">=20
<b class=3D" code-title">PostGreSQL : ezpublish.yml or config.yml </b>=20
<span class=3D"collapse-source expand-control"><span class=3D"expand-contro=
l-icon icon">&nbsp;</span><span class=3D"expand-control-text">Expand source=
</span></span>=20
</div>=20
<div class=3D"codeContent panelContent pdl hide-toolbar">=20
<pre class=3D"brush: bash; gutter: false; theme: Eclipse; collapse: true" s=
tyle=3D"font-size:12px;">doctrine:
    dbal:
        connections:
            my_connection:
                driver:   pdo_pgsql
                host:     localhost
                port:     5432
                dbname:   my_database
                user:     my_user
                password: my_password
                charset:  UTF8</pre>=20
</div>=20
</div>
<div class=3D"confluence-information-macro confluence-information-macro-inf=
ormation">
<p class=3D"title">Pro Tip</p>
<span class=3D"aui-icon aui-icon-small aui-iconfont-info confluence-informa=
tion-macro-icon"></span>
<div class=3D"confluence-information-macro-body">
Set your base DB params in your=20
<code>parameters.yml</code>/
<code>parameters.yml.dist</code> and refer them here.
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>parameters.yml</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">parameters:
   database_driver: pdo_mysql
   database_host: localhost
   database_port: 3306
   database_name: ezdemo
   database_user: my_user
   database_password: my_password
   database_charset: UTF8</pre>=20
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>ezpublish.yml / config.yml</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">doctrine:
    dbal:
        connections:
            my_connection:
                driver:   %database_driver%
                host:     %database_host%
                port:     %database_port%
                dbname:   %database_name%
                user:     %database_user%
                password: %database_password%
                charset:  %database_charset%</pre>=20
</div>
</div></li>
<li><h4 id=3D"Upgradingfrom5.2to5.4-Defineoneorseveralrepositories">Define =
one or several repositories</h4>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>ezpublish.yml</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">ezpublish:
    repositories:
        main: { engine: legacy, connection: my_connection }</pre>=20
</div>
</div></li>
<li><h4 id=3D"Upgradingfrom5.2to5.4-(Optional)MakeyourSiteAccessconfigpoint=
totherightrepository">(Optional) Make your SiteAccess config point to the r=
ight repository</h4>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">=20
<div class=3D"codeHeader panelHeader pdl hide-border-bottom" style=3D"borde=
r-bottom-width: 1px;">=20
<b class=3D" code-title">ezpublish.yml</b>=20
<span class=3D"collapse-source expand-control"><span class=3D"expand-contro=
l-icon icon">&nbsp;</span><span class=3D"expand-control-text">Expand source=
</span></span>=20
</div>=20
<div class=3D"codeContent panelContent pdl hide-toolbar">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse; collapse: true" st=
yle=3D"font-size:12px;">ezpublish:
    system:
        my_siteaccess_group:
            repository: main</pre>=20
</div>=20
</div><p>&nbsp;</p>
<div class=3D"highlight highlight-yaml">
<p>&nbsp;</p>
<div class=3D"confluence-information-macro confluence-information-macro-inf=
ormation">
<p class=3D"title">Remove the old connection information</p>
<span class=3D"aui-icon aui-icon-small aui-iconfont-info confluence-informa=
tion-macro-icon"></span>
<div class=3D"confluence-information-macro-body">
<p>Note : to benefit from the new configuration, don't forget to remove the=
 old configuration</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Old database access to remove</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">ezpublish:
    system:
        my_siteaccess_group:
            database:
                type: mysql
                user: my_user
                password: my_password
                server: localhost
                database_name: ezdemo
</pre>=20
</div>
</div>
</div>
</div>
</div></li>
</ul>
<h3 id=3D"Upgradingfrom5.2to5.4-Step4:Apply5.4configurationchanges">Step 4:=
 Apply 5.4 configuration changes</h3>
<h4 id=3D"Upgradingfrom5.2to5.4-YAMLfiles">YAML files</h4>
<p>Since default configuration files have been overwritten during step one,=
 the few additions to those files that were made in 5.2 need to be applied =
manually to the configuration files.<br>All of those changes are&nbsp;<stro=
ng>additions</strong>, none of them replaces what you already have.</p>
<p>For most of them, at least one, if not all hierarchy elements (monolog, =
handler, framework, router...) will already be there. All you have to do is=
 <strong>add the missing bits in the existing configuration block</strong>s=
.</p>
<p>In&nbsp;<strong style=3D"font-family: Arial , sans-serif;font-size: 14.0=
px;line-height: 1.4285715;">ezpublish/config/config.yml</strong>, you need =
to add a few default values for the framework</p>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/config.yml">ezpublish/conf=
ig/config.yml<span style=3D"color: rgb(51,51,51);">&nbsp;</span></h5>
<p><em>trusted_hosts</em>&nbsp;has been changed and&nbsp;<em>session.handle=
r_id</em>&nbsp;is added to the&nbsp;<em>framework</em>&nbsp;block making Sy=
mfony pick what has been configured in PHP instead.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">framework:
    trusted_hosts:   ~

    session:
        handler_id:  ~</pre>=20
</div>
</div>
<p>Additionally configuration for&nbsp;<em>swift_mailer</em>&nbsp;has been =
added:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">swiftmailer:
    transport: "%mailer_transport%"
    host:      "%mailer_host%"
    username:  "%mailer_user%"
    password:  "%mailer_password%"
    spool:     { type: memory }</pre>=20
</div>
</div>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/config_dev.yml">ezpublish/=
config/config_dev.yml</h5>
<p>In framework, set&nbsp;<em>router.strict_requirements</em>&nbsp;to true.=
</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">framework:
    router:
        resource: "%kernel.root_dir%/config/routing_dev.yml"
        strict_requirements: true</pre>=20
</div>
</div>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/config_prod.yml">ezpublish=
/config/config_prod.yml</h5>
<p>Remove&nbsp;<em>framework.router.strict_requirements</em>.</p>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/routing.yml">ezpublish/con=
fig/routing.yml</h5>
<p>Add <strong>new login routes,&nbsp;</strong><code>_ezpublishRestOptionsR=
outer</code>&nbsp;route loader, and <span>and <code>_liip_imagine</code></s=
pan>:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">_ezpublishRestOptionsRoutes:
    resource: "@EzPublishRestBundle/Resources/config/routing.yml"
    prefix: %ezpublish_rest.path_prefix%
    type: rest_options
_liip_imagine:
    resource: "@LiipImagineBundle/Resources/config/routing.xml"
login:
    path:   /login
    defaults:  { _controller: ezpublish.security.controller:loginAction }
login_check:
    path:   /login_check
logout:
    path:   /logout</pre>=20
</div>
</div>
<h5 class=3D"wordwrap" id=3D"Upgradingfrom5.2to5.4-ezpublish/config/securit=
y.yml"><span style=3D"font-family: Arial , sans-serif;font-size: 14.0px;lin=
e-height: 1.4285715;">ezpublish/config/security.yml</span></h5>
<p class=3D"wordwrap"><span style=3D"font-family: Arial , sans-serif;font-s=
ize: 14.0px;line-height: 1.4285715;">Under <code>ezpublish_front</code> fir=
ewall, update to fit the following (<strong>be sure to remove <code>ezpubli=
sh: true</code></strong>):</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">security:
    firewalls:
        ezpublish_front:
            pattern: ^/
            anonymous: ~
            form_login:
                require_previous_session: false
            logout: ~</pre>=20
</div>
</div>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/parameters.yml.dist">ezpub=
lish/config/parameters.yml.dist</h5>
<p class=3D"wordwrap"><span>If you have added anything to&nbsp;<code>parame=
ters.yml</code>, we suggest that you add your custom settings to&nbsp;<code=
>parameters.yml.dist</code>, so that the composer post-update script handle=
s those, and generates their values correctly.</span></p>
<p><em>ezpublish_legacy.default.view_default_layout</em>&nbsp;can be remove=
d from this file, and the following added:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">parameters:
    mailer_transport:  smtp
    mailer_host:       127.0.0.1
    mailer_user:       ~
    mailer_password:   ~</pre>=20
</div>
</div>
<p class=3D"wordwrap">composer will ask for your own values when you run&nb=
sp;<em>composer update</em>.</p>
<h5 id=3D"Upgradingfrom5.2to5.4-ezpublish/config/ezpublish*.yml">ezpublish/=
config/ezpublish*.yml</h5>
<p>In all ezpublish.yml files (prod, dev, etc), replace the "<strong>handle=
rs</strong>" key in&nbsp;<em>stash.caches.*</em>&nbsp;with "<strong>drivers=
</strong>".</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">stash:
     caches:
         default:
            drivers:</pre>=20
</div>
</div>
<p><code>ezpublish.system.&lt;siteAccessName&gt;.session_name</code>&nbsp;h=
as been deprecated for defining session name. You now need to use&nbsp;<cod=
e>ezpublish.system.&lt;siteAccessName&gt;.session.name</code>.</p>
<p><em>Before</em>:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">ezpublish:
    system:
        my_siteaccess:
            session_name: SomeSessionName</pre>=20
</div>
</div>
<p><em>After</em>:<span style=3D"color: rgb(0,98,147);">&nbsp;</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">ezpublish:
    system:
        my_siteaccess:
            session:
                name: SomeSessionName</pre>=20
</div>
</div>
<h4 class=3D"wordwrap" id=3D"Upgradingfrom5.2to5.4-Templates"><span style=
=3D"font-family: Arial , sans-serif;font-size: 14.0px;line-height: 1.428571=
5;">Templates</span></h4>
<p class=3D"wordwrap"><span style=3D"font-family: Arial , sans-serif;font-s=
ize: 14.0px;line-height: 1.4285715;">In your templates, change your links p=
ointing to <code>/user/login</code> and <code>/user/logout</code> to approp=
riate <code>login&nbsp;</code>/ <code>login_check&nbsp;</code>/ <code>logou=
t</code> routes:</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Before</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: xml; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">&lt;a href=3D"{{ path( 'ez_legacy', {'module_uri': '/user/login'} )=
 }}"&gt;Login&lt;/a&gt;
&lt;form action=3D"{{ path( 'ez_legacy', {'module_uri': '/user/login'} ) }}=
" method=3D"post"&gt;
&lt;a href=3D"{{ path( 'ez_legacy', {'module_uri': '/user/logout'} ) }}"&gt=
;Logout&lt;/a&gt;</pre>=20
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>After</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: xml; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">&lt;a href=3D"{{ path( 'login' ) }}"&gt;Login&lt;/a&gt;
&lt;form action=3D"{{ path( 'login_check' ) }}" method=3D"post"&gt;
&lt;a href=3D"{{ path( 'logout' ) }}"&gt;Logout&lt;/a&gt;</pre>=20
</div>
</div>
<p class=3D"wordwrap"><span style=3D"font-family: Arial , sans-serif;font-s=
ize: 14.0px;line-height: 1.4285715;"><br></span></p>
<h4 id=3D"Upgradingfrom5.2to5.4-ezpublish/EzPublishKernel.php">ezpublish/Ez=
PublishKernel.php</h4>
<p>It is not possible to just copy your old <code>EzPublishKernel.php</code=
> file over from the previous installation, since quite a few changes were =
made to this file in this release. We suggest that you simply reflect in th=
e new kernel file any changes you made in the previous version.</p>
<h4 id=3D"Upgradingfrom5.2to5.4-composer.json">composer.json</h4>
<p>If you had modified <code>composer.json</code> to add your own requireme=
nts, you must re-apply those changes to the new version.</p>
<h4 id=3D"Upgradingfrom5.2to5.4-Varnish(ifapplicable)">Varnish (if applicab=
le)</h4>
<p><span>The recommended varnish (3 and 4) VCL configuration can now be fou=
nd in the&nbsp;</span><code>doc/varnish</code><span>&nbsp;folder. See also =
the&nbsp;</span><a href=3D"/display/EZP/Using+Varnish">Using Varnish</a><sp=
an>&nbsp;page.</span></p>
<p>Anonymous state of a user is not checked through presence of <code>is_lo=
gged_in</code> cookie any more. Therefore, when using Varnish, you must cha=
nge the following in your VCL file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Before</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;"># ez_user_hash sub-routine
if (req.http.Cookie !~ "is_logged_in=3D" ) {
    # User don't have "is_logged_in" cookie =3D&gt; Set a hardcoded anonymo=
us hash
    set req.http.X-User-Hash =3D "38015b703d82206ebc01d17a39c727e5";
}</pre>=20
</div>
</div>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>After</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;"># ez_user_hash sub-routine
if (req.http.Cookie !~ "eZSESSID" ) {
    # User don't have session cookie =3D&gt; Set a hardcoded anonymous hash
    set req.http.X-User-Hash =3D "38015b703d82206ebc01d17a39c727e5";
}</pre>=20
</div>
</div>
<h4 id=3D"Upgradingfrom5.2to5.4-UpdatetheDFSclusterconfiguration">Update th=
e DFS cluster configuration</h4>
<p>If your legacy installation uses DFS clustering, you need to&nbsp;<a hre=
f=3D"/display/EZP/Upgrading+DFS+cluster+to+5.4">create the new stack config=
uration for it</a>.</p>
<h4 id=3D"Upgradingfrom5.2to5.4-Webserverconfiguration">Web server configur=
ation</h4>
<p>The officially recommended virtual configuration is now shipped in the&n=
bsp;<code>doc</code>&nbsp;folder, for both apache2 (<code>doc/apache2</code=
>) and nginx (<code>doc/nginx</code>).&nbsp;Both are built to be easy to un=
derstand and use, but aren't meant as drop-in replacements for your existin=
g configuration.</p>
<p>One notable change is that&nbsp;<code>SetEnvIf</code>&nbsp;is now used t=
o dynamically change rewrite rules depending on the Symfony environment. It=
 is currently used for the assetic production rewrite rules.</p>
<p>Read more on the&nbsp;<a href=3D"/display/EZP/Web+servers">Web servers</=
a>&nbsp;page.</p>
<h3 id=3D"Upgradingfrom5.2to5.4-Step5:Runcomposerupdate">Step 5: Run compos=
er update</h3>
<p>Run&nbsp;<code>composer update --no-dev --prefer-dist</code>&nbsp;to get=
 the latest eZ Publish dependencies.</p>
<p>At the end of the process, you will be asked for values for the paramete=
rs previously added to&nbsp;<code>parameters.yml.dist</code>.</p>
<h3 id=3D"Upgradingfrom5.2to5.4-Step6:Regeneratetheautoloadarrayforextensio=
ns">Step 6: Regenerate the autoload array for extensions</h3>
<p>To regenerate the autoload array, execute the following script from the =
root of your eZ Publish Legacy directory:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">cd ezpublish_legacy
php bin/php/ezpgenerateautoloads.php --extension</pre>=20
</div>
</div>
<h3 id=3D"Upgradingfrom5.2to5.4-Step7:Linkassets">Step 7: Link assets</h3>
<p>Assets from the various bundles need to be made available for the webser=
ver through the web/ document root.</p>
<p>The following commands will first symlink eZ Publish 5 assets in "Bundle=
s" and the second will symlink assets (design files like images, scripts an=
d css, and files in var folder) &nbsp;from eZ Publish Legacy:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"brush: php; gutter: false; theme: Eclipse" style=3D"font-size=
:12px;">php ezpublish/console assets:install --symlink
php ezpublish/console ezpublish:legacy:assets_install --symlink
php ezpublish/console assetic:dump --env=3Dprod</pre>=20
</div>
</div>
<h3 id=3D"Upgradingfrom5.2to5.4-Step8:Clearthecaches">Step 8: Clear the cac=
hes</h3>
<p>Whenever an eZ Publish solution is upgraded, all caches must be cleared =
in a proper way. This should be done from within a system shell:<br>Navigat=
e into the new eZ Publish directory.Run the script using the following shel=
l command:cd /&lt;ezp5-root&gt;/ezpublish_legacy/php bin/php/ezcache.php --=
clear-all --purgePurging ensures that the caches are physically removed. Wh=
en the "--purge" parameter is not specified, the caches will be expired but=
 not removed.<br>Note: Sometimes the script is unable to clear all cache fi=
les because of restrictive file/directory permission settings. Make sure th=
at all cache files have been cleared by inspecting the contents of the vari=
ous cache sub-directories within the "var" directory (typically the "var/ca=
che/" and "var/&lt;name_of_siteaccess&gt;/cache/" directories). If there ar=
e any cache files left, you need to remove them manually.</p>
<h3 id=3D"Upgradingfrom5.2to5.4-Step9:UpgradeExtensions(sitepackage)">Step =
9: Upgrade Extensions (site package)</h3>
<p>Next, depending on if you originally installed eZ Flow, eZ Webin or eZ D=
emo site, follow the steps mentioned in the&nbsp;<a href=3D"https://doc.ez.=
no/doc_hidden/Extensions/eZ-Publish-extensions/Website-Interface/Website-in=
terface-5.3-upgrade" rel=3D"nofollow">eZ Webin</a>,&nbsp;<a href=3D"https:/=
/doc.ez.no/doc_hidden/Extensions/eZ-Publish-extensions/eZ-Flow/Upgrading-eZ=
-Flow/eZ-Flow-5.3-upgrade" rel=3D"nofollow">eZ Flow</a>&nbsp;or&nbsp;<a hre=
f=3D"https://doc.ez.no/doc_hidden/Extensions/eZ-Publish-extensions/eZ-Demo/=
eZ-Demo-5.3-upgrade" rel=3D"nofollow">eZ Demo</a>&nbsp;upgrade documentatio=
n.</p>
<h3 id=3D"Upgradingfrom5.2to5.4-MinorVersionsUpdateWarning">Minor Versions =
Update Warning</h3>
<p>Please have in mind that, after the upgrade to a major version of eZ Pub=
lish, you will need to perform regular updates with composer.</p>
<p>Before any minor update with composer, please execute all require steps =
described in the <span class=3D"confluence-link"><a href=3D"/display/EZP/5.=
4.x+Update+Instructions">5.4.x Update Instructions</a></span>.</p>
    </div>
</body>
</html>
------=_Part_2889_1297298738.1485851133760--
