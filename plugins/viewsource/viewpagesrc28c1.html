                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125271 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:47:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage28c1.html?pageId=12125271" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/colors556c.css?spaceKey=EZP51" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/custom556c.css?spaceKey=EZP51" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>This example demonstrates how to set up a virtual host on the Apache web server for an eZ Publish installation located in &quot;<code>/var/www/example</code>&quot;. Let's say that we want to access eZ Publish by using the following URLs:</p><ul><li><div><span class="nolink">http://www.example.com</span> (actual website for public access)</div></li><li><div><span class="nolink">http://admin.example.com</span> (administration interface for the webmaster)</div></li></ul><p>In order to achieve this, we need to set up both eZ Publish and the web server so that they respond correctly to the different requests.</p><p><a name="eztoc131612_1" /></p><h2>eZ Publish configuration: siteaccess settings</h2><p>eZ Publish needs to be configured to use the host access method. This can be done from within the web based setup wizard or by manually editing the global override for the site.ini configuration file: &quot;<code>&lt;eZ Publish root&gt;/ezpublish_legacy/settings/override/site.ini.append.php</code>&quot;. A typical legacy configuration would look something like this:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>...
[SiteAccessSettings]
AvailableSiteAccessList[]
AvailableSiteAccessList[]=example
AvailableSiteAccessList[]=example_admin
MatchOrder=host
 
HostMatchMapItems[]=www.example.com;example
HostMatchMapItems[]=admin.example.com;example_admin
...</pre></td></tr></table><p>This configuration tells eZ Publish that it should use the &quot;<code>example</code>&quot; siteaccess if a request starts with &quot;<code>www.example.com</code>&quot; and &quot;<code>example_admin</code>&quot; if the request starts with &quot;<code>admin.example.com</code>&quot;. For more information about site management in eZ Publish, please refer to the &quot;<a href="../../eZ-Publish/Technical-manual/5.x/Concepts-and-basics/Configuration/Site-management.html">Site management</a>&quot; part of the &quot;Concepts and basics&quot; chapter.</p><p><a name="eztoc131612_2" /></p><table class="wysiwyg-macro" data-macro-name="info" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The legacy configuration above will only work if the same is also configured in Symfony, by adding our <a href="https://confluence.ez.no/display/EZP51/Siteaccess+Matching#SiteaccessMatching-Configuration">available siteaccesses</a> and <a href="https://confluence.ez.no/display/EZP51/Siteaccess+Matching#SiteaccessMatching-Compoundsiteaccessmatcher">mapping our hosts</a> to the desired siteaccess in <strong>ezpublish/config/ezpublish.yml</strong>. This approach is recommended!</p></td></tr></table><p> </p><p>A Symfony based eZ Publish 5 configuration would look something like this:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    siteaccess:
        default_siteaccess: ezdemo_site
        list:
            - ezdemo_site
            - eng
            - fre
            - fr_eng
            - ezdemo_site_admin
        groups:
            ezdemo_site_group:
                - ezdemo_site
                - eng
                - fre
                - fr_eng
                - ezdemo_site_admin
        match:
            Map\URI:
                ezdemo_site: ezdemo_site
                fre: fre
                ezdemo_site_admin: ezdemo_site_admin
            # The following mimics host_uri for 2 different configuration.
            Compound\LogicalAnd:
                -
                    # Nested matchers, with their configuration.
                    # No need to precise their matching values (true will suffice).
                    matchers:
                        Map\URI:
                            the_front: true
                        Map\Host:
                            ezpublish.dev: true
                    # The siteaccess to match in the end
                    match: ezdemo_site 
                -
                    matchers:
                        Map\URI:
                            the_admin: true
                        Map\Host:
                            ezpublish.dev: true
                    match: ezdemo_site_admin
            # Matching hosts as host: siteaccess
            Map\Host:
                ezpublish.dev: ezdemo_site
                admin.ezpublish.dev: ezdemo_site_admin</pre></td></tr></table><p> </p><h2>Apache configuration: virtual host settings</h2><p>Assuming that...</p><ul><li><div>eZ Publish is located in &quot;<code>/var/www/example</code>&quot;</div></li><li><div>the server's IP address is <code>128.39.140.28</code></div></li><li><div>we wish to access eZ Publish using &quot;<code>www.example.com</code>&quot; and &quot;<code>admin.example.com</code>&quot;</div></li></ul><p>...the following virtual host configuration needs to be added at the end of &quot;<code>http.conf</code>&quot;:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>NameVirtualHost 128.39.140.28
 
&lt;VirtualHost 128.39.140.28>
    &lt;Directory /var/www/example/web>
        Options FollowSymLinks
        AllowOverride None
    &lt;/Directory>
 
    &lt;IfModule mod_php5.c>
        php_admin_flag safe_mode Off
        php_admin_value register_globals    0
        php_value magic_quotes_gpc  0
        php_value magic_quotes_runtime  0
        php_value allow_call_time_pass_reference 0
    &lt;/IfModule>
 
    DirectoryIndex index.php
 
    &lt;IfModule mod_rewrite.c>
        RewriteEngine On
 
        # CVE-2012-6432
        RewriteRule ^/_internal - [R=403,L]
 
        # Uncomment in FastCGI mode, to get basic auth working.
        #RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        # v1 rest API is on Legacy
        RewriteRule ^/api/[^/]+/v1/ /index_rest.php [L]
 
        # If using cluster, uncomment the following two lines:
        #RewriteRule ^/var/([^/]+/)?storage/images(-versioned)?/.* /index_cluster.php [L]
        #RewriteRule ^/var/([^/]+/)?cache/(texttoimage|public)/.* /index_cluster.php [L]
 
        RewriteRule ^/var/([^/]+/)?storage/images(-versioned)?/.* - [L]
        RewriteRule ^/var/([^/]+/)?cache/(texttoimage|public)/.* - [L]
        RewriteRule ^/design/[^/]+/(stylesheets|images|javascript|fonts)/.* - [L]
        RewriteRule ^/share/icons/.* - [L]
        RewriteRule ^/extension/[^/]+/design/[^/]+/(stylesheets|flash|images|lib|javascripts?)/.* - [L]
        RewriteRule ^/packages/styles/.+/(stylesheets|images|javascript)/[^/]+/.* - [L]
        RewriteRule ^/packages/styles/.+/thumbnail/.* - [L]
        RewriteRule ^/var/storage/packages/.* - [L]
 
        # Makes it possible to place your favicon at the root of your
        # eZ Publish instance. It will then be served directly.
        RewriteRule ^/favicon\.ico - [L]
        # Uncomment the line below if you want you favicon be served
        # from the standard design. You can customize the path to
        # favicon.ico by changing /design/standard/images/favicon\.ico
        #RewriteRule ^/favicon\.ico /design/standard/images/favicon.ico [L]
        RewriteRule ^/design/standard/images/favicon\.ico - [L]
 
        # Give direct access to robots.txt for use by crawlers (Google,
        # Bing, Spammers..)
        RewriteRule ^/robots\.txt - [L]
 
        # Platform for Privacy Preferences Project ( P3P ) related files
        # for Internet Explorer
        # More info here : http://en.wikipedia.org/wiki/P3p
        RewriteRule ^/w3c/p3p\.xml - [L]
 
        # Uncomment the following lines when using popup style debug in legacy
        #RewriteRule ^/var/([^/]+/)?cache/debug\.html.* - [L]
 
        # Following rule is needed to correctly display assets from eZ Publish5 / Symfony bundles
        RewriteRule ^/bundles/ - [L]
        # Additional Assetic rules for eZ Publish 5.1 / 2013.4 and higher:
        RewriteRule ^/css/.*\.css - [L]
        RewriteRule ^/js/.*\.js - [L]
 
        # For dev/debug environment, you might want to use the 'development' front controller.
        # Uncomment the 'RewriteRule' line below to use it.
        # The following example 'RewriteCond' lines can be used in combination to conditionally use it.
        #RewriteCond %{HTTP_HOST} = dev.example.com [OR]
        #RewriteCond %{HTTP_HOST} = dev.admin.example.com
        #RewriteRule .* /index_dev.php [L]

        # Redirect all requests to the 'production' front controller
        RewriteRule .* /index.php
    &lt;/IfModule>
 
    DocumentRoot /var/www/example/web
    ServerName www.example.com
    ServerAlias admin.example.com
&lt;/VirtualHost></pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Note that it isn't necessary to create a separate virtual host block for &quot;<code>admin.example.com</code>&quot;, it can be added to the existing block using the &quot;<code>ServerAlias</code>&quot; directive which can take several values separated by a space.</p></td></tr></table>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125271 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:47:02 GMT -->
</html>
