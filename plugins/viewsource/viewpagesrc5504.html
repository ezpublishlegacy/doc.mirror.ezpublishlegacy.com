                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125325 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 13:28:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage5504.html?pageId=12125325" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/colors556c.css?spaceKey=EZP51" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/custom556c.css?spaceKey=EZP51" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>eZ Publish 5 has a strong focus on backwards compatibility and thus lets you reuse code you might have written for 4.x, including templates and modules.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Hint" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb960.png?definition=e2luZm86dGl0bGU9SGludH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Read <a class="confluence-link" href="../../pages/viewpagea7a7.html?pageId=12125336" data-linked-resource-id="12125336" data-linked-resource-version="6" data-linked-resource-type="page" data-linked-resource-default-alias="Intro for eZ Publish 4.x/3.x developers" data-base-url="../../index.html">Intro for eZ Publish 4.x/3.x developers</a> to have an overview of common concepts and terminology changes.</p></td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-schema-version="1"></p><h2>Legacy Mode</h2><p>Legacy mode is a specific configuration mode where eZ Publish's behavior is the closest to v4.x. It might be used in some very specific use cases, such as <strong>running the admin interface</strong>.</p><h3>What it does</h3><ul><li><strong>Still runs through the whole Symfony kernel</strong>. As such, Symfony services can still be accessed from legacy stack.</li><li><strong>Disables the UrlAliasRouter</strong>. As such, the <strong>ViewController will be bypassed</strong>.</li></ul><h3>What it doesn't do</h3><ul><li><strong>Increase performance</strong>. Legacy mode is actually <strong>painful for performances</strong> since it won't use the HttpCache mechanism.</li></ul><table class="wysiwyg-macro" data-macro-name="tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading7f8c.png?definition=e3RpcH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>In a migration context, <strong>using Legacy Mode is never a good option</strong> as it prevents all the performance goodness (e.g. Http Cache) to work.<br />Always keep in mind that, <strong>not running in legacy mode, if a content still doesn't have a corresponding Twig template/controller, <a class="confluence-link" href="../../display/EZP51/Legacy%2btemplate%2bfallback.html" data-linked-resource-id="12125307" data-linked-resource-version="5" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy template fallback" data-base-url="../../index.html">eZ Publish will always fallback to the legacy kernel, looking for a legacy template</a></strong>.</p></td></tr></table><h2>Legacy Template inclusion</h2><p>It is possible to include old templates (<strong>.tpl</strong>) into new ones.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=Include a legacy template using the old template override mechanism" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb6a0.png?definition=e2NvZGU6dGl0bGU9SW5jbHVkZSBhIGxlZ2FjeSB0ZW1wbGF0ZSB1c2luZyB0aGUgb2xkIHRlbXBsYXRlIG92ZXJyaWRlIG1lY2hhbmlzbX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Twig template #}
{# Following code will include my/old_template.tpl, exposing $someVar variable in it #}
{% include "design:my/old_template.tpl" with {"someVar": "someValue"} %}</pre></td></tr></table><p>Or if you want to <strong>include a legacy template by its path</strong>, relative to <code>ezpublish_legacy</code> folder:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=eZ Publish 5.1+" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading975f.png?definition=e2NvZGU6dGl0bGU9ZVogUHVibGlzaCA1LjErfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Following code will include ezpublish_legacyextension/my_legacy_extension/design/standard/templates/my_old_template.tpl, exposing $someVar variable in it #}
{% include "file:extension/my_legacy_extension/design/standard/templates/my_old_template.tpl" with {"someVar": "someValue"} %}</pre></td></tr></table><h3>Template parameters</h3><p>Scalar and array parameters are passed to a legacy template <em>as-is</em>.</p><p>Objects, however, are being converted in order to comply the legacy <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/LegacyCompatible.php">eZ Template API</a>. By default <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/LegacyAdapter.php">a generic adapter</a> is used, exposing all public properties and getters. You can define your own converter by implementing <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ObjectConverter.php">the appropriate interface</a> and declare it as a service with the <code><strong>ezpublish_legacy.templating.converter</strong></code> tag.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><code>Content </code>/ <code>Location</code> objects from the Public API <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ApiContentConverter.php">are converted into <code>eZContentObject</code>/<code>eZContentObjectTreeNode</code> objects</a> (re-fetched). </p></td></tr></table><h2>Running legacy code</h2><p>eZ Publish 5 still relies on the legacy kernel (from 4.x) and runs it when needed <strong>inside an isolated PHP closure</strong>, making it <strong>sandboxed</strong>. <span style="font-size: 10.0pt;line-height: 13.0pt;">This is available for your use as well making it possible to run some PHP code inside that sandbox through the </span><code style="font-size: 10.0pt;line-height: 13.0pt;">runCallback()</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> method.</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Simple legacy code example" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingcdd8.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVNpbXBsZSBsZWdhY3kgY29kZSBleGFtcGxlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
// Declare use statements for the classes you may need
use eZINI;

// Inside a controller extending eZ\Bundle\EzPublishCoreBundle\Controller
$settingName = 'MySetting';
$test = array( 'oneValue', 'anotherValue' );
$myLegacySetting = $this->getLegacyKernel()->runCallback(
    function () use ( $settingName, $test )
    {
        // Here you can reuse $settingName and $test variables inside the legacy context
        $ini = eZINI::instance( 'someconfig.ini' );
        return $ini->variable( 'SomeSection', $settingName );
    }
);</pre></td></tr></table><p>The example above is very simple and naive - in fact for accessing configuration settings from the Legacy Stack using the <a class="confluence-link" href="../../display/EZP51/Legacy%2bconfiguration.html" data-linked-resource-id="12125303" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy configuration" data-base-url="../../index.html">ConfigResolver</a> is recommended.</p><p>Using the legacy closure, you'll be able to even run complex legacy features, like an <strong>eZ Find search</strong>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Using eZ Find" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8151.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVVzaW5nIGVaIEZpbmR9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>use eZFunctionHandler;

$searchPhrase = 'My search phrase';
$sort = array(
    'score'     => 'desc',
    'published' => 'desc'
);
$contentTypeIdenfiers = array( 'folder', 'article' );
$mySearchResults = $this->getLegacyKernel()->runCallback(
    function () use ( $searchPhrase, $sort, $contentTypeIdenfiers )
    {
        // eZFunctionHandler::execute is the equivalent for a legacy template fetch function
        // The following is the same than fetch( 'ezfind', 'search', hash(...) )
        return eZFunctionHandler::execute(
            'ezfind',
            'search',
            array(
                'query'     => $searchPhrase,
                'sort_by'   => $sort,
                'class_id'  => $contentTypeIdenfiers
            )
        );
    }
);</pre></td></tr></table><h2>Legacy modules</h2><h3>Routing fallback &amp; sub-requests</h3><p>Any route that is not declared in eZ Publish 5 in an included <code>routing.yml</code> and that is not a valid <em>UrlAlias</em> <strong>will automatically fallback to eZ Publish legacy</strong> (including admin interface).</p><p><strong>This allows all your old modules to work as before</strong>, out-of-the-box (including kernel modules), and also allows you to reuse this code from your templates using sub requests:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Template legacy module sub-request" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb54c.png?definition=e2NvZGU6bGFuZ3VhZ2U9aHRtbC94bWx8dGl0bGU9VGVtcGxhdGUgbGVnYWN5IG1vZHVsZSBzdWItcmVxdWVzdH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{{ render( url( 'ez_legacy', {'module_uri': '/content/view/sitemap/2'} ) ) }}</pre></td></tr></table><p> </p><h3>Using eZ Publish 5 and Symfony features in Legacy</h3><p>If for some reason you need to develop a legacy module and access to eZ Publish 5 / Symfony features (i.e. when developing an extension for admin interface), you'll be happy to know that you actually have access to all services registered in the whole framework, including bundles, through the service container.</p><p>The example below shows how to retrieve the content repository and the logger.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Retrieve services from the container" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1a72.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVJldHJpZXZlIHNlcnZpY2VzIGZyb20gdGhlIGNvbnRhaW5lcn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// From a legacy module or any PHP code running in legacy context.
$container = ezpKernel::instance()->getServiceContainer();

/** @var $repository \eZ\Publish\API\Repository\Repository */
$repository = $container->get( 'ezpublish.api.repository' );
/** @var $logger \Symfony\Component\HttpKernel\Log\LoggerInterface|\Psr\Log\LoggerInterface */
// PSR LoggerInterface is used in eZ Publish 5.1 / Symfony 2.2
$logger = $container->get( 'logger' );</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-parameters="title=Tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The example above works in legacy modules and CLI scripts</p></td></tr></table><p> </p><h3>Running legacy scripts and cronjobs</h3><table class="wysiwyg-macro" data-macro-name="info" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Note: This feature has been introduced in eZ Publish 5.1.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Important" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading5653.png?definition=e25vdGU6dGl0bGU9SW1wb3J0YW50fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Running legacy scripts and cronjobs through the Symfony stack is highly recommended !</strong><br />Otherwise, features from the Symfony stack cannot be used (i.e. HTTP cache purge) and cache clearing. NB: Some script we know won't affect cache, are still documented to be executed the direct way.</p></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;">Legacy scripts can be executed form the Symfony CLI, by using the </span><code style="font-size: 10.0pt;line-height: 13.0pt;">ezpublish:legacy:script</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> command, specifying the path to the script as argument.</span></p><p>The command will need to be executed from eZ Publish's 5 root, and the path to the desired script must exist in the <code>ezpublish_legacy</code> folder.<br />Here's a usage example:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php ezpublish/console ezpublish:legacy:script bin/php/ezpgenerateautoloads.php</pre></td></tr></table><p>If you want to access the script's help please be aware that you will need to use the newly introduced <code>--legacy-help</code> option, since --help is already reserved for the CLI help.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The <code>--legacy-help</code> option should be added <u>before</u> the path to the script for this to work.</p></td></tr></table><p><br />Here's an example:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php ezpublish/console ezpublish:legacy:script --legacy-help bin/php/ezpgenerateautoloads.php</pre></td></tr></table><p>The same logic will apply for cronjob execution.<br />Legacy cronjobs are triggered by the <code>runcronjobs.php</code> legacy script, which expects the name of the cronjob to run as a parameter.<br />This is how you can run cronjobs from the Symfony CLI:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php ezpublish/console ezpublish:legacy:script runcronjobs.php frequent</pre></td></tr></table><p>Also, if you require using additional script options, please be sure to use the long name, such as <code>--siteaccess</code> or <code>--debug</code> to avoid conflicts between script and CLI options.<br />For more details regarding legacy cronjobs execution please refer to the <a href="../../eZ-Publish/Technical-manual/5.x/Features/Cronjobs/Running-cronjobs.html">Running cronjobs</a> chapter existing in doc.ez.no.</p><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125325 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 13:28:22 GMT -->
</html>
