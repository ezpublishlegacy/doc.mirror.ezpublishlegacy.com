                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125309 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 13:28:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpaged8d8.html?pageId=12125309" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/colors556c.css?spaceKey=EZP51" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/custom556c.css?spaceKey=EZP51" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>For better integration between 5.x (symfony based) kernel and legacy (4.x) kernel, injection is used to inject <a class="confluence-link" href="../../display/EZP51/Legacy%2bconfiguration%2binjection.html" data-linked-resource-id="12125304" data-linked-resource-version="4" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy configuration injection" data-base-url="https://doc.ez.no">settings</a>, <a class="confluence-link" href="../../display/EZP51/Legacy%2bsession%2binjection.html" data-linked-resource-id="12125313" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy session injection" data-base-url="https://doc.ez.no">session</a> and <a class="confluence-link" href="../../display/EZP51/Legacy%2bsiteaccess%2binjection.html" data-linked-resource-id="12125315" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy siteaccess injection" data-base-url="https://doc.ez.no">current siteaccess</a> from 5.x into legacy using an event: kernel.event_subscriber</p><p>This page describe how you can do that.  </p><h2>Adding a kernel.event_subscriber</h2><p>A legacy kernel event subscriber is added by tagging your event subscriber service.<br /><br />Bellow is an example of yml configuration involved:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=kernel.event_subscriber" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading72ac.png?definition=e2NvZGU6dGl0bGU9a2VybmVsLmV2ZW50X3N1YnNjcmliZXJ9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>    my_app.legacy_mapper.something:
        class: %my_app.legacy_mapper.something.class%
        arguments: [@service_container]
        tags:
            - { name: kernel.event_subscriber }</pre></td></tr></table><p> </p><p>The class refered to as <span style="font-size: 10.0pt;line-height: 13.0pt;">%</span><span style="font-size: 10.0pt;line-height: 13.0pt;">my_app.legacy_mapper.something</span><span style="font-size: 10.0pt;line-height: 13.0pt;">.class% can look like this:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=my_app.legacy_mapper.something.class" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading459c.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPW15X2FwcC5sZWdhY3lfbWFwcGVyLnNvbWV0aGluZy5jbGFzc30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace MyApp\LegacyMapper;
use eZ\Publish\Core\MVC\Legacy\LegacyEvents;
use eZ\Publish\Core\MVC\Legacy\Event\PreBuildKernelWebHandlerEvent;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;
/**
 * Maps something into Legacy kernel
 */
class Something implements EventSubscriberInterface
{
    /**
     * @var \Symfony\Component\DependencyInjection\ContainerInterface
     */
    private $container;
 
   /**
    * @param \Symfony\Component\DependencyInjection\ContainerInterface $container
    */
    public function __construct( ContainerInterface $container )
    {
        $this->container = $container;
    }
    public static function getSubscribedEvents()
    {
        return array(
            LegacyEvents::PRE_BUILD_LEGACY_KERNEL_WEB => array( 'onBuildKernelWebHandler', 128 )
        );
    }
    /**
     * Maps matched siteaccess to the legacy parameters
     *
     * @param \eZ\Publish\Core\MVC\Legacy\Event\PreBuildKernelWebHandlerEvent $event
     *
     * @return void
     */
    public function onBuildKernelWebHandler( PreBuildKernelWebHandlerEvent $event )
    {
        // Do something, see eZ\Bundle\EzPublishLegacyBundle\LegacyMapper\* for examples
        // Example for injecting some settings:
 
        $settings = array(
            'site.ini/Block/Setting' => $this->container->getParameter( 'some.setting' ),
            'site.ini/Block/Setting2' => $this->configResolver->getParameter( 'some.setting2' )
        );
 
        $event->getParameters()->set(
            "injected-settings",
            $settings + (array)$event->getParameters()->get( "injected-settings" )
        );
    }
}

</pre></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;"><br /></span></p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125309 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 13:28:30 GMT -->
</html>
