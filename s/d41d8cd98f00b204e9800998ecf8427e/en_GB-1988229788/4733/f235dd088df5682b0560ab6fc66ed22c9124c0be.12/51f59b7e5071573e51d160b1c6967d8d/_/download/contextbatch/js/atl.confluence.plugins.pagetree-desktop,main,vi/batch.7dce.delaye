try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree-desktop.js' */
AJS.toInit(function(A){Confluence.Plugins.PagetreeMacro.bind(A)
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree.js' */
(function(){var A=function(M){this.$=M;
var H=this.$;
var b=999;
var c=true;
var K=false;
var W={};
var D={};
var N=function(k,j,f,i,e){if(j==undefined||j==null){j=!B(k)
}if(f==undefined||f==null){f=0
}if(!L(k,j)){var h=H("#children"+k);
if(Z(h)){var g=H("#plusminus"+k);
if(j==c){g.removeClass("icon-section-closed").addClass("icon-section-opened")
}else{g.removeClass("icon-section-opened").addClass("icon-section-closed")
}if(j==c){if(e==false){h.slideDown(300)
}else{h.removeClass("plugin-pagetree-hide-children");
h.animate({opacity:1})
}}else{if(e==false){h.slideUp(300)
}else{h.animate({opacity:0},{complete:function(){h.addClass("plugin-pagetree-hide-children")
}})
}}if(i){R(k)
}}else{J(k,new Array(),f,"",i,e)
}}if(i){R(k)
}};
var Z=function(e){return e.children("ul[id]").length>0
};
var B=function(f){var e=H("#plusminus"+f);
return(e.length>0)?(e.hasClass("icon-minus")||e.hasClass("icon-section-opened")):K
};
var L=function(f,e){return B(f)==e
};
var I=function(h,g,f){a(h,c,g,f)
};
var X=function(h,g,f){a(h,K,g,f)
};
var a=function(k,i,h,g){G(k);
var j=H("#"+k);
var f=j.find("div.plugin_pagetree_children_container");
f.each(function(e){var l=V(this.id);
N(l,i,b,e==f.length-1,g)
});
h.preventDefault();
h.stopPropagation()
};
var V=function(e){if(!e||e==undefined){return null
}if(e.indexOf("plusminus")!=-1){return e.substring("plusminus".length)
}if(e.indexOf("children")!=-1){return e.substring("children".length)
}return null
};
var C=function(e){if(!e||e==undefined){return null
}return S(e)[1]
};
var S=function(e){if(!e||e==undefined){return null
}return e.split("-")
};
var G=function(f){var e=C(f);
H("div.plugin_pagetree").each(function(g){if(g==e){H(this).find("span.plugin_pagetree_status").removeClass("hidden");
H(this).find("div.plugin_pagetree_expandcollapse").addClass("hidden")
}})
};
var R=function(f){var e=C(f);
H("div.plugin_pagetree").each(function(g){if(g==e){H(this).find("span.plugin_pagetree_status").addClass("hidden");
H(this).find("div.plugin_pagetree_expandcollapse").removeClass("hidden")
}})
};
var F=function(l,f,i,h,k,e,g){var j=W[l];
if(f=="Orphan"){j+="&hasRoot=false&spaceKey="+k
}else{j+="&hasRoot=true&pageId="+f
}j+="&treeId="+l+"&startDepth="+h+"&mobile="+g;
H.each(i,function(){j+="&ancestors="+this
});
j+="&treePageId="+e;
if(g==false){j=(AJS.params.serverUrl||"")+j
}return j
};
var Q=function(g){var f=g;
var e=null;
H("div.plugin_pagetree").each(function(h){if(h==f){e=H(this)
}});
return e
};
var P=function(e){var f=e.children("fieldset");
var g=new Object();
if(f.length>0){f.children("input").each(function(){g[this.name]=this.value
})
}return g
};
var O=function(e){var g=e.children("fieldset");
var h=new Array();
if(g.length>0){var f=g.children("fieldset");
if(f.length>0){f.children("input").each(function(){h.push(this.value)
})
}}return h
};
var E=function(g,f){var e=H("a.plugin_pagetree_childtoggle",g);
e.each(function(){var h=H(this);
h.attr("href","#").bind("click",function(k){var i=h.parent().parent().children("div.plugin_pagetree_children_container");
var j=i.attr("id");
var l=j.substring(8);
N(l,null,null,null,f);
k.preventDefault();
k.stopPropagation()
})
})
};
var U=function(e){var f=H(document.createElement("div"));
f.html(e);
return f.find("ul[id^='child_ul']").length
};
var J=function(m,g,q,o,i,f){var p=m;
var j=i;
var e=S(m);
var h=e[0];
var l=e[1];
var k=H("#children"+m);
var n=P(Q(l));
k.append(Confluence.Templates.Pagetree.Macro.loadingIndicator());
Raphael.spinner(k.find(".plugin_pagetree_children_loading_wrapper .spinner")[0],7,"#666");
H.ajax({type:"GET",url:F(l,h,g,q,o,n.treePageId,f),dataType:"text",success:function(r){if(U(r)){k.html(r);
if(k.children().length&&k.hasClass("hidden")){k.removeClass("hidden")
}E(k,f);
H("#plusminus"+p).addClass("icon-section-opened").removeClass("icon-section-closed");
H("#childrenspan"+D[parseInt(l)]+"-"+l).addClass("plugin_pagetree_current");
if(j){R(p)
}T(k);
if(AJS.PageGadget&&AJS.PageGadget.contentsUpdated){AJS.PageGadget.contentsUpdated()
}}else{window.location=n.loginUrl
}AJS.trigger("pagetree-children-loaded")
},error:function(r){if(r.status=="403"){k.text(n["i18n-pagetree.error.permission"])
}else{k.text(n["i18n-pagetree.error.general"])
}}})
};
var T=function(e){H("div.plugin_pagetree_children_container:empty",e).addClass("hidden")
};
var Y=function(e,j){var h=P(e);
var k=h.noRoot=="true";
var g=k?"Orphan-"+j:h.rootPageId+"-"+j;
var f=h.mobile=="true";
W[j]=h.treeRequestId;
if(f==false){D[j]=AJS.params.pageId
}else{D[j]=H("div.content-container").parent().attr("data-content-id")
}e.children("fieldset").each(function(){var l=H(this);
l.children("input[treeId]").attr("value",j);
l.children("input[rootPage]").attr("value",g)
});
if(k){e.find("div.plugin_pagetree_children").attr("id","childrenOrphan-"+j);
e.find("a.plugin_pagetree_expandall").click(function(l){I("childrenOrphan-"+j,l,f);
return false
});
e.find("a.plugin_pagetree_collapseall").click(function(l){X("childrenOrphan-"+j,l,f);
return false
})
}else{e.find("div.plugin_pagetree_children").attr("id","children"+g);
e.find("a.plugin_pagetree_expandall").click(function(l){I("children"+g,l,f);
return false
});
e.find("a.plugin_pagetree_collapseall").click(function(l){X("children"+g,l,f);
return false
})
}var i=O(e);
J(g,i,h.startDepth,h.spaceKey,"",f)
};
this.initPageTrees=function(){H("div.plugin_pagetree").each(function(e){Y(H(this),e)
});
d()
};
var d=function(){var e=self.placeFocus;
if(e){self.placeFocus=function(){var f=H("form[name='pagetreesearchform']");
f.attr("name","inlinecommentform");
e();
f.attr("name","pagetreesearchform")
}
}};
H(".open-flyout-to-search").bind("click",function(e){if(H(".fly-out-open").length){setTimeout(function(){ConfluenceMobile.flyout.hide()
},400)
}else{setTimeout(function(){ConfluenceMobile.flyout.show()
},400)
}e.stopPropagation();
e.preventDefault()
})
};
Confluence=Confluence||{};
Confluence.Plugins=Confluence.Plugins||{};
Confluence.Plugins.PagetreeMacro={bind:function(B){var C=new A(B);
C.initPageTrees()
}}
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'soy/pagetree.soy' */
// This file was automatically generated from pagetree.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Pagetree == 'undefined') { Confluence.Templates.Pagetree = {}; }
if (typeof Confluence.Templates.Pagetree.Macro == 'undefined') { Confluence.Templates.Pagetree.Macro = {}; }


Confluence.Templates.Pagetree.Macro.loadingIndicator = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="plugin_pagetree_children_loading_wrapper"><div class="spinner"/><span class="plugin_pagetree_children_loading">', soy.$$escapeHtml("Loading..."), '</span></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:help-dialog-extension', location = '/jira/help-dialog.js' */
if(Confluence.KeyboardShortcuts){Confluence.KeyboardShortcuts.Editor.push({context:"editor.actions",descKey:"Insert JIRA issue"+":",keys:[["Ctrl+Shift+J"]]})};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:share-keyboard-shortcut-js-resources', location = 'js/resourceloader.js' */
AJS.toInit(function(a){AJS.I18n.get("com.atlassian.confluence.plugins.share-page")});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:help-dialog-extension', location = 'js/help-dialog.js' */
AJS.toInit(function(a){Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.Autoformat.push({action:"@",context:"autoformat.autocomplete",description:"Mention"})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.doctheme:splitter', location = 'doctheme/splitter-1.5.1/splitter.js' */
/*
 * jQuery.splitter.js - two-pane splitter window plugin
 *
 * version 1.51 (2009/01/09)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

/**
 * The splitter() plugin implements a two-pane resizable splitter window.
 * The selected elements in the jQuery object are converted to a splitter;
 * each selected element should have two child elements, used for the panes
 * of the splitter. The plugin adds a third child element for the splitbar.
 *
 * For more details see: http://methvin.com/splitter/
 *
 *
 * @example $('#MySplitter').splitter();
 * @desc Create a vertical splitter with default settings
 *
 * @example $('#MySplitter').splitter({type: 'h', accessKey: 'M'});
 * @desc Create a horizontal splitter resizable via Alt+Shift+M
 *
 * @name splitter
 * @type jQuery
 * @param Object options Options for the splitter (not required)
 * @cat Plugins/Splitter
 * @return jQuery
 * @author Dave Methvin (dave.methvin@gmail.com)
 */
 ;(function($){
 var Z_INDEX = 4; // This is a hackish number, set somewhere in-between some page panels vs. the z-index of the browse menu.
 $.fn.splitter = function(args){
    args = args || {};
    return this.each(function() {
        var zombie;        // left-behind splitbar for outline resizes
        function startSplitMouse(evt) {
            if ( opts.outline )
                zombie = zombie || bar.clone(false).insertAfter(A);
            panes.css("-webkit-user-select", "none");    // Safari selects A/B text on a move
            bar.addClass(opts.activeClass);
            A._posSplit = A[0][opts.pxSplit] - evt[opts.eventPos];
            $(document)
                .bind("mousemove", doSplitMouse)
                .bind("mouseup", endSplitMouse);
        }
        function doSplitMouse(evt) {
            var newPos = A._posSplit+evt[opts.eventPos];
            if ( opts.outline ) {
                newPos = Math.max(0, Math.min(newPos, splitter._DA - bar._DA));
                bar.css(opts.origin, newPos);
            } else {
                resplit(newPos);
            }
        }
        function endSplitMouse(evt) {
            bar.removeClass(opts.activeClass);
            var newPos = A._posSplit+evt[opts.eventPos];
            if ( opts.outline ) {
                zombie.remove(); zombie = null;
                resplit(newPos);
            }
            panes.css("-webkit-user-select", "text");    // let Safari select text again
            $(document)
                .unbind("mousemove", doSplitMouse)
                .unbind("mouseup", endSplitMouse);
        }
        function resplit(newPos) {
            // Constrain new splitbar position to fit pane size limits
            newPos = Math.max(A._min, splitter._DA - B._max,
                    Math.min(newPos, A._max, splitter._DA - bar._DA - B._min));
            // Resize/position the two panes
            bar._DA = bar[0][opts.pxSplit];        // bar size may change during dock
            bar.css(opts.origin, newPos).css(opts.fixed, splitter._DF);
            A.css(opts.origin, 0).css(opts.split, newPos).css(opts.fixed,  splitter._DF);
            B.css(opts.origin, newPos+bar._DA)
                .css(opts.split, splitter._DA-bar._DA-newPos).css(opts.fixed,  splitter._DF);
            // IE fires resize for us; all others pay cash
            if ( !$.browser.msie )
                panes.trigger("resize");
        }
        function dimSum(jq, dims) {
            // Opera returns -1 for missing min/max width, turn into 0
            var sum = 0;
            for ( var i=1; i < arguments.length; i++ )
                sum += Math.max(parseInt(jq.css(arguments[i])) || 0, 0);
            return sum;
        }

        // Determine settings based on incoming opts, element classes, and defaults
        var vh = (args.splitHorizontal? 'h' : args.splitVertical? 'v' : args.type) || 'v';
        var opts = $.extend({
            activeClass: 'active',    // class name for active splitter
            pxPerKey: 8,            // splitter px moved per keypress
            tabIndex: 0,            // tab order indicator
            accessKey: ''            // accessKey for splitbar
        },{
            v: {                    // Vertical splitters:
                keyLeft: 39, keyRight: 37, cursor: ($.browser.msie) ? "e-resize" : "ew-resize",
                splitbarClass: "vsplitbar", outlineClass: "voutline",
                type: 'v', eventPos: "pageX", origin: "left",
                split: "width",  pxSplit: "offsetWidth",  side1: "Left", side2: "Right",
                fixed: "height", pxFixed: "offsetHeight", side3: "Top",  side4: "Bottom"
            },
            h: {                    // Horizontal splitters:
                keyTop: 40, keyBottom: 38,  cursor: ($.browser.msie) ? "n-resize" : "ns-resize",
                splitbarClass: "hsplitbar", outlineClass: "houtline",
                type: 'h', eventPos: "pageY", origin: "top",
                split: "height", pxSplit: "offsetHeight", side1: "Top",  side2: "Bottom",
                fixed: "width",  pxFixed: "offsetWidth",  side3: "Left", side4: "Right"
            }
        }[vh], args);

        // Create jQuery object closures for splitter and both panes
        var splitter = $(this).css({position: "relative"});
        var panes = splitter.children().css({
            position: "absolute",             // positioned inside splitter container
            "-moz-outline-style": "none"    // don't show dotted outline
        });
        var A = $(panes[0]);        // left  or top
        var B = $(panes[1]);        // right or bottom

        // Focuser element, provides keyboard support; title is shown by Opera accessKeys
        var focuser = $('<a href="javascript:void(0)"></a>')
            .attr({accessKey: opts.accessKey, tabIndex: opts.tabIndex, title: opts.splitbarClass})
            .bind($.browser.opera?"click":"focus", function(){ this.focus(); bar.addClass(opts.activeClass) })
            .bind("keydown", function(e){
                var key = e.which || e.keyCode;
                var dir = key==opts["key"+opts.side1]? 1 : key==opts["key"+opts.side2]? -1 : 0;
                if ( dir )
                    resplit(A[0][opts.pxSplit]+dir*opts.pxPerKey, false);
            })
            .bind("blur", function(){ bar.removeClass(opts.activeClass) });

        // Splitbar element, can be already in the doc or we create one
        var bar = $(panes[2] || '<div></div>')
            .insertAfter(A).css("z-index", Z_INDEX).append(focuser)
            .attr({"class": opts.splitbarClass, unselectable: "on"})
            .css({position: "absolute",    "user-select": "none", "-webkit-user-select": "none",
                "-khtml-user-select": "none", "-moz-user-select": "none"})
            .bind("mousedown", startSplitMouse);
        // Use our cursor unless the style specifies a non-default cursor
        if ( /^(auto|default|)$/.test(bar.css("cursor")) )
            bar.css("cursor", opts.cursor);

        // Cache several dimensions for speed, rather than re-querying constantly
        bar._DA = bar[0][opts.pxSplit];
        splitter._PBF = $.boxModel? dimSum(splitter, "border"+opts.side3+"Width", "border"+opts.side4+"Width") : 0;
        splitter._PBA = $.boxModel? dimSum(splitter, "border"+opts.side1+"Width", "border"+opts.side2+"Width") : 0;
        A._pane = opts.side1;
        B._pane = opts.side2;
        $.each([A,B], function(){
            this._min = opts["min"+this._pane] || dimSum(this, "min-"+opts.split);
            this._max = opts["max"+this._pane] || dimSum(this, "max-"+opts.split) || 9999;
            this._init = opts["size"+this._pane]===true ?
                parseInt($.curCSS(this[0],opts.split)) : opts["size"+this._pane];
        });

        // Determine initial position, get from cookie if specified
        var initPos = A._init;
        if ( !isNaN(B._init) )    // recalc initial B size as an offset from the top or left side
            initPos = splitter[0][opts.pxSplit] - splitter._PBA - B._init - bar._DA;
        if ( opts.cookie ) {
            if ( !$.cookie )
                alert('jQuery.splitter(): jQuery cookie plugin required');
            var ckpos = parseInt($.cookie(opts.cookie));
            if ( !isNaN(ckpos) )
                initPos = ckpos;
            /*
                CONF-27142 - Store sidebar width as soon as resize occurs so that new width is reflected
                in new tabs. 'A' is the jQuery object for the #splitter-sidebar div.
             */
            A.bind('resize', _.debounce(function(){
                var state = String(bar.css(opts.origin));    // current location of splitbar
                $.cookie(opts.cookie, state, {expires: opts.cookieExpires || 365,
                    path: opts.cookiePath || document.location.pathname});
            }, 300));
        }
        if ( isNaN(initPos) )    // King Solomon's algorithm
            initPos = Math.round((splitter[0][opts.pxSplit] - splitter._PBA - bar._DA)/2);

        var resizeHandler = function(e){
            var top = splitter.offset().top;
            //TODO: a quick hack to get the splitter to be the right height in ondemand due to the footer difference
            var footer = $("#footer, #studio-footer").outerHeight(true);
            if (!footer)
                footer = 24;
            var wh = $(window).height()-footer;
            splitter.css("height", Math.max(wh-top-splitter._hadjust, splitter._hmin)+"px");
            // ATLASSIAN - only resize components if the window has been resized, or this has been called directly.
            if (!e || e.target == window) splitter.trigger("resize");
        };
        args.update = function (isBound) {
            splitter._hadjust = dimSum(splitter, "borderTopWidth", "borderBottomWidth", "marginBottom");
            splitter._hmin = Math.max(dimSum(splitter, "minHeight"), 20);
            isBound && $(window).bind("resize", resizeHandler);
            resizeHandler();
        };
        // Resize event propagation and splitter sizing
        if ( opts.anchorToWindow ) {
            // Account for margin or border on the splitter container and enforce min height
            args.update(true);
        }
        else if ( opts.resizeToWidth && !$.browser.msie )
            $(window).bind("resize", function(){
                splitter.trigger("resize");
            });

        // Resize event handler; triggered immediately to set initial position
        splitter.bind("resize", function(e, size){
            // Custom events bubble in jQuery 1.3; don't Yo Dawg
            if ( e.target != this ) return;
            // Determine new width/height of splitter container
            splitter._DF = splitter[0][opts.pxFixed] - splitter._PBF;
            splitter._DA = splitter[0][opts.pxSplit] - splitter._PBA;
            // Bail if splitter isn't visible or content isn't there yet
            if ( splitter._DF <= 0 || splitter._DA <= 0 ) return;
            // Re-divvy the adjustable dimension; maintain size of the preferred pane
            resplit(!isNaN(size)? size : (!(opts.sizeRight||opts.sizeBottom)? A[0][opts.pxSplit] :
                splitter._DA-B[0][opts.pxSplit]-bar._DA));
        }).trigger("resize" , [initPos]);
    });
};
})(jQuery);

/*Places focus on the main content section of pages*/
/* TODO - CONFDEV-2045 Clean up this code */
window.placeFocus = function () {

    var mainSection = document.getElementById('splitter-content');
    // Don't focus when there is an editor on the page.
    if(mainSection && AJS.$("#wysiwyg").length == 0)
    {
        mainSection.focus();
    }
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.doctheme:splitter', location = 'doctheme/space-specific-quicknav.js' */
AJS.toInit(function($) {
    // This code runs on every page, but we only want it to run in the Doc theme.
    if ($("#com-atlassian-confluence").hasClass("theme-documentation")) {
        var quickSearchQuery = $("#quick-search-query");

        var siteSearchForm = quickSearchQuery.closest("form");
        var spaceKey = $("fieldset input[name='spaceSearch']", siteSearchForm).val() === "true" ? $("#confluence-space-key").attr("content") : "";

        siteSearchForm.submit(function() {
            var query = quickSearchQuery.val();

            if (query.search(/all:/gi) >= 0) {
                quickSearchQuery.val($.trim(query.replace(/all:/gi, '')));
            }
        });

        var quickNav = AJS.defaultIfUndefined("Atlassian.SearchableApps.QuickNav", { defaultValue: Confluence.QuickNav });

        AJS.log("Applying doc-theme quick search");
        quickNav.addDropDownPostProcess(function (dropDown) {
            if (spaceKey) {
                var searchFor = $("a.search-for", dropDown);
                searchFor.attr("href", searchFor.attr("href") + "&where=" + encodeURIComponent(spaceKey));
            }
        });
        quickNav.setMakeParams(function(value) {
            var params = { query : value };

            if (params.query.search(/all:/gi) >= 0) {
                $("input[name='where']", siteSearchForm).val("");
                params.query = $.trim(params.query.replace(/all:/gi, ''));
                if (!params.query)
                    params.query = "ALL";
            } else if (spaceKey) {
                params.spaceKey = spaceKey;
            }

            return params;
        });

        // DOC-79 - We need to overwrite the tooltip that Confluence appended to the quick search box when each page finish loading.
        quickSearchQuery.mouseover(function() {
            if(spaceKey) {
                quickSearchQuery.attr("title", $("input[name='tooltip']", siteSearchForm).val());
            }
        });
    }
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:view-comment', location = '/includes/js/comments.js' */
AJS.toInit(function(e){var d=Confluence.storageManager("comments");var a=function(){if(confirm("Are you sure you want to delete the comment?")){this.href=this.href+"&confirm=yes";return true}return false};Confluence.Comments={bindRemoveConfirmation:function(f){e("#comment-"+f+" .comment-action-remove a").click(a)}};if(!e("#comments-section").length){return}if(AJS.isIE6){e(".logo.anonymous").each(function(){var f=document.createElement("div");f.className="replacement";AJS.applyPngFilter(f,this.src);e(this).replaceWith(f)});e(".comment-actions .comment-permalink a").each(function(){e(this).addClass("filtered");var g=e(this).css("background-image").replace(/^url\(\"?|\"?\)$/g,"");var f=g.replace("light","dark");AJS.applyPngFilter(this,g);this.style.cursor="pointer";this.style.background="none";e(this).hover(function(){AJS.applyPngFilter(this,f)},function(){AJS.applyPngFilter(this,g)})})}e("#comments-section .comment:odd").addClass("odd");e(".comment-action-remove a").click(a);var c=e("#addcomment.comment-text"),b=e("#comments-text-editor textarea");b.focus(function(){c.addClass("active")}).blur(function(){if(!e.trim(b.val()).length){c.removeClass("active")}}).bind("reset.default-text",function(){c.removeClass("active")});e("form[name='textcommentform']").submit(function(){var f=b.val();if(!e.trim(f)){alert("Comment text is empty. Cannot create empty comments.");return false}return true});e("#add-comment-rte").click(function(){if(!b.hasClass("placeholded")){d.setItem("text-comment",e.trim(b.val()))}});if(e("#addcomment #rte").length){AJS.bind("init.rte",function(h,g){var f=d.getItem("text-comment");if(f){g.editor.setContent(f);d.setItem("text-comment","")}})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/user.soy' */
// This file was automatically generated from user.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }


Confluence.Templates.User.userLinkUrl = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(soy.$$escapeHtml(""), '/display/~', soy.$$escapeUri(opt_data.username));
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.User.logo = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.profilePictureInfo['default'] && opt_data.username == opt_data.currentUsername) {
    output.append('<a ', (opt_data.canView) ? ' ' + ((! opt_data.disableUserHover) ? 'class="userLogoLink"' : '') + ' data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : '', ' href="', soy.$$escapeHtml(""), '/users/editmyprofilepicture.action" title="', soy.$$escapeHtml("Add a picture of yourself"), '"><img class="userLogo logo defaultLogo" src="', soy.$$escapeHtml("/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_"), '/images/icons/profilepics/add_profile_pic.png" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml("Add a picture of yourself"), '"></a>');
  } else {
    if (opt_data.profilePictureInfo.anonymous) {
      output.append('<img class="userLogo logo anonymous" src="', soy.$$escapeHtml("/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_"), '/images/icons/profilepics/anonymous.png" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml("Anonymous"), '" title="', soy.$$escapeHtml("Anonymous"), '">');
    } else if (opt_data.canView) {
      output.append('<a ', (! opt_data.disableUserHover) ? 'class="userLogoLink"' : '', ' data-username="', soy.$$escapeHtml(opt_data.username), '" href="');
      Confluence.Templates.User.userLinkUrl(opt_data, output);
      output.append('"><img class="userLogo logo" src="', soy.$$escapeHtml(""), soy.$$escapeHtml(opt_data.profilePictureInfo.downloadPath), '" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml(opt_data.username), '" title="', soy.$$escapeHtml(opt_data.username), '"></a>');
    } else {
      output.append('<img class="userLogo logo anonymous" src="', soy.$$escapeHtml("/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_"), '/images/icons/profilepics/anonymous.png" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml(opt_data.username), '" title="', soy.$$escapeHtml(opt_data.username), '">');
    }
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.User.usernameLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.username && opt_data.username != '') {
    output.append('<a href="');
    Confluence.Templates.User.userLinkUrl(opt_data, output);
    output.append('"', (opt_data.canView) ? 'class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : 'class="url fn"', '>', (opt_data.fullName && opt_data.fullName != '') ? soy.$$escapeHtml(opt_data.fullName) : soy.$$escapeHtml(opt_data.username), '</a>');
  } else {
    output.append(soy.$$escapeHtml("Anonymous"));
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.User.fullNameOrAnonymous = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.user && opt_data.user.fullName) ? soy.$$escapeHtml(opt_data.user.fullName) : soy.$$escapeHtml("Anonymous"));
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.User.usernameOrAnonymous = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.user && opt_data.user.name) ? soy.$$escapeHtml(opt_data.user.name) : soy.$$escapeHtml("Anonymous"));
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Icons == 'undefined') { Confluence.Templates.Icons = {}; }


Confluence.Templates.Icons.contentIcon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.content.type == 'trackback') ? '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon icon-trackback" title="' + soy.$$escapeHtml("Track back") + '">' + soy.$$escapeHtml("Track back") + ':</a>' : '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon ' + soy.$$escapeHtml(opt_data.iconCss) + '" title="' + soy.$$escapeHtml(opt_data.iconTitle) + '">' + soy.$$escapeHtml(opt_data.iconTitle) + '</a>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'soy/comments.soy' */
// This file was automatically generated from comments.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Comments == 'undefined') { Confluence.Templates.Comments = {}; }


Confluence.Templates.Comments.displayReplyEditorLoadingContainer = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol class="comment-threads"><li class="comment-thread">');
  Confluence.Templates.Comments.displayCommentEditorCommon({comment: {'ownerId': opt_data.contentId, 'parentId': opt_data.parentCommentId}, commenter: opt_data.commenter, state: 'loading', mode: 'reply'}, output);
  output.append('</li></ol>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  Confluence.Templates.Comments.displayCommentEditorCommon({comment: {'ownerId': opt_data.contentId}, commenter: opt_data.commenter, state: 'placeholder', mode: 'add'}, output);
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.editorLoadErrorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml(opt_data.message), '</p><p><a href="', soy.$$escapeHtml(opt_data.fallbackUrl), '">', soy.$$escapeHtml("Try again"), '</a></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.displayCommentEditorCommon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="quick-comment-container comment ', soy.$$escapeHtml(opt_data.mode), '">');
  Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}, output);
  output.append('<div class="quick-comment-vertical-spacer"></div><div class="quick-comment-body"><div class="quick-comment-loading-container" style="display:', (opt_data.state == 'loading') ? 'block' : 'none', ';"><p class="quick-comment-loading-message">', soy.$$escapeHtml("Loading the Editor"), '</p></div><div id="editor-messages"></div><div id="all-messages"></div><form style="display:', (opt_data.state == 'loading') ? 'none' : 'block', ';" class="quick-comment-form aui" method="post" ');
  switch (opt_data.mode) {
    case 'add':
      output.append('name="inlinecommentform" action="', soy.$$escapeHtml(""), '/pages/doaddcomment.action?pageId=', soy.$$escapeHtml(opt_data.comment.ownerId), '"');
      break;
    case 'edit':
      output.append('name="editcommentform" action="', soy.$$escapeHtml(""), '/pages/doeditcomment.action?pageId=', soy.$$escapeHtml(opt_data.comment.ownerId), '&commentId=', soy.$$escapeHtml(opt_data.comment.id), '"');
      break;
    case 'reply':
      output.append('name="threadedcommentform"  action="', soy.$$escapeHtml(""), '/pages/doaddcomment.action?pageId=', soy.$$escapeHtml(opt_data.comment.ownerId), '&parentId=', soy.$$escapeHtml(opt_data.comment.parentId), '"');
      break;
  }
  output.append(' ><div title="', soy.$$escapeHtml("Add a Comment"), '" class="quick-comment-prompt"><span>', soy.$$escapeHtml("Write a comment\u2026"), '</span></div></form></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.userLogo = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class="comment-user-logo">');
  if (opt_data.userInfo.userName == null) {
    output.append('<img class="userLogo logo anonymous" src="', soy.$$escapeHtml("/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_"), '/images/icons/profilepics/anonymous.png" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml("Anonymous"), '" title="', soy.$$escapeHtml("Anonymous"), '">');
  } else if (opt_data.userInfo.profilePicture.isDefault) {
    output.append('<a class="userLogoLink" data-username="', soy.$$escapeHtml(opt_data.userInfo.userName), '" href="', soy.$$escapeHtml(""), '/users/editmyprofilepicture.action" title="', soy.$$escapeHtml("Add a picture of yourself"), '"><img class="userLogo logo defaultLogo" src="', soy.$$escapeHtml("/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_"), '/images/icons/profilepics/add_profile_pic.png" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml("Add a picture of yourself"), '"></a>');
  } else {
    output.append('<a class="userLogoLink" data-username="', soy.$$escapeHtml(opt_data.userInfo.userName), '" href="');
    Confluence.Templates.User.userLinkUrl({username: opt_data.userInfo.userName}, output);
    output.append('"><img class="userLogo logo" src="', soy.$$escapeHtml(opt_data.userInfo.profilePicture.path), '" alt="', soy.$$escapeHtml("User icon"), ': ', soy.$$escapeHtml(opt_data.userInfo.userName), '" title="', soy.$$escapeHtml(opt_data.userInfo.userName), '"></a>');
  }
  output.append('</p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.displayComment = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.comment.parentId == 0 && opt_data.firstReply) {
    output.append('<div id="comments-section" class="pageSection group"><div class="section-header"><h2 id="comments-section-title" class="section-title">', soy.$$escapeHtml("1 Comment"), '</h2>');
    Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: true}, output);
    output.append('</div></div>');
  } else if (opt_data.firstReply) {
    Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: false}, output);
  } else {
    Confluence.Templates.Comments.commentThreadItem({comment: opt_data.comment, commenter: opt_data.commenter, highlight: true}, output);
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.commentThread = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol class="comment-threads', (opt_data.topLevel) ? ' top-level" id="page-comments' : '', '">');
  Confluence.Templates.Comments.commentThreadItem(opt_data, output);
  output.append('</ol>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.commentThreadItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li id="comment-thread-', soy.$$escapeHtml(opt_data.comment.id), '" class="comment-thread">');
  Confluence.Templates.Comments.commentView(opt_data, output);
  output.append('</li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.commentView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="comment', (opt_data.highlight == true) ? ' focused' : '', '" id="comment-', soy.$$escapeHtml(opt_data.comment.id), '">');
  Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}, output);
  output.append('<div class="comment-header"><h4 class="author">', (opt_data.commenter.userName == null) ? soy.$$escapeHtml("Anonymous") : '<a href="' + soy.$$escapeHtml("") + '/display/' + soy.$$escapeUri(opt_data.commenter.userName) + '" class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.commenter.userName) + '">' + soy.$$escapeHtml(opt_data.commenter.displayName) + '</a>', '</h4></div><div class="comment-body"><div class="comment-content wiki-content">', opt_data.comment.html, '</div><div class="comment-actions">');
  Confluence.Templates.Comments.displayCommentActions({section: 'secondary', actions: opt_data.comment.secondaryActions, commentId: opt_data.comment.id}, output);
  Confluence.Templates.Comments.displayCommentActions({section: 'primary', actions: opt_data.comment.primaryActions, commentId: opt_data.comment.id}, output);
  output.append('</div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Comments.displayCommentActions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="comment-actions-', soy.$$escapeHtml(opt_data.section), '">');
  if (opt_data.actions != null) {
    var itemList203 = opt_data.actions;
    var itemListLen203 = itemList203.length;
    for (var itemIndex203 = 0; itemIndex203 < itemListLen203; itemIndex203++) {
      var itemData203 = itemList203[itemIndex203];
      output.append('<li ', (itemData203.style != null) ? ' class="' + soy.$$escapeHtml(itemData203.style) + '"' : '', '><a ', (itemData203.tooltip != null) ? ' title="' + soy.$$escapeHtml(itemData203.tooltip) + '"' : '', ' href="', soy.$$escapeHtml(itemData203.url), '" ', (itemData203.id) ? ' id="' + soy.$$escapeHtml(itemData203.id) + '-' + soy.$$escapeHtml(opt_data.commentId) + '"' : '', '><span>', soy.$$escapeHtml(itemData203.label), '</span></a></li>\n');
    }
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/comment-display-manager.js' */
// TODO this should be merged with Confluence.Comments from comments.js in the core product.
// At the moment it is kept separate because having it in a plugin is better for dev speed.
// This script is dependent on templates in comments.soy
Confluence.CommentDisplayManager = (function($) {

    var createTemplateInjectionContext = function() {
        return {
            "contextPath": AJS.Meta.get("context-path"),
            "staticResourceUrlPrefix": AJS.Meta.get("static-resource-url-prefix")
        };
    };
    
    var createTemplateParameters = function(commenter, comment, highlight) {
        return {
            "comment": comment,
            "commenter": commenter,
            "highlight": highlight,
            "context": createTemplateInjectionContext()
        };
    };
    
    return {

        /**
         * Update the comments section heading if it exists with the current number
         * of comments.
         */
        _updateCommentSectionTitle: function() {
            var $title = $("#comments-section-title");
            if ($title.length == 0) {
                return;
            }

            var count = this.commentCount();
            if (count == 1) {
                $("a", $title).text("1 Comment");
            } else {
                var text = AJS.format("{0} Comments", count);
                $("a", $title).text(text);
            }
        },
        
        /**
         * Add and focus the display on a new comment.
         * 
         * @param commenter the person making the comment. This is an object with the following structure:
         * {
         *     userName:       (string)
         *     displayName:    (string)
         *     profilePicture: {
         *         isDefault: (boolean)
         *         path:      (string)
         *     }
         * }
         * @param comment the comment. This is an object with the following structure:
         * {
         *     id:               (number)
         *     html:             (string)
         *     ownerId:          (number)
         *     parentId:         (number) 0 indicates a top level comment
         *     primaryActions:    (array of actions) may be empty
         *     secondaryActions: (array of actions) may be empty
         * }
         * @param highlight true if you want the comment to appear highlighted
         * @param keepFocus true if you don't want to clear the focus
         * @returns a jQuery wrapped DOM Node which is the top container for the newly added comment.
         */
        addComment: function(commenter, comment, highlight, keepFocus) {
            var templateParams = createTemplateParameters(commenter, comment, highlight);
            
            if (!this.hasComments()) {
                templateParams.firstReply = true;
                var template = Confluence.Templates.Comments.displayComment(templateParams);
                AJS.$("#comments-section").prepend(template);
            } else {
                
                var $appendLocation;
                
                if (comment.parentId == 0) {
                    templateParams.firstReply = false;
                    $appendLocation = AJS.$("#comments-section .comment-threads.top-level");                    
                } else {
                    var $commentThread = AJS.$("#comment-thread-" + comment.parentId);
                    var $replyThread = $commentThread.children(".commentThreads");
                    
                    if ($replyThread.length) {
                        templateParams.firstReply = false;
                        $appendLocation = $replyThread;
                    } else {
                        templateParams.firstReply = true;
                        $appendLocation = $commentThread;
                    }
                }
                if (!keepFocus) {
                    this.clearFocus();
                }
                var renderedTemplate = Confluence.Templates.Comments.displayComment(templateParams);
                $appendLocation.append(renderedTemplate);
                this._updateCommentSectionTitle();
            }
            
            Confluence.Comments.bindRemoveConfirmation(comment.id);
            var $insertedComment = this.getCommentNode(comment.id);
            // Scroll to the newly added comment.
            $insertedComment.scrollToElement();
            return $insertedComment;
        },        

        /**
         * Add or focus the display on a new comment, or update an existing comment.
         *
         * @see Confluence.CommentDisplayManager.addComment for more information.
         */
        addOrUpdateComment: function(commenter, comment, highlight, keepFocus) {
            var oldComment = this.getCommentNode(comment.id);
            if (oldComment) {
                oldComment.find('.comment-content').html(comment.html);
                if (!keepFocus) {
                    this.clearFocus();
                }
                if (highlight) {
                    oldComment.addClass('focused');
                }
                oldComment.scrollToElement();
                return oldComment;
            } else {
                return this.addComment.apply(this, arguments);
            }
        },

        /**
         * @return true if the comment section is visible.
         */
        isVisible : function() {
            return !$('#page-comments').hasClass("hidden");
        },
        
        /**
         * @return true if there are any comments displayed on the page.
         */
        hasComments: function() {
            return this.commentCount() > 0;
        },
        
        /**
         * @return the number of comments on the page.
         */
        commentCount: function() {
            return AJS.$("#comments-section .comment").not(".quick-comment-container").length;
        },
        
        /**
         * Remove the focus from all comments
         */
        clearFocus: function() {
            $(".comment").removeClass("focused");
        },
        
        /**
         * @param commentId the id of the comment required
         * @returns the jQuery wrapped DOM node for the top div of the identified comment or null if not found.
         */
        getCommentNode: function(commentId) {
            var $node = $("#comment-" + commentId);
            
            if (!$node.length) {
                return null;
            } else {
                return $node;
            }
        },
        
        /**
         * Get the id of the comment the indicated one is a reply to. If the comment is not a reply
         * then return 0.
         * 
         * @param commentId the id of the comment whos parent is required
         * @return the id of the parent comment or 0 if the comment is not a reply.
         */
        getParentId: function(commentId) {
            var $comment = getCommentNode(commentId);
            
            if ($comment != null) {
                var $parentComment = $comment.closest("div.comment");
                if ($parentComment.length) {
                    var idStr = $parentComment.attr("id");
                    var id = /\d+/.exec(idStr);
                    return parseInt(id);
                }
            }
            
            return 0;
        }
    };    
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/scroll-util.js' */
AJS.$(function($) {

    $.fn.extend({
        scrollToElement: function() {
            if(!this.scrollWindowToElement()) {
                // try and scroll the closest overflow set parent (e.g. Documentation Theme)
                this.scrollOverflowContainerToElement();
            }
            return this;
        },

        /**
         * The default theme has scrollbars on the window and therefore this
         * method can make sure the supplied element is visible. However other themes don't scroll the
         * window so this method will return true if it successfully scrolls and false if it is unable
         * to move the window.
         */
        scrollWindowToElement: function() {
            var $element = this;
            function getScrollY() {
                if ('pageYOffset' in window) {  // all browsers, except IE before version 9
                    return window.pageYOffset;
                } else { // Internet Explorer before version 9
                    // we ignore zoom factor which was only an issue before IE8
                    return document.documentElement.scrollTop;
                }
            };

            var scrollY = getScrollY();

            var windowHeight;
            if (typeof(window.innerWidth) == 'number') {
                windowHeight = window.innerHeight;
            } else if (document.documentElement && document.documentElement.clientWidth) {
                // IE 6+ in 'standards compliant mode'
                windowHeight = document.documentElement.clientHeight;
            } else {
                // something old and creaky - just try to make sure the element will be visible and return true so we consider this successful
                $element[0].scrollIntoView(false);
                return true;
            }

            var elementVerticalPosition = $element.offset().top;
            var elementHeight = $element.height();

            var extra = 40; // the calculation seems to be off by 40 pixels - I don't know why (perhaps padding on $element?)

            if ((elementVerticalPosition + elementHeight + extra) > scrollY + windowHeight) {
                $element[0].scrollIntoView(false); // align to the bottom of the viewport
                window.scrollBy(0, extra);
                return scrollY != getScrollY(); // did we successfully scroll the window?
            } else {
                // no scrolling was necessary
                return true;
            }
        },

        /**
         * Find the closest parent with the CSS property overflow set to either 'scroll' or 'auto' and
         * scroll this to show the element.
         *
         * @return true if successfully found a parent to scroll.
         */
        scrollOverflowContainerToElement: function() {
            var $element = this;
            var $parent = null;

            $element.parents().each(function(index) {
                var overflow = AJS.$(this).css("overflow");
                if (overflow == "auto" || overflow == "scroll") {
                    $parent = AJS.$(this);
                    return false;
                }
            });

            if (!$parent) {
                return false;
            }

            var height = $parent.height();

            var extra = 40; // the calculation seems to be off by 40 pixels - I don't know why (perhaps padding on $element?)
            var elementVerticalPosition = $element.offset().top;
            var elementHeight = $element.height();
            var differential = height - (elementVerticalPosition + elementHeight + extra);

            if (differential < 0) {
                $parent[0].scrollTop = $parent[0].scrollTop - differential;
            }

            return true;
        }
    });
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'templates/quick-reload.soy' */
// This file was automatically generated from quick-reload.soy.
// Please don't edit this file by hand.

if (typeof QuickReload == 'undefined') { var QuickReload = {}; }
if (typeof QuickReload.Templates == 'undefined') { QuickReload.Templates = {}; }


QuickReload.Templates.notice = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="qr-notice aui-message warning"></div>');
  return opt_sb ? '' : output.toString();
};


QuickReload.Templates.noticeItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="qr-notice-item"><span class="qr-notice-text"></span>&nbsp;&nbsp;<a class="qr-notice-show" href="#">', soy.$$escapeHtml(opt_data.show), '</a>&nbsp;&nbsp;<a class="qr-notice-ignore" href="#">', soy.$$escapeHtml("Ignore"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'js/quick-reload-comments.js' */
Confluence.QuickReload=Confluence.QuickReload||{};
AJS.toInit(function(B){var C=Confluence.CommentDisplayManager;
function A(D){return D.comment.id
}Confluence.QuickReload.Comments=function(){return{property:"comments",singleText:function(E,D){return AJS.format("New comment from {0}",D(E.commenter))
},manyText:function(D){return AJS.format("{0} new comments",D.length)
},showText:function(){return "Show"
},filterNewResults:function(D,F){if(D.length===0||F.length===0){return F
}var E=B.map(D,A);
return B(F).filter(function(G,H){return B.inArray(A(H),E)<0
}).splice(0)
},update:function(D){C.clearFocus();
B.map(D,function(E){var G=C.getCommentNode(A(E))!=null;
var F=C.addOrUpdateComment(E.commenter,E.comment,true,true);
if(Confluence.Likes&&!G){Confluence.Likes.appendAction(B(F));
Confluence.Likes.updateComment(B(F),{})
}})
}}
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'js/quick-reload-page.js' */
Confluence.QuickReload=Confluence.QuickReload||{};
AJS.toInit(function(A){Confluence.QuickReload.Page=function(){return{property:"page",singleText:function(C,B){return AJS.format("New edit by {0}",B(C.editor))
},manyText:function(B){return AJS.format("{0} new edits",B.length)
},showText:function(){return "Reload"
},filterNewResults:function(B,C){return C
},update:function(B){window.location.reload()
}}
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'js/quick-reload-alert.js' */
Confluence.QuickReload=Confluence.QuickReload||{};
AJS.toInit(function(B){var A=QuickReload.Templates;
Confluence.QuickReload.Notice=function(){var C=B(A.notice());
C.appendTo("body");
return{addOrUpdateText:function(H,K,E,G){var J="qr-notice-type-"+H;
var D=C.find("."+J);
if(D.length===0){D=B(A.noticeItem({show:E})).appendTo(C);
D.addClass(J);
var I=this;
var F=function(L){if(C.find(".qr-notice-text").length==1){I.hide(function(){D.remove()
})
}else{D.remove()
}L.preventDefault()
};
D.find(".qr-notice-ignore").click(F);
D.find(".qr-notice-show").click(F).click(G)
}D.find(".qr-notice-text").text(K)
},bind:function(D,E){return C.bind(D,E)
},show:function(){C.animate({opacity:"show"},600)
},hide:function(D){C.trigger("close");
C.animate({opacity:"hide"},600,D)
}}
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'js/quick-reload-timer.js' */
Confluence.QuickReload=Confluence.QuickReload||{};
AJS.toInit(function(A){Confluence.QuickReload.SmartTimer=function(I,F){var L=A.extend({min:1000*20,max:1000*60*60,inactivity:1000*60*5},F);
function E(){return new Date().getTime()
}var K=E();
var D=null;
A(window).focus(C);
A("body").click(C);
function J(){return E()-K
}function C(){var M=J()>L.inactivity;
K=E();
if(M){I();
B()
}}function G(N,M,P){var O=Math.max(Math.min(M,P),N);
return isNaN(O)?N:O
}function H(){return G(1,L.max/L.min,Math.ceil(J()/L.inactivity))
}function B(){if(D){clearTimeout(D)
}D=setTimeout(function(){I();
B()
},L.min*H())
}return{start:function(){I();
B()
},stop:function(){clearTimeout(D);
D=null
}}
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload', location = 'js/quick-reload.js' */
Confluence.QuickReload=Confluence.QuickReload||{};
AJS.toInit(function(H){if(AJS.DarkFeatures.isEnabled("quickreload.disabled")){return 
}if(!Confluence.CommentDisplayManager){return 
}var C=AJS.Meta.get("page-id");
if(C==undefined){return 
}var L=document.title;
var D=[new Confluence.QuickReload.Comments(),new Confluence.QuickReload.Page()];
var M=new Confluence.QuickReload.Notice();
M.bind("close",function(){document.title=L
});
var J=function(P){document.title=P+L
};
var O=function(P){if(P.results.length===1){return P.singleText(P.results[0],function(Q){return Q.displayName
})
}return P.manyText(P.results)
};
var B=H("meta[name='confluence-request-time']").attr("content")||new Date().getTime();
var G=false;
var N=0;
var E=function(){J(N>0?"("+N+") ":"")
};
function K(){return H("body").hasClass("contenteditor")
}function F(Q,P){return Confluence.getContextPath()+"/rest/quickreload/latest/"+Q+"?since="+encodeURIComponent(P)
}Confluence.QuickReload.update=function(){if(K()){Confluence.QuickReload.disable();
return 
}H.ajax({type:"GET",url:F(C,B),dataType:"json"}).done(function(Q){var P=false;
B=Q.time;
H.map(D,function(W){var R=Q[W.property];
W.results=W.results||[];
if(R){var X=W.results.concat(W.filterNewResults(W.results,R));
var T=X.length-W.results.length;
var U=T>0;
W.results=X;
if(U){var S=false;
function V(){W.update(W.results);
N-=W.results.length;
W.results=[];
S||E()
}if(AJS.DarkFeatures.isEnabled("confluence.quick-reload-automated")){S=true;
return V()
}M.addOrUpdateText(W.property,O(W),W.showText(),V)
}P|=U;
N+=T
}});
if(P){M.show();
E()
}})
};
var I={};
if(AJS.DarkFeatures.isEnabled("confluence.quick-reload-automated")){I.min=1000*5
}var A=new Confluence.QuickReload.SmartTimer(Confluence.QuickReload.update,I);
Confluence.QuickReload.disable=function(){G=true;
A.stop();
M.hide()
};
Confluence.QuickReload.enable=function(){G=false;
A.start()
};
A.start()
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = 'soy/jira-metadata.soy' */
// This file was automatically generated from jira-metadata.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Metadata == 'undefined') { Confluence.Templates.Metadata = {}; }
if (typeof Confluence.Templates.Metadata.JIRA == 'undefined') { Confluence.Templates.Metadata.JIRA = {}; }


Confluence.Templates.Metadata.JIRA.metadata = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-metadata-dialog"><h2 class="title">', soy.$$escapeHtml("JIRA links"), '</h2><div class="items-section">');
  var groupList6 = opt_data.groups;
  var groupListLen6 = groupList6.length;
  for (var groupIndex6 = 0; groupIndex6 < groupListLen6; groupIndex6++) {
    var groupData6 = groupList6[groupIndex6];
    if (groupData6.items.length) {
      switch (groupData6.type) {
        case 'ISSUES':
          Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Issues", type: groupData6.type, links: groupData6.links}, output);
          break;
        case 'SPRINTS':
          Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Sprints", type: groupData6.type, links: groupData6.links}, output);
          break;
        case 'VERSIONS':
          Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Versions", type: groupData6.type, links: groupData6.links}, output);
          break;
        case 'EPICS':
          Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Epics", type: groupData6.type, links: groupData6.links}, output);
          break;
      }
    }
  }
  output.append('</div>');
  Confluence.Templates.Metadata.JIRA.renderAuthPrompts({appLinks: opt_data.unauthorisedAppLinks}, output);
  Confluence.Templates.Metadata.JIRA.renderJiraErrors(opt_data, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.featureDiscovery = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-metadata-feature-discovery"><h2>', soy.$$escapeHtml("View related JIRA items here"), '</h2><p>', soy.$$escapeHtml("Now you can see which epics, sprints, versions and issues relate to this page."), '</p><div class="aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner">');
  aui.buttons.button({text: "Show me", extraClasses: 'showme'}, output);
  aui.buttons.button({text: "Close", type: 'link', extraClasses: 'close'}, output);
  output.append('</div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.nometadata = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-metadata-dialog">');
  aui.message.warning({content: '<p>' + soy.$$escapeHtml("JIRA links cannot be displayed. Either you do not have correct JIRA permissions or the links have been removed.") + '</p>'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.renderAuthPrompts = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.appLinks.length) {
    var param66 = new soy.StringBuilder();
    if (opt_data.appLinks.length == 1) {
      var appLink__soy69 = opt_data.appLinks[0];
      param66.append('<p>', AJS.format("{0}Login \x26amp; Approve{1} to retrieve data from {2}",'<a class="jira-metadata-auth-link" href="#" data-href="' + appLink__soy69.authorisationUrl + '">','</a>',appLink__soy69.htmlSafeName), '</p>');
    } else {
      param66.append('<p>', soy.$$escapeHtml("Authenticate to retrieve data from the following instances:"), '</p>');
      var appLinkList78 = opt_data.appLinks;
      var appLinkListLen78 = appLinkList78.length;
      for (var appLinkIndex78 = 0; appLinkIndex78 < appLinkListLen78; appLinkIndex78++) {
        var appLinkData78 = appLinkList78[appLinkIndex78];
        param66.append('<div><a class="jira-metadata-auth-link" href="#" data-href="', soy.$$escapeHtml(appLinkData78.authorisationUrl), '">', soy.$$escapeHtml(appLinkData78.name), '</a></div>');
      }
    }
    aui.message.hint({content: param66.toString()}, output);
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.renderGroup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-metadata-section ', soy.$$escapeHtml(opt_data.type), '-section"><div class="section-label"><span class="icon"></span><span>', soy.$$escapeHtml(opt_data.headingText), '</span></div><ul class="jira-metadata-list jira-', soy.$$escapeHtml(opt_data.type), '-list" data-jira-metadata-type="', soy.$$escapeHtml(opt_data.type), '.link">');
  var itemList96 = opt_data.items;
  var itemListLen96 = itemList96.length;
  for (var itemIndex96 = 0; itemIndex96 < itemListLen96; itemIndex96++) {
    var itemData96 = itemList96[itemIndex96];
    output.append('<li class="jira-metadata-item"><span class="item-label"><a href="', soy.$$escapeHtml(itemData96.url), '" title="', soy.$$escapeHtml(itemData96.name), '">', soy.$$escapeHtml(itemData96.name), '</a>', (itemData96.status != '') ? '&nbsp;<span class="item-status">(' + soy.$$escapeHtml(itemData96.status) + ')</span>' : '', '</span>', (itemData96.description != '') ? '<span class="item-subtext">' + soy.$$escapeHtml(itemData96.description) + '</span>' : '', '</li>');
  }
  output.append('</ul><ul class="jira-metadata-list" data-jira-metadata-type="', soy.$$escapeHtml(opt_data.type), '.more">');
  var linkList120 = opt_data.links;
  var linkListLen120 = linkList120.length;
  for (var linkIndex120 = 0; linkIndex120 < linkListLen120; linkIndex120++) {
    var linkData120 = linkList120[linkIndex120];
    output.append('<li class="jira-metadata-item"><a href="', soy.$$escapeHtml(linkData120.url), '">', soy.$$escapeHtml(AJS.format("View {0} more in {1}",linkData120.numItems,linkData120.appName)), '</a></li>');
  }
  output.append('</ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.loadingMetadata = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-metadata-dialog"><h2 class="title">', soy.$$escapeHtml("JIRA links"), '</h2><div class="spinner-container"><div class="spinner"></div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.renderJiraErrors = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.errors.length == 1) {
    var error__soy135 = opt_data.errors[0];
    switch (error__soy135.type) {
      case 'ERROR':
        aui.message.error({content: '<p>' + soy.$$escapeHtml("Unable to retrieve all JIRA metadata.") + ' ' + soy.$$escapeHtml(error__soy135.errorMessage) + '</p>'}, output);
        break;
      case 'WARNING':
        aui.message.warning({content: '<p>' + soy.$$escapeHtml("Unable to retrieve all JIRA metadata.") + ' ' + soy.$$escapeHtml(error__soy135.errorMessage) + '</p>'}, output);
        break;
      default:
        aui.message.info({content: '<p>' + soy.$$escapeHtml("Unable to retrieve all JIRA metadata.") + ' ' + soy.$$escapeHtml(error__soy135.errorMessage) + '</p>'}, output);
    }
  } else if (opt_data.errors.length > 1) {
    var param162 = new soy.StringBuilder('<p>', soy.$$escapeHtml("Unable to retrieve all JIRA metadata. The following errors occurred:"), '</p><ul>');
    var errorList166 = opt_data.errors;
    var errorListLen166 = errorList166.length;
    for (var errorIndex166 = 0; errorIndex166 < errorListLen166; errorIndex166++) {
      var errorData166 = errorList166[errorIndex166];
      param162.append('<li>', soy.$$escapeHtml(errorData166.errorMessage), '</li>');
    }
    param162.append('</ul>');
    aui.message.warning({content: param162.toString()}, output);
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Metadata.JIRA.unknownError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-metadata-dialog">');
  aui.message.warning({content: '<p>' + soy.$$escapeHtml("Unable to retrieve JIRA metadata. Could not connect to Confluence") + '</p>'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = '/js/jira-metadata.js' */
AJS.toInit(function(h){var r=false;var m;var j;var p="jira-metadata-dialog";var g=h("#content-metadata-jira");var s;var e="jira-metadata-discovery";var q=AJS.Meta.get("jira-metadata-count");if(q>0){n(q,AJS.Meta.get("jira-metadata-count-incomplete"))}else{if(q==-1){h.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata/aggregate?pageId="+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",cache:false,success:function(t){if(t.count>0){n(t.count,t.incomplete)}}})}}function n(u,t){f(u,t);g.removeClass("hidden");if(b()){m=AJS.InlineDialog(g,p,function(w,v,x){AJS.trigger("analytics",{name:"confluence.jira.metadata.expanded"});if(!j||!r){j=w;x();a(w)}else{x()}return false},{hideDelay:null});g.click(function(){if(h("#"+p).is(":visible")){m.hide()}});h(document).on("click",".jira-metadata-section a",function(w){var v=h(this).closest(".jira-metadata-list").data("jira-metadata-type").toLowerCase();AJS.trigger("analytics",{name:"confluence.jira.metadata.open."+v})})}if(g&&i()){l()}}function f(u,t){if(!t){h("#content-metadata-jira > span").text(u==1?"1 JIRA link":AJS.format("{0} JIRA links",u))}}function b(){return !g.attr("href")}function l(){s=AJS.InlineDialog(g,e,function(u,t,v){u.html(Confluence.Templates.Metadata.JIRA.featureDiscovery());u.find(".showme").on("click",function(){k();s.hide();m.show()});u.find(".close").on("click",function(){k();s.hide()});v()},{noBind:true,closeOthers:false,hideDelay:null});s.show()}function k(){h.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata/discovered",type:"PUT"})}function i(){return !AJS.Meta.get("blueprint-index-popup-key")&&AJS.Meta.get("jira-metadata-show-discovery")}function a(){d();j.html(Confluence.Templates.Metadata.JIRA.loadingMetadata());j.find(".spinner").spin("medium");h.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata?pageId="+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",error:function(t){c();j.html(Confluence.Templates.Metadata.JIRA.unknownError())},success:function(u){c();r=true;f(u.count,false);var v;if(u.count===0&&!(u.unauthorisedAppLinks&&u.unauthorisedAppLinks.length>0)&&u.errors.length==0){AJS.trigger("analytics",{name:"confluence.jira.metadata.error.no-metadata"});v=Confluence.Templates.Metadata.JIRA.nometadata()}else{v=Confluence.Templates.Metadata.JIRA.metadata(u)}var w=j.height();j.html(v);var t=j.height();j.find("#"+p+" > *").not("h2").css("opacity",0).animate({opacity:1},350,"easeInOutQuad");j.css({overflow:"hidden",height:w+"px"}).animate({height:t+"px"},350,"easeInOutQuad",function(){j.css({overflow:"",height:""})});o()},complete:function(){h("#"+p+" .icon-close").click(function(t){t.stopPropagation();h(this).closest(".closable").remove()})}})}function o(){h(".jira-metadata-auth-link").click(function(t){t.preventDefault();AppLinks.authenticateRemoteCredentials(h(this).data("href"),a,function(){})})}function d(){if(j&&j.height()>0){j.css("height",j.height())}}function c(){j&&j.css("height","")}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:blueprint-first-time-tooltip-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/first-time-tooptip.js' */
AJS.bind("sidebar.finished-loading",function(){var a=AJS.Meta.get("blueprint-index-popup-key");AJS.debug("Index key for "+a);if(a){Confluence.Blueprint.showIndexPagePopup(a)}});AJS.toInit(function(a){Confluence.Blueprint.showIndexPagePopup=function(c){var e=function(j){return function(m,k,l){m.html(Confluence.Templates.Blueprints.sidebarIndexPagePopup({indexPageTitle:j.toLowerCase()}));l()}};var b=AJS.$(AJS.$("li.blueprint."+c)[0]);var i=b.text();var h=AJS.$(".icon",b);var g="blueprintIndexSidebarPopup";var d=AJS.InlineDialog(h.is(":visible")?h:AJS.$(".acs-nav-sections .quick-links-section"),g,e(i),{addActiveClass:false,hideDelay:null,noBind:true});AJS.$(document).bind("showLayer",function(j){var k=g+".inline-dialog-check";a("body").unbind("click."+k)});d.show();var f=function(j){AJS.$(document).on("click","#dismiss-index-popup",function(){j.hide();return false})}(d);AJS.bind("quickedit.success",function(){d.hide()})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-from-template-macro.js' */
AJS.toInit(function(b){var a=b(".create-from-template-button");a.each(function(){var d=b(this);if(d.attr("aria-disabled")=="true"){var c={live:true,gravity:"n",title:"data-tooltip",delayIn:250,delayOut:0};d.tooltip(c)}else{d.click(function(){d.addClass("launching-dialog");Confluence.Blueprint.Dialog.launch(d.data());return false})}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/create-from-template-macro.soy' */
// This file was automatically generated from create-from-template-macro.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }
if (typeof Confluence.Templates.Blueprints.CreateFromTemplate == 'undefined') { Confluence.Templates.Blueprints.CreateFromTemplate = {}; }


Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class=\'aui-button create-from-template-button\'', (! opt_data.hasCreatePermission) ? 'aria-disabled=\'true\' data-tooltip="' + soy.$$escapeHtml("Sorry, you don\x27t have permission to create content. Contact your space administrator to request access.") + '"' : '', 'data-space-key=\'', soy.$$escapeHtml(opt_data.spaceKey), '\' href=\'', soy.$$escapeHtml(opt_data.createContentUrl), '\'', (opt_data.title) ? 'data-title=\'' + soy.$$escapeHtml(opt_data.title) + '\'' : '', (opt_data.templateId) ? 'data-template-id=\'' + soy.$$escapeHtml(opt_data.templateId) + '\'' : '', (opt_data.contentBlueprintId) ? 'data-content-blueprint-id=\'' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '\'' : '', '>', soy.$$escapeHtml(opt_data.buttonLabel), '</a>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/tablesorter-date-parser.js' */
(function(A){A(function(){A.tablesorter.addParser({id:"dateAttributeParser",is:function(B,D,C){return A(C).is(".content-report-table-macro .modified")
},format:function(B,D,C,E){return A(C).attr("data-sortable-date")
},type:"numeric"})
})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/soy/content-report-table.soy' */
// This file was automatically generated from content-report-table.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Plugins == 'undefined') { Confluence.Templates.Plugins = {}; }
if (typeof Confluence.Templates.Plugins.ContentReport == 'undefined') { Confluence.Templates.Plugins.ContentReport = {}; }


Confluence.Templates.Plugins.ContentReport.contentReportTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var hasSocialColumn__soy3 = opt_data.showCommentsCount || opt_data.showLikesCount;
  if (opt_data.results.length == 0 && opt_data.blueprintKey) {
    output.append('<div class="blueprint-blank-experience ', soy.$$escapeHtml(opt_data.blueprintKey), '"><div class="content"><h2>', soy.$$escapeHtml(opt_data.blankTitle), '</h2><p>', soy.$$escapeHtml(opt_data.blankDescription), '</p></div>', (opt_data.createButtonLabel) ? '<p><button class="create-from-template-button aui-button aui-button-primary" data-space-key="' + soy.$$escapeHtml(opt_data.dataSpaceKey) + '" data-content-blueprint-id="' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '" href="' + soy.$$escapeHtml(opt_data.createContentUrl) + '" >' + soy.$$escapeHtml(opt_data.createButtonLabel) + '</button></p>' : '', '</div>');
  } else {
    output.append('<table class="aui content-report-table-macro', (hasSocialColumn__soy3) ? ' with-extra-columns' : '', '"', (opt_data.analyticsKey) ? ' data-analytics-key="' + soy.$$escapeHtml(opt_data.analyticsKey) + '"' : '', '><thead><tr><th>', soy.$$escapeHtml("Title"), '</th><th>', soy.$$escapeHtml("Creator"), '</th><th>', soy.$$escapeHtml("Modified"), '</th></tr></thead><tbody>');
    var resultList43 = opt_data.results;
    var resultListLen43 = resultList43.length;
    if (resultListLen43 > 0) {
      for (var resultIndex43 = 0; resultIndex43 < resultListLen43; resultIndex43++) {
        var resultData43 = resultList43[resultIndex43];
        output.append('<tr><td class="title"><a href="', soy.$$escapeHtml(resultData43.urlPath), '">', soy.$$escapeHtml(resultData43.title), '</a></td><td class="creator">');
        Confluence.Templates.User.usernameLink({canView: opt_data.canViewProfiles, username: resultData43.creatorName, fullName: resultData43.creatorFullName, contextPath: opt_data.contextPath}, output);
        output.append('</td><td class="modified" data-sortable-date="', soy.$$escapeHtml(resultData43.sortableDate), '">', soy.$$escapeHtml(resultData43.friendlyModificationDate), '</td>', (hasSocialColumn__soy3) ? '<td class="social">' + ((opt_data.showCommentsCount && resultData43.commentCount != 0) ? '<span class="icon icon-comment"></span> <span class="count">' + soy.$$escapeHtml(resultData43.commentCount) + '</span>' : '') + ((opt_data.showLikesCount && resultData43.likeCount != 0) ? '<span class="icon icon-like"></span> <span class="count">' + soy.$$escapeHtml(resultData43.likeCount) + '</span>' : '') + '</td>' : '', '</tr>');
      }
    } else {
      output.append('<tr><td colspan="3">', soy.$$escapeHtml("No content found."), '</td></tr>');
    }
    output.append('</tbody></table>', (opt_data.searchMoreResultsLinkUrl) ? '<div class="more-results"><a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.searchMoreResultsLinkUrl) + '">' + soy.$$escapeHtml("Find more results") + '</a></div>' : '');
  }
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/content-report-analytics.js' */
AJS.$(function(A){A(".content-report-table-macro").on("click",".title a",function(D){var B=A(D.delegateTarget).data("analytics-key");
if(B){var C="content-report-table-macro.content-click."+B;
AJS.trigger("analytics",{name:C})
}})
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js/external/jquery/jquery-ui-datepicker.js' */
/*
 * jQuery UI Datepicker 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Datepicker
 *
 * Depends:
 *	jquery.ui.core.js
 */
(function( $, undefined ) {

$.extend($.ui, { datepicker: { version: "1.8.11" } });

var PROP_NAME = 'datepicker';
var dpuuid = new Date().getTime();

/* Date picker manager.
   Use the singleton instance of this class, $.date-picker, to interact with the date picker.
   Settings for (groups of) date pickers are maintained in an instance object,
   allowing multiple different settings on the same page. */

function Datepicker() {
	this.debug = false; // Change this to true to start debugging
	this._curInst = null; // The current instance in use
	this._keyEvent = false; // If the last event was a key event
	this._disabledInputs = []; // List of date picker inputs that have been disabled
	this._datepickerShowing = false; // True if the popup picker is showing , false if not
	this._inDialog = false; // True if showing within a "dialog", false if not
	this._mainDivId = 'ui-datepicker-div'; // The ID of the main date-picker division
	this._inlineClass = 'ui-datepicker-inline'; // The name of the inline marker class
	this._appendClass = 'ui-datepicker-append'; // The name of the append marker class
	this._triggerClass = 'ui-datepicker-trigger'; // The name of the trigger marker class
	this._dialogClass = 'ui-datepicker-dialog'; // The name of the dialog marker class
	this._disableClass = 'ui-datepicker-disabled'; // The name of the disabled covering marker class
	this._unselectableClass = 'ui-datepicker-unselectable'; // The name of the unselectable cell marker class
	this._currentClass = 'ui-datepicker-current-day'; // The name of the current day marker class
	this._dayOverClass = 'ui-datepicker-days-cell-over'; // The name of the day hover marker class
	this.regional = []; // Available regional settings, indexed by language code
	this.regional[''] = { // Default regional settings
		closeText: 'Done', // Display text for close link
		prevText: 'Prev', // Display text for previous month link
		nextText: 'Next', // Display text for next month link
		currentText: 'Today', // Display text for current month link
		monthNames: ['January','February','March','April','May','June',
			'July','August','September','October','November','December'], // Names of months for drop-down and formatting
		monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], // For formatting
		dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'], // For formatting
		dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], // For formatting
		dayNamesMin: ['Su','Mo','Tu','We','Th','Fr','Sa'], // Column headings for days starting at Sunday
		weekHeader: 'Wk', // Column header for week of the year
		dateFormat: 'mm/dd/yy', // See format options on parseDate
		firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
		isRTL: false, // True if right-to-left language, false if left-to-right
		showMonthAfterYear: false, // True if the year select precedes month, false for month then year
		yearSuffix: '' // Additional text to append to the year in the month headers
	};
	this._defaults = { // Global defaults for all the date picker instances
		showOn: 'focus', // 'focus' for popup on focus,
			// 'button' for trigger button, or 'both' for either
		showAnim: 'fadeIn', // Name of jQuery animation for popup
		showOptions: {}, // Options for enhanced animations
		defaultDate: null, // Used when field is blank: actual date,
			// +/-number for offset from today, null for today
		appendText: '', // Display text following the input box, e.g. showing the format
		buttonText: '...', // Text for trigger button
		buttonImage: '', // URL for trigger button image
		buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
		hideIfNoPrevNext: false, // True to hide next/previous month links
			// if not applicable, false to just disable them
		navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
		gotoCurrent: false, // True if today link goes back to current selection instead
		changeMonth: false, // True if month can be selected directly, false if only prev/next
		changeYear: false, // True if year can be selected directly, false if only prev/next
		yearRange: 'c-10:c+10', // Range of years to display in drop-down,
			// either relative to today's year (-nn:+nn), relative to currently displayed year
			// (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
		showOtherMonths: false, // True to show dates in other months, false to leave blank
		selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
		showWeek: false, // True to show week of the year, false to not show it
		calculateWeek: this.iso8601Week, // How to calculate the week of the year,
			// takes a Date and returns the number of the week for it
		shortYearCutoff: '+10', // Short year values < this are in the current century,
			// > this are in the previous century,
			// string value starting with '+' for current year + value
		minDate: null, // The earliest selectable date, or null for no limit
		maxDate: null, // The latest selectable date, or null for no limit
		duration: 'fast', // Duration of display/closure
		beforeShowDay: null, // Function that takes a date and returns an array with
			// [0] = true if selectable, false if not, [1] = custom CSS class name(s) or '',
			// [2] = cell title (optional), e.g. $.date-picker.noWeekends
		beforeShow: null, // Function that takes an input field and
			// returns a set of custom settings for the date picker
		onSelect: null, // Define a callback function when a date is selected
		onChangeMonthYear: null, // Define a callback function when the month or year is changed
		onClose: null, // Define a callback function when the date-picker is closed
		numberOfMonths: 1, // Number of months to show at a time
		showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
		stepMonths: 1, // Number of months to step back/forward
		stepBigMonths: 12, // Number of months to step back/forward for the big links
		altField: '', // Selector for an alternate field to store selected dates into
		altFormat: '', // The date format to use for the alternate field
		constrainInput: true, // The input is constrained by the current date format
		showButtonPanel: false, // True to show button panel, false to not show it
		autoSize: false // True to size the input for the date format, false to leave as is
	};
	$.extend(this._defaults, this.regional['']);
	this.dpDiv = $('<div id="' + this._mainDivId + '" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>');
}

$.extend(Datepicker.prototype, {
	/* Class name added to elements to indicate already configured with a date picker. */
	markerClassName: 'hasDatepicker',

	/* Debug logging (if enabled). */
	log: function () {
		if (this.debug)
			console.log.apply('', arguments);
	},
	
	// TODO rename to "widget" when switching to widget factory
	_widgetDatepicker: function() {
		return this.dpDiv;
	},

	/* Override the default settings for all instances of the date picker.
	   @param  settings  object - the new settings to use as defaults (anonymous object)
	   @return the manager object */
	setDefaults: function(settings) {
		extendRemove(this._defaults, settings || {});
		return this;
	},

	/* Attach the date picker to a jQuery selection.
	   @param  target    element - the target input field or division or span
	   @param  settings  object - the new settings to use for this date picker instance (anonymous) */
	_attachDatepicker: function(target, settings) {
		// check for settings on the control itself - in namespace 'date:'
		var inlineSettings = null;
		for (var attrName in this._defaults) {
			var attrValue = target.getAttribute('date:' + attrName);
			if (attrValue) {
				inlineSettings = inlineSettings || {};
				try {
					inlineSettings[attrName] = eval(attrValue);
				} catch (err) {
					inlineSettings[attrName] = attrValue;
				}
			}
		}
		var nodeName = target.nodeName.toLowerCase();
		var inline = (nodeName == 'div' || nodeName == 'span');
		if (!target.id) {
			this.uuid += 1;
			target.id = 'dp' + this.uuid;
		}
		var inst = this._newInst($(target), inline);
		inst.settings = $.extend({}, settings || {}, inlineSettings || {});
		if (nodeName == 'input') {
			this._connectDatepicker(target, inst);
		} else if (inline) {
			this._inlineDatepicker(target, inst);
		}
	},

	/* Create a new instance object. */
	_newInst: function(target, inline) {
		var id = target[0].id.replace(/([^A-Za-z0-9_-])/g, '\\\\$1'); // escape jQuery meta chars
		return {id: id, input: target, // associated target
			selectedDay: 0, selectedMonth: 0, selectedYear: 0, // current selection
			drawMonth: 0, drawYear: 0, // month being drawn
			inline: inline, // is date-picker inline or not
			dpDiv: (!inline ? this.dpDiv : // presentation div
			$('<div class="' + this._inlineClass + ' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))};
	},

	/* Attach the date picker to an input field. */
	_connectDatepicker: function(target, inst) {
		var input = $(target);
		inst.append = $([]);
		inst.trigger = $([]);
		if (input.hasClass(this.markerClassName))
			return;
		this._attachments(input, inst);
		input.addClass(this.markerClassName).keydown(this._doKeyDown).
			keypress(this._doKeyPress).keyup(this._doKeyUp).
			bind("setData.datepicker", function(event, key, value) {
				inst.settings[key] = value;
			}).bind("getData.datepicker", function(event, key) {
				return this._get(inst, key);
			});
		this._autoSize(inst);
		$.data(target, PROP_NAME, inst);
	},

	/* Make attachments based on settings. */
	_attachments: function(input, inst) {
		var appendText = this._get(inst, 'appendText');
		var isRTL = this._get(inst, 'isRTL');
		if (inst.append)
			inst.append.remove();
		if (appendText) {
			inst.append = $('<span class="' + this._appendClass + '">' + appendText + '</span>');
			input[isRTL ? 'before' : 'after'](inst.append);
		}
		input.unbind('focus', this._showDatepicker);
		if (inst.trigger)
			inst.trigger.remove();
		var showOn = this._get(inst, 'showOn');
		if (showOn == 'focus' || showOn == 'both') // pop-up date picker when in the marked field
			input.focus(this._showDatepicker);
		if (showOn == 'button' || showOn == 'both') { // pop-up date picker when button clicked
			var buttonText = this._get(inst, 'buttonText');
			var buttonImage = this._get(inst, 'buttonImage');
			inst.trigger = $(this._get(inst, 'buttonImageOnly') ?
				$('<img/>').addClass(this._triggerClass).
					attr({ src: buttonImage, alt: buttonText, title: buttonText }) :
				$('<button type="button"></button>').addClass(this._triggerClass).
					html(buttonImage == '' ? buttonText : $('<img/>').attr(
					{ src:buttonImage, alt:buttonText, title:buttonText })));
			input[isRTL ? 'before' : 'after'](inst.trigger);
			inst.trigger.click(function() {
				if ($.datepicker._datepickerShowing && $.datepicker._lastInput == input[0])
					$.datepicker._hideDatepicker();
				else
					$.datepicker._showDatepicker(input[0]);
				return false;
			});
		}
	},

	/* Apply the maximum length for the date format. */
	_autoSize: function(inst) {
		if (this._get(inst, 'autoSize') && !inst.inline) {
			var date = new Date(2009, 12 - 1, 20); // Ensure double digits
			var dateFormat = this._get(inst, 'dateFormat');
			if (dateFormat.match(/[DM]/)) {
				var findMax = function(names) {
					var max = 0;
					var maxI = 0;
					for (var i = 0; i < names.length; i++) {
						if (names[i].length > max) {
							max = names[i].length;
							maxI = i;
						}
					}
					return maxI;
				};
				date.setMonth(findMax(this._get(inst, (dateFormat.match(/MM/) ?
					'monthNames' : 'monthNamesShort'))));
				date.setDate(findMax(this._get(inst, (dateFormat.match(/DD/) ?
					'dayNames' : 'dayNamesShort'))) + 20 - date.getDay());
			}
			inst.input.attr('size', this._formatDate(inst, date).length);
		}
	},

	/* Attach an inline date picker to a div. */
	_inlineDatepicker: function(target, inst) {
		var divSpan = $(target);
		if (divSpan.hasClass(this.markerClassName))
			return;
		divSpan.addClass(this.markerClassName).append(inst.dpDiv).
			bind("setData.datepicker", function(event, key, value){
				inst.settings[key] = value;
			}).bind("getData.datepicker", function(event, key){
				return this._get(inst, key);
			});
		$.data(target, PROP_NAME, inst);
		this._setDate(inst, this._getDefaultDate(inst), true);
		this._updateDatepicker(inst);
		this._updateAlternate(inst);
		inst.dpDiv.show();
	},

	/* Pop-up the date picker in a "dialog" box.
	   @param  input     element - ignored
	   @param  date      string or Date - the initial date to display
	   @param  onSelect  function - the function to call when a date is selected
	   @param  settings  object - update the dialog date picker instance's settings (anonymous object)
	   @param  pos       int[2] - coordinates for the dialog's position within the screen or
	                     event - with x/y coordinates or
	                     leave empty for default (screen centre)
	   @return the manager object */
	_dialogDatepicker: function(input, date, onSelect, settings, pos) {
		var inst = this._dialogInst; // internal instance
		if (!inst) {
			this.uuid += 1;
			var id = 'dp' + this.uuid;
			this._dialogInput = $('<input type="text" id="' + id +
				'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');
			this._dialogInput.keydown(this._doKeyDown);
			$('body').append(this._dialogInput);
			inst = this._dialogInst = this._newInst(this._dialogInput, false);
			inst.settings = {};
			$.data(this._dialogInput[0], PROP_NAME, inst);
		}
		extendRemove(inst.settings, settings || {});
		date = (date && date.constructor == Date ? this._formatDate(inst, date) : date);
		this._dialogInput.val(date);

		this._pos = (pos ? (pos.length ? pos : [pos.pageX, pos.pageY]) : null);
		if (!this._pos) {
			var browserWidth = document.documentElement.clientWidth;
			var browserHeight = document.documentElement.clientHeight;
			var scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
			var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
			this._pos = // should use actual width/height below
				[(browserWidth / 2) - 100 + scrollX, (browserHeight / 2) - 150 + scrollY];
		}

		// move input on screen for focus, but hidden behind dialog
		this._dialogInput.css('left', (this._pos[0] + 20) + 'px').css('top', this._pos[1] + 'px');
		inst.settings.onSelect = onSelect;
		this._inDialog = true;
		this.dpDiv.addClass(this._dialogClass);
		this._showDatepicker(this._dialogInput[0]);
		if ($.blockUI)
			$.blockUI(this.dpDiv);
		$.data(this._dialogInput[0], PROP_NAME, inst);
		return this;
	},

	/* Detach a date-picker from its control.
	   @param  target    element - the target input field or division or span */
	_destroyDatepicker: function(target) {
		var $target = $(target);
		var inst = $.data(target, PROP_NAME);
		if (!$target.hasClass(this.markerClassName)) {
			return;
		}
		var nodeName = target.nodeName.toLowerCase();
		$.removeData(target, PROP_NAME);
		if (nodeName == 'input') {
			inst.append.remove();
			inst.trigger.remove();
			$target.removeClass(this.markerClassName).
				unbind('focus', this._showDatepicker).
				unbind('keydown', this._doKeyDown).
				unbind('keypress', this._doKeyPress).
				unbind('keyup', this._doKeyUp);
		} else if (nodeName == 'div' || nodeName == 'span')
			$target.removeClass(this.markerClassName).empty();
	},

	/* Enable the date picker to a jQuery selection.
	   @param  target    element - the target input field or division or span */
	_enableDatepicker: function(target) {
		var $target = $(target);
		var inst = $.data(target, PROP_NAME);
		if (!$target.hasClass(this.markerClassName)) {
			return;
		}
		var nodeName = target.nodeName.toLowerCase();
		if (nodeName == 'input') {
			target.disabled = false;
			inst.trigger.filter('button').
				each(function() { this.disabled = false; }).end().
				filter('img').css({opacity: '1.0', cursor: ''});
		}
		else if (nodeName == 'div' || nodeName == 'span') {
			var inline = $target.children('.' + this._inlineClass);
			inline.children().removeClass('ui-state-disabled');
		}
		this._disabledInputs = $.map(this._disabledInputs,
			function(value) { return (value == target ? null : value); }); // delete entry
	},

	/* Disable the date picker to a jQuery selection.
	   @param  target    element - the target input field or division or span */
	_disableDatepicker: function(target) {
		var $target = $(target);
		var inst = $.data(target, PROP_NAME);
		if (!$target.hasClass(this.markerClassName)) {
			return;
		}
		var nodeName = target.nodeName.toLowerCase();
		if (nodeName == 'input') {
			target.disabled = true;
			inst.trigger.filter('button').
				each(function() { this.disabled = true; }).end().
				filter('img').css({opacity: '0.5', cursor: 'default'});
		}
		else if (nodeName == 'div' || nodeName == 'span') {
			var inline = $target.children('.' + this._inlineClass);
			inline.children().addClass('ui-state-disabled');
		}
		this._disabledInputs = $.map(this._disabledInputs,
			function(value) { return (value == target ? null : value); }); // delete entry
		this._disabledInputs[this._disabledInputs.length] = target;
	},

	/* Is the first field in a jQuery collection disabled as a date-picker?
	   @param  target    element - the target input field or division or span
	   @return boolean - true if disabled, false if enabled */
	_isDisabledDatepicker: function(target) {
		if (!target) {
			return false;
		}
		for (var i = 0; i < this._disabledInputs.length; i++) {
			if (this._disabledInputs[i] == target)
				return true;
		}
		return false;
	},

	/* Retrieve the instance data for the target control.
	   @param  target  element - the target input field or division or span
	   @return  object - the associated instance data
	   @throws  error if a jQuery problem getting data */
	_getInst: function(target) {
		try {
			return $.data(target, PROP_NAME);
		}
		catch (err) {
			throw 'Missing instance data for this datepicker';
		}
	},

	/* Update or retrieve the settings for a date picker attached to an input field or division.
	   @param  target  element - the target input field or division or span
	   @param  name    object - the new settings to update or
	                   string - the name of the setting to change or retrieve,
	                   when retrieving also 'all' for all instance settings or
	                   'defaults' for all global defaults
	   @param  value   any - the new value for the setting
	                   (omit if above is an object or to retrieve a value) */
	_optionDatepicker: function(target, name, value) {
		var inst = this._getInst(target);
		if (arguments.length == 2 && typeof name == 'string') {
			return (name == 'defaults' ? $.extend({}, $.datepicker._defaults) :
				(inst ? (name == 'all' ? $.extend({}, inst.settings) :
				this._get(inst, name)) : null));
		}
		var settings = name || {};
		if (typeof name == 'string') {
			settings = {};
			settings[name] = value;
		}
		if (inst) {
			if (this._curInst == inst) {
				this._hideDatepicker();
			}
			var date = this._getDateDatepicker(target, true);
			var minDate = this._getMinMaxDate(inst, 'min');
			var maxDate = this._getMinMaxDate(inst, 'max');
			extendRemove(inst.settings, settings);
			// reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
			if (minDate !== null && settings['dateFormat'] !== undefined && settings['minDate'] === undefined)
				inst.settings.minDate = this._formatDate(inst, minDate);
			if (maxDate !== null && settings['dateFormat'] !== undefined && settings['maxDate'] === undefined)
				inst.settings.maxDate = this._formatDate(inst, maxDate);
			this._attachments($(target), inst);
			this._autoSize(inst);
			this._setDateDatepicker(target, date);
			this._updateDatepicker(inst);
		}
	},

	// change method deprecated
	_changeDatepicker: function(target, name, value) {
		this._optionDatepicker(target, name, value);
	},

	/* Redraw the date picker attached to an input field or division.
	   @param  target  element - the target input field or division or span */
	_refreshDatepicker: function(target) {
		var inst = this._getInst(target);
		if (inst) {
			this._updateDatepicker(inst);
		}
	},

	/* Set the dates for a jQuery selection.
	   @param  target   element - the target input field or division or span
	   @param  date     Date - the new date */
	_setDateDatepicker: function(target, date) {
		var inst = this._getInst(target);
		if (inst) {
			this._setDate(inst, date);
			this._updateDatepicker(inst);
			this._updateAlternate(inst);
		}
	},

	/* Get the date(s) for the first entry in a jQuery selection.
	   @param  target     element - the target input field or division or span
	   @param  noDefault  boolean - true if no default date is to be used
	   @return Date - the current date */
	_getDateDatepicker: function(target, noDefault) {
		var inst = this._getInst(target);
		if (inst && !inst.inline)
			this._setDateFromField(inst, noDefault);
		return (inst ? this._getDate(inst) : null);
	},

	/* Handle keystrokes. */
	_doKeyDown: function(event) {
		var inst = $.datepicker._getInst(event.target);
		var handled = true;
		var isRTL = inst.dpDiv.is('.ui-datepicker-rtl');
		inst._keyEvent = true;
		if ($.datepicker._datepickerShowing)
			switch (event.keyCode) {
				case 9: $.datepicker._hideDatepicker();
						handled = false;
						break; // hide on tab out
				case 13: var sel = $('td.' + $.datepicker._dayOverClass + ':not(.' + 
									$.datepicker._currentClass + ')', inst.dpDiv);
						if (sel[0])
							$.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);
						else
							$.datepicker._hideDatepicker();
						return false; // don't submit the form
						break; // select the value on enter
				case 27: $.datepicker._hideDatepicker();
						break; // hide on escape
				case 33: $.datepicker._adjustDate(event.target, (event.ctrlKey ?
							-$.datepicker._get(inst, 'stepBigMonths') :
							-$.datepicker._get(inst, 'stepMonths')), 'M');
						break; // previous month/year on page up/+ ctrl
				case 34: $.datepicker._adjustDate(event.target, (event.ctrlKey ?
							+$.datepicker._get(inst, 'stepBigMonths') :
							+$.datepicker._get(inst, 'stepMonths')), 'M');
						break; // next month/year on page down/+ ctrl
				case 35: if (event.ctrlKey || event.metaKey) $.datepicker._clearDate(event.target);
						handled = event.ctrlKey || event.metaKey;
						break; // clear on ctrl or command +end
				case 36: if (event.ctrlKey || event.metaKey) $.datepicker._gotoToday(event.target);
						handled = event.ctrlKey || event.metaKey;
						break; // current on ctrl or command +home
				case 37: if (event.ctrlKey || event.metaKey) $.datepicker._adjustDate(event.target, (isRTL ? +1 : -1), 'D');
						handled = event.ctrlKey || event.metaKey;
						// -1 day on ctrl or command +left
						if (event.originalEvent.altKey) $.datepicker._adjustDate(event.target, (event.ctrlKey ?
									-$.datepicker._get(inst, 'stepBigMonths') :
									-$.datepicker._get(inst, 'stepMonths')), 'M');
						// next month/year on alt +left on Mac
						break;
				case 38: if (event.ctrlKey || event.metaKey) $.datepicker._adjustDate(event.target, -7, 'D');
						handled = event.ctrlKey || event.metaKey;
						break; // -1 week on ctrl or command +up
				case 39: if (event.ctrlKey || event.metaKey) $.datepicker._adjustDate(event.target, (isRTL ? -1 : +1), 'D');
						handled = event.ctrlKey || event.metaKey;
						// +1 day on ctrl or command +right
						if (event.originalEvent.altKey) $.datepicker._adjustDate(event.target, (event.ctrlKey ?
									+$.datepicker._get(inst, 'stepBigMonths') :
									+$.datepicker._get(inst, 'stepMonths')), 'M');
						// next month/year on alt +right
						break;
				case 40: if (event.ctrlKey || event.metaKey) $.datepicker._adjustDate(event.target, +7, 'D');
						handled = event.ctrlKey || event.metaKey;
						break; // +1 week on ctrl or command +down
				default: handled = false;
			}
		else if (event.keyCode == 36 && event.ctrlKey) // display the date picker on ctrl+home
			$.datepicker._showDatepicker(this);
		else {
			handled = false;
		}
		if (handled) {
			event.preventDefault();
			event.stopPropagation();
		}
	},

	/* Filter entered characters - based on date format. */
	_doKeyPress: function(event) {
		var inst = $.datepicker._getInst(event.target);
		if ($.datepicker._get(inst, 'constrainInput')) {
			var chars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat'));
			var chr = String.fromCharCode(event.charCode == undefined ? event.keyCode : event.charCode);
			return event.ctrlKey || event.metaKey || (chr < ' ' || !chars || chars.indexOf(chr) > -1);
		}
	},

	/* Synchronise manual entry and field/alternate field. */
	_doKeyUp: function(event) {
		var inst = $.datepicker._getInst(event.target);
		if (inst.input.val() != inst.lastVal) {
			try {
				var date = $.datepicker.parseDate($.datepicker._get(inst, 'dateFormat'),
					(inst.input ? inst.input.val() : null),
					$.datepicker._getFormatConfig(inst));
				if (date) { // only if valid
					$.datepicker._setDateFromField(inst);
					$.datepicker._updateAlternate(inst);
					$.datepicker._updateDatepicker(inst);
				}
			}
			catch (event) {
				$.datepicker.log(event);
			}
		}
		return true;
	},

	/* Pop-up the date picker for a given input field.
	   @param  input  element - the input field attached to the date picker or
	                  event - if triggered by focus */
	_showDatepicker: function(input) {
		input = input.target || input;
		if (input.nodeName.toLowerCase() != 'input') // find from button/image trigger
			input = $('input', input.parentNode)[0];
		if ($.datepicker._isDisabledDatepicker(input) || $.datepicker._lastInput == input) // already here
			return;
		var inst = $.datepicker._getInst(input);
		if ($.datepicker._curInst && $.datepicker._curInst != inst) {
			$.datepicker._curInst.dpDiv.stop(true, true);
		}
		var beforeShow = $.datepicker._get(inst, 'beforeShow');
		extendRemove(inst.settings, (beforeShow ? beforeShow.apply(input, [input, inst]) : {}));
		inst.lastVal = null;
		$.datepicker._lastInput = input;
		$.datepicker._setDateFromField(inst);
		if ($.datepicker._inDialog) // hide cursor
			input.value = '';
		if (!$.datepicker._pos) { // position below input
			$.datepicker._pos = $.datepicker._findPos(input);
			$.datepicker._pos[1] += input.offsetHeight; // add the height
		}
		var isFixed = false;
		$(input).parents().each(function() {
			isFixed |= $(this).css('position') == 'fixed';
			return !isFixed;
		});
		if (isFixed && $.browser.opera) { // correction for Opera when fixed and scrolled
			$.datepicker._pos[0] -= document.documentElement.scrollLeft;
			$.datepicker._pos[1] -= document.documentElement.scrollTop;
		}
		var offset = {left: $.datepicker._pos[0], top: $.datepicker._pos[1]};
		$.datepicker._pos = null;
		//to avoid flashes on Firefox
		inst.dpDiv.empty();
		// determine sizing offscreen
		inst.dpDiv.css({position: 'absolute', display: 'block', top: '-1000px'});
		$.datepicker._updateDatepicker(inst);
		// fix width for dynamic number of date pickers
		// and adjust position before showing
		offset = $.datepicker._checkOffset(inst, offset, isFixed);
		inst.dpDiv.css({position: ($.datepicker._inDialog && $.blockUI ?
			'static' : (isFixed ? 'fixed' : 'absolute')), display: 'none',
			left: offset.left + 'px', top: offset.top + 'px'});
		if (!inst.inline) {
			var showAnim = $.datepicker._get(inst, 'showAnim');
			var duration = $.datepicker._get(inst, 'duration');
			var postProcess = function() {
				$.datepicker._datepickerShowing = true;
				var cover = inst.dpDiv.find('iframe.ui-datepicker-cover'); // IE6- only
				if( !! cover.length ){
					var borders = $.datepicker._getBorders(inst.dpDiv);
					cover.css({left: -borders[0], top: -borders[1],
						width: inst.dpDiv.outerWidth(), height: inst.dpDiv.outerHeight()});
				}
			};
			inst.dpDiv.zIndex($(input).zIndex()+1);
			if ($.effects && $.effects[showAnim])
				inst.dpDiv.show(showAnim, $.datepicker._get(inst, 'showOptions'), duration, postProcess);
			else
				inst.dpDiv[showAnim || 'show']((showAnim ? duration : null), postProcess);
			if (!showAnim || !duration)
				postProcess();
			if (inst.input.is(':visible') && !inst.input.is(':disabled'))
				inst.input.focus();
			$.datepicker._curInst = inst;
		}
	},

	/* Generate the date picker content. */
	_updateDatepicker: function(inst) {
		var self = this;
		var borders = $.datepicker._getBorders(inst.dpDiv);
		inst.dpDiv.empty().append(this._generateHTML(inst));
		var cover = inst.dpDiv.find('iframe.ui-datepicker-cover'); // IE6- only
		if( !!cover.length ){ //avoid call to outerXXXX() when not in IE6
			cover.css({left: -borders[0], top: -borders[1], width: inst.dpDiv.outerWidth(), height: inst.dpDiv.outerHeight()})
		}
		inst.dpDiv.find('button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a')
				.bind('mouseout', function(){
					$(this).removeClass('ui-state-hover');
					if(this.className.indexOf('ui-datepicker-prev') != -1) $(this).removeClass('ui-datepicker-prev-hover');
					if(this.className.indexOf('ui-datepicker-next') != -1) $(this).removeClass('ui-datepicker-next-hover');
				})
				.bind('mouseover', function(){
					if (!self._isDisabledDatepicker( inst.inline ? inst.dpDiv.parent()[0] : inst.input[0])) {
						$(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');
						$(this).addClass('ui-state-hover');
						if(this.className.indexOf('ui-datepicker-prev') != -1) $(this).addClass('ui-datepicker-prev-hover');
						if(this.className.indexOf('ui-datepicker-next') != -1) $(this).addClass('ui-datepicker-next-hover');
					}
				})
			.end()
			.find('.' + this._dayOverClass + ' a')
				.trigger('mouseover')
			.end();
		var numMonths = this._getNumberOfMonths(inst);
		var cols = numMonths[1];
		var width = 17;
		if (cols > 1)
			inst.dpDiv.addClass('ui-datepicker-multi-' + cols).css('width', (width * cols) + 'em');
		else
			inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');
		inst.dpDiv[(numMonths[0] != 1 || numMonths[1] != 1 ? 'add' : 'remove') +
			'Class']('ui-datepicker-multi');
		inst.dpDiv[(this._get(inst, 'isRTL') ? 'add' : 'remove') +
			'Class']('ui-datepicker-rtl');
		if (inst == $.datepicker._curInst && $.datepicker._datepickerShowing && inst.input &&
				// #6694 - don't focus the input if it's already focused
				// this breaks the change event in IE
				inst.input.is(':visible') && !inst.input.is(':disabled') && inst.input[0] != document.activeElement)
			inst.input.focus();
		// deffered render of the years select (to avoid flashes on Firefox) 
		if( inst.yearshtml ){
			var origyearshtml = inst.yearshtml;
			setTimeout(function(){
				//assure that inst.yearshtml didn't change.
				if( origyearshtml === inst.yearshtml ){
					inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);
				}
				origyearshtml = inst.yearshtml = null;
			}, 0);
		}
	},

	/* Retrieve the size of left and top borders for an element.
	   @param  elem  (jQuery object) the element of interest
	   @return  (number[2]) the left and top borders */
	_getBorders: function(elem) {
		var convert = function(value) {
			return {thin: 1, medium: 2, thick: 3}[value] || value;
		};
		return [parseFloat(convert(elem.css('border-left-width'))),
			parseFloat(convert(elem.css('border-top-width')))];
	},

	/* Check positioning to remain on screen. */
	_checkOffset: function(inst, offset, isFixed) {
		var dpWidth = inst.dpDiv.outerWidth();
		var dpHeight = inst.dpDiv.outerHeight();
		var inputWidth = inst.input ? inst.input.outerWidth() : 0;
		var inputHeight = inst.input ? inst.input.outerHeight() : 0;
		var viewWidth = document.documentElement.clientWidth + $(document).scrollLeft();
		var viewHeight = document.documentElement.clientHeight + $(document).scrollTop();

		offset.left -= (this._get(inst, 'isRTL') ? (dpWidth - inputWidth) : 0);
		offset.left -= (isFixed && offset.left == inst.input.offset().left) ? $(document).scrollLeft() : 0;
		offset.top -= (isFixed && offset.top == (inst.input.offset().top + inputHeight)) ? $(document).scrollTop() : 0;

		// now check if date-picker is showing outside window viewport - move to a better place if so.
		offset.left -= Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
			Math.abs(offset.left + dpWidth - viewWidth) : 0);
		offset.top -= Math.min(offset.top, (offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
			Math.abs(dpHeight + inputHeight) : 0);

		return offset;
	},

	/* Find an object's position on the screen. */
	_findPos: function(obj) {
		var inst = this._getInst(obj);
		var isRTL = this._get(inst, 'isRTL');
        while (obj && (obj.type == 'hidden' || obj.nodeType != 1 || $.expr.filters.hidden(obj))) {
            obj = obj[isRTL ? 'previousSibling' : 'nextSibling'];
        }
        var position = $(obj).offset();
	    return [position.left, position.top];
	},

	/* Hide the date picker from view.
	   @param  input  element - the input field attached to the date picker */
	_hideDatepicker: function(input) {
		var inst = this._curInst;
		if (!inst || (input && inst != $.data(input, PROP_NAME)))
			return;
		if (this._datepickerShowing) {
			var showAnim = this._get(inst, 'showAnim');
			var duration = this._get(inst, 'duration');
			var postProcess = function() {
				$.datepicker._tidyDialog(inst);
				this._curInst = null;
			};
			if ($.effects && $.effects[showAnim])
				inst.dpDiv.hide(showAnim, $.datepicker._get(inst, 'showOptions'), duration, postProcess);
			else
				inst.dpDiv[(showAnim == 'slideDown' ? 'slideUp' :
					(showAnim == 'fadeIn' ? 'fadeOut' : 'hide'))]((showAnim ? duration : null), postProcess);
			if (!showAnim)
				postProcess();
			var onClose = this._get(inst, 'onClose');
			if (onClose)
				onClose.apply((inst.input ? inst.input[0] : null),
					[(inst.input ? inst.input.val() : ''), inst]);  // trigger custom callback
			this._datepickerShowing = false;
			this._lastInput = null;
			if (this._inDialog) {
				this._dialogInput.css({ position: 'absolute', left: '0', top: '-100px' });
				if ($.blockUI) {
					$.unblockUI();
					$('body').append(this.dpDiv);
				}
			}
			this._inDialog = false;
		}
	},

	/* Tidy up after a dialog display. */
	_tidyDialog: function(inst) {
		inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');
	},

	/* Close date picker if clicked elsewhere. */
	_checkExternalClick: function(event) {
		if (!$.datepicker._curInst)
			return;
		var $target = $(event.target);
		if ($target[0].id != $.datepicker._mainDivId &&
				$target.parents('#' + $.datepicker._mainDivId).length == 0 &&
				!$target.hasClass($.datepicker.markerClassName) &&
				!$target.hasClass($.datepicker._triggerClass) &&
				$.datepicker._datepickerShowing && !($.datepicker._inDialog && $.blockUI))
			$.datepicker._hideDatepicker();
	},

	/* Adjust one of the date sub-fields. */
	_adjustDate: function(id, offset, period) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		if (this._isDisabledDatepicker(target[0])) {
			return;
		}
		this._adjustInstDate(inst, offset +
			(period == 'M' ? this._get(inst, 'showCurrentAtPos') : 0), // undo positioning
			period);
		this._updateDatepicker(inst);
	},

	/* Action for current link. */
	_gotoToday: function(id) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		if (this._get(inst, 'gotoCurrent') && inst.currentDay) {
			inst.selectedDay = inst.currentDay;
			inst.drawMonth = inst.selectedMonth = inst.currentMonth;
			inst.drawYear = inst.selectedYear = inst.currentYear;
		}
		else {
			var date = new Date();
			inst.selectedDay = date.getDate();
			inst.drawMonth = inst.selectedMonth = date.getMonth();
			inst.drawYear = inst.selectedYear = date.getFullYear();
		}
		this._notifyChange(inst);
		this._adjustDate(target);
	},

	/* Action for selecting a new month/year. */
	_selectMonthYear: function(id, select, period) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		inst._selectingMonthYear = false;
		inst['selected' + (period == 'M' ? 'Month' : 'Year')] =
		inst['draw' + (period == 'M' ? 'Month' : 'Year')] =
			parseInt(select.options[select.selectedIndex].value,10);
		this._notifyChange(inst);
		this._adjustDate(target);
	},

	/* Restore input focus after not changing month/year. */
	_clickMonthYear: function(id) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		if (inst.input && inst._selectingMonthYear) {
			setTimeout(function() {
				inst.input.focus();
			}, 0);
		}
		inst._selectingMonthYear = !inst._selectingMonthYear;
	},

	/* Action for selecting a day. */
	_selectDay: function(id, month, year, td) {
		var target = $(id);
		if ($(td).hasClass(this._unselectableClass) || this._isDisabledDatepicker(target[0])) {
			return;
		}
		var inst = this._getInst(target[0]);
		inst.selectedDay = inst.currentDay = $('a', td).html();
		inst.selectedMonth = inst.currentMonth = month;
		inst.selectedYear = inst.currentYear = year;
		this._selectDate(id, this._formatDate(inst,
			inst.currentDay, inst.currentMonth, inst.currentYear));
	},

	/* Erase the input field and hide the date picker. */
	_clearDate: function(id) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		this._selectDate(target, '');
	},

	/* Update the input field with the selected date. */
	_selectDate: function(id, dateStr) {
		var target = $(id);
		var inst = this._getInst(target[0]);
		dateStr = (dateStr != null ? dateStr : this._formatDate(inst));
		if (inst.input)
			inst.input.val(dateStr);
		this._updateAlternate(inst);
		var onSelect = this._get(inst, 'onSelect');
		if (onSelect)
			onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);  // trigger custom callback
		else if (inst.input)
			inst.input.trigger('change'); // fire the change event
		if (inst.inline)
			this._updateDatepicker(inst);
		else {
			this._hideDatepicker();
			this._lastInput = inst.input[0];
			if (typeof(inst.input[0]) != 'object')
				inst.input.focus(); // restore focus
			this._lastInput = null;
		}
	},

	/* Update any alternate field to synchronise with the main field. */
	_updateAlternate: function(inst) {
		var altField = this._get(inst, 'altField');
		if (altField) { // update alternate field too
			var altFormat = this._get(inst, 'altFormat') || this._get(inst, 'dateFormat');
			var date = this._getDate(inst);
			var dateStr = this.formatDate(altFormat, date, this._getFormatConfig(inst));
			$(altField).each(function() { $(this).val(dateStr); });
		}
	},

	/* Set as beforeShowDay function to prevent selection of weekends.
	   @param  date  Date - the date to customise
	   @return [boolean, string] - is this date selectable?, what is its CSS class? */
	noWeekends: function(date) {
		var day = date.getDay();
		return [(day > 0 && day < 6), ''];
	},

	/* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
	   @param  date  Date - the date to get the week for
	   @return  number - the number of the week within the year that contains this date */
	iso8601Week: function(date) {
		var checkDate = new Date(date.getTime());
		// Find Thursday of this week starting on Monday
		checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));
		var time = checkDate.getTime();
		checkDate.setMonth(0); // Compare with Jan 1
		checkDate.setDate(1);
		return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;
	},

	/* Parse a string value into a date object.
	   See formatDate below for the possible formats.

	   @param  format    string - the expected format of the date
	   @param  value     string - the date in the above format
	   @param  settings  Object - attributes include:
	                     shortYearCutoff  number - the cutoff year for determining the century (optional)
	                     dayNamesShort    string[7] - abbreviated names of the days from Sunday (optional)
	                     dayNames         string[7] - names of the days from Sunday (optional)
	                     monthNamesShort  string[12] - abbreviated names of the months (optional)
	                     monthNames       string[12] - names of the months (optional)
	   @return  Date - the extracted date value or null if value is blank */
	parseDate: function (format, value, settings) {
		if (format == null || value == null)
			throw 'Invalid arguments';
		value = (typeof value == 'object' ? value.toString() : value + '');
		if (value == '')
			return null;
		var shortYearCutoff = (settings ? settings.shortYearCutoff : null) || this._defaults.shortYearCutoff;
		shortYearCutoff = (typeof shortYearCutoff != 'string' ? shortYearCutoff :
				new Date().getFullYear() % 100 + parseInt(shortYearCutoff, 10));
		var dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort;
		var dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames;
		var monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort;
		var monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames;
		var year = -1;
		var month = -1;
		var day = -1;
		var doy = -1;
		var literal = false;
		// Check whether a format character is doubled
		var lookAhead = function(match) {
			var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) == match);
			if (matches)
				iFormat++;
			return matches;
		};
		// Extract a number from the string value
		var getNumber = function(match) {
			var isDoubled = lookAhead(match);
			var size = (match == '@' ? 14 : (match == '!' ? 20 :
				(match == 'y' && isDoubled ? 4 : (match == 'o' ? 3 : 2))));
			var digits = new RegExp('^\\d{1,' + size + '}');
			var num = value.substring(iValue).match(digits);
			if (!num)
				throw 'Missing number at position ' + iValue;
			iValue += num[0].length;
			return parseInt(num[0], 10);
		};
		// Extract a name from the string value and convert to an index
		var getName = function(match, shortNames, longNames) {
			var names = (lookAhead(match) ? longNames : shortNames);
			for (var i = 0; i < names.length; i++) {
				if (value.substr(iValue, names[i].length).toLowerCase() == names[i].toLowerCase()) {
					iValue += names[i].length;
					return i + 1;
				}
			}
			throw 'Unknown name at position ' + iValue;
		};
		// Confirm that a literal character matches the string value
		var checkLiteral = function() {
			if (value.charAt(iValue) != format.charAt(iFormat))
				throw 'Unexpected literal at position ' + iValue;
			iValue++;
		};
		var iValue = 0;
		for (var iFormat = 0; iFormat < format.length; iFormat++) {
			if (literal)
				if (format.charAt(iFormat) == "'" && !lookAhead("'"))
					literal = false;
				else
					checkLiteral();
			else
				switch (format.charAt(iFormat)) {
					case 'd':
						day = getNumber('d');
						break;
					case 'D':
						getName('D', dayNamesShort, dayNames);
						break;
					case 'o':
						doy = getNumber('o');
						break;
					case 'm':
						month = getNumber('m');
						break;
					case 'M':
						month = getName('M', monthNamesShort, monthNames);
						break;
					case 'y':
						year = getNumber('y');
						break;
					case '@':
						var date = new Date(getNumber('@'));
						year = date.getFullYear();
						month = date.getMonth() + 1;
						day = date.getDate();
						break;
					case '!':
						var date = new Date((getNumber('!') - this._ticksTo1970) / 10000);
						year = date.getFullYear();
						month = date.getMonth() + 1;
						day = date.getDate();
						break;
					case "'":
						if (lookAhead("'"))
							checkLiteral();
						else
							literal = true;
						break;
					default:
						checkLiteral();
				}
		}
		if (year == -1)
			year = new Date().getFullYear();
		else if (year < 100)
			year += new Date().getFullYear() - new Date().getFullYear() % 100 +
				(year <= shortYearCutoff ? 0 : -100);
		if (doy > -1) {
			month = 1;
			day = doy;
			do {
				var dim = this._getDaysInMonth(year, month - 1);
				if (day <= dim)
					break;
				month++;
				day -= dim;
			} while (true);
		}
		var date = this._daylightSavingAdjust(new Date(year, month - 1, day));
		if (date.getFullYear() != year || date.getMonth() + 1 != month || date.getDate() != day)
			throw 'Invalid date'; // E.g. 31/02/*
		return date;
	},

	/* Standard date formats. */
	ATOM: 'yy-mm-dd', // RFC 3339 (ISO 8601)
	COOKIE: 'D, dd M yy',
	ISO_8601: 'yy-mm-dd',
	RFC_822: 'D, d M y',
	RFC_850: 'DD, dd-M-y',
	RFC_1036: 'D, d M y',
	RFC_1123: 'D, d M yy',
	RFC_2822: 'D, d M yy',
	RSS: 'D, d M y', // RFC 822
	TICKS: '!',
	TIMESTAMP: '@',
	W3C: 'yy-mm-dd', // ISO 8601

	_ticksTo1970: (((1970 - 1) * 365 + Math.floor(1970 / 4) - Math.floor(1970 / 100) +
		Math.floor(1970 / 400)) * 24 * 60 * 60 * 10000000),

	/* Format a date object into a string value.
	   The format can be combinations of the following:
	   d  - day of month (no leading zero)
	   dd - day of month (two digit)
	   o  - day of year (no leading zeros)
	   oo - day of year (three digit)
	   D  - day name short
	   DD - day name long
	   m  - month of year (no leading zero)
	   mm - month of year (two digit)
	   M  - month name short
	   MM - month name long
	   y  - year (two digit)
	   yy - year (four digit)
	   @ - Unix timestamp (ms since 01/01/1970)
	   ! - Windows ticks (100ns since 01/01/0001)
	   '...' - literal text
	   '' - single quote

	   @param  format    string - the desired format of the date
	   @param  date      Date - the date value to format
	   @param  settings  Object - attributes include:
	                     dayNamesShort    string[7] - abbreviated names of the days from Sunday (optional)
	                     dayNames         string[7] - names of the days from Sunday (optional)
	                     monthNamesShort  string[12] - abbreviated names of the months (optional)
	                     monthNames       string[12] - names of the months (optional)
	   @return  string - the date in the above format */
	formatDate: function (format, date, settings) {
		if (!date)
			return '';
		var dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort;
		var dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames;
		var monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort;
		var monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames;
		// Check whether a format character is doubled
		var lookAhead = function(match) {
			var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) == match);
			if (matches)
				iFormat++;
			return matches;
		};
		// Format a number, with leading zero if necessary
		var formatNumber = function(match, value, len) {
			var num = '' + value;
			if (lookAhead(match))
				while (num.length < len)
					num = '0' + num;
			return num;
		};
		// Format a name, short or long as requested
		var formatName = function(match, value, shortNames, longNames) {
			return (lookAhead(match) ? longNames[value] : shortNames[value]);
		};
		var output = '';
		var literal = false;
		if (date)
			for (var iFormat = 0; iFormat < format.length; iFormat++) {
				if (literal)
					if (format.charAt(iFormat) == "'" && !lookAhead("'"))
						literal = false;
					else
						output += format.charAt(iFormat);
				else
					switch (format.charAt(iFormat)) {
						case 'd':
							output += formatNumber('d', date.getDate(), 2);
							break;
						case 'D':
							output += formatName('D', date.getDay(), dayNamesShort, dayNames);
							break;
						case 'o':
							output += formatNumber('o',
								(date.getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 86400000, 3);
							break;
						case 'm':
							output += formatNumber('m', date.getMonth() + 1, 2);
							break;
						case 'M':
							output += formatName('M', date.getMonth(), monthNamesShort, monthNames);
							break;
						case 'y':
							output += (lookAhead('y') ? date.getFullYear() :
								(date.getYear() % 100 < 10 ? '0' : '') + date.getYear() % 100);
							break;
						case '@':
							output += date.getTime();
							break;
						case '!':
							output += date.getTime() * 10000 + this._ticksTo1970;
							break;
						case "'":
							if (lookAhead("'"))
								output += "'";
							else
								literal = true;
							break;
						default:
							output += format.charAt(iFormat);
					}
			}
		return output;
	},

	/* Extract all possible characters from the date format. */
	_possibleChars: function (format) {
		var chars = '';
		var literal = false;
		// Check whether a format character is doubled
		var lookAhead = function(match) {
			var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) == match);
			if (matches)
				iFormat++;
			return matches;
		};
		for (var iFormat = 0; iFormat < format.length; iFormat++)
			if (literal)
				if (format.charAt(iFormat) == "'" && !lookAhead("'"))
					literal = false;
				else
					chars += format.charAt(iFormat);
			else
				switch (format.charAt(iFormat)) {
					case 'd': case 'm': case 'y': case '@':
						chars += '0123456789';
						break;
					case 'D': case 'M':
						return null; // Accept anything
					case "'":
						if (lookAhead("'"))
							chars += "'";
						else
							literal = true;
						break;
					default:
						chars += format.charAt(iFormat);
				}
		return chars;
	},

	/* Get a setting value, defaulting if necessary. */
	_get: function(inst, name) {
		return inst.settings[name] !== undefined ?
			inst.settings[name] : this._defaults[name];
	},

	/* Parse existing date and initialise date picker. */
	_setDateFromField: function(inst, noDefault) {
		if (inst.input.val() == inst.lastVal) {
			return;
		}
		var dateFormat = this._get(inst, 'dateFormat');
		var dates = inst.lastVal = inst.input ? inst.input.val() : null;
		var date, defaultDate;
		date = defaultDate = this._getDefaultDate(inst);
		var settings = this._getFormatConfig(inst);
		try {
			date = this.parseDate(dateFormat, dates, settings) || defaultDate;
		} catch (event) {
			this.log(event);
			dates = (noDefault ? '' : dates);
		}
		inst.selectedDay = date.getDate();
		inst.drawMonth = inst.selectedMonth = date.getMonth();
		inst.drawYear = inst.selectedYear = date.getFullYear();
		inst.currentDay = (dates ? date.getDate() : 0);
		inst.currentMonth = (dates ? date.getMonth() : 0);
		inst.currentYear = (dates ? date.getFullYear() : 0);
		this._adjustInstDate(inst);
	},

	/* Retrieve the default date shown on opening. */
	_getDefaultDate: function(inst) {
		return this._restrictMinMax(inst,
			this._determineDate(inst, this._get(inst, 'defaultDate'), new Date()));
	},

	/* A date may be specified as an exact value or a relative one. */
	_determineDate: function(inst, date, defaultDate) {
		var offsetNumeric = function(offset) {
			var date = new Date();
			date.setDate(date.getDate() + offset);
			return date;
		};
		var offsetString = function(offset) {
			try {
				return $.datepicker.parseDate($.datepicker._get(inst, 'dateFormat'),
					offset, $.datepicker._getFormatConfig(inst));
			}
			catch (e) {
				// Ignore
			}
			var date = (offset.toLowerCase().match(/^c/) ?
				$.datepicker._getDate(inst) : null) || new Date();
			var year = date.getFullYear();
			var month = date.getMonth();
			var day = date.getDate();
			var pattern = /([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;
			var matches = pattern.exec(offset);
			while (matches) {
				switch (matches[2] || 'd') {
					case 'd' : case 'D' :
						day += parseInt(matches[1],10); break;
					case 'w' : case 'W' :
						day += parseInt(matches[1],10) * 7; break;
					case 'm' : case 'M' :
						month += parseInt(matches[1],10);
						day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
						break;
					case 'y': case 'Y' :
						year += parseInt(matches[1],10);
						day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
						break;
				}
				matches = pattern.exec(offset);
			}
			return new Date(year, month, day);
		};
		var newDate = (date == null || date === '' ? defaultDate : (typeof date == 'string' ? offsetString(date) :
			(typeof date == 'number' ? (isNaN(date) ? defaultDate : offsetNumeric(date)) : new Date(date.getTime()))));
		newDate = (newDate && newDate.toString() == 'Invalid Date' ? defaultDate : newDate);
		if (newDate) {
			newDate.setHours(0);
			newDate.setMinutes(0);
			newDate.setSeconds(0);
			newDate.setMilliseconds(0);
		}
		return this._daylightSavingAdjust(newDate);
	},

	/* Handle switch to/from daylight saving.
	   Hours may be non-zero on daylight saving cut-over:
	   > 12 when midnight changeover, but then cannot generate
	   midnight datetime, so jump to 1AM, otherwise reset.
	   @param  date  (Date) the date to check
	   @return  (Date) the corrected date */
	_daylightSavingAdjust: function(date) {
		if (!date) return null;
		date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
		return date;
	},

	/* Set the date(s) directly. */
	_setDate: function(inst, date, noChange) {
		var clear = !date;
		var origMonth = inst.selectedMonth;
		var origYear = inst.selectedYear;
		var newDate = this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));
		inst.selectedDay = inst.currentDay = newDate.getDate();
		inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
		inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
		if ((origMonth != inst.selectedMonth || origYear != inst.selectedYear) && !noChange)
			this._notifyChange(inst);
		this._adjustInstDate(inst);
		if (inst.input) {
			inst.input.val(clear ? '' : this._formatDate(inst));
		}
	},

	/* Retrieve the date(s) directly. */
	_getDate: function(inst) {
		var startDate = (!inst.currentYear || (inst.input && inst.input.val() == '') ? null :
			this._daylightSavingAdjust(new Date(
			inst.currentYear, inst.currentMonth, inst.currentDay)));
			return startDate;
	},

	/* Generate the HTML for the current state of the date picker. */
	_generateHTML: function(inst) {
		var today = new Date();
		today = this._daylightSavingAdjust(
			new Date(today.getFullYear(), today.getMonth(), today.getDate())); // clear time
		var isRTL = this._get(inst, 'isRTL');
		var showButtonPanel = this._get(inst, 'showButtonPanel');
		var hideIfNoPrevNext = this._get(inst, 'hideIfNoPrevNext');
		var navigationAsDateFormat = this._get(inst, 'navigationAsDateFormat');
		var numMonths = this._getNumberOfMonths(inst);
		var showCurrentAtPos = this._get(inst, 'showCurrentAtPos');
		var stepMonths = this._get(inst, 'stepMonths');
		var isMultiMonth = (numMonths[0] != 1 || numMonths[1] != 1);
		var currentDate = this._daylightSavingAdjust((!inst.currentDay ? new Date(9999, 9, 9) :
			new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));
		var minDate = this._getMinMaxDate(inst, 'min');
		var maxDate = this._getMinMaxDate(inst, 'max');
		var drawMonth = inst.drawMonth - showCurrentAtPos;
		var drawYear = inst.drawYear;
		if (drawMonth < 0) {
			drawMonth += 12;
			drawYear--;
		}
		if (maxDate) {
			var maxDraw = this._daylightSavingAdjust(new Date(maxDate.getFullYear(),
				maxDate.getMonth() - (numMonths[0] * numMonths[1]) + 1, maxDate.getDate()));
			maxDraw = (minDate && maxDraw < minDate ? minDate : maxDraw);
			while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1)) > maxDraw) {
				drawMonth--;
				if (drawMonth < 0) {
					drawMonth = 11;
					drawYear--;
				}
			}
		}
		inst.drawMonth = drawMonth;
		inst.drawYear = drawYear;
		var prevText = this._get(inst, 'prevText');
		prevText = (!navigationAsDateFormat ? prevText : this.formatDate(prevText,
			this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)),
			this._getFormatConfig(inst)));
		var prev = (this._canAdjustMonth(inst, -1, drawYear, drawMonth) ?
			'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_' + dpuuid +
			'.datepicker._adjustDate(\'#' + inst.id + '\', -' + stepMonths + ', \'M\');"' +
			' title="' + prevText + '"><span class="ui-icon ui-icon-circle-triangle-' + ( isRTL ? 'e' : 'w') + '">' + prevText + '</span></a>' :
			(hideIfNoPrevNext ? '' : '<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+ prevText +'"><span class="ui-icon ui-icon-circle-triangle-' + ( isRTL ? 'e' : 'w') + '">' + prevText + '</span></a>'));
		var nextText = this._get(inst, 'nextText');
		nextText = (!navigationAsDateFormat ? nextText : this.formatDate(nextText,
			this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)),
			this._getFormatConfig(inst)));
		var next = (this._canAdjustMonth(inst, +1, drawYear, drawMonth) ?
			'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_' + dpuuid +
			'.datepicker._adjustDate(\'#' + inst.id + '\', +' + stepMonths + ', \'M\');"' +
			' title="' + nextText + '"><span class="ui-icon ui-icon-circle-triangle-' + ( isRTL ? 'w' : 'e') + '">' + nextText + '</span></a>' :
			(hideIfNoPrevNext ? '' : '<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+ nextText + '"><span class="ui-icon ui-icon-circle-triangle-' + ( isRTL ? 'w' : 'e') + '">' + nextText + '</span></a>'));
		var currentText = this._get(inst, 'currentText');
		var gotoDate = (this._get(inst, 'gotoCurrent') && inst.currentDay ? currentDate : today);
		currentText = (!navigationAsDateFormat ? currentText :
			this.formatDate(currentText, gotoDate, this._getFormatConfig(inst)));
		var controls = (!inst.inline ? '<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_' + dpuuid +
			'.datepicker._hideDatepicker();">' + this._get(inst, 'closeText') + '</button>' : '');
		var buttonPanel = (showButtonPanel) ? '<div class="ui-datepicker-buttonpane ui-widget-content">' + (isRTL ? controls : '') +
			(this._isInRange(inst, gotoDate) ? '<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_' + dpuuid +
			'.datepicker._gotoToday(\'#' + inst.id + '\');"' +
			'>' + currentText + '</button>' : '') + (isRTL ? '' : controls) + '</div>' : '';
		var firstDay = parseInt(this._get(inst, 'firstDay'),10);
		firstDay = (isNaN(firstDay) ? 0 : firstDay);
		var showWeek = this._get(inst, 'showWeek');
		var dayNames = this._get(inst, 'dayNames');
		var dayNamesShort = this._get(inst, 'dayNamesShort');
		var dayNamesMin = this._get(inst, 'dayNamesMin');
		var monthNames = this._get(inst, 'monthNames');
		var monthNamesShort = this._get(inst, 'monthNamesShort');
		var beforeShowDay = this._get(inst, 'beforeShowDay');
		var showOtherMonths = this._get(inst, 'showOtherMonths');
		var selectOtherMonths = this._get(inst, 'selectOtherMonths');
		var calculateWeek = this._get(inst, 'calculateWeek') || this.iso8601Week;
		var defaultDate = this._getDefaultDate(inst);
		var html = '';
		for (var row = 0; row < numMonths[0]; row++) {
			var group = '';
			for (var col = 0; col < numMonths[1]; col++) {
				var selectedDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));
				var cornerClass = ' ui-corner-all';
				var calender = '';
				if (isMultiMonth) {
					calender += '<div class="ui-datepicker-group';
					if (numMonths[1] > 1)
						switch (col) {
							case 0: calender += ' ui-datepicker-group-first';
								cornerClass = ' ui-corner-' + (isRTL ? 'right' : 'left'); break;
							case numMonths[1]-1: calender += ' ui-datepicker-group-last';
								cornerClass = ' ui-corner-' + (isRTL ? 'left' : 'right'); break;
							default: calender += ' ui-datepicker-group-middle'; cornerClass = ''; break;
						}
					calender += '">';
				}
				calender += '<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix' + cornerClass + '">' +
					(/all|left/.test(cornerClass) && row == 0 ? (isRTL ? next : prev) : '') +
					(/all|right/.test(cornerClass) && row == 0 ? (isRTL ? prev : next) : '') +
					this._generateMonthYearHeader(inst, drawMonth, drawYear, minDate, maxDate,
					row > 0 || col > 0, monthNames, monthNamesShort) + // draw month headers
					'</div><table class="ui-datepicker-calendar"><thead>' +
					'<tr>';
				var thead = (showWeek ? '<th class="ui-datepicker-week-col">' + this._get(inst, 'weekHeader') + '</th>' : '');
				for (var dow = 0; dow < 7; dow++) { // days of the week
					var day = (dow + firstDay) % 7;
					thead += '<th' + ((dow + firstDay + 6) % 7 >= 5 ? ' class="ui-datepicker-week-end"' : '') + '>' +
						'<span title="' + dayNames[day] + '">' + dayNamesMin[day] + '</span></th>';
				}
				calender += thead + '</tr></thead><tbody>';
				var daysInMonth = this._getDaysInMonth(drawYear, drawMonth);
				if (drawYear == inst.selectedYear && drawMonth == inst.selectedMonth)
					inst.selectedDay = Math.min(inst.selectedDay, daysInMonth);
				var leadDays = (this._getFirstDayOfMonth(drawYear, drawMonth) - firstDay + 7) % 7;
				var numRows = (isMultiMonth ? 6 : Math.ceil((leadDays + daysInMonth) / 7)); // calculate the number of rows to generate
				var printDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));
				for (var dRow = 0; dRow < numRows; dRow++) { // create date picker rows
					calender += '<tr>';
					var tbody = (!showWeek ? '' : '<td class="ui-datepicker-week-col">' +
						this._get(inst, 'calculateWeek')(printDate) + '</td>');
					for (var dow = 0; dow < 7; dow++) { // create date picker days
						var daySettings = (beforeShowDay ?
							beforeShowDay.apply((inst.input ? inst.input[0] : null), [printDate]) : [true, '']);
						var otherMonth = (printDate.getMonth() != drawMonth);
						var unselectable = (otherMonth && !selectOtherMonths) || !daySettings[0] ||
							(minDate && printDate < minDate) || (maxDate && printDate > maxDate);
						tbody += '<td class="' +
							((dow + firstDay + 6) % 7 >= 5 ? ' ui-datepicker-week-end' : '') + // highlight weekends
							(otherMonth ? ' ui-datepicker-other-month' : '') + // highlight days from other months
							((printDate.getTime() == selectedDate.getTime() && drawMonth == inst.selectedMonth && inst._keyEvent) || // user pressed key
							(defaultDate.getTime() == printDate.getTime() && defaultDate.getTime() == selectedDate.getTime()) ?
							// or defaultDate is current printedDate and defaultDate is selectedDate
							' ' + this._dayOverClass : '') + // highlight selected day
							(unselectable ? ' ' + this._unselectableClass + ' ui-state-disabled': '') +  // highlight unselectable days
							(otherMonth && !showOtherMonths ? '' : ' ' + daySettings[1] + // highlight custom dates
							(printDate.getTime() == currentDate.getTime() ? ' ' + this._currentClass : '') + // highlight selected day
							(printDate.getTime() == today.getTime() ? ' ui-datepicker-today' : '')) + '"' + // highlight today (if different)
							((!otherMonth || showOtherMonths) && daySettings[2] ? ' title="' + daySettings[2] + '"' : '') + // cell title
							(unselectable ? '' : ' onclick="DP_jQuery_' + dpuuid + '.datepicker._selectDay(\'#' +
							inst.id + '\',' + printDate.getMonth() + ',' + printDate.getFullYear() + ', this);return false;"') + '>' + // actions
							(otherMonth && !showOtherMonths ? '&#xa0;' : // display for other months
							(unselectable ? '<span class="ui-state-default">' + printDate.getDate() + '</span>' : '<a class="ui-state-default' +
							(printDate.getTime() == today.getTime() ? ' ui-state-highlight' : '') +
							(printDate.getTime() == currentDate.getTime() ? ' ui-state-active' : '') + // highlight selected day
							(otherMonth ? ' ui-priority-secondary' : '') + // distinguish dates from other months
							'" href="#">' + printDate.getDate() + '</a>')) + '</td>'; // display selectable date
						printDate.setDate(printDate.getDate() + 1);
						printDate = this._daylightSavingAdjust(printDate);
					}
					calender += tbody + '</tr>';
				}
				drawMonth++;
				if (drawMonth > 11) {
					drawMonth = 0;
					drawYear++;
				}
				calender += '</tbody></table>' + (isMultiMonth ? '</div>' + 
							((numMonths[0] > 0 && col == numMonths[1]-1) ? '<div class="ui-datepicker-row-break"></div>' : '') : '');
				group += calender;
			}
			html += group;
		}
		html += buttonPanel + ($.browser.msie && parseInt($.browser.version,10) < 7 && !inst.inline ?
			'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>' : '');
		inst._keyEvent = false;
		return html;
	},

	/* Generate the month and year header. */
	_generateMonthYearHeader: function(inst, drawMonth, drawYear, minDate, maxDate,
			secondary, monthNames, monthNamesShort) {
		var changeMonth = this._get(inst, 'changeMonth');
		var changeYear = this._get(inst, 'changeYear');
		var showMonthAfterYear = this._get(inst, 'showMonthAfterYear');
		var html = '<div class="ui-datepicker-title">';
		var monthHtml = '';
		// month selection
		if (secondary || !changeMonth)
			monthHtml += '<span class="ui-datepicker-month">' + monthNames[drawMonth] + '</span>';
		else {
			var inMinYear = (minDate && minDate.getFullYear() == drawYear);
			var inMaxYear = (maxDate && maxDate.getFullYear() == drawYear);
			monthHtml += '<select class="ui-datepicker-month" ' +
				'onchange="DP_jQuery_' + dpuuid + '.datepicker._selectMonthYear(\'#' + inst.id + '\', this, \'M\');" ' +
				'onclick="DP_jQuery_' + dpuuid + '.datepicker._clickMonthYear(\'#' + inst.id + '\');"' +
			 	'>';
			for (var month = 0; month < 12; month++) {
				if ((!inMinYear || month >= minDate.getMonth()) &&
						(!inMaxYear || month <= maxDate.getMonth()))
					monthHtml += '<option value="' + month + '"' +
						(month == drawMonth ? ' selected="selected"' : '') +
						'>' + monthNamesShort[month] + '</option>';
			}
			monthHtml += '</select>';
		}
		if (!showMonthAfterYear)
			html += monthHtml + (secondary || !(changeMonth && changeYear) ? '&#xa0;' : '');
		// year selection
		inst.yearshtml = '';
		if (secondary || !changeYear)
			html += '<span class="ui-datepicker-year">' + drawYear + '</span>';
		else {
			// determine range of years to display
			var years = this._get(inst, 'yearRange').split(':');
			var thisYear = new Date().getFullYear();
			var determineYear = function(value) {
				var year = (value.match(/c[+-].*/) ? drawYear + parseInt(value.substring(1), 10) :
					(value.match(/[+-].*/) ? thisYear + parseInt(value, 10) :
					parseInt(value, 10)));
				return (isNaN(year) ? thisYear : year);
			};
			var year = determineYear(years[0]);
			var endYear = Math.max(year, determineYear(years[1] || ''));
			year = (minDate ? Math.max(year, minDate.getFullYear()) : year);
			endYear = (maxDate ? Math.min(endYear, maxDate.getFullYear()) : endYear);
			inst.yearshtml += '<select class="ui-datepicker-year" ' +
				'onchange="DP_jQuery_' + dpuuid + '.datepicker._selectMonthYear(\'#' + inst.id + '\', this, \'Y\');" ' +
				'onclick="DP_jQuery_' + dpuuid + '.datepicker._clickMonthYear(\'#' + inst.id + '\');"' +
				'>';
			for (; year <= endYear; year++) {
				inst.yearshtml += '<option value="' + year + '"' +
					(year == drawYear ? ' selected="selected"' : '') +
					'>' + year + '</option>';
			}
			inst.yearshtml += '</select>';
			//when showing there is no need for later update
			if( ! $.browser.mozilla ){
				html += inst.yearshtml;
				inst.yearshtml = null;
			} else {
				// will be replaced later with inst.yearshtml
				html += '<select class="ui-datepicker-year"><option value="' + drawYear + '" selected="selected">' + drawYear + '</option></select>';
			}
		}
		html += this._get(inst, 'yearSuffix');
		if (showMonthAfterYear)
			html += (secondary || !(changeMonth && changeYear) ? '&#xa0;' : '') + monthHtml;
		html += '</div>'; // Close datepicker_header
		return html;
	},

	/* Adjust one of the date sub-fields. */
	_adjustInstDate: function(inst, offset, period) {
		var year = inst.drawYear + (period == 'Y' ? offset : 0);
		var month = inst.drawMonth + (period == 'M' ? offset : 0);
		var day = Math.min(inst.selectedDay, this._getDaysInMonth(year, month)) +
			(period == 'D' ? offset : 0);
		var date = this._restrictMinMax(inst,
			this._daylightSavingAdjust(new Date(year, month, day)));
		inst.selectedDay = date.getDate();
		inst.drawMonth = inst.selectedMonth = date.getMonth();
		inst.drawYear = inst.selectedYear = date.getFullYear();
		if (period == 'M' || period == 'Y')
			this._notifyChange(inst);
	},

	/* Ensure a date is within any min/max bounds. */
	_restrictMinMax: function(inst, date) {
		var minDate = this._getMinMaxDate(inst, 'min');
		var maxDate = this._getMinMaxDate(inst, 'max');
		var newDate = (minDate && date < minDate ? minDate : date);
		newDate = (maxDate && newDate > maxDate ? maxDate : newDate);
		return newDate;
	},

	/* Notify change of month/year. */
	_notifyChange: function(inst) {
		var onChange = this._get(inst, 'onChangeMonthYear');
		if (onChange)
			onChange.apply((inst.input ? inst.input[0] : null),
				[inst.selectedYear, inst.selectedMonth + 1, inst]);
	},

	/* Determine the number of months to show. */
	_getNumberOfMonths: function(inst) {
		var numMonths = this._get(inst, 'numberOfMonths');
		return (numMonths == null ? [1, 1] : (typeof numMonths == 'number' ? [1, numMonths] : numMonths));
	},

	/* Determine the current maximum date - ensure no time components are set. */
	_getMinMaxDate: function(inst, minMax) {
		return this._determineDate(inst, this._get(inst, minMax + 'Date'), null);
	},

	/* Find the number of days in a given month. */
	_getDaysInMonth: function(year, month) {
		return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();
	},

	/* Find the day of the week of the first of a month. */
	_getFirstDayOfMonth: function(year, month) {
		return new Date(year, month, 1).getDay();
	},

	/* Determines if we should allow a "next/prev" month display change. */
	_canAdjustMonth: function(inst, offset, curYear, curMonth) {
		var numMonths = this._getNumberOfMonths(inst);
		var date = this._daylightSavingAdjust(new Date(curYear,
			curMonth + (offset < 0 ? offset : numMonths[0] * numMonths[1]), 1));
		if (offset < 0)
			date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));
		return this._isInRange(inst, date);
	},

	/* Is the given date in the accepted range? */
	_isInRange: function(inst, date) {
		var minDate = this._getMinMaxDate(inst, 'min');
		var maxDate = this._getMinMaxDate(inst, 'max');
		return ((!minDate || date.getTime() >= minDate.getTime()) &&
			(!maxDate || date.getTime() <= maxDate.getTime()));
	},

	/* Provide the configuration settings for formatting/parsing. */
	_getFormatConfig: function(inst) {
		var shortYearCutoff = this._get(inst, 'shortYearCutoff');
		shortYearCutoff = (typeof shortYearCutoff != 'string' ? shortYearCutoff :
			new Date().getFullYear() % 100 + parseInt(shortYearCutoff, 10));
		return {shortYearCutoff: shortYearCutoff,
			dayNamesShort: this._get(inst, 'dayNamesShort'), dayNames: this._get(inst, 'dayNames'),
			monthNamesShort: this._get(inst, 'monthNamesShort'), monthNames: this._get(inst, 'monthNames')};
	},

	/* Format the given date for display. */
	_formatDate: function(inst, day, month, year) {
		if (!day) {
			inst.currentDay = inst.selectedDay;
			inst.currentMonth = inst.selectedMonth;
			inst.currentYear = inst.selectedYear;
		}
		var date = (day ? (typeof day == 'object' ? day :
			this._daylightSavingAdjust(new Date(year, month, day))) :
			this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));
		return this.formatDate(this._get(inst, 'dateFormat'), date, this._getFormatConfig(inst));
	}
});

/* jQuery extend now ignores nulls! */
function extendRemove(target, props) {
	$.extend(target, props);
	for (var name in props)
		if (props[name] == null || props[name] == undefined)
			target[name] = props[name];
	return target;
};

/* Determine whether an object is an array. */
function isArray(a) {
	return (a && (($.browser.safari && typeof a == 'object' && a.length) ||
		(a.constructor && a.constructor.toString().match(/\Array\(\)/))));
};

/* Invoke the date-picker functionality.
   @param  options  string - a command, optionally followed by additional parameters or
                    Object - settings for attaching new date-picker functionality
   @return  jQuery object */
$.fn.datepicker = function(options){
	
	/* Verify an empty collection wasn't passed - Fixes #6976 */
	if ( !this.length ) {
		return this;
	}
	
	/* Initialise the date picker. */
	if (!$.datepicker.initialized) {
		$(document).mousedown($.datepicker._checkExternalClick).
			find('body').append($.datepicker.dpDiv);
		$.datepicker.initialized = true;
	}

	var otherArgs = Array.prototype.slice.call(arguments, 1);
	if (typeof options == 'string' && (options == 'isDisabled' || options == 'getDate' || options == 'widget'))
		return $.datepicker['_' + options + 'Datepicker'].
			apply($.datepicker, [this[0]].concat(otherArgs));
	if (options == 'option' && arguments.length == 2 && typeof arguments[1] == 'string')
		return $.datepicker['_' + options + 'Datepicker'].
			apply($.datepicker, [this[0]].concat(otherArgs));
	return this.each(function() {
		typeof options == 'string' ?
			$.datepicker['_' + options + 'Datepicker'].
				apply($.datepicker, [this].concat(otherArgs)) :
			$.datepicker._attachDatepicker(this, options);
	});
};

$.datepicker = new Datepicker(); // singleton instance
$.datepicker.initialized = false;
$.datepicker.uuid = new Date().getTime();
$.datepicker.version = "1.8.11";

// Workaround for #4055
// Add another global to avoid noConflict issues with inline event handlers
window['DP_jQuery_' + dpuuid] = $;

})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.auiplugin:jquery-ui-other', location = 'js/external/jquery/jquery-ui-other.js' */
/**
 * Dependends on jquery-ui.js (handled in resource loading)
 * Atlassian custom download containing:
 * CORE - Position
 * INTERACTIONS - Droppable, Resizable, Selectable
 * WIDGETS + EFFECTS - All modules
 * EXTRAS - unreleased Menu module, version unknown (culprit saved by lost SVN history).
 * http://docs.jquery.com/UI/Menu
 * https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.menu.js
 */
/*
 * jQuery UI Position 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
(function( $, undefined ) {

$.ui = $.ui || {};

var horizontalPositions = /left|center|right/,
	verticalPositions = /top|center|bottom/,
	center = "center",
	_position = $.fn.position,
	_offset = $.fn.offset;

$.fn.position = function( options ) {
	if ( !options || !options.of ) {
		return _position.apply( this, arguments );
	}

	// make a copy, we don't want to modify arguments
	options = $.extend( {}, options );

	var target = $( options.of ),
		targetElem = target[0],
		collision = ( options.collision || "flip" ).split( " " ),
		offset = options.offset ? options.offset.split( " " ) : [ 0, 0 ],
		targetWidth,
		targetHeight,
		basePosition;

	if ( targetElem.nodeType === 9 ) {
		targetWidth = target.width();
		targetHeight = target.height();
		basePosition = { top: 0, left: 0 };
	// TODO: use $.isWindow() in 1.9
	} else if ( targetElem.setTimeout ) {
		targetWidth = target.width();
		targetHeight = target.height();
		basePosition = { top: target.scrollTop(), left: target.scrollLeft() };
	} else if ( targetElem.preventDefault ) {
		// force left top to allow flipping
		options.at = "left top";
		targetWidth = targetHeight = 0;
		basePosition = { top: options.of.pageY, left: options.of.pageX };
	} else {
		targetWidth = target.outerWidth();
		targetHeight = target.outerHeight();
		basePosition = target.offset();
	}

	// force my and at to have valid horizontal and veritcal positions
	// if a value is missing or invalid, it will be converted to center 
	$.each( [ "my", "at" ], function() {
		var pos = ( options[this] || "" ).split( " " );
		if ( pos.length === 1) {
			pos = horizontalPositions.test( pos[0] ) ?
				pos.concat( [center] ) :
				verticalPositions.test( pos[0] ) ?
					[ center ].concat( pos ) :
					[ center, center ];
		}
		pos[ 0 ] = horizontalPositions.test( pos[0] ) ? pos[ 0 ] : center;
		pos[ 1 ] = verticalPositions.test( pos[1] ) ? pos[ 1 ] : center;
		options[ this ] = pos;
	});

	// normalize collision option
	if ( collision.length === 1 ) {
		collision[ 1 ] = collision[ 0 ];
	}

	// normalize offset option
	offset[ 0 ] = parseInt( offset[0], 10 ) || 0;
	if ( offset.length === 1 ) {
		offset[ 1 ] = offset[ 0 ];
	}
	offset[ 1 ] = parseInt( offset[1], 10 ) || 0;

	if ( options.at[0] === "right" ) {
		basePosition.left += targetWidth;
	} else if ( options.at[0] === center ) {
		basePosition.left += targetWidth / 2;
	}

	if ( options.at[1] === "bottom" ) {
		basePosition.top += targetHeight;
	} else if ( options.at[1] === center ) {
		basePosition.top += targetHeight / 2;
	}

	basePosition.left += offset[ 0 ];
	basePosition.top += offset[ 1 ];

	return this.each(function() {
		var elem = $( this ),
			elemWidth = elem.outerWidth(),
			elemHeight = elem.outerHeight(),
			marginLeft = parseInt( $.curCSS( this, "marginLeft", true ) ) || 0,
			marginTop = parseInt( $.curCSS( this, "marginTop", true ) ) || 0,
			collisionWidth = elemWidth + marginLeft +
				( parseInt( $.curCSS( this, "marginRight", true ) ) || 0 ),
			collisionHeight = elemHeight + marginTop +
				( parseInt( $.curCSS( this, "marginBottom", true ) ) || 0 ),
			position = $.extend( {}, basePosition ),
			collisionPosition;

		if ( options.my[0] === "right" ) {
			position.left -= elemWidth;
		} else if ( options.my[0] === center ) {
			position.left -= elemWidth / 2;
		}

		if ( options.my[1] === "bottom" ) {
			position.top -= elemHeight;
		} else if ( options.my[1] === center ) {
			position.top -= elemHeight / 2;
		}

		// prevent fractions (see #5280)
		position.left = Math.round( position.left );
		position.top = Math.round( position.top );

		collisionPosition = {
			left: position.left - marginLeft,
			top: position.top - marginTop
		};

		$.each( [ "left", "top" ], function( i, dir ) {
			if ( $.ui.position[ collision[i] ] ) {
				$.ui.position[ collision[i] ][ dir ]( position, {
					targetWidth: targetWidth,
					targetHeight: targetHeight,
					elemWidth: elemWidth,
					elemHeight: elemHeight,
					collisionPosition: collisionPosition,
					collisionWidth: collisionWidth,
					collisionHeight: collisionHeight,
					offset: offset,
					my: options.my,
					at: options.at
				});
			}
		});

		if ( $.fn.bgiframe ) {
			elem.bgiframe();
		}
		elem.offset( $.extend( position, { using: options.using } ) );
	});
};

$.ui.position = {
	fit: {
		left: function( position, data ) {
			var win = $( window ),
				over = data.collisionPosition.left + data.collisionWidth - win.width() - win.scrollLeft();
			position.left = over > 0 ? position.left - over : Math.max( position.left - data.collisionPosition.left, position.left );
		},
		top: function( position, data ) {
			var win = $( window ),
				over = data.collisionPosition.top + data.collisionHeight - win.height() - win.scrollTop();
			position.top = over > 0 ? position.top - over : Math.max( position.top - data.collisionPosition.top, position.top );
		}
	},

	flip: {
		left: function( position, data ) {
			if ( data.at[0] === center ) {
				return;
			}
			var win = $( window ),
				over = data.collisionPosition.left + data.collisionWidth - win.width() - win.scrollLeft(),
				myOffset = data.my[ 0 ] === "left" ?
					-data.elemWidth :
					data.my[ 0 ] === "right" ?
						data.elemWidth :
						0,
				atOffset = data.at[ 0 ] === "left" ?
					data.targetWidth :
					-data.targetWidth,
				offset = -2 * data.offset[ 0 ];
			position.left += data.collisionPosition.left < 0 ?
				myOffset + atOffset + offset :
				over > 0 ?
					myOffset + atOffset + offset :
					0;
		},
		top: function( position, data ) {
			if ( data.at[1] === center ) {
				return;
			}
			var win = $( window ),
				over = data.collisionPosition.top + data.collisionHeight - win.height() - win.scrollTop(),
				myOffset = data.my[ 1 ] === "top" ?
					-data.elemHeight :
					data.my[ 1 ] === "bottom" ?
						data.elemHeight :
						0,
				atOffset = data.at[ 1 ] === "top" ?
					data.targetHeight :
					-data.targetHeight,
				offset = -2 * data.offset[ 1 ];
			position.top += data.collisionPosition.top < 0 ?
				myOffset + atOffset + offset :
				over > 0 ?
					myOffset + atOffset + offset :
					0;
		}
	}
};

// offset setter from jQuery 1.4
if ( !$.offset.setOffset ) {
	$.offset.setOffset = function( elem, options ) {
		// set position first, in-case top/left are set even on static elem
		if ( /static/.test( $.curCSS( elem, "position" ) ) ) {
			elem.style.position = "relative";
		}
		var curElem   = $( elem ),
			curOffset = curElem.offset(),
			curTop    = parseInt( $.curCSS( elem, "top",  true ), 10 ) || 0,
			curLeft   = parseInt( $.curCSS( elem, "left", true ), 10)  || 0,
			props     = {
				top:  (options.top  - curOffset.top)  + curTop,
				left: (options.left - curOffset.left) + curLeft
			};
		
		if ( 'using' in options ) {
			options.using.call( elem, props );
		} else {
			curElem.css( props );
		}
	};

	$.fn.offset = function( options ) {
		var elem = this[ 0 ];
		if ( !elem || !elem.ownerDocument ) { return null; }
		if ( options ) { 
			return this.each(function() {
				$.offset.setOffset( this, options );
			});
		}
		return _offset.call( this );
	};
}

}( jQuery ));
/*
 * jQuery UI Droppable 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Droppables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.mouse.js
 *	jquery.ui.draggable.js
 */
(function( $, undefined ) {

$.widget("ui.droppable", {
	widgetEventPrefix: "drop",
	options: {
		accept: '*',
		activeClass: false,
		addClasses: true,
		greedy: false,
		hoverClass: false,
		scope: 'default',
		tolerance: 'intersect'
	},
	_create: function() {

		var o = this.options, accept = o.accept;
		this.isover = 0; this.isout = 1;

		this.accept = $.isFunction(accept) ? accept : function(d) {
			return d.is(accept);
		};

		//Store the droppable's proportions
		this.proportions = { width: this.element[0].offsetWidth, height: this.element[0].offsetHeight };

		// Add the reference and positions to the manager
		$.ui.ddmanager.droppables[o.scope] = $.ui.ddmanager.droppables[o.scope] || [];
		$.ui.ddmanager.droppables[o.scope].push(this);

		(o.addClasses && this.element.addClass("ui-droppable"));

	},

	destroy: function() {
		var drop = $.ui.ddmanager.droppables[this.options.scope];
		for ( var i = 0; i < drop.length; i++ )
			if ( drop[i] == this )
				drop.splice(i, 1);

		this.element
			.removeClass("ui-droppable ui-droppable-disabled")
			.removeData("droppable")
			.unbind(".droppable");

		return this;
	},

	_setOption: function(key, value) {

		if(key == 'accept') {
			this.accept = $.isFunction(value) ? value : function(d) {
				return d.is(value);
			};
		}
		$.Widget.prototype._setOption.apply(this, arguments);
	},

	_activate: function(event) {
		var draggable = $.ui.ddmanager.current;
		if(this.options.activeClass) this.element.addClass(this.options.activeClass);
		(draggable && this._trigger('activate', event, this.ui(draggable)));
	},

	_deactivate: function(event) {
		var draggable = $.ui.ddmanager.current;
		if(this.options.activeClass) this.element.removeClass(this.options.activeClass);
		(draggable && this._trigger('deactivate', event, this.ui(draggable)));
	},

	_over: function(event) {

		var draggable = $.ui.ddmanager.current;
		if (!draggable || (draggable.currentItem || draggable.element)[0] == this.element[0]) return; // Bail if draggable and droppable are same element

		if (this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
			if(this.options.hoverClass) this.element.addClass(this.options.hoverClass);
			this._trigger('over', event, this.ui(draggable));
		}

	},

	_out: function(event) {

		var draggable = $.ui.ddmanager.current;
		if (!draggable || (draggable.currentItem || draggable.element)[0] == this.element[0]) return; // Bail if draggable and droppable are same element

		if (this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
			if(this.options.hoverClass) this.element.removeClass(this.options.hoverClass);
			this._trigger('out', event, this.ui(draggable));
		}

	},

	_drop: function(event,custom) {

		var draggable = custom || $.ui.ddmanager.current;
		if (!draggable || (draggable.currentItem || draggable.element)[0] == this.element[0]) return false; // Bail if draggable and droppable are same element

		var childrenIntersection = false;
		this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function() {
			var inst = $.data(this, 'droppable');
			if(
				inst.options.greedy
				&& !inst.options.disabled
				&& inst.options.scope == draggable.options.scope
				&& inst.accept.call(inst.element[0], (draggable.currentItem || draggable.element))
				&& $.ui.intersect(draggable, $.extend(inst, { offset: inst.element.offset() }), inst.options.tolerance)
			) { childrenIntersection = true; return false; }
		});
		if(childrenIntersection) return false;

		if(this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
			if(this.options.activeClass) this.element.removeClass(this.options.activeClass);
			if(this.options.hoverClass) this.element.removeClass(this.options.hoverClass);
			this._trigger('drop', event, this.ui(draggable));
			return this.element;
		}

		return false;

	},

	ui: function(c) {
		return {
			draggable: (c.currentItem || c.element),
			helper: c.helper,
			position: c.position,
			offset: c.positionAbs
		};
	}

});

$.extend($.ui.droppable, {
	version: "1.8.11"
});

$.ui.intersect = function(draggable, droppable, toleranceMode) {

	if (!droppable.offset) return false;

	var x1 = (draggable.positionAbs || draggable.position.absolute).left, x2 = x1 + draggable.helperProportions.width,
		y1 = (draggable.positionAbs || draggable.position.absolute).top, y2 = y1 + draggable.helperProportions.height;
	var l = droppable.offset.left, r = l + droppable.proportions.width,
		t = droppable.offset.top, b = t + droppable.proportions.height;

	switch (toleranceMode) {
		case 'fit':
			return (l <= x1 && x2 <= r
				&& t <= y1 && y2 <= b);
			break;
		case 'intersect':
			return (l < x1 + (draggable.helperProportions.width / 2) // Right Half
				&& x2 - (draggable.helperProportions.width / 2) < r // Left Half
				&& t < y1 + (draggable.helperProportions.height / 2) // Bottom Half
				&& y2 - (draggable.helperProportions.height / 2) < b ); // Top Half
			break;
		case 'pointer':
			var draggableLeft = ((draggable.positionAbs || draggable.position.absolute).left + (draggable.clickOffset || draggable.offset.click).left),
				draggableTop = ((draggable.positionAbs || draggable.position.absolute).top + (draggable.clickOffset || draggable.offset.click).top),
				isOver = $.ui.isOver(draggableTop, draggableLeft, t, l, droppable.proportions.height, droppable.proportions.width);
			return isOver;
			break;
		case 'touch':
			return (
					(y1 >= t && y1 <= b) ||	// Top edge touching
					(y2 >= t && y2 <= b) ||	// Bottom edge touching
					(y1 < t && y2 > b)		// Surrounded vertically
				) && (
					(x1 >= l && x1 <= r) ||	// Left edge touching
					(x2 >= l && x2 <= r) ||	// Right edge touching
					(x1 < l && x2 > r)		// Surrounded horizontally
				);
			break;
		default:
			return false;
			break;
		}

};

/*
	This manager tracks offsets of draggables and droppables
*/
$.ui.ddmanager = {
	current: null,
	droppables: { 'default': [] },
	prepareOffsets: function(t, event) {

		var m = $.ui.ddmanager.droppables[t.options.scope] || [];
		var type = event ? event.type : null; // workaround for #2317
		var list = (t.currentItem || t.element).find(":data(droppable)").andSelf();

		droppablesLoop: for (var i = 0; i < m.length; i++) {

			if(m[i].options.disabled || (t && !m[i].accept.call(m[i].element[0],(t.currentItem || t.element)))) continue;	//No disabled and non-accepted
			for (var j=0; j < list.length; j++) { if(list[j] == m[i].element[0]) { m[i].proportions.height = 0; continue droppablesLoop; } }; //Filter out elements in the current dragged item
			m[i].visible = m[i].element.css("display") != "none"; if(!m[i].visible) continue; 									//If the element is not visible, continue

			if(type == "mousedown") m[i]._activate.call(m[i], event); //Activate the droppable if used directly from draggables

			m[i].offset = m[i].element.offset();
			m[i].proportions = { width: m[i].element[0].offsetWidth, height: m[i].element[0].offsetHeight };

		}

	},
	drop: function(draggable, event) {

		var dropped = false;
		$.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function() {

			if(!this.options) return;
			if (!this.options.disabled && this.visible && $.ui.intersect(draggable, this, this.options.tolerance))
				dropped = dropped || this._drop.call(this, event);

			if (!this.options.disabled && this.visible && this.accept.call(this.element[0],(draggable.currentItem || draggable.element))) {
				this.isout = 1; this.isover = 0;
				this._deactivate.call(this, event);
			}

		});
		return dropped;

	},
	drag: function(draggable, event) {

		//If you have a highly dynamic page, you might try this option. It renders positions every time you move the mouse.
		if(draggable.options.refreshPositions) $.ui.ddmanager.prepareOffsets(draggable, event);

		//Run through all droppables and check their positions based on specific tolerance options
		$.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function() {

			if(this.options.disabled || this.greedyChild || !this.visible) return;
			var intersects = $.ui.intersect(draggable, this, this.options.tolerance);

			var c = !intersects && this.isover == 1 ? 'isout' : (intersects && this.isover == 0 ? 'isover' : null);
			if(!c) return;

			var parentInstance;
			if (this.options.greedy) {
				var parent = this.element.parents(':data(droppable):eq(0)');
				if (parent.length) {
					parentInstance = $.data(parent[0], 'droppable');
					parentInstance.greedyChild = (c == 'isover' ? 1 : 0);
				}
			}

			// we just moved into a greedy child
			if (parentInstance && c == 'isover') {
				parentInstance['isover'] = 0;
				parentInstance['isout'] = 1;
				parentInstance._out.call(parentInstance, event);
			}

			this[c] = 1; this[c == 'isout' ? 'isover' : 'isout'] = 0;
			this[c == "isover" ? "_over" : "_out"].call(this, event);

			// we just moved out of a greedy child
			if (parentInstance && c == 'isout') {
				parentInstance['isout'] = 0;
				parentInstance['isover'] = 1;
				parentInstance._over.call(parentInstance, event);
			}
		});

	}
};

})(jQuery);
/*
 * jQuery UI Resizable 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

$.widget("ui.resizable", $.ui.mouse, {
	widgetEventPrefix: "resize",
	options: {
		alsoResize: false,
		animate: false,
		animateDuration: "slow",
		animateEasing: "swing",
		aspectRatio: false,
		autoHide: false,
		containment: false,
		ghost: false,
		grid: false,
		handles: "e,s,se",
		helper: false,
		maxHeight: null,
		maxWidth: null,
		minHeight: 10,
		minWidth: 10,
		zIndex: 1000
	},
	_create: function() {

		var self = this, o = this.options;
		this.element.addClass("ui-resizable");

		$.extend(this, {
			_aspectRatio: !!(o.aspectRatio),
			aspectRatio: o.aspectRatio,
			originalElement: this.element,
			_proportionallyResizeElements: [],
			_helper: o.helper || o.ghost || o.animate ? o.helper || 'ui-resizable-helper' : null
		});

		//Wrap the element if it cannot hold child nodes
		if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)) {

			//Opera fix for relative positioning
			if (/relative/.test(this.element.css('position')) && $.browser.opera)
				this.element.css({ position: 'relative', top: 'auto', left: 'auto' });

			//Create a wrapper element and set the wrapper to the new current internal element
			this.element.wrap(
				$('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({
					position: this.element.css('position'),
					width: this.element.outerWidth(),
					height: this.element.outerHeight(),
					top: this.element.css('top'),
					left: this.element.css('left')
				})
			);

			//Overwrite the original this.element
			this.element = this.element.parent().data(
				"resizable", this.element.data('resizable')
			);

			this.elementIsWrapper = true;

			//Move margins to the wrapper
			this.element.css({ marginLeft: this.originalElement.css("marginLeft"), marginTop: this.originalElement.css("marginTop"), marginRight: this.originalElement.css("marginRight"), marginBottom: this.originalElement.css("marginBottom") });
			this.originalElement.css({ marginLeft: 0, marginTop: 0, marginRight: 0, marginBottom: 0});

			//Prevent Safari textarea resize
			this.originalResizeStyle = this.originalElement.css('resize');
			this.originalElement.css('resize', 'none');

			//Push the actual element to our proportionallyResize internal array
			this._proportionallyResizeElements.push(this.originalElement.css({ position: 'static', zoom: 1, display: 'block' }));

			// avoid IE jump (hard set the margin)
			this.originalElement.css({ margin: this.originalElement.css('margin') });

			// fix handlers offset
			this._proportionallyResize();

		}

		this.handles = o.handles || (!$('.ui-resizable-handle', this.element).length ? "e,s,se" : { n: '.ui-resizable-n', e: '.ui-resizable-e', s: '.ui-resizable-s', w: '.ui-resizable-w', se: '.ui-resizable-se', sw: '.ui-resizable-sw', ne: '.ui-resizable-ne', nw: '.ui-resizable-nw' });
		if(this.handles.constructor == String) {

			if(this.handles == 'all') this.handles = 'n,e,s,w,se,sw,ne,nw';
			var n = this.handles.split(","); this.handles = {};

			for(var i = 0; i < n.length; i++) {

				var handle = $.trim(n[i]), hname = 'ui-resizable-'+handle;
				var axis = $('<div class="ui-resizable-handle ' + hname + '"></div>');

				// increase zIndex of sw, se, ne, nw axis
				//TODO : this modifies original option
				if(/sw|se|ne|nw/.test(handle)) axis.css({ zIndex: ++o.zIndex });

				//TODO : What's going on here?
				if ('se' == handle) {
					axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');
				};

				//Insert into internal handles object and append to element
				this.handles[handle] = '.ui-resizable-'+handle;
				this.element.append(axis);
			}

		}

		this._renderAxis = function(target) {

			target = target || this.element;

			for(var i in this.handles) {

				if(this.handles[i].constructor == String)
					this.handles[i] = $(this.handles[i], this.element).show();

				//Apply pad to wrapper element, needed to fix axis position (textarea, inputs, scrolls)
				if (this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i)) {

					var axis = $(this.handles[i], this.element), padWrapper = 0;

					//Checking the correct pad and border
					padWrapper = /sw|ne|nw|se|n|s/.test(i) ? axis.outerHeight() : axis.outerWidth();

					//The padding type i have to apply...
					var padPos = [ 'padding',
						/ne|nw|n/.test(i) ? 'Top' :
						/se|sw|s/.test(i) ? 'Bottom' :
						/^e$/.test(i) ? 'Right' : 'Left' ].join("");

					target.css(padPos, padWrapper);

					this._proportionallyResize();

				}

				//TODO: What's that good for? There's not anything to be executed left
				if(!$(this.handles[i]).length)
					continue;

			}
		};

		//TODO: make renderAxis a prototype function
		this._renderAxis(this.element);

		this._handles = $('.ui-resizable-handle', this.element)
			.disableSelection();

		//Matching axis name
		this._handles.mouseover(function() {
			if (!self.resizing) {
				if (this.className)
					var axis = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);
				//Axis, default = se
				self.axis = axis && axis[1] ? axis[1] : 'se';
			}
		});

		//If we want to auto hide the elements
		if (o.autoHide) {
			this._handles.hide();
			$(this.element)
				.addClass("ui-resizable-autohide")
				.hover(function() {
					$(this).removeClass("ui-resizable-autohide");
					self._handles.show();
				},
				function(){
					if (!self.resizing) {
						$(this).addClass("ui-resizable-autohide");
						self._handles.hide();
					}
				});
		}

		//Initialize the mouse interaction
		this._mouseInit();

	},

	destroy: function() {

		this._mouseDestroy();

		var _destroy = function(exp) {
			$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing")
				.removeData("resizable").unbind(".resizable").find('.ui-resizable-handle').remove();
		};

		//TODO: Unwrap at same DOM position
		if (this.elementIsWrapper) {
			_destroy(this.element);
			var wrapper = this.element;
			wrapper.after(
				this.originalElement.css({
					position: wrapper.css('position'),
					width: wrapper.outerWidth(),
					height: wrapper.outerHeight(),
					top: wrapper.css('top'),
					left: wrapper.css('left')
				})
			).remove();
		}

		this.originalElement.css('resize', this.originalResizeStyle);
		_destroy(this.originalElement);

		return this;
	},

	_mouseCapture: function(event) {
		var handle = false;
		for (var i in this.handles) {
			if ($(this.handles[i])[0] == event.target) {
				handle = true;
			}
		}

		return !this.options.disabled && handle;
	},

	_mouseStart: function(event) {

		var o = this.options, iniPos = this.element.position(), el = this.element;

		this.resizing = true;
		this.documentScroll = { top: $(document).scrollTop(), left: $(document).scrollLeft() };

		// bugfix for http://dev.jquery.com/ticket/1749
		if (el.is('.ui-draggable') || (/absolute/).test(el.css('position'))) {
			el.css({ position: 'absolute', top: iniPos.top, left: iniPos.left });
		}

		//Opera fixing relative position
		if ($.browser.opera && (/relative/).test(el.css('position')))
			el.css({ position: 'relative', top: 'auto', left: 'auto' });

		this._renderProxy();

		var curleft = num(this.helper.css('left')), curtop = num(this.helper.css('top'));

		if (o.containment) {
			curleft += $(o.containment).scrollLeft() || 0;
			curtop += $(o.containment).scrollTop() || 0;
		}

		//Store needed variables
		this.offset = this.helper.offset();
		this.position = { left: curleft, top: curtop };
		this.size = this._helper ? { width: el.outerWidth(), height: el.outerHeight() } : { width: el.width(), height: el.height() };
		this.originalSize = this._helper ? { width: el.outerWidth(), height: el.outerHeight() } : { width: el.width(), height: el.height() };
		this.originalPosition = { left: curleft, top: curtop };
		this.sizeDiff = { width: el.outerWidth() - el.width(), height: el.outerHeight() - el.height() };
		this.originalMousePosition = { left: event.pageX, top: event.pageY };

		//Aspect Ratio
		this.aspectRatio = (typeof o.aspectRatio == 'number') ? o.aspectRatio : ((this.originalSize.width / this.originalSize.height) || 1);

	    var cursor = $('.ui-resizable-' + this.axis).css('cursor');
	    $('body').css('cursor', cursor == 'auto' ? this.axis + '-resize' : cursor);

		el.addClass("ui-resizable-resizing");
		this._propagate("start", event);
		return true;
	},

	_mouseDrag: function(event) {

		//Increase performance, avoid regex
		var el = this.helper, o = this.options, props = {},
			self = this, smp = this.originalMousePosition, a = this.axis;

		var dx = (event.pageX-smp.left)||0, dy = (event.pageY-smp.top)||0;
		var trigger = this._change[a];
		if (!trigger) return false;

		// Calculate the attrs that will be change
		var data = trigger.apply(this, [event, dx, dy]), ie6 = $.browser.msie && $.browser.version < 7, csdif = this.sizeDiff;

		if (this._aspectRatio || event.shiftKey)
			data = this._updateRatio(data, event);

		data = this._respectSize(data, event);

		// plugins callbacks need to be called first
		this._propagate("resize", event);

		el.css({
			top: this.position.top + "px", left: this.position.left + "px",
			width: this.size.width + "px", height: this.size.height + "px"
		});

		if (!this._helper && this._proportionallyResizeElements.length)
			this._proportionallyResize();

		this._updateCache(data);

		// calling the user callback at the end
		this._trigger('resize', event, this.ui());

		return false;
	},

	_mouseStop: function(event) {

		this.resizing = false;
		var o = this.options, self = this;

		if(this._helper) {
			var pr = this._proportionallyResizeElements, ista = pr.length && (/textarea/i).test(pr[0].nodeName),
				soffseth = ista && $.ui.hasScroll(pr[0], 'left') /* TODO - jump height */ ? 0 : self.sizeDiff.height,
				soffsetw = ista ? 0 : self.sizeDiff.width;

			var s = { width: (self.helper.width()  - soffsetw), height: (self.helper.height() - soffseth) },
				left = (parseInt(self.element.css('left'), 10) + (self.position.left - self.originalPosition.left)) || null,
				top = (parseInt(self.element.css('top'), 10) + (self.position.top - self.originalPosition.top)) || null;

			if (!o.animate)
				this.element.css($.extend(s, { top: top, left: left }));

			self.helper.height(self.size.height);
			self.helper.width(self.size.width);

			if (this._helper && !o.animate) this._proportionallyResize();
		}

		$('body').css('cursor', 'auto');

		this.element.removeClass("ui-resizable-resizing");

		this._propagate("stop", event);

		if (this._helper) this.helper.remove();
		return false;

	},

	_updateCache: function(data) {
		var o = this.options;
		this.offset = this.helper.offset();
		if (isNumber(data.left)) this.position.left = data.left;
		if (isNumber(data.top)) this.position.top = data.top;
		if (isNumber(data.height)) this.size.height = data.height;
		if (isNumber(data.width)) this.size.width = data.width;
	},

	_updateRatio: function(data, event) {

		var o = this.options, cpos = this.position, csize = this.size, a = this.axis;

		if (data.height) data.width = (csize.height * this.aspectRatio);
		else if (data.width) data.height = (csize.width / this.aspectRatio);

		if (a == 'sw') {
			data.left = cpos.left + (csize.width - data.width);
			data.top = null;
		}
		if (a == 'nw') {
			data.top = cpos.top + (csize.height - data.height);
			data.left = cpos.left + (csize.width - data.width);
		}

		return data;
	},

	_respectSize: function(data, event) {

		var el = this.helper, o = this.options, pRatio = this._aspectRatio || event.shiftKey, a = this.axis,
				ismaxw = isNumber(data.width) && o.maxWidth && (o.maxWidth < data.width), ismaxh = isNumber(data.height) && o.maxHeight && (o.maxHeight < data.height),
					isminw = isNumber(data.width) && o.minWidth && (o.minWidth > data.width), isminh = isNumber(data.height) && o.minHeight && (o.minHeight > data.height);

		if (isminw) data.width = o.minWidth;
		if (isminh) data.height = o.minHeight;
		if (ismaxw) data.width = o.maxWidth;
		if (ismaxh) data.height = o.maxHeight;

		var dw = this.originalPosition.left + this.originalSize.width, dh = this.position.top + this.size.height;
		var cw = /sw|nw|w/.test(a), ch = /nw|ne|n/.test(a);

		if (isminw && cw) data.left = dw - o.minWidth;
		if (ismaxw && cw) data.left = dw - o.maxWidth;
		if (isminh && ch)	data.top = dh - o.minHeight;
		if (ismaxh && ch)	data.top = dh - o.maxHeight;

		// fixing jump error on top/left - bug #2330
		var isNotwh = !data.width && !data.height;
		if (isNotwh && !data.left && data.top) data.top = null;
		else if (isNotwh && !data.top && data.left) data.left = null;

		return data;
	},

	_proportionallyResize: function() {

		var o = this.options;
		if (!this._proportionallyResizeElements.length) return;
		var element = this.helper || this.element;

		for (var i=0; i < this._proportionallyResizeElements.length; i++) {

			var prel = this._proportionallyResizeElements[i];

			if (!this.borderDif) {
				var b = [prel.css('borderTopWidth'), prel.css('borderRightWidth'), prel.css('borderBottomWidth'), prel.css('borderLeftWidth')],
					p = [prel.css('paddingTop'), prel.css('paddingRight'), prel.css('paddingBottom'), prel.css('paddingLeft')];

				this.borderDif = $.map(b, function(v, i) {
					var border = parseInt(v,10)||0, padding = parseInt(p[i],10)||0;
					return border + padding;
				});
			}

			if ($.browser.msie && !(!($(element).is(':hidden') || $(element).parents(':hidden').length)))
				continue;

			prel.css({
				height: (element.height() - this.borderDif[0] - this.borderDif[2]) || 0,
				width: (element.width() - this.borderDif[1] - this.borderDif[3]) || 0
			});

		};

	},

	_renderProxy: function() {

		var el = this.element, o = this.options;
		this.elementOffset = el.offset();

		if(this._helper) {

			this.helper = this.helper || $('<div style="overflow:hidden;"></div>');

			// fix ie6 offset TODO: This seems broken
			var ie6 = $.browser.msie && $.browser.version < 7, ie6offset = (ie6 ? 1 : 0),
			pxyoffset = ( ie6 ? 2 : -1 );

			this.helper.addClass(this._helper).css({
				width: this.element.outerWidth() + pxyoffset,
				height: this.element.outerHeight() + pxyoffset,
				position: 'absolute',
				left: this.elementOffset.left - ie6offset +'px',
				top: this.elementOffset.top - ie6offset +'px',
				zIndex: ++o.zIndex //TODO: Don't modify option
			});

			this.helper
				.appendTo("body")
				.disableSelection();

		} else {
			this.helper = this.element;
		}

	},

	_change: {
		e: function(event, dx, dy) {
			return { width: this.originalSize.width + dx };
		},
		w: function(event, dx, dy) {
			var o = this.options, cs = this.originalSize, sp = this.originalPosition;
			return { left: sp.left + dx, width: cs.width - dx };
		},
		n: function(event, dx, dy) {
			var o = this.options, cs = this.originalSize, sp = this.originalPosition;
			return { top: sp.top + dy, height: cs.height - dy };
		},
		s: function(event, dx, dy) {
			return { height: this.originalSize.height + dy };
		},
		se: function(event, dx, dy) {
			return $.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [event, dx, dy]));
		},
		sw: function(event, dx, dy) {
			return $.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [event, dx, dy]));
		},
		ne: function(event, dx, dy) {
			return $.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [event, dx, dy]));
		},
		nw: function(event, dx, dy) {
			return $.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [event, dx, dy]));
		}
	},

	_propagate: function(n, event) {
		$.ui.plugin.call(this, n, [event, this.ui()]);
		(n != "resize" && this._trigger(n, event, this.ui()));
	},

	plugins: {},

	ui: function() {
		return {
			originalElement: this.originalElement,
			element: this.element,
			helper: this.helper,
			position: this.position,
			size: this.size,
			originalSize: this.originalSize,
			originalPosition: this.originalPosition
		};
	}

});

$.extend($.ui.resizable, {
	version: "1.8.11"
});

/*
 * Resizable Extensions
 */

$.ui.plugin.add("resizable", "alsoResize", {

	start: function (event, ui) {
		var self = $(this).data("resizable"), o = self.options;

		var _store = function (exp) {
			$(exp).each(function() {
				var el = $(this);
				el.data("resizable-alsoresize", {
					width: parseInt(el.width(), 10), height: parseInt(el.height(), 10),
					left: parseInt(el.css('left'), 10), top: parseInt(el.css('top'), 10),
					position: el.css('position') // to reset Opera on stop()
				});
			});
		};

		if (typeof(o.alsoResize) == 'object' && !o.alsoResize.parentNode) {
			if (o.alsoResize.length) { o.alsoResize = o.alsoResize[0]; _store(o.alsoResize); }
			else { $.each(o.alsoResize, function (exp) { _store(exp); }); }
		}else{
			_store(o.alsoResize);
		}
	},

	resize: function (event, ui) {
		var self = $(this).data("resizable"), o = self.options, os = self.originalSize, op = self.originalPosition;

		var delta = {
			height: (self.size.height - os.height) || 0, width: (self.size.width - os.width) || 0,
			top: (self.position.top - op.top) || 0, left: (self.position.left - op.left) || 0
		},

		_alsoResize = function (exp, c) {
			$(exp).each(function() {
				var el = $(this), start = $(this).data("resizable-alsoresize"), style = {}, 
					css = c && c.length ? c : el.parents(ui.originalElement[0]).length ? ['width', 'height'] : ['width', 'height', 'top', 'left'];

				$.each(css, function (i, prop) {
					var sum = (start[prop]||0) + (delta[prop]||0);
					if (sum && sum >= 0)
						style[prop] = sum || null;
				});

				// Opera fixing relative position
				if ($.browser.opera && /relative/.test(el.css('position'))) {
					self._revertToRelativePosition = true;
					el.css({ position: 'absolute', top: 'auto', left: 'auto' });
				}

				el.css(style);
			});
		};

		if (typeof(o.alsoResize) == 'object' && !o.alsoResize.nodeType) {
			$.each(o.alsoResize, function (exp, c) { _alsoResize(exp, c); });
		}else{
			_alsoResize(o.alsoResize);
		}
	},

	stop: function (event, ui) {
		var self = $(this).data("resizable"), o = self.options;

		var _reset = function (exp) {
			$(exp).each(function() {
				var el = $(this);
				// reset position for Opera - no need to verify it was changed
				el.css({ position: el.data("resizable-alsoresize").position });
			});
		};

		if (self._revertToRelativePosition) {
			self._revertToRelativePosition = false;
			if (typeof(o.alsoResize) == 'object' && !o.alsoResize.nodeType) {
				$.each(o.alsoResize, function (exp) { _reset(exp); });
			}else{
				_reset(o.alsoResize);
			}
		}

		$(this).removeData("resizable-alsoresize");
	}
});

$.ui.plugin.add("resizable", "animate", {

	stop: function(event, ui) {
		var self = $(this).data("resizable"), o = self.options;

		var pr = self._proportionallyResizeElements, ista = pr.length && (/textarea/i).test(pr[0].nodeName),
					soffseth = ista && $.ui.hasScroll(pr[0], 'left') /* TODO - jump height */ ? 0 : self.sizeDiff.height,
						soffsetw = ista ? 0 : self.sizeDiff.width;

		var style = { width: (self.size.width - soffsetw), height: (self.size.height - soffseth) },
					left = (parseInt(self.element.css('left'), 10) + (self.position.left - self.originalPosition.left)) || null,
						top = (parseInt(self.element.css('top'), 10) + (self.position.top - self.originalPosition.top)) || null;

		self.element.animate(
			$.extend(style, top && left ? { top: top, left: left } : {}), {
				duration: o.animateDuration,
				easing: o.animateEasing,
				step: function() {

					var data = {
						width: parseInt(self.element.css('width'), 10),
						height: parseInt(self.element.css('height'), 10),
						top: parseInt(self.element.css('top'), 10),
						left: parseInt(self.element.css('left'), 10)
					};

					if (pr && pr.length) $(pr[0]).css({ width: data.width, height: data.height });

					// propagating resize, and updating values for each animation step
					self._updateCache(data);
					self._propagate("resize", event);

				}
			}
		);
	}

});

$.ui.plugin.add("resizable", "containment", {

	start: function(event, ui) {
		var self = $(this).data("resizable"), o = self.options, el = self.element;
		var oc = o.containment,	ce = (oc instanceof $) ? oc.get(0) : (/parent/.test(oc)) ? el.parent().get(0) : oc;
		if (!ce) return;

		self.containerElement = $(ce);

		if (/document/.test(oc) || oc == document) {
			self.containerOffset = { left: 0, top: 0 };
			self.containerPosition = { left: 0, top: 0 };

			self.parentData = {
				element: $(document), left: 0, top: 0,
				width: $(document).width(), height: $(document).height() || document.body.parentNode.scrollHeight
			};
		}

		// i'm a node, so compute top, left, right, bottom
		else {
			var element = $(ce), p = [];
			$([ "Top", "Right", "Left", "Bottom" ]).each(function(i, name) { p[i] = num(element.css("padding" + name)); });

			self.containerOffset = element.offset();
			self.containerPosition = element.position();
			self.containerSize = { height: (element.innerHeight() - p[3]), width: (element.innerWidth() - p[1]) };

			var co = self.containerOffset, ch = self.containerSize.height,	cw = self.containerSize.width,
						width = ($.ui.hasScroll(ce, "left") ? ce.scrollWidth : cw ), height = ($.ui.hasScroll(ce) ? ce.scrollHeight : ch);

			self.parentData = {
				element: ce, left: co.left, top: co.top, width: width, height: height
			};
		}
	},

	resize: function(event, ui) {
		var self = $(this).data("resizable"), o = self.options,
				ps = self.containerSize, co = self.containerOffset, cs = self.size, cp = self.position,
				pRatio = self._aspectRatio || event.shiftKey, cop = { top:0, left:0 }, ce = self.containerElement;

		if (ce[0] != document && (/static/).test(ce.css('position'))) cop = co;

		if (cp.left < (self._helper ? co.left : 0)) {
			self.size.width = self.size.width + (self._helper ? (self.position.left - co.left) : (self.position.left - cop.left));
			if (pRatio) self.size.height = self.size.width / o.aspectRatio;
			self.position.left = o.helper ? co.left : 0;
		}

		if (cp.top < (self._helper ? co.top : 0)) {
			self.size.height = self.size.height + (self._helper ? (self.position.top - co.top) : self.position.top);
			if (pRatio) self.size.width = self.size.height * o.aspectRatio;
			self.position.top = self._helper ? co.top : 0;
		}

		self.offset.left = self.parentData.left+self.position.left;
		self.offset.top = self.parentData.top+self.position.top;

		var woset = Math.abs( (self._helper ? self.offset.left - cop.left : (self.offset.left - cop.left)) + self.sizeDiff.width ),
					hoset = Math.abs( (self._helper ? self.offset.top - cop.top : (self.offset.top - co.top)) + self.sizeDiff.height );

		var isParent = self.containerElement.get(0) == self.element.parent().get(0),
		    isOffsetRelative = /relative|absolute/.test(self.containerElement.css('position'));

		if(isParent && isOffsetRelative) woset -= self.parentData.left;

		if (woset + self.size.width >= self.parentData.width) {
			self.size.width = self.parentData.width - woset;
			if (pRatio) self.size.height = self.size.width / self.aspectRatio;
		}

		if (hoset + self.size.height >= self.parentData.height) {
			self.size.height = self.parentData.height - hoset;
			if (pRatio) self.size.width = self.size.height * self.aspectRatio;
		}
	},

	stop: function(event, ui){
		var self = $(this).data("resizable"), o = self.options, cp = self.position,
				co = self.containerOffset, cop = self.containerPosition, ce = self.containerElement;

		var helper = $(self.helper), ho = helper.offset(), w = helper.outerWidth() - self.sizeDiff.width, h = helper.outerHeight() - self.sizeDiff.height;

		if (self._helper && !o.animate && (/relative/).test(ce.css('position')))
			$(this).css({ left: ho.left - cop.left - co.left, width: w, height: h });

		if (self._helper && !o.animate && (/static/).test(ce.css('position')))
			$(this).css({ left: ho.left - cop.left - co.left, width: w, height: h });

	}
});

$.ui.plugin.add("resizable", "ghost", {

	start: function(event, ui) {

		var self = $(this).data("resizable"), o = self.options, cs = self.size;

		self.ghost = self.originalElement.clone();
		self.ghost
			.css({ opacity: .25, display: 'block', position: 'relative', height: cs.height, width: cs.width, margin: 0, left: 0, top: 0 })
			.addClass('ui-resizable-ghost')
			.addClass(typeof o.ghost == 'string' ? o.ghost : '');

		self.ghost.appendTo(self.helper);

	},

	resize: function(event, ui){
		var self = $(this).data("resizable"), o = self.options;
		if (self.ghost) self.ghost.css({ position: 'relative', height: self.size.height, width: self.size.width });
	},

	stop: function(event, ui){
		var self = $(this).data("resizable"), o = self.options;
		if (self.ghost && self.helper) self.helper.get(0).removeChild(self.ghost.get(0));
	}

});

$.ui.plugin.add("resizable", "grid", {

	resize: function(event, ui) {
		var self = $(this).data("resizable"), o = self.options, cs = self.size, os = self.originalSize, op = self.originalPosition, a = self.axis, ratio = o._aspectRatio || event.shiftKey;
		o.grid = typeof o.grid == "number" ? [o.grid, o.grid] : o.grid;
		var ox = Math.round((cs.width - os.width) / (o.grid[0]||1)) * (o.grid[0]||1), oy = Math.round((cs.height - os.height) / (o.grid[1]||1)) * (o.grid[1]||1);

		if (/^(se|s|e)$/.test(a)) {
			self.size.width = os.width + ox;
			self.size.height = os.height + oy;
		}
		else if (/^(ne)$/.test(a)) {
			self.size.width = os.width + ox;
			self.size.height = os.height + oy;
			self.position.top = op.top - oy;
		}
		else if (/^(sw)$/.test(a)) {
			self.size.width = os.width + ox;
			self.size.height = os.height + oy;
			self.position.left = op.left - ox;
		}
		else {
			self.size.width = os.width + ox;
			self.size.height = os.height + oy;
			self.position.top = op.top - oy;
			self.position.left = op.left - ox;
		}
	}

});

var num = function(v) {
	return parseInt(v, 10) || 0;
};

var isNumber = function(value) {
	return !isNaN(parseInt(value, 10));
};

})(jQuery);
/*
 * jQuery UI Selectable 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Selectables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

$.widget("ui.selectable", $.ui.mouse, {
	options: {
		appendTo: 'body',
		autoRefresh: true,
		distance: 0,
		filter: '*',
		tolerance: 'touch'
	},
	_create: function() {
		var self = this;

		this.element.addClass("ui-selectable");

		this.dragged = false;

		// cache selectee children based on filter
		var selectees;
		this.refresh = function() {
			selectees = $(self.options.filter, self.element[0]);
			selectees.each(function() {
				var $this = $(this);
				var pos = $this.offset();
				$.data(this, "selectable-item", {
					element: this,
					$element: $this,
					left: pos.left,
					top: pos.top,
					right: pos.left + $this.outerWidth(),
					bottom: pos.top + $this.outerHeight(),
					startselected: false,
					selected: $this.hasClass('ui-selected'),
					selecting: $this.hasClass('ui-selecting'),
					unselecting: $this.hasClass('ui-unselecting')
				});
			});
		};
		this.refresh();

		this.selectees = selectees.addClass("ui-selectee");

		this._mouseInit();

		this.helper = $("<div class='ui-selectable-helper'></div>");
	},

	destroy: function() {
		this.selectees
			.removeClass("ui-selectee")
			.removeData("selectable-item");
		this.element
			.removeClass("ui-selectable ui-selectable-disabled")
			.removeData("selectable")
			.unbind(".selectable");
		this._mouseDestroy();

		return this;
	},

	_mouseStart: function(event) {
		var self = this;

		this.opos = [event.pageX, event.pageY];

		if (this.options.disabled)
			return;

		var options = this.options;

		this.selectees = $(options.filter, this.element[0]);

		this._trigger("start", event);

		$(options.appendTo).append(this.helper);
		// position helper (lasso)
		this.helper.css({
			"left": event.clientX,
			"top": event.clientY,
			"width": 0,
			"height": 0
		});

		if (options.autoRefresh) {
			this.refresh();
		}

		this.selectees.filter('.ui-selected').each(function() {
			var selectee = $.data(this, "selectable-item");
			selectee.startselected = true;
			if (!event.metaKey) {
				selectee.$element.removeClass('ui-selected');
				selectee.selected = false;
				selectee.$element.addClass('ui-unselecting');
				selectee.unselecting = true;
				// selectable UNSELECTING callback
				self._trigger("unselecting", event, {
					unselecting: selectee.element
				});
			}
		});

		$(event.target).parents().andSelf().each(function() {
			var selectee = $.data(this, "selectable-item");
			if (selectee) {
				var doSelect = !event.metaKey || !selectee.$element.hasClass('ui-selected');
				selectee.$element
					.removeClass(doSelect ? "ui-unselecting" : "ui-selected")
					.addClass(doSelect ? "ui-selecting" : "ui-unselecting");
				selectee.unselecting = !doSelect;
				selectee.selecting = doSelect;
				selectee.selected = doSelect;
				// selectable (UN)SELECTING callback
				if (doSelect) {
					self._trigger("selecting", event, {
						selecting: selectee.element
					});
				} else {
					self._trigger("unselecting", event, {
						unselecting: selectee.element
					});
				}
				return false;
			}
		});

	},

	_mouseDrag: function(event) {
		var self = this;
		this.dragged = true;

		if (this.options.disabled)
			return;

		var options = this.options;

		var x1 = this.opos[0], y1 = this.opos[1], x2 = event.pageX, y2 = event.pageY;
		if (x1 > x2) { var tmp = x2; x2 = x1; x1 = tmp; }
		if (y1 > y2) { var tmp = y2; y2 = y1; y1 = tmp; }
		this.helper.css({left: x1, top: y1, width: x2-x1, height: y2-y1});

		this.selectees.each(function() {
			var selectee = $.data(this, "selectable-item");
			//prevent helper from being selected if appendTo: selectable
			if (!selectee || selectee.element == self.element[0])
				return;
			var hit = false;
			if (options.tolerance == 'touch') {
				hit = ( !(selectee.left > x2 || selectee.right < x1 || selectee.top > y2 || selectee.bottom < y1) );
			} else if (options.tolerance == 'fit') {
				hit = (selectee.left > x1 && selectee.right < x2 && selectee.top > y1 && selectee.bottom < y2);
			}

			if (hit) {
				// SELECT
				if (selectee.selected) {
					selectee.$element.removeClass('ui-selected');
					selectee.selected = false;
				}
				if (selectee.unselecting) {
					selectee.$element.removeClass('ui-unselecting');
					selectee.unselecting = false;
				}
				if (!selectee.selecting) {
					selectee.$element.addClass('ui-selecting');
					selectee.selecting = true;
					// selectable SELECTING callback
					self._trigger("selecting", event, {
						selecting: selectee.element
					});
				}
			} else {
				// UNSELECT
				if (selectee.selecting) {
					if (event.metaKey && selectee.startselected) {
						selectee.$element.removeClass('ui-selecting');
						selectee.selecting = false;
						selectee.$element.addClass('ui-selected');
						selectee.selected = true;
					} else {
						selectee.$element.removeClass('ui-selecting');
						selectee.selecting = false;
						if (selectee.startselected) {
							selectee.$element.addClass('ui-unselecting');
							selectee.unselecting = true;
						}
						// selectable UNSELECTING callback
						self._trigger("unselecting", event, {
							unselecting: selectee.element
						});
					}
				}
				if (selectee.selected) {
					if (!event.metaKey && !selectee.startselected) {
						selectee.$element.removeClass('ui-selected');
						selectee.selected = false;

						selectee.$element.addClass('ui-unselecting');
						selectee.unselecting = true;
						// selectable UNSELECTING callback
						self._trigger("unselecting", event, {
							unselecting: selectee.element
						});
					}
				}
			}
		});

		return false;
	},

	_mouseStop: function(event) {
		var self = this;

		this.dragged = false;

		var options = this.options;

		$('.ui-unselecting', this.element[0]).each(function() {
			var selectee = $.data(this, "selectable-item");
			selectee.$element.removeClass('ui-unselecting');
			selectee.unselecting = false;
			selectee.startselected = false;
			self._trigger("unselected", event, {
				unselected: selectee.element
			});
		});
		$('.ui-selecting', this.element[0]).each(function() {
			var selectee = $.data(this, "selectable-item");
			selectee.$element.removeClass('ui-selecting').addClass('ui-selected');
			selectee.selecting = false;
			selectee.selected = true;
			selectee.startselected = true;
			self._trigger("selected", event, {
				selected: selectee.element
			});
		});
		this._trigger("stop", event);

		this.helper.remove();

		return false;
	}

});

$.extend($.ui.selectable, {
	version: "1.8.11"
});

})(jQuery);
/*
 * jQuery UI Accordion 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Accordion
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

$.widget( "ui.accordion", {
	options: {
		active: 0,
		animated: "slide",
		autoHeight: true,
		clearStyle: false,
		collapsible: false,
		event: "click",
		fillSpace: false,
		header: "> li > :first-child,> :not(li):even",
		icons: {
			header: "ui-icon-triangle-1-e",
			headerSelected: "ui-icon-triangle-1-s"
		},
		navigation: false,
		navigationFilter: function() {
			return this.href.toLowerCase() === location.href.toLowerCase();
		}
	},

	_create: function() {
		var self = this,
			options = self.options;

		self.running = 0;

		self.element
			.addClass( "ui-accordion ui-widget ui-helper-reset" )
			// in lack of child-selectors in CSS
			// we need to mark top-LIs in a UL-accordion for some IE-fix
			.children( "li" )
				.addClass( "ui-accordion-li-fix" );

		self.headers = self.element.find( options.header )
			.addClass( "ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" )
			.bind( "mouseenter.accordion", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).addClass( "ui-state-hover" );
			})
			.bind( "mouseleave.accordion", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).removeClass( "ui-state-hover" );
			})
			.bind( "focus.accordion", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).addClass( "ui-state-focus" );
			})
			.bind( "blur.accordion", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).removeClass( "ui-state-focus" );
			});

		self.headers.next()
			.addClass( "ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" );

		if ( options.navigation ) {
			var current = self.element.find( "a" ).filter( options.navigationFilter ).eq( 0 );
			if ( current.length ) {
				var header = current.closest( ".ui-accordion-header" );
				if ( header.length ) {
					// anchor within header
					self.active = header;
				} else {
					// anchor within content
					self.active = current.closest( ".ui-accordion-content" ).prev();
				}
			}
		}

		self.active = self._findActive( self.active || options.active )
			.addClass( "ui-state-default ui-state-active" )
			.toggleClass( "ui-corner-all" )
			.toggleClass( "ui-corner-top" );
		self.active.next().addClass( "ui-accordion-content-active" );

		self._createIcons();
		self.resize();
		
		// ARIA
		self.element.attr( "role", "tablist" );

		self.headers
			.attr( "role", "tab" )
			.bind( "keydown.accordion", function( event ) {
				return self._keydown( event );
			})
			.next()
				.attr( "role", "tabpanel" );

		self.headers
			.not( self.active || "" )
			.attr({
				"aria-expanded": "false",
				"aria-selected": "false",
				tabIndex: -1
			})
			.next()
				.hide();

		// make sure at least one header is in the tab order
		if ( !self.active.length ) {
			self.headers.eq( 0 ).attr( "tabIndex", 0 );
		} else {
			self.active
				.attr({
					"aria-expanded": "true",
					"aria-selected": "true",
					tabIndex: 0
				});
		}

		// only need links in tab order for Safari
		if ( !$.browser.safari ) {
			self.headers.find( "a" ).attr( "tabIndex", -1 );
		}

		if ( options.event ) {
			self.headers.bind( options.event.split(" ").join(".accordion ") + ".accordion", function(event) {
				self._clickHandler.call( self, event, this );
				event.preventDefault();
			});
		}
	},

	_createIcons: function() {
		var options = this.options;
		if ( options.icons ) {
			$( "<span></span>" )
				.addClass( "ui-icon " + options.icons.header )
				.prependTo( this.headers );
			this.active.children( ".ui-icon" )
				.toggleClass(options.icons.header)
				.toggleClass(options.icons.headerSelected);
			this.element.addClass( "ui-accordion-icons" );
		}
	},

	_destroyIcons: function() {
		this.headers.children( ".ui-icon" ).remove();
		this.element.removeClass( "ui-accordion-icons" );
	},

	destroy: function() {
		var options = this.options;

		this.element
			.removeClass( "ui-accordion ui-widget ui-helper-reset" )
			.removeAttr( "role" );

		this.headers
			.unbind( ".accordion" )
			.removeClass( "ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top" )
			.removeAttr( "role" )
			.removeAttr( "aria-expanded" )
			.removeAttr( "aria-selected" )
			.removeAttr( "tabIndex" );

		this.headers.find( "a" ).removeAttr( "tabIndex" );
		this._destroyIcons();
		var contents = this.headers.next()
			.css( "display", "" )
			.removeAttr( "role" )
			.removeClass( "ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled" );
		if ( options.autoHeight || options.fillHeight ) {
			contents.css( "height", "" );
		}

		return $.Widget.prototype.destroy.call( this );
	},

	_setOption: function( key, value ) {
		$.Widget.prototype._setOption.apply( this, arguments );
			
		if ( key == "active" ) {
			this.activate( value );
		}
		if ( key == "icons" ) {
			this._destroyIcons();
			if ( value ) {
				this._createIcons();
			}
		}
		// #5332 - opacity doesn't cascade to positioned elements in IE
		// so we need to add the disabled class to the headers and panels
		if ( key == "disabled" ) {
			this.headers.add(this.headers.next())
				[ value ? "addClass" : "removeClass" ](
					"ui-accordion-disabled ui-state-disabled" );
		}
	},

	_keydown: function( event ) {
		if ( this.options.disabled || event.altKey || event.ctrlKey ) {
			return;
		}

		var keyCode = $.ui.keyCode,
			length = this.headers.length,
			currentIndex = this.headers.index( event.target ),
			toFocus = false;

		switch ( event.keyCode ) {
			case keyCode.RIGHT:
			case keyCode.DOWN:
				toFocus = this.headers[ ( currentIndex + 1 ) % length ];
				break;
			case keyCode.LEFT:
			case keyCode.UP:
				toFocus = this.headers[ ( currentIndex - 1 + length ) % length ];
				break;
			case keyCode.SPACE:
			case keyCode.ENTER:
				this._clickHandler( { target: event.target }, event.target );
				event.preventDefault();
		}

		if ( toFocus ) {
			$( event.target ).attr( "tabIndex", -1 );
			$( toFocus ).attr( "tabIndex", 0 );
			toFocus.focus();
			return false;
		}

		return true;
	},

	resize: function() {
		var options = this.options,
			maxHeight;

		if ( options.fillSpace ) {
			if ( $.browser.msie ) {
				var defOverflow = this.element.parent().css( "overflow" );
				this.element.parent().css( "overflow", "hidden");
			}
			maxHeight = this.element.parent().height();
			if ($.browser.msie) {
				this.element.parent().css( "overflow", defOverflow );
			}

			this.headers.each(function() {
				maxHeight -= $( this ).outerHeight( true );
			});

			this.headers.next()
				.each(function() {
					$( this ).height( Math.max( 0, maxHeight -
						$( this ).innerHeight() + $( this ).height() ) );
				})
				.css( "overflow", "auto" );
		} else if ( options.autoHeight ) {
			maxHeight = 0;
			this.headers.next()
				.each(function() {
					maxHeight = Math.max( maxHeight, $( this ).height( "" ).height() );
				})
				.height( maxHeight );
		}

		return this;
	},

	activate: function( index ) {
		// TODO this gets called on init, changing the option without an explicit call for that
		this.options.active = index;
		// call clickHandler with custom event
		var active = this._findActive( index )[ 0 ];
		this._clickHandler( { target: active }, active );

		return this;
	},

	_findActive: function( selector ) {
		return selector
			? typeof selector === "number"
				? this.headers.filter( ":eq(" + selector + ")" )
				: this.headers.not( this.headers.not( selector ) )
			: selector === false
				? $( [] )
				: this.headers.filter( ":eq(0)" );
	},

	// TODO isn't event.target enough? why the separate target argument?
	_clickHandler: function( event, target ) {
		var options = this.options;
		if ( options.disabled ) {
			return;
		}

		// called only when using activate(false) to close all parts programmatically
		if ( !event.target ) {
			if ( !options.collapsible ) {
				return;
			}
			this.active
				.removeClass( "ui-state-active ui-corner-top" )
				.addClass( "ui-state-default ui-corner-all" )
				.children( ".ui-icon" )
					.removeClass( options.icons.headerSelected )
					.addClass( options.icons.header );
			this.active.next().addClass( "ui-accordion-content-active" );
			var toHide = this.active.next(),
				data = {
					options: options,
					newHeader: $( [] ),
					oldHeader: options.active,
					newContent: $( [] ),
					oldContent: toHide
				},
				toShow = ( this.active = $( [] ) );
			this._toggle( toShow, toHide, data );
			return;
		}

		// get the click target
		var clicked = $( event.currentTarget || target ),
			clickedIsActive = clicked[0] === this.active[0];

		// TODO the option is changed, is that correct?
		// TODO if it is correct, shouldn't that happen after determining that the click is valid?
		options.active = options.collapsible && clickedIsActive ?
			false :
			this.headers.index( clicked );

		// if animations are still active, or the active header is the target, ignore click
		if ( this.running || ( !options.collapsible && clickedIsActive ) ) {
			return;
		}

		// find elements to show and hide
		var active = this.active,
			toShow = clicked.next(),
			toHide = this.active.next(),
			data = {
				options: options,
				newHeader: clickedIsActive && options.collapsible ? $([]) : clicked,
				oldHeader: this.active,
				newContent: clickedIsActive && options.collapsible ? $([]) : toShow,
				oldContent: toHide
			},
			down = this.headers.index( this.active[0] ) > this.headers.index( clicked[0] );

		// when the call to ._toggle() comes after the class changes
		// it causes a very odd bug in IE 8 (see #6720)
		this.active = clickedIsActive ? $([]) : clicked;
		this._toggle( toShow, toHide, data, clickedIsActive, down );

		// switch classes
		active
			.removeClass( "ui-state-active ui-corner-top" )
			.addClass( "ui-state-default ui-corner-all" )
			.children( ".ui-icon" )
				.removeClass( options.icons.headerSelected )
				.addClass( options.icons.header );
		if ( !clickedIsActive ) {
			clicked
				.removeClass( "ui-state-default ui-corner-all" )
				.addClass( "ui-state-active ui-corner-top" )
				.children( ".ui-icon" )
					.removeClass( options.icons.header )
					.addClass( options.icons.headerSelected );
			clicked
				.next()
				.addClass( "ui-accordion-content-active" );
		}

		return;
	},

	_toggle: function( toShow, toHide, data, clickedIsActive, down ) {
		var self = this,
			options = self.options;

		self.toShow = toShow;
		self.toHide = toHide;
		self.data = data;

		var complete = function() {
			if ( !self ) {
				return;
			}
			return self._completed.apply( self, arguments );
		};

		// trigger changestart event
		self._trigger( "changestart", null, self.data );

		// count elements to animate
		self.running = toHide.size() === 0 ? toShow.size() : toHide.size();

		if ( options.animated ) {
			var animOptions = {};

			if ( options.collapsible && clickedIsActive ) {
				animOptions = {
					toShow: $( [] ),
					toHide: toHide,
					complete: complete,
					down: down,
					autoHeight: options.autoHeight || options.fillSpace
				};
			} else {
				animOptions = {
					toShow: toShow,
					toHide: toHide,
					complete: complete,
					down: down,
					autoHeight: options.autoHeight || options.fillSpace
				};
			}

			if ( !options.proxied ) {
				options.proxied = options.animated;
			}

			if ( !options.proxiedDuration ) {
				options.proxiedDuration = options.duration;
			}

			options.animated = $.isFunction( options.proxied ) ?
				options.proxied( animOptions ) :
				options.proxied;

			options.duration = $.isFunction( options.proxiedDuration ) ?
				options.proxiedDuration( animOptions ) :
				options.proxiedDuration;

			var animations = $.ui.accordion.animations,
				duration = options.duration,
				easing = options.animated;

			if ( easing && !animations[ easing ] && !$.easing[ easing ] ) {
				easing = "slide";
			}
			if ( !animations[ easing ] ) {
				animations[ easing ] = function( options ) {
					this.slide( options, {
						easing: easing,
						duration: duration || 700
					});
				};
			}

			animations[ easing ]( animOptions );
		} else {
			if ( options.collapsible && clickedIsActive ) {
				toShow.toggle();
			} else {
				toHide.hide();
				toShow.show();
			}

			complete( true );
		}

		// TODO assert that the blur and focus triggers are really necessary, remove otherwise
		toHide.prev()
			.attr({
				"aria-expanded": "false",
				"aria-selected": "false",
				tabIndex: -1
			})
			.blur();
		toShow.prev()
			.attr({
				"aria-expanded": "true",
				"aria-selected": "true",
				tabIndex: 0
			})
			.focus();
	},

	_completed: function( cancel ) {
		this.running = cancel ? 0 : --this.running;
		if ( this.running ) {
			return;
		}

		if ( this.options.clearStyle ) {
			this.toShow.add( this.toHide ).css({
				height: "",
				overflow: ""
			});
		}

		// other classes are removed before the animation; this one needs to stay until completed
		this.toHide.removeClass( "ui-accordion-content-active" );
		// Work around for rendering bug in IE (#5421)
		if ( this.toHide.length ) {
			this.toHide.parent()[0].className = this.toHide.parent()[0].className;
		}

		this._trigger( "change", null, this.data );
	}
});

$.extend( $.ui.accordion, {
	version: "1.8.11",
	animations: {
		slide: function( options, additions ) {
			options = $.extend({
				easing: "swing",
				duration: 300
			}, options, additions );
			if ( !options.toHide.size() ) {
				options.toShow.animate({
					height: "show",
					paddingTop: "show",
					paddingBottom: "show"
				}, options );
				return;
			}
			if ( !options.toShow.size() ) {
				options.toHide.animate({
					height: "hide",
					paddingTop: "hide",
					paddingBottom: "hide"
				}, options );
				return;
			}
			var overflow = options.toShow.css( "overflow" ),
				percentDone = 0,
				showProps = {},
				hideProps = {},
				fxAttrs = [ "height", "paddingTop", "paddingBottom" ],
				originalWidth;
			// fix width before calculating height of hidden element
			var s = options.toShow;
			originalWidth = s[0].style.width;
			s.width( parseInt( s.parent().width(), 10 )
				- parseInt( s.css( "paddingLeft" ), 10 )
				- parseInt( s.css( "paddingRight" ), 10 )
				- ( parseInt( s.css( "borderLeftWidth" ), 10 ) || 0 )
				- ( parseInt( s.css( "borderRightWidth" ), 10) || 0 ) );

			$.each( fxAttrs, function( i, prop ) {
				hideProps[ prop ] = "hide";

				var parts = ( "" + $.css( options.toShow[0], prop ) ).match( /^([\d+-.]+)(.*)$/ );
				showProps[ prop ] = {
					value: parts[ 1 ],
					unit: parts[ 2 ] || "px"
				};
			});
			options.toShow.css({ height: 0, overflow: "hidden" }).show();
			options.toHide
				.filter( ":hidden" )
					.each( options.complete )
				.end()
				.filter( ":visible" )
				.animate( hideProps, {
				step: function( now, settings ) {
					// only calculate the percent when animating height
					// IE gets very inconsistent results when animating elements
					// with small values, which is common for padding
					if ( settings.prop == "height" ) {
						percentDone = ( settings.end - settings.start === 0 ) ? 0 :
							( settings.now - settings.start ) / ( settings.end - settings.start );
					}

					options.toShow[ 0 ].style[ settings.prop ] =
						( percentDone * showProps[ settings.prop ].value )
						+ showProps[ settings.prop ].unit;
				},
				duration: options.duration,
				easing: options.easing,
				complete: function() {
					if ( !options.autoHeight ) {
						options.toShow.css( "height", "" );
					}
					options.toShow.css({
						width: originalWidth,
						overflow: overflow
					});
					options.complete();
				}
			});
		},
		bounceslide: function( options ) {
			this.slide( options, {
				easing: options.down ? "easeOutBounce" : "swing",
				duration: options.down ? 1000 : 200
			});
		}
	}
});

})( jQuery );
/*
 * jQuery UI Autocomplete 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */
(function( $, undefined ) {

// used to prevent race conditions with remote data sources
var requestIndex = 0;

$.widget( "ui.autocomplete", {
	options: {
		appendTo: "body",
		autoFocus: false,
		delay: 300,
		minLength: 1,
		position: {
			my: "left top",
			at: "left bottom",
			collision: "none"
		},
		source: null
	},

	pending: 0,

	_create: function() {
		var self = this,
			doc = this.element[ 0 ].ownerDocument,
			suppressKeyPress;

		this.element
			.addClass( "ui-autocomplete-input" )
			.attr( "autocomplete", "off" )
			// TODO verify these actually work as intended
			.attr({
				role: "textbox",
				"aria-autocomplete": "list",
				"aria-haspopup": "true"
			})
			.bind( "keydown.autocomplete", function( event ) {
				if ( self.options.disabled || self.element.attr( "readonly" ) ) {
					return;
				}

				suppressKeyPress = false;
				var keyCode = $.ui.keyCode;
				switch( event.keyCode ) {
				case keyCode.PAGE_UP:
					self._move( "previousPage", event );
					break;
				case keyCode.PAGE_DOWN:
					self._move( "nextPage", event );
					break;
				case keyCode.UP:
					self._move( "previous", event );
					// prevent moving cursor to beginning of text field in some browsers
					event.preventDefault();
					break;
				case keyCode.DOWN:
					self._move( "next", event );
					// prevent moving cursor to end of text field in some browsers
					event.preventDefault();
					break;
				case keyCode.ENTER:
				case keyCode.NUMPAD_ENTER:
					// when menu is open and has focus
					if ( self.menu.active ) {
						// #6055 - Opera still allows the keypress to occur
						// which causes forms to submit
						suppressKeyPress = true;
						event.preventDefault();
					}
					//passthrough - ENTER and TAB both select the current element
				case keyCode.TAB:
					if ( !self.menu.active ) {
						return;
					}
					self.menu.select( event );
					break;
				case keyCode.ESCAPE:
					self.element.val( self.term );
					self.close( event );
					break;
				default:
					// keypress is triggered before the input value is changed
					clearTimeout( self.searching );
					self.searching = setTimeout(function() {
						// only search if the value has changed
						if ( self.term != self.element.val() ) {
							self.selectedItem = null;
							self.search( null, event );
						}
					}, self.options.delay );
					break;
				}
			})
			.bind( "keypress.autocomplete", function( event ) {
				if ( suppressKeyPress ) {
					suppressKeyPress = false;
					event.preventDefault();
				}
			})
			.bind( "focus.autocomplete", function() {
				if ( self.options.disabled ) {
					return;
				}

				self.selectedItem = null;
				self.previous = self.element.val();
			})
			.bind( "blur.autocomplete", function( event ) {
				if ( self.options.disabled ) {
					return;
				}

				clearTimeout( self.searching );
				// clicks on the menu (or a button to trigger a search) will cause a blur event
				self.closing = setTimeout(function() {
					self.close( event );
					self._change( event );
				}, 150 );
			});
		this._initSource();
		this.response = function() {
			return self._response.apply( self, arguments );
		};
		this.menu = $( "<ul></ul>" )
			.addClass( "ui-autocomplete" )
			.appendTo( $( this.options.appendTo || "body", doc )[0] )
			// prevent the close-on-blur in case of a "slow" click on the menu (long mousedown)
			.mousedown(function( event ) {
				// clicking on the scrollbar causes focus to shift to the body
				// but we can't detect a mouseup or a click immediately afterward
				// so we have to track the next mousedown and close the menu if
				// the user clicks somewhere outside of the autocomplete
				var menuElement = self.menu.element[ 0 ];
				if ( !$( event.target ).closest( ".ui-menu-item" ).length ) {
					setTimeout(function() {
						$( document ).one( 'mousedown', function( event ) {
							if ( event.target !== self.element[ 0 ] &&
								event.target !== menuElement &&
								!$.ui.contains( menuElement, event.target ) ) {
								self.close();
							}
						});
					}, 1 );
				}

				// use another timeout to make sure the blur-event-handler on the input was already triggered
				setTimeout(function() {
					clearTimeout( self.closing );
				}, 13);
			})
			.menu({
				focus: function( event, ui ) {
					var item = ui.item.data( "item.autocomplete" );
					if ( false !== self._trigger( "focus", event, { item: item } ) ) {
						// use value to match what will end up in the input, if it was a key event
						if ( /^key/.test(event.originalEvent.type) ) {
							self.element.val( item.value );
						}
					}
				},
				selected: function( event, ui ) {
					var item = ui.item.data( "item.autocomplete" ),
						previous = self.previous;

					// only trigger when focus was lost (click on menu)
					if ( self.element[0] !== doc.activeElement ) {
						self.element.focus();
						self.previous = previous;
						// #6109 - IE triggers two focus events and the second
						// is asynchronous, so we need to reset the previous
						// term synchronously and asynchronously :-(
						setTimeout(function() {
							self.previous = previous;
							self.selectedItem = item;
						}, 1);
					}

					if ( false !== self._trigger( "select", event, { item: item } ) ) {
						self.element.val( item.value );
					}
					// reset the term after the select event
					// this allows custom select handling to work properly
					self.term = self.element.val();

					self.close( event );
					self.selectedItem = item;
				},
				blur: function( event, ui ) {
					// don't set the value of the text field if it's already correct
					// this prevents moving the cursor unnecessarily
					if ( self.menu.element.is(":visible") &&
						( self.element.val() !== self.term ) ) {
						self.element.val( self.term );
					}
				}
			})
			.zIndex( this.element.zIndex() + 1 )
			// workaround for jQuery bug #5781 http://dev.jquery.com/ticket/5781
			.css({ top: 0, left: 0 })
			.hide()
			.data( "menu" );
		if ( $.fn.bgiframe ) {
			 this.menu.element.bgiframe();
		}
	},

	destroy: function() {
		this.element
			.removeClass( "ui-autocomplete-input" )
			.removeAttr( "autocomplete" )
			.removeAttr( "role" )
			.removeAttr( "aria-autocomplete" )
			.removeAttr( "aria-haspopup" );
		this.menu.element.remove();
		$.Widget.prototype.destroy.call( this );
	},

	_setOption: function( key, value ) {
		$.Widget.prototype._setOption.apply( this, arguments );
		if ( key === "source" ) {
			this._initSource();
		}
		if ( key === "appendTo" ) {
			this.menu.element.appendTo( $( value || "body", this.element[0].ownerDocument )[0] )
		}
		if ( key === "disabled" && value && this.xhr ) {
			this.xhr.abort();
		}
	},

	_initSource: function() {
		var self = this,
			array,
			url;
		if ( $.isArray(this.options.source) ) {
			array = this.options.source;
			this.source = function( request, response ) {
				response( $.ui.autocomplete.filter(array, request.term) );
			};
		} else if ( typeof this.options.source === "string" ) {
			url = this.options.source;
			this.source = function( request, response ) {
				if ( self.xhr ) {
					self.xhr.abort();
				}
				self.xhr = $.ajax({
					url: url,
					data: request,
					dataType: "json",
					autocompleteRequest: ++requestIndex,
					success: function( data, status ) {
						if ( this.autocompleteRequest === requestIndex ) {
							response( data );
						}
					},
					error: function() {
						if ( this.autocompleteRequest === requestIndex ) {
							response( [] );
						}
					}
				});
			};
		} else {
			this.source = this.options.source;
		}
	},

	search: function( value, event ) {
		value = value != null ? value : this.element.val();

		// always save the actual value, not the one passed as an argument
		this.term = this.element.val();

		if ( value.length < this.options.minLength ) {
			return this.close( event );
		}

		clearTimeout( this.closing );
		if ( this._trigger( "search", event ) === false ) {
			return;
		}

		return this._search( value );
	},

	_search: function( value ) {
		this.pending++;
		this.element.addClass( "ui-autocomplete-loading" );

		this.source( { term: value }, this.response );
	},

	_response: function( content ) {
		if ( !this.options.disabled && content && content.length ) {
			content = this._normalize( content );
			this._suggest( content );
			this._trigger( "open" );
		} else {
			this.close();
		}
		this.pending--;
		if ( !this.pending ) {
			this.element.removeClass( "ui-autocomplete-loading" );
		}
	},

	close: function( event ) {
		clearTimeout( this.closing );
		if ( this.menu.element.is(":visible") ) {
			this.menu.element.hide();
			this.menu.deactivate();
			this._trigger( "close", event );
		}
	},
	
	_change: function( event ) {
		if ( this.previous !== this.element.val() ) {
			this._trigger( "change", event, { item: this.selectedItem } );
		}
	},

	_normalize: function( items ) {
		// assume all items have the right format when the first item is complete
		if ( items.length && items[0].label && items[0].value ) {
			return items;
		}
		return $.map( items, function(item) {
			if ( typeof item === "string" ) {
				return {
					label: item,
					value: item
				};
			}
			return $.extend({
				label: item.label || item.value,
				value: item.value || item.label
			}, item );
		});
	},

	_suggest: function( items ) {
		var ul = this.menu.element
			.empty()
			.zIndex( this.element.zIndex() + 1 );
		this._renderMenu( ul, items );
		// TODO refresh should check if the active item is still in the dom, removing the need for a manual deactivate
		this.menu.deactivate();
		this.menu.refresh();

		// size and position menu
		ul.show();
		this._resizeMenu();
		ul.position( $.extend({
			of: this.element
		}, this.options.position ));

		if ( this.options.autoFocus ) {
			this.menu.next( new $.Event("mouseover") );
		}
	},

	_resizeMenu: function() {
		var ul = this.menu.element;
		ul.outerWidth( Math.max(
			ul.width( "" ).outerWidth(),
			this.element.outerWidth()
		) );
	},

	_renderMenu: function( ul, items ) {
		var self = this;
		$.each( items, function( index, item ) {
			self._renderItem( ul, item );
		});
	},

	_renderItem: function( ul, item) {
		return $( "<li></li>" )
			.data( "item.autocomplete", item )
			.append( $( "<a></a>" ).text( item.label ) )
			.appendTo( ul );
	},

	_move: function( direction, event ) {
		if ( !this.menu.element.is(":visible") ) {
			this.search( null, event );
			return;
		}
		if ( this.menu.first() && /^previous/.test(direction) ||
				this.menu.last() && /^next/.test(direction) ) {
			this.element.val( this.term );
			this.menu.deactivate();
			return;
		}
		this.menu[ direction ]( event );
	},

	widget: function() {
		return this.menu.element;
	}
});

$.extend( $.ui.autocomplete, {
	escapeRegex: function( value ) {
		return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
	},
	filter: function(array, term) {
		var matcher = new RegExp( $.ui.autocomplete.escapeRegex(term), "i" );
		return $.grep( array, function(value) {
			return matcher.test( value.label || value.value || value );
		});
	}
});

}( jQuery ));

/*
 * jQuery UI Menu (not officially released)
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */
(function($) {

$.widget("ui.menu", {
	_create: function() {
		var self = this;
		this.element
			.addClass("ui-menu ui-widget ui-widget-content ui-corner-all")
			.attr({
				role: "listbox",
				"aria-activedescendant": "ui-active-menuitem"
			})
			.click(function( event ) {
				if ( !$( event.target ).closest( ".ui-menu-item a" ).length ) {
					return;
				}
				// temporary
				event.preventDefault();
				self.select( event );
			});
		this.refresh();
	},
	
	refresh: function() {
		var self = this;

		// don't refresh list items that are already adapted
		var items = this.element.children("li:not(.ui-menu-item):has(a)")
			.addClass("ui-menu-item")
			.attr("role", "menuitem");
		
		items.children("a")
			.addClass("ui-corner-all")
			.attr("tabindex", -1)
			// mouseenter doesn't work with event delegation
			.mouseenter(function( event ) {
				self.activate( event, $(this).parent() );
			})
			.mouseleave(function() {
				self.deactivate();
			});
	},

	activate: function( event, item ) {
		this.deactivate();
		if (this.hasScroll()) {
			var offset = item.offset().top - this.element.offset().top,
				scroll = this.element.attr("scrollTop"),
				elementHeight = this.element.height();
			if (offset < 0) {
				this.element.attr("scrollTop", scroll + offset);
			} else if (offset >= elementHeight) {
				this.element.attr("scrollTop", scroll + offset - elementHeight + item.height());
			}
		}
		this.active = item.eq(0)
			.children("a")
				.addClass("ui-state-hover")
				.attr("id", "ui-active-menuitem")
			.end();
		this._trigger("focus", event, { item: item });
	},

	deactivate: function() {
		if (!this.active) { return; }

		this.active.children("a")
			.removeClass("ui-state-hover")
			.removeAttr("id");
		this._trigger("blur");
		this.active = null;
	},

	next: function(event) {
		this.move("next", ".ui-menu-item:first", event);
	},

	previous: function(event) {
		this.move("prev", ".ui-menu-item:last", event);
	},

	first: function() {
		return this.active && !this.active.prevAll(".ui-menu-item").length;
	},

	last: function() {
		return this.active && !this.active.nextAll(".ui-menu-item").length;
	},

	move: function(direction, edge, event) {
		if (!this.active) {
			this.activate(event, this.element.children(edge));
			return;
		}
		var next = this.active[direction + "All"](".ui-menu-item").eq(0);
		if (next.length) {
			this.activate(event, next);
		} else {
			this.activate(event, this.element.children(edge));
		}
	},

	// TODO merge with previousPage
	nextPage: function(event) {
		if (this.hasScroll()) {
			// TODO merge with no-scroll-else
			if (!this.active || this.last()) {
				this.activate(event, this.element.children(".ui-menu-item:first"));
				return;
			}
			var base = this.active.offset().top,
				height = this.element.height(),
				result = this.element.children(".ui-menu-item").filter(function() {
					var close = $(this).offset().top - base - height + $(this).height();
					// TODO improve approximation
					return close < 10 && close > -10;
				});

			// TODO try to catch this earlier when scrollTop indicates the last page anyway
			if (!result.length) {
				result = this.element.children(".ui-menu-item:last");
			}
			this.activate(event, result);
		} else {
			this.activate(event, this.element.children(".ui-menu-item")
				.filter(!this.active || this.last() ? ":first" : ":last"));
		}
	},

	// TODO merge with nextPage
	previousPage: function(event) {
		if (this.hasScroll()) {
			// TODO merge with no-scroll-else
			if (!this.active || this.first()) {
				this.activate(event, this.element.children(".ui-menu-item:last"));
				return;
			}

			var base = this.active.offset().top,
				height = this.element.height();
				result = this.element.children(".ui-menu-item").filter(function() {
					var close = $(this).offset().top - base + height - $(this).height();
					// TODO improve approximation
					return close < 10 && close > -10;
				});

			// TODO try to catch this earlier when scrollTop indicates the last page anyway
			if (!result.length) {
				result = this.element.children(".ui-menu-item:first");
			}
			this.activate(event, result);
		} else {
			this.activate(event, this.element.children(".ui-menu-item")
				.filter(!this.active || this.first() ? ":last" : ":first"));
		}
	},

	hasScroll: function() {
		return this.element.height() < this.element.attr("scrollHeight");
	},

	select: function( event ) {
		this._trigger("selected", event, { item: this.active });
	}
});

}(jQuery));
/*
 * jQuery UI Button 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Button
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

var lastActive,
	baseClasses = "ui-button ui-widget ui-state-default ui-corner-all",
	stateClasses = "ui-state-hover ui-state-active ",
	typeClasses = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",
	formResetHandler = function( event ) {
		$( ":ui-button", event.target.form ).each(function() {
			var inst = $( this ).data( "button" );
			setTimeout(function() {
				inst.refresh();
			}, 1 );
		});
	},
	radioGroup = function( radio ) {
		var name = radio.name,
			form = radio.form,
			radios = $( [] );
		if ( name ) {
			if ( form ) {
				radios = $( form ).find( "[name='" + name + "']" );
			} else {
				radios = $( "[name='" + name + "']", radio.ownerDocument )
					.filter(function() {
						return !this.form;
					});
			}
		}
		return radios;
	};

$.widget( "ui.button", {
	options: {
		disabled: null,
		text: true,
		label: null,
		icons: {
			primary: null,
			secondary: null
		}
	},
	_create: function() {
		this.element.closest( "form" )
			.unbind( "reset.button" )
			.bind( "reset.button", formResetHandler );

		if ( typeof this.options.disabled !== "boolean" ) {
			this.options.disabled = this.element.attr( "disabled" );
		}

		this._determineButtonType();
		this.hasTitle = !!this.buttonElement.attr( "title" );

		var self = this,
			options = this.options,
			toggleButton = this.type === "checkbox" || this.type === "radio",
			hoverClass = "ui-state-hover" + ( !toggleButton ? " ui-state-active" : "" ),
			focusClass = "ui-state-focus";

		if ( options.label === null ) {
			options.label = this.buttonElement.html();
		}

		if ( this.element.is( ":disabled" ) ) {
			options.disabled = true;
		}

		this.buttonElement
			.addClass( baseClasses )
			.attr( "role", "button" )
			.bind( "mouseenter.button", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).addClass( "ui-state-hover" );
				if ( this === lastActive ) {
					$( this ).addClass( "ui-state-active" );
				}
			})
			.bind( "mouseleave.button", function() {
				if ( options.disabled ) {
					return;
				}
				$( this ).removeClass( hoverClass );
			})
			.bind( "focus.button", function() {
				// no need to check disabled, focus won't be triggered anyway
				$( this ).addClass( focusClass );
			})
			.bind( "blur.button", function() {
				$( this ).removeClass( focusClass );
			});

		if ( toggleButton ) {
			this.element.bind( "change.button", function() {
				self.refresh();
			});
		}

		if ( this.type === "checkbox" ) {
			this.buttonElement.bind( "click.button", function() {
				if ( options.disabled ) {
					return false;
				}
				$( this ).toggleClass( "ui-state-active" );
				self.buttonElement.attr( "aria-pressed", self.element[0].checked );
			});
		} else if ( this.type === "radio" ) {
			this.buttonElement.bind( "click.button", function() {
				if ( options.disabled ) {
					return false;
				}
				$( this ).addClass( "ui-state-active" );
				self.buttonElement.attr( "aria-pressed", true );

				var radio = self.element[ 0 ];
				radioGroup( radio )
					.not( radio )
					.map(function() {
						return $( this ).button( "widget" )[ 0 ];
					})
					.removeClass( "ui-state-active" )
					.attr( "aria-pressed", false );
			});
		} else {
			this.buttonElement
				.bind( "mousedown.button", function() {
					if ( options.disabled ) {
						return false;
					}
					$( this ).addClass( "ui-state-active" );
					lastActive = this;
					$( document ).one( "mouseup", function() {
						lastActive = null;
					});
				})
				.bind( "mouseup.button", function() {
					if ( options.disabled ) {
						return false;
					}
					$( this ).removeClass( "ui-state-active" );
				})
				.bind( "keydown.button", function(event) {
					if ( options.disabled ) {
						return false;
					}
					if ( event.keyCode == $.ui.keyCode.SPACE || event.keyCode == $.ui.keyCode.ENTER ) {
						$( this ).addClass( "ui-state-active" );
					}
				})
				.bind( "keyup.button", function() {
					$( this ).removeClass( "ui-state-active" );
				});

			if ( this.buttonElement.is("a") ) {
				this.buttonElement.keyup(function(event) {
					if ( event.keyCode === $.ui.keyCode.SPACE ) {
						// TODO pass through original event correctly (just as 2nd argument doesn't work)
						$( this ).click();
					}
				});
			}
		}

		// TODO: pull out $.Widget's handling for the disabled option into
		// $.Widget.prototype._setOptionDisabled so it's easy to proxy and can
		// be overridden by individual plugins
		this._setOption( "disabled", options.disabled );
	},

	_determineButtonType: function() {
		
		if ( this.element.is(":checkbox") ) {
			this.type = "checkbox";
		} else {
			if ( this.element.is(":radio") ) {
				this.type = "radio";
			} else {
				if ( this.element.is("input") ) {
					this.type = "input";
				} else {
					this.type = "button";
				}
			}
		}
		
		if ( this.type === "checkbox" || this.type === "radio" ) {
			// we don't search against the document in case the element
			// is disconnected from the DOM
			var ancestor = this.element.parents().filter(":last"),
				labelSelector = "label[for=" + this.element.attr("id") + "]";
			this.buttonElement = ancestor.find( labelSelector );
			if ( !this.buttonElement.length ) {
				ancestor = ancestor.length ? ancestor.siblings() : this.element.siblings();
				this.buttonElement = ancestor.filter( labelSelector );
				if ( !this.buttonElement.length ) {
					this.buttonElement = ancestor.find( labelSelector );
				}
			}
			this.element.addClass( "ui-helper-hidden-accessible" );

			var checked = this.element.is( ":checked" );
			if ( checked ) {
				this.buttonElement.addClass( "ui-state-active" );
			}
			this.buttonElement.attr( "aria-pressed", checked );
		} else {
			this.buttonElement = this.element;
		}
	},

	widget: function() {
		return this.buttonElement;
	},

	destroy: function() {
		this.element
			.removeClass( "ui-helper-hidden-accessible" );
		this.buttonElement
			.removeClass( baseClasses + " " + stateClasses + " " + typeClasses )
			.removeAttr( "role" )
			.removeAttr( "aria-pressed" )
			.html( this.buttonElement.find(".ui-button-text").html() );

		if ( !this.hasTitle ) {
			this.buttonElement.removeAttr( "title" );
		}

		$.Widget.prototype.destroy.call( this );
	},

	_setOption: function( key, value ) {
		$.Widget.prototype._setOption.apply( this, arguments );
		if ( key === "disabled" ) {
			if ( value ) {
				this.element.attr( "disabled", true );
			} else {
				this.element.removeAttr( "disabled" );
			}
		}
		this._resetButton();
	},

	refresh: function() {
		var isDisabled = this.element.is( ":disabled" );
		if ( isDisabled !== this.options.disabled ) {
			this._setOption( "disabled", isDisabled );
		}
		if ( this.type === "radio" ) {
			radioGroup( this.element[0] ).each(function() {
				if ( $( this ).is( ":checked" ) ) {
					$( this ).button( "widget" )
						.addClass( "ui-state-active" )
						.attr( "aria-pressed", true );
				} else {
					$( this ).button( "widget" )
						.removeClass( "ui-state-active" )
						.attr( "aria-pressed", false );
				}
			});
		} else if ( this.type === "checkbox" ) {
			if ( this.element.is( ":checked" ) ) {
				this.buttonElement
					.addClass( "ui-state-active" )
					.attr( "aria-pressed", true );
			} else {
				this.buttonElement
					.removeClass( "ui-state-active" )
					.attr( "aria-pressed", false );
			}
		}
	},

	_resetButton: function() {
		if ( this.type === "input" ) {
			if ( this.options.label ) {
				this.element.val( this.options.label );
			}
			return;
		}
		var buttonElement = this.buttonElement.removeClass( typeClasses ),
			buttonText = $( "<span></span>" )
				.addClass( "ui-button-text" )
				.html( this.options.label )
				.appendTo( buttonElement.empty() )
				.text(),
			icons = this.options.icons,
			multipleIcons = icons.primary && icons.secondary,
			buttonClasses = [];  

		if ( icons.primary || icons.secondary ) {
			if ( this.options.text ) {
				buttonClasses.push( "ui-button-text-icon" + ( multipleIcons ? "s" : ( icons.primary ? "-primary" : "-secondary" ) ) );
			}

			if ( icons.primary ) {
				buttonElement.prepend( "<span class='ui-button-icon-primary ui-icon " + icons.primary + "'></span>" );
			}

			if ( icons.secondary ) {
				buttonElement.append( "<span class='ui-button-icon-secondary ui-icon " + icons.secondary + "'></span>" );
			}

			if ( !this.options.text ) {
				buttonClasses.push( multipleIcons ? "ui-button-icons-only" : "ui-button-icon-only" );

				if ( !this.hasTitle ) {
					buttonElement.attr( "title", buttonText );
				}
			}
		} else {
			buttonClasses.push( "ui-button-text-only" );
		}
		buttonElement.addClass( buttonClasses.join( " " ) );
	}
});

$.widget( "ui.buttonset", {
	options: {
		items: ":button, :submit, :reset, :checkbox, :radio, a, :data(button)"
	},

	_create: function() {
		this.element.addClass( "ui-buttonset" );
	},
	
	_init: function() {
		this.refresh();
	},

	_setOption: function( key, value ) {
		if ( key === "disabled" ) {
			this.buttons.button( "option", key, value );
		}

		$.Widget.prototype._setOption.apply( this, arguments );
	},
	
	refresh: function() {
		this.buttons = this.element.find( this.options.items )
			.filter( ":ui-button" )
				.button( "refresh" )
			.end()
			.not( ":ui-button" )
				.button()
			.end()
			.map(function() {
				return $( this ).button( "widget" )[ 0 ];
			})
				.removeClass( "ui-corner-all ui-corner-left ui-corner-right" )
				.filter( ":first" )
					.addClass( "ui-corner-left" )
				.end()
				.filter( ":last" )
					.addClass( "ui-corner-right" )
				.end()
			.end();
	},

	destroy: function() {
		this.element.removeClass( "ui-buttonset" );
		this.buttons
			.map(function() {
				return $( this ).button( "widget" )[ 0 ];
			})
				.removeClass( "ui-corner-left ui-corner-right" )
			.end()
			.button( "destroy" );

		$.Widget.prototype.destroy.call( this );
	}
});

}( jQuery ) );
/*
 * jQuery UI Dialog 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Dialog
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *  jquery.ui.button.js
 *	jquery.ui.draggable.js
 *	jquery.ui.mouse.js
 *	jquery.ui.position.js
 *	jquery.ui.resizable.js
 */
(function( $, undefined ) {

var uiDialogClasses =
		'ui-dialog ' +
		'ui-widget ' +
		'ui-widget-content ' +
		'ui-corner-all ',
	sizeRelatedOptions = {
		buttons: true,
		height: true,
		maxHeight: true,
		maxWidth: true,
		minHeight: true,
		minWidth: true,
		width: true
	},
	resizableRelatedOptions = {
		maxHeight: true,
		maxWidth: true,
		minHeight: true,
		minWidth: true
	};

$.widget("ui.dialog", {
	options: {
		autoOpen: true,
		buttons: {},
		closeOnEscape: true,
		closeText: 'close',
		dialogClass: '',
		draggable: true,
		hide: null,
		height: 'auto',
		maxHeight: false,
		maxWidth: false,
		minHeight: 150,
		minWidth: 150,
		modal: false,
		position: {
			my: 'center',
			at: 'center',
			collision: 'fit',
			// ensure that the titlebar is never outside the document
			using: function(pos) {
				var topOffset = $(this).css(pos).offset().top;
				if (topOffset < 0) {
					$(this).css('top', pos.top - topOffset);
				}
			}
		},
		resizable: true,
		show: null,
		stack: true,
		title: '',
		width: 300,
		zIndex: 1000
	},

	_create: function() {
		this.originalTitle = this.element.attr('title');
		// #5742 - .attr() might return a DOMElement
		if ( typeof this.originalTitle !== "string" ) {
			this.originalTitle = "";
		}

		this.options.title = this.options.title || this.originalTitle;
		var self = this,
			options = self.options,

			title = options.title || '&#160;',
			titleId = $.ui.dialog.getTitleId(self.element),

			uiDialog = (self.uiDialog = $('<div></div>'))
				.appendTo(document.body)
				.hide()
				.addClass(uiDialogClasses + options.dialogClass)
				.css({
					zIndex: options.zIndex
				})
				// setting tabIndex makes the div focusable
				// setting outline to 0 prevents a border on focus in Mozilla
				.attr('tabIndex', -1).css('outline', 0).keydown(function(event) {
					if (options.closeOnEscape && event.keyCode &&
						event.keyCode === $.ui.keyCode.ESCAPE) {
						
						self.close(event);
						event.preventDefault();
					}
				})
				.attr({
					role: 'dialog',
					'aria-labelledby': titleId
				})
				.mousedown(function(event) {
					self.moveToTop(false, event);
				}),

			uiDialogContent = self.element
				.show()
				.removeAttr('title')
				.addClass(
					'ui-dialog-content ' +
					'ui-widget-content')
				.appendTo(uiDialog),

			uiDialogTitlebar = (self.uiDialogTitlebar = $('<div></div>'))
				.addClass(
					'ui-dialog-titlebar ' +
					'ui-widget-header ' +
					'ui-corner-all ' +
					'ui-helper-clearfix'
				)
				.prependTo(uiDialog),

			uiDialogTitlebarClose = $('<a href="#"></a>')
				.addClass(
					'ui-dialog-titlebar-close ' +
					'ui-corner-all'
				)
				.attr('role', 'button')
				.hover(
					function() {
						uiDialogTitlebarClose.addClass('ui-state-hover');
					},
					function() {
						uiDialogTitlebarClose.removeClass('ui-state-hover');
					}
				)
				.focus(function() {
					uiDialogTitlebarClose.addClass('ui-state-focus');
				})
				.blur(function() {
					uiDialogTitlebarClose.removeClass('ui-state-focus');
				})
				.click(function(event) {
					self.close(event);
					return false;
				})
				.appendTo(uiDialogTitlebar),

			uiDialogTitlebarCloseText = (self.uiDialogTitlebarCloseText = $('<span></span>'))
				.addClass(
					'ui-icon ' +
					'ui-icon-closethick'
				)
				.text(options.closeText)
				.appendTo(uiDialogTitlebarClose),

			uiDialogTitle = $('<span></span>')
				.addClass('ui-dialog-title')
				.attr('id', titleId)
				.html(title)
				.prependTo(uiDialogTitlebar);

		//handling of deprecated beforeclose (vs beforeClose) option
		//Ticket #4669 http://dev.jqueryui.com/ticket/4669
		//TODO: remove in 1.9pre
		if ($.isFunction(options.beforeclose) && !$.isFunction(options.beforeClose)) {
			options.beforeClose = options.beforeclose;
		}

		uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();

		if (options.draggable && $.fn.draggable) {
			self._makeDraggable();
		}
		if (options.resizable && $.fn.resizable) {
			self._makeResizable();
		}

		self._createButtons(options.buttons);
		self._isOpen = false;

		if ($.fn.bgiframe) {
			uiDialog.bgiframe();
		}
	},

	_init: function() {
		if ( this.options.autoOpen ) {
			this.open();
		}
	},

	destroy: function() {
		var self = this;
		
		if (self.overlay) {
			self.overlay.destroy();
		}
		self.uiDialog.hide();
		self.element
			.unbind('.dialog')
			.removeData('dialog')
			.removeClass('ui-dialog-content ui-widget-content')
			.hide().appendTo('body');
		self.uiDialog.remove();

		if (self.originalTitle) {
			self.element.attr('title', self.originalTitle);
		}

		return self;
	},

	widget: function() {
		return this.uiDialog;
	},

	close: function(event) {
		var self = this,
			maxZ, thisZ;
		
		if (false === self._trigger('beforeClose', event)) {
			return;
		}

		if (self.overlay) {
			self.overlay.destroy();
		}
		self.uiDialog.unbind('keypress.ui-dialog');

		self._isOpen = false;

		if (self.options.hide) {
			self.uiDialog.hide(self.options.hide, function() {
				self._trigger('close', event);
			});
		} else {
			self.uiDialog.hide();
			self._trigger('close', event);
		}

		$.ui.dialog.overlay.resize();

		// adjust the maxZ to allow other modal dialogs to continue to work (see #4309)
		if (self.options.modal) {
			maxZ = 0;
			$('.ui-dialog').each(function() {
				if (this !== self.uiDialog[0]) {
					thisZ = $(this).css('z-index');
					if(!isNaN(thisZ)) {
						maxZ = Math.max(maxZ, thisZ);
					}
				}
			});
			$.ui.dialog.maxZ = maxZ;
		}

		return self;
	},

	isOpen: function() {
		return this._isOpen;
	},

	// the force parameter allows us to move modal dialogs to their correct
	// position on open
	moveToTop: function(force, event) {
		var self = this,
			options = self.options,
			saveScroll;

		if ((options.modal && !force) ||
			(!options.stack && !options.modal)) {
			return self._trigger('focus', event);
		}

		if (options.zIndex > $.ui.dialog.maxZ) {
			$.ui.dialog.maxZ = options.zIndex;
		}
		if (self.overlay) {
			$.ui.dialog.maxZ += 1;
			self.overlay.$el.css('z-index', $.ui.dialog.overlay.maxZ = $.ui.dialog.maxZ);
		}

		//Save and then restore scroll since Opera 9.5+ resets when parent z-Index is changed.
		//  http://ui.jquery.com/bugs/ticket/3193
		saveScroll = { scrollTop: self.element.attr('scrollTop'), scrollLeft: self.element.attr('scrollLeft') };
		$.ui.dialog.maxZ += 1;
		self.uiDialog.css('z-index', $.ui.dialog.maxZ);
		self.element.attr(saveScroll);
		self._trigger('focus', event);

		return self;
	},

	open: function() {
		if (this._isOpen) { return; }

		var self = this,
			options = self.options,
			uiDialog = self.uiDialog;

		self.overlay = options.modal ? new $.ui.dialog.overlay(self) : null;
		self._size();
		self._position(options.position);
		uiDialog.show(options.show);
		self.moveToTop(true);

		// prevent tabbing out of modal dialogs
		if (options.modal) {
			uiDialog.bind('keypress.ui-dialog', function(event) {
				if (event.keyCode !== $.ui.keyCode.TAB) {
					return;
				}

				var tabbables = $(':tabbable', this),
					first = tabbables.filter(':first'),
					last  = tabbables.filter(':last');

				if (event.target === last[0] && !event.shiftKey) {
					first.focus(1);
					return false;
				} else if (event.target === first[0] && event.shiftKey) {
					last.focus(1);
					return false;
				}
			});
		}

		// set focus to the first tabbable element in the content area or the first button
		// if there are no tabbable elements, set focus on the dialog itself
		$(self.element.find(':tabbable').get().concat(
			uiDialog.find('.ui-dialog-buttonpane :tabbable').get().concat(
				uiDialog.get()))).eq(0).focus();

		self._isOpen = true;
		self._trigger('open');

		return self;
	},

	_createButtons: function(buttons) {
		var self = this,
			hasButtons = false,
			uiDialogButtonPane = $('<div></div>')
				.addClass(
					'ui-dialog-buttonpane ' +
					'ui-widget-content ' +
					'ui-helper-clearfix'
				),
			uiButtonSet = $( "<div></div>" )
				.addClass( "ui-dialog-buttonset" )
				.appendTo( uiDialogButtonPane );

		// if we already have a button pane, remove it
		self.uiDialog.find('.ui-dialog-buttonpane').remove();

		if (typeof buttons === 'object' && buttons !== null) {
			$.each(buttons, function() {
				return !(hasButtons = true);
			});
		}
		if (hasButtons) {
			$.each(buttons, function(name, props) {
				props = $.isFunction( props ) ?
					{ click: props, text: name } :
					props;
				var button = $('<button type="button"></button>')
					.attr( props, true )
					.unbind('click')
					.click(function() {
						props.click.apply(self.element[0], arguments);
					})
					.appendTo(uiButtonSet);
				if ($.fn.button) {
					button.button();
				}
			});
			uiDialogButtonPane.appendTo(self.uiDialog);
		}
	},

	_makeDraggable: function() {
		var self = this,
			options = self.options,
			doc = $(document),
			heightBeforeDrag;

		function filteredUi(ui) {
			return {
				position: ui.position,
				offset: ui.offset
			};
		}

		self.uiDialog.draggable({
			cancel: '.ui-dialog-content, .ui-dialog-titlebar-close',
			handle: '.ui-dialog-titlebar',
			containment: 'document',
			start: function(event, ui) {
				heightBeforeDrag = options.height === "auto" ? "auto" : $(this).height();
				$(this).height($(this).height()).addClass("ui-dialog-dragging");
				self._trigger('dragStart', event, filteredUi(ui));
			},
			drag: function(event, ui) {
				self._trigger('drag', event, filteredUi(ui));
			},
			stop: function(event, ui) {
				options.position = [ui.position.left - doc.scrollLeft(),
					ui.position.top - doc.scrollTop()];
				$(this).removeClass("ui-dialog-dragging").height(heightBeforeDrag);
				self._trigger('dragStop', event, filteredUi(ui));
				$.ui.dialog.overlay.resize();
			}
		});
	},

	_makeResizable: function(handles) {
		handles = (handles === undefined ? this.options.resizable : handles);
		var self = this,
			options = self.options,
			// .ui-resizable has position: relative defined in the stylesheet
			// but dialogs have to use absolute or fixed positioning
			position = self.uiDialog.css('position'),
			resizeHandles = (typeof handles === 'string' ?
				handles	:
				'n,e,s,w,se,sw,ne,nw'
			);

		function filteredUi(ui) {
			return {
				originalPosition: ui.originalPosition,
				originalSize: ui.originalSize,
				position: ui.position,
				size: ui.size
			};
		}

		self.uiDialog.resizable({
			cancel: '.ui-dialog-content',
			containment: 'document',
			alsoResize: self.element,
			maxWidth: options.maxWidth,
			maxHeight: options.maxHeight,
			minWidth: options.minWidth,
			minHeight: self._minHeight(),
			handles: resizeHandles,
			start: function(event, ui) {
				$(this).addClass("ui-dialog-resizing");
				self._trigger('resizeStart', event, filteredUi(ui));
			},
			resize: function(event, ui) {
				self._trigger('resize', event, filteredUi(ui));
			},
			stop: function(event, ui) {
				$(this).removeClass("ui-dialog-resizing");
				options.height = $(this).height();
				options.width = $(this).width();
				self._trigger('resizeStop', event, filteredUi(ui));
				$.ui.dialog.overlay.resize();
			}
		})
		.css('position', position)
		.find('.ui-resizable-se').addClass('ui-icon ui-icon-grip-diagonal-se');
	},

	_minHeight: function() {
		var options = this.options;

		if (options.height === 'auto') {
			return options.minHeight;
		} else {
			return Math.min(options.minHeight, options.height);
		}
	},

	_position: function(position) {
		var myAt = [],
			offset = [0, 0],
			isVisible;

		if (position) {
			// deep extending converts arrays to objects in jQuery <= 1.3.2 :-(
	//		if (typeof position == 'string' || $.isArray(position)) {
	//			myAt = $.isArray(position) ? position : position.split(' ');

			if (typeof position === 'string' || (typeof position === 'object' && '0' in position)) {
				myAt = position.split ? position.split(' ') : [position[0], position[1]];
				if (myAt.length === 1) {
					myAt[1] = myAt[0];
				}

				$.each(['left', 'top'], function(i, offsetPosition) {
					if (+myAt[i] === myAt[i]) {
						offset[i] = myAt[i];
						myAt[i] = offsetPosition;
					}
				});

				position = {
					my: myAt.join(" "),
					at: myAt.join(" "),
					offset: offset.join(" ")
				};
			} 

			position = $.extend({}, $.ui.dialog.prototype.options.position, position);
		} else {
			position = $.ui.dialog.prototype.options.position;
		}

		// need to show the dialog to get the actual offset in the position plugin
		isVisible = this.uiDialog.is(':visible');
		if (!isVisible) {
			this.uiDialog.show();
		}
		this.uiDialog
			// workaround for jQuery bug #5781 http://dev.jquery.com/ticket/5781
			.css({ top: 0, left: 0 })
			.position($.extend({ of: window }, position));
		if (!isVisible) {
			this.uiDialog.hide();
		}
	},

	_setOptions: function( options ) {
		var self = this,
			resizableOptions = {},
			resize = false;

		$.each( options, function( key, value ) {
			self._setOption( key, value );
			
			if ( key in sizeRelatedOptions ) {
				resize = true;
			}
			if ( key in resizableRelatedOptions ) {
				resizableOptions[ key ] = value;
			}
		});

		if ( resize ) {
			this._size();
		}
		if ( this.uiDialog.is( ":data(resizable)" ) ) {
			this.uiDialog.resizable( "option", resizableOptions );
		}
	},

	_setOption: function(key, value){
		var self = this,
			uiDialog = self.uiDialog;

		switch (key) {
			//handling of deprecated beforeclose (vs beforeClose) option
			//Ticket #4669 http://dev.jqueryui.com/ticket/4669
			//TODO: remove in 1.9pre
			case "beforeclose":
				key = "beforeClose";
				break;
			case "buttons":
				self._createButtons(value);
				break;
			case "closeText":
				// ensure that we always pass a string
				self.uiDialogTitlebarCloseText.text("" + value);
				break;
			case "dialogClass":
				uiDialog
					.removeClass(self.options.dialogClass)
					.addClass(uiDialogClasses + value);
				break;
			case "disabled":
				if (value) {
					uiDialog.addClass('ui-dialog-disabled');
				} else {
					uiDialog.removeClass('ui-dialog-disabled');
				}
				break;
			case "draggable":
				var isDraggable = uiDialog.is( ":data(draggable)" );
				if ( isDraggable && !value ) {
					uiDialog.draggable( "destroy" );
				}
				
				if ( !isDraggable && value ) {
					self._makeDraggable();
				}
				break;
			case "position":
				self._position(value);
				break;
			case "resizable":
				// currently resizable, becoming non-resizable
				var isResizable = uiDialog.is( ":data(resizable)" );
				if (isResizable && !value) {
					uiDialog.resizable('destroy');
				}

				// currently resizable, changing handles
				if (isResizable && typeof value === 'string') {
					uiDialog.resizable('option', 'handles', value);
				}

				// currently non-resizable, becoming resizable
				if (!isResizable && value !== false) {
					self._makeResizable(value);
				}
				break;
			case "title":
				// convert whatever was passed in o a string, for html() to not throw up
				$(".ui-dialog-title", self.uiDialogTitlebar).html("" + (value || '&#160;'));
				break;
		}

		$.Widget.prototype._setOption.apply(self, arguments);
	},

	_size: function() {
		/* If the user has resized the dialog, the .ui-dialog and .ui-dialog-content
		 * divs will both have width and height set, so we need to reset them
		 */
		var options = this.options,
			nonContentHeight,
			minContentHeight,
			isVisible = this.uiDialog.is( ":visible" );

		// reset content sizing
		this.element.show().css({
			width: 'auto',
			minHeight: 0,
			height: 0
		});

		if (options.minWidth > options.width) {
			options.width = options.minWidth;
		}

		// reset wrapper sizing
		// determine the height of all the non-content elements
		nonContentHeight = this.uiDialog.css({
				height: 'auto',
				width: options.width
			})
			.height();
		minContentHeight = Math.max( 0, options.minHeight - nonContentHeight );
		
		if ( options.height === "auto" ) {
			// only needed for IE6 support
			if ( $.support.minHeight ) {
				this.element.css({
					minHeight: minContentHeight,
					height: "auto"
				});
			} else {
				this.uiDialog.show();
				var autoHeight = this.element.css( "height", "auto" ).height();
				if ( !isVisible ) {
					this.uiDialog.hide();
				}
				this.element.height( Math.max( autoHeight, minContentHeight ) );
			}
		} else {
			this.element.height( Math.max( options.height - nonContentHeight, 0 ) );
		}

		if (this.uiDialog.is(':data(resizable)')) {
			this.uiDialog.resizable('option', 'minHeight', this._minHeight());
		}
	}
});

$.extend($.ui.dialog, {
	version: "1.8.11",

	uuid: 0,
	maxZ: 0,

	getTitleId: function($el) {
		var id = $el.attr('id');
		if (!id) {
			this.uuid += 1;
			id = this.uuid;
		}
		return 'ui-dialog-title-' + id;
	},

	overlay: function(dialog) {
		this.$el = $.ui.dialog.overlay.create(dialog);
	}
});

$.extend($.ui.dialog.overlay, {
	instances: [],
	// reuse old instances due to IE memory leak with alpha transparency (see #5185)
	oldInstances: [],
	maxZ: 0,
	events: $.map('focus,mousedown,mouseup,keydown,keypress,click'.split(','),
		function(event) { return event + '.dialog-overlay'; }).join(' '),
	create: function(dialog) {
		if (this.instances.length === 0) {
			// prevent use of anchors and inputs
			// we use a setTimeout in case the overlay is created from an
			// event that we're going to be cancelling (see #2804)
			setTimeout(function() {
				// handle $(el).dialog().dialog('close') (see #4065)
				if ($.ui.dialog.overlay.instances.length) {
					$(document).bind($.ui.dialog.overlay.events, function(event) {
						// stop events if the z-index of the target is < the z-index of the overlay
						// we cannot return true when we don't want to cancel the event (#3523)
						if ($(event.target).zIndex() < $.ui.dialog.overlay.maxZ) {
							return false;
						}
					});
				}
			}, 1);

			// allow closing by pressing the escape key
			$(document).bind('keydown.dialog-overlay', function(event) {
				if (dialog.options.closeOnEscape && event.keyCode &&
					event.keyCode === $.ui.keyCode.ESCAPE) {
					
					dialog.close(event);
					event.preventDefault();
				}
			});

			// handle window resize
			$(window).bind('resize.dialog-overlay', $.ui.dialog.overlay.resize);
		}

		var $el = (this.oldInstances.pop() || $('<div></div>').addClass('ui-widget-overlay'))
			.appendTo(document.body)
			.css({
				width: this.width(),
				height: this.height()
			});

		if ($.fn.bgiframe) {
			$el.bgiframe();
		}

		this.instances.push($el);
		return $el;
	},

	destroy: function($el) {
		var indexOf = $.inArray($el, this.instances);
		if (indexOf != -1){
			this.oldInstances.push(this.instances.splice(indexOf, 1)[0]);
		}

		if (this.instances.length === 0) {
			$([document, window]).unbind('.dialog-overlay');
		}

		$el.remove();
		
		// adjust the maxZ to allow other modal dialogs to continue to work (see #4309)
		var maxZ = 0;
		$.each(this.instances, function() {
			maxZ = Math.max(maxZ, this.css('z-index'));
		});
		this.maxZ = maxZ;
	},

	height: function() {
		var scrollHeight,
			offsetHeight;
		// handle IE 6
		if ($.browser.msie && $.browser.version < 7) {
			scrollHeight = Math.max(
				document.documentElement.scrollHeight,
				document.body.scrollHeight
			);
			offsetHeight = Math.max(
				document.documentElement.offsetHeight,
				document.body.offsetHeight
			);

			if (scrollHeight < offsetHeight) {
				return $(window).height() + 'px';
			} else {
				return scrollHeight + 'px';
			}
		// handle "good" browsers
		} else {
			return $(document).height() + 'px';
		}
	},

	width: function() {
		var scrollWidth,
			offsetWidth;
		// handle IE 6
		if ($.browser.msie && $.browser.version < 7) {
			scrollWidth = Math.max(
				document.documentElement.scrollWidth,
				document.body.scrollWidth
			);
			offsetWidth = Math.max(
				document.documentElement.offsetWidth,
				document.body.offsetWidth
			);

			if (scrollWidth < offsetWidth) {
				return $(window).width() + 'px';
			} else {
				return scrollWidth + 'px';
			}
		// handle "good" browsers
		} else {
			return $(document).width() + 'px';
		}
	},

	resize: function() {
		/* If the dialog is draggable and the user drags it past the
		 * right edge of the window, the document becomes wider so we
		 * need to stretch the overlay. If the user then drags the
		 * dialog back to the left, the document will become narrower,
		 * so we need to shrink the overlay to the appropriate size.
		 * This is handled by shrinking the overlay before setting it
		 * to the full document size.
		 */
		var $overlays = $([]);
		$.each($.ui.dialog.overlay.instances, function() {
			$overlays = $overlays.add(this);
		});

		$overlays.css({
			width: 0,
			height: 0
		}).css({
			width: $.ui.dialog.overlay.width(),
			height: $.ui.dialog.overlay.height()
		});
	}
});

$.extend($.ui.dialog.overlay.prototype, {
	destroy: function() {
		$.ui.dialog.overlay.destroy(this.$el);
	}
});

}(jQuery));
/*
 * jQuery UI Slider 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

// number of pages in a slider
// (how many times can you page up/down to go through the whole range)
var numPages = 5;

$.widget( "ui.slider", $.ui.mouse, {

	widgetEventPrefix: "slide",

	options: {
		animate: false,
		distance: 0,
		max: 100,
		min: 0,
		orientation: "horizontal",
		range: false,
		step: 1,
		value: 0,
		values: null
	},

	_create: function() {
		var self = this,
			o = this.options;

		this._keySliding = false;
		this._mouseSliding = false;
		this._animateOff = true;
		this._handleIndex = null;
		this._detectOrientation();
		this._mouseInit();

		this.element
			.addClass( "ui-slider" +
				" ui-slider-" + this.orientation +
				" ui-widget" +
				" ui-widget-content" +
				" ui-corner-all" );
		
		if ( o.disabled ) {
			this.element.addClass( "ui-slider-disabled ui-disabled" );
		}

		this.range = $([]);

		if ( o.range ) {
			if ( o.range === true ) {
				this.range = $( "<div></div>" );
				if ( !o.values ) {
					o.values = [ this._valueMin(), this._valueMin() ];
				}
				if ( o.values.length && o.values.length !== 2 ) {
					o.values = [ o.values[0], o.values[0] ];
				}
			} else {
				this.range = $( "<div></div>" );
			}

			this.range
				.appendTo( this.element )
				.addClass( "ui-slider-range" );

			if ( o.range === "min" || o.range === "max" ) {
				this.range.addClass( "ui-slider-range-" + o.range );
			}

			// note: this isn't the most fittingly semantic framework class for this element,
			// but worked best visually with a variety of themes
			this.range.addClass( "ui-widget-header" );
		}

		if ( $( ".ui-slider-handle", this.element ).length === 0 ) {
			$( "<a href='#'></a>" )
				.appendTo( this.element )
				.addClass( "ui-slider-handle" );
		}

		if ( o.values && o.values.length ) {
			while ( $(".ui-slider-handle", this.element).length < o.values.length ) {
				$( "<a href='#'></a>" )
					.appendTo( this.element )
					.addClass( "ui-slider-handle" );
			}
		}

		this.handles = $( ".ui-slider-handle", this.element )
			.addClass( "ui-state-default" +
				" ui-corner-all" );

		this.handle = this.handles.eq( 0 );

		this.handles.add( this.range ).filter( "a" )
			.click(function( event ) {
				event.preventDefault();
			})
			.hover(function() {
				if ( !o.disabled ) {
					$( this ).addClass( "ui-state-hover" );
				}
			}, function() {
				$( this ).removeClass( "ui-state-hover" );
			})
			.focus(function() {
				if ( !o.disabled ) {
					$( ".ui-slider .ui-state-focus" ).removeClass( "ui-state-focus" );
					$( this ).addClass( "ui-state-focus" );
				} else {
					$( this ).blur();
				}
			})
			.blur(function() {
				$( this ).removeClass( "ui-state-focus" );
			});

		this.handles.each(function( i ) {
			$( this ).data( "index.ui-slider-handle", i );
		});

		this.handles
			.keydown(function( event ) {
				var ret = true,
					index = $( this ).data( "index.ui-slider-handle" ),
					allowed,
					curVal,
					newVal,
					step;
	
				if ( self.options.disabled ) {
					return;
				}
	
				switch ( event.keyCode ) {
					case $.ui.keyCode.HOME:
					case $.ui.keyCode.END:
					case $.ui.keyCode.PAGE_UP:
					case $.ui.keyCode.PAGE_DOWN:
					case $.ui.keyCode.UP:
					case $.ui.keyCode.RIGHT:
					case $.ui.keyCode.DOWN:
					case $.ui.keyCode.LEFT:
						ret = false;
						if ( !self._keySliding ) {
							self._keySliding = true;
							$( this ).addClass( "ui-state-active" );
							allowed = self._start( event, index );
							if ( allowed === false ) {
								return;
							}
						}
						break;
				}
	
				step = self.options.step;
				if ( self.options.values && self.options.values.length ) {
					curVal = newVal = self.values( index );
				} else {
					curVal = newVal = self.value();
				}
	
				switch ( event.keyCode ) {
					case $.ui.keyCode.HOME:
						newVal = self._valueMin();
						break;
					case $.ui.keyCode.END:
						newVal = self._valueMax();
						break;
					case $.ui.keyCode.PAGE_UP:
						newVal = self._trimAlignValue( curVal + ( (self._valueMax() - self._valueMin()) / numPages ) );
						break;
					case $.ui.keyCode.PAGE_DOWN:
						newVal = self._trimAlignValue( curVal - ( (self._valueMax() - self._valueMin()) / numPages ) );
						break;
					case $.ui.keyCode.UP:
					case $.ui.keyCode.RIGHT:
						if ( curVal === self._valueMax() ) {
							return;
						}
						newVal = self._trimAlignValue( curVal + step );
						break;
					case $.ui.keyCode.DOWN:
					case $.ui.keyCode.LEFT:
						if ( curVal === self._valueMin() ) {
							return;
						}
						newVal = self._trimAlignValue( curVal - step );
						break;
				}
	
				self._slide( event, index, newVal );
	
				return ret;
	
			})
			.keyup(function( event ) {
				var index = $( this ).data( "index.ui-slider-handle" );
	
				if ( self._keySliding ) {
					self._keySliding = false;
					self._stop( event, index );
					self._change( event, index );
					$( this ).removeClass( "ui-state-active" );
				}
	
			});

		this._refreshValue();

		this._animateOff = false;
	},

	destroy: function() {
		this.handles.remove();
		this.range.remove();

		this.element
			.removeClass( "ui-slider" +
				" ui-slider-horizontal" +
				" ui-slider-vertical" +
				" ui-slider-disabled" +
				" ui-widget" +
				" ui-widget-content" +
				" ui-corner-all" )
			.removeData( "slider" )
			.unbind( ".slider" );

		this._mouseDestroy();

		return this;
	},

	_mouseCapture: function( event ) {
		var o = this.options,
			position,
			normValue,
			distance,
			closestHandle,
			self,
			index,
			allowed,
			offset,
			mouseOverHandle;

		if ( o.disabled ) {
			return false;
		}

		this.elementSize = {
			width: this.element.outerWidth(),
			height: this.element.outerHeight()
		};
		this.elementOffset = this.element.offset();

		position = { x: event.pageX, y: event.pageY };
		normValue = this._normValueFromMouse( position );
		distance = this._valueMax() - this._valueMin() + 1;
		self = this;
		this.handles.each(function( i ) {
			var thisDistance = Math.abs( normValue - self.values(i) );
			if ( distance > thisDistance ) {
				distance = thisDistance;
				closestHandle = $( this );
				index = i;
			}
		});

		// workaround for bug #3736 (if both handles of a range are at 0,
		// the first is always used as the one with least distance,
		// and moving it is obviously prevented by preventing negative ranges)
		if( o.range === true && this.values(1) === o.min ) {
			index += 1;
			closestHandle = $( this.handles[index] );
		}

		allowed = this._start( event, index );
		if ( allowed === false ) {
			return false;
		}
		this._mouseSliding = true;

		self._handleIndex = index;

		closestHandle
			.addClass( "ui-state-active" )
			.focus();
		
		offset = closestHandle.offset();
		mouseOverHandle = !$( event.target ).parents().andSelf().is( ".ui-slider-handle" );
		this._clickOffset = mouseOverHandle ? { left: 0, top: 0 } : {
			left: event.pageX - offset.left - ( closestHandle.width() / 2 ),
			top: event.pageY - offset.top -
				( closestHandle.height() / 2 ) -
				( parseInt( closestHandle.css("borderTopWidth"), 10 ) || 0 ) -
				( parseInt( closestHandle.css("borderBottomWidth"), 10 ) || 0) +
				( parseInt( closestHandle.css("marginTop"), 10 ) || 0)
		};

		if ( !this.handles.hasClass( "ui-state-hover" ) ) {
			this._slide( event, index, normValue );
		}
		this._animateOff = true;
		return true;
	},

	_mouseStart: function( event ) {
		return true;
	},

	_mouseDrag: function( event ) {
		var position = { x: event.pageX, y: event.pageY },
			normValue = this._normValueFromMouse( position );
		
		this._slide( event, this._handleIndex, normValue );

		return false;
	},

	_mouseStop: function( event ) {
		this.handles.removeClass( "ui-state-active" );
		this._mouseSliding = false;

		this._stop( event, this._handleIndex );
		this._change( event, this._handleIndex );

		this._handleIndex = null;
		this._clickOffset = null;
		this._animateOff = false;

		return false;
	},
	
	_detectOrientation: function() {
		this.orientation = ( this.options.orientation === "vertical" ) ? "vertical" : "horizontal";
	},

	_normValueFromMouse: function( position ) {
		var pixelTotal,
			pixelMouse,
			percentMouse,
			valueTotal,
			valueMouse;

		if ( this.orientation === "horizontal" ) {
			pixelTotal = this.elementSize.width;
			pixelMouse = position.x - this.elementOffset.left - ( this._clickOffset ? this._clickOffset.left : 0 );
		} else {
			pixelTotal = this.elementSize.height;
			pixelMouse = position.y - this.elementOffset.top - ( this._clickOffset ? this._clickOffset.top : 0 );
		}

		percentMouse = ( pixelMouse / pixelTotal );
		if ( percentMouse > 1 ) {
			percentMouse = 1;
		}
		if ( percentMouse < 0 ) {
			percentMouse = 0;
		}
		if ( this.orientation === "vertical" ) {
			percentMouse = 1 - percentMouse;
		}

		valueTotal = this._valueMax() - this._valueMin();
		valueMouse = this._valueMin() + percentMouse * valueTotal;

		return this._trimAlignValue( valueMouse );
	},

	_start: function( event, index ) {
		var uiHash = {
			handle: this.handles[ index ],
			value: this.value()
		};
		if ( this.options.values && this.options.values.length ) {
			uiHash.value = this.values( index );
			uiHash.values = this.values();
		}
		return this._trigger( "start", event, uiHash );
	},

	_slide: function( event, index, newVal ) {
		var otherVal,
			newValues,
			allowed;

		if ( this.options.values && this.options.values.length ) {
			otherVal = this.values( index ? 0 : 1 );

			if ( ( this.options.values.length === 2 && this.options.range === true ) && 
					( ( index === 0 && newVal > otherVal) || ( index === 1 && newVal < otherVal ) )
				) {
				newVal = otherVal;
			}

			if ( newVal !== this.values( index ) ) {
				newValues = this.values();
				newValues[ index ] = newVal;
				// A slide can be canceled by returning false from the slide callback
				allowed = this._trigger( "slide", event, {
					handle: this.handles[ index ],
					value: newVal,
					values: newValues
				} );
				otherVal = this.values( index ? 0 : 1 );
				if ( allowed !== false ) {
					this.values( index, newVal, true );
				}
			}
		} else {
			if ( newVal !== this.value() ) {
				// A slide can be canceled by returning false from the slide callback
				allowed = this._trigger( "slide", event, {
					handle: this.handles[ index ],
					value: newVal
				} );
				if ( allowed !== false ) {
					this.value( newVal );
				}
			}
		}
	},

	_stop: function( event, index ) {
		var uiHash = {
			handle: this.handles[ index ],
			value: this.value()
		};
		if ( this.options.values && this.options.values.length ) {
			uiHash.value = this.values( index );
			uiHash.values = this.values();
		}

		this._trigger( "stop", event, uiHash );
	},

	_change: function( event, index ) {
		if ( !this._keySliding && !this._mouseSliding ) {
			var uiHash = {
				handle: this.handles[ index ],
				value: this.value()
			};
			if ( this.options.values && this.options.values.length ) {
				uiHash.value = this.values( index );
				uiHash.values = this.values();
			}

			this._trigger( "change", event, uiHash );
		}
	},

	value: function( newValue ) {
		if ( arguments.length ) {
			this.options.value = this._trimAlignValue( newValue );
			this._refreshValue();
			this._change( null, 0 );
		}

		return this._value();
	},

	values: function( index, newValue ) {
		var vals,
			newValues,
			i;

		if ( arguments.length > 1 ) {
			this.options.values[ index ] = this._trimAlignValue( newValue );
			this._refreshValue();
			this._change( null, index );
		}

		if ( arguments.length ) {
			if ( $.isArray( arguments[ 0 ] ) ) {
				vals = this.options.values;
				newValues = arguments[ 0 ];
				for ( i = 0; i < vals.length; i += 1 ) {
					vals[ i ] = this._trimAlignValue( newValues[ i ] );
					this._change( null, i );
				}
				this._refreshValue();
			} else {
				if ( this.options.values && this.options.values.length ) {
					return this._values( index );
				} else {
					return this.value();
				}
			}
		} else {
			return this._values();
		}
	},

	_setOption: function( key, value ) {
		var i,
			valsLength = 0;

		if ( $.isArray( this.options.values ) ) {
			valsLength = this.options.values.length;
		}

		$.Widget.prototype._setOption.apply( this, arguments );

		switch ( key ) {
			case "disabled":
				if ( value ) {
					this.handles.filter( ".ui-state-focus" ).blur();
					this.handles.removeClass( "ui-state-hover" );
					this.handles.attr( "disabled", "disabled" );
					this.element.addClass( "ui-disabled" );
				} else {
					this.handles.removeAttr( "disabled" );
					this.element.removeClass( "ui-disabled" );
				}
				break;
			case "orientation":
				this._detectOrientation();
				this.element
					.removeClass( "ui-slider-horizontal ui-slider-vertical" )
					.addClass( "ui-slider-" + this.orientation );
				this._refreshValue();
				break;
			case "value":
				this._animateOff = true;
				this._refreshValue();
				this._change( null, 0 );
				this._animateOff = false;
				break;
			case "values":
				this._animateOff = true;
				this._refreshValue();
				for ( i = 0; i < valsLength; i += 1 ) {
					this._change( null, i );
				}
				this._animateOff = false;
				break;
		}
	},

	//internal value getter
	// _value() returns value trimmed by min and max, aligned by step
	_value: function() {
		var val = this.options.value;
		val = this._trimAlignValue( val );

		return val;
	},

	//internal values getter
	// _values() returns array of values trimmed by min and max, aligned by step
	// _values( index ) returns single value trimmed by min and max, aligned by step
	_values: function( index ) {
		var val,
			vals,
			i;

		if ( arguments.length ) {
			val = this.options.values[ index ];
			val = this._trimAlignValue( val );

			return val;
		} else {
			// .slice() creates a copy of the array
			// this copy gets trimmed by min and max and then returned
			vals = this.options.values.slice();
			for ( i = 0; i < vals.length; i+= 1) {
				vals[ i ] = this._trimAlignValue( vals[ i ] );
			}

			return vals;
		}
	},
	
	// returns the step-aligned value that val is closest to, between (inclusive) min and max
	_trimAlignValue: function( val ) {
		if ( val <= this._valueMin() ) {
			return this._valueMin();
		}
		if ( val >= this._valueMax() ) {
			return this._valueMax();
		}
		var step = ( this.options.step > 0 ) ? this.options.step : 1,
			valModStep = (val - this._valueMin()) % step;
			alignValue = val - valModStep;

		if ( Math.abs(valModStep) * 2 >= step ) {
			alignValue += ( valModStep > 0 ) ? step : ( -step );
		}

		// Since JavaScript has problems with large floats, round
		// the final value to 5 digits after the decimal point (see #4124)
		return parseFloat( alignValue.toFixed(5) );
	},

	_valueMin: function() {
		return this.options.min;
	},

	_valueMax: function() {
		return this.options.max;
	},
	
	_refreshValue: function() {
		var oRange = this.options.range,
			o = this.options,
			self = this,
			animate = ( !this._animateOff ) ? o.animate : false,
			valPercent,
			_set = {},
			lastValPercent,
			value,
			valueMin,
			valueMax;

		if ( this.options.values && this.options.values.length ) {
			this.handles.each(function( i, j ) {
				valPercent = ( self.values(i) - self._valueMin() ) / ( self._valueMax() - self._valueMin() ) * 100;
				_set[ self.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
				$( this ).stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
				if ( self.options.range === true ) {
					if ( self.orientation === "horizontal" ) {
						if ( i === 0 ) {
							self.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( { left: valPercent + "%" }, o.animate );
						}
						if ( i === 1 ) {
							self.range[ animate ? "animate" : "css" ]( { width: ( valPercent - lastValPercent ) + "%" }, { queue: false, duration: o.animate } );
						}
					} else {
						if ( i === 0 ) {
							self.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( { bottom: ( valPercent ) + "%" }, o.animate );
						}
						if ( i === 1 ) {
							self.range[ animate ? "animate" : "css" ]( { height: ( valPercent - lastValPercent ) + "%" }, { queue: false, duration: o.animate } );
						}
					}
				}
				lastValPercent = valPercent;
			});
		} else {
			value = this.value();
			valueMin = this._valueMin();
			valueMax = this._valueMax();
			valPercent = ( valueMax !== valueMin ) ?
					( value - valueMin ) / ( valueMax - valueMin ) * 100 :
					0;
			_set[ self.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
			this.handle.stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );

			if ( oRange === "min" && this.orientation === "horizontal" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( { width: valPercent + "%" }, o.animate );
			}
			if ( oRange === "max" && this.orientation === "horizontal" ) {
				this.range[ animate ? "animate" : "css" ]( { width: ( 100 - valPercent ) + "%" }, { queue: false, duration: o.animate } );
			}
			if ( oRange === "min" && this.orientation === "vertical" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( { height: valPercent + "%" }, o.animate );
			}
			if ( oRange === "max" && this.orientation === "vertical" ) {
				this.range[ animate ? "animate" : "css" ]( { height: ( 100 - valPercent ) + "%" }, { queue: false, duration: o.animate } );
			}
		}
	}

});

$.extend( $.ui.slider, {
	version: "1.8.11"
});

}(jQuery));
/*
 * jQuery UI Tabs 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Tabs
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 */
(function( $, undefined ) {

var tabId = 0,
	listId = 0;

function getNextTabId() {
	return ++tabId;
}

function getNextListId() {
	return ++listId;
}

$.widget( "ui.tabs", {
	options: {
		add: null,
		ajaxOptions: null,
		cache: false,
		cookie: null, // e.g. { expires: 7, path: '/', domain: 'jquery.com', secure: true }
		collapsible: false,
		disable: null,
		disabled: [],
		enable: null,
		event: "click",
		fx: null, // e.g. { height: 'toggle', opacity: 'toggle', duration: 200 }
		idPrefix: "ui-tabs-",
		load: null,
		panelTemplate: "<div></div>",
		remove: null,
		select: null,
		show: null,
		spinner: "<em>Loading&#8230;</em>",
		tabTemplate: "<li><a href='#{href}'><span>#{label}</span></a></li>"
	},

	_create: function() {
		this._tabify( true );
	},

	_setOption: function( key, value ) {
		if ( key == "selected" ) {
			if (this.options.collapsible && value == this.options.selected ) {
				return;
			}
			this.select( value );
		} else {
			this.options[ key ] = value;
			this._tabify();
		}
	},

	_tabId: function( a ) {
		return a.title && a.title.replace( /\s/g, "_" ).replace( /[^\w\u00c0-\uFFFF-]/g, "" ) ||
			this.options.idPrefix + getNextTabId();
	},

	_sanitizeSelector: function( hash ) {
		// we need this because an id may contain a ":"
		return hash.replace( /:/g, "\\:" );
	},

	_cookie: function() {
		var cookie = this.cookie ||
			( this.cookie = this.options.cookie.name || "ui-tabs-" + getNextListId() );
		return $.cookie.apply( null, [ cookie ].concat( $.makeArray( arguments ) ) );
	},

	_ui: function( tab, panel ) {
		return {
			tab: tab,
			panel: panel,
			index: this.anchors.index( tab )
		};
	},

	_cleanup: function() {
		// restore all former loading tabs labels
		this.lis.filter( ".ui-state-processing" )
			.removeClass( "ui-state-processing" )
			.find( "span:data(label.tabs)" )
				.each(function() {
					var el = $( this );
					el.html( el.data( "label.tabs" ) ).removeData( "label.tabs" );
				});
	},

	_tabify: function( init ) {
		var self = this,
			o = this.options,
			fragmentId = /^#.+/; // Safari 2 reports '#' for an empty hash

		this.list = this.element.find( "ol,ul" ).eq( 0 );
		this.lis = $( " > li:has(a[href])", this.list );
		this.anchors = this.lis.map(function() {
			return $( "a", this )[ 0 ];
		});
		this.panels = $( [] );

		this.anchors.each(function( i, a ) {
			var href = $( a ).attr( "href" );
			// For dynamically created HTML that contains a hash as href IE < 8 expands
			// such href to the full page url with hash and then misinterprets tab as ajax.
			// Same consideration applies for an added tab with a fragment identifier
			// since a[href=#fragment-identifier] does unexpectedly not match.
			// Thus normalize href attribute...
			var hrefBase = href.split( "#" )[ 0 ],
				baseEl;
			if ( hrefBase && ( hrefBase === location.toString().split( "#" )[ 0 ] ||
					( baseEl = $( "base" )[ 0 ]) && hrefBase === baseEl.href ) ) {
				href = a.hash;
				a.href = href;
			}

			// inline tab
			if ( fragmentId.test( href ) ) {
				self.panels = self.panels.add( self.element.find( self._sanitizeSelector( href ) ) );
			// remote tab
			// prevent loading the page itself if href is just "#"
			} else if ( href && href !== "#" ) {
				// required for restore on destroy
				$.data( a, "href.tabs", href );

				// TODO until #3808 is fixed strip fragment identifier from url
				// (IE fails to load from such url)
				$.data( a, "load.tabs", href.replace( /#.*$/, "" ) );

				var id = self._tabId( a );
				a.href = "#" + id;
				var $panel = self.element.find( "#" + id );
				if ( !$panel.length ) {
					$panel = $( o.panelTemplate )
						.attr( "id", id )
						.addClass( "ui-tabs-panel ui-widget-content ui-corner-bottom" )
						.insertAfter( self.panels[ i - 1 ] || self.list );
					$panel.data( "destroy.tabs", true );
				}
				self.panels = self.panels.add( $panel );
			// invalid tab href
			} else {
				o.disabled.push( i );
			}
		});

		// initialization from scratch
		if ( init ) {
			// attach necessary classes for styling
			this.element.addClass( "ui-tabs ui-widget ui-widget-content ui-corner-all" );
			this.list.addClass( "ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all" );
			this.lis.addClass( "ui-state-default ui-corner-top" );
			this.panels.addClass( "ui-tabs-panel ui-widget-content ui-corner-bottom" );

			// Selected tab
			// use "selected" option or try to retrieve:
			// 1. from fragment identifier in url
			// 2. from cookie
			// 3. from selected class attribute on <li>
			if ( o.selected === undefined ) {
				if ( location.hash ) {
					this.anchors.each(function( i, a ) {
						if ( a.hash == location.hash ) {
							o.selected = i;
							return false;
						}
					});
				}
				if ( typeof o.selected !== "number" && o.cookie ) {
					o.selected = parseInt( self._cookie(), 10 );
				}
				if ( typeof o.selected !== "number" && this.lis.filter( ".ui-tabs-selected" ).length ) {
					o.selected = this.lis.index( this.lis.filter( ".ui-tabs-selected" ) );
				}
				o.selected = o.selected || ( this.lis.length ? 0 : -1 );
			} else if ( o.selected === null ) { // usage of null is deprecated, TODO remove in next release
				o.selected = -1;
			}

			// sanity check - default to first tab...
			o.selected = ( ( o.selected >= 0 && this.anchors[ o.selected ] ) || o.selected < 0 )
				? o.selected
				: 0;

			// Take disabling tabs via class attribute from HTML
			// into account and update option properly.
			// A selected tab cannot become disabled.
			o.disabled = $.unique( o.disabled.concat(
				$.map( this.lis.filter( ".ui-state-disabled" ), function( n, i ) {
					return self.lis.index( n );
				})
			) ).sort();

			if ( $.inArray( o.selected, o.disabled ) != -1 ) {
				o.disabled.splice( $.inArray( o.selected, o.disabled ), 1 );
			}

			// highlight selected tab
			this.panels.addClass( "ui-tabs-hide" );
			this.lis.removeClass( "ui-tabs-selected ui-state-active" );
			// check for length avoids error when initializing empty list
			if ( o.selected >= 0 && this.anchors.length ) {
				self.element.find( self._sanitizeSelector( self.anchors[ o.selected ].hash ) ).removeClass( "ui-tabs-hide" );
				this.lis.eq( o.selected ).addClass( "ui-tabs-selected ui-state-active" );

				// seems to be expected behavior that the show callback is fired
				self.element.queue( "tabs", function() {
					self._trigger( "show", null,
						self._ui( self.anchors[ o.selected ], self.element.find( self._sanitizeSelector( self.anchors[ o.selected ].hash ) )[ 0 ] ) );
				});

				this.load( o.selected );
			}

			// clean up to avoid memory leaks in certain versions of IE 6
			// TODO: namespace this event
			$( window ).bind( "unload", function() {
				self.lis.add( self.anchors ).unbind( ".tabs" );
				self.lis = self.anchors = self.panels = null;
			});
		// update selected after add/remove
		} else {
			o.selected = this.lis.index( this.lis.filter( ".ui-tabs-selected" ) );
		}

		// update collapsible
		// TODO: use .toggleClass()
		this.element[ o.collapsible ? "addClass" : "removeClass" ]( "ui-tabs-collapsible" );

		// set or update cookie after init and add/remove respectively
		if ( o.cookie ) {
			this._cookie( o.selected, o.cookie );
		}

		// disable tabs
		for ( var i = 0, li; ( li = this.lis[ i ] ); i++ ) {
			$( li )[ $.inArray( i, o.disabled ) != -1 &&
				// TODO: use .toggleClass()
				!$( li ).hasClass( "ui-tabs-selected" ) ? "addClass" : "removeClass" ]( "ui-state-disabled" );
		}

		// reset cache if switching from cached to not cached
		if ( o.cache === false ) {
			this.anchors.removeData( "cache.tabs" );
		}

		// remove all handlers before, tabify may run on existing tabs after add or option change
		this.lis.add( this.anchors ).unbind( ".tabs" );

		if ( o.event !== "mouseover" ) {
			var addState = function( state, el ) {
				if ( el.is( ":not(.ui-state-disabled)" ) ) {
					el.addClass( "ui-state-" + state );
				}
			};
			var removeState = function( state, el ) {
				el.removeClass( "ui-state-" + state );
			};
			this.lis.bind( "mouseover.tabs" , function() {
				addState( "hover", $( this ) );
			});
			this.lis.bind( "mouseout.tabs", function() {
				removeState( "hover", $( this ) );
			});
			this.anchors.bind( "focus.tabs", function() {
				addState( "focus", $( this ).closest( "li" ) );
			});
			this.anchors.bind( "blur.tabs", function() {
				removeState( "focus", $( this ).closest( "li" ) );
			});
		}

		// set up animations
		var hideFx, showFx;
		if ( o.fx ) {
			if ( $.isArray( o.fx ) ) {
				hideFx = o.fx[ 0 ];
				showFx = o.fx[ 1 ];
			} else {
				hideFx = showFx = o.fx;
			}
		}

		// Reset certain styles left over from animation
		// and prevent IE's ClearType bug...
		function resetStyle( $el, fx ) {
			$el.css( "display", "" );
			if ( !$.support.opacity && fx.opacity ) {
				$el[ 0 ].style.removeAttribute( "filter" );
			}
		}

		// Show a tab...
		var showTab = showFx
			? function( clicked, $show ) {
				$( clicked ).closest( "li" ).addClass( "ui-tabs-selected ui-state-active" );
				$show.hide().removeClass( "ui-tabs-hide" ) // avoid flicker that way
					.animate( showFx, showFx.duration || "normal", function() {
						resetStyle( $show, showFx );
						self._trigger( "show", null, self._ui( clicked, $show[ 0 ] ) );
					});
			}
			: function( clicked, $show ) {
				$( clicked ).closest( "li" ).addClass( "ui-tabs-selected ui-state-active" );
				$show.removeClass( "ui-tabs-hide" );
				self._trigger( "show", null, self._ui( clicked, $show[ 0 ] ) );
			};

		// Hide a tab, $show is optional...
		var hideTab = hideFx
			? function( clicked, $hide ) {
				$hide.animate( hideFx, hideFx.duration || "normal", function() {
					self.lis.removeClass( "ui-tabs-selected ui-state-active" );
					$hide.addClass( "ui-tabs-hide" );
					resetStyle( $hide, hideFx );
					self.element.dequeue( "tabs" );
				});
			}
			: function( clicked, $hide, $show ) {
				self.lis.removeClass( "ui-tabs-selected ui-state-active" );
				$hide.addClass( "ui-tabs-hide" );
				self.element.dequeue( "tabs" );
			};

		// attach tab event handler, unbind to avoid duplicates from former tabifying...
		this.anchors.bind( o.event + ".tabs", function() {
			var el = this,
				$li = $(el).closest( "li" ),
				$hide = self.panels.filter( ":not(.ui-tabs-hide)" ),
				$show = self.element.find( self._sanitizeSelector( el.hash ) );

			// If tab is already selected and not collapsible or tab disabled or
			// or is already loading or click callback returns false stop here.
			// Check if click handler returns false last so that it is not executed
			// for a disabled or loading tab!
			if ( ( $li.hasClass( "ui-tabs-selected" ) && !o.collapsible) ||
				$li.hasClass( "ui-state-disabled" ) ||
				$li.hasClass( "ui-state-processing" ) ||
				self.panels.filter( ":animated" ).length ||
				self._trigger( "select", null, self._ui( this, $show[ 0 ] ) ) === false ) {
				this.blur();
				return false;
			}

			o.selected = self.anchors.index( this );

			self.abort();

			// if tab may be closed
			if ( o.collapsible ) {
				if ( $li.hasClass( "ui-tabs-selected" ) ) {
					o.selected = -1;

					if ( o.cookie ) {
						self._cookie( o.selected, o.cookie );
					}

					self.element.queue( "tabs", function() {
						hideTab( el, $hide );
					}).dequeue( "tabs" );

					this.blur();
					return false;
				} else if ( !$hide.length ) {
					if ( o.cookie ) {
						self._cookie( o.selected, o.cookie );
					}

					self.element.queue( "tabs", function() {
						showTab( el, $show );
					});

					// TODO make passing in node possible, see also http://dev.jqueryui.com/ticket/3171
					self.load( self.anchors.index( this ) );

					this.blur();
					return false;
				}
			}

			if ( o.cookie ) {
				self._cookie( o.selected, o.cookie );
			}

			// show new tab
			if ( $show.length ) {
				if ( $hide.length ) {
					self.element.queue( "tabs", function() {
						hideTab( el, $hide );
					});
				}
				self.element.queue( "tabs", function() {
					showTab( el, $show );
				});

				self.load( self.anchors.index( this ) );
			} else {
				throw "jQuery UI Tabs: Mismatching fragment identifier.";
			}

			// Prevent IE from keeping other link focussed when using the back button
			// and remove dotted border from clicked link. This is controlled via CSS
			// in modern browsers; blur() removes focus from address bar in Firefox
			// which can become a usability and annoying problem with tabs('rotate').
			if ( $.browser.msie ) {
				this.blur();
			}
		});

		// disable click in any case
		this.anchors.bind( "click.tabs", function(){
			return false;
		});
	},

    _getIndex: function( index ) {
		// meta-function to give users option to provide a href string instead of a numerical index.
		// also sanitizes numerical indexes to valid values.
		if ( typeof index == "string" ) {
			index = this.anchors.index( this.anchors.filter( "[href$=" + index + "]" ) );
		}

		return index;
	},

	destroy: function() {
		var o = this.options;

		this.abort();

		this.element
			.unbind( ".tabs" )
			.removeClass( "ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible" )
			.removeData( "tabs" );

		this.list.removeClass( "ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all" );

		this.anchors.each(function() {
			var href = $.data( this, "href.tabs" );
			if ( href ) {
				this.href = href;
			}
			var $this = $( this ).unbind( ".tabs" );
			$.each( [ "href", "load", "cache" ], function( i, prefix ) {
				$this.removeData( prefix + ".tabs" );
			});
		});

		this.lis.unbind( ".tabs" ).add( this.panels ).each(function() {
			if ( $.data( this, "destroy.tabs" ) ) {
				$( this ).remove();
			} else {
				$( this ).removeClass([
					"ui-state-default",
					"ui-corner-top",
					"ui-tabs-selected",
					"ui-state-active",
					"ui-state-hover",
					"ui-state-focus",
					"ui-state-disabled",
					"ui-tabs-panel",
					"ui-widget-content",
					"ui-corner-bottom",
					"ui-tabs-hide"
				].join( " " ) );
			}
		});

		if ( o.cookie ) {
			this._cookie( null, o.cookie );
		}

		return this;
	},

	add: function( url, label, index ) {
		if ( index === undefined ) {
			index = this.anchors.length;
		}

		var self = this,
			o = this.options,
			$li = $( o.tabTemplate.replace( /#\{href\}/g, url ).replace( /#\{label\}/g, label ) ),
			id = !url.indexOf( "#" ) ? url.replace( "#", "" ) : this._tabId( $( "a", $li )[ 0 ] );

		$li.addClass( "ui-state-default ui-corner-top" ).data( "destroy.tabs", true );

		// try to find an existing element before creating a new one
		var $panel = self.element.find( "#" + id );
		if ( !$panel.length ) {
			$panel = $( o.panelTemplate )
				.attr( "id", id )
				.data( "destroy.tabs", true );
		}
		$panel.addClass( "ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide" );

		if ( index >= this.lis.length ) {
			$li.appendTo( this.list );
			$panel.appendTo( this.list[ 0 ].parentNode );
		} else {
			$li.insertBefore( this.lis[ index ] );
			$panel.insertBefore( this.panels[ index ] );
		}

		o.disabled = $.map( o.disabled, function( n, i ) {
			return n >= index ? ++n : n;
		});

		this._tabify();

		if ( this.anchors.length == 1 ) {
			o.selected = 0;
			$li.addClass( "ui-tabs-selected ui-state-active" );
			$panel.removeClass( "ui-tabs-hide" );
			this.element.queue( "tabs", function() {
				self._trigger( "show", null, self._ui( self.anchors[ 0 ], self.panels[ 0 ] ) );
			});

			this.load( 0 );
		}

		this._trigger( "add", null, this._ui( this.anchors[ index ], this.panels[ index ] ) );
		return this;
	},

	remove: function( index ) {
		index = this._getIndex( index );
		var o = this.options,
			$li = this.lis.eq( index ).remove(),
			$panel = this.panels.eq( index ).remove();

		// If selected tab was removed focus tab to the right or
		// in case the last tab was removed the tab to the left.
		if ( $li.hasClass( "ui-tabs-selected" ) && this.anchors.length > 1) {
			this.select( index + ( index + 1 < this.anchors.length ? 1 : -1 ) );
		}

		o.disabled = $.map(
			$.grep( o.disabled, function(n, i) {
				return n != index;
			}),
			function( n, i ) {
				return n >= index ? --n : n;
			});

		this._tabify();

		this._trigger( "remove", null, this._ui( $li.find( "a" )[ 0 ], $panel[ 0 ] ) );
		return this;
	},

	enable: function( index ) {
		index = this._getIndex( index );
		var o = this.options;
		if ( $.inArray( index, o.disabled ) == -1 ) {
			return;
		}

		this.lis.eq( index ).removeClass( "ui-state-disabled" );
		o.disabled = $.grep( o.disabled, function( n, i ) {
			return n != index;
		});

		this._trigger( "enable", null, this._ui( this.anchors[ index ], this.panels[ index ] ) );
		return this;
	},

	disable: function( index ) {
		index = this._getIndex( index );
		var self = this, o = this.options;
		// cannot disable already selected tab
		if ( index != o.selected ) {
			this.lis.eq( index ).addClass( "ui-state-disabled" );

			o.disabled.push( index );
			o.disabled.sort();

			this._trigger( "disable", null, this._ui( this.anchors[ index ], this.panels[ index ] ) );
		}

		return this;
	},

	select: function( index ) {
		index = this._getIndex( index );
		if ( index == -1 ) {
			if ( this.options.collapsible && this.options.selected != -1 ) {
				index = this.options.selected;
			} else {
				return this;
			}
		}
		this.anchors.eq( index ).trigger( this.options.event + ".tabs" );
		return this;
	},

	load: function( index ) {
		index = this._getIndex( index );
		var self = this,
			o = this.options,
			a = this.anchors.eq( index )[ 0 ],
			url = $.data( a, "load.tabs" );

		this.abort();

		// not remote or from cache
		if ( !url || this.element.queue( "tabs" ).length !== 0 && $.data( a, "cache.tabs" ) ) {
			this.element.dequeue( "tabs" );
			return;
		}

		// load remote from here on
		this.lis.eq( index ).addClass( "ui-state-processing" );

		if ( o.spinner ) {
			var span = $( "span", a );
			span.data( "label.tabs", span.html() ).html( o.spinner );
		}

		this.xhr = $.ajax( $.extend( {}, o.ajaxOptions, {
			url: url,
			success: function( r, s ) {
				self.element.find( self._sanitizeSelector( a.hash ) ).html( r );

				// take care of tab labels
				self._cleanup();

				if ( o.cache ) {
					$.data( a, "cache.tabs", true );
				}

				self._trigger( "load", null, self._ui( self.anchors[ index ], self.panels[ index ] ) );
				try {
					o.ajaxOptions.success( r, s );
				}
				catch ( e ) {}
			},
			error: function( xhr, s, e ) {
				// take care of tab labels
				self._cleanup();

				self._trigger( "load", null, self._ui( self.anchors[ index ], self.panels[ index ] ) );
				try {
					// Passing index avoid a race condition when this method is
					// called after the user has selected another tab.
					// Pass the anchor that initiated this request allows
					// loadError to manipulate the tab content panel via $(a.hash)
					o.ajaxOptions.error( xhr, s, index, a );
				}
				catch ( e ) {}
			}
		} ) );

		// last, so that load event is fired before show...
		self.element.dequeue( "tabs" );

		return this;
	},

	abort: function() {
		// stop possibly running animations
		this.element.queue( [] );
		this.panels.stop( false, true );

		// "tabs" queue must not contain more than two elements,
		// which are the callbacks for the latest clicked tab...
		this.element.queue( "tabs", this.element.queue( "tabs" ).splice( -2, 2 ) );

		// terminate pending requests from other tabs
		if ( this.xhr ) {
			this.xhr.abort();
			delete this.xhr;
		}

		// take care of tab labels
		this._cleanup();
		return this;
	},

	url: function( index, url ) {
		this.anchors.eq( index ).removeData( "cache.tabs" ).data( "load.tabs", url );
		return this;
	},

	length: function() {
		return this.anchors.length;
	}
});

$.extend( $.ui.tabs, {
	version: "1.8.11"
});

/*
 * Tabs Extensions
 */

/*
 * Rotate
 */
$.extend( $.ui.tabs.prototype, {
	rotation: null,
	rotate: function( ms, continuing ) {
		var self = this,
			o = this.options;

		var rotate = self._rotate || ( self._rotate = function( e ) {
			clearTimeout( self.rotation );
			self.rotation = setTimeout(function() {
				var t = o.selected;
				self.select( ++t < self.anchors.length ? t : 0 );
			}, ms );
			
			if ( e ) {
				e.stopPropagation();
			}
		});

		var stop = self._unrotate || ( self._unrotate = !continuing
			? function(e) {
				if (e.clientX) { // in case of a true click
					self.rotate(null);
				}
			}
			: function( e ) {
				t = o.selected;
				rotate();
			});

		// start rotation
		if ( ms ) {
			this.element.bind( "tabsshow", rotate );
			this.anchors.bind( o.event + ".tabs", stop );
			rotate();
		// stop rotation
		} else {
			clearTimeout( self.rotation );
			this.element.unbind( "tabsshow", rotate );
			this.anchors.unbind( o.event + ".tabs", stop );
			delete this._rotate;
			delete this._unrotate;
		}

		return this;
	}
});

})( jQuery );
/*
 * jQuery UI Progressbar 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Progressbar
 *
 * Depends:
 *   jquery.ui.core.js
 *   jquery.ui.widget.js
 */
(function( $, undefined ) {

$.widget( "ui.progressbar", {
	options: {
		value: 0,
		max: 100
	},

	min: 0,

	_create: function() {
		this.element
			.addClass( "ui-progressbar ui-widget ui-widget-content ui-corner-all" )
			.attr({
				role: "progressbar",
				"aria-valuemin": this.min,
				"aria-valuemax": this.options.max,
				"aria-valuenow": this._value()
			});

		this.valueDiv = $( "<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>" )
			.appendTo( this.element );

		this.oldValue = this._value();
		this._refreshValue();
	},

	destroy: function() {
		this.element
			.removeClass( "ui-progressbar ui-widget ui-widget-content ui-corner-all" )
			.removeAttr( "role" )
			.removeAttr( "aria-valuemin" )
			.removeAttr( "aria-valuemax" )
			.removeAttr( "aria-valuenow" );

		this.valueDiv.remove();

		$.Widget.prototype.destroy.apply( this, arguments );
	},

	value: function( newValue ) {
		if ( newValue === undefined ) {
			return this._value();
		}

		this._setOption( "value", newValue );
		return this;
	},

	_setOption: function( key, value ) {
		if ( key === "value" ) {
			this.options.value = value;
			this._refreshValue();
			if ( this._value() === this.options.max ) {
				this._trigger( "complete" );
			}
		}

		$.Widget.prototype._setOption.apply( this, arguments );
	},

	_value: function() {
		var val = this.options.value;
		// normalize invalid value
		if ( typeof val !== "number" ) {
			val = 0;
		}
		return Math.min( this.options.max, Math.max( this.min, val ) );
	},

	_percentage: function() {
		return 100 * this._value() / this.options.max;
	},

	_refreshValue: function() {
		var value = this.value();
		var percentage = this._percentage();

		if ( this.oldValue !== value ) {
			this.oldValue = value;
			this._trigger( "change" );
		}

		this.valueDiv
			.toggleClass( "ui-corner-right", value === this.options.max )
			.width( percentage.toFixed(0) + "%" );
		this.element.attr( "aria-valuenow", value );
	}
});

$.extend( $.ui.progressbar, {
	version: "1.8.11"
});

})( jQuery );
/*
 * jQuery UI Effects 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/
 */
;jQuery.effects || (function($, undefined) {

$.effects = {};



/******************************************************************************/
/****************************** COLOR ANIMATIONS ******************************/
/******************************************************************************/

// override the animation for color styles
$.each(['backgroundColor', 'borderBottomColor', 'borderLeftColor',
	'borderRightColor', 'borderTopColor', 'borderColor', 'color', 'outlineColor'],
function(i, attr) {
	$.fx.step[attr] = function(fx) {
		if (!fx.colorInit) {
			fx.start = getColor(fx.elem, attr);
			fx.end = getRGB(fx.end);
			fx.colorInit = true;
		}

		fx.elem.style[attr] = 'rgb(' +
			Math.max(Math.min(parseInt((fx.pos * (fx.end[0] - fx.start[0])) + fx.start[0], 10), 255), 0) + ',' +
			Math.max(Math.min(parseInt((fx.pos * (fx.end[1] - fx.start[1])) + fx.start[1], 10), 255), 0) + ',' +
			Math.max(Math.min(parseInt((fx.pos * (fx.end[2] - fx.start[2])) + fx.start[2], 10), 255), 0) + ')';
	};
});

// Color Conversion functions from highlightFade
// By Blair Mitchelmore
// http://jquery.offput.ca/highlightFade/

// Parse strings looking for color tuples [255,255,255]
function getRGB(color) {
		var result;

		// Check if we're already dealing with an array of colors
		if ( color && color.constructor == Array && color.length == 3 )
				return color;

		// Look for rgb(num,num,num)
		if (result = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color))
				return [parseInt(result[1],10), parseInt(result[2],10), parseInt(result[3],10)];

		// Look for rgb(num%,num%,num%)
		if (result = /rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color))
				return [parseFloat(result[1])*2.55, parseFloat(result[2])*2.55, parseFloat(result[3])*2.55];

		// Look for #a0b1c2
		if (result = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color))
				return [parseInt(result[1],16), parseInt(result[2],16), parseInt(result[3],16)];

		// Look for #fff
		if (result = /#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color))
				return [parseInt(result[1]+result[1],16), parseInt(result[2]+result[2],16), parseInt(result[3]+result[3],16)];

		// Look for rgba(0, 0, 0, 0) == transparent in Safari 3
		if (result = /rgba\(0, 0, 0, 0\)/.exec(color))
				return colors['transparent'];

		// Otherwise, we're most likely dealing with a named color
		return colors[$.trim(color).toLowerCase()];
}

function getColor(elem, attr) {
		var color;

		do {
				color = $.curCSS(elem, attr);

				// Keep going until we find an element that has color, or we hit the body
				if ( color != '' && color != 'transparent' || $.nodeName(elem, "body") )
						break;

				attr = "backgroundColor";
		} while ( elem = elem.parentNode );

		return getRGB(color);
};

// Some named colors to work with
// From Interface by Stefan Petre
// http://interface.eyecon.ro/

var colors = {
	aqua:[0,255,255],
	azure:[240,255,255],
	beige:[245,245,220],
	black:[0,0,0],
	blue:[0,0,255],
	brown:[165,42,42],
	cyan:[0,255,255],
	darkblue:[0,0,139],
	darkcyan:[0,139,139],
	darkgrey:[169,169,169],
	darkgreen:[0,100,0],
	darkkhaki:[189,183,107],
	darkmagenta:[139,0,139],
	darkolivegreen:[85,107,47],
	darkorange:[255,140,0],
	darkorchid:[153,50,204],
	darkred:[139,0,0],
	darksalmon:[233,150,122],
	darkviolet:[148,0,211],
	fuchsia:[255,0,255],
	gold:[255,215,0],
	green:[0,128,0],
	indigo:[75,0,130],
	khaki:[240,230,140],
	lightblue:[173,216,230],
	lightcyan:[224,255,255],
	lightgreen:[144,238,144],
	lightgrey:[211,211,211],
	lightpink:[255,182,193],
	lightyellow:[255,255,224],
	lime:[0,255,0],
	magenta:[255,0,255],
	maroon:[128,0,0],
	navy:[0,0,128],
	olive:[128,128,0],
	orange:[255,165,0],
	pink:[255,192,203],
	purple:[128,0,128],
	violet:[128,0,128],
	red:[255,0,0],
	silver:[192,192,192],
	white:[255,255,255],
	yellow:[255,255,0],
	transparent: [255,255,255]
};



/******************************************************************************/
/****************************** CLASS ANIMATIONS ******************************/
/******************************************************************************/

var classAnimationActions = ['add', 'remove', 'toggle'],
	shorthandStyles = {
		border: 1,
		borderBottom: 1,
		borderColor: 1,
		borderLeft: 1,
		borderRight: 1,
		borderTop: 1,
		borderWidth: 1,
		margin: 1,
		padding: 1
	};

function getElementStyles() {
	var style = document.defaultView
			? document.defaultView.getComputedStyle(this, null)
			: this.currentStyle,
		newStyle = {},
		key,
		camelCase;

	// webkit enumerates style porperties
	if (style && style.length && style[0] && style[style[0]]) {
		var len = style.length;
		while (len--) {
			key = style[len];
			if (typeof style[key] == 'string') {
				camelCase = key.replace(/\-(\w)/g, function(all, letter){
					return letter.toUpperCase();
				});
				newStyle[camelCase] = style[key];
			}
		}
	} else {
		for (key in style) {
			if (typeof style[key] === 'string') {
				newStyle[key] = style[key];
			}
		}
	}
	
	return newStyle;
}

function filterStyles(styles) {
	var name, value;
	for (name in styles) {
		value = styles[name];
		if (
			// ignore null and undefined values
			value == null ||
			// ignore functions (when does this occur?)
			$.isFunction(value) ||
			// shorthand styles that need to be expanded
			name in shorthandStyles ||
			// ignore scrollbars (break in IE)
			(/scrollbar/).test(name) ||

			// only colors or values that can be converted to numbers
			(!(/color/i).test(name) && isNaN(parseFloat(value)))
		) {
			delete styles[name];
		}
	}
	
	return styles;
}

function styleDifference(oldStyle, newStyle) {
	var diff = { _: 0 }, // http://dev.jquery.com/ticket/5459
		name;

	for (name in newStyle) {
		if (oldStyle[name] != newStyle[name]) {
			diff[name] = newStyle[name];
		}
	}

	return diff;
}

$.effects.animateClass = function(value, duration, easing, callback) {
	if ($.isFunction(easing)) {
		callback = easing;
		easing = null;
	}

	return this.queue('fx', function() {
		var that = $(this),
			originalStyleAttr = that.attr('style') || ' ',
			originalStyle = filterStyles(getElementStyles.call(this)),
			newStyle,
			className = that.attr('className');

		$.each(classAnimationActions, function(i, action) {
			if (value[action]) {
				that[action + 'Class'](value[action]);
			}
		});
		newStyle = filterStyles(getElementStyles.call(this));
		that.attr('className', className);

		that.animate(styleDifference(originalStyle, newStyle), duration, easing, function() {
			$.each(classAnimationActions, function(i, action) {
				if (value[action]) { that[action + 'Class'](value[action]); }
			});
			// work around bug in IE by clearing the cssText before setting it
			if (typeof that.attr('style') == 'object') {
				that.attr('style').cssText = '';
				that.attr('style').cssText = originalStyleAttr;
			} else {
				that.attr('style', originalStyleAttr);
			}
			if (callback) { callback.apply(this, arguments); }
		});

		// $.animate adds a function to the end of the queue
		// but we want it at the front
		var queue = $.queue(this),
			anim = queue.splice(queue.length - 1, 1)[0];
		queue.splice(1, 0, anim);
		$.dequeue(this);
	});
};

$.fn.extend({
	_addClass: $.fn.addClass,
	addClass: function(classNames, speed, easing, callback) {
		return speed ? $.effects.animateClass.apply(this, [{ add: classNames },speed,easing,callback]) : this._addClass(classNames);
	},

	_removeClass: $.fn.removeClass,
	removeClass: function(classNames,speed,easing,callback) {
		return speed ? $.effects.animateClass.apply(this, [{ remove: classNames },speed,easing,callback]) : this._removeClass(classNames);
	},

	_toggleClass: $.fn.toggleClass,
	toggleClass: function(classNames, force, speed, easing, callback) {
		if ( typeof force == "boolean" || force === undefined ) {
			if ( !speed ) {
				// without speed parameter;
				return this._toggleClass(classNames, force);
			} else {
				return $.effects.animateClass.apply(this, [(force?{add:classNames}:{remove:classNames}),speed,easing,callback]);
			}
		} else {
			// without switch parameter;
			return $.effects.animateClass.apply(this, [{ toggle: classNames },force,speed,easing]);
		}
	},

	switchClass: function(remove,add,speed,easing,callback) {
		return $.effects.animateClass.apply(this, [{ add: add, remove: remove },speed,easing,callback]);
	}
});



/******************************************************************************/
/*********************************** EFFECTS **********************************/
/******************************************************************************/

$.extend($.effects, {
	version: "1.8.11",

	// Saves a set of properties in a data storage
	save: function(element, set) {
		for(var i=0; i < set.length; i++) {
			if(set[i] !== null) element.data("ec.storage."+set[i], element[0].style[set[i]]);
		}
	},

	// Restores a set of previously saved properties from a data storage
	restore: function(element, set) {
		for(var i=0; i < set.length; i++) {
			if(set[i] !== null) element.css(set[i], element.data("ec.storage."+set[i]));
		}
	},

	setMode: function(el, mode) {
		if (mode == 'toggle') mode = el.is(':hidden') ? 'show' : 'hide'; // Set for toggle
		return mode;
	},

	getBaseline: function(origin, original) { // Translates a [top,left] array into a baseline value
		// this should be a little more flexible in the future to handle a string & hash
		var y, x;
		switch (origin[0]) {
			case 'top': y = 0; break;
			case 'middle': y = 0.5; break;
			case 'bottom': y = 1; break;
			default: y = origin[0] / original.height;
		};
		switch (origin[1]) {
			case 'left': x = 0; break;
			case 'center': x = 0.5; break;
			case 'right': x = 1; break;
			default: x = origin[1] / original.width;
		};
		return {x: x, y: y};
	},

	// Wraps the element around a wrapper that copies position properties
	createWrapper: function(element) {

		// if the element is already wrapped, return it
		if (element.parent().is('.ui-effects-wrapper')) {
			return element.parent();
		}

		// wrap the element
		var props = {
				width: element.outerWidth(true),
				height: element.outerHeight(true),
				'float': element.css('float')
			},
			wrapper = $('<div></div>')
				.addClass('ui-effects-wrapper')
				.css({
					fontSize: '100%',
					background: 'transparent',
					border: 'none',
					margin: 0,
					padding: 0
				});

		element.wrap(wrapper);
		wrapper = element.parent(); //Hotfix for jQuery 1.4 since some change in wrap() seems to actually loose the reference to the wrapped element

		// transfer positioning properties to the wrapper
		if (element.css('position') == 'static') {
			wrapper.css({ position: 'relative' });
			element.css({ position: 'relative' });
		} else {
			$.extend(props, {
				position: element.css('position'),
				zIndex: element.css('z-index')
			});
			$.each(['top', 'left', 'bottom', 'right'], function(i, pos) {
				props[pos] = element.css(pos);
				if (isNaN(parseInt(props[pos], 10))) {
					props[pos] = 'auto';
				}
			});
			element.css({position: 'relative', top: 0, left: 0, right: 'auto', bottom: 'auto' });
		}

		return wrapper.css(props).show();
	},

	removeWrapper: function(element) {
		if (element.parent().is('.ui-effects-wrapper'))
			return element.parent().replaceWith(element);
		return element;
	},

	setTransition: function(element, list, factor, value) {
		value = value || {};
		$.each(list, function(i, x){
			unit = element.cssUnit(x);
			if (unit[0] > 0) value[x] = unit[0] * factor + unit[1];
		});
		return value;
	}
});


function _normalizeArguments(effect, options, speed, callback) {
	// shift params for method overloading
	if (typeof effect == 'object') {
		callback = options;
		speed = null;
		options = effect;
		effect = options.effect;
	}
	if ($.isFunction(options)) {
		callback = options;
		speed = null;
		options = {};
	}
        if (typeof options == 'number' || $.fx.speeds[options]) {
		callback = speed;
		speed = options;
		options = {};
	}
	if ($.isFunction(speed)) {
		callback = speed;
		speed = null;
	}

	options = options || {};

	speed = speed || options.duration;
	speed = $.fx.off ? 0 : typeof speed == 'number'
		? speed : speed in $.fx.speeds ? $.fx.speeds[speed] : $.fx.speeds._default;

	callback = callback || options.complete;

	return [effect, options, speed, callback];
}

function standardSpeed( speed ) {
	// valid standard speeds
	if ( !speed || typeof speed === "number" || $.fx.speeds[ speed ] ) {
		return true;
	}
	
	// invalid strings - treat as "normal" speed
	if ( typeof speed === "string" && !$.effects[ speed ] ) {
		return true;
	}
	
	return false;
}

$.fn.extend({
	effect: function(effect, options, speed, callback) {
		var args = _normalizeArguments.apply(this, arguments),
			// TODO: make effects take actual parameters instead of a hash
			args2 = {
				options: args[1],
				duration: args[2],
				callback: args[3]
			},
			mode = args2.options.mode,
			effectMethod = $.effects[effect];
		
		if ( $.fx.off || !effectMethod ) {
			// delegate to the original method (e.g., .show()) if possible
			if ( mode ) {
				return this[ mode ]( args2.duration, args2.callback );
			} else {
				return this.each(function() {
					if ( args2.callback ) {
						args2.callback.call( this );
					}
				});
			}
		}
		
		return effectMethod.call(this, args2);
	},

	_show: $.fn.show,
	show: function(speed) {
		if ( standardSpeed( speed ) ) {
			return this._show.apply(this, arguments);
		} else {
			var args = _normalizeArguments.apply(this, arguments);
			args[1].mode = 'show';
			return this.effect.apply(this, args);
		}
	},

	_hide: $.fn.hide,
	hide: function(speed) {
		if ( standardSpeed( speed ) ) {
			return this._hide.apply(this, arguments);
		} else {
			var args = _normalizeArguments.apply(this, arguments);
			args[1].mode = 'hide';
			return this.effect.apply(this, args);
		}
	},

	// jQuery core overloads toggle and creates _toggle
	__toggle: $.fn.toggle,
	toggle: function(speed) {
		if ( standardSpeed( speed ) || typeof speed === "boolean" || $.isFunction( speed ) ) {
			return this.__toggle.apply(this, arguments);
		} else {
			var args = _normalizeArguments.apply(this, arguments);
			args[1].mode = 'toggle';
			return this.effect.apply(this, args);
		}
	},

	// helper functions
	cssUnit: function(key) {
		var style = this.css(key), val = [];
		$.each( ['em','px','%','pt'], function(i, unit){
			if(style.indexOf(unit) > 0)
				val = [parseFloat(style), unit];
		});
		return val;
	}
});



/******************************************************************************/
/*********************************** EASING ***********************************/
/******************************************************************************/

/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 *
 * Open source under the BSD License.
 *
 * Copyright 2008 George McGinley Smith
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
*/

// t: current time, b: begInnIng value, c: change In value, d: duration
$.easing.jswing = $.easing.swing;

$.extend($.easing,
{
	def: 'easeOutQuad',
	swing: function (x, t, b, c, d) {
		//alert($.easing.default);
		return $.easing[$.easing.def](x, t, b, c, d);
	},
	easeInQuad: function (x, t, b, c, d) {
		return c*(t/=d)*t + b;
	},
	easeOutQuad: function (x, t, b, c, d) {
		return -c *(t/=d)*(t-2) + b;
	},
	easeInOutQuad: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t + b;
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInCubic: function (x, t, b, c, d) {
		return c*(t/=d)*t*t + b;
	},
	easeOutCubic: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t + 1) + b;
	},
	easeInOutCubic: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t + b;
		return c/2*((t-=2)*t*t + 2) + b;
	},
	easeInQuart: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t + b;
	},
	easeOutQuart: function (x, t, b, c, d) {
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeInOutQuart: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	},
	easeInQuint: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t*t + b;
	},
	easeOutQuint: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t*t*t + 1) + b;
	},
	easeInOutQuint: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
		return c/2*((t-=2)*t*t*t*t + 2) + b;
	},
	easeInSine: function (x, t, b, c, d) {
		return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
	},
	easeOutSine: function (x, t, b, c, d) {
		return c * Math.sin(t/d * (Math.PI/2)) + b;
	},
	easeInOutSine: function (x, t, b, c, d) {
		return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
	},
	easeInExpo: function (x, t, b, c, d) {
		return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
	},
	easeOutExpo: function (x, t, b, c, d) {
		return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
	},
	easeInOutExpo: function (x, t, b, c, d) {
		if (t==0) return b;
		if (t==d) return b+c;
		if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
		return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
	},
	easeInCirc: function (x, t, b, c, d) {
		return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
	},
	easeOutCirc: function (x, t, b, c, d) {
		return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
	},
	easeInOutCirc: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
		return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
	},
	easeInElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
	},
	easeOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
	},
	easeInOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
		return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
	},
	easeInBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*(t/=d)*t*((s+1)*t - s) + b;
	},
	easeOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
	},
	easeInOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
		return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
	},
	easeInBounce: function (x, t, b, c, d) {
		return c - $.easing.easeOutBounce (x, d-t, 0, c, d) + b;
	},
	easeOutBounce: function (x, t, b, c, d) {
		if ((t/=d) < (1/2.75)) {
			return c*(7.5625*t*t) + b;
		} else if (t < (2/2.75)) {
			return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
		} else if (t < (2.5/2.75)) {
			return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
		} else {
			return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
		}
	},
	easeInOutBounce: function (x, t, b, c, d) {
		if (t < d/2) return $.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
		return $.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
	}
});

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 *
 * Open source under the BSD License.
 *
 * Copyright 2001 Robert Penner
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

})(jQuery);
/*
 * jQuery UI Effects Blind 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Blind
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.blind = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'hide'); // Set Mode
		var direction = o.options.direction || 'vertical'; // Default direction

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		var wrapper = $.effects.createWrapper(el).css({overflow:'hidden'}); // Create Wrapper
		var ref = (direction == 'vertical') ? 'height' : 'width';
		var distance = (direction == 'vertical') ? wrapper.height() : wrapper.width();
		if(mode == 'show') wrapper.css(ref, 0); // Shift

		// Animation
		var animation = {};
		animation[ref] = mode == 'show' ? distance : 0;

		// Animate
		wrapper.animate(animation, o.duration, o.options.easing, function() {
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(el[0], arguments); // Callback
			el.dequeue();
		});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Bounce 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Bounce
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.bounce = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'effect'); // Set Mode
		var direction = o.options.direction || 'up'; // Default direction
		var distance = o.options.distance || 20; // Default distance
		var times = o.options.times || 5; // Default # of times
		var speed = o.duration || 250; // Default speed per bounce
		if (/show|hide/.test(mode)) props.push('opacity'); // Avoid touching opacity to prevent clearType and PNG issues in IE

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		$.effects.createWrapper(el); // Create Wrapper
		var ref = (direction == 'up' || direction == 'down') ? 'top' : 'left';
		var motion = (direction == 'up' || direction == 'left') ? 'pos' : 'neg';
		var distance = o.options.distance || (ref == 'top' ? el.outerHeight({margin:true}) / 3 : el.outerWidth({margin:true}) / 3);
		if (mode == 'show') el.css('opacity', 0).css(ref, motion == 'pos' ? -distance : distance); // Shift
		if (mode == 'hide') distance = distance / (times * 2);
		if (mode != 'hide') times--;

		// Animate
		if (mode == 'show') { // Show Bounce
			var animation = {opacity: 1};
			animation[ref] = (motion == 'pos' ? '+=' : '-=') + distance;
			el.animate(animation, speed / 2, o.options.easing);
			distance = distance / 2;
			times--;
		};
		for (var i = 0; i < times; i++) { // Bounces
			var animation1 = {}, animation2 = {};
			animation1[ref] = (motion == 'pos' ? '-=' : '+=') + distance;
			animation2[ref] = (motion == 'pos' ? '+=' : '-=') + distance;
			el.animate(animation1, speed / 2, o.options.easing).animate(animation2, speed / 2, o.options.easing);
			distance = (mode == 'hide') ? distance * 2 : distance / 2;
		};
		if (mode == 'hide') { // Last Bounce
			var animation = {opacity: 0};
			animation[ref] = (motion == 'pos' ? '-=' : '+=')  + distance;
			el.animate(animation, speed / 2, o.options.easing, function(){
				el.hide(); // Hide
				$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
				if(o.callback) o.callback.apply(this, arguments); // Callback
			});
		} else {
			var animation1 = {}, animation2 = {};
			animation1[ref] = (motion == 'pos' ? '-=' : '+=') + distance;
			animation2[ref] = (motion == 'pos' ? '+=' : '-=') + distance;
			el.animate(animation1, speed / 2, o.options.easing).animate(animation2, speed / 2, o.options.easing, function(){
				$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
				if(o.callback) o.callback.apply(this, arguments); // Callback
			});
		};
		el.queue('fx', function() { el.dequeue(); });
		el.dequeue();
	});

};

})(jQuery);
/*
 * jQuery UI Effects Clip 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Clip
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.clip = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right','height','width'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'hide'); // Set Mode
		var direction = o.options.direction || 'vertical'; // Default direction

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		var wrapper = $.effects.createWrapper(el).css({overflow:'hidden'}); // Create Wrapper
		var animate = el[0].tagName == 'IMG' ? wrapper : el;
		var ref = {
			size: (direction == 'vertical') ? 'height' : 'width',
			position: (direction == 'vertical') ? 'top' : 'left'
		};
		var distance = (direction == 'vertical') ? animate.height() : animate.width();
		if(mode == 'show') { animate.css(ref.size, 0); animate.css(ref.position, distance / 2); } // Shift

		// Animation
		var animation = {};
		animation[ref.size] = mode == 'show' ? distance : 0;
		animation[ref.position] = mode == 'show' ? 0 : distance / 2;

		// Animate
		animate.animate(animation, { queue: false, duration: o.duration, easing: o.options.easing, complete: function() {
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(el[0], arguments); // Callback
			el.dequeue();
		}});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Drop 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Drop
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.drop = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right','opacity'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'hide'); // Set Mode
		var direction = o.options.direction || 'left'; // Default Direction

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		$.effects.createWrapper(el); // Create Wrapper
		var ref = (direction == 'up' || direction == 'down') ? 'top' : 'left';
		var motion = (direction == 'up' || direction == 'left') ? 'pos' : 'neg';
		var distance = o.options.distance || (ref == 'top' ? el.outerHeight({margin:true}) / 2 : el.outerWidth({margin:true}) / 2);
		if (mode == 'show') el.css('opacity', 0).css(ref, motion == 'pos' ? -distance : distance); // Shift

		// Animation
		var animation = {opacity: mode == 'show' ? 1 : 0};
		animation[ref] = (mode == 'show' ? (motion == 'pos' ? '+=' : '-=') : (motion == 'pos' ? '-=' : '+=')) + distance;

		// Animate
		el.animate(animation, { queue: false, duration: o.duration, easing: o.options.easing, complete: function() {
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(this, arguments); // Callback
			el.dequeue();
		}});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Explode 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Explode
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.explode = function(o) {

	return this.queue(function() {

	var rows = o.options.pieces ? Math.round(Math.sqrt(o.options.pieces)) : 3;
	var cells = o.options.pieces ? Math.round(Math.sqrt(o.options.pieces)) : 3;

	o.options.mode = o.options.mode == 'toggle' ? ($(this).is(':visible') ? 'hide' : 'show') : o.options.mode;
	var el = $(this).show().css('visibility', 'hidden');
	var offset = el.offset();

	//Substract the margins - not fixing the problem yet.
	offset.top -= parseInt(el.css("marginTop"),10) || 0;
	offset.left -= parseInt(el.css("marginLeft"),10) || 0;

	var width = el.outerWidth(true);
	var height = el.outerHeight(true);

	for(var i=0;i<rows;i++) { // =
		for(var j=0;j<cells;j++) { // ||
			el
				.clone()
				.appendTo('body')
				.wrap('<div></div>')
				.css({
					position: 'absolute',
					visibility: 'visible',
					left: -j*(width/cells),
					top: -i*(height/rows)
				})
				.parent()
				.addClass('ui-effects-explode')
				.css({
					position: 'absolute',
					overflow: 'hidden',
					width: width/cells,
					height: height/rows,
					left: offset.left + j*(width/cells) + (o.options.mode == 'show' ? (j-Math.floor(cells/2))*(width/cells) : 0),
					top: offset.top + i*(height/rows) + (o.options.mode == 'show' ? (i-Math.floor(rows/2))*(height/rows) : 0),
					opacity: o.options.mode == 'show' ? 0 : 1
				}).animate({
					left: offset.left + j*(width/cells) + (o.options.mode == 'show' ? 0 : (j-Math.floor(cells/2))*(width/cells)),
					top: offset.top + i*(height/rows) + (o.options.mode == 'show' ? 0 : (i-Math.floor(rows/2))*(height/rows)),
					opacity: o.options.mode == 'show' ? 1 : 0
				}, o.duration || 500);
		}
	}

	// Set a timeout, to call the callback approx. when the other animations have finished
	setTimeout(function() {

		o.options.mode == 'show' ? el.css({ visibility: 'visible' }) : el.css({ visibility: 'visible' }).hide();
				if(o.callback) o.callback.apply(el[0]); // Callback
				el.dequeue();

				$('div.ui-effects-explode').remove();

	}, o.duration || 500);


	});

};

})(jQuery);
/*
 * jQuery UI Effects Fade 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Fade
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.fade = function(o) {
	return this.queue(function() {
		var elem = $(this),
			mode = $.effects.setMode(elem, o.options.mode || 'hide');

		elem.animate({ opacity: mode }, {
			queue: false,
			duration: o.duration,
			easing: o.options.easing,
			complete: function() {
				(o.callback && o.callback.apply(this, arguments));
				elem.dequeue();
			}
		});
	});
};

})(jQuery);
/*
 * jQuery UI Effects Fold 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Fold
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.fold = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'hide'); // Set Mode
		var size = o.options.size || 15; // Default fold size
		var horizFirst = !(!o.options.horizFirst); // Ensure a boolean value
		var duration = o.duration ? o.duration / 2 : $.fx.speeds._default / 2;

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		var wrapper = $.effects.createWrapper(el).css({overflow:'hidden'}); // Create Wrapper
		var widthFirst = ((mode == 'show') != horizFirst);
		var ref = widthFirst ? ['width', 'height'] : ['height', 'width'];
		var distance = widthFirst ? [wrapper.width(), wrapper.height()] : [wrapper.height(), wrapper.width()];
		var percent = /([0-9]+)%/.exec(size);
		if(percent) size = parseInt(percent[1],10) / 100 * distance[mode == 'hide' ? 0 : 1];
		if(mode == 'show') wrapper.css(horizFirst ? {height: 0, width: size} : {height: size, width: 0}); // Shift

		// Animation
		var animation1 = {}, animation2 = {};
		animation1[ref[0]] = mode == 'show' ? distance[0] : size;
		animation2[ref[1]] = mode == 'show' ? distance[1] : 0;

		// Animate
		wrapper.animate(animation1, duration, o.options.easing)
		.animate(animation2, duration, o.options.easing, function() {
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(el[0], arguments); // Callback
			el.dequeue();
		});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Highlight 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Highlight
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.highlight = function(o) {
	return this.queue(function() {
		var elem = $(this),
			props = ['backgroundImage', 'backgroundColor', 'opacity'],
			mode = $.effects.setMode(elem, o.options.mode || 'show'),
			animation = {
				backgroundColor: elem.css('backgroundColor')
			};

		if (mode == 'hide') {
			animation.opacity = 0;
		}

		$.effects.save(elem, props);
		elem
			.show()
			.css({
				backgroundImage: 'none',
				backgroundColor: o.options.color || '#ffff99'
			})
			.animate(animation, {
				queue: false,
				duration: o.duration,
				easing: o.options.easing,
				complete: function() {
					(mode == 'hide' && elem.hide());
					$.effects.restore(elem, props);
					(mode == 'show' && !$.support.opacity && this.style.removeAttribute('filter'));
					(o.callback && o.callback.apply(this, arguments));
					elem.dequeue();
				}
			});
	});
};

})(jQuery);
/*
 * jQuery UI Effects Pulsate 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Pulsate
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.pulsate = function(o) {
	return this.queue(function() {
		var elem = $(this),
			mode = $.effects.setMode(elem, o.options.mode || 'show');
			times = ((o.options.times || 5) * 2) - 1;
			duration = o.duration ? o.duration / 2 : $.fx.speeds._default / 2,
			isVisible = elem.is(':visible'),
			animateTo = 0;

		if (!isVisible) {
			elem.css('opacity', 0).show();
			animateTo = 1;
		}

		if ((mode == 'hide' && isVisible) || (mode == 'show' && !isVisible)) {
			times--;
		}

		for (var i = 0; i < times; i++) {
			elem.animate({ opacity: animateTo }, duration, o.options.easing);
			animateTo = (animateTo + 1) % 2;
		}

		elem.animate({ opacity: animateTo }, duration, o.options.easing, function() {
			if (animateTo == 0) {
				elem.hide();
			}
			(o.callback && o.callback.apply(this, arguments));
		});

		elem
			.queue('fx', function() { elem.dequeue(); })
			.dequeue();
	});
};

})(jQuery);
/*
 * jQuery UI Effects Scale 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Scale
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.puff = function(o) {
	return this.queue(function() {
		var elem = $(this),
			mode = $.effects.setMode(elem, o.options.mode || 'hide'),
			percent = parseInt(o.options.percent, 10) || 150,
			factor = percent / 100,
			original = { height: elem.height(), width: elem.width() };

		$.extend(o.options, {
			fade: true,
			mode: mode,
			percent: mode == 'hide' ? percent : 100,
			from: mode == 'hide'
				? original
				: {
					height: original.height * factor,
					width: original.width * factor
				}
		});

		elem.effect('scale', o.options, o.duration, o.callback);
		elem.dequeue();
	});
};

$.effects.scale = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this);

		// Set options
		var options = $.extend(true, {}, o.options);
		var mode = $.effects.setMode(el, o.options.mode || 'effect'); // Set Mode
		var percent = parseInt(o.options.percent,10) || (parseInt(o.options.percent,10) == 0 ? 0 : (mode == 'hide' ? 0 : 100)); // Set default scaling percent
		var direction = o.options.direction || 'both'; // Set default axis
		var origin = o.options.origin; // The origin of the scaling
		if (mode != 'effect') { // Set default origin and restore for show/hide
			options.origin = origin || ['middle','center'];
			options.restore = true;
		}
		var original = {height: el.height(), width: el.width()}; // Save original
		el.from = o.options.from || (mode == 'show' ? {height: 0, width: 0} : original); // Default from state

		// Adjust
		var factor = { // Set scaling factor
			y: direction != 'horizontal' ? (percent / 100) : 1,
			x: direction != 'vertical' ? (percent / 100) : 1
		};
		el.to = {height: original.height * factor.y, width: original.width * factor.x}; // Set to state

		if (o.options.fade) { // Fade option to support puff
			if (mode == 'show') {el.from.opacity = 0; el.to.opacity = 1;};
			if (mode == 'hide') {el.from.opacity = 1; el.to.opacity = 0;};
		};

		// Animation
		options.from = el.from; options.to = el.to; options.mode = mode;

		// Animate
		el.effect('size', options, o.duration, o.callback);
		el.dequeue();
	});

};

$.effects.size = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right','width','height','overflow','opacity'];
		var props1 = ['position','top','bottom','left','right','overflow','opacity']; // Always restore
		var props2 = ['width','height','overflow']; // Copy for children
		var cProps = ['fontSize'];
		var vProps = ['borderTopWidth', 'borderBottomWidth', 'paddingTop', 'paddingBottom'];
		var hProps = ['borderLeftWidth', 'borderRightWidth', 'paddingLeft', 'paddingRight'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'effect'); // Set Mode
		var restore = o.options.restore || false; // Default restore
		var scale = o.options.scale || 'both'; // Default scale mode
		var origin = o.options.origin; // The origin of the sizing
		var original = {height: el.height(), width: el.width()}; // Save original
		el.from = o.options.from || original; // Default from state
		el.to = o.options.to || original; // Default to state
		// Adjust
		if (origin) { // Calculate baseline shifts
			var baseline = $.effects.getBaseline(origin, original);
			el.from.top = (original.height - el.from.height) * baseline.y;
			el.from.left = (original.width - el.from.width) * baseline.x;
			el.to.top = (original.height - el.to.height) * baseline.y;
			el.to.left = (original.width - el.to.width) * baseline.x;
		};
		var factor = { // Set scaling factor
			from: {y: el.from.height / original.height, x: el.from.width / original.width},
			to: {y: el.to.height / original.height, x: el.to.width / original.width}
		};
		if (scale == 'box' || scale == 'both') { // Scale the css box
			if (factor.from.y != factor.to.y) { // Vertical props scaling
				props = props.concat(vProps);
				el.from = $.effects.setTransition(el, vProps, factor.from.y, el.from);
				el.to = $.effects.setTransition(el, vProps, factor.to.y, el.to);
			};
			if (factor.from.x != factor.to.x) { // Horizontal props scaling
				props = props.concat(hProps);
				el.from = $.effects.setTransition(el, hProps, factor.from.x, el.from);
				el.to = $.effects.setTransition(el, hProps, factor.to.x, el.to);
			};
		};
		if (scale == 'content' || scale == 'both') { // Scale the content
			if (factor.from.y != factor.to.y) { // Vertical props scaling
				props = props.concat(cProps);
				el.from = $.effects.setTransition(el, cProps, factor.from.y, el.from);
				el.to = $.effects.setTransition(el, cProps, factor.to.y, el.to);
			};
		};
		$.effects.save(el, restore ? props : props1); el.show(); // Save & Show
		$.effects.createWrapper(el); // Create Wrapper
		el.css('overflow','hidden').css(el.from); // Shift

		// Animate
		if (scale == 'content' || scale == 'both') { // Scale the children
			vProps = vProps.concat(['marginTop','marginBottom']).concat(cProps); // Add margins/font-size
			hProps = hProps.concat(['marginLeft','marginRight']); // Add margins
			props2 = props.concat(vProps).concat(hProps); // Concat
			el.find("*[width]").each(function(){
				child = $(this);
				if (restore) $.effects.save(child, props2);
				var c_original = {height: child.height(), width: child.width()}; // Save original
				child.from = {height: c_original.height * factor.from.y, width: c_original.width * factor.from.x};
				child.to = {height: c_original.height * factor.to.y, width: c_original.width * factor.to.x};
				if (factor.from.y != factor.to.y) { // Vertical props scaling
					child.from = $.effects.setTransition(child, vProps, factor.from.y, child.from);
					child.to = $.effects.setTransition(child, vProps, factor.to.y, child.to);
				};
				if (factor.from.x != factor.to.x) { // Horizontal props scaling
					child.from = $.effects.setTransition(child, hProps, factor.from.x, child.from);
					child.to = $.effects.setTransition(child, hProps, factor.to.x, child.to);
				};
				child.css(child.from); // Shift children
				child.animate(child.to, o.duration, o.options.easing, function(){
					if (restore) $.effects.restore(child, props2); // Restore children
				}); // Animate children
			});
		};

		// Animate
		el.animate(el.to, { queue: false, duration: o.duration, easing: o.options.easing, complete: function() {
			if (el.to.opacity === 0) {
				el.css('opacity', el.from.opacity);
			}
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, restore ? props : props1); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(this, arguments); // Callback
			el.dequeue();
		}});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Shake 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Shake
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.shake = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'effect'); // Set Mode
		var direction = o.options.direction || 'left'; // Default direction
		var distance = o.options.distance || 20; // Default distance
		var times = o.options.times || 3; // Default # of times
		var speed = o.duration || o.options.duration || 140; // Default speed per shake

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		$.effects.createWrapper(el); // Create Wrapper
		var ref = (direction == 'up' || direction == 'down') ? 'top' : 'left';
		var motion = (direction == 'up' || direction == 'left') ? 'pos' : 'neg';

		// Animation
		var animation = {}, animation1 = {}, animation2 = {};
		animation[ref] = (motion == 'pos' ? '-=' : '+=')  + distance;
		animation1[ref] = (motion == 'pos' ? '+=' : '-=')  + distance * 2;
		animation2[ref] = (motion == 'pos' ? '-=' : '+=')  + distance * 2;

		// Animate
		el.animate(animation, speed, o.options.easing);
		for (var i = 1; i < times; i++) { // Shakes
			el.animate(animation1, speed, o.options.easing).animate(animation2, speed, o.options.easing);
		};
		el.animate(animation1, speed, o.options.easing).
		animate(animation, speed / 2, o.options.easing, function(){ // Last shake
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(this, arguments); // Callback
		});
		el.queue('fx', function() { el.dequeue(); });
		el.dequeue();
	});

};

})(jQuery);
/*
 * jQuery UI Effects Slide 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Slide
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.slide = function(o) {

	return this.queue(function() {

		// Create element
		var el = $(this), props = ['position','top','bottom','left','right'];

		// Set options
		var mode = $.effects.setMode(el, o.options.mode || 'show'); // Set Mode
		var direction = o.options.direction || 'left'; // Default Direction

		// Adjust
		$.effects.save(el, props); el.show(); // Save & Show
		$.effects.createWrapper(el).css({overflow:'hidden'}); // Create Wrapper
		var ref = (direction == 'up' || direction == 'down') ? 'top' : 'left';
		var motion = (direction == 'up' || direction == 'left') ? 'pos' : 'neg';
		var distance = o.options.distance || (ref == 'top' ? el.outerHeight({margin:true}) : el.outerWidth({margin:true}));
		if (mode == 'show') el.css(ref, motion == 'pos' ? (isNaN(distance) ? "-" + distance : -distance) : distance); // Shift

		// Animation
		var animation = {};
		animation[ref] = (mode == 'show' ? (motion == 'pos' ? '+=' : '-=') : (motion == 'pos' ? '-=' : '+=')) + distance;

		// Animate
		el.animate(animation, { queue: false, duration: o.duration, easing: o.options.easing, complete: function() {
			if(mode == 'hide') el.hide(); // Hide
			$.effects.restore(el, props); $.effects.removeWrapper(el); // Restore
			if(o.callback) o.callback.apply(this, arguments); // Callback
			el.dequeue();
		}});

	});

};

})(jQuery);
/*
 * jQuery UI Effects Transfer 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Effects/Transfer
 *
 * Depends:
 *	jquery.effects.core.js
 */
(function( $, undefined ) {

$.effects.transfer = function(o) {
	return this.queue(function() {
		var elem = $(this),
			target = $(o.options.to),
			endPosition = target.offset(),
			animation = {
				top: endPosition.top,
				left: endPosition.left,
				height: target.innerHeight(),
				width: target.innerWidth()
			},
			startPosition = elem.offset(),
			transfer = $('<div class="ui-effects-transfer"></div>')
				.appendTo(document.body)
				.addClass(o.options.className)
				.css({
					top: startPosition.top,
					left: startPosition.left,
					height: elem.innerHeight(),
					width: elem.innerWidth(),
					position: 'absolute'
				})
				.animate(animation, o.duration, o.options.easing, function() {
					transfer.remove();
					(o.callback && o.callback.apply(elem[0], arguments));
					elem.dequeue();
				});
	});
};

})(jQuery);

/*
 * jQuery UI Menu (not officially released)
 *
 * Version/date of Atlassian copy unknown, sometime previous to 2011.04.14
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */
(function($) {

$.widget("ui.menu", {
	_create: function() {
		var self = this;
		this.element
			.addClass("ui-menu ui-widget ui-widget-content ui-corner-all")
			.attr({
				role: "listbox",
				"aria-activedescendant": "ui-active-menuitem"
			})
			.click(function( event ) {
				if ( !$( event.target ).closest( ".ui-menu-item a" ).length ) {
					return;
				}
				// temporary
				event.preventDefault();
				self.select( event );
			});
		this.refresh();
	},
	
	refresh: function() {
		var self = this;

		// don't refresh list items that are already adapted
		var items = this.element.children("li:not(.ui-menu-item):has(a)")
			.addClass("ui-menu-item")
			.attr("role", "menuitem");
		
		items.children("a")
			.addClass("ui-corner-all")
			.attr("tabindex", -1)
			// mouseenter doesn't work with event delegation
			.mouseenter(function( event ) {
				self.activate( event, $(this).parent() );
			})
			.mouseleave(function() {
				self.deactivate();
			});
	},

	activate: function( event, item ) {
		this.deactivate();
		if (this.hasScroll()) {
			var offset = item.offset().top - this.element.offset().top,
				scroll = this.element.attr("scrollTop"),
				elementHeight = this.element.height();
			if (offset < 0) {
				this.element.attr("scrollTop", scroll + offset);
			} else if (offset > elementHeight) {
				this.element.attr("scrollTop", scroll + offset - elementHeight + item.height());
			}
		}
		this.active = item.eq(0)
			.children("a")
				.addClass("ui-state-hover")
				.attr("id", "ui-active-menuitem")
			.end();
		this._trigger("focus", event, { item: item });
	},

	deactivate: function() {
		if (!this.active) { return; }

		this.active.children("a")
			.removeClass("ui-state-hover")
			.removeAttr("id");
		this._trigger("blur");
		this.active = null;
	},

	next: function(event) {
		this.move("next", ".ui-menu-item:first", event);
	},

	previous: function(event) {
		this.move("prev", ".ui-menu-item:last", event);
	},

	first: function() {
		return this.active && !this.active.prev().length;
	},

	last: function() {
		return this.active && !this.active.next().length;
	},

	move: function(direction, edge, event) {
		if (!this.active) {
			this.activate(event, this.element.children(edge));
			return;
		}
		var next = this.active[direction + "All"](".ui-menu-item").eq(0);
		if (next.length) {
			this.activate(event, next);
		} else {
			this.activate(event, this.element.children(edge));
		}
	},

	// TODO merge with previousPage
	nextPage: function(event) {
		if (this.hasScroll()) {
			// TODO merge with no-scroll-else
			if (!this.active || this.last()) {
				this.activate(event, this.element.children(":first"));
				return;
			}
			var base = this.active.offset().top,
				height = this.element.height(),
				result = this.element.children("li").filter(function() {
					var close = $(this).offset().top - base - height + $(this).height();
					// TODO improve approximation
					return close < 10 && close > -10;
				});

			// TODO try to catch this earlier when scrollTop indicates the last page anyway
			if (!result.length) {
				result = this.element.children(":last");
			}
			this.activate(event, result);
		} else {
			this.activate(event, this.element.children(!this.active || this.last() ? ":first" : ":last"));
		}
	},

	// TODO merge with nextPage
	previousPage: function(event) {
		if (this.hasScroll()) {
			// TODO merge with no-scroll-else
			if (!this.active || this.first()) {
				this.activate(event, this.element.children(":last"));
				return;
			}

			var base = this.active.offset().top,
				height = this.element.height();
				result = this.element.children("li").filter(function() {
					var close = $(this).offset().top - base + height - $(this).height();
					// TODO improve approximation
					return close < 10 && close > -10;
				});

			// TODO try to catch this earlier when scrollTop indicates the last page anyway
			if (!result.length) {
				result = this.element.children(":first");
			}
			this.activate(event, result);
		} else {
			this.activate(event, this.element.children(!this.active || this.first() ? ":last" : ":first"));
		}
	},

	hasScroll: function() {
		return this.element.height() < this.element.attr("scrollHeight");
	},

	select: function( event ) {
		this._trigger("selected", event, { item: this.active });
	}
});

}(jQuery));

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/drag-and-drop-support.js' */
var DragnDropSupport=(function(){var c,a;try{c=new XMLHttpRequest();a=!!(c.sendAsBinary||c.upload)&&!(jQuery.browser.mozilla&&jQuery.browser.version.indexOf("1.9.1")>-1)}catch(b){a=false}c=null;return{hasXhrSupport:a}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/drag-and-drop-utils.js' */
AJS.DragAndDrop={};(function(b){var c,a=/^\w+:\/\/[^\/?#]+/.exec(location.href);AJS.DragAndDropUtils={hasXhrOrGearsSupport:function(){return(AJS.DragAndDropUtils.hasXhrSupport||AJS.DragAndDropUtils.isGearsInstalledNoPrompt())},hasXhrSupport:DragnDropSupport.hasXhrSupport,base:a,init:function(d){d&&d(DragnDropSupport.hasXhrSupport)},bindDragEnter:function(d,f){if(d.addEventListener){f=(this.isFireFox35OrLater()?this.firefox35DragEnterAndOverCallbackWrapper(f):f);f&&d.addEventListener("dragenter",f,false)}else{if(d.attachEvent){var e=this.ieDragEnterAndDragOverCallbackWrapper(f);d.attachEvent("ondragenter",e);b(window).unload(function(){d.detachEvent("ondragenter",e)})}}},bindDragOver:function(d,f){if(d.addEventListener){if(this.isFireFox35OrLater()){f=this.firefox35DragEnterAndOverCallbackWrapper(f)}else{if(b.browser.safari){f=this.safariDragOverCallbackWrapper(f)}}f&&d.addEventListener("dragover",f,false)}else{if(d.attachEvent){var e=this.ieDragEnterAndDragOverCallbackWrapper(f);d.attachEvent("ondragover",e);b(window).unload(function(){d.detachEvent("ondragover",e)})}}},bindDragLeave:function(d,e){if(!e){return}if(b.browser.safari||this.isFireFox35OrLater()){d.addEventListener("dragleave",e,false)}else{if(b.browser.mozilla){d.addEventListener("dragexit",e,false)}else{if(b.browser.msie){d.attachEvent("ondragleave",e);b(window).unload(function(){d.detachEvent("ondragleave",e)})}}}},bindDrop:function(e,g){if(b.browser.mozilla){var d=(this.isFireFox35OrLater()?"drop":"dragdrop");e.addEventListener(d,this.mozillaDropCallbackWrapper(g),false)}else{if(b.browser.msie){if(g){var f=function(h){g(h);AJS.DragAndDropUtils.stopPropagation(h)};e.attachEvent("ondrop",f);b(window).unload(function(){e.detachEvent("ondrop",f)})}}else{if(b.browser.safari){g&&e.addEventListener("drop",function(h){g(h);AJS.DragAndDropUtils.stopPropagation(h)},false)}}}},niceSize:function(d){var g=[" B"," kB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"];for(var e=0,f=g.length;e<f;e++){if(d<Math.pow(2,10*(e+1))){return(!e?d:(d/Math.pow(2,10*e)).toFixed(2))+g[e]
}}return(d/Math.pow(2,10*(e+1))).toFixed(2)+g[g.length-1]},ieDragEnterAndDragOverCallbackWrapper:function(d){return function(f){f=f||window.event;if(!f){return}d&&d(f);b.browser.msie&&(f.returnValue=false)}},safariDragOverCallbackWrapper:function(d){return function(f){f=f||window.event;if(!f){return}if(f.target.type=="file"){return}d&&d(f);(b.inArray("public.file-url",f.dataTransfer.types)!=-1)&&f.preventDefault()}},mozillaDropCallbackWrapper:function(d){return function(f){if(!f){return}d&&d(f);f.preventDefault();if(AJS.DragAndDropUtils.isFireFox35OrLater()){AJS.DragAndDropUtils.firefox35FileDataInEvent(f)&&f.stopPropagation()}else{f.stopPropagation()}}},firefox35DragEnterAndOverCallbackWrapper:function(d){return function(f){if(!f){return}d&&d(f);AJS.DragAndDropUtils.firefox35FileDataInEvent(f)&&f.preventDefault()}},firefox35FileDataInEvent:function(d){return b.inArray("application/x-moz-file",d.dataTransfer.types)!=-1},stopPropagation:function(d){d=d||window.event;if(!d){return}if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}},preventDefault:function(d){d=d||window.event;if(!d){return}if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}},isGearsInstalledNoPrompt:function(){try{return !!window.google&&!!google.gears&&!!google.gears.factory.create("beta.desktop")}catch(d){return false}},isGearsInstalledWithPermissions:function(d){var e={returnUrl:location.href};d=b.extend({},e,d);if(AJS.DragAndDropUtils.isGearsInstalledNoPrompt()){return google.gears.factory.getPermission("Confluence",Confluence.getContextPath()+"/images/logo/confluence_64.png","Allow Confluence to use Google Gears to perform drag-and-drop file uploads?")}else{AJS.log("Gears installation prompt is disabled, since it has been discontinued");return false}},isFireFox35OrLater:function(){return !this.isFireFox30()&&b.browser.version.indexOf("1.9.")!=-1},isFireFox30:function(){return b.browser.version.indexOf("1.9.0")!=-1},isIE9:function(){if(AJS.$.browser.msie){var d=parseFloat(AJS.$.browser.version);
if(d>=9&&d<10){return true}}return false},enableDropZoneOn:function(d,e){if(!d){throw new Error("Cannot enable drop zone on invalid container. Received: "+d)}e=e||AJS.DragAndDrop.defaultDropHandler;this.bindDragEnter(d);this.bindDragOver(d);this.bindDragLeave(d);this.bindDrop(d,e)},getFilesFromDropEvent:function(f){if(AJS.DragAndDropUtils.isFolderDropEvent(f)){AJS.DragAndDropUtils.displayMessageDialog("No files were found in the items dragged onto this window. It is possible that you may have dragged a folder - this is not supported. \u003cp>\u003cstrong>Note to Mac OSX users:\u003c\/strong> Some items may appear as files but are actually folders and are therefore not supported. Examples include iWork and Keynote files.\u003c\/p>");return[]}var g=this.getDesktopInstance().getDragData(f,"application/x-gears-files");var d;try{d=g&&g.files}catch(h){AJS.log("Error retrieving file data from drop event")}return d||[]},isFolderDropEvent:function(d){try{return(this.getDesktopInstance().getDragData(d,"application/x-gears-files")||{}).count==0}catch(f){AJS.log("Error retrieving file data from drop event")}},displayMessageDialog:function(e){var d=new AJS.Dialog(600,200,"drag-and-drop-message-dialog");d.addHeader("Drag & Drop").addPanel("Panel 1","<div>"+e+"</div>").addButton("Done",function(f){d.remove()});d.show()},getDesktopInstance:function(){if(!c){c=google.gears.factory.create("beta.desktop")}return c}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/plupload.js' */
(function(){var f=0,k=[],m={},i={},a={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},l=/[<>&\"\']/g,b,c=window.setTimeout,d={},e;function h(){this.returnValue=false}function j(){this.cancelBubble=true}(function(n){var o=n.split(/,/),p,r,q;for(p=0;p<o.length;p+=2){q=o[p+1].split(/ /);for(r=0;r<q.length;r++){i[q[r]]=o[p]}}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.template,xltx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/html,htm html xhtml,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,text/csv,csv,text/plain,asc txt text diff log,application/octet-stream,exe");var g={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:i,ua:(function(){var r=navigator,q=r.userAgent,s=r.vendor,o,n,p;o=/WebKit/.test(q);p=o&&s.indexOf("Apple")!==-1;
n=window.opera&&window.opera.buildNumber;return{windows:navigator.platform.indexOf("Win")!==-1,ie:!o&&!n&&(/MSIE/gi).test(q)&&(/Explorer/gi).test(r.appName),webkit:o,gecko:!o&&/Gecko/.test(q),safari:p,opera:!!n}}()),extend:function(n){g.each(arguments,function(o,p){if(p>0){g.each(o,function(r,q){n[q]=r})}});return n},getElement:function(n){return n&&n.nodeType==1?n:document.getElementById(n)},cleanName:function(n){var o,p;p=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(o=0;o<p.length;o+=2){n=n.replace(p[o],p[o+1])}n=n.replace(/\s+/g,"_");n=n.replace(/[^a-z0-9_\-\.]+/gi,"");return n},addRuntime:function(n,o){o.name=n;k[n]=o;k.push(o);return o},guid:function(){var n=new Date().getTime().toString(32),o;for(o=0;o<5;o++){n+=Math.floor(Math.random()*65535).toString(32)}return(g.guidPrefix||"p")+n+(f++).toString(32)},buildUrl:function(o,n){var p="";g.each(n,function(r,q){p+=(p?"&":"")+encodeURIComponent(q)+"="+encodeURIComponent(r)});if(p){o+=(o.indexOf("?")>0?"&":"?")+p}return o},each:function(q,r){var p,o,n;if(q){p=q.length;if(p===b){for(o in q){if(q.hasOwnProperty(o)){if(r(q[o],o)===false){return}}}}else{for(n=0;n<p;n++){if(r(q[n],n)===false){return}}}}},formatSize:function(n){if(n===b||/\D/.test(n)){return g.translate("N/A")}if(n>1073741824){return Math.round(n/1073741824,1)+" GB"}if(n>1048576){return Math.round(n/1048576,1)+" MB"}if(n>1024){return Math.round(n/1024,1)+" KB"}return n+" b"},getPos:function(o,s){var t=0,r=0,v,u=document,p,q;o=o;s=s||u.body;function n(B){var z,A,w=0,C=0;if(B){A=B.getBoundingClientRect();z=u.compatMode==="CSS1Compat"?u.documentElement:u.body;w=A.left+z.scrollLeft;C=A.top+z.scrollTop}return{x:w,y:C}}if(o&&o.getBoundingClientRect&&(navigator.userAgent.indexOf("MSIE")>0&&u.documentMode!==8)){p=n(o);q=n(s);return{x:p.x-q.x,y:p.y-q.y}}v=o;while(v&&v!=s&&v.nodeType){t+=v.offsetLeft||0;
r+=v.offsetTop||0;v=v.offsetParent}v=o.parentNode;while(v&&v!=s&&v.nodeType){t-=v.scrollLeft||0;r-=v.scrollTop||0;v=v.parentNode}return{x:t,y:r}},getSize:function(n){return{w:n.offsetWidth||n.clientWidth,h:n.offsetHeight||n.clientHeight}},parseSize:function(n){var o;if(typeof(n)=="string"){n=/^([0-9]+)([mgk]?)$/.exec(n.toLowerCase().replace(/[^0-9mkg]/g,""));o=n[2];n=+n[1];if(o=="g"){n*=1073741824}if(o=="m"){n*=1048576}if(o=="k"){n*=1024}}return n},xmlEncode:function(n){return n?(""+n).replace(l,function(o){return a[o]?"&"+a[o]+";":o}):n},toArray:function(p){var o,n=[];for(o=0;o<p.length;o++){n[o]=p[o]}return n},addI18n:function(n){return g.extend(m,n)},translate:function(n){return m[n]||n},isEmptyObj:function(n){if(n===b){return true}for(var o in n){return false}return true},hasClass:function(p,o){var n;if(p.className==""){return false}n=new RegExp("(^|\\s+)"+o+"(\\s+|$)");return n.test(p.className)},addClass:function(o,n){if(!g.hasClass(o,n)){o.className=o.className==""?n:o.className.replace(/\s+$/,"")+" "+n}},removeClass:function(p,o){var n=new RegExp("(^|\\s+)"+o+"(\\s+|$)");p.className=p.className.replace(n,function(r,q,s){return q===" "&&s===" "?" ":""})},getStyle:function(o,n){if(o.currentStyle){return o.currentStyle[n]}else{if(window.getComputedStyle){return window.getComputedStyle(o,null)[n]}}},addEvent:function(s,n,t){var r,q,p,o;o=arguments[3];n=n.toLowerCase();if(e===b){e="Plupload_"+g.guid()}if(s.addEventListener){r=t;s.addEventListener(n,r,false)}else{if(s.attachEvent){r=function(){var u=window.event;if(!u.target){u.target=u.srcElement}u.preventDefault=h;u.stopPropagation=j;t(u)};s.attachEvent("on"+n,r)}}if(s[e]===b){s[e]=g.guid()}if(!d.hasOwnProperty(s[e])){d[s[e]]={}}q=d[s[e]];if(!q.hasOwnProperty(n)){q[n]=[]}q[n].push({func:r,orig:t,key:o})},removeEvent:function(s,n){var q,t,p;if(typeof(arguments[2])=="function"){t=arguments[2]}else{p=arguments[2]}n=n.toLowerCase();if(s[e]&&d[s[e]]&&d[s[e]][n]){q=d[s[e]][n]}else{return}for(var o=q.length-1;o>=0;o--){if(q[o].key===p||q[o].orig===t){if(s.detachEvent){s.detachEvent("on"+n,q[o].func)
}else{if(s.removeEventListener){s.removeEventListener(n,q[o].func,false)}}q[o].orig=null;q[o].func=null;q.splice(o,1);if(t!==b){break}}}if(!q.length){delete d[s[e]][n]}if(g.isEmptyObj(d[s[e]])){delete d[s[e]];try{delete s[e]}catch(r){s[e]=b}}},removeAllEvents:function(o){var n=arguments[1];if(o[e]===b||!o[e]){return}g.each(d[o[e]],function(q,p){g.removeEvent(o,p,n)})}};g.Uploader=function(r){var p={},u,t=[],q;u=new g.QueueProgress();r=g.extend({chunk_size:0,multipart:true,multi_selection:true,file_data_name:"file",filters:[]},r);function s(){var w,x=0,v;if(this.state==g.STARTED){for(v=0;v<t.length;v++){if(!w&&t[v].status==g.QUEUED){w=t[v];w.status=g.UPLOADING;if(this.trigger("BeforeUpload",w)){this.trigger("UploadFile",w)}}else{x++}}if(x==t.length){this.stop();this.trigger("UploadComplete",t)}}}function o(){var w,v;u.reset();for(w=0;w<t.length;w++){v=t[w];if(v.size!==b){u.size+=v.size;u.loaded+=v.loaded}else{u.size=b}if(v.status==g.DONE){u.uploaded++}else{if(v.status==g.FAILED){u.failed++}else{u.queued++}}}if(u.size===b){u.percent=t.length>0?Math.ceil(u.uploaded/t.length*100):0}else{u.bytesPerSec=Math.ceil(u.loaded/((+new Date()-q||1)/1000));u.percent=u.size>0?Math.ceil(u.loaded/u.size*100):0}}function n(){return !!u.queued}g.extend(this,{state:g.STOPPED,runtime:"",features:{},files:t,settings:r,total:u,id:g.guid(),init:function(){var A=this,B,x,w,z=0,y;if(typeof(r.preinit)=="function"){r.preinit(A)}else{g.each(r.preinit,function(D,C){A.bind(C,D)})}r.page_url=r.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");if(!/^(\w+:\/\/|\/)/.test(r.url)){r.url=r.page_url+r.url}r.chunk_size=g.parseSize(r.chunk_size);r.max_file_size=g.parseSize(r.max_file_size);A.bind("FilesAdded",function(C,F){var E,D,H=0,I,G=r.filters;if(G&&G.length){I=[];g.each(G,function(J){g.each(J.extensions.split(/,/),function(K){if(/^\s*\*\s*$/.test(K)){I.push("\\.*")}else{I.push("\\."+K.replace(new RegExp("["+("/^$.*+?|()[]{}\\".replace(/./g,"\\$&"))+"]","g"),"\\$&"))}})});I=new RegExp(I.join("|")+"$","i")
}for(E=0;E<F.length;E++){D=F[E];D.loaded=0;D.percent=0;D.status=g.QUEUED;if(I&&!I.test(D.name)){C.trigger("Error",{code:g.FILE_EXTENSION_ERROR,message:g.translate("File extension error."),file:D});continue}if(D.size!==b&&D.size>r.max_file_size){C.trigger("Error",{code:g.FILE_SIZE_ERROR,message:g.translate("File size error."),file:D});continue}t.push(D);H++}if(H){c(function(){A.trigger("QueueChanged");A.refresh()},1)}else{return false}});if(r.unique_names){A.bind("UploadFile",function(C,D){var F=D.name.match(/\.([^.]+)$/),E="tmp";if(F){E=F[1]}D.target_name=D.id+"."+E})}A.bind("UploadProgress",function(C,D){D.percent=D.size>0?Math.ceil(D.loaded/D.size*100):100;o()});A.bind("StateChanged",function(C){if(C.state==g.STARTED){q=(+new Date())}else{if(C.state==g.STOPPED){for(B=C.files.length-1;B>=0;B--){if(C.files[B].status==g.UPLOADING){C.files[B].status=g.QUEUED;o()}}}}});A.bind("QueueChanged",o);A.bind("Error",function(C,D){if(D.file){D.file.status=g.FAILED;o();if(C.state==g.STARTED){if(!n()){c(function(){s.call(A)},1)}}}});A.bind("FileUploaded",function(C,D){D.status=g.DONE;D.loaded=D.size;C.trigger("UploadProgress",D);c(function(){s.call(A)},1)});if(r.runtimes){x=[];y=r.runtimes.split(/\s?,\s?/);for(B=0;B<y.length;B++){if(k[y[B]]){x.push(k[y[B]])}}}else{x=k}function v(){var F=x[z++],E,C,D;if(F){E=F.getFeatures();C=A.settings.required_features;if(C){C=C.split(",");for(D=0;D<C.length;D++){if(!E[C[D]]){v();return}}}F.init(A,function(G){if(G&&G.success){A.features=E;A.runtime=F.name;A.trigger("Init",{runtime:F.name});A.trigger("PostInit");A.refresh()}else{v()}})}else{A.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}}v();if(typeof(r.init)=="function"){r.init(A)}else{g.each(r.init,function(D,C){A.bind(C,D)})}},refresh:function(){this.trigger("Refresh")},start:function(){if(this.state!=g.STARTED){this.state=g.STARTED;this.trigger("StateChanged");s.call(this)}},stop:function(){if(this.state!=g.STOPPED){this.state=g.STOPPED;this.trigger("CancelUpload");this.trigger("StateChanged")
}},getFile:function(w){var v;for(v=t.length-1;v>=0;v--){if(t[v].id===w){return t[v]}}},removeFile:function(w){var v;for(v=t.length-1;v>=0;v--){if(t[v].id===w.id){return this.splice(v,1)[0]}}},splice:function(y,w){var x;x=t.splice(y===b?0:y,w===b?t.length:w);this.trigger("FilesRemoved",x);this.trigger("QueueChanged");if(x[0].status==g.UPLOADING&&this.state==g.STARTED){this.trigger("CancelUpload")}if(!n()){var v=this;c(function(){v.trigger("UploadComplete")})}return x},trigger:function(w){var y=p[w.toLowerCase()],x,v;if(y){v=Array.prototype.slice.call(arguments);v[0]=this;for(x=0;x<y.length;x++){if(y[x].func.apply(y[x].scope,v)===false){return false}}}return true},hasEventListener:function(v){return !!p[v.toLowerCase()]},bind:function(v,x,w){var y;v=v.toLowerCase();y=p[v]||[];y.push({func:x,scope:w||this});p[v]=y},unbind:function(v){v=v.toLowerCase();var y=p[v],w,x=arguments[1];if(y){if(x!==b){for(w=y.length-1;w>=0;w--){if(y[w].func===x){y.splice(w,1);break}}}else{y=[]}if(!y.length){delete p[v]}}},unbindAll:function(){var v=this;g.each(p,function(x,w){v.unbind(w)})},destroy:function(){this.trigger("Destroy");this.unbindAll()}})};g.File=function(q,o,p){var n=this;n.id=q;n.name=o;n.size=p;n.loaded=0;n.percent=0;n.status=0};g.Runtime=function(){this.getFeatures=function(){};this.init=function(n,o){}};g.QueueProgress=function(){var n=this;n.size=0;n.loaded=0;n.uploaded=0;n.failed=0;n.queued=0;n.percent=0;n.bytesPerSec=0;n.reset=function(){n.size=n.loaded=n.uploaded=n.failed=n.queued=n.percent=n.bytesPerSec=0}};g.runtimes={};window.plupload=g})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/default-drop-handler.js' */
AJS.toInit(function(b){var c;function a(){var f=document.getElementById("fileuploadShim");if(!f){f=document.createElement("div");f.setAttribute("id","fileuploadShim");document.body.appendChild(f)}var e=new plupload.Uploader({runtimes:"html5",dragdrop:true,drop_element:b("body")[0],browse_button:f.getAttribute("id"),multipart:false,stop_propagation:true,max_file_size:+AJS.Meta.get("global-settings-attachment-max-size")}),d=function(){if(AJS.Editor&&AJS.Editor.isVisible()&&AJS.Confluence.EditorUploadProgressDialog){c=AJS.Confluence.EditorUploadProgressDialog}else{c=new AJS.DragAndDropProgressDialog()}};c=null;e.init();AJS.DragAndDrop.defaultDropHandler=null;e.bind("FilesAdded",function(g,l){if(AJS.Editor&&AJS.Editor.isVisible()){Confluence.Uploader&&Confluence.Uploader.trigger("FilesAdded",l);return}!c&&d();for(var j=0,k=l.length;j<k;j++){var h=l[j];if(h.status!==plupload.FAILED){c.render({workId:h.id,status:h.status,file:h})}}e.start()});e.bind("BeforeUpload",function(g,j){if(AJS.Editor&&AJS.Editor.isVisible()){return}var i=AJS.DragAndDropUtils.base+Confluence.getContextPath()+"/plugins/drag-and-drop/upload.action";var h=AJS.Meta.get("page-id");var k=h!=0?{pageId:h}:{draftId:AJS.Meta.get("draft-id")},l=j.name.substr(j.name.lastIndexOf(".")+1);k.filename=j.name;k.size=j.size;k.mimeType=plupload.mimeTypes[l.toLowerCase()]||"application/x-upload-data";k.spaceKey=AJS.Meta.get("space-key");k.atl_token=AJS.Meta.get("atl-token");g.settings.url=plupload.buildUrl(i,k);c.cancelListeners.push(function(o,m){var n=g.getFile(m.workId);n&&g.removeFile(n);c.renderInfo(m.workId,"File was manually removed from the queue.")});c.show()});e.bind("UploadProgress",function(g,h){c.renderUpdateToBytesUploaded(h.id,h.loaded,h.size);c.hideCloseButton()});e.bind("FileUploaded",function(g,i,h){if(h.status===0){c.renderError(i.id,"The server is not responding. Please check that it is running.")}else{c.renderComplete(i.id)}});e.bind("Error",function(h,i){if(AJS.Editor&&AJS.Editor.isVisible()){return}var g,j;
if(i.response){try{g=AJS.$.parseJSON(i.response);j=g.actionErrors[0]}catch(k){if(k.name==="SyntaxError"){j="Invalid response recieved from the server."}else{j=i.message}}c.renderError(i.file.id,j)}else{j=i.message;if(i.code==plupload.FILE_SIZE_ERROR){j=AJS.format("File of size {0} exceeds maximum upload limit of {1}",AJS.DragAndDropUtils.niceSize(i.file.size).toString(),AJS.DragAndDropUtils.niceSize(AJS.Meta.get("global-settings-attachment-max-size")).toString());!c&&d();c.render({workId:i.file.id,status:i.file.status,file:i.file,errorMessage:j});if(!c.isVisible()){c.show();c.showCloseButton()}}}});e.bind("UploadComplete",function(){if(!e.total.queued){c.showCloseButton();if(!c.hasErrors()){setTimeout(function(){c.hide();c.clearRenderOutput();window.location.reload()},1000)}}})}AJS.DragAndDropUtils.hasXhrSupport&&a()});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/observable-array-list.js' */
AJS.ObservableArrayList=function(){this._data=[];this._pushObservers=[]};AJS.ObservableArrayList.prototype={push:function(a){this._data.push(a);this._notifyPushObservers(a)},length:function(){return this._data.length},remove:function(b,a){return this._remove.call(this._data,b,a)},_remove:function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)},shift:function(){return this._data.shift()},removeByPredicate:function(b){var d=[],a=this._data.length;for(var c=0;c<a;c++){if(!b(this._data[c])){d.push(this._data[c])}}this._data=d;return a-this._data.length},addPushObserver:function(a){if(AJS.$.isFunction(a)){this._pushObservers.push(a)}else{throw new Error("Attempting to add an observer that is not a function: "+a)}},_notifyPushObservers:function(c){for(var a=0,b=this._pushObservers.length;a<b;a++){this._pushObservers[a](c)}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/plupload.html5.js' */
(function(h,k,j,e){var c={},g;function m(o,p){var n;if("FileReader" in h){n=new FileReader();n.readAsDataURL(o);n.onload=function(){p(n.result)}}else{return p(o.getAsDataURL())}}function l(o,p){var n;if("FileReader" in h){n=new FileReader();n.readAsBinaryString(o);n.onload=function(){p(n.result)}}else{return p(o.getAsBinary())}}function d(r,p,n,v){var q,o,u,s,t=this;m(c[r.id],function(w){q=k.createElement("canvas");q.style.display="none";k.body.appendChild(q);o=q.getContext("2d");u=new Image();u.onerror=u.onabort=function(){v({success:false})};u.onload=function(){var B,x,z,y,A;if(!p.width){p.width=u.width}if(!p.height){p.height=u.height}s=Math.min(p.width/u.width,p.height/u.height);if(s<1||(s===1&&n==="image/jpeg")){B=Math.round(u.width*s);x=Math.round(u.height*s);q.width=B;q.height=x;o.drawImage(u,0,0,B,x);if(n==="image/jpeg"){y=new f(atob(w.substring(w.indexOf("base64,")+7)));if(y.headers&&y.headers.length){A=new a();if(A.init(y.get("exif")[0])){A.setExif("PixelXDimension",B);A.setExif("PixelYDimension",x);y.set("exif",A.getBinary());if(t.hasEventListener("ExifData")){t.trigger("ExifData",r,A.EXIF())}if(t.hasEventListener("GpsData")){t.trigger("GpsData",r,A.GPS())}}}if(p.quality){try{w=q.toDataURL(n,p.quality/100)}catch(C){w=q.toDataURL(n)}}}else{w=q.toDataURL(n)}w=w.substring(w.indexOf("base64,")+7);w=atob(w);if(y&&y.headers&&y.headers.length){w=y.restore(w);y.purge()}q.parentNode.removeChild(q);v({success:true,data:w})}else{v({success:false})}};u.src=w})}j.runtimes.Html5=j.addRuntime("html5",{getFeatures:function(){var s,o,r,q,p,n;o=r=p=n=false;if(h.XMLHttpRequest){s=new XMLHttpRequest();r=!!s.upload;o=!!(s.sendAsBinary||s.upload)}if(o){q=!!(s.sendAsBinary||(h.Uint8Array&&h.ArrayBuffer));p=!!(File&&(File.prototype.getAsDataURL||h.FileReader)&&q);n=!!(File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))}g=j.ua.safari&&j.ua.windows&&navigator.userAgent&&navigator.userAgent.indexOf("Version/4")>0;return{html5:o,dragdrop:(function(){var t=k.createElement("div");
return("draggable" in t)||("ondragstart" in t&&"ondrop" in t)}()),jpgresize:p,pngresize:p,multipart:p||!!h.FileReader||!!h.FormData,canSendBinary:q,cantSendBlobInFormData:!!(j.ua.gecko&&h.FormData&&h.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:r,chunks:n,multi_selection:!(j.ua.safari&&j.ua.windows),triggerDialog:(j.ua.gecko&&h.FormData||j.ua.webkit)}},init:function(p,r){var n,q;function o(w){var u,t,v=[],x,s={};for(t=0;t<w.length;t++){u=w[t];if(s[u.name]){continue}s[u.name]=true;x=j.guid();c[x]=u;if(u.fileSize>0||u.size>0){v.push(new j.File(x,u.fileName||u.name,u.fileSize||u.size))}}if(v.length){p.trigger("FilesAdded",v)}}n=this.getFeatures();if(!n.html5){r({success:false});return}p.upload=function(s){o(s)};p.bind("Init",function(w){var G,F,C=[],v,D,t=w.settings.filters,u,B,s=k.body,E;G=k.createElement("div");G.id=w.id+"_html5_container";j.extend(G.style,{position:"absolute",background:p.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:p.settings.shim_bgcolor?"":0});G.className="plupload html5";if(p.settings.container){s=k.getElementById(p.settings.container);if(j.getStyle(s,"position")==="static"){s.style.position="relative"}}s.appendChild(G);no_type_restriction:for(v=0;v<t.length;v++){u=t[v].extensions.split(/,/);for(D=0;D<u.length;D++){if(u[D]==="*"){C=[];break no_type_restriction}B=j.mimeTypes[u[D]];if(B){C.push(B)}}}G.innerHTML='<input id="'+p.id+'_html5"  style="font-size:999px" type="file" accept="'+C.join(",")+'" '+(p.settings.multi_selection&&p.features.multi_selection?'multiple="multiple"':"")+" />";G.scrollTop=100;E=k.getElementById(p.id+"_html5");if(w.features.triggerDialog){j.extend(E.style,{position:"absolute",width:"100%",height:"100%"})}else{j.extend(E.style,{cssFloat:"right",styleFloat:"right"})}E.onchange=function(){o(this.files);this.value=""};F=k.getElementById(w.settings.browse_button);if(F){var z=w.settings.browse_button_hover,A=w.settings.browse_button_active,x=w.features.triggerDialog?F:G;
if(z){j.addEvent(x,"mouseover",function(){j.addClass(F,z)},w.id);j.addEvent(x,"mouseout",function(){j.removeClass(F,z)},w.id)}if(A){j.addEvent(x,"mousedown",function(){j.addClass(F,A)},w.id);j.addEvent(k.body,"mouseup",function(){j.removeClass(F,A)},w.id)}if(w.features.triggerDialog){j.addEvent(F,"click",function(y){k.getElementById(w.id+"_html5").click();y.preventDefault()},w.id)}}});p.bind("PostInit",function(){var s=j.getElement(p.settings.drop_element),t,u=false;if(s){if(g){j.addEvent(s,"dragenter",function(y){var x,v,w;x=k.getElementById(p.id+"_drop");if(!x){x=k.createElement("input");x.setAttribute("type","file");x.setAttribute("id",p.id+"_drop");x.setAttribute("multiple","multiple");j.addEvent(x,"change",function(){o(this.files);j.removeEvent(x,"change",p.id);x.parentNode.removeChild(x)},p.id);s.appendChild(x);u=true}v=j.getPos(s,k.getElementById(p.settings.container));w=j.getSize(s);if(j.getStyle(s,"position")==="static"){j.extend(s.style,{position:"relative"})}j.extend(x.style,{position:"absolute",display:"block",top:0,left:0,width:w.w+"px",height:w.h+"px",opacity:0})},p.id);j.addEvent(s,"dragleave",function(v){if(!u){t&&t.parentElement.removeChild(t);t=null}u=false});return}j.addEvent(s,"dragover",function(v){v.preventDefault()},p.id);j.addEvent(s,"drop",function(w){var v=w.dataTransfer;if(v&&v.files){o(v.files)}t&&t.parentElement.removeChild(t);t=null;w.preventDefault();if(p.settings.stop_propagation){if(w.cancelBubble){w.cancelBubble=true}else{w.stopPropagation()}}},p.id)}});p.bind("Refresh",function(s){var t,u,v,x,w;t=k.getElementById(p.settings.browse_button);if(t){u=j.getPos(t,k.getElementById(s.settings.container));v=j.getSize(t);x=k.getElementById(p.id+"_html5_container");j.extend(x.style,{top:u.y+"px",left:u.x+"px",width:v.w+"px",height:v.h+"px"});if(p.features.triggerDialog){if(j.getStyle(t,"position")==="static"){j.extend(t.style,{position:"relative"})}w=parseInt(j.getStyle(t,"z-index"),10);if(isNaN(w)){w=0}j.extend(t.style,{zIndex:w});j.extend(x.style,{zIndex:w-1})
}}});p.bind("CancelUpload",function(){if(q&&q.abort){q.abort()}});p.bind("UploadFile",function(s,u){var v=s.settings,y,t;function x(A,D,z){var B;if(File.prototype.slice){try{A.slice();return A.slice(D,z)}catch(C){return A.slice(D,z-D)}}else{if(B=File.prototype.webkitSlice||File.prototype.mozSlice){return B.call(A,D,z)}else{return null}}}function w(A){var D=0,C=0,z=("FileReader" in h)?new FileReader:null;function B(){var I,M,K,L,H,J,F,E=s.settings.url;function G(V){var T=0,N="----pluploadboundary"+j.guid(),O,P="--",U="\r\n",R="";q=new XMLHttpRequest;if(q.upload){q.upload.onprogress=function(W){u.loaded=Math.min(u.size,C+W.loaded-T);s.trigger("UploadProgress",u)}}q.onreadystatechange=function(){var W,Y;if(q.readyState==4){try{W=q.status}catch(X){W=0}if(W>=400){s.trigger("Error",{code:j.HTTP_ERROR,message:j.translate("HTTP Error."),file:u,status:W,response:q.responseText||""})}else{if(K){Y={chunk:D,chunks:K,response:q.responseText,status:W};s.trigger("ChunkUploaded",u,Y);C+=J;if(Y.cancelled){u.status=j.FAILED;return}u.loaded=Math.min(u.size,(D+1)*H)}else{u.loaded=u.size}s.trigger("UploadProgress",u);V=I=O=R=null;if(!K||++D>=K){u.status=j.DONE;s.trigger("FileUploaded",u,{response:q.responseText,status:W})}else{B()}}}};if(s.settings.multipart&&n.multipart){L.name=u.target_name||u.name;q.open("post",E,true);j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});if(typeof(V)!=="string"&&!!h.FormData){O=new FormData();j.each(j.extend(L,s.settings.multipart_params),function(X,W){O.append(W,X)});O.append(s.settings.file_data_name,V);q.send(O);return}if(typeof(V)==="string"){q.setRequestHeader("Content-Type","multipart/form-data; boundary="+N);j.each(j.extend(L,s.settings.multipart_params),function(X,W){R+=P+N+U+'Content-Disposition: form-data; name="'+W+'"'+U+U;R+=unescape(encodeURIComponent(X))+U});F=j.mimeTypes[u.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";R+=P+N+U+'Content-Disposition: form-data; name="'+s.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(u.name))+'"'+U+"Content-Type: "+F+U+U+V+U+P+N+P+U;
T=R.length-V.length;V=R;if(q.sendAsBinary){q.sendAsBinary(V)}else{if(n.canSendBinary){var S=new Uint8Array(V.length);for(var Q=0;Q<V.length;Q++){S[Q]=(V.charCodeAt(Q)&255)}q.send(S.buffer)}}return}}E=j.buildUrl(s.settings.url,j.extend(L,s.settings.multipart_params));q.open("post",E,true);q.setRequestHeader("Content-Type","application/octet-stream");if(V.encoding){q.setRequestHeader("Content-Encoding",V.encoding)}j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});q.send(V.getData?V.getData():V)}if(u.status==j.DONE||u.status==j.FAILED||s.state==j.STOPPED){return}L={name:u.target_name||u.name};if(v.chunk_size&&u.size>v.chunk_size&&(n.chunks||typeof(A)=="string")){H=v.chunk_size;K=Math.ceil(u.size/H);J=Math.min(H,u.size-(D*H));if(typeof(A)=="string"){I=A.substring(D*H,D*H+J)}else{I=x(A,D*H,D*H+J)}L.chunk=D;L.chunks=K}else{J=u.size;I=A}if(typeof(I)!=="string"&&z&&n.cantSendBlobInFormData&&n.chunks&&s.settings.chunk_size){z.onload=function(){G(z.result)};z.readAsBinaryString(I)}else{G(I)}}B()}y=c[u.id];if(n.jpgresize&&s.settings.resize&&/\.(png|jpg|jpeg)$/i.test(u.name)){d.call(s,u,s.settings.resize,/\.png$/i.test(u.name)?"image/png":"image/jpeg",function(z){if(z.success){u.size=z.data.length;w(z.data)}else{w(y)}})}else{w(y)}});p.bind("Destroy",function(s){var u,v,t=k.body,w={inputContainer:s.id+"_html5_container",inputFile:s.id+"_html5",browseButton:s.settings.browse_button,dropElm:s.settings.drop_element};for(u in w){v=k.getElementById(w[u]);if(v){j.removeAllEvents(v,s.id)}}j.removeAllEvents(k.body,s.id);if(s.settings.container){t=k.getElementById(s.settings.container)}t.removeChild(k.getElementById(w.inputContainer))});r({success:true})}});function b(){var q=false,o;function r(t,v){var s=q?0:-8*(v-1),w=0,u;for(u=0;u<v;u++){w|=(o.charCodeAt(t+u)<<Math.abs(s+u*8))}return w}function n(u,s,t){var t=arguments.length===3?t:o.length-s-1;o=o.substr(0,s)+u+o.substr(t+s)}function p(t,u,w){var x="",s=q?0:-8*(w-1),v;for(v=0;v<w;v++){x+=String.fromCharCode((u>>Math.abs(s+v*8))&255)
}n(x,t,w)}return{II:function(s){if(s===e){return q}else{q=s}},init:function(s){q=false;o=s},SEGMENT:function(s,u,t){switch(arguments.length){case 1:return o.substr(s,o.length-s-1);case 2:return o.substr(s,u);case 3:n(t,s,u);break;default:return o}},BYTE:function(s){return r(s,1)},SHORT:function(s){return r(s,2)},LONG:function(s,t){if(t===e){return r(s,4)}else{p(s,t,4)}},SLONG:function(s){var t=r(s,4);return(t>2147483647?t-4294967296:t)},STRING:function(s,t){var u="";for(t+=s;s<t;s++){u+=String.fromCharCode(r(s,1))}return u}}}function f(s){var u={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},t=[],r,n,p=e,q=0,o;r=new b();r.init(s);if(r.SHORT(0)!==65496){return}n=2;o=Math.min(1048576,s.length);while(n<=o){p=r.SHORT(n);if(p>=65488&&p<=65495){n+=2;continue}if(p===65498||p===65497){break}q=r.SHORT(n+2)+2;if(u[p]&&r.STRING(n+4,u[p].signature.length)===u[p].signature){t.push({hex:p,app:u[p].app.toUpperCase(),name:u[p].name.toUpperCase(),start:n,length:q,segment:r.SEGMENT(n,q)})}n+=q}r.init(null);return{headers:t,restore:function(y){r.init(y);var w=new f(y);if(!w.headers){return false}for(var x=w.headers.length;x>0;x--){var z=w.headers[x-1];r.SEGMENT(z.start,z.length,"")}w.purge();n=r.SHORT(2)==65504?4+r.SHORT(4):2;for(var x=0,v=t.length;x<v;x++){r.SEGMENT(n,0,t[x].segment);n+=t[x].length}return r.SEGMENT()},get:function(x){var y=[];for(var w=0,v=t.length;w<v;w++){if(t[w].app===x.toUpperCase()){y.push(t[w].segment)}}return y},set:function(y,x){var z=[];if(typeof(x)==="string"){z.push(x)}else{z=x}for(var w=ii=0,v=t.length;w<v;w++){if(t[w].app===y.toUpperCase()){t[w].segment=z[ii];t[w].length=z[ii].length;ii++}if(ii>=z.length){break}}},purge:function(){t=[];r.init(null)}}}function a(){var q,n,o={},t;q=new b();n={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};
t={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};
function p(u,C){var w=q.SHORT(u),z,F,G,B,A,v,x,D,E=[],y={};for(z=0;z<w;z++){x=v=u+12*z+2;G=C[q.SHORT(x)];if(G===e){continue}B=q.SHORT(x+=2);A=q.LONG(x+=2);x+=4;E=[];switch(B){case 1:case 7:if(A>4){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.BYTE(x+F)}break;case 2:if(A>4){x=q.LONG(x)+o.tiffHeader}y[G]=q.STRING(x,A-1);continue;case 3:if(A>2){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.SHORT(x+F*2)}break;case 4:if(A>1){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)}break;case 5:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)/q.LONG(x+F*4+4)}break;case 9:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)}break;case 10:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)/q.SLONG(x+F*4+4)}break;default:continue}D=(A==1?E[0]:E);if(t.hasOwnProperty(G)&&typeof D!="object"){y[G]=t[G][D]}else{y[G]=D}}return y}function s(){var v=e,u=o.tiffHeader;q.II(q.SHORT(u)==18761);if(q.SHORT(u+=2)!==42){return false}o.IFD0=o.tiffHeader+q.LONG(u+=2);v=p(o.IFD0,n.tiff);o.exifIFD=("ExifIFDPointer" in v?o.tiffHeader+v.ExifIFDPointer:e);o.gpsIFD=("GPSInfoIFDPointer" in v?o.tiffHeader+v.GPSInfoIFDPointer:e);return true}function r(w,u,z){var B,y,x,A=0;if(typeof(u)==="string"){var v=n[w.toLowerCase()];for(hex in v){if(v[hex]===u){u=hex;break}}}B=o[w.toLowerCase()+"IFD"];y=q.SHORT(B);for(i=0;i<y;i++){x=B+12*i+2;if(q.SHORT(x)==u){A=x+8;break}}if(!A){return false}q.LONG(A,z);return true}return{init:function(u){o={tiffHeader:10};if(u===e||!u.length){return false}q.init(u);if(q.SHORT(0)===65505&&q.STRING(4,5).toUpperCase()==="EXIF\0"){return s()}return false},EXIF:function(){var u;u=p(o.exifIFD,n.exif);if(u.ExifVersion){u.ExifVersion=String.fromCharCode(u.ExifVersion[0],u.ExifVersion[1],u.ExifVersion[2],u.ExifVersion[3])}return u},GPS:function(){var u;u=p(o.gpsIFD,n.gps);if(u.GPSVersionID){u.GPSVersionID=u.GPSVersionID.join(".")}return u},setExif:function(u,v){if(u!=="PixelXDimension"&&u!=="PixelYDimension"){return false}return r("exif",u,v)},getBinary:function(){return q.SEGMENT()
}}}})(window,document,plupload);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/upload-progress-dialog.js' */
(function(a){AJS.DragAndDropProgressDialog=function(b){var c=this;var d={header:"Attach File(s)",width:600,height:400};this._options=a.extend({},d,b);this.id="drag-and-drop-progress-dialog";this._dialog=new AJS.Dialog(this._options.width,this._options.height,this.id);this._dialog.addHeader(this._options.header).addPanel("Panel 1",AJS.DragAndDrop.Templates.uploadFileStatusContainer()).addButton("Done",function(){c.hide();c.clearRenderOutput()},"all-file-uploads-complete");this._dialog.getCurrentPanel().setPadding(0);this._$closeButton=a(".all-file-uploads-complete");a(document).keydown(function(f){if(f.which==27){if(!c._$closeButton.prop("disabled")){c.hide();c.clearRenderOutput()}return AJS.stopEvent(f)}});this._$container=a("#upload-statuses");this._workIdsOfFilesInProgress=[];this.cancelListeners=[];this.onShowListeners=[];this._hidden=true;this.hasErrorMessage=false};AJS.DragAndDropProgressDialog.prototype={show:function(){if(this._hidden){this._dialog.show();this._hidden=false;a.each(this.onShowListeners,function(b,c){c()})}this.hideCloseButton()},hide:function(){if(!this._hidden){this._dialog.hide();this._hidden=true}},isVisible:function(){return !this._hidden},_getProgressElementId:function(b){return"file-"+b+"-progress"},render:function(c){this._workIdsOfFilesInProgress.push(c.workId);this._$container.append(AJS.DragAndDrop.Templates.fileStatus({filename:c.file.name,progressElementId:this._getProgressElementId(c.workId),workId:c.workId,showCancel:(c.status==plupload.QUEUED)}));var b=a("#"+this._getProgressElementId(c.workId));b.progressbar({value:0});if(c.status==plupload.QUEUED){a("#file-upload-cancel-"+c.workId).click((function(d){return function(f){a.each(d,function(e,g){g(f,c)})}})(this.cancelListeners))}else{this.renderError(c.workId,c.errorMessage)}},renderError:function(e,d){if(a.inArray(e,this._workIdsOfFilesInProgress)==-1){throw new Error("No file status found with id: "+e)}var b=a("#file-status-block-"+e);
var c=b.attr("data-filename");b.html(aui.message.warning({content:d,titleContent:c}));this.hasErrorMessage=true},renderInfo:function(e,d){if(a.inArray(e,this._workIdsOfFilesInProgress)==-1){throw new Error("No file status found with id: "+e)}var b=a("#file-status-block-"+e);var c=b.attr("data-filename");b.html(aui.message.info({content:d,titleContent:c}));this.hasErrorMessage=true},hasErrors:function(){return this.hasErrorMessage},renderUpdateToBytesUploaded:function(h,g,b){if(a.inArray(h,this._workIdsOfFilesInProgress)==-1){throw new Error("No file status found with id: "+h)}var d=AJS.DragAndDropUtils.niceSize(g);var f=a("#file-"+h+"-uploaded");if(!!f.length){f.text(d)}else{a("#file-upload-progress-text-"+h).html(AJS.DragAndDrop.Templates.uploadFileStatusProgressMessage({fileId:h,uploadedSizeNice:d,totalSizeNice:AJS.DragAndDropUtils.niceSize(b)}))}var e=Math.round(g*100/b);var c=a("#"+this._getProgressElementId(h));c.progressbar("option","value",e)},renderComplete:function(b){if(a.inArray(b,this._workIdsOfFilesInProgress)==-1){throw new Error("No file status found with id: "+b)}a("#cancel-or-success-placeholder-"+b).html(AJS.DragAndDrop.Templates.uploadFileStatusSuccessIcon())},renderCancelled:function(c){if(a.inArray(c,this._workIdsOfFilesInProgress)==-1){throw new Error("No file status found with id: "+c)}var b=a("#"+this._getProgressElementId(c));if(b.progressbar("option","value")==0){b.progressbar("option","value",100)}b.progressbar("disable");a("#file-upload-progress-text-"+c).html("Cancelled.");a("#cancel-or-success-placeholder-"+c).hide()},clearRenderOutput:function(){this.showCloseButton();this._$container.empty();this._workIdsOfFilesInProgress=[];this.hasErrorMessage=false},hideCloseButton:function(){this._$closeButton.hide()},showCloseButton:function(){this._$closeButton.show()}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'templates/drag-and-drop.soy' */
// This file was automatically generated from drag-and-drop.soy.
// Please don't edit this file by hand.

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.DragAndDrop == 'undefined') { AJS.DragAndDrop = {}; }
if (typeof AJS.DragAndDrop.Templates == 'undefined') { AJS.DragAndDrop.Templates = {}; }


AJS.DragAndDrop.Templates.fileStatus = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li id="file-status-block-', soy.$$escapeHtml(opt_data.workId), '" data-filename="', soy.$$escapeHtml(opt_data.filename), '"><label>', soy.$$escapeHtml(opt_data.filename), '</label><div class="file-upload-progress-block"><div class="aui-progressbar" id="', soy.$$escapeHtml(opt_data.progressElementId), '"><div id="file-upload-progress-text-', soy.$$escapeHtml(opt_data.workId), '" class="file-upload-progress-text">', soy.$$escapeHtml("Waiting..."), '</div></div>', (opt_data.showCancel) ? '<div id="cancel-or-success-placeholder-' + soy.$$escapeHtml(opt_data.workId) + '" class="cancel-or-success-placeholder ui-state-default"><span id="file-upload-cancel-' + soy.$$escapeHtml(opt_data.workId) + '" class="aui-icon aui-icon-small aui-iconfont-remove" title="' + soy.$$escapeHtml("Cancel Upload") + '">' + soy.$$escapeHtml("Cancel") + '</span></div>' : '', '</div></li>');
  return opt_sb ? '' : output.toString();
};


AJS.DragAndDrop.Templates.uploadFileStatusContainer = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul id="upload-statuses"></ul>');
  return opt_sb ? '' : output.toString();
};


AJS.DragAndDrop.Templates.uploadFileStatusSuccessIcon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class=\'aui-icon aui-icon-small aui-iconfont-success\'></span>');
  return opt_sb ? '' : output.toString();
};


AJS.DragAndDrop.Templates.uploadFileStatusProgressMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span id="file-', soy.$$escapeHtml(opt_data.fileId), '-uploaded">', soy.$$escapeHtml(opt_data.uploadedSizeNice), '</span> ', soy.$$escapeHtml("of"), ' ', soy.$$escapeHtml(opt_data.totalSizeNice));
  return opt_sb ? '' : output.toString();
};


AJS.DragAndDrop.Templates.dropZone = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="attachments-drop-zone"><div class="drop-zone-image"></div><div class="drop-zone-text">', soy.$$escapeHtml("Drop files here to attach them"), '</div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-view-content', location = 'js/view-content-client.js' */
AJS.toInit(function(a){AJS.DragAndDropUtils.init(function(b){var c=a("body")[0];if(!b&&!AJS.DragAndDropUtils.isIE9()){AJS.DragAndDropUtils.enableDropZoneOn(c)}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:proxy-js', location = '/jira/proxy.js' */
AppLinks=AJS.$.extend(window.AppLinks||{},{makeRequest:function(a){var b=contextPath||AJS.params.contextPath;if(a.processData){if(a.appId){a.data=AJS.$.extend(a.data||{},{appId:a.appId})}else{if(a.appType){a.data=AJS.$.extend(a.data||{},{appType:a.appType})}}a.data=AJS.$.extend(a.data||{},{path:a.url})}else{var c=a.url;a=AJS.$.extend(a,{beforeSend:function(d){if(a.appId){d.setRequestHeader("X-AppId",a.appId)}else{if(a.appType){d.setRequestHeader("X-AppType",a.appType)}}d.setRequestHeader("X-AppPath",c)}})}a=AJS.$.extend(a,{url:b+"/plugins/servlet/applinks/proxy"});return AJS.$.ajax(a)},createProxyGetUrl:function(b){var c="";if(b.includeContext){c=contextPath||AJS.params.contextPath}var a=c+"/plugins/servlet/applinks/proxy";if(b.appId){a+="?appId="+encodeURIComponent(b.appId)}else{if(b.appType){a+="?appType="+encodeURIComponent(b.appType)}else{AJS.log("You need to specify an appType or appId");return""}}if(b.path){a+="&path="+encodeURIComponent(b.path)}return a}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/fecru-compatibility.js' */
if(jQuery!=undefined&&AJS!=undefined){jQuery=AJS.$};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/rest-service.js' */
AppLinks=AJS.$.extend(window.AppLinks||{},{Event:{NAMESPACE:"applinks",}});AppLinks.Event=AJS.$.extend(window.AppLinks.Event,{PREREADY:AppLinks.Event.NAMESPACE+".preready",READY:AppLinks.Event.NAMESPACE+".ready"});if(AJS.AppLinksInitialisationBinder){AppLinks.initialisationBinder=AJS.AppLinksInitialisationBinder}else{AppLinks.initialisationBinder=function(a){AJS.toInit(a)}}AppLinks.initialisationBinder(function(){var b=AJS.$;AppLinks=b.extend(window.AppLinks||{},{failure:function(e){if(e.status==401){window.location.reload()}else{var c=AppLinks.parseError(e);var d=b(".page-error");if(d.length>0){d.html(c).fadeIn("slow")}else{alert("REST request failed: "+c)}}},jsonRequest:function(d,e,f,g,c){if(f){f=JSON.stringify(f)}b(".page-error").fadeOut("fast");if(!c){c=AppLinks.failure}return jQuery.ajax({url:d,type:e,data:f,dataType:"json",contentType:"application/json; charset=utf-8",cache:false,success:g,error:c})},xmlRequest:function(d,e,f,g,c){if(f){f=JSON.stringify(f)}b(".page-error").fadeOut("fast");if(!c){c=AppLinks.failure}return jQuery.ajax({url:d,type:e,data:f,dataType:"xml",contentType:"application/xml; charset=utf-8",cache:false,success:g,error:c})},parseError:function(f){var c;try{c=JSON.parse(f.responseText)}catch(d){if(f.statusText){return c=f.statusText}else{return f}}if(c.message){if(b.isArray(c.message)){return c.message.join(" ")}return c.message}else{return f.statusText}},put:function(d,e,f,c){return AppLinks.jsonRequest(d,"PUT",e,f,c)},post:function(d,e,f,c){return AppLinks.jsonRequest(d,"POST",e,f,c)},update:function(d,e,c){AppLinks.put(AppLinks.self_link(d),d,e,c)},get:function(d,e,c){return AppLinks.jsonRequest(d,"GET",null,e,c)},getXml:function(d,e,c){return AppLinks.xmlRequest(d,"GET",null,e,c)},self_link:function(e){for(var c=0,f=e.link.length;c<f;c++){var d=e.link[c];if(d.rel=="self"){return d.href}}throw"No self-link found"},del:function(f,e,d){var c;if(typeof(f)=="string"){c=f}else{c=AppLinks.self_link(f)}return AppLinks.jsonRequest(c,"DELETE",null,e,d)},SPI:b.extend({},{API_VERSION:"1.0",REST_RESOURCE_URL:AJS.contextPath()+"/rest/applinks/",BASE_URL:AJS.contextPath()+"/rest/applinks/1.0",setApiVersion:function(c){AppLinks.SPI.API_VERSION=c;AppLinks.SPI.setBaseUrl(AppLinks.SPI.REST_RESOURCE_URL+AppLinks.SPI.API_VERSION)},setBaseUrl:function(c){AppLinks.SPI.BASE_URL=c},getRemoteRestBaseUrl:function(c){return c+"/rest/applinks/"+AppLinks.SPI.API_VERSION},getRemotePluginServletBaseUrl:function(c){return c+"/plugins/servlet"},getAllLinks:function(e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink";return AppLinks.get(c,e,d)},getAllLinksWithAuthInfo:function(e,d){var c=AppLinks.SPI.BASE_URL+"/listApplicationlinks";return AppLinks.get(c,e,d)},getLinksOfType:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/type/"+e;return AppLinks.get(c,f,d)},tryToFetchManifest:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/manifest.json?url="+encodeURIComponent(e);return AppLinks.get(c,f,d)},getManifestFor:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/manifest/"+f+".json";return AppLinks.get(c,e,d)},getLocalManifest:function(e,d){var c=AppLinks.SPI.BASE_URL+"/manifest.json";return AppLinks.get(c,e,d)},getRemoteManifest:function(e,f,d){var c=AppLinks.SPI.getRemoteRestBaseUrl(e)+"/manifest.json";return AppLinks.get(c,f,d)},getRemoteOAuthConsumerInfo:function(e,f,d){var c=AppLinks.SPI.getRemotePluginServletBaseUrl(e)+"/oauth/consumer-info";return AppLinks.getXml(c,f,d)},createStaticUrlAppLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createStaticUrlAppLink?typeId="+f;return AppLinks.post(c,null,e,d)},createLink:function(j,h,l,d,i,k,f,m,e){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var g={applicationLink:j,username:h,password:l,createTwoWayLink:d,customRpcURL:i,rpcUrl:k,configFormValues:f};return AppLinks.post(c,g,m,e)},createLinkWithOrphanedTrust:function(j,h,m,d,i,k,f,l,n,e){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var g={applicationLink:j,username:h,password:m,createTwoWayLink:d,customRpcURL:i,rpcUrl:k,configFormValues:f,orphanedTrust:l};return AppLinks.post(c,g,n,e)},verifyTwoWayLinkDetails:function(c,i,j,f,h,e){var d=AppLinks.SPI.BASE_URL+"/applicationlinkForm/details";var g={username:j,password:f,remoteUrl:c,rpcUrl:i};return AppLinks.post(d,g,h,e)},getApplicationLinkInfo:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkInfo/id/"+e;return AppLinks.get(c,f,d)},deleteLink:function(g,c,f,e){var d=AppLinks.SPI.BASE_URL+"/applicationlink/"+g.id;if(c){d+="?reciprocate=true"}return AppLinks.del(d,f,e)},makePrimary:function(e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/primary/"+e.id;return AppLinks.post(c,null,d)},relocate:function(h,f,c,g,e){var d=AppLinks.SPI.BASE_URL+"/relocateApplicationlink/"+h.id+"?newUrl="+encodeURIComponent(f)+"&nowarning="+(c?"true":"false");return AppLinks.post(d,null,g,e)},legacyUpgrade:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/upgrade/legacy/"+f.id;return AppLinks.post(c,null,e,d)},ualUpgrade:function(g,c,f,e){var d=AppLinks.SPI.BASE_URL+"/upgrade/ual/"+g.id;return AppLinks.post(d,c,f,e)},getEntityTypesForApplicationType:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/type/entity/"+f;return AppLinks.get(c,e,d)},getLocalEntitiesWithLinksToApplication:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entitylink/localEntitiesWithLinksTo/"+c+".json";return AppLinks.get(d,f,e)},getEntityLinksForApplication:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entities/"+c+".json";AppLinks.get(d,f,e)},getEntityLinksForApplicationUsingAnonymousAccess:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entities/anonymous/"+c+".json";return AppLinks.get(d,f,e)},createNonUalEntityLink:function(l,g,d,f,j,e,k,i){var c=AppLinks.SPI.BASE_URL+"/entitylink/"+l+"/"+g+"?reciprocate=false";var h={applicationId:d,typeId:f,key:j,name:e,isPrimary:false};return AppLinks.put(c,h,k,i)},createEntityLink:function(h,g,d,c,i,f){var e=AppLinks.SPI.BASE_URL+"/entitylink/"+h+"/"+g+"?reciprocate=";e+=(c?"true":"false");return AppLinks.put(e,d,i,f)},getConfiguredEntityLinks:function(f,e,g,d){var c=AppLinks.SPI.BASE_URL+"/entitylink/primaryLinks/"+f+"/"+e+".json";return AppLinks.get(c,g,d)},deleteEntityLink:function(h,g,d,c,i,f){var e=AppLinks.SPI.BASE_URL+"/entitylink/"+h+"/"+g+"?typeId="+d.typeId+"&key="+d.key+"&applicationId="+d.applicationId+"&reciprocate="+c;return AppLinks.del(e,i,f)},makePrimaryEntityLink:function(g,f,c,h,e){var d=AppLinks.SPI.BASE_URL+"/entitylink/primary/"+g+"/"+f+"?typeId="+c.typeId+"&key="+c.key+"&applicationId="+c.applicationId;return AppLinks.post(d,null,h,e)},canDeleteAppLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/permission/reciprocate-application-delete/"+f;return AppLinks.get(c,e,d)},canDeleteEntityLink:function(g,f,c,h,e){var d=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-delete/"+c.applicationId+"/"+g+"/"+f+"/"+c.typeId+"/"+c.key;return AppLinks.get(d,h,e)},canCreateReciprocateEntityLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-create/"+f;return AppLinks.get(c,e,d)},processPermissionCode:function(d){var c={noPermission:function(){},missing:function(){},credentialsRequired:function(e){},authenticationFailed:function(e){},noAuthentication:function(e){},noAuthenticationConfigured:function(){},noConnection:function(){},allowed:function(){},unrecognisedCode:function(e){},updateView:function(g,f,e){}};if(!d){d={}}d=b.extend(c,d);return function(f){var e=f.code;if(e=="NO_PERMISSION"){d.noPermission()}else{if(e=="MISSING"){d.missing()}else{if(e=="CREDENTIALS_REQUIRED"){d.credentialsRequired(f.url)}else{if(e=="AUTHENTICATION_FAILED"){d.authenticationFailed(f.url)}else{if(e=="NO_AUTHENTICATION"){d.noAuthentication(f.url)}else{if(e=="NO_AUTHENTICATION_CONFIGURED"){d.noAuthenticationConfigured()}else{if(e=="NO_CONNECTION"){d.noConnection()}else{if(e=="ALLOWED"){d.allowed()}else{d.unrecognisedCode(f.code)}}}}}}}}}},addAuthenticationTrigger:function(e,c,d){if(!d){d={}}if(typeof d.onSuccess=="undefined"){d.onSuccess=function(){location.reload()}}if(typeof d.onFailure=="undefined"){d.onFailure=function(){return true}}b(e).unbind("click");b(e).click(function(){if(d.before){d.before()}AppLinks.authenticateRemoteCredentials(c,d.onSuccess,d.onFailure)})},deleteOrphanedTrust:function(g,e,f,d){var c=AppLinks.SPI.BASE_URL+"/orphaned-trust/"+e+"/"+g;return AppLinks.del(c,f,d)},getOrphanedTrust:function(e,d){var c=AppLinks.SPI.BASE_URL+"/orphaned-trust/";return AppLinks.get(c,e,d)},showCreateEntityLinkSuggestion:function(){return true},getApplicationLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/"+f;return AppLinks.get(c,e,d)},createApplicationLink:function(f,d,i,j,c,k,g){var e=AppLinks.SPI.BASE_URL+"/applicationlink";var h={id:f,name:d,rpcUrl:i,displayUrl:j,typeId:c};return AppLinks.put(e,h,k,g)},createConsumer:function(e,n,d,m,i,l,g,p,h,k,o,f){var c=AppLinks.SPI.BASE_URL+"/applicationlink/"+e+"/authentication/consumer";var j={key:n,name:d,description:m,sharedSecret:i,publicKey:l,outgoing:k,twoLOAllowed:g,executingTwoLOUser:p,twoLOImpersonationAllowed:h};return AppLinks.put(c,j,o,f)},createConsumerAutoConfigure:function(j,i,f,c,h,e){var d=AppLinks.SPI.BASE_URL+"/applicationlink/"+j+"/authentication/consumer?autoConfigure=true";var g={twoLOAllowed:i,executingTwoLOUser:f,twoLOImpersonationAllowed:c};return AppLinks.put(d,g,h,e)},registerProvider:function(i,h,e,g,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/"+i+"/authentication/provider";var f={config:e,provider:h};return AppLinks.put(c,f,g,d)}},(window.AppLinks&&window.AppLinks.SPI)||{})});var a="applinks";AppLinks.UI={showInfoBox:function(c){b(".aui-message.success").remove();AppLinks.UI.createMessage("success",c,"page-info")},hideInfoBox:function(){b(".aui-message.success").remove()},showErrorBox:function(c){AppLinks.UI.createMessage("error",c,"page-error")},hideErrorBox:function(){b(".aui-message.error").remove()},showWarningBox:function(d){if(b.isArray(d)&&d.length>0){var c=b("<ul></ul>");b(d).each(function(f){c.append(b("<li/>",{text:d[f]}))});var e=b('<div class="page-warning"></div>').append(c);AppLinks.UI.createMessage("warning",e.html(),"page-warning")}else{AppLinks.UI.createMessage("warning",d,"page-warning")}},hideWarningBox:function(){b(".aui-message.warning").remove()},shortenString:function(d,c){if(d.length>c){d=d.substring(0,c)+"..."}return d},createMessage:function(d,e,c){var f=b('<div class="'+c+'">');f.html(e);AJS.messages[d](".applinks-message-bar",{title:"",body:f.wrap("<div></div>").parent().html(),closeable:true})},displayValidationErrorMessages:function(c,f,e){if(b.isArray(e)){b(e).each(function(j,h){var k=b('<div class="error applinks-error">');k.text(h);b(f).find("."+c).append(k)})}else{if(typeof e!="undefined"){var g=b('<div class="error applinks-error">');g.text(e.toString());b(f).find("."+c).append(g)}}},displayValidationError:function(c,d,e){return function(j){if(j.status==401){window.location.reload();return}b(".applinks-error").remove();b(".loading").remove();var h=j.responseText;var i=b.parseJSON(h);var g=i.message;if(typeof i.fields=="undefined"){AppLinks.UI.displayValidationErrorMessages(c,d,g)}else{var f=i.fields;b(f).each(function(k){var l=b('<div class="error applinks-error" id="'+f[k]+'-error">');l.text(g[k]);if(b(d).find("."+f[k]).length>0){l.insertAfter(b(d).find("."+f[k]))}else{l.insertAfter(b(d).find("."+c).append(l))}})}b(d).find("."+c).addClass("fully-populated-errors");if(e){e()}}},addProtocolToURL:function(c){var f=b.trim(c);var e=f.toLowerCase();var d=false;if(e.length>=7){if(e.substring(0,7).indexOf("http")!=-1){d=true}}if(!d){f="http://"+f}return f},prettyJoin:function(d,g,f){if(!f){f=AppLinks.I18n.getText("applinks.and")}var c=d.length;var e="";b.each(d,function(h,i){if(h==(c-1)&&c>1){e+=" "+f+"  "+g(i)}else{e+=g(i);if(h+2<c){e+=", "}}});return e},showLoadingIcon:function(c){b('<span class="loading">&nbsp;</span>').insertAfter(c)},hideLoadingIcon:function(c){b(c).next(".loading").remove()},findUrl:function(f){var e=undefined;var g=f.toLowerCase();var d=g.indexOf("http:");if(d==-1){d=g.indexOf("https:")}if(d>-1){var c=g.indexOf(" ",d);if(c==-1){c=g.length}e=f.substring(d,c)}return e},findApplicationType:function(c){c=c.toLowerCase();if(c.indexOf("jira")!=-1){return"jira"}else{if(c.indexOf("fisheye")!=-1){return"fecru"}else{if(c.indexOf("confluence")!=-1){return"confluence"}else{if(c.indexOf("refapp")!=-1){return"refapp"}else{return undefined}}}}},escapeSelector:function(c){return c.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},sanitiseHTML:function(c){var d={"<":"&lt;",'"':"&quot;","&":"&amp;"};return c.replace(/[<"&]/g,function(e){return d[e]})},refreshOrphanedTrust:function(){var c=function(d){b("tr.orphaned-trust-row").each(function(){var j=b(this);var k=j.attr("data-id");var g=j.attr("data-type");var f=false;for(var e=0;e<d.orphanedTrust.length;e++){var h=d.orphanedTrust[e];if(k==h.id&&g==h.type){f=true;break}}if(!f){j.remove();if(d.orphanedTrust.length==0){b(".orphaned-trust-warning").hide()}}})};AppLinks.SPI.getOrphanedTrust(c)},removeCssClass:function(c,d){b(c).removeClass(function(f,h){var g=h.split(" ");var e="";b.each(g,function(i,j){if(j.indexOf(d)!=-1){e=j}});return e})}};(function(){var c=b({});b.each(["bind","unbind","trigger"],function(d,e){AppLinks.UI[e]=function(){return c[e].apply(c,arguments)}})})();AppLinks.I18n={interpolate:function(d,c){if(c){if(!b.isArray(c)){c=[new String(c)]}c.unshift(d);d=AJS.format.apply(AJS,c)}return d},getTextWithPrefix:function(c,d){return AppLinks.I18n.interpolate(appLinksI18n.entries[a+"."+c],d)},getText:function(c,d){return AppLinks.I18n.interpolate(AppLinks.I18n.resolveValue(c),d)},getApplicationTypeName:function(c){return appLinksI18n.entries["applinks.application.type."+c]},getEntityTypeName:function(c){return appLinksI18n.entries["applinks.entity.type."+c]},getPluralizedEntityTypeName:function(c){return appLinksI18n.entries["applinks.entity.type.plural."+c]},getAuthenticationTypeName:function(c){return appLinksI18n.entries["applinks.auth.provider."+c]},resolveValue:function(c){var d=appLinksI18n.entries[c];return typeof d=="undefined"?c:d}};AppLinks.Docs={createDocLink:function(d,e,c){if(!c){c=""}else{c=" "+c}return b("<a/>",{"class":"ual-help-link"+c,href:AppLinks.Docs.getDocHref(d,e),target:"_blank",text:AppLinks.I18n.getText("applinks.help"),title:AppLinks.I18n.getText("applinks.help")})},getDocHref:function(d,e){var c=AppLinks.Docs.resolveValue("applinks.docs.root")+"/"+AppLinks.Docs.resolveValue(d);if(e){c+="#"+AppLinks.Docs.resolveValue(e)}return c},resolveValue:function(c){var d=applinksDocs.entries[c];return typeof d=="undefined"?c:d}};b(document).trigger(AppLinks.Event.PREREADY);b(document).trigger(AppLinks.Event.READY)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/json2.js' */
if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/autocomplete.js' */
AJS.$(document).bind(AppLinks.Event.READY,function(){AppLinks.autoComplete={cacheManager:function(c){var a={},b=[],c=c||30;return{get:function(d){return a[d]},put:function(d,e){a[d]=e;b.push(d);if(b.length>c){delete a[b.shift()]}},clear:function(){a={};b=[]}}}};(function(d){var c=function(f){AJS.log("InputDrivenDropDown: truncating text");var h=f.$.closest(".aui-dropdown").width(),g=20;d("a span:not(.icon)",f.$).each(function(){var j=d(this),i=AJS("var","&#8230;"),l=i.width(),k=false;j.wrapInner(d("<em>"));d("em",j).each(function(){var m=d(this);m.show();if(this.offsetLeft+this.offsetWidth>h){var t=this.childNodes,s=false;for(var o=t.length-1;o>=0;o--){var p=t[o],n=1,r=(p.nodeType==3)?"nodeValue":"innerHTML",q=p[r];do{if(n<=q.length){p[r]=q.substr(0,q.length-n++)}else{break}}while(this.offsetLeft+this.offsetWidth+l>h-g);if(n<=q.length){s=true;break}}if(s){k=true}else{m.hide()}}});if(k){j.append(i);this.elpss=i}})};var b=function(f,l){if(!l.length||!l[0]){return}AJS.log("InputDrivenDropDown: highlighting tokens");for(var h=0,j=l.length;h<j;h++){var g=l[h];l[h]=g?g.replace(/[\.\*\+\?\|\(\)\[\]{}\\]/g,"\\$"):""}var k=new RegExp("("+l.join("|")+")","gi");d("li a:not(.dropdown-prevent-highlight) span",f.$).each(function(){var m=d(this),i=m.html().replace(k,"<strong>$1</strong>");m.html(i)})};var e=function(j,g){var i=j.options,h=j.dd;if(h){h.hide();h.$.remove()}i.ajsDropDownOptions=i.ajsDropDownOptions||{};if(i.ajsDropDownOptions&&!i.ajsDropDownOptions.alignment){i.ajsDropDownOptions.alignment="left"}i.ajsDropDownOptions.selectionHandler=i.ajsDropDownOptions.selectionHandler||function(l,k){if(l.type!="click"){l.preventDefault();d("a",k).click();document.location=d("a",k).attr("href")}};i.ajsDropDownOptions.displayHandler=function(k){return AJS.escapeHtml(k.name)};var f=j.dd=new AJS.dropDown(g.matrix,i.ajsDropDownOptions)[0];if(i.ajsDropDownOptions&&i.ajsDropDownOptions.className){f.$.addClass(i.ajsDropDownOptions.className)}if(i.dropdownPlacement){i.dropdownPlacement(f.$)}else{AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");d("body").append(f.$)}b(f,g.queryTokens||[g.query]);c(f);if(i.dropdownPostprocess){i.dropdownPostprocess(f.$)}f.show(j._effect);if(typeof i.onShow=="function"){i.onShow.call(f,f.$)}return f};function a(g,f){this._effect="appear";this._timer=null;this.id=g;this.options=f;this.inactive=false;this.busy=false;this.cacheManager=AppLinks.autoComplete.cacheManager()}a.prototype.clearCache=function(){this.cacheManager.clear()};a.prototype.change=function(h,g){var f=this;if(h!=f._value||g){f._value=h;f.busy=false;clearTimeout(f._timer);if(g||(/\S{0,}/).test(h)){var i=f.cacheManager.get(h);if(i){e(f,i)}else{f.busy=true;f._timer=setTimeout(function(){f.options.getDataAndRunCallback.call(f,h,f.show)},200)}}else{f.dd&&f.dd.hide()}}};a.prototype.dropDownLength=function(){return this.dd.links?this.dd.links.length:0};a.prototype.dropDownItem=function(f){return this.dropDownLength()>f?this.dd.links[f]:null};a.prototype.hide=function(){this.dd&&this.dd.hide()};a.prototype.remove=function(){var f=this.dd;if(f){this.hide();f.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};a.prototype.show=function(g,i,h){if(this.inactive){AJS.log("Quick search abandoned before server response received, ignoring. "+this);return}var f={matrix:g,query:i,queryTokens:h};this.cacheManager.put(i,f);e(this,f);this.busy=false};AppLinks.inputDrivenDropdown=function(f){return new a("inputdriven-dropdown",f)}})(jQuery)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/wizard.js' */
AJS.$(document).bind(AppLinks.Event.PREREADY,function(){(function(d){d.fn.wizard=function(v){var u={width:500,height:350,onshow:function(w,x){return true},aftershow:function(){return true},oncancel:function(){return true},onsubmit:function(){return true},aftersubmit:function(){return true},onnext:function(){return true},onprevious:function(){return true},cancelLabel:AppLinks.I18n.getText("applinks.cancel"),submitLabel:AppLinks.I18n.getText("applinks.create"),nextLabel:AppLinks.I18n.getText("applinks.next"),previousLabel:AppLinks.I18n.getText("applinks.previous"),id:""};if(!v){v={}}v=d.extend(u,v);var t=this;this.each(function(){var D=d(this);var w=new AJS.Dialog(v.width,v.height,v.id);var L=q(w,v.onshow,v.aftershow);var K=c(w,v.oncancel);var z=h(w,v.onsubmit,v.aftersubmit);var M=a(w,v.onprevious);var I=m(w,v.onnext);var G=k(w);var B=o(w);var C=g(w);var H=l(w);var J=s(w);var E=n(w);if(v.showButtonId){d("#"+v.showButtonId).click(L)}var y=f(D);for(var A=0;A<y.length;A++){var F=y[A];j(w,F);if(F.className){w.addHeader(F.title,F.className+"-header")}else{w.addHeader(F.title)}if(A!=0&&d(F.div).attr("previous")!="false"){w.addButton(v.previousLabel,M,"applinks-previous-button")}if(A<y.length-1&&d(F.div).attr("submit")!="true"&&d(F.div).attr("next")!="false"){w.addButton(v.nextLabel,I,"applinks-next-button")}if(d(F.div).attr("submit")=="true"){w.addButton(v.submitLabel,z,"wizard-submit")}if(!w.getPage(A).buttonpanel){w.addButton("",null);d(w.getPage(A).buttonpanel).empty();var x=d('<a class="button-panel-button applinks-cancel-link">'+v.cancelLabel+"</a>");w.getPage(A).buttonpanel.append(x);x.click(K)}else{var x=d('<a class="button-panel-link button-panel-cancel-link applinks-cancel-link">'+v.cancelLabel+"</a>");d(w.getPage(A).buttonpanel).append(x);x.click(K)}if(A<y.length-1){w.addPage()}}t={dialog:w,nextPage:I,prevPage:M,submit:z,cancel:K,show:L,disableNextBtn:G,enableNextBtn:B,disableSubmitBtn:C,enableSubmitBtn:H,disablePreviousBtn:J,enablePreviousBtn:E};w.gotoPage(0);w.gotoPanel(0)});return t};function s(t){return function(){b(r(t,"applinks-previous-button"))}}function n(t){return function(){i(r(t,"applinks-previous-button"))}}function k(t){return function(){b(r(t,"applinks-next-button"))}}function o(t){return function(){i(r(t,"applinks-next-button"))}}function g(t){return function(v){var u=r(t,"wizard-submit");b(u);if(typeof(v)=="undefined"||v){d('<span class="loading">&nbsp;</span>').insertBefore(u)}else{u.parent().find(".loading").remove()}}}function l(t){return function(){var u=r(t,"wizard-submit");i(u);u.parent().find(".loading").remove()}}function r(u,t){return d(u.getPage(u.curpage).buttonpanel).find("."+t)}function p(t){d(t.popup.element).find("form").each(function(){this.reset()})}function i(t){t.attr("disabled",false)}function b(t){t.attr("disabled",true)}function q(t,u,v){return function(w){if(u(t,w)!==false){t.gotoPage(0);t.gotoPanel(0);d(document).unbind("keydown.ual.dialog");d(document).bind("keydown.ual.dialog",e(t));t.show();v()}}}function c(t,u){return function(){if(u(t)!==false){t.hide();p(t)}}}function a(t,u){return function(){if(u(t)!==false){t.prevPage()}}}function m(t,u){return function(){if(u(t)!==false){t.nextPage()}}}function e(t){return function(u){if(u.keyCode===27){p(t);d(document).unbind("keydown.ual.dialog")}}}function h(u,v,t){return function(){if(v(u)!==false){t(u);p(u)}}}function j(v,w){var u=d("> div[panel]",w.div);if(u.length>0){u.each(function(y,z){var x=v.addPanel(z.title,null,z.className,"menu-"+z.id);x.getCurrentPanel().body.append(u[y])})}else{var t=v.addPanel(w.title);t.getCurrentPanel().body.append(w.div)}}function f(v){var u=d(" > div",v);var t=[];u.each(function(x){var w=d(this);t[x]={title:w.attr("title")||null,className:w.attr("class"),div:w}});return t}})(jQuery)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/applinkwizard.js' */
(function(a){AppLinks.Wizard={getWizard:function(){return a("#create-application-link-container").data("wizard")},initAuthenticationUI:function(d){var h=a(d);var f=h.find(".create-reciprocal-link");var c=h.find(".ual-arrow");var l=h.find(".two-way-link-details");var j=h.find(".reciprocal-link-description");var b=h.find(".no-reciprocal-link-description");f.click(function(){if(f.is(":checked")){c.removeClass("no-background");l.show();j.show();b.hide()}else{c.addClass("no-background");l.hide();j.hide();b.show()}});var i=h.find(".same-user-radio-btn");var k=h.find(".different-user-radio-btn");var e=h.find(".different-userbase-image");var g=h.find(".same-userbase-image");i.click(function(){e.addClass("different-userbase-image-grey");g.removeClass("same-userbase-image-grey")});k.click(function(){g.addClass("same-userbase-image-grey");e.removeClass("different-userbase-image-grey")})},initNonUALUI:function(e){var c=a(e);var b=c.find(".application-types");for(var d=0;d<nonAppLinksApplicationTypes.length;d++){a('<option value="'+nonAppLinksApplicationTypes[d].typeId+'">'+nonAppLinksApplicationTypes[d].label+"</option>").appendTo(b)}},fetchManifest:function(e,h,d,b){var i=h.find("#application-url");if(i.val()==""){var c=h.find("#application-types");if(c.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(i);return false}var g=function(j){e.enableSubmitBtn();e.enablePreviousBtn();e.cancel();AppLinks.UI.listApplicationLinks(j.applicationLink.id,"new",j)};AppLinks.SPI.createStaticUrlAppLink(c.val(),g,null);return true}var f=AppLinks.UI.addProtocolToURL(i.val());AppLinks.UI.showLoadingIcon(i);var g=function(l){var k=l;e.enableNextBtn();h.find(".loading").remove();h.find(".reciprocal-rpc-url").val(a("#baseUrl").val());if(typeof l.typeId!="undefined"){AppLinks.Wizard.handleUALManifest(k,h);e.dialog.gotoPage(2);h.find(".reciprocal-link-username").focus();if(d){d(k)}}else{if(l.code=="applinks.warning.redirected.host"&&!i.data("hasWarnedAboutRedirection")){AppLinks.UI.displayValidationErrorMessages("manifest-validation-errors",h,l.warning);i.data("hasWarnedAboutRedirection","true");var m=function(){a(i).removeData("hasWarnedAboutRedirection");a(i).unbind("change",m)};i.bind("change",m)}else{if(l.code=="applinks.warning.unknown.host"&&!i.data("forceWhenHostIsOffline")){AppLinks.UI.displayValidationErrorMessages("manifest-validation-errors",h,l.warning);i.data("forceWhenHostIsOffline","true");var j=function(){a(i).removeData("forceWhenHostIsOffline");a(i).unbind("change",j)};i.bind("change",j)}else{if(k.code=="applinks.warning.unknown.host"||k.code=="applinks.warning.redirected.host"){delete k.warning;delete k.code}AppLinks.Wizard.handleNonUALManifest(k,f,h);e.dialog.gotoPage(1);h.find(".application-name").focus();if(b){b(k)}}}}};e.disableNextBtn();AppLinks.SPI.tryToFetchManifest(f,g,AppLinks.UI.displayValidationError("manifest-validation-errors",h,function(){e.enableNextBtn()}));return f},handleUALManifest:function(f,e){var c=a(e);c.find(".remote-app-image").removeClass(function(j,l){var k=l.split(" ");var i="";a.each(k,function(m,n){if(n.indexOf("application-type-image-")!=-1){i=n}});return i});c.find(".remote-app-image").addClass("application-type-image-"+f.typeId);c.find(".link-to-app-type").html(AppLinks.I18n.getText("applinks.create.title.link.to",AppLinks.I18n.getApplicationTypeName(f.typeId)));c.find(".remote-app-name").text(AppLinks.UI.shortenString(f.name,20));c.find(".create-reciprocal-link").attr("checked",true);c.find("#reciprocal-link-back-to-server").html(AppLinks.I18n.getText("applinks.create.link.back.to.server",AJS.escapeHtml(f.name)));var d=["administrator",AJS.escapeHtml(f.name),'<a target="_blank" href="'+AppLinks.Docs.getDocHref("applinks.docs.adding.application.link")+'">',"</a>"];var h=f.applinksVersion.split(".");var b=parseInt(h[0]);var g=parseInt(h[1]);if((f.typeId=="jira"||f.typeId=="confluence")&&(b==3&&g<10)){d[0]="system administrator"}c.find(".reciprocal-link-description").html(AppLinks.I18n.getText("applinks.create.two.way.link",d));c.find(".no-reciprocal-link-description").hide();c.find(".no-reciprocal-link-description").html(AppLinks.I18n.getText("applinks.create.two.way.no.link",AJS.escapeHtml(f.name)));c.find(".reciprocal-link-username").val("");c.find(".reciprocal-link-password").val("");c.find(".ual-arrow").removeClass("no-background");c.find(".two-way-link-details").show();c.find(".reciprocal-link-description").show();c.find(".no-reciprocal-link-description").hide()},handleNonUALManifest:function(d,e,c){var b=a(c);b.find(".application-name").val("");b.find(".application-types option:first-child").attr("selected","selected");b.find(".non-ual-application-url").text(e);if(d.warning){b.find(".create-non-ual-warning").show();b.find(".create-non-ual-warning").html(d.warning)}else{b.find(".create-non-ual-warning").hide()}},checkReciprocalLinkFormThreeStepMode:function(c,d,g,j,f){var h=a(c);if(h.find(".create-reciprocal-link").is(":checked")){var k=a.trim(h.find(".reciprocal-rpc-url").val());if(k==""){a("<div class='error applinks-error'>"+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(h.find(".reciprocal-rpc-url"));if(f){f()}return}var e=h.find(".reciprocal-link-username");var b=h.find(".reciprocal-link-password");if(e.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.username.empty")+"</div>").insertAfter(e);if(f){f()}return false}var i=function(l){h.find(".same-user-description").find("input").attr("checked",true);h.find(".trust-radio-btn").attr("checked",true);h.find(".same-user-radio-btn").click();g(l)};k=AppLinks.UI.addProtocolToURL(k);AppLinks.SPI.verifyTwoWayLinkDetails(j,k,e.val(),b.val(),i,AppLinks.UI.displayValidationError("two-way-link-errors",c,f));return false}else{d();return false}},checkReciprocalLinkFormTwoStepMode:function(f,h,b,i){var c=a(f);var g=a.trim(c.find(".reciprocal-rpc-url").val());if(g==""){a("<div class='error applinks-error'>"+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(c.find(".reciprocal-rpc-url"));if(i){i()}return}var d=c.find(".reciprocal-link-username");var e=c.find(".reciprocal-link-password");if(d.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.username.empty")+"</div>").insertAfter(d);if(i){i()}return false}g=AppLinks.UI.addProtocolToURL(g);AppLinks.SPI.verifyTwoWayLinkDetails(h,g,d.val(),e.val(),b,AppLinks.UI.displayValidationError("two-way-link-errors",f,i));return false}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-oauth-ui', location = 'js/oauth-dialog.js' */
AJS.$(document).bind(AppLinks.Event.READY,function(){(function(a){AppLinks.OAuthCallback=function(){};AppLinks.OAuthCallback.prototype.success=function(){this.aouthWindow.close();this.onSuccess()};AppLinks.OAuthCallback.prototype.failure=function(){this.aouthWindow.close();this.onFailure()};AppLinks.OAuthCallback.prototype.show=function(b,d,c){this.onSuccess=d;this.onFailure=c;this.aouthWindow=window.open(b,"com_atlassian_applinks_authentication")};oauthCallback=new AppLinks.OAuthCallback();AppLinks.authenticateRemoteCredentials=function(b,d,c){a(".applinks-error").remove();oauthCallback.show(b,d,c)}})(AJS.$)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/soy/confluence-jira-content-templates.soy' */
// This file was automatically generated from confluence-jira-content-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.CreateJiraContent == 'undefined') { Confluence.CreateJiraContent = {}; }


Confluence.CreateJiraContent.createIssueDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="jira-content-create-issue-form" class="aui"><div class="dialog-header"><div class="title left-position"><h2 id="create-issues-dialog-header">', soy.$$escapeHtml("Create Issue"), '</h2></div><div class="servers"><select class="select hidden" id="jira-servers" /></div><br class="clear" /></div><span id="create-issue-loading"><span class="aui-icon aui-icon-wait"></span> ', soy.$$escapeHtml("Loading\u2026"), '</span><div class="dialog-content hidden"><div class="main-field"><select class="select stretch-out" id="jira-projects" name="pid" title="database select" /><span id="projectSpinner" class="project-spinner"></span></div><div class="main-field"><select class="select" id="jira-issue-types" name="issuetype"><option value=\'-1\'>', soy.$$escapeHtml("select"), '</option></select></div><div id="issue-content"><div id="create-from-text"><div class="main-field"><input id="issue-summary" class="text" value="', soy.$$escapeHtml(opt_data.summary), '" placeholder="', soy.$$escapeHtml("Enter issue summary (required)"), '" maxlength="255" /></div><div class="main-field"><textarea class="textarea" name="comment" id="issue-description" placeholder="', soy.$$escapeHtml("Enter description"), '">', (opt_data.isCutLongText) ? soy.$$escapeHtml(opt_data.comment) : '', '</textarea></div></div><div id="create-from-table"></div></div><div id="jira-epic-content"></div><div id="create-issue-form-messages" class="hidden"></div></div><div id="prepare-issue-messages" class="issue-messages hidden"></div><div class="buttons-group hidden"><input class="aui-button submit create-issue-submit" type="submit" value="', soy.$$escapeHtml("Create"), '" /><a class="create-issue-cancel" href="#">', soy.$$escapeHtml("Cancel"), '</a><span id="form-spinner"></span><span id="form-message-spinner"></span><span id="form-message"></span></div><div id="jiraserver-issue-messages" class="issue-messages"></div><div id="create-issue-messages"></div><div id="text-suggestion" class="text-suggestion hidden"></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.renderRequiredFieldWarningMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(soy.$$escapeHtml(AJS.format("The project and issue type you selected has required fields: {0}. You will need to ",opt_data.requiredFields)), '<a href="', soy.$$escapeHtml(opt_data.projectLinkUrl), '" id="create-issue-in-jira-link" target="_blank">', soy.$$escapeHtml("create your issue directly in JIRA"), '</a>.');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.renderEpicContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="epic-link" class="main-field checkbox"><input class="checkbox" type="checkbox" id="epicCheck" checked="checked" name="epickCheck" value="', soy.$$escapeHtml(opt_data.epicKey), '"/><label for="epicCheck">', soy.$$escapeHtml("Link to epic"), ' </label>', opt_data.epicHtmlPlaceHolder, '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.createPreviewIssuesFromTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="main-field issue-preview"><div class="preview-message" > ', soy.$$escapeHtml("Following issues will be created:"), ' </div>');
  var issueList44 = opt_data.issues;
  var issueListLen44 = issueList44.length;
  if (issueListLen44 > 0) {
    for (var issueIndex44 = 0; issueIndex44 < issueListLen44; issueIndex44++) {
      var issueData44 = issueList44[issueIndex44];
      Confluence.CreateJiraContent.issuePreviewTemplate({summary: issueData44.summary}, output);
    }
  } else {
    output.append(soy.$$escapeHtml("Issue not found."));
  }
  output.append((opt_data.numberOfRemainingIssues > 0) ? '<div id="issue-remaining">' + ((opt_data.numberOfRemainingIssues == 1) ? soy.$$escapeHtml("+ 1 more issue.") : '') + ((opt_data.numberOfRemainingIssues > 1) ? soy.$$escapeHtml(AJS.format("+ {0} more issues.",opt_data.numberOfRemainingIssues)) : '') + '</div>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.issueFromTextSuggestedLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.numberOfIssues) ? '<span class="aui-icon aui-icon-info"/>' + soy.$$escapeHtml("Looks like you are creating issues from a table.") + '<br/><a id="text-suggested-link" href="#">' + soy.$$escapeHtml(AJS.format("Create {0} issues from this table.",opt_data.numberOfIssues)) + '</a>' : '');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.issueFromTableSuggestedLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="aui-icon aui-icon-info"/><a id="table-suggested-link" href="#">', soy.$$escapeHtml("Create a single issue"), '</a> ', soy.$$escapeHtml("from the highlighted text."));
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.issuePreviewTemplate = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="issue-container"><img class="icon ico-left"><div class="issue-content"><span class="issue-summary">', soy.$$escapeHtml(opt_data.summary), '</span></div><div class="text-right"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.createOptionForSelectBox = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="', soy.$$escapeHtml(opt_data.value), '">', soy.$$escapeHtml(opt_data.text), '</option>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.displayMessages = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p><ul>');
  var messageList86 = opt_data.messages;
  var messageListLen86 = messageList86.length;
  for (var messageIndex86 = 0; messageIndex86 < messageListLen86; messageIndex86++) {
    var messageData86 = messageList86[messageIndex86];
    output.append('<li>', soy.$$escapeHtml(messageData86), ' </li>');
  }
  output.append('</ul></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.issueMacroXml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name=\'jira\'><ac:parameter ac:name=\'showSummary\'>', soy.$$escapeHtml(opt_data.showSummary), '</ac:parameter><ac:parameter ac:name=\'server\'>', soy.$$escapeHtml(opt_data.serverName), '</ac:parameter><ac:parameter ac:name=\'serverId\'>', soy.$$escapeHtml(opt_data.serverId), '</ac:parameter><ac:parameter ac:name=\'key\'>', soy.$$escapeHtml(opt_data.issueKey), '</ac:parameter>"</ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.createIssueMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.canInsertMacro == true) ? soy.$$escapeHtml(AJS.format("The issue {0} is created and its link is inserted in the page. To see the result, ",opt_data.issueKey)) + ' <a href="' + soy.$$escapeHtml(opt_data.currentUrl) + '">' + soy.$$escapeHtml("reload ") + '</a> ' + soy.$$escapeHtml("this page.") : soy.$$escapeHtml(AJS.format("The issue {0} is created but not be able to insert to the page. You can edit the page to insert the issue later.",opt_data.issueKey)));
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.createdIssuesMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var createdIssueMessagesContent__soy115 = new soy.StringBuilder();
  Confluence.CreateJiraContent.displayMessages({messages: opt_data.createdIssueMessages}, createdIssueMessagesContent__soy115);
  createdIssueMessagesContent__soy115 = createdIssueMessagesContent__soy115.toString();
  output.append(createdIssueMessagesContent__soy115, (opt_data.canInsertMacro == true) ? soy.$$escapeHtml("The issues are created and theirs links are inserted in the page. To see the result, ") + ' <a href="' + soy.$$escapeHtml(opt_data.currentUrl) + '">' + soy.$$escapeHtml("reload ") + '</a> ' + soy.$$escapeHtml("this page.") : soy.$$escapeHtml("The issues are created but not be able to insert to the page. You can edit the page to insert the issues later."));
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.selectOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span title="', soy.$$escapeHtml(opt_data.optionValue), '">', soy.$$escapeHtml(opt_data.optionValue), '</span>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.updatePageFromTableError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var createdIssueMessagesContent__soy138 = new soy.StringBuilder();
  Confluence.CreateJiraContent.displayMessages({messages: opt_data.createdIssueMessages}, createdIssueMessagesContent__soy138);
  createdIssueMessagesContent__soy138 = createdIssueMessagesContent__soy138.toString();
  output.append(createdIssueMessagesContent__soy138, soy.$$escapeHtml("The issues are created but not be able to insert to the page. You can edit the page to insert the issues later."));
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.getOAuthMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="oauth-link-text-message">', soy.$$escapeHtml("Atlassian JIRA needs your permission to connect to "), ' ', soy.$$escapeHtml(opt_data.confluenceApplicationName), '.</div><button class="oauth-init aui-button">', soy.$$escapeHtml("Allow access"), '</button>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.selectOptionWithImage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.imageUrl) ? '<img src="' + soy.$$escapeHtml(opt_data.imageUrl) + '" class="select-option-image" />' : '', '<span class="select-option" title="', soy.$$escapeHtml(opt_data.optionValue), '">', soy.$$escapeHtml(opt_data.optionValue), '</span>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.selectOptionProject = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.imageUrl) {
    aui.avatar.avatar({avatarImageUrl: opt_data.imageUrl, isProject: true, size: 'xsmall', tagName: 'span'}, output);
  }
  output.append('<span class="select-option" title="', soy.$$escapeHtml(opt_data.optionValue), '">', soy.$$escapeHtml(opt_data.optionValue), '</span>');
  return opt_sb ? '' : output.toString();
};


Confluence.CreateJiraContent.summaryStoredValue = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="summary-stored-value"><span class="info">');
  aui.avatar.avatar({avatarImageUrl: opt_data.storedValue.projectIcon, isProject: true, size: 'xsmall', tagName: 'span'}, output);
  output.append('<span class="ellipsis project-name" title="', soy.$$escapeHtml(opt_data.storedValue.projectText), '">', soy.$$escapeHtml(opt_data.storedValue.projectText), '</span> <img class="aui-avatar-xsmall" src="', soy.$$escapeHtml(opt_data.storedValue.issueTypeIcon), '" /><span class="ellipsis issue-type" title="', soy.$$escapeHtml(opt_data.storedValue.issueTypeText), '">', soy.$$escapeHtml(opt_data.storedValue.issueTypeText), '</span></span><a href="#" title="', soy.$$escapeHtml("Edit"), '">', soy.$$escapeHtml("Edit"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/create-issue-analytics.js' */
Confluence.CreateJiraContent.Analytics=(function(k){var y="confluence.jira.content.dialog.open";var s="confluence.jira.content.create.text";var d="confluence.jira.content.create.table";var v="confluence.jira.content.error";var a="confluence.jira.content.jim.insert.fail";var t="confluence.jira.content.switch.to.table";var q="confluence.jira.content.switch.to.text";var w="confluence.jira.content.edit.description";var m="confluence.jira.content.summary.truncated";var n="confluence.jira.content.with.epic";var l="confluence.jira.content.required.fields";var g="confluence.jira.content.create.directly.in.jira";var o="confluence.jira.content.sorted.table";var z="table";function e(B,C){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:B,properties:C})}function c(){e(y)}function b(B){e(((B===z)?t:q))}function i(D,C){if(D===z){var B={total:C};e(d,B)}else{e(s)}}function r(){e(w)}function A(){e(n)}function j(C){var B={total:C};e(m,B)}function p(C,D){var B={type:C,reason:D};e(a,B)}function u(){e(o)}function x(C){var B={cause:C};e(v,B)}function f(){e(l)}function h(){k("#create-issue-in-jira-link").click(function(B){e(g)})}return{sendAnalyticsForDialogOpen:c,sendAnalyticsForModeChange:b,sendAnalyticsForCreatingIssue:i,sendAnalyticsForDescriptionEdited:r,sendAnalyticsForCreatedIssueWithEpic:A,sendAnalyticsForTruncatedSummary:j,sendAnalyticsForJIMInsertFailed:p,sendAnalyticsForSortedTable:u,bindAnalyticsForCreateDirectlyInJira:h,sendAnalyticsForCreateError:x,sendAnalyticsForRequiredFields:f}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/page-helper.js' */
AJS.toInit(function(f){var e="com.atlassian.confluence.plugins.confluence-jira-content:create-JIRA-issue-summary";var l=f("div.jira-issues-created");if(l.length>0){if(window.history&&window.history.replaceState){var i=window.location.href;var j=i.substr(0,i.indexOf("JIRAIssuesCreated")-1);window.history.replaceState({},document.title,j)}var d=l.find("#jira-content-message-panel-error-warning");var h=l.find("#jira-content-message-panel-view-more-link");h.click(function(m){m.preventDefault();h.hide();d.show()});if(l.hasClass("success")){setTimeout(function(){l.hide()},10000)}}var g;var c;var b=function(m){if(g){g.remove()}g=Confluence.CreateJiraContent.InlineDialog.openCreateIssueDialog(m);g.show();Confluence.CreateJiraContent.displayDialog=g;Confluence.CreateJiraContent.Analytics.sendAnalyticsForDialogOpen()};var a=function(m){if(c){c.remove()}c=Confluence.CreateJiraContent.InlineDialog.openFeatureDiscoveryDialog(m,b);c.show()};var k=function(m){if(Confluence.CreateJiraContent.FeatureDiscoveryDialog.shouldShowFeatureDiscovery()){a(m)}else{b(m)}};Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler(e,{onClick:k,shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/jira-inline-dialog.js' */
Confluence.CreateJiraContent.InlineDialog=(function(c){var i=360;var d=500;var g=370;var a=c("<div>").attr("id","jira-content-dialog-target");var e=function(j){var k=j.area;Confluence.DocThemeUtils.appendAbsolutePositionedElement(a);a.css({top:k.average.top,height:k.average.height,left:k.average.left,width:k.average.width})};var b={hideDelay:null,maxHeight:d};var f=function(k){e(k);var j=Confluence.ScrollingInlineDialog(a,"create-issue-dialog",function(m,l,n){Confluence.CreateJiraContent.Form.addFormContent(m,k);Confluence.CreateJiraContent.Form.setDialogObject(j);n();return false},c.extend({},b,{preHideCallback:function(){return(c("#formSpinner.aui-icon.aui-icon-wait").length==0)&&(!c("#select2-drop-mask").is(":visible"))},width:i,hideCallback:function(){a.remove();Confluence.CreateJiraContent.FormHelper.bindHideEventToDialog()}}));return j};var h=function(k,l){e(k);var j=Confluence.ScrollingInlineDialog(a,"create-issue-feature-discovery-dialog",function(n,m,o){Confluence.CreateJiraContent.FeatureDiscoveryDialog.addFeatureDiscoveryContent(n,k,l);Confluence.CreateJiraContent.FeatureDiscoveryDialog.setFeatureDialogObject(j);o();return false},c.extend({},b,{width:g,hideCallback:function(){if(Confluence.CreateJiraContent.FeatureDiscoveryDialog.shouldShowFeatureDiscovery()){a.remove()}}}));return j};return{openCreateIssueDialog:f,openFeatureDiscoveryDialog:h}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/create-issue-form.js' */
Confluence.CreateJiraContent.Form=(function(e){var F="table";var D="text";var h=3;var H;var q;var n;var d;var v;var s;var r;var t=function(I){if(I!==undefined){r=I}else{return r}};var l=function(K){var I=H.find("#jira-servers option:selected").val();var J=H.find("#jira-projects option:selected").val();var L=[];q.find("> tbody > tr").each(function(M,N){e(N).find("td:eq("+K+")").each(function(S,O){var R=e.trim(e(O).text());if(R.length){var Q=Confluence.CreateJiraContent.FormTextHelper.removeLineBreaksAndTruncate(R);var P=Confluence.CreateJiraContent.FormTextHelper.isCutLongText(R);var T=(P==true)?R:"";L.push({summary:Q,description:T})}})});return L};var j=function(){var I=H.find("#text-suggestion");if(n!=null&&n.length>1){var J=Confluence.CreateJiraContent.issueFromTextSuggestedLink({numberOfIssues:n.length});I.html(J)}else{I.hide()}};var x=function(){if(s===F){var J=H.find("#create-from-table");J.empty();if(H.find("#jira-projects option:selected").val()!=-1){n=l(d);var L=0;var K=e(n);if(K.length>h){K=K.slice(0,h);L=n.length-h}var I=Confluence.CreateJiraContent.createPreviewIssuesFromTable({issues:K,numberOfRemainingIssues:L});J.html(I)}var M=H.find("#jira-issue-types option:selected").val();if(M!=-1){Confluence.CreateJiraContent.FormHelper.changeIssuesTypeIconForPreviewPanel(H.find("#jira-issue-types option:selected").val())}Confluence.CreateJiraContent.displayDialog.refresh()}};var a=function(){x(d);var I=H.find("#text-suggestion");var J=Confluence.CreateJiraContent.issueFromTableSuggestedLink();I.html(J)};var w=function(I){Confluence.CreateJiraContent.FormHelper.removeDisplayMessages();C(I);if(I==D){e("#create-issues-dialog-header").text("Create Issue");j();H.find("#create-from-table").hide();H.find("#create-from-text").show()}else{if(s===F){e("#create-issues-dialog-header").text("Create Issues");a();H.find("#create-from-text").hide();H.find("#create-from-table").show()}}AJS.trigger("confluence-jira-content.form-updated")};var u=function(){H.on("click","#text-suggested-link, #table-suggested-link",function(K){var J=e(this);var L=(J.attr("id")==="text-suggested-link");var I=(L)?F:D;w(I);K.preventDefault();return false})};var E=function(){var L=[];var J=H.find("#issue-summary");var I=H.find("#issue-description");var K={summary:e.trim(J.val()),description:e.trim(I.val())};L.push(K);return L};var z=function(){if(Confluence.CreateJiraContent.FormHelper.validateCreateIssueForm()){var I=E();Confluence.CreateJiraContent.FormHelper.createIssues(I,k)}};var p=function(I){var J=[];q.find("td:nth-child("+(I+1)+")").each(function(M,K){var L=e.trim(e(K).text());if(L.length>0){J.push(M)}});return J};var f=function(){if(Confluence.CreateJiraContent.FormHelper.validateCreateIssueForm()){var I=p(d);Confluence.CreateJiraContent.FormHelper.createIssues(n,k,d,I)}};var y=function(){H.submit(function(){if(s===D){z()}else{f()}return false})};var g=function(){return D};var C=function(I){s=I};var B=function(){return q.find("> thead > tr > th.tablesorter-headerSortUp, > thead > tr > th.tablesorter-headerSortDown").length>0};var G=function(){if(B()){var I=atlassian.message.warning({content:"You are creating issues on the sorted table. These ones could not be appended to the page."});H.children("#prepare-issue-messages").html(I);Confluence.CreateJiraContent.Analytics.sendAnalyticsForSortedTable()}};var m=function(){q=e(t().containingElement).closest("table");if(q.length>0){return true}return false};var i=function(I){v=I};var b=function(J){var I=J.find(".create-issue-cancel");I.on("click",function(K){Confluence.CreateJiraContent.displayDialog.isCancelButtonClicked=true;Confluence.CreateJiraContent.displayDialog.hide();K.preventDefault()})};var c=function(){d=e(t().containingElement).closest("td").index();if(d==-1&&t().range.startContainer){var I=e(t().range.startContainer);d=I.closest("td").index()}if(d==-1){d=0}n=l(d)};var o=function(){var J=Confluence.CreateJiraContent.FormTextHelper.trunc(t().text);var K=Confluence.CreateJiraContent.FormTextHelper.isCutLongText(J);var I=Confluence.CreateJiraContent.createIssueDialog({summary:J,isCutLongText:K,comment:t().text});return I};var A=function(){return s===D};var k={addFormContent:function(K,J){t(J);var I=o();K.html(I);H=K.find("#jira-content-create-issue-form");C(g());n=null;if(m()){c()}if(n==null||n.length==1){K.find("#text-suggestion").remove()}else{u()}w(s);Confluence.CreateJiraContent.FormHelper.init(H);y();b(H);G()},setDialogObject:i,selectionObject:t,fillPreviewIssuesFromTable:x,isInSortedTable:B,isInTextMode:A};return k})(AJS.$);Confluence.CreateJiraContent.FormTextHelper=(function(){var a=255;var b="\u2026";return{trunc:function(c){return c.length<=a?c:c.substr(0,a-1)+b},isCutLongText:function(c){if(c.length>=a){return true}return false},removeLineBreaksAndTruncate:function(c){var d=c.replace(/\n|\r|\r\n/g," ");return this.trunc(d)}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/jira-form-helper.js' */
Confluence.CreateJiraContent.FormHelper=(function(aD){var aT="-1",aW="loading",j="select",F="Select project",aM="Select issue type",a="Loading\u2026",ad=Confluence.getContextPath()+"/rest/jiraanywhere/1.0",t="aui-bottom-arrow-color";var an=null;var ak=false;var w=["assignee","project","issuetype","summary","reporter"];var O;var r=10;var L=60*1000;var S;var Q;var aR;var aP;var aN=Confluence.storageManager("jira-content");var b;var am={};var g={};var G={};var A={};var z={};var au={};var e;var ag=function(aX){S={serverSelect:aX.find("#jira-servers"),projectSelect:aX.find("#jira-projects"),issueTypeSelect:aX.find("#jira-issue-types"),projectSpinner:aX.find("#projectSpinner")};Q=aX;aR="Story,New Feature".toLowerCase();aR=aR.split(",");H(S.issueTypeSelect);O=Confluence.CreateJiraContent.JiraIssue.FieldStatus.VISIBLE};var aw="savedFormValues";var aG=function(){if(aD.browser.msie){Q.find("input, textarea").keydown(function(aX){if(aX.keyCode==27){return false}})}};var aQ=function(aY,aZ){var aX=Confluence.CreateJiraContent.createOptionForSelectBox({value:aT,text:aZ?aZ:j});aY.html(aX);aY.auiSelect2("val",aT)};var V=function(){var aX=S.projectSelect;aX.auiSelect2("enable",false);var aY=Confluence.CreateJiraContent.createOptionForSelectBox({value:aT,text:a});aX.html(aY);aX.auiSelect2("val",a)};var D=function(){S.projectSelect.auiSelect2("enable",true)};var aH=function(aX){aQ(aX)};var ao=function(aZ){var aX=S.serverSelect;var aY=[];aD.each(aZ,function(a1,a2){A[a2.id]=a2;var a0=Confluence.CreateJiraContent.createOptionForSelectBox({value:a2.id,text:a2.name});aY.push(a0)});aX.append(aY.join(""));if(aZ.length==1){aX.hide()}else{u(S.serverSelect,{containerCssClass:"select-container",dropdownCssClass:"server-dropdown",width:"180px",minimumResultsForSearch:-1})}if(b){I(ab(aX,b.serverId))}else{I(false)}};var aB=function(){return aD.ajax({dataType:"json",url:AJS.Confluence.getBaseUrl()+"/rest/createjiracontent/1.0/get-jira-servers"}).done(function(aX){if(aX.length){ao(aX)}else{W("Don\'t have any JIRA server, please check the application link configuration.")}})};var J=function(aZ,a4){am[aZ]=a4.projects;var a2={};var a0=a4.projects;aD.each(a0,function(a5,a6){a2[a6.id]=a6});z[aZ]=a2;var a1={};var aX=a4.schemes;aD.each(aX,function(a6,a5){a1[a5.id]=a5});g[aZ]=a1;var aY={};var a3=a4.types;aD.each(a3,function(a6,a5){aY[a5.id]=a5});G[aZ]=aY};var K=function(aY){var aX=S.projectSelect;aQ(aX,F);var aZ=[];aD.each(aY,function(a1,a2){var a0=Confluence.CreateJiraContent.createOptionForSelectBox({value:a2.id,text:a2.name});aZ.push(a0)});aX.append(aZ.join(""))};var q=function(){var aZ=S.serverSelect.val();var aY=ap(A[aZ]);if(aY){var aX=function(){$serverSelect=S.serverSelect;if(b&&b.serverId==aZ){$projectSelect=S.projectSelect;var a0=ab($projectSelect,b.projectId);I(a0);if(a0){y();X()}}else{I(false);H(S.issueTypeSelect)}};if(aP&&aP.readyState!==4&&aP.abort){aP.abort()}if(am[aZ]){M(200);K(am[aZ]);aX();N(aZ);AJS.trigger("confluence-jira-content.form-updated");return aD.Deferred().resolve()}else{V();aP=AppLinks.makeRequest({appId:aZ,type:"GET",url:"/rest/api/1.0/admin/issuetypeschemes.json",dataType:"json",success:function(a0){J(aZ,a0);K(am[aZ]);D();M(200,a0);aX();N(aZ)},error:function(a0){M(a0.status);aH(S.projectSelect);D()}}).done(function(){AJS.trigger("confluence-jira-content.form-updated")});return aP}}};var ax=function(aX){var aY=S.projectSelect.prop("selectedIndex");if(aY!==0){return am[aX][aY-1].scheme}return null};var ar=function(aY){for(var aX=0;aX<aR.length;aX++){if(aR[aX]==aY.toLowerCase()){return true}}return false};var H=function(aX){aX.auiSelect2("enable",false);aQ(aX,aM);aX.prev().find("a").removeAttr("tabindex")};var aK=function(aX){aX.auiSelect2("enable",true);aX.prev().find("a").attr("tabindex","0")};var y=function(){var aX=S.projectSelect.val();var aY=S.issueTypeSelect;if(aX!=aT){aK(aY);aA(aY);if(b){I(ab(aY,b.issueTypeId))}else{I(false)}}else{H(aY)}aI(aY.val())};var aA=function(){var a6=true;var a0=S.issueTypeSelect;var a1=S.serverSelect.val();var aY=ax(a1);if(aY){var a3=g[a1];var aX=a3[aY];var a4=aX.types;var a5=G[a1];var a2=null;var aZ=[];aD(a4).each(function(a9,ba){var a7=a5[ba];if(a7){if(!a2){if(ar(a7.name)){a2=a7.id}}var a8=Confluence.CreateJiraContent.createOptionForSelectBox({value:a7.id,text:a7.name});aZ.push(a8);a6=false}});a0.html(aZ.join(""));a0.auiSelect2("val",a2)}if(a6){aQ(a0,aM)}};var R=function(aX){m(false);Q.find("#form-message-spinner").addClass("aui-icon aui-icon-wait");Q.find("#form-message").text(aX)};var n=function(){Q.find("#form-message-spinner").removeClass("aui-icon aui-icon-wait");Q.find("#form-message").empty()};var Y=function(aZ){var aX=Q.find("#create-issue-form-messages");var aY=Confluence.CreateJiraContent.renderRequiredFieldWarningMessage({requiredFields:aZ.join(", "),projectLinkUrl:i()});AJS.messages.warning(aX,{body:aY,closeable:false});Confluence.CreateJiraContent.Analytics.sendAnalyticsForRequiredFields();Confluence.CreateJiraContent.Analytics.bindAnalyticsForCreateDirectlyInJira();aX.removeClass("hidden");Confluence.CreateJiraContent.displayDialog.refresh()};var v=function(){Q.find("#create-issue-form-messages").empty().addClass("hidden");Q.find("#issue-content, #jira-epic-content").show();Confluence.CreateJiraContent.displayDialog.refresh()};var ah=function(aX,aY){aX.attr("placeholder",aY);if(aX.hasClass("placeholded")){aX.val(aY)}};var o=function(){var aX=Q.find("#issue-description");if(O===Confluence.CreateJiraContent.JiraIssue.FieldStatus.HIDDEN){aX.parent().hide()}else{if(O===Confluence.CreateJiraContent.JiraIssue.FieldStatus.REQUIRED){ah(aX,"Enter description (required)")}else{ah(aX,"Enter description")}aX.parent().show()}Confluence.CreateJiraContent.displayDialog.refresh()};var X=function(){v();if(S.projectSelect.val()!==aT){var aY=function(aZ,a0){O=aZ;if(a0.length){ak=true;Y(a0)}else{ak=false}n();AJS.trigger("confluence-jira-content.form-updated")};var aX=function(aZ){n()};R("Checking for required fields\u2026");Confluence.CreateJiraContent.JiraIssue.identifyCreateIssueFields(aj(),w,aY,aX)}};var ap=function(aY){var aX=Q.children().not(".dialog-header, #jiraserver-issue-messages");if(!aY.supportedVersion){aX.hide();W(AJS.format("The version of selected JIRA server is not supported. You may want to upgrade to the newer version or \u003ca href=\"{0}\" target=\"_blank\">create issue in JIRA\u003c\/a>.",aY.url))}else{aX.show()}if(Q.find("#text-suggestion").length){aD("#inline-dialog-create-issue-dialog > #arrow-create-issue-dialog").addClass(t)}if(Confluence.CreateJiraContent.displayDialog){Confluence.CreateJiraContent.displayDialog.refresh()}return aY.supportedVersion};var aF=function(){S.serverSelect.change(function(aY){aD("#jiraserver-issue-messages").empty();var aX=ap(A[aY.val]);if(aX){b=aa();q();if(!b){H(S.issueTypeSelect);aq(Q.find("#jira-issue-types option:selected").val())}S.projectSelect.change()}});S.projectSelect.change(function(aY){var aX=S.projectSelect.val();if(b&&aX!=b.projectId){b=false}y();Confluence.CreateJiraContent.Form.fillPreviewIssuesFromTable();aq(Q.find("#jira-issue-types option:selected").val());AJS.trigger("confluence-jira-content.form-updated");X()});S.issueTypeSelect.change(function(aX){aq(aX.val);aI(aX.val);AJS.trigger("confluence-jira-content.form-updated");X()});Q.on("keyup","#issue-summary",function(aX){AJS.trigger("confluence-jira-content.form-updated")});Q.on("keyup","#issue-description",function(aX){AJS.trigger("confluence-jira-content.form-updated")});if(!Confluence.CreateJiraContent.displayDialog){AJS.bind("confluence-jira-content.form-updated",function(){m(U());o()});AJS.bind("confluence-jira-content.form-switched",function(){o()})}aD("#jira-content-create-issue-form .dialog-content").on("click",".summary-stored-value a",function(){I(false);b=false;return false});aG()};var m=function(aX){if(aX){aD(".create-issue-submit").removeAttr("disabled")}else{aD(".create-issue-submit").attr("disabled","disabled")}};var U=function(){var aZ=s(Q.find("#jira-projects"),aT)&&s(Q.find("#jira-issue-types"),aT);aZ=aZ&&!ak;if(Confluence.CreateJiraContent.Form.isInTextMode()&&aZ){var aX=Q.find("#issue-summary");aZ=aZ&&!aX.hasClass("placeholded")&&s(aX,"");var aY=Q.find("#issue-description");if(O===Confluence.CreateJiraContent.JiraIssue.FieldStatus.REQUIRED){aZ=aZ&&!aY.hasClass("placeholded")&&s(aY,"")}}return aZ};var s=function(aX,aY){if(aD.trim(aX.val())===aY){return false}return true};var aq=function(aZ){if(aZ!=-1){var a0=h();var aY=a0.url+G[a0.id][aZ].url;var aX=Q.find(".issue-container img").attr("src",aY)}};var av=function(){aD("#create-issue-messages",Q).empty()};var aC=function(){aD("#form-spinner",Q).addClass("aui-icon aui-icon-wait");aD(".create-issue-cancel",Q).hide();aD("input,select,textarea,submit",Q).disable()};var aL=function(){aD("#form-spinner",Q).removeClass("aui-icon aui-icon-wait");aD(".create-issue-cancel",Q).show();aD("input,select,textarea,submit",Q).enable()};var ac=function(){return S.projectSelect.val()};var p=function(aY){var aX=ac();var a0=S.issueTypeSelect.val();var a1=0;var aZ=0;aD.each(aY,function(a3,a2){if(Confluence.CreateJiraContent.FormTextHelper.isCutLongText(a2.summary)){a1++}else{if(a2.description!=""){aZ++}}a2.projectId=aX;a2.issueTypeId=a0;if(O===Confluence.CreateJiraContent.JiraIssue.FieldStatus.REQUIRED&&a2.description.length==0){a2.description=a2.summary}if(O===Confluence.CreateJiraContent.JiraIssue.FieldStatus.HIDDEN){delete a2.description}});if(a1>0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForTruncatedSummary(a1)}if(aZ>0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForDescriptionEdited()}};var aU=function(aY,aX){var aZ=[];aD.each(aY,function(a1,a2){var a0=AJS.format("Can not create issue for row {0} with error: {1}",(aX[a1]+1),a2.error);aZ.push(a0)});return aZ};var at=function(){delete am[S.serverSelect.val()]};var M=function(aY,aZ){var aX=Q.children().not(".dialog-header, #jiraserver-issue-messages");if(aY==200&&aZ&&aZ.isEmpty){at();aX.addClass("hidden");W(AJS.format("You do not have permission to access any projects in {0}",AJS.escapeHtml(h().name)))}else{switch(aY){case 401:aX.addClass("hidden");var a0=h();if(a0&&a0.authUrl){ay(function(){at();aX.removeClass("hidden");aD("#jiraserver-issue-messages").empty();q()})}break;case 404:case 504:aX.addClass("hidden");W("Cannot connect to this JIRA server at this time.");break;default:aX.removeClass("hidden")}}Confluence.CreateJiraContent.displayDialog.refresh()};var aj=function(){return{serverId:S.serverSelect.val(),projectId:S.projectSelect.val(),issueTypeId:S.issueTypeSelect.val()}};var az=function(a3,a4,a2,a0){var a1=S.serverSelect.val();var aZ=S.projectSelect.val();var aX=S.issueTypeSelect.val();var aY=aD("#epic-link > .checkbox");if(aY.is(":checked")&&aY.is(":visible")){Confluence.CreateJiraContent.Analytics.sendAnalyticsForCreatedIssueWithEpic();Confluence.CreateJiraContent.JiraIssue.resolveEpicField(aj(),function(a7){var a6=aY.val();for(var a8=0;a8<a3.length;a8++){var a5=a3[a8];if(!a5.fields){a5.fields={}}a5.fields[a7]=a6}x(a3,a4,a2,a0)})}else{x(a3,a4,a2,a0)}};var x=function(a2,a3,a1,aY){p(a2);av();aC();var a0=S.serverSelect.val();var aZ=ad+"/jira-issue/create-jira-issues/"+a0;var aX=[];ae(aZ,a2,aX,a3,a1,aY)};var ae=function(a1,a2,aY,a4,a0,aZ){var a3="";var aX=(a2.length<r)?a2.length:r;aD.ajax({timeout:L,type:"POST",contentType:"application/json",url:a1,data:JSON.stringify(a2.slice(0,aX)),success:function(a5){aY=aY.concat(a5);if(a2.length<=r){if(a0!=undefined){aV(aY,a4,a0,aZ)}else{var a6=aY[0];if(!a6.error){ai(a6,a4)}else{Confluence.CreateJiraContent.Analytics.sendAnalyticsForCreateError("rest");Z([],false,[a6.error])}}}else{ae(a1,a2.slice(aX,a2.length),aY,a4,a0,aZ)}},error:function(a5){if(a5.status==400){a3=a5.responseText}else{a3="Unable to create JIRA issues, please check the application link configuration."}Confluence.CreateJiraContent.Analytics.sendAnalyticsForCreateError("xhr");Z([],false,[a3])}})};var ai=function(aX,aZ){if(aZ.isInSortedTable()&&aZ.selectionObject().searchText.numMatches!=1){Z([aX],false,[]);return}var aY=Confluence.HighlightAction.createInsertionBean([{xmlInsertion:E(aX)}],aZ.selectionObject().searchText);Confluence.CreateJiraContent.Analytics.sendAnalyticsForCreatingIssue("text");Confluence.HighlightAction.insertContentAtSelectionEnd(aY).done(function(a0){if(!a0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForJIMInsertFailed("text","algorithm")}Z([aX],a0,[])}).fail(function(a0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForJIMInsertFailed("text","server");Z([aX],false,[],a0.statusText)})};var E=function(aX){var aY=S.serverSelect.val();var a0=A[aY].name;var aZ=Confluence.CreateJiraContent.issueMacroXml({showSummary:false,serverName:a0,serverId:aY,issueKey:aX.key});return aZ};var af=function(aZ){if(aZ.formObject.isInSortedTable()){Z(aZ.createdIssues,false,aZ.errorMessages);return}var aY=[];aD.each(aZ.createdIssues,function(a0,a1){var a2={};a2.rowIndex=aZ.createdIssueRowIndexes[a0];a2.xmlInsertion=E(a1);aY.push(a2)});var aX=Confluence.HighlightAction.createTableInsertionBean(aY,aZ.tableColumnIndex,aZ.formObject.selectionObject().searchText);Confluence.CreateJiraContent.Analytics.sendAnalyticsForCreatingIssue("table",aZ.createdIssues.length);Confluence.HighlightAction.insertContentsInTableColumnCells(aX).done(function(a0){if(!a0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForJIMInsertFailed("table","algorithm")}Z(aZ.createdIssues,a0,aZ.errorMessages)}).fail(function(a0){Confluence.CreateJiraContent.Analytics.sendAnalyticsForJIMInsertFailed("table","server");Z(aZ.createdIssues,false,aZ.errorMessages,a0.statusText)})};var Z=function(a1,aZ,a5,a2){var aY=h().url;if(a1.length==1){aY+="/browse/"+a1[0].key}else{var a0="key in (";a0+=aD.map(a1,function(a6){return a6.key}).join(",");a0+=")";aY+="/issues/?jql="+encodeURIComponent(a0)}var a4=window.location.href.split("#")[0];var a3=a4.indexOf("JIRAIssuesCreated");if(a3>0){a4=a4.substring(0,a3-1)}var aX=a4+(a4.indexOf("?")>0?"&":"?")+"JIRAIssuesCreated=true&numOfIssues="+a1.length+"&issuesURL="+encodeURIComponent(aY)+"&addedToPage="+aZ;if(a1.length>0){aX+="&issueId="+encodeURIComponent(a1[0].key)}if(a2!=undefined){aX+="&statusText="+a2}aD.each(a5,function(a6,a7){aX+="&errorMessages="+a7});aD("#form-spinner").removeClass("aui-icon aui-icon-wait");Confluence.CreateJiraContent.displayDialog.hide();window.location.replace(aX)};var aV=function(a0,a3,a1,a4){var aY=[],a5=[];var aX=[],aZ=[];aD.each(a0,function(a7,a6){if(!a6.error){aX.push(a6);aZ.push(a4[a7])}else{aY.push(a6);a5.push(a4[a7])}});var a2=aU(aY,a5);if(aX.length){af({createdIssues:aX,createdIssueRowIndexes:aZ,tableColumnIndex:a1,formObject:a3,errorMessages:a2})}else{if(aY.length){Z([],false,a2)}}};var k=function(aX){return Confluence.CreateJiraContent.selectOption({optionValue:aX.text})};var f=function(aY){var a0;if(aY.id>=0){var a1=h();var aZ=G[a1.id];var aX=aZ[aY.id];a0=aX.url;if(a0.indexOf("http")!=0){a0=a1.url+a0}}return Confluence.CreateJiraContent.selectOptionWithImage({optionValue:aY.text,imageUrl:a0})};var P=function(aX){var aZ;if(aX.id>=0){var aY=aX.id;var a2=h();var a0=z[a2.id];var a1=a0[aY].img;aZ="/secure/projectavatar?pid="+aY+"&avatarId="+a1+"&size=small";aZ=Confluence.getContextPath()+"/plugins/servlet/applinks/proxy?path="+encodeURIComponent(aZ)+"&appId="+a2.id}return Confluence.CreateJiraContent.selectOptionProject({optionValue:aX.text,imageUrl:aZ})};function u(aY,aZ){var aX={escapeMarkup:function(a0){return a0},formatResult:k,formatSelection:k};aY.auiSelect2(aD.extend(aX,aZ))}var h=function(){var aX=S.serverSelect.val();var aY=A[aX];return aY};var aE=function(){var aX=z[S.serverSelect.val()];return aX[S.projectSelect.val()]};var B=function(aX){if(aX.hasClass("placeholded")){return""}return aD.trim(aX.val())};var i=function(){var aZ=h().url+"/secure/CreateIssueDetails!Init.jspa?pid="+aE().id+"&issuetype="+S.issueTypeSelect.val();var aY=B(Q.find("#issue-summary"));if(aY.length){aZ=aZ+"&summary="+encodeURIComponent(aY)}if(O!==Confluence.CreateJiraContent.JiraIssue.FieldStatus.HIDDEN){var aX=B(Q.find("#issue-description"));if(aX.length){aZ=aZ+"&description="+encodeURIComponent(aX)}}return aZ};var W=function(aX){AJS.messages.warning(aD("#jiraserver-issue-messages"),{body:aX,closeable:false});if(!Q.find("#text-suggestion").is(":visible")){aD("#inline-dialog-create-issue-dialog > #arrow-create-issue-dialog").removeClass(t)}};var ay=function(aX){var aZ=h();var aY={onSuccess:function(){aZ.authUrl=null;aX()},onFailure:function(){}};W(Confluence.CreateJiraContent.getOAuthMessage({confluenceApplicationName:"Confluence"}));AJS.$(".oauth-init",aD("#jiraserver-issue-messages")).click(function(a0){AppLinks.authenticateRemoteCredentials(aZ.authUrl,aY.onSuccess,aY.onFailure);a0.preventDefault()})};var T=function(){S.serverSelect.auiSelect2("close");S.projectSelect.auiSelect2("close");S.issueTypeSelect.auiSelect2("close");if(Confluence.CreateJiraContent.displayDialog.isCancelButtonClicked!==true){aO({serverId:S.serverSelect.val(),projectId:S.projectSelect.val(),issueTypeId:S.issueTypeSelect.val()})}};var aO=function(aX){aN.setItem(aw,JSON.stringify(aX))};var aa=function(aY){try{aY=aY||aw;var aX=JSON.parse(aN.getItem(aY));if(aX&&aX.serverId&&aX.projectId&&aX.issueTypeId){return aX}else{return false}}catch(aZ){return false}};var I=function(a3){var a2=Q.find(".dialog-content > .main-field"),aY=Q.find(".dialog-content .summary-stored-value");if(a3){var a1=S.projectSelect.val();var aX=S.issueTypeSelect.val();if(a1!=-1&&a1!=null&&aX!=-1&&aX!=-1){var a0=C();if(a0){aY.remove();var aZ=Confluence.CreateJiraContent.summaryStoredValue({storedValue:a0});aD(aZ).insertBefore(Q.find("#issue-content"));a2.hide()}}}else{a2.show();aY.hide()}if(Confluence.CreateJiraContent.displayDialog){Confluence.CreateJiraContent.displayDialog.refresh()}};var C=function(){var a0=S.projectSelect,aX=S.issueTypeSelect;var a1=a0.auiSelect2("data").text,aZ=aX.auiSelect2("data").text;var a2=a0.auiSelect2("container").find(".select2-chosen img"),aY=aX.auiSelect2("container").find(".select2-chosen img");if(a1&&aZ&&a2&&aY){return{projectText:a1,issueTypeText:aZ,projectIcon:a2.attr("src"),issueTypeIcon:aY.attr("src")}}else{return null}};var al=function(aX,aY){return(aX.find('option[value="'+aY+'"]').length)};var ab=function(aX,aY){if(al(aX,aY)){aX.auiSelect2("val",aY);return true}else{b=false;return false}};var N=function(aX){var aZ=function(a0){an=a0;aJ(aX)};var aY=function(){if(aX==h().id){an=null;aD("#jira-epic-content").hide()}};Confluence.CreateJiraContent.JiraIssue.resolveEpicIssueType(aX,aZ,aY)};var aJ=function(aX){var aY=aD("#jira-epic-content");if(au[aX]!=null){aY.html(au[aX]);c(aY);return}aD.ajax({type:"GET",contentType:"application/json",url:AJS.Confluence.getBaseUrl()+"/rest/createjiracontent/1.0/find-epic-issue",data:{pageId:AJS.params.pageId,serverId:aX,epicIssueTypeId:an},success:function(a0){if(!a0.epicKey){aY.empty();au[aX]="";return}var a1=Confluence.CreateJiraContent.renderEpicContent({epicKey:a0.epicKey,epicHtmlPlaceHolder:a0.epicHtmlPlaceHolder});aY.html(a1);e=aY.find(".summary").text();var aZ=aY.find("a:first-child").clone();aY.find(".jira-issue").html(aZ);au[aX]=aY.html();c(aY);Confluence.CreateJiraContent.displayDialog.refresh()},error:function(aZ){aY.empty();AJS.logError("confluence-jira-content:epicLinkJiraIssuePageHandling - Error when detect epic on page with status="+aZ.status)}})};var c=function(aX){aX.find(".jira-issue").attr("title",e).tooltip({gravity:"sw"})};var aI=function(aX){if(aX==an){aD("#jira-epic-content").hide()}else{aD("#jira-epic-content").show()}};var d=function(){Q.find("#create-issue-loading").remove()};var aS=function(){d();var aX=S.serverSelect.val();if(aX){q();Q.find("#jira-servers, .dialog-content, #prepare-issue-messages, .buttons-group, #text-suggestion").removeClass("hidden")}};var l=function(){d();W("Unable to get a list of linked JIRA servers from Confluence. You may want to check your application links for more details.")};return{init:function(aX){ag(aX);u(S.projectSelect,{containerCssClass:"select-container select-project-container",dropdownCssClass:"projects-dropdown",width:"360px",formatSelection:P,formatResult:P});u(S.issueTypeSelect,{containerCssClass:"select-container select-issuetype-container",dropdownCssClass:"issue-types-dropdown",width:"360px",minimumResultsForSearch:-1,formatSelection:f,formatResult:f});m(false);H(S.issueTypeSelect);b=aa(aw);aF();I(b!==false);aB().pipe(aS,l)},createIssues:az,validateCreateIssueForm:U,removeDisplayMessages:av,createSelect2WithTooltip:u,bindHideEventToDialog:T,changeIssuesTypeIconForPreviewPanel:aq,loadFormValues:aa,BOTTOM_ARROW_CLASS:t}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/jiraissue-field-helper.js' */
Confluence.CreateJiraContent.JiraIssue=(function(e){var m="/rest/api/2/issue/createmeta";var a="com.pyxis.greenhopper.jira:gh-epic-link";var n="/rest/greenhopper/1.0/api/epicproperties";var c="CREATE_JIRA_ISSUE_";var h="JIRA_EPIC_ISSUE_TYPE_";var k="CREATE_JIRA_ISSUE_FIELD_";var b;var g=function(p,o,q){if(b&&b.readyState!==4&&b.abort){b.abort()}if(!p.serverId||!p.projectId||!p.issueTypeId){AJS.logError(AJS.format("confluence-jira-content:discoverIssueTypeField - Error with parameters: serverId={0}, projectId={1}, issueTypeId={2}",p.serverId,p.projectId,p.issueTypeId));q&&q("Discover fields - error with parameters.");return}b=AppLinks.makeRequest({appId:p.serverId,type:"GET",url:m,data:{expand:"projects.issuetypes.fields",projectIds:p.projectId,issuetypeIds:p.issueTypeId},dataType:"json",success:function(s){if(!s||!s.projects||!s.projects[0].issuetypes){AJS.logError("confluence-jira-content:discoverIssueTypeField - Data discovering error! Unexpected data return.");q&&q("Discover fields - unexpected data return.");return}var r=s.projects[0].issuetypes[0].fields;o(r)},error:function(r){AJS.logError("confluence-jira-content:discoverIssueTypeField - Error with status="+r.status);q&&q(AJS.format("Discover fields - response error: {0}.",r.status))}})};var f=function(o,r,q){if(!o){AJS.logError(AJS.format("confluence-jira-content:resolveEpicIssueType - Error with parameters: serverId={0}",o));return}var p=h+o;if(Confluence.CreateJiraContent.JiraIssue.Cache.containKey(p)){r(Confluence.CreateJiraContent.JiraIssue.Cache.get(p));return}AppLinks.makeRequest({appId:o,type:"GET",url:n,dataType:"json",success:function(t){if(!t||!t.epicTypeId){AJS.logError("confluence-jira-content:resolveEpicIssueType - Data discovering error! Unexpected data return.");return}var s=t.epicTypeId;r(s);Confluence.CreateJiraContent.JiraIssue.Cache.put(p,s)},error:function(s){q(s.status);AJS.logError("confluence-jira-content:resolveEpicIssueType - Error with status="+s.status)}})};var d=function(q,o,r){var s=k+q.serverId+q.projectId+q.issueTypeId;if(Confluence.CreateJiraContent.JiraIssue.Cache.containKey(s)){l(s,o,r);return}var p=function(t){Confluence.CreateJiraContent.JiraIssue.Cache.put(s,t);o(t)};g(q,p,r)};var i=function(q,o){var r=c+q.serverId+q.projectId+q.issueTypeId;if(Confluence.CreateJiraContent.JiraIssue.Cache.containKey(r)){l(r,o);return}var p=function(s){e.each(s,function(t,u){if(u.schema.custom==a){Confluence.CreateJiraContent.JiraIssue.Cache.put(r,t);o(t);return false}})};d(q,p)};var j=function(r,q,o,s){var p=function(t){var u=Confluence.CreateJiraContent.JiraIssue.FieldStatus.HIDDEN;var v=[];e.each(t,function(w,x){if(w==="description"){u=(x.required==true?Confluence.CreateJiraContent.JiraIssue.FieldStatus.REQUIRED:Confluence.CreateJiraContent.JiraIssue.FieldStatus.VISIBLE)}else{if(x.required==true&&!x.hasDefaultValue){if(e.inArray(w,q)==-1){v.push(AJS.escapeHtml(x.name))}}}});o(u,v)};d(r,p,s)};var l=function(r,p,q){var o=Confluence.CreateJiraContent.JiraIssue.Cache.get(r);if(o){p(o)}else{q&&q("Discover fields - unexpected data return.")}};return{resolveEpicField:i,resolveEpicIssueType:f,identifyCreateIssueFields:j}})(AJS.$);Confluence.CreateJiraContent.JiraIssue.Cache=(function(){return{put:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))},get:function(a){var b=sessionStorage.getItem(a);if(b){try{var d=JSON.parse(b)}catch(c){return null}return d}return null},containKey:function(a){return sessionStorage.getItem(a)!=null}}})();Confluence.CreateJiraContent.JiraIssue.FieldStatus={HIDDEN:-1,VISIBLE:0,REQUIRED:1};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/soy/feature-discovery-templates.soy' */
// This file was automatically generated from feature-discovery-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.CreateJiraContent == 'undefined') { Confluence.CreateJiraContent = {}; }
if (typeof Confluence.CreateJiraContent.Templates == 'undefined') { Confluence.CreateJiraContent.Templates = {}; }
if (typeof Confluence.CreateJiraContent.Templates.FeatureDiscovery == 'undefined') { Confluence.CreateJiraContent.Templates.FeatureDiscovery = {}; }


Confluence.CreateJiraContent.Templates.FeatureDiscovery.createFeatureDiscoveryContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="create-issue-feature-discovery-content"><div class="feature-discovery-header"><h2>', soy.$$escapeHtml("Create JIRA issues from content"), '</h2></div><div class="feature-discovery-body"><p>', soy.$$escapeHtml("Highlight requirements, ideas or tasks discussed in pages and transition them to your teams backlog in JIRA."), '</p><div class="feature-discovery-body-image"></div><div class="description"><p class="feature-discovery-body-left">', soy.$$escapeHtml("Select requirements on the page"), '</p><p class="feature-discovery-body-right">', soy.$$escapeHtml("Turn them into new stories in JIRA"), '</p></div></div><div class="feature-discovery-buttons"><button id="show-create-issue" class="aui-button">', soy.$$escapeHtml("Show me"), '</button><button id="feature-discovery-close" class="aui-button aui-button-link">', soy.$$escapeHtml("Close"), '</button></div><div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources', location = 'com/atlassian/confluence/plugins/createjiracontent/js/feature-discovery.js' */
Confluence.CreateJiraContent.FeatureDiscoveryDialog=(function(g){var f;var d=AJS.Meta.get("create-issue-metadata-show-discovery");var h=function(i){f=i};var e=function(i,l,m){var k=i.find("#feature-discovery-close");k.on("click",function(n){a();f.hide()});var j=i.find("#show-create-issue");j.on("click",function(n){a();f.hide();m(l)})};var c=function(i,j,k){i.html(Confluence.CreateJiraContent.Templates.FeatureDiscovery.createFeatureDiscoveryContent());e(i,j,k)};var b=function(){return d};var a=function(){d=false;g.ajax({url:AJS.Confluence.getBaseUrl()+"/rest/createjiracontent/1.0/metadata/discovered",type:"PUT"})};return{shouldShowFeatureDiscovery:b,disableFeatureDiscovery:a,addFeatureDiscoveryContent:c,setFeatureDialogObject:h}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner.js' */
AJS.toInit(function(e){d();AJS.bind("system-content-metadata.toggled-restrictions",function(g,h){AJS.setVisible("#content-metadata-page-restrictions",h.hasRestrictions);d()});AJS.bind("breadcrumbs.expanded",f);e("#page-metadata-banner").css("visibility","visible");b();e("#content-metadata-page-restrictions").click(function(g){g.preventDefault();AJS.trigger("system-content-metadata.open-restrictions-dialog")});function d(){if(e("#system-content-items").children(":not(.hidden)").length==0){e("#system-content-items").addClass("hidden")}else{e("#system-content-items").removeClass("hidden")}}function f(){e("#page-metadata-banner").hide()}function b(){var g=e("#system-content-items a:not(.tipsy-disabled), .page-metadata-item a:not(.tipsy-disabled), .page-metadata-modification-info a.last-modified:not(tipsy-disabled)");a(g);g.click(function(h){c(e(h.target).closest("a"))});e(window).on("click scroll resize",c)}function a(g){e(g).tooltip({live:true,gravity:e("#com-atlassian-confluence").hasClass("theme-documentation view-blog-post")?"nw":"n",title:"title",delayIn:500})}function c(g){e(".tipsy").remove();if(g){var h=e(g).data("tipsy");if(h){h.hoverState="out"}}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner-analytics.js' */
AJS.toInit(function(c){function b(){if(!AJS.Confluence.Analytics||!AJS.Confluence.Analytics.setAnalyticsSource){AJS.log("WARNING: Could not initialise analytics for the page banner: AJS.Confluence.Analytics.setAnalyticsSource is not defined.");return}var e=AJS.Confluence.Analytics.setAnalyticsSource;var f=c("#breadcrumbs > li");e(f.filter(":not(#ellipsis)").find("a"),"breadcrumbs");e(f.filter(".hidden-crumb").find("a"),"breadcrumbs-expanded");e(f.filter(":last").find("a"),"breadcrumbs-parent");var d=c("#com-atlassian-confluence").hasClass("theme-documentation")?"breadcrumbs-homepage":"breadcrumbs-collector";e(f.filter(".first").find("a"),d)}function a(e,d,g){var f=null;e.mouseover(function(){f=setTimeout(g,d)});e.mouseout(function(){clearTimeout(f)})}AJS.bind("breadcrumbs.expanded",function(){AJS.trigger("analyticsEvent",{name:"breadcrumbs-expanded"})});b()});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:soy-resources', location = 'soy/page-banner.soy' */
// This file was automatically generated from page-banner.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PageBanner == 'undefined') { Confluence.Templates.PageBanner = {}; }


Confluence.Templates.PageBanner.banner = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="page-metadata-banner"><ul class="banner">');
  Confluence.Templates.PageBanner.renderSystemContentItems(opt_data, output);
  var itemList6 = opt_data.pageBannerItems;
  var itemListLen6 = itemList6.length;
  for (var itemIndex6 = 0; itemIndex6 < itemListLen6; itemIndex6++) {
    var itemData6 = itemList6[itemIndex6];
    Confluence.Templates.PageBanner.renderPageBannerItem(itemData6, output);
  }
  output.append('</ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageBanner.renderSystemContentItems = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li id="system-content-items" class="noprint">');
  var itemList12 = opt_data.systemContentItems;
  var itemListLen12 = itemList12.length;
  for (var itemIndex12 = 0; itemIndex12 < itemListLen12; itemIndex12++) {
    var itemData12 = itemList12[itemIndex12];
    Confluence.Templates.PageBanner.itemAnchor(soy.$$augmentData(itemData12, {isSystemContentItem: true}), output);
  }
  output.append('</li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageBanner.renderPageBannerItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="page-metadata-item noprint" ', (opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '-wrapper"' : '', '>');
  Confluence.Templates.PageBanner.itemAnchor(opt_data, output);
  output.append('</li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageBanner.itemAnchor = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml(opt_data.href), '" title="', soy.$$escapeHtml(opt_data.tooltip), '" ', (opt_data.linkId) ? 'id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '', ' ', (opt_data.styleClasses) ? 'class="' + soy.$$escapeHtml(opt_data.styleClasses) + '"' : '', '>');
  Confluence.Templates.PageBanner.itemIcon(opt_data, output);
  output.append((! opt_data.isSystemContentItem) ? '<span>' + soy.$$escapeHtml(opt_data.label) + '</span>' : '', '</a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageBanner.itemIcon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.icon) ? '<img class="page-banner-item-icon" src="' + soy.$$escapeHtml(opt_data.icon.url) + '" style="height: ' + soy.$$escapeHtml(opt_data.icon.height) + 'px; width: ' + soy.$$escapeHtml(opt_data.icon.width) + 'px;"/>' : '');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks.js' */
(function(E){function C(K){var F,L;
if(K.offsetX===undefined){var J=0,I=0,H=K.target,G;
do{if(H.scrollTop!=0||H.scrollLeft!=0){G=H
}J+=H.offsetLeft;
I+=H.offsetTop;
H=H.offsetParent
}while(H&&H!=H.offsetParent);
F=K.pageX+(G?G.scrollLeft:0)-J;
L=K.pageY+(G?G.scrollTop:0)-I
}else{F=K.offsetX;
L=K.offsetY
}return F>=3&&F<=14&&L>=3&&L<=14
}function B(F){return F.currentTarget===F.target
}var D,A=false;
E(window).bind("beforeunload",function(){A=true
});
E(document).delegate("ul.inline-task-list > li[data-inline-task-id]",{click:function(J){if(B(J)&&C(J)){var I=E(J.target).toggleClass("checked"),F=I.hasClass("checked")?"CHECKED":"UNCHECKED",H=I.data("inline-task-id"),K=I.closest("ul").attr("data-inline-tasks-content-id")||AJS.params.pageId,G=AJS.contextPath()+"/rest/inlinetasks/1/task/"+K+"/"+H+"/";
E.ajax({type:"POST",url:G,data:{status:F,trigger:"VIEW_PAGE"},dataType:"text",timeout:30000,error:function(M,N,L){if(A||N=="timeout"){return 
}AJS.log("Inline Task #"+H+" was not persisted to "+F+" because of "+L+" (status: "+N+")");
I.toggleClass("checked");
D=D||Confluence.InlineTasks.Notice();
D.show()
}})
}},mousemove:function(F){if(B(F)){if(C(F)){E(F.target).addClass("hover")
}else{E(F.target).removeClass("hover")
}}},mouseout:function(F){if(B(F)){E(F.target).removeClass("hover")
}},mousedown:function(F){if(B(F)&&C(F)){E(F.target).addClass("task-active")
}},mouseup:function(F){if(B(F)&&C(F)){E(F.target).removeClass("task-active")
}}})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks-alert.js' */
Confluence.InlineTasks=Confluence.InlineTasks||{};
AJS.toInit(function(B){var A=Confluence.InlineTasks.Templates;
Confluence.InlineTasks.Notice=function(){var C=B(A.notice());
C.appendTo("body");
C.find(".notice-close").click(function(){C.hide()
});
return{show:function(){C.show();
return this
},hide:function(D){C.hide();
return this
}}
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'templates/inline-tasks.soy' */
// This file was automatically generated from inline-tasks.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.InlineTasks == 'undefined') { Confluence.InlineTasks = {}; }
if (typeof Confluence.InlineTasks.Templates == 'undefined') { Confluence.InlineTasks.Templates = {}; }


Confluence.InlineTasks.Templates.notice = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message error" id="inline-tasks-notice">', "Oops! Your task change couldn\x27t be saved. \x3cbr/\x3eThere could be a few reasons for this.", '&nbsp;&nbsp;<a href="', soy.$$escapeHtml("http://docs.atlassian.com/confluence/docs-54/Failed+Update+to+Task+List"), '" class="notice-learn-more">', soy.$$escapeHtml("Learn more"), '</a>&nbsp;&nbsp;<a href="#" class="notice-close">', soy.$$escapeHtml("Dismiss"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like-namespace.js' */
Confluence.Likes = Confluence.Likes || {};


} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like.js' */
(function ($) {

    var LIKE = 0,
        UNLIKE = 1,
        likesDialog,
        /**
         * A hash of contentId to likes data (used to facilitate "instant like").
         *
         * The "data" value must contain: "content_type" string and a "likes" array. e.g.
         * {
         *     likes: [ { name: "fred" } ],
         *     "content_type": "page"
         * }
         */
        likesCache = {};

    function getRestUrl(contentId) {
        return Confluence.getContextPath() + "/rest/likes/1.0/content/" + contentId + "/likes";
    }

    var isPageGadget = AJS.PageGadget || (window.parent.AJS && window.parent.AJS.PageGadget);
    !isPageGadget && AJS.toInit(function () {

        AJS.I18n.get("com.atlassian.confluence.plugins.confluence-like", function () {

            var remoteUser = AJS.Meta.get("remote-user") || "",
                remoteUserIsAnonymous = remoteUser.length === 0;

            /**
             * @param data a hash with a "likes" and "content_type" as required properties.
             * @param contentId
             * @param $summaryContainer
             */
            function updateLikeSummary(data, contentId, $summaryContainer) {
                var summary = Confluence.Likes.LikeSummaryFactory.getLikeSummary(data.likes, contentId, remoteUser);

                if (!summary.key) {
                    if (remoteUser.length > 0 && (data["content_type"] == "page" || data["content_type"] == "blogpost")) {
                        summary.key = "likes.bethefirst";
                    }
                }

                var summaryText = AJS.I18n.getText(summary.key, summary.args);

                if (summaryText && summaryText.length > 0) {
                    $summaryContainer.html(summaryText);
                } else {
                    $summaryContainer.empty();
                }

                if (!summaryText) {
                    return;
                }

                $summaryContainer.find(".likes").click(function () {
                    var contentId = $(this).attr("data-content-id");

                    if (likesDialog) {
                        likesDialog.remove();
                        likesDialog = undefined;
                    }

                    likesDialog = new AJS.Dialog(400, 365, 'likes-dialog');
                    likesDialog.addHeader("People who like this");
                    likesDialog.addPanel("Panel 1", "<div class='spinner-container'></div>");
                    likesDialog.addCancel("Close", function (dialog) {
                        dialog.remove();
                        likesDialog = undefined;
                    });
                    likesDialog.getCurrentPanel().setPadding(0);

                    // CONF-7330: make likes dialog non-modal
                    function callWithAJSDimDisabled(thisArg, functionArg, parametersArg) {
                        var dimFunctionReference = AJS.dim, // copy reference to original dim function
                            noop = function () {};

                        AJS.dim = noop;
                        try {
                            functionArg.apply(thisArg, parametersArg || []);
                        } finally {
                            AJS.dim = dimFunctionReference;
                        }
                    }

                    callWithAJSDimDisabled(likesDialog, likesDialog.show);

                    $.ajax({
                        type: "GET",
                        url: getRestUrl(contentId),
                        data: {
                            expand: "user",
                            max: 50
                        },
                        dataType: "json"
                    }).done(function (data) {
                        if (!likesDialog.popup.element.is(":visible")) {
                            return;
                        }

                        data.remoteUser = remoteUser;
                        likesDialog.getCurrentPanel().html(Confluence.Templates.Likes.likesDialog(data));

                        $("#likes-dialog").find(".likes-dialog-follow-button").click(function () {
                            var $button = $(this);
                            $.ajax({
                                type: "PUT",
                                url: Confluence.getContextPath() + "/rest/likes/1.0/user/" + AJS.Meta.get("remote-user") + "/following?username=" + $button.attr("data-username"),
                                contentType: "application/json",
                                dataType: "json"
                            }).done(function () {
                                $button.replaceWith("Following");
                            });
                        });

                    });

                    return false;
                });

                Confluence.Binder.userHover(); // to ensure user hover over user links work

                if (data["content_type"] == "comment") {
                    $summaryContainer.prepend("<span class='comment-action-separator'></span><span class='small-like-icon'></span>");
                }
            }

            function createHandlerFor(type, contentId, contentType) {
                if (type === undefined) {
                    throw new Error("type is required");
                }
                if (contentId === undefined) {
                    throw new Error("contentId is required");
                }
                if (contentType === undefined) {
                    throw new Error("contentType is required");
                }

                return function () {
                    if (typeof this !== "object" || !this.nodeType || this.nodeType !== 1 || this.nodeName != "A") {
                        throw new Error("this handler should be bound to a DOM anchor element");
                    }

                    var $likeLink = $(this),
                        callee = arguments.callee,
                        $summaryContainer = $likeLink.next(".like-summary");

                    $.ajax({
                        type: type === LIKE ? "POST" : "DELETE",
                        url: getRestUrl(contentId),
                        data: {
                            "atlassian-token": AJS.Meta.get("atlassian-token")
                        },
                        dataType: "json",
                        timeout: 5000
                    }).fail(function () {
                        var $likeError = $summaryContainer.siblings(".like-error"),
                            likeErrorI18nKey = "likes." + (type === LIKE ? "like" : "unlike") + ".failed";

                        if ($likeError.length === 0) {
                            $summaryContainer.after("<span class='like-error' title='" + AJS.I18n.getText(likeErrorI18nKey) + "'></span>");
                        } else {
                            $likeError.attr("title", AJS.I18n.getText(likeErrorI18nKey));
                        }
                    }).success(function () {
                        $summaryContainer.attr("liked", type === LIKE);
                        $summaryContainer.parent().find(".like-error").remove();
                    });

                    // instantly update like link and summary
                    $likeLink
                        .unbind("click", callee)
                        .bind("click", type === LIKE ? createHandlerFor(UNLIKE, contentId, contentType) : createHandlerFor(LIKE, contentId, contentType))
                        .html(type === LIKE ? "Unlike" : "Like");

                    likesCache[contentId] = likesCache[contentId] || {
                        content_type: contentType,
                        likes: []
                    };

                    if (type === LIKE) { // simulate an immediate "like"
                        likesCache[contentId].likes.push({
                            user: { name: remoteUser }
                        });
                    } else { // simulate an immediate "unlike"
                        likesCache[contentId].likes = $.grep(likesCache[contentId].likes, function (like) {
                            return like.user.name != remoteUser;
                        });
                    }

                    updateLikeSummary(likesCache[contentId], contentId, $summaryContainer);

                    return false;
                }
            }

            var $contentLikeSection = $(Confluence.Templates.Likes.likeSection({
                showLikeButton: !remoteUserIsAnonymous
            }));

            $("<div id='likes-and-labels-container' />")
                .insertBefore("#labels-section")
                .append($contentLikeSection)
                .append($("#labels-section"));

            if (AJS.Meta.get("page-id"))
            {
                $.ajax({
                    type: "GET",
                    url: getRestUrl(AJS.Meta.get("page-id")),
                    dataType: "json"
                }).done(function (data) {
                    if (AJS.Meta.get("remote-user")) {
                        var existingLike = $.grep(data.likes, function (like) {
                            return like.user.name == AJS.Meta.get("remote-user");
                        }).length > 0;

                        var contentType = data["content_type"];
                        $contentLikeSection.find(".like-button")
                            .click(existingLike ? createHandlerFor(UNLIKE, AJS.Meta.get("page-id"), contentType) : createHandlerFor(LIKE, AJS.Meta.get("page-id"), contentType))
                            .html(existingLike ? "Unlike" : "Like");
                    }

                    var $likeSummary = $contentLikeSection.find(".like-summary");

                    updateLikeSummary(data, data["content_id"], $likeSummary);

                    if ($likeSummary.html() == "" && remoteUserIsAnonymous) {
                        $contentLikeSection.hide();
                    }

                    likesCache[data["content_id"]] = data;
                });
            }

            Confluence.Likes.appendAction = function($comments) {
        	/* CONFDEV-13029: Get in between comment-action-remove and comment-date, will just append in case selector doesn't match. */
        	var commentActionsPrimaryItems = $comments.find(".comment-actions-primary");
        	var commentDateItem = commentActionsPrimaryItems.find("li[class~='comment-date']");
        	var commentLikeItemText = $(Confluence.Templates.Likes.commentLikeSection({showLikeButton: !remoteUserIsAnonymous}));
        	if(commentDateItem.length == 0) {
        	    commentActionsPrimaryItems.find("li:last-child").after(commentLikeItemText);
        	} else {
        	    commentDateItem.before(commentLikeItemText);
        	}
            };
            Confluence.Likes.reload = function() {
                if (AJS.Meta.get("page-id"))
                {
                    $.ajax({
                        type: "GET",
                        url: Confluence.getContextPath() + "/rest/likes/1.0/content/" + AJS.Meta.get("page-id") + "/comment-likes",
                        dataType: "json"
                    }).done(function(data) {
                        $.each(data, function (contentId, innerData) {
                            var $comment = $("#comment-" + contentId);

                            var $likeSummary = $comment.find(".like-summary");
                            updateLikeSummary(innerData, contentId, $likeSummary);

                            likesCache[contentId] = innerData;
                        });

                        remoteUserIsAnonymous && $("#page-comments").find(".like-summary:empty").each(function () {
                            $(this).closest(".comment-action-like").hide();
                        });

                        $("#page-comments .comment").each(function () {
                            Confluence.Likes.updateComment($(this), data);
                        });
                    });
                }
            };
            Confluence.Likes.updateComment = function($comment, data) {
                var id = $comment.attr("id");
                if (!id) {
                    return true; // comment should have an ID attribute, if not skip
                }

                var commentId = (/^comment-(\d+)$/.exec(id) || [])[1];
                if (!commentId) {
                    throw new Error("Expecting ID attribute of comment to be in format \"comment-XXX\", found: " + id);
                }

                var existingLike = data[commentId] && AJS.Meta.get("remote-user") && $.grep(data[commentId].likes, function (like) {
                    return like.user.name == AJS.Meta.get("remote-user");
                }).length > 0;

                $comment.find(".like-button")
                    .click(existingLike ? createHandlerFor(UNLIKE, commentId, "comment") : createHandlerFor(LIKE, commentId, "comment"))
                    .html(existingLike ? "Unlike" : "Like");

            };
            Confluence.Likes.appendAction($("#page-comments"));
            Confluence.Likes.reload();
        }, function () {
            throw new Error("Error downloading translation files for likes plugin.");
        });
    });

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like-summary-factory.js' */
(function ($) {

    /**
     * Maximum number of likes from a person's network to promote (read: show the full names of upfront) in the "like" summary
     */
    var MAX_PROMOTED = 3;

    Confluence.Likes.LikeSummaryFactory = {
        /**
         * Returns an i18n message that can be translated into a like summary
         * @param likes a collection of likes
         * @param contentId the content id
         * @param remoteUser the remote user (logged in user)
         */
        getLikeSummary: function (likes, contentId, remoteUser) {
            if (!likes || likes.length === 0) {
                return { key: "" };
            }

            if (!contentId) {
                throw new Error("contentId is required.");
            }

            var me,
                promoted = [], // "promoted" is defined as the user's full name is shown in the summary rather than hidden in the dialog triggered by "X others"
                nonPromoted = [];

            $.each(likes, function (i, like) {
                if (like.user && like.user.name == remoteUser) {
                    me = like;
                } else if (promoted.length < MAX_PROMOTED && like.user.followedByRemoteUser) {
                    promoted.push(like);
                } else {
                    nonPromoted.push(like);
                }
            });

            var i18nKey = ["likes.summary"],
                i18nArgs = [];

            if (me != null) {
                i18nKey.push(".you");
            }

            if (promoted.length > 0) {
                i18nKey.push(".");
                i18nKey.push(promoted.length);
                i18nKey.push(".promoted");

                $.each(promoted, function (i, like) {
                    i18nArgs.push(Confluence.Templates.Likes.userLink(like));
                });
            }

            if (nonPromoted.length == 1) {
                i18nKey.push(".1.non-promoted");
                i18nArgs.push(Confluence.Templates.Likes.userLink(nonPromoted[0]));
            } else if (nonPromoted.length > 1) {
                i18nKey.push(".x.non-promoted");
                i18nArgs.push(nonPromoted.length);
                i18nArgs.push("class=\"likes\" data-content-id=\"" + contentId + "\"");
            }

            return {
                key: i18nKey.join(""),
                args: i18nArgs.length === 0 ? undefined : i18nArgs
            };
        }
    };
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/templates/com/atlassian/confluence/plugins/like/soy/like.soy' */
// This file was automatically generated from like.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Likes == 'undefined') { Confluence.Templates.Likes = {}; }


Confluence.Templates.Likes.likeSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="likes-section">', (opt_data.showLikeButton) ? '<a href="" class="like-button">' + soy.$$escapeHtml("Like") + '</a>' : '', '<span class="like-summary"></span></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Likes.commentLikeSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="comment-action-like">', (opt_data.showLikeButton) ? '<a href="" class="like-button">' + soy.$$escapeHtml("Like") + '</a>' : '', '<span class="like-summary"></span></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Likes.likesDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="likes-dialog-body"><ol>');
  var likeList20 = opt_data.likes;
  var likeListLen20 = likeList20.length;
  for (var likeIndex20 = 0; likeIndex20 < likeListLen20; likeIndex20++) {
    var likeData20 = likeList20[likeIndex20];
    output.append('<li><div class="avatar-container"><a href="', soy.$$escapeHtml(likeData20.user.url), '"><img class="like-user-avatar" src="', soy.$$escapeHtml(likeData20.user.avatarUrl), '"></a></div><div class="like-user"><a class="like-user-link" href="', soy.$$escapeHtml(likeData20.user.url), '">', soy.$$escapeHtml(likeData20.user.fullName), '</a></div><div class="follow-button-container aui-toolbar"><ul class="toolbar-group"><li class="toolbar-item">', (likeData20.user.followedByRemoteUser) ? soy.$$escapeHtml("Following") : (opt_data.remoteUser && opt_data.remoteUser.length > 0) ? '<button data-username="' + soy.$$escapeHtml(likeData20.user.name) + '" class="likes-dialog-follow-button toolbar-trigger">' + soy.$$escapeHtml("Follow") + '</button>' : '', '</li></ul></div></li>');
  }
  output.append('</ol></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Likes.userLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml(opt_data.user.url), '" class="confluence-userlink" data-username="', soy.$$escapeHtml(opt_data.user.name), '">', soy.$$escapeHtml(opt_data.user.fullName), '</a>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/soy/sharelinks-urlmacro-templates.soy' */
// This file was automatically generated from sharelinks-urlmacro-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.SharelinksUrlMacro == 'undefined') { Confluence.Blueprints.SharelinksUrlMacro = {}; }


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="aui-button sharelinks-urlmacro-button" href="');
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript(opt_data, output);
  output.append('"><span>', soy.$$escapeHtml("Share on Confluence"), '</span></a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('javascript:(function(){var screenWidth=screen.width,screenHeight=screen.height,popupWidth=640,popupHeight=580,popupLeft=0,popupTop=0; if(screenWidth>popupWidth){popupLeft=Math.round((screenWidth/2)-(popupWidth/2));}if(screenHeight>popupHeight){popupTop=Math.round((screenHeight/2)-(popupHeight/2));}window.open(\'', opt_data.bookmarkletActionURL, '?bookmarkedURL=\'+encodeURIComponent(window.location.href), \'\',\'left=\'+popupLeft+\',top=\'+popupTop+\',width=\'+popupWidth+\',height=\'+popupHeight+\',personalbar=0,toolbar=0,scrollbars=1,resizable=1\');}());');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/js/sharelinks-urlmacro.js' */
AJS.toInit(function(a){a(".sharelinks-urlmacro-button").click(function(){alert("Drag this link to your toolbar");return false})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:sortable-table-resources', location = 'js/SortableTables.js' */
(function($){

$(function(){
    /**
     * We work hard here to keep the cheap and expensive parts separated.
     * We call enable on a delay but keep both methods exposed globally so that we can re-init/enable
     * sortable tables on a page should we modify the dom dramatically.
     */
    var tables;
    Confluence.SortableTables = {
        init: function(){
            tables = $('table');

            tables = tables.filter(function(){
                var cells = $(this).find('td, th'),
                    firstRowCells = this.rows.length && $(this.rows[0].cells),
                    cell, eventData;

                eventData = jQuery.Event("makeSortable.SortableTables");
                $(this).trigger(eventData);
                if (eventData.isDefaultPrevented()) {
                    return false;
                }

                if (!firstRowCells || firstRowCells.length === 0) { //there are no rows or no cells
                    return false;
                }
                //no colspan or rowspans > 1
                for (var i = 0, len = cells.length; i < len; i++) {
                    cell = cells[i];
                    if(cell.rowSpan != 1 || cell.colSpan != 1) {
                        return false;
                    }
                }

                //Header contains an inner table, not sortable
                if($(this.rows[0]).find('table').length){
                    return false;
                }

                // at least one cell in first row is not a th or have a class of nohighlight, not sortable
                if (firstRowCells.filter('th').length != firstRowCells.length || firstRowCells.hasClass('nohighlight'))
                    return false;

                // single row tables are not sortable
                return this.rows[1];
            });
        },
        enable: function(){
            tables.each(function(){
                // Changing this to use live dom nodes or something other than a document fragment has a
                // significant performance penalty. Modify with care.
                var body = this.removeChild(this.children[0]),
                    rows = $(body.children),
                    firstRow = Array.prototype.shift.call(rows),
                    fragment = document.createDocumentFragment(),
                    head = document.createElement("thead");

                fragment.appendChild(head);
                head.appendChild(firstRow);
                fragment.appendChild(body);

                this.appendChild(fragment);
            });

            tables.tablesorter({
                "cssHeader" : 'sortableHeader',
                "delayInit" : true,
                "textExtraction" : function(node){
                    //Do the text trim manually since our version of jQuery fails at this.
                    return AJS.trim($(node).text());
                },
                "dateFormat": getDateFormat()
            });
        }
    };
    Confluence.SortableTables.init();
    setTimeout(Confluence.SortableTables.enable, 100);
});

//Sortable tables friendly date format
function getDateFormat(){
    var dateFormat = AJS.Meta.get('date.format'),
        firstCharacter, retVal;

    if (dateFormat && dateFormat.length !== 0) {
        //we can assume enough from the first character
        firstCharacter = dateFormat.toLowerCase()[0];
        if (firstCharacter === 'm') {
            retVal = 'mmddyyyy';
        } else if (firstCharacter === 'd') {
            retVal = 'ddmmyyyy';
        } else if (firstCharacter === 'y') {
            retVal = 'yyyymmdd';
        }
    }
    return retVal;
}
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:sortable-table-resources', location = 'tablesorter/js/jquery.tablesorter.js' */
/*!
* TableSorter 2.3.10 - Client-side table sorting with ease!
* @requires jQuery v1.2.6+
*
* Copyright (c) 2007 Christian Bach
* Examples and docs at: http://tablesorter.com
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*
* @type jQuery
* @name tablesorter
* @cat Plugins/Tablesorter
* @author Christian Bach/christian.bach@polyester.se
* @contributor Rob Garrison/https://github.com/Mottie/tablesorter
*/
!(function($) {
	$.extend({
		tablesorter: new function() {

			this.version = "2.3.10";

			var parsers = [], widgets = [];
			this.defaults = {

				// appearance
				widthFixed       : false,      // adds colgroup to fix widths of columns

				// functionality
				cancelSelection  : true,       // prevent text selection in the header
				dateFormat       : "mmddyyyy", // other options: "ddmmyyy" or "yyyymmdd"
				sortMultiSortKey : "shiftKey", // key used to select additional columns
				usNumberFormat   : true,       // false for German "1.234.567,89" or French "1 234 567,89"
				delayInit        : false,      // if false, the parsed table contents will not update until the first sort.

				// sort options
				headers          : {},         // set sorter, string, empty, locked order, sortInitialOrder, filter, etc.
				ignoreCase       : true,       // ignore case while sorting
				sortForce        : null,       // column(s) first sorted; always applied
				sortList         : [],         // Initial sort order; applied initially; updated when manually sorted
				sortAppend       : null,       // column(s) sorted last; always applied

				sortInitialOrder : "asc",      // sort direction on first click
				sortLocaleCompare: false,      // replace equivalent character (accented characters)
				sortReset        : false,      // third click on the header will reset column to default - unsorted
				sortRestart      : false,      // restart sort to "sortInitialOrder" when clicking on previously unsorted columns

				emptyTo          : "bottom",   // sort empty cell to bottom, top, none, zero
				stringTo         : "max",      // sort strings in numerical column as max, min, top, bottom, zero
				textExtraction   : "simple",   // text extraction method/function - function(node, table, cellIndex){}
				textSorter       : null,       // use custom text sorter - function(a,b){ return a.sort(b); } // basic sort

				// widget options
				widgets: [],                   // method to add widgets, e.g. widgets: ['zebra']
				widgetOptions    : {
					zebra : [ "even", "odd" ]    // zebra widget alternating row class names
				},
				initWidgets      : true,       // apply widgets on tablesorter initialization

				// callbacks
				initialized      : null,       // function(table){},
				onRenderHeader   : null,       // function(index){},

				// css class names
				tableClass       : 'tablesorter',
				cssAsc           : "tablesorter-headerSortUp",
				cssChildRow      : "expand-child",
				cssDesc          : "tablesorter-headerSortDown",
				cssHeader        : "tablesorter-header",
				cssInfoBlock     : "tablesorter-infoOnly", // don't sort tbody with this class name

				// selectors
				selectorHeaders  : '> thead th',
				selectorRemove   : "tr.remove-me",

				// advanced
				debug            : false,

				// Internal variables
				headerList: [],
				empties: {},
				strings: {},
				parsers: []

				// deprecated; but retained for backwards compatibility
				// widgetZebra: { css: ["even", "odd"] }

			};

			/* debuging utils */
			function log(s) {
				if (typeof console !== "undefined" && typeof console.log !== "undefined") {
					console.log(s);
				} else {
					alert(s);
				}
			}

			function benchmark(s, d) {
				log(s + " (" + (new Date().getTime() - d.getTime()) + "ms)");
			}

			this.benchmark = benchmark;
			this.hasInitialized = false;

			function getElementText(table, node, cellIndex) {
				if (!node) { return ""; }
				var c = table.config,
					t = c.textExtraction, text = "";
				if (t === "simple") {
					if (c.supportsTextContent) {
						text = node.textContent; // newer browsers support this
					} else {
						if (node.childNodes[0] && node.childNodes[0].hasChildNodes()) {
							text = node.childNodes[0].innerHTML;
						} else {
							text = node.innerHTML;
						}
					}
				} else {
					if (typeof(t) === "function") {
						text = t(node, table, cellIndex);
					} else if (typeof(t) === "object" && t.hasOwnProperty(cellIndex)) {
						text = t[cellIndex](node, table, cellIndex);
					} else {
						text = c.supportsTextContent ? node.textContent : $(node).text();
					}
				}
				return $.trim(text);
			}

			/* parsers utils */
			function getParserById(name) {
				var i, l = parsers.length;
				for (i = 0; i < l; i++) {
					if (parsers[i].id.toLowerCase() === (name.toString()).toLowerCase()) {
						return parsers[i];
					}
				}
				return false;
			}

			function detectParserForColumn(table, rows, rowIndex, cellIndex) {
				var i, l = parsers.length,
				node = false,
				nodeValue = '',
				keepLooking = true;
				while (nodeValue === '' && keepLooking) {
					rowIndex++;
					if (rows[rowIndex]) {
						node = rows[rowIndex].cells[cellIndex];
						nodeValue = getElementText(table, node, cellIndex);
						if (table.config.debug) {
							log('Checking if value was empty on row ' + rowIndex + ', column: ' + cellIndex + ': ' + nodeValue);
						}
					} else {
						keepLooking = false;
					}
				}
				for (i = 1; i < l; i++) {
					if (parsers[i].is(nodeValue, table, node)) {
						return parsers[i];
					}
				}
				// 0 is always the generic parser (text)
				return parsers[0];
			}

			function buildParserCache(table, $headers) {
				var c = table.config,
					tb = $(table.tBodies).filter(':not(.' + c.cssInfoBlock + ')'),
					ts = $.tablesorter, rows, list, l, i, h, m, ch, cl, p, parsersDebug = "";
				if ( tb.length === 0) { return; } // In the case of empty tables
				rows = tb[0].rows;
				if (rows[0]) {
					list = [];
					l = rows[0].cells.length;
					for (i = 0; i < l; i++) {
						// tons of thanks to AnthonyM1229 for working out the following selector (issue #74) to make this work in IE8!
						h = $headers.filter(':not([colspan])[data-column="'+i+'"]:last,[colspan="1"][data-column="'+i+'"]:last');
						ch = c.headers[i];
						// get column parser
						p = getParserById( ts.getData(h, ch, 'sorter') );
						// empty cells behaviour - keeping emptyToBottom for backwards compatibility.
						c.empties[i] = ts.getData(h, ch, 'empty') || c.emptyTo || (c.emptyToBottom ? 'bottom' : 'top' );
						// text strings behaviour in numerical sorts
						c.strings[i] = ts.getData(h, ch, 'string') || c.stringTo || 'max';
						if (!p) {
							p = detectParserForColumn(table, rows, -1, i);
						}
						if (c.debug) {
							parsersDebug += "column:" + i + "; parser:" + p.id + "; string:" + c.strings[i] + '; empty: ' + c.empties[i] + "\n";
						}
						list.push(p);
					}
				}
				if (c.debug) {
					log(parsersDebug);
				}
				return list;
			}

			/* utils */
			function buildCache(table) {
				var b = table.tBodies,
				tc = table.config,
				totalRows,
				totalCells,
				parsers = tc.parsers,
				t, i, j, k, c, cols, cacheTime;
				tc.cache = {};
				if (tc.debug) {
					cacheTime = new Date();
				}
				for (k = 0; k < b.length; k++) {
					tc.cache[k] = { row: [], normalized: [] };
					// ignore tbodies with class name from css.cssInfoBlock
					if (!$(b[k]).hasClass(tc.cssInfoBlock)) {
						$(b[k]).addClass('tablesorter-hidden');
						totalRows = (b[k] && b[k].rows.length) || 0;
						totalCells = (b[k].rows[0] && b[k].rows[0].cells.length) || 0;
						for (i = 0; i < totalRows; ++i) {
							/** Add the table data to main data array */
							c = $(b[k].rows[i]);
							cols = [];
							// if this is a child row, add it to the last row's children and continue to the next row
							if (c.hasClass(tc.cssChildRow)) {
								tc.cache[k].row[tc.cache[k].row.length - 1] = tc.cache[k].row[tc.cache[k].row.length - 1].add(c);
								// go to the next for loop
								continue;
							}
							tc.cache[k].row.push(c);
							for (j = 0; j < totalCells; ++j) {
								t = getElementText(table, c[0].cells[j], j);
								// allow parsing if the string is empty, previously parsing would change it to zero,
								// in case the parser needs to extract data from the table cell attributes
								cols.push( parsers[j].format(t, table, c[0].cells[j], j) );
							}
							cols.push(tc.cache[k].normalized.length); // add position for rowCache
							tc.cache[k].normalized.push(cols);
						}
						$(b[k]).removeClass('tablesorter-hidden');
					}
				}
				if (tc.debug) {
					benchmark("Building cache for " + totalRows + " rows", cacheTime);
				}
			}

			function getWidgetById(name) {
				var i, w, l = widgets.length;
				for (i = 0; i < l; i++) {
					w = widgets[i];
					if (w && w.hasOwnProperty('id') && w.id.toLowerCase() === name.toLowerCase()) {
						return w;
					}
				}
			}

			function applyWidget(table, init) {
				var tc = table.config, c = tc.widgets,
				time, i, w, l = c.length;
				if (tc.debug) {
					time = new Date();
				}
				for (i = 0; i < l; i++) {
					w = getWidgetById(c[i]);
					if ( w ) {
						if (init === true && w.hasOwnProperty('init')) {
							w.init(table, widgets, w);
						} else if (!init && w.hasOwnProperty('format')) {
							w.format(table);
						}
					}
				}
				if (tc.debug) {
					benchmark("Completed " + (init === true ? "initializing" : "applying") + " widgets", time);
				}
			}

			// init flag (true) used by pager plugin to prevent widget application
			function appendToTable(table, init) {
				var c = table.config,
				b = table.tBodies,
				rows = [],
				r, n, totalRows, checkCell, c2 = c.cache,
				f, i, j, k, l, pos, appendTime;
				if (c.debug) {
					appendTime = new Date();
				}
				for (k = 0; k < b.length; k++) {
					if (!$(b[k]).hasClass(c.cssInfoBlock)){
						$(b[k]).addClass('tablesorter-hidden');
						f = document.createDocumentFragment();
						r = c2[k].row;
						n = c2[k].normalized;
						totalRows = n.length;
						checkCell = totalRows ? (n[0].length - 1) : 0;
						for (i = 0; i < totalRows; i++) {
							pos = n[i][checkCell];
							rows.push(r[pos]);
							// removeRows used by the pager plugin
							if (!c.appender || !c.removeRows) {
								l = r[pos].length;
								for (j = 0; j < l; j++) {
									f.appendChild(r[pos][j]);
								}
							}
						}
						table.tBodies[k].appendChild(f);
						$(b[k]).removeClass('tablesorter-hidden');
					}
				}
				if (c.appender) {
					c.appender(table, rows);
				}
				if (c.debug) {
					benchmark("Rebuilt table", appendTime);
				}
				// apply table widgets
				if (!init) { applyWidget(table); }
				// trigger sortend
				$(table).trigger("sortEnd", table);
			}

			// computeTableHeaderCellIndexes from:
			// http://www.javascripttoolbox.com/lib/table/examples.php
			// http://www.javascripttoolbox.com/temp/table_cellindex.html
			function computeThIndexes(t) {
				var matrix = [],
				lookup = {},
				trs = $(t).find('thead:eq(0) tr'),
				i, j, k, l, c, cells, rowIndex, cellId, rowSpan, colSpan, firstAvailCol, matrixrow;
				for (i = 0; i < trs.length; i++) {
					cells = trs[i].cells;
					for (j = 0; j < cells.length; j++) {
						c = cells[j];
						rowIndex = c.parentNode.rowIndex;
						cellId = rowIndex + "-" + c.cellIndex;
						rowSpan = c.rowSpan || 1;
						colSpan = c.colSpan || 1;
						if (typeof(matrix[rowIndex]) === "undefined") {
							matrix[rowIndex] = [];
						}
						// Find first available column in the first row
						for (k = 0; k < matrix[rowIndex].length + 1; k++) {
							if (typeof(matrix[rowIndex][k]) === "undefined") {
								firstAvailCol = k;
								break;
							}
						}
						lookup[cellId] = firstAvailCol;
						// add data-column
						$(c).attr({ 'data-column' : firstAvailCol }); // 'data-row' : rowIndex
						for (k = rowIndex; k < rowIndex + rowSpan; k++) {
							if (typeof(matrix[k]) === "undefined") {
								matrix[k] = [];
							}
							matrixrow = matrix[k];
							for (l = firstAvailCol; l < firstAvailCol + colSpan; l++) {
								matrixrow[l] = "x";
							}
						}
					}
				}
				return lookup;
			}

			function formatSortingOrder(v) {
				// look for "d" in "desc" order; return true
				return (/^d/i.test(v) || v === 1);
			}


			function buildHeaders(table) {
				var header_index = computeThIndexes(table), ch, $t,
					$th, lock, time, $tableHeaders, c = table.config, ts = $.tablesorter;
					c.headerList = [];
				if (c.debug) {
					time = new Date();
				}
				$tableHeaders = $(table).find(c.selectorHeaders)
				.each(function(index) {
					$t = $(this);
					ch = c.headers[index];
					this.innerHTML = '<div class="tablesorter-header-inner">' + this.innerHTML + '</div>'; // faster than wrapInner
					if (c.onRenderHeader) { c.onRenderHeader.apply($t, [index]); }
					this.column = header_index[this.parentNode.rowIndex + "-" + this.cellIndex];
					this.order = formatSortingOrder( ts.getData($t, ch, 'sortInitialOrder') || c.sortInitialOrder ) ? [1,0,2] : [0,1,2];
					this.count = -1; // set to -1 because clicking on the header automatically adds one
					if (ts.getData($t, ch, 'sorter') === 'false') { this.sortDisabled = true; }
					this.lockedOrder = false;
					lock = ts.getData($t, ch, 'lockedOrder') || false;
					if (typeof(lock) !== 'undefined' && lock !== false) {
						this.order = this.lockedOrder = formatSortingOrder(lock) ? [1,1,1] : [0,0,0];
					}
					if (!this.sortDisabled) {
						$th = $t.addClass(c.cssHeader);
					}
					// add cell to headerList
					c.headerList[index] = this;
					// add to parent in case there are multiple rows
					$t.parent().addClass(c.cssHeader);
				});
				if (table.config.debug) {
					benchmark("Built headers:", time);
					log($tableHeaders);
				}
				return $tableHeaders;
			}

			function isValueInArray(v, a) {
				var i, l = a.length;
				for (i = 0; i < l; i++) {
					if (a[i][0] === v) {
						return true;
					}
				}
				return false;
			}

			function setHeadersCss(table, $headers, list) {
				var f, h = [], i, j, l, css = [table.config.cssDesc, table.config.cssAsc];
				// remove all header information
				$headers
					.removeClass(css.join(' '))
					.each(function() {
						if (!this.sortDisabled) {
							h[this.column] = $(this);
						}
					});
				l = list.length;
				for (i = 0; i < l; i++) {
					if (list[i][1] === 2) { continue; } // direction = 2 means reset!
					if (h[list[i][0]]) {
						// add class if cell exists - fix for issue #78
						h[list[i][0]].addClass(css[list[i][1]]);
					}
					// multicolumn sorting updating
					f = $headers.filter('[data-column="' + list[i][0] + '"]');
					if (l > 1 && f.length) {
						for (j = 0; j < f.length; j++) {
							if (!f[j].sortDisabled) {
								$(f[j]).addClass(css[list[i][1]]);
							}
						}
					}
				}
			}

			function fixColumnWidth(table) {
				if (table.config.widthFixed) {
					var colgroup = $('<colgroup>');
					$("tr:first td", table.tBodies[0]).each(function() {
						colgroup.append($('<col>').css('width', $(this).width()));
					});
					$(table).prepend(colgroup);
				}
			}

			function updateHeaderSortCount(table, sortList) {
				var i, s, o, c = table.config,
				l = sortList.length;
				for (i = 0; i < l; i++) {
					s = sortList[i];
					o = c.headerList[s[0]];
					if (o) { // prevents error if sorton array is wrong
						o.count = s[1] % (c.sortReset ? 3 : 2);
					}
				}
			}

			function getCachedSortType(parsers, i) {
				return (parsers && parsers[i]) ? parsers[i].type || '' : '';
			}

			/* sorting methods - reverted sorting method back to version 2.0.3 */
			function multisort(table, sortList) {
				var dynamicExp, col, mx = 0, dir = 0, tc = table.config,
				l = sortList.length, bl = table.tBodies.length,
				sortTime, i, j, k, c, cache, lc, s, e, order, orgOrderCol;
				if (tc.debug) { sortTime = new Date(); }
				for (k = 0; k < bl; k++) {
					dynamicExp = "var sortWrapper = function(a,b) {";
					cache = tc.cache[k];
					lc = cache.normalized.length;
					for (i = 0; i < l; i++) {
						c = sortList[i][0];
						order = sortList[i][1];
						// fallback to natural sort since it is more robust
						s = /n/i.test(getCachedSortType(tc.parsers, c)) ? "Numeric" : "Text";
						s += order === 0 ? "" : "Desc";
						e = "e" + i;
						// get max column value (ignore sign)
						if (/Numeric/.test(s) && tc.strings[c]) {
							for (j = 0; j < lc; j++) {
								col = Math.abs(parseFloat(cache.normalized[j][c]));
								mx = Math.max( mx, isNaN(col) ? 0 : col );
							}
							// sort strings in numerical columns
							if (typeof(tc.string[tc.strings[c]]) === 'boolean') {
								dir = (order === 0 ? 1 : -1) * (tc.string[tc.strings[c]] ? -1 : 1);
							} else {
								dir = (tc.strings[c]) ? tc.string[tc.strings[c]] || 0 : 0;
							}
						}
						dynamicExp += "var " + e + " = sort" + s + "(table,a[" + c + "],b[" + c + "]," + c + "," + mx +  "," + dir + "); ";
						dynamicExp += "if (" + e + ") { return " + e + "; } ";
						dynamicExp += "else { ";
					}
					// if value is the same keep orignal order
					orgOrderCol = (cache.normalized && cache.normalized[0]) ? cache.normalized[0].length - 1 : 0;
					dynamicExp += "return a[" + orgOrderCol + "]-b[" + orgOrderCol + "];";
					for (i=0; i < l; i++) {
						dynamicExp += "}; ";
					}
					dynamicExp += "return 0; ";
					dynamicExp += "}; ";
					eval(dynamicExp);
					cache.normalized.sort(sortWrapper); // sort using eval expression
				}
				if (tc.debug) { benchmark("Sorting on " + sortList.toString() + " and dir " + order+ " time", sortTime); }
			}

			// Natural sort - https://github.com/overset/javascript-natural-sort
			function sortText(table, a, b, col) {
				if (a === b) { return 0; }
				var c = table.config, e = c.string[ (c.empties[col] || c.emptyTo ) ],
					r = $.tablesorter.regex, xN, xD, yN, yD, xF, yF, i, mx;
				if (a === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? -1 : 1) : -e || -1; }
				if (b === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? 1 : -1) : e || 1; }
				if (typeof c.textSorter === 'function') { return c.textSorter(a, b, table, col); }
				// chunk/tokenize
				xN = a.replace(r[0], '\0$1\0').replace(/\0$/, '').replace(/^\0/, '').split('\0');
				yN = b.replace(r[0], '\0$1\0').replace(/\0$/, '').replace(/^\0/, '').split('\0');
				// numeric, hex or date detection
				xD = parseInt(a.match(r[2])) || (xN.length !== 1 && a.match(r[1]) && Date.parse(a));
				yD = parseInt(b.match(r[2])) || (xD && b.match(r[1]) && Date.parse(b)) || null;
				// first try and sort Hex codes or Dates
				if (yD) {
					if ( xD < yD ) { return -1; }
					if ( xD > yD ) { return 1; }
				}
				mx = Math.max(xN.length, yN.length);
				// natural sorting through split numeric strings and default strings
				for (i = 0; i < mx; i++) {
					// find floats not starting with '0', string or 0 if not defined (Clint Priest)
					xF = (!(xN[i] || '').match(r[3]) && parseFloat(xN[i])) || xN[i] || 0;
					yF = (!(yN[i] || '').match(r[3]) && parseFloat(yN[i])) || yN[i] || 0;
					// handle numeric vs string comparison - number < string - (Kyle Adams)
					if (isNaN(xF) !== isNaN(yF)) { return (isNaN(xF)) ? 1 : -1; }
					// rely on string comparison if different types - i.e. '02' < 2 != '02' < '2'
					if (typeof xF !== typeof yF) {
						xF += '';
						yF += '';
					}
					if (xF < yF) { return -1; }
					if (xF > yF) { return 1; }
				}
				return 0;
			}

			function sortTextDesc(table, a, b, col) {
				if (a === b) { return 0; }
				var c = table.config, e = c.string[ (c.empties[col] || c.emptyTo ) ];
				if (a === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? -1 : 1) : e || 1; }
				if (b === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? 1 : -1) : -e || -1; }
				if (typeof c.textSorter === 'function') { return c.textSorter(b, a, table, col); }
				return sortText(table, b, a);
			}

			// return text string value by adding up ascii value
			// so the text is somewhat sorted when using a digital sort
			// this is NOT an alphanumeric sort
			function getTextValue(a, mx, d) {
				if (mx) {
					// make sure the text value is greater than the max numerical value (mx)
					var i, l = a.length, n = mx + d;
					for (i = 0; i < l; i++) {
						n += a.charCodeAt(i);
					}
					return d * n;
				}
				return 0;
			}

			function sortNumeric(table, a, b, col, mx, d) {
				if (a === b) { return 0; }
				var c = table.config, e = c.string[ (c.empties[col] || c.emptyTo ) ];
				if (a === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? -1 : 1) : -e || -1; }
				if (b === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? 1 : -1) : e || 1; }
				if (isNaN(a)) { a = getTextValue(a, mx, d); }
				if (isNaN(b)) { b = getTextValue(b, mx, d); }
				return a - b;
			}

			function sortNumericDesc(table, a, b, col, mx, d) {
				if (a === b) { return 0; }
				var c = table.config, e = c.string[ (c.empties[col] || c.emptyTo ) ];
				if (a === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? -1 : 1) : e || 1; }
				if (b === '' && e !== 0) { return (typeof(e) === 'boolean') ? (e ? 1 : -1) : -e || -1; }
				if (isNaN(a)) { a = getTextValue(a, mx, d); }
				if (isNaN(b)) { b = getTextValue(b, mx, d); }
				return b - a;
			}

			function checkResort($table, flag, callback) {
				var t = $table[0];
				if (flag !== false) {
					$table.trigger("sorton", [t.config.sortList, function(){
						$table.trigger('updateComplete');
						if (typeof callback === "function") {
							callback(t);
						}
					}]);
				} else {
					$table.trigger('updateComplete');
					if (typeof callback === "function") {
						callback(t);
					}
				}
			}

			/* public methods */
			this.construct = function(settings) {
				return this.each(function() {
					// if no thead or tbody quit.
					if (!this.tHead || this.tBodies.length === 0) { return; }
					// declare
					var $headers, $cell, $this,
						c, i, j, k, a, s, o, downTime,
						m = $.metadata;
					// new blank config object
					this.config = {};
					// merge and extend.
					c = $.extend(true, this.config, $.tablesorter.defaults, settings);

					if (c.debug) { $.data( this, 'startoveralltimer', new Date()); }
					// store common expression for speed
					$this = $(this).addClass(c.tableClass);
					// save the settings where they read
					$.data(this, "tablesorter", c);
					c.supportsTextContent = $('<span>x</span>')[0].textContent === 'x';
					// digit sort text location; keeping max+/- for backwards compatibility
					c.string = { 'max': 1, 'min': -1, 'max+': 1, 'max-': -1, 'zero': 0, 'none': 0, 'null': 0, 'top': true, 'bottom': false };
					// build headers
					$headers = buildHeaders(this);
					// try to auto detect column type, and store in tables config
					c.parsers = buildParserCache(this, $headers);
					// build the cache for the tbody cells
					// delayInit will delay building the cache until the user starts a sort
					if (!c.delayInit) { buildCache(this); }
					// fixate columns if the users supplies the fixedWidth option
					fixColumnWidth(this);
					// apply event handling to headers
					// this is to big, perhaps break it out?
					$headers.bind('mousedown.tablesorter mouseup.tablesorter', function(e, external) {
						if (e.type === 'mousedown') {
							downTime = new Date().getTime();
							return !c.cancelSelection;
						}
						// prevent resizable widget from initializing a sort (long clicks are ignored)
						if (external !== true && (new Date().getTime() - downTime > 500)) { return false; }
						if (c.delayInit && !c.cache) { buildCache($this[0]); }
						if (!this.sortDisabled) {
							// Only call sortStart if sorting is enabled.
							$this.trigger("sortStart", $this[0]);
							// store exp, for speed
							$cell = $(this);
							k = !e[c.sortMultiSortKey];
							// get current column sort order
							this.count = (this.count + 1) % (c.sortReset ? 3 : 2);
							// reset all sorts on non-current column - issue #30
							if (c.sortRestart) {
								i = this;
								$headers.each(function() {
									// only reset counts on columns that weren't just clicked on and if not included in a multisort
									if (this !== i && (k || !$(this).is('.' + c.cssDesc + ',.' + c.cssAsc))) {
										this.count = -1;
									}
								});
							}
							// get current column index
							i = this.column;
							// user only wants to sort on one column
							if (k) {
								// flush the sort list
								c.sortList = [];
								if (c.sortForce !== null) {
									a = c.sortForce;
									for (j = 0; j < a.length; j++) {
										if (a[j][0] !== i) {
											c.sortList.push(a[j]);
										}
									}
								}
								// add column to sort list
								o = this.order[this.count];
								if (o < 2) {
									c.sortList.push([i, o]);
									// add other columns if header spans across multiple
									if (this.colSpan > 1) {
										for (j = 1; j < this.colSpan; j++) {
											c.sortList.push([i+j, o]);
										}
									}
								}
								// multi column sorting
							} else {
								// the user has clicked on an already sorted column.
								if (isValueInArray(i, c.sortList)) {
									// reverse the sorting direction for all tables.
									for (j = 0; j < c.sortList.length; j++) {
										s = c.sortList[j];
										o = c.headerList[s[0]];
										if (s[0] === i) {
											s[1] = o.order[o.count];
											if (s[1] === 2) {
												c.sortList.splice(j,1);
												o.count = -1;
											}
										}
									}
								} else {
									// add column to sort list array
									o = this.order[this.count];
									if (o < 2) {
										c.sortList.push([i, o]);
										// add other columns if header spans across multiple
										if (this.colSpan > 1) {
											for (j = 1; j < this.colSpan; j++) {
												c.sortList.push([i+j, o]);
											}
										}
									}
								}
							}
							if (c.sortAppend !== null) {
								a = c.sortAppend;
								for (j = 0; j < a.length; j++) {
									if (a[j][0] !== i) {
										c.sortList.push(a[j]);
									}
								}
							}
							// sortBegin event triggered immediately before the sort
							$this.trigger("sortBegin", $this[0]);
							// set css for headers
							setHeadersCss($this[0], $headers, c.sortList);
							multisort($this[0], c.sortList);
							appendToTable($this[0]);
							// stop normal event by returning false
							return false;
						}
					});
					if (c.cancelSelection) {
						// cancel selection
						$headers.each(function() {
							this.onselectstart = function() {
								return false;
							};
						});
					}
					// apply easy methods that trigger binded events
					$this
					.bind("update", function(e, resort, callback) {
						// remove rows/elements before update
						$(c.selectorRemove, this).remove();
						// rebuild parsers.
						c.parsers = buildParserCache(this, $headers);
						// rebuild the cache map
						buildCache(this);
						checkResort($this, resort, callback);
					})
					.bind("updateCell", function(e, cell, resort, callback) {
						// get position from the dom.
						var t = this, $tb = $(this).find('tbody'), row, pos,
						// update cache - format: function(s, table, cell, cellIndex)
						tbdy = $tb.index( $(cell).closest('tbody') );
						row = $tb.eq(tbdy).find('tr').index( $(cell).closest('tr') );
						pos = [ row, cell.cellIndex];
						t.config.cache[tbdy].normalized[pos[0]][pos[1]] = c.parsers[pos[1]].format( getElementText(t, cell, pos[1]), t, cell, pos[1] );
						checkResort($this, resort, callback);
					})
					.bind("addRows", function(e, $row, resort, callback) {
						var i, rows = $row.filter('tr').length,
						dat = [], l = $row[0].cells.length, t = this,
						tbdy = $(this).find('tbody').index( $row.closest('tbody') );
						// add each row
						for (i = 0; i < rows; i++) {
							// add each cell
							for (j = 0; j < l; j++) {
								dat[j] = c.parsers[j].format( getElementText(t, $row[i].cells[j], j), t, $row[i].cells[j], j );
							}
							// add the row index to the end
							dat.push(c.cache[tbdy].row.length);
							// update cache
							c.cache[tbdy].row.push([$row[i]]);
							c.cache[tbdy].normalized.push(dat);
							dat = [];
						}
						// resort using current settings
						checkResort($this, resort, callback);
					})
					.bind("sorton", function(e, list, callback, init) {
						$(this).trigger("sortStart", this);
						var l = c.headerList.length;
						c.sortList = [];
						$.each(list, function(i,v){
							// make sure column exists
							if (v[0] < l) { c.sortList.push(list[i]); }
						});
						// update header count index
						updateHeaderSortCount(this, c.sortList);
						// set css for headers
						setHeadersCss(this, $headers, c.sortList);
						// sort the table and append it to the dom
						multisort(this, c.sortList);
						appendToTable(this, init);
						if (typeof callback === "function") {
							callback(this);
						}
					})
					.bind("appendCache", function(e, init) {
						appendToTable(this, init);
					})
					.bind("applyWidgetId", function(e, id) {
						getWidgetById(id).format(this);
					})
					.bind("applyWidgets", function(e, init) {
						// apply widgets
						applyWidget(this, init);
					})
					.bind("destroy", function(e,c){
						$.tablesorter.destroy(this, c);
					});

					// get sort list from jQuery data or metadata
					if ($this.data() && typeof $this.data().sortlist !== 'undefined') {
						c.sortList = $this.data().sortlist;
					} else if (m && ($this.metadata() && $this.metadata().sortlist)) {
						c.sortList = $this.metadata().sortlist;
					}
					// apply widget init code
					applyWidget(this, true);
					// if user has supplied a sort list to constructor.
					if (c.sortList.length > 0) {
						$this.trigger("sorton", [c.sortList, {}, !c.initWidgets]);
					} else if (c.initWidgets) {
						// apply widget format
						applyWidget(this);
					}

					// initialized
					this.hasInitialized = true;
					if (c.debug) {
						$.tablesorter.benchmark("Overall initialization time", $.data( this, 'startoveralltimer'));
					}
					$this.trigger('tablesorter-initialized', this);
					if (typeof c.initialized === 'function') { c.initialized(this); }
				});
			};

			this.destroy = function(table, removeClasses){
				var $t = $(table), c = table.config;
				// remove widget added rows
				$t.find('thead:first tr:not(.' + c.cssHeader + ')').remove();
				// remove resizer widget stuff
				$t.find('thead:first .tablesorter-resizer').remove();
				// disable tablesorter
				$t
					.unbind('update updateCell addRows sorton appendCache applyWidgetId applyWidgets destroy mouseup mouseleave')
					.find(c.selectorHeaders)
					.unbind('click mousedown mousemove mouseup')
					.removeClass(c.cssHeader + ' ' + c.cssAsc + ' ' + c.cssDesc);
				if (removeClasses !== false) {
					$t.removeClass(c.tableClass);
				}
			};

			this.addParser = function(parser) {
				var i, l = parsers.length, a = true;
				for (i = 0; i < l; i++) {
					if (parsers[i].id.toLowerCase() === parser.id.toLowerCase()) {
						a = false;
					}
				}
				if (a) {
					parsers.push(parser);
				}
			};
			this.addWidget = function(widget) {
				widgets.push(widget);
			};

			this.formatFloat = function(s, table) {
				if (typeof(s) !== 'string' || s === '') { return s; }
				if (table.config.usNumberFormat !== false) {
					// US Format - 1,234,567.89 -> 1234567.89
					s = s.replace(/,/g,'');
				} else {
					// German Format = 1.234.567,89 -> 1234567.89
					// French Format = 1 234 567,89 -> 1234567.89
					s = s.replace(/[\s|\.]/g,'').replace(/,/g,'.');
				}
				if(/^\s*\([.\d]+\)/.test(s)) {
					s = s.replace(/^\s*\(/,'-').replace(/\)/,'');
				}
				var i = parseFloat(s);
				// return the text instead of zero
				return isNaN(i) ? $.trim(s) : i;
			};
			this.isDigit = function(s) {
				// replace all unwanted chars and match.
				return (/^[\-+(]?\d+[)]?$/).test(s.replace(/[,.'\s]/g, ''));
			};

			// regex used in natural sort
			this.regex = [
				/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi, // chunk/tokenize numbers & letters
				/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/, //date
				/^0x[0-9a-f]+$/i, // hex
				/^0/ // leading zeros
			];
			// used when replacing accented characters during sorting
			this.characterEquivalents = {
				"a" : "\u00e1\u00e0\u00e2\u00e3\u00e4", // 
				"A" : "\u00c1\u00c0\u00c2\u00c3\u00c4", // 
				"c" : "\u00e7", // 
				"C" : "\u00c7", // 
				"e" : "\u00e9\u00e8\u00ea\u00eb", // 
				"E" : "\u00c9\u00c8\u00ca\u00cb", // 
				"i" : "\u00ed\u00ec\u0130\u00ee\u00ef", // 
				"I" : "\u00cd\u00cc\u0130\u00ce\u00cf", // 
				"o" : "\u00f3\u00f2\u00f4\u00f5\u00f6", // 
				"O" : "\u00d3\u00d2\u00d4\u00d5\u00d6", // 
				"S" : "\u00df", // 
				"u" : "\u00fa\u00f9\u00fb\u00fc", // 
				"U" : "\u00da\u00d9\u00db\u00dc" // 
			};
			this.replaceAccents = function(s) {
				var a, acc = '[', eq = this.characterEquivalents;
				if (!this.characterRegex) {
					this.characterRegexArray = {};
					for (a in eq) {
						if (typeof a === 'string') {
							acc += eq[a];
							this.characterRegexArray[a] = new RegExp('[' + eq[a] + ']', 'g');
						}
					}
					this.characterRegex = new RegExp(acc + ']');
				}
				if (this.characterRegex.test(s)) {
					for (a in eq) {
						if (typeof a === 'string') {
							s = s.replace( this.characterRegexArray[a], a );
						}
					}
				}
				return s;
			};

			// get sorter, string, empty, etc options for each column from
			// jQuery data, metadata, header option or header class name ("sorter-false")
			// priority = jQuery data > meta > headers option > header class name
			this.getData = function(h, ch, key) {
				var val = '', $h = $(h), m, cl;
				if (!$h.length) { return ''; }
				m = $.metadata ? $h.metadata() : false;
				cl = ' ' + ($h.attr('class') || '');
				if ($h.data() && ( typeof $h.data(key) !== 'undefined' || typeof $h.data(key.toLowerCase()) !== 'undefined') ){
					// "data-lockedOrder" is assigned to "lockedorder"; but "data-locked-order" is assigned to "lockedOrder"
					// "data-sort-initial-order" is assigned to "sortInitialOrder"
					val += $h.data(key) || $h.data(key.toLowerCase());
				} else if (m && typeof m[key] !== 'undefined') {
					val += m[key];
				} else if (ch && typeof ch[key] !== 'undefined') {
					val += ch[key];
				} else if (cl && cl.match(' ' + key + '-')) {
					// include sorter class name "sorter-text", etc
					val = cl.match( new RegExp(' ' + key + '-(\\w+)') )[1] || '';
				}
				return $.trim(val);
			};

			this.clearTableBody = function(table) {
				$(table.tBodies).filter(':not(.' + table.config.cssInfoBlock + ')').empty();
			};

		}
	})();

	// make shortcut
	var ts = $.tablesorter;

	// extend plugin scope
	$.fn.extend({
		tablesorter: ts.construct
	});

	// add default parsers
	ts.addParser({
		id: "text",
		is: function(s, table, node) {
			return true;
		},
		format: function(s, table, cell, cellIndex) {
			var c = table.config;
			s = $.trim( c.ignoreCase ? s.toLocaleLowerCase() : s );
			return c.sortLocaleCompare ? ts.replaceAccents(s) : s;
		},
		type: "text"
	});

	ts.addParser({
		id: "currency",
		is: function(s) {
			return (/^\(?[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+/).test(s); // $
		},
		format: function(s, table) {
			return ts.formatFloat(s.replace(/[^\w,. \-()]/g, ""), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "ipAddress",
		is: function(s) {
			return (/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/).test(s);
		},
		format: function(s, table) {
			var i, item, a = s.split("."),
			r = "",
			l = a.length;
			for (i = 0; i < l; i++) {
				item = a[i];
				if (item.length === 2) {
					r += "0" + item;
				} else {
					r += item;
				}
			}
			return ts.formatFloat(r, table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "url",
		is: function(s) {
			return (/^(https?|ftp|file):\/\//).test(s);
		},
		format: function(s) {
			return $.trim(s.replace(/(https?|ftp|file):\/\//, ''));
		},
		type: "text"
	});

	ts.addParser({
		id: "isoDate",
		is: function(s) {
			return (/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/).test(s);
		},
		format: function(s, table) {
			return ts.formatFloat((s !== "") ? (new Date(s.replace(/-/g, "/")).getTime() || "") : "", table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "percent",
		is: function(s) {
			return (/\d%\)?$/).test(s);
		},
		format: function(s, table) {
			return ts.formatFloat(s.replace(/%/g, ""), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "usLongDate",
		is: function(s) {
			return s.match(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/);
		},
		format: function(s, table) {
			return ts.formatFloat( (new Date(s).getTime() || ''), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "shortDate", // "mmddyyyy", "ddmmyyyy" or "yyyymmdd"
		is: function(s) {
			// testing for ####-##-#### - so it's not perfect
			return (/^(\d{2}|\d{4})[\/\-\,\.\s+]\d{2}[\/\-\.\,\s+](\d{2}|\d{4})$/).test(s);
		},
		format: function(s, table, cell, cellIndex) {
			var c = table.config, ci = c.headerList[cellIndex],
			format = ci.shortDateFormat;
			if (typeof format === 'undefined') {
				// cache header formatting so it doesn't getData for every cell in the column
				format = ci.shortDateFormat = ts.getData( ci, c.headers[cellIndex], 'dateFormat') || c.dateFormat;
			}
			s = s.replace(/\s+/g," ").replace(/[\-|\.|\,]/g, "/");
			if (format === "mmddyyyy") {
				s = s.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/, "$3/$1/$2");
			} else if (format === "ddmmyyyy") {
				s = s.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/, "$3/$2/$1");
			} else if (format === "yyyymmdd") {
				s = s.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/, "$1/$2/$3");
			}
			return ts.formatFloat( (new Date(s).getTime() || ''), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "time",
		is: function(s) {
			return (/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/).test(s);
		},
		format: function(s, table) {
			return ts.formatFloat( (new Date("2000/01/01 " + s).getTime() || ''), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "digit",
		is: function(s) {
			return ts.isDigit(s);
		},
		format: function(s, table) {
			return ts.formatFloat(s.replace(/[^\w,. \-()]/g, ""), table);
		},
		type: "numeric"
	});

	ts.addParser({
		id: "metadata",
		is: function(s) {
			return false;
		},
		format: function(s, table, cell) {
			var c = table.config,
			p = (!c.parserMetadataName) ? 'sortValue' : c.parserMetadataName;
			return $(cell).metadata()[p];
		},
		type: "numeric"
	});

	// add default widgets
	ts.addWidget({
		id: "zebra",
		format: function(table) {
			var $tb, $tv, $tr, row, even, time, k, l,
			c = table.config,
			child = new RegExp(c.cssChildRow, 'i'),
			b = $(table).children('tbody:not(.' + c.cssInfoBlock + ')'),
			css = [ "even", "odd" ];
			// maintain backwards compatibility
			css = c.widgetZebra && c.hasOwnProperty('css') ? c.widgetZebra.css :
				(c.widgetOptions && c.widgetOptions.hasOwnProperty('zebra')) ? c.widgetOptions.zebra : css;
			if (c.debug) {
				time = new Date();
			}
			for (k = 0; k < b.length; k++ ) {
				// loop through the visible rows
				$tb = $(b[k]);
				l = $tb.children('tr').length;
				if (l > 1) {
					row = 0;
					$tv = $tb.find('tr:visible');
					$tb.addClass('tablesorter-hidden');
					// revered back to using jQuery each - strangely it's the fastest method
					$tv.each(function(){
						$tr = $(this);
						// style children rows the same way the parent row was styled
						if (!child.test(this.className)) { row++; }
						even = (row % 2 === 0);
						$tr.removeClass(css[even ? 1 : 0]).addClass(css[even ? 0 : 1]);
					});
					$tb.removeClass('tablesorter-hidden');
				}
			}
			if (c.debug) {
				ts.benchmark("Applying Zebra widget", time);
			}
		}
	});

})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:macro-browser-resources', location = 'templates/extra/jira/view-in-jira.js' */
AJS.bind("add-handler.property-panel",function(b,a){AJS.log("add-handler.property-panel: panel name = "+a.name);if(a.name!="macro"){return}a.registerButtonHandler("view-in-jira",function(d,j){if(AJS.Editor.JiraConnector.servers){var s=AJS.Editor.JiraConnector.servers;var l=AJS.$(j);var g=l.attr("data-macro-default-parameter");var k=l.attr("data-macro-parameters")||"";var t=Confluence.MacroParameterSerializer.deserialize(k);var n=/=|!=|~|>|<|!~| is | in /i;var h=function(u){var i=u.indexOf("|");if(i>=0){return u.substring(0,i)}return u};var f=g||t.jqlQuery||t.key||h(k);var c=t.server;var q=t.serverId;var p=f.match(n);var m=null;for(var o=0;o<s.length;o++){if((q&&s[o].id==q)){m=s[o];break}if((c&&s[o].name==c)||(!c&&s[o].selected)){m=s[o];break}}if(m!=null){var e=(typeof m.displayUrl!=="undefined")?m.displayUrl:m.url;if(e.charAt(e.length-1)=="/"){e=e.substr(0,e.length-1)}var r=tinymce.isIE?"_blank":"confluence-goto-jiralink-"+AJS.params.pageId;if(!p){window.open(e+"/browse/"+encodeURIComponent(f),r)}else{window.open(e+"/secure/IssueNavigator.jspa?reset=true&jqlQuery="+encodeURIComponent(f),r)}}}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:macro-browser-resources', location = 'templates/extra/jira/show-summary.js' */
AJS.bind("init.rte",function(){if(!AJS.Confluence&&!AJS.Confluence.PropertyPanel&&!AJS.Confluence.PropertyPanel.Macro){AJS.logError("JIRA Issues Macro : can't register property panel init handler since AJS.Confluence.PropertyPanel.Macro is undefined");return}var a="showSummary";var f="jira";var e="jiraissues";var d="show-summary";AJS.Confluence.PropertyPanel.Macro.registerInitHandler(c,f);AJS.Confluence.PropertyPanel.Macro.registerInitHandler(c,e);function c(g,m,j){var l=AJS.$.grep(m,function(i){return i.parameterName==d})[0];if(!l){AJS.logError("JIRA Issues Macro - Show-summary : The system cannot find SummaryButton, all buttons are: ");for(var k in m){AJS.logError(m[k].text)}return}if(b(g)){var h=AJS.SummaryHelper.getParam(g,a);if(h=="false"){l.text="Show summary"}else{l.text="Hide summary"}}else{l.className+=" hidden"}}function b(g){var i=AJS.$(g);var j=i.attr("src");if(!j){return true}var h=AJS.SummaryHelper.getParam(g,"count");if(j.indexOf("confluence.extra.jira/jira-table")==-1&&h!="true"){return true}return false}});AJS.bind("add-handler.property-panel",function(b,a){if(a.name!="macro"){return}a.registerButtonHandler("show-summary",function(e,c){var d=AJS.SummaryHelper.getParam(c,"showSummary");AJS.SummaryHelper.updateMacro("jira",c,"showSummary",d=="false"?"true":"false")})});AJS.SummaryHelper=(function(){return{getCurrentParams:function(a){return Confluence.MacroParameterSerializer.deserialize(a.attr("data-macro-parameters"))},getParam:function(a,d){var c=AJS.$(a);var b=AJS.SummaryHelper.getCurrentParams(c);return b[d]},updateMacro:function(b,a,c,g){var e=AJS.$(a);AJS.Rte.getEditor().selection.select(e[0]);AJS.Rte.BookmarkManager.storeBookmark();var d=AJS.SummaryHelper.getCurrentParams(e);d[c]=g;var f={contentId:Confluence.Editor.getContentId(),macro:{name:b,params:d,defaultParameterValue:e.attr("data-macro-default-parameter")}};tinymce.confluence.MacroUtils.insertMacro(f)}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-parameter-serializer.js' */
(function ($) {

    /**
     * Singleton instance that is able to serialize/deserialize macro parameters according to the format defined in
     * the server-side java class DefaultMacroParameterSerializer.
     */
    Confluence.MacroParameterSerializer = (function ()
    {
        function escape(str) {
            return str.replace(/\\/g, "\\\\")   /* \ -> \\ */
                    .replace(/=/g, "\\=")       /* = -> \= */
                    .replace(/[|]/g, "\\|");    /* | -> \| */
        }

        function unescape(str) {
            return str.replace(/\\(.)/g, "$1");
        }

        return {
            /**
             * Serialize map of macro parameters.
             *
             * @param parameters a map of macro parameters (the key being the parameter name, and the value the parameter value)
             */
            serialize: function (parameters) {
                var result = [];

                for (paramName in parameters) {
                    result.push(escape(paramName) + "=" + escape(parameters[paramName]));
                }

                return result.join("|");
            },
            /**
             * Deserializes a string representing macro parameters into a map.
             *
             * @param parameters a string containing macro parameters (e.g. "a=b|c=d")
             */
            deserialize: function (parameters) {
                function split(str, splitChar) {
                    var buffer = [], result = [], c;
                    str = str || "";

                    for (var i = 0, l = str.length; i < l; i++) {
                        c = str[i];
                        if (c == "\\") {
                            buffer.push(c + (i + 1 != str.length ? str[++i] : ""));
                        } else if (c == splitChar) {
                            result.push(buffer.join(""));
                            buffer = [];
                        } else {
                            buffer.push(c);
                        }
                    }

                    result.push(buffer.join(""));

                    return result;
                }

                var result = {};

                $.each(split(parameters || "", "|"), function (index, macroParam) {
                    var macroParamSplit = split(macroParam, "=");

                    if (macroParamSplit.length == 2 && macroParamSplit[0]) {
                        result[unescape(macroParamSplit[0])] = unescape(macroParamSplit[1]);
                    }
                });

                return result;
            }
        };
    })();

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser.js' */
AJS.MacroBrowser = (function($) {

    /**
     * Stores overridden JS behaviour for particular macros.
     * This map contains override objects keyed by macro name.
     *
     * Use the getMacroJsOverride and setMacroJsOverride methods to interact with this map.
     */
    var jsOverrides = {};
    
    return {

    hasInit: false,
    metadataList : [],
    aliasMap: {}, // maps each alias to the corresponding macro name
    fields: {}, // stores fields for a given macro form.

    /**
     * @deprecated Since 3.3. Macros is an ambiguous name, use getMacroJsOverride and setMacroJsOverride.
     */
    Macros: jsOverrides,

    getMacroJsOverride: function (macroName) {
        return jsOverrides[macroName];
    },

    setMacroJsOverride: function (macroName, override) {
        return jsOverrides[macroName] = override;
    },
    
    
    // converts wiki markup into a macro object
    parseMacro : function(macroMarkup) {
        var macroParts = macroMarkup.match(/(\{(.+?)(?::(.*?(?=[^\\]\}).)?)?\})(?:((?:\n|.)*?)\{\2\})?/);
        var macro = {
            markup:     macroParts[0], // entire macro markup
            startTag:   macroParts[1], // full start tag
            name :      macroParts[2], // macro name
            paramStr:   macroParts[3],
            bodyMarkup: macroParts[4], // macro bodyMarkup text
            params: {}
        };
        if (macro.markup) {
            var beforeAndAfter = macroMarkup.split(macro.markup);
            macro.beforeTag = beforeAndAfter[0];
            macro.afterTag = beforeAndAfter[1];
        }
        if (macro.paramStr) {
            var paramStrs = macro.paramStr.split("|");
            $(paramStrs).each(function(i, param) {
                var index = param.indexOf("=");
                if (index < 0 && !macro.params[""]) { // unnamed parameter
                    macro.params[""] = param;
                }
                else {
                    macro.params[param.substring(0, index)] = param.substring(index+1);
                }
            });
        }
        return macro;
    },

    // Creates a div for a single macro parameter.
    makeParameterDiv : function(metadata, param, jsOverride) {
        var t = this, field;
        var type = param.type.name;

        // Plugin point - other JS files can define more specific field-builders based on macro name, param name and
        // type.
        if (jsOverride) {
            var builder = jsOverride.fields && jsOverride.fields[type];
            if (builder && typeof builder != "function") {
                // Types can be overridden for specific parameters - so the "type" object contains a "name" function.
                builder = builder[param.name];
            }
            if (typeof builder == "function") {
                field = builder.call(jsOverride, param);
            }
        }
        // If no override specific to the macro, look for general overrides specific to the parameter type.
        if (!field) {
            if (!(type in t.ParameterFields && typeof t.ParameterFields[type] == "function")) {
                type = "string";
            }
            field = t.ParameterFields[type](param);
        }

        t.fields[param.name] = field;
        var paramDiv = field.paramDiv;
        var input = field.input;

        var paramId = "macro-param-" + param.name;
        paramDiv.attr("id", "macro-param-div-" + param.name);
        input.addClass("macro-param-input").attr("id", paramId);
        if(param.hidden) {
            paramDiv.hide();
        }

        // Use param label and desc or correct fallback.
        var pluginKey = metadata.pluginKey;
        if (param.displayName == t.makeDefaultKey(pluginKey, metadata.macroName, "param", param.name, "label")) {
            param.displayName = param.name;
        }
        if (param.description == t.makeDefaultKey(pluginKey, metadata.macroName, "param", param.name, "desc")) {
            param.description = "";
        }

        var labelText = param.displayName;
        if (param.required) {
            labelText += " *";
            paramDiv.addClass("required");  // set class against div, not input, to allow styling of label if nec
        }
        $("label", paramDiv).attr("for", paramId).text(labelText);

        if (param.description) {
            paramDiv.append(Confluence.Templates.MacroBrowser.macroParameterDesc({ description: param.description }));
        }
        return paramDiv;
    },
    // Creates a div for a macro body.
    makeBodyDiv : function(macroBodyFormComponent, macroDefinition) {
        var t = AJS.MacroBrowser,
            bodyDiv = $(Confluence.Templates.MacroBrowser.macroBody()), bodyTextareaValue;

        if (macroDefinition) { // we are editing an existing macro
            bodyTextareaValue = macroDefinition.body;
        } else { // check if there is selected text in the editor
            bodyTextareaValue = t.settings.selectedText;
        }

        $("textarea", bodyDiv).val(bodyTextareaValue || "");

        if (macroBodyFormComponent.label) {
            $("label", bodyDiv).text(macroBodyFormComponent.label);
        }
        if (macroBodyFormComponent.description) {
            bodyDiv.append(Confluence.Templates.MacroBrowser.macroParameterDesc({ description: macroBodyFormComponent.description }));
        }
        if(macroBodyFormComponent.hidden) {
            bodyDiv.hide();
        }
        return bodyDiv;
    },
    // Checks and returns true if all the required macro parameters have values.
    // It disables the insert/preview buttons if false.
    processRequiredParameters: function() {
        var blankRequiredInputs = $("#macro-insert-container .macro-param-div.required .macro-param-input")
        .filter(function() {
            var val = $(this).val();
            return (val == null || val == "");
        });
        var hasAllRequiredData = (blankRequiredInputs.length == 0);
        var disabled = hasAllRequiredData ? "" : "disabled";
        var classFn = disabled ? "addClass" : "removeClass";

        AJS.$("#macro-browser-dialog button.ok").prop("disabled", disabled);
        AJS.$("#macro-browser-dialog .macro-preview-header .refresh-link").prop("disabled", disabled)[classFn]("disabled");

        return hasAllRequiredData;
    },

    /**
     * Called when a parameter field value changes.
     */
    paramChanged: function () {
        // TODO - Could be used to preview?
        AJS.MacroBrowser.processRequiredParameters();
    },

    // Loads the given macro json in the browser's insert macro page.
    loadMacroInBrowser : function(metadata, mode) {
        if (!metadata || !metadata.formDetails) {
            alert("Could not load unknown macro in the macro browser.");
            return;
        }

        var t = AJS.MacroBrowser,
            detail = metadata.formDetails,
            macroName = detail.macroName,
            jsOverride = jsOverrides[macroName],
            selectedMacro = t.settings.selectedMacro,
            placeHolderTitle = mode=="edit" ? t.editTitle : t.insertTitle,
            selectedMacroElement = tinymce.confluence.macrobrowser.editedMacroDiv;

        if (macroName){
            var jsOverride = t.getMacroJsOverride(macroName);
            if (jsOverride && typeof jsOverride.opener == "function"){
                t.close();
                jsOverride.opener({ name: macroName });
                return;
            }
        }

        $("#save-warning-span").addClass("hidden"); // gadgets may have put it in this state
        AJS.MacroBrowser.dialog.gotoPage(1).addHeader(placeHolderTitle.replace(/\{0\}/, metadata.title));

        // Update the button label
        var okButton = AJS.$("#macro-browser-dialog .dialog-button-panel .ok");
        if (mode == "edit") {
            okButton.text("Save");
        } else {
            okButton.text("Insert");
        }

        // Macro description and documentation link
        AJS.$("#macro-insert-container .macro-name").val(macroName);
        var macroDescription = metadata.extendedDescription ? metadata.extendedDescription : metadata.description;
        var macroDesc = $(Confluence.Templates.MacroBrowser.macroDescription({ description: macroDescription })),
            macroDiv = $("#macro-insert-container .macro-input-fields").html(macroDesc);
        if (detail.documentationUrl) {
            var doco = $(Confluence.Templates.MacroBrowser.macroDocLink({ href: detail.documentationUrl}));
            macroDesc.append(doco);
        } else if (!macroDesc.text()) { // remove the div and its padding style
            macroDesc.remove();
        }

        if (detail.body && detail.body.bodyType != "NONE" && (selectedMacroElement && AJS.$(selectedMacroElement).hasClass("editor-inline-macro"))) { // only enable editing of the body in the macro browser for inline body macros
            var pluginKey = metadata.pluginKey;
            if (detail.body.label == t.makeDefaultKey(pluginKey, macroName, "body", "label")) {
                detail.body.label = "";
            }
            if (detail.body.description == t.makeDefaultKey(pluginKey, macroName, "body", "desc")) {
                detail.body.description = "";
            }
            var body = t.makeBodyDiv(detail.body, t.selectedMacroDefinition);
            if (body) {
                macroDiv.append(body);
            }
        }

        // Parameters may have dependencies so all fields need to be created before values are set.
        $(detail.parameters).each(function() {
            macroDiv.append(t.makeParameterDiv(metadata, this, jsOverride));
        });

        var selectedParams = selectedMacro ? $.extend({}, selectedMacro.params) : {}; // make a copy

        // Fully-implemented macros may have JS overrides defined in a Macro object.
        if (jsOverride && typeof jsOverride.beforeParamsSet == "function") {
            selectedParams = jsOverride.beforeParamsSet(selectedParams, !selectedMacro);
        }

        $(detail.parameters).each(function() {
            var param = this,
                    value;

            if (param.name == "") {
                value = t.selectedMacroDefinition ? t.selectedMacroDefinition.defaultParameterValue : param.defaultValue;
            } else {
                value = selectedParams[param.name];
            }

            if (value != null) {
                delete selectedParams[param.name];
            } else {
                // try looking for aliased parameters
                $(param.aliases).each(function() {
                    if (selectedParams[this]) {
                        value = selectedParams[this];
                        delete selectedParams[this];
                    }
                });
            }
            if (value == null) {
                value = param.defaultValue;
            }
            if (value != null) {
                t.fields[param.name].setValue(value);
            }
        });

        // Any remaining "selectedParameters" are unknown for the current Macro details.
        t.unknownParams = selectedParams;

        // open all links in a new window
        $("a", macroDiv).click(function() {
            window.open(this.href, '_blank').focus();
            return false;
        });

        if (!$("#macro-browser-dialog:visible").length) {
            t.showBrowserDialog();
        }

        var $firstInput = $(":input:visible:first", macroDiv);
        if ($firstInput.length) {
            $firstInput.focus();
            if (!t.selectedMacroDefinition && $firstInput.val() != "") {
                // prefilled data in new macro form - select first field for easy overwrite.
                $firstInput.select();
            }
        }
        
        var macroData = {};
        $.extend(true, macroData, metadata); // clone the metadata to a new object
        
        // for safety ensure that we have a 'formDetails', containing a body.
        if (!macroData.formDetails) macroData.formDetails = {};
        if (!macroData.formDetails.body) macroData.formDetails.body = {};
        
        t.dialog.activeMetadata = macroData; // This is important to getMacroBody.

        // do we have have selected text for the macro body or are we editing an existing macro (in which case any selected text is ignored)
        if (t.settings.selectedMacro) {
            macroData.formDetails.body.content = t.settings.selectedMacro.body;
        } else if (macroData.formDetails.body.bodyType && macroData.formDetails.body.bodyType.toLowerCase() == "plain_text") {
            macroData.formDetails.body.content = t.settings.selectedText;
        } else {
            macroData.formDetails.body.content = t.settings.selectedHtml;
        }

        t.previewMacro(macroData); // load preview with default params
    },

    makeParamStringFromMap : function(paramMap) {
        var strs = [];

        if (paramMap[""]) {
            strs.push(paramMap[""]); // no named param must be first
            delete paramMap[""]; // todo find out why this delete is here
        }

        for (var param in paramMap) {
            strs.push(param + "=" + paramMap[param]);
        }

        return strs.join("|");
    },

    // Constructs the macro markup from the insert macro page
    getMacroDefinitionFromForm : function(metadata) {
        var macroName = $("#macro-insert-container .macro-name").val(),
            defaultParameterValue,
            t = AJS.MacroBrowser,
            paramMap = {},
            sharedParamMap = {},
            paramDetails = metadata.formDetails.parameters;

        // Get parameter markup
        $(paramDetails).each(function() {
            var paramInput = AJS.$("#macro-param-" + this.name);
            var paramVal = paramInput.val();
            if (paramInput.attr("type") == "checkbox") {
                paramVal = "" + paramInput.prop("checked");
            }
            if (this.shared && paramVal) {
                sharedParamMap[this.name] = paramVal;
            }
            else if (paramVal && (this.hidden || (!this.defaultValue || this.defaultValue != paramVal))) { // only add the parameter value if its not the default
                if (this.name == "") {
                    defaultParameterValue = paramVal;
                } else {
                    paramMap[this.name] = paramVal;
                }
            }
        });
        if (t.unknownParams) {
            $.each(t.unknownParams, function(key, value) {
                paramMap[key] = value; // TODO - can do this better with extend? dT
            });
        }
        var jsOverride = jsOverrides[macroName];
        if (jsOverride && typeof jsOverride.beforeParamsRetrieved == "function") {
            paramMap = jsOverride.beforeParamsRetrieved(paramMap, metadata, sharedParamMap);
        }

        var theBodyHtml = t.getMacroBody();

        var res = {
            name : macroName,
            bodyHtml : theBodyHtml,
            params : paramMap,
            defaultParameterValue: defaultParameterValue
        };

        return res;
    },

    /**
     * Returns a Map of all parameter values from the form, including the default parameter value which has a zero
     * length string as a key.
     * @param macroParamDetails meta data about each parameter in the macro
     */
    getMacroParametersFromForm : function(macro) {
        var macroParamDetails = macro.formDetails.parameters,
            macroName = $("#macro-insert-container .macro-name").val(),
            t = AJS.MacroBrowser,
            paramMap = {},
            sharedParamMap = {};

        // Get parameter markup
        $(macroParamDetails).each(function() {
            var paramInput = AJS.$("#macro-param-" + this.name);
            var paramVal = paramInput.val();
            if (paramInput.attr("type") == "checkbox") {
                paramVal = "" + paramInput.prop("checked");
            }

            if (paramVal && (this.hidden || (!this.defaultValue || this.defaultValue != paramVal))) { // only add the parameter value if its not the default
                paramMap[this.name] = paramVal;
            }

            if (this.shared && paramVal) {
                sharedParamMap[this.name] = paramVal;
            }
            /*
             if (paramInput.attr("type") == "checkbox") {
             paramVal = "" + paramInput.attr("checked");
             }
             else if (paramVal && (this.hidden || (!this.defaultValue || this.defaultValue != paramVal))) { // only add the parameter value if its not the default
             paramMap[this.name] = paramVal;
             }
             */
        });
        if (t.unknownParams) {
            $.each(t.unknownParams, function(key, value) {
                paramMap[key] = value; // TODO - can do this better with extend? dT
            });
        }
        var macroConfig = t.getMacroJsOverride(macroName);
        if (macroConfig && typeof macroConfig.beforeParamsRetrieved == "function") {
            paramMap = macroConfig.beforeParamsRetrieved(paramMap, macro, sharedParamMap);
        }

        return paramMap;
    },

    // Makes an ajax request to render the macro markup and updates the preview
    previewMacro : function(macro) {
        var t = AJS.MacroBrowser;
        $("#macro-insert-container .macro-preview").html("");
        if (!t.processRequiredParameters()) {
            AJS.log("previewMacro: missing required params");
            return;
        }
        AJS.log("previewMacro: required params ok");
        t.showPreviewWaitImage(true);

        var params = t.getMacroParametersFromForm(macro),
            defaultParameterValue;

        var macroConfig = t.getMacroJsOverride(macro.macroName);
        if (macroConfig && typeof macroConfig.updateMacroParametersForPreview == "function") {
            params = macroConfig.updateMacroParametersForPreview(params);
        }

        if (params[""])
        {
            defaultParameterValue = params[""];
            delete params[""];
        }

        var macroForServer = {
            name: macro.formDetails.macroName,
            body : t.getMacroBody(),
            params: params,
            defaultParameterValue: defaultParameterValue
        };

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: AJS.params.contextPath + "/rest/tinymce/1/macro/preview",
            data: AJS.$.toJSON({
                contentId: Confluence.getContentId(),
                macro: macroForServer
            }),
            dataType: "html",
            success: function(html) {
                AJS.MacroBrowser.showPreviewWaitImage(false);
                // Set the iframe source to an empty JS statement to avoid secure/nonsecure warnings on https, without
                // needing a back-end call.
                var src = AJS.params.staticResourceUrlPrefix + "/blank.html";
                var previewDiv = AJS.$("#macro-insert-container .macro-preview");

                previewDiv.html('<iframe src="' + src + '" frameborder="0" name="macro-browser-preview-frame" id="macro-preview-iframe"></iframe>');

                AJS.log("previewMacro: Created iframe");
                var iframe = AJS.$("#macro-insert-container .macro-preview iframe")[0];
                var doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.write(html);
                doc.close(); // for firefox
                var errorSpan = $("div.error span.error", doc);
                if (errorSpan.length) {
                    AJS.log("Error rendering macro definition : ");
                    AJS.log(macroForServer);
                }

                AJS.log("previewMacro: rendered");
            }
        });
    },
    showPreviewWaitImage : function(flag) {
        if (flag) {
            $("#macro-browser-preview-link").prop("disabled", true).addClass("disabled");
            var throbber = AJS("div").addClass("macro-loading");
            $("#macro-browser-preview").append(throbber);
            AJS.MacroBrowser.previewSpinner = Raphael.spinner(throbber[0], 60, "#666");
            AJS.MacroBrowser.previewSpinner.throbber = throbber;
        } else if (AJS.MacroBrowser.previewSpinner) {
            $("#macro-browser-preview").removeClass("macro-loading");
            AJS.MacroBrowser.previewSpinner();
            AJS.MacroBrowser.previewSpinner.throbber.remove();
            delete AJS.MacroBrowser.previewSpinner;
            $("#macro-browser-preview-link").prop("disabled", false).removeClass("disabled");
        }
    },
    // This gets called on the preview window's onload to re-adjust the height of the frame
    previewOnload: function(body) {
        var selectedMacroName = AJS.MacroBrowser.dialog.activeMetadata.macroName;
        var jsOverride = jsOverrides[selectedMacroName];
        if (jsOverride && jsOverride.postPreview) {
            jsOverride.postPreview(AJS.$("#macro-preview-iframe")[0], AJS.MacroBrowser.dialog.activeMetadata);
        }
        AJS.Editor.disableFrame(body);
        // open all links in a new window
        $(body).click(function(e) {
            if (e.target.tagName.toLowerCase() === "a") {
                var a = e.target;
                var link = $(a).attr("href");
                if (link && link.indexOf("#") != 0 && link.indexOf(window.location) == -1) {
                    window.open(link, '_blank').focus();
                }
                return false;
            }
        });
    },

    /**
     * Returns the macro metadata object for a given macro name.
     *
     * Call jsOverride.getMacroDetailsFromSelectedMacro instead of this method for macros such as "gadget" that map
     * multiple macros to a single name.
     *
     * @param macroName macro name to search metadata for
     */
    getMacroMetadata: function (macroName) {
        for (var i = 0, len = this.metadataList.length; i < len; i++) {
            var metadata = this.metadataList[i];
            if (metadata.macroName == macroName) {
                return metadata;
            }
        }
        return null;
    },

    /**
     * Called when the user either clicks the Macro Browser button or clicks Edit in a
     * macro placeholder in the RTE.
     *
     * Note that the macro browser is not initialsed/loaded until opened for the first time.
     *
     * @param settings macro browser settings include:
     *      presetMacroMetadata : the metadata for a preset macro to load into the macro browser
     *      selectedHtml : string of selected HTML from RTE when no macro selected
     *      selectedText: the text contents of the selected HTML from the RTE when no macro selected
     *      onComplete : function to call when Macro Browser's "Insert" button is pressed
     *      onCancel : function to call when Macro Browser is closed when incomplete
     *      searchText : text to filter on if opening to the "Select Macro" page, if omitted no filter is done
     *      selectedCategory: the category name that should be selected by default
     */
    open : function(settings) {
        if (!settings) {
            settings = {};
            AJS.log("No settings to open the macro browser.");
        }
        var t = AJS.MacroBrowser;
        
        // if there is a custom editor for this macro, launch that instead
        var macro = settings.selectedMacro;

        if (!macro && settings.presetMacroMetadata) {
            macro = {
                name: settings.presetMacroMetadata.macroName
            }
        }
        if (macro && macro.name){
            var jsOverride = t.getMacroJsOverride(macro.name);
            if (jsOverride && typeof jsOverride.opener == "function"){
                jsOverride.opener(macro);
                return;
            }
        }
        
        if (!t.hasInit) { // init the macro browser for the first time
            AJS.log("init macro browser");
            t.showBrowserSpinner(true);

            if ($.isEmptyObject(t.initData)) {
                // the only case where we set initData={} is when we got an error on preloading from the rest endpoint
                // try preloading again..
                AJS.log('Macro browser preload failed. Trying again...');
                t.initMacroBrowserAfterRequest = settings;
                t.preLoadMacro();
                return;
            }
            else if (t.initData) { // preloading completed
                t.initBrowser();
            }
            else { // ajax request not returned yet, set a flag to init the browser later
                AJS.log('Waiting for macro browser preloading...');
                t.initMacroBrowserAfterRequest = settings;
                return;
            }
        }
        t.openMacroBrowser(settings);

    },

    // This method must be called after the dialog has been initialised
    openMacroBrowser: function(settings) {
        var t = AJS.MacroBrowser;
        t.settings = settings;
        t.selectedMacroDefinition = settings.selectedMacro;
        var selectedMacroName = (t.selectedMacroDefinition && t.selectedMacroDefinition.name) || settings.presetMacroName;

        // Preset macro overrides everything, just use it if present
        if (settings.presetMacroName)
            settings.presetMacroMetadata = t.getMacroMetadata(settings.presetMacroName);

        var metadata = settings.presetMacroMetadata;
        if (!metadata) {
            var selectedMacro = settings.selectedMacro;
            if (selectedMacro) {
                // Editing an existing macro - find metadata for it
                var selectedMacroName = selectedMacro.name.toLowerCase();
                selectedMacroName = t.aliasMap[selectedMacroName] || selectedMacroName;

                var jsOverride = jsOverrides[selectedMacroName];
                if (jsOverride) {
                    if (typeof jsOverride.updateSelectedMacro == "function") {
                        jsOverride.updateSelectedMacro(selectedMacro);
                    }
                    // Could be a gadget (or other) macro that has a custom metadata lookup function
                    var macroDetailsFunction = jsOverride.getMacroDetailsFromSelectedMacro;
                    if (macroDetailsFunction) {
                        metadata = macroDetailsFunction(t.metadataList, selectedMacro);
                    }
                }
                if (!metadata) {
                    metadata = AJS.MacroBrowser.getMacroMetadata(selectedMacroName);
                }
            }
        }

        if (metadata) {
            AJS.log("Open macro browser to edit macro: "+ metadata.macroName);
            $("#macro-browser-dialog button.back").hide();
            t.replicateSelectMacro(metadata, settings.mode || "edit");
        }
        else if (selectedMacroName && !metadata) {
            // the user chose to edit a macro but no metadata was available
            $("#macro-browser-dialog button.back").show();
            t.dialog.overrideLastTab();
            t.dialog.gotoPage(2);
            t.showBrowserDialog();
        } else {
            $("#macro-browser-dialog button.back").show();
            if(settings.selectedCategory) {
                var categoryIndex = $('#select-macro-page .dialog-page-menu button').index($('#category-button-' + settings.selectedCategory));
                if(categoryIndex < 0) {
                    categoryIndex = 0;
                }
                t.dialog.overrideLastTab();
                t.dialog.gotoPanel(0, categoryIndex);
            }
            else {
                t.dialog.gotoPage(0);
            }
            t.showBrowserDialog();

            // If non-blank searchText has been passed in, filter on it
            t.searcher.focusAndSearch(settings.searchText);
        }
    },
    showBrowserDialog: function() {
        AJS.MacroBrowser.dialog.show();
        AJS.MacroBrowser.showBrowserSpinner(false);
    },
    // Called when dialog is closed by Inserting/Saving.
    complete : function (dialog) {
        if (!$("#macro-browser-dialog .dialog-button-panel .ok").is(":visible:not(:disabled)")) {
            // If triggered by enter key but not ready to complete, ignore.
            return;
        }
        var t = AJS.MacroBrowser;
        var metadata = t.dialog.activeMetadata;
        var jsOverride = jsOverrides[metadata.macroName];
        if (jsOverride && jsOverride.manipulateMarkup) {
            jsOverride.manipulateMarkup(metadata);
        }

        var macroDefinition = t.getMacroDefinitionFromForm(metadata);

        t.close();
        if (t.settings.onComplete) {
            t.settings.onComplete(macroDefinition);
        }
    },
    // Called when dialog is closed by various cancel buttons or via Esc key.
    cancel : function() {
        var t = AJS.MacroBrowser;
        t.close();
        if (typeof t.settings.onCancel == "function") {
            t.settings.onCancel();
        }
        return false;
    },
    close : function() {
        var t = this;
        t.unknownParams = {};
        t.fields = {};
        t.dialog.hide();
    },
    // Replicates the user behaviour of selecting a macro and displaying the insert macro page
    replicateSelectMacro : function (metadata, mode) {
        AJS.MacroBrowser.loadMacroInBrowser(metadata, mode);
    },
    makeDefaultKey : function() {
        return $.makeArray(arguments).join(".");
    },
    showBrowserSpinner: function(flag) {
        var elm = AJS.Editor.inRichTextMode() ? ".defaultSkin span.mce_conf_macro_browser" : "#editor-insert-macro";
        if (flag) {
            $(elm).addClass("wait");
        } else {
            $(elm).removeClass("wait");
        }
    },
    // Loads the categories and macros into the dialog
    initBrowser : function() {
        var t = AJS.MacroBrowser,
            data = t.initData;
        if (!data.categories || !AJS.MacroBrowser.metadataList.length) {
            alert("There has been an error loading the macro browser. Please try again or see your system administrator.");
            AJS.MacroBrowser.showBrowserSpinner(false);
            return false;
        }
        var startTime = new Date();
        var dialog = t.dialog = AJS.ConfluenceDialog({
            width : 865,
            height: 530,
            id: "macro-browser-dialog",
            onSubmit: t.complete,
            onCancel: t.cancel
        });

        // Set an id on the "Select Macro Page"
        dialog.getPage(0).element.attr('id','select-macro-page');

        dialog.addHeader(data.title);
        t.editTitle = data.editTitle;
        t.insertTitle = data.insertTitle;

        // sort the categories and macros
        // Skip the hidden category unless option is set, in which case append it to end of array.
        var hiddenCat;
        data.categories = $.map(data.categories, function (cat) {
            if (cat.name == "hidden-macros") {
                hiddenCat = cat;
                return null;
            }
            return cat;
        });
        data.categories.sort(function(one, two) {
            return (one.displayName.toLowerCase() > two.displayName.toLowerCase() ? 1 : -1);
        });
        if (hiddenCat && AJS.params.showHiddenUserMacros) {
            data.categories.push(hiddenCat);
        }

        var makeCategoryList = function(id) {
            return $(Confluence.Templates.MacroBrowser.macroSummaryList({ category: id }));
        };
        var makeMacroSummary = function(metadata) {
            var macroDiv = $(Confluence.Templates.MacroBrowser.macroSummaryItem())
            .click(function(e) {
                AJS.MacroBrowser.loadMacroInBrowser(metadata, "insert");
            });
            if (metadata.icon) {
                var iconLocation = (metadata.icon.relative ? AJS.params.staticResourceUrlPrefix : "") + metadata.icon.location;
                if(!metadata.icon.relative && AJS.$.browser.msie && !window.location.href.indexOf("https") && iconLocation.indexOf("https")) {
                    macroDiv.prepend("<span class='macro-icon-holder icon-" + metadata.macroName + "'></span>");
                }
                else {
                    macroDiv.prepend("<img src='" +  iconLocation + "' alt='icon' " +
                        "width='" + metadata.icon.width + "' height='" + metadata.icon.height + "' title='" + metadata.title + "'/>");
                }
            } else {
                macroDiv.prepend("<span class='macro-icon-holder icon-" + metadata.macroName + "'></span>");
            }

            $(".macro-title", macroDiv).text(metadata.title);
            $(".macro-desc", macroDiv).prepend(metadata.description);
            if (metadata.macroName == "gadget") {
                var url;
                for (var i = 0; i < metadata.formDetails.parameters.length; i++) {
                    if (metadata.formDetails.parameters[i].name == "url") {
                        url = encodeURI(metadata.formDetails.parameters[i].defaultValue);
                        break;
                    }
                }
                if (url) {
                    if (!url.match("^https?://.*")) {
                        url = AJS.params.contextPath + "/" + url;
                    }
                    $(".macro-title", macroDiv).after(Confluence.Templates.MacroBrowser.gadgetLink({url: url}));
                }
            }
            return macroDiv;
        };
        var categoryDivs = { all: makeCategoryList("all") },
            i, ii, j, jj;

        // Content on the right, setup macro list items
        for (i = 0, ii = t.metadataList.length; i<ii; i++) {
            var metadata = t.metadataList[i];
            if (metadata.hidden) {
                if (t.isHiddenMacroShown(metadata)) {
                    metadata.categories.push("hidden-macros");
                } else {
                    continue;
                }
            }

            var macroDiv = makeMacroSummary(metadata).attr("id", metadata.id);
            categoryDivs.all.append(macroDiv);

            for (j = 0, jj = metadata.categories.length; j < jj; j++) {
                var catKey = metadata.categories[j];
                categoryDivs[catKey] = categoryDivs[catKey] || makeCategoryList(catKey);
                categoryDivs[catKey].append(makeMacroSummary(metadata).attr("id", catKey + "-" + metadata.id));
            }
        }

        // menu on the left, setup category panels
        dialog.addPanel("All", categoryDivs["all"], "all", "category-button-all");
        for (i = 0, ii = data.categories.length; i < ii; i++) {
            var category = data.categories[i];
            dialog.addPanel(category.displayName, categoryDivs[category.name] || makeCategoryList(category.name), category.name, "category-button-" + category.name)
              .getPanel(i).setPadding(0); // remove the default dialog padding
        }
        dialog.addCancel("Cancel", AJS.MacroBrowser.cancel);
        // CONFDEV-12853: Add help link via prepend() instead of append() to prevent FF display issue
        dialog.popup.element.find(".dialog-title").prepend(Confluence.Templates.MacroBrowser.helpLink());
        if (AJS.Meta.get('confluence-flavour') == 'VANILLA') {
            dialog.addHelpText("<a href='{0}' id='marketplace-link'><span class='icon icon-marketplace'/>{1}</a>", [
                AJS.params.contextPath + "/plugins/servlet/upm/marketplace/featured?category=Macros&source=macro_browser",
                "Find more macros..."
            ]);
        } else {
            dialog.addHelpText("Hint: type \"\u003cstrong>{\u003c\/strong>\" in the Editor to insert macros on the page.");
        }

        // prepare insert macro page
        var insertMacroBody = AJS.$(Confluence.Templates.MacroBrowser.insertMacroPanel());

        $("#macro-browser-preview-link", insertMacroBody).click(function(e) {
            AJS.MacroBrowser.previewMacro(dialog.activeMetadata);
            return AJS.stopEvent(e);
        });

        dialog.addPage()
        .addPanel("X", insertMacroBody, "macro-input-panel")
        .addLink("Select Macro", function(dialog) {
            dialog.prevPage();
            searcher.focus();
        }, "dialog-back-link")
        .addButton("insert.name", function () { AJS.MacroBrowser.complete(); }, "ok")
        .addCancel("Cancel", function () { return AJS.MacroBrowser.cancel(); })
        .getPanel(0).setPadding(0); // remove the default dialog padding
        $("#macro-browser-dialog .dialog-button-panel .ok").before("<span id='save-warning-span' class='hidden'/>");

        var filterSearch = function($items, text) {
            var ids = null;
            if (text != '') {
                if (dialog.getCurrentPanel() != dialog.getPanel(0)) {
                    dialog.gotoPanel(0);
                }
                var filteredSummaries = t.searchSummaries(text);
                ids = {};
                $.each(filteredSummaries, function() {
                    ids[this.id] = this;
                });
            }
            $items.each(function() {
                (!ids || this.id in ids) ? $(this).show() : $(this).hide();
            });
        };

        // add search box
        var searcher = t.searcher = Confluence.DomFilterField({
            items: '#macro-browser-dialog .dialog-panel-body #category-all .macro-list-item',
            formId: 'macro-browser-search-form',
            inputId: 'macro-browser-search',
            searcher: filterSearch,
            submitCallback: function ($visibleItems, searchText) {
                if (searchText != '' && $visibleItems.length == 1) {
                    // Only one macro found with search - select it.
                    $visibleItems.click();
                }
            }
        });

        dialog.page[0].header.append(searcher.form);
        dialog.page[0].ontabchange = function(newPanel, oldPanel) {
            if (newPanel != dialog.getPanel(0, 0)) {
                // Moving away from the "All" macro panel; reset the search value if present
                searcher.reset();
            }
        };

        // Create the missing meta-data page
        var missingMetadataBody = AJS.$(Confluence.Templates.MacroBrowser.missingUserMacroMetadataPanel({ showAdminMessage: AJS.Meta.getBoolean("is-admin") }));
        dialog.addPage()
        .addPanel("No Macro Metadata", missingMetadataBody, "missing-metadata-panel")
        .addLink("Back", function(dialog) {
            dialog.gotoPage(0);
            searcher.focus();
        }, "dialog-back-link")
        .addCancel("Cancel", function () { return AJS.MacroBrowser.cancel(); });
        dialog.gotoPage(2);
        dialog.addHeader("No Macro Metadata");

        dialog.gotoPanel(0, 0);
        dialog.ready = true;
        t.hasInit = true;

        var time = (new Date()).getTime() - startTime.getTime();
        AJS.log("loading macro browser took " + time + "ms");
        return true;
    },

    /**
     * Called when the macro data is returned from the back-end, loads the macro metadata into a JS model for the
     * browser (and autocomplete) to use.
     *
     * @param macros the macros array from the browse-macros.action JSON response
     */
    loadModel: function (macros) {
        if (!macros) {
            AJS.log("AJS.MacroBrowser.loadModel - no macro data, aborting");
            return;
        }
        AJS.log("AJS.MacroBrowser.loadModel - starting");

        var t = AJS.MacroBrowser;
        t.metadataList = [];
        t.aliasMap = {};

        // Clean up unset titles and descriptions before sorting
        for (var i = 0, ii = macros.length; i < ii; i++) {
            var metadata = macros[i];

            if (metadata.aliases) {
                for (var j = 0, jl = metadata.aliases.length; j < jl; j++) {
                    metadata.aliases[j] = metadata.aliases[j].toLowerCase();
                    t.aliasMap[metadata.aliases[j]] = metadata.macroName.toLowerCase();
                }
            }

            if (metadata.title == t.makeDefaultKey(metadata.pluginKey, metadata.macroName, "label")) {
                metadata.title = metadata.macroName.charAt(0).toUpperCase() + metadata.macroName.substring(1).replace(/-/g, ' ');
            }
            if (metadata.description == t.makeDefaultKey(metadata.pluginKey, metadata.macroName, "desc")) {
                metadata.description = "";
            }
            metadata.id = "macro-" + (metadata.alternateId || metadata.macroName);

            // Store two copies of keywords - for Macro Browser and Macro Autocomplete searching
            var keywordsArr = [metadata.macroName, metadata.title].concat(metadata.aliases);
            metadata.keywordsNoDesc = keywordsArr.join(',');

            var desc = (metadata.description && metadata.description.replace(/,/g, ' ')) || "";
            keywordsArr.push(desc);
            metadata.keywords = keywordsArr.join(',');

            t.metadataList.push(metadata);
        }
        t.metadataList.sort(function(one, two) { return (one.title.toLowerCase() > two.title.toLowerCase() ? 1 : -1); });
        AJS.log("AJS.MacroBrowser.loadModel - complete, " + t.metadataList.length + " macros loaded");
    },

    /**
     * Search macro name, title and description for the given text.
     * @param text (required) text to search on
     * @param options options to pass to the AJS.filterBySearch method
     * @return array of macro summaries matching the search text.
     */
    searchSummaries: function (text, options) {
        options = $.extend({
            splitRegex: /[\s\-]+/
        }, options);
        return AJS.filterBySearch(this.metadataList, text, options);
    },

    /**
     * Convenience method to return the macro body. This will be one of -
     * - the text in the body textarea on the macro browser dialog
     * - currently selected text in the editor
     * - the current body if editing an existing macro (disregarding any editor selection)
     * - empty String if neither previous case applies.
     */
    getMacroBody: function () {
        var t = AJS.MacroBrowser;
        var body = "";
        if (AJS.$("#macro-insert-container .macro-body-div textarea").length) {
            body = AJS.$("#macro-insert-container .macro-body-div textarea").val();
        } else if (t.selectedMacroDefinition) {
            if (t.selectedMacroDefinition.body) {
                body = t.selectedMacroDefinition.body;
            }
        } else if (t.dialog.activeMetadata) {
            body = t.dialog.activeMetadata.formDetails.body.content; // this is encoded as appropriate for the current macro
        }

        return body;
    },

    /**
     * Checks if a normally-hidden macro should be displayed in the UI or not.
     * @param macro - a macro summary
     */
    isHiddenMacroShown : function (macro) {
        return AJS.params.showHiddenUserMacros && macro.pluginKey == "_-user-macro-_";
    },

    /**
     * Returns true if the metadata indicates that there are required parameters for this macro
     */
    hasRequiredParameters : function (macroMetadata) {
        var parameters = macroMetadata.formDetails.parameters;

        for (var i = 0, ii = parameters.length; i < ii; i++)
            if (parameters[i].required) return true;

        return false;
    },

    /**
     * Provide a CSV of macroNames to include only these macros. Has to be called before preLoadMacro() runs.
     *
     * E.g. "code, cheese"
     *
     * @param whitelist
     */
    setWhitelist: function (whitelist) {
        AJS.MacroBrowser.whitelist = whitelist;
    },

   /**
    * Preloads required data (list of macros, etc) to be able to create the macro browser dialog quickly when necessary.
    */
    preLoadMacro : function () {
        var t = AJS.MacroBrowser;
        var data = t.whitelist ? { whitelist: t.whitelist } : {};
        t.initData = null; // flag async request started
        $.ajax({
            type: "GET",
            timeout: 30000, // mitigate CONF-29810
            dataType: "json",
            url: AJS.params.contextPath + "/plugins/macrobrowser/browse-macros.action",
            data: data,
            success: function(data) {
                t.initData = data;
                t.loadModel(data.macros);
                if (t.initMacroBrowserAfterRequest) { // we have an existing "open browser" command in the queue waiting for the preloading operation to complete
                    t.initBrowser();
                    t.openMacroBrowser(t.initMacroBrowserAfterRequest);
                }
            },
            error: function(e) {
                AJS.log("Error requesting macro browser metadata:");
                AJS.log(e);
                t.initData = {}; // empty initData is used as an error flag in the "open" method
            }
        });
    }

};})(AJS.$);

AJS.toInit(function($) {
    // bind the function to be run when the macro browser preview frame is loaded
    $(window).bind("render-content-loaded", function(e, body) {
        var iframe = $("#macro-preview-iframe");
        if (iframe.contents().find("body")[0] == body) {
            AJS.MacroBrowser.previewOnload(body);
        }
    });

    AJS.MacroBrowser.preLoadMacro();
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-fields.js' */
/**
 * Returns an object wrapper for a parameter-div jQuery object and the input in
 * that div that stores the internal parameter value (as opposed to the display
 * field, although they may be the same).
 */
AJS.MacroBrowser.Field = function (paramDiv, input, options) {
    options = options || {};

    var setValue = options.setValue || function (value) {
        input.val(value);
    };

    var getValue = options.getValue || function () {
        return input.val();
    };
    
    input.change(options.onchange || AJS.MacroBrowser.paramChanged);

    return {
        paramDiv : paramDiv,
        input : input,
        setValue : setValue,
        getValue : getValue
    };
};

/**
 * ParameterFields defines default "type" logic for fields in the Macro
 * Browser's Insert/Edit Macro form.
 * 
 * Each method in this object corresponds to a parameter type as defined in the
 * MacroParameterType enum.
 */
AJS.MacroBrowser.ParameterFields = (function ($) { 

   /**
     * Update the dependencies of the identified parameter with the supplied value.
     */
    var updateDependencies = function (paramName, dependencies, value) {
        if (dependencies && dependencies.length) {
            for ( var i = 0, length = dependencies.length; i < length; i++) {
                AJS.MacroBrowser.fields[dependencies[i]] && AJS.MacroBrowser.fields[dependencies[i]].dependencyUpdated(paramName, value);
            }
        }
    };

    return {
        "updateDependencies" : updateDependencies,
    	
        "username" : function(param, options) {
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields.string(param, options);
            }
        
            options = options || {};

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = AJS.$("input[type='text']", paramDiv);
            input.addClass("autocomplete-user").attr("data-none-message", "Not Found");

            // CONF-16859 - check if mandatory params are now filled
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            input.bind("selected.autocomplete-content", function(e, data) {
                if (options.onselect) {
                    options.onselect(data.selection);
                }
                else if(options.setValue) {
                    options.setValue(data.content.username);
                }
                else {
                    updateDependencies(param.name, options.dependencies, input.val());
                    (typeof options.onchange == "function") && options.onchange.apply(input);
                }
            });
            AJS.Confluence.Binder.autocompleteUserOrGroup(paramDiv);

            return AJS.MacroBrowser.Field(paramDiv, input);
        },        
        
        "spacekey" : function(param, options) {
            // for multple space keys just use a String field at the moment
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            options = options || {};

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = AJS.$("input[type='text']", paramDiv);
            input.addClass("autocomplete-space")
                 .attr("data-template", "{key}")
                 .attr("data-none-message", "Not Found");

            // CONF-16859 - check if mandatory params are now filled
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }
        
            input.bind("selected.autocomplete-content", function(e, data) {
              if (options.onselect) {
                  options.onselect(data.selection);
              }
              else if(options.setValue) {
                  options.setValue(data.content.key);
              }
              else {
                  updateDependencies(param.name, options.dependencies, input.val());
                  (typeof options.onchange == "function") && options.onchange.apply(input);
              }
            });
            AJS.Confluence.Binder.autocompleteSpace(paramDiv);

            return AJS.MacroBrowser.Field(paramDiv, input);
        },

        "attachment" : function (param, options) {
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param,
                        options);
            }

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterSelect());
            var input = AJS.$("select", paramDiv);

            options = options || {};
            options.setValue = options.setValue || function(value) {
                // check if the value being set is in the list of options
                // if not then add it as a new option - with an indication that
                // it is not a valid choice for this select box
                var foundOption = false;
                //Don't use a JQuery filter of "[value=" +value+"]" since value is un-escaped user-data
                input.find("option").each(function() {
                    if (this.value == value) {
                        foundOption = true;
                        return false;
                    }
                });

                if (!foundOption) {
                    input.append(AJS.$("<option/>").attr("value", value).text(value + " (" + "Not Found" + ")"));
                    input.tempValue = value;
                } else {
                    delete input.tempValue;
                }
                
                // CONF-15415 : Spurious error thrown in IE6
                try {
                    input.val(value);
                } catch (err) {
                    AJS.log(err);
                }

                input.change();
            };

            var field = AJS.MacroBrowser.Field(paramDiv, input, options);
            field.updateDependencies = updateDependencies;
            field.getData = function(req) {
            	if (!((req.title && req.spaceKey) || req.pageId || req.draftId)) {
            		AJS.log("Not enough parameters to send attachmentsearch request");
                    return;	// not enough content info to get attachments
            	}

                var currentValue = input.tempValue || input.val();

                if (options.fileTypes) {
                    req.fileTypes = options.fileTypes;
                }
                
                var url = AJS.params.contextPath + (req.draftId ? "/json/draftattachmentsearch.action" : "/json/attachmentsearch.action");
                $.getJSON(url, req, function(data) {
                    if (data.error) {
                        return;
                    }

                    $("option", input).remove();
                    var attachments = data.attachments;

                    // if there are no attachments on the page then populate the options with
                    // a message stating this
                    if (!attachments || !attachments.length) {
                        // AJS.log("attachment - No attachments so creating message. tempValue = " + input.tempValue);
                        input.append(AJS.$("<option/>").attr("value", "").html("No appropriate attachments"));

                        if (input.tempValue) {
                            options.setValue(input.tempValue);
                        }
                    } else {
                        for (var i = 0, length = attachments.length; i < length; i++) {
                            input.append(AJS.$("<option/>").attr("value", attachments[i].name).text(attachments[i].name));
                        }

                        currentValue = currentValue || input.tempValue;
                        options.setValue(currentValue || attachments[0].name);
                    }
                    //in IE9 only the first character of the selected option is shown, force a redraw
                    input.attr("style", "");
                });
            };

            return field;
        },

        "confluence-content" : function (param, options) {
    
            // If multiple confluence-content field then only return a String at the moment
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            options = options || {};
            param.options = param.options || {};

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter()),
                input = AJS.$("input[type='text']", paramDiv)
                        .attr("data-none-message", "Not Found")
                        .attr("data-template", ""); // no template as some logic is required to build the value

            // CONF-16859 - check if mandatory params are filled on keypresses in this field.
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            // CONF-15438 - update any dependencies of the field when it is changed
            options.onchange = options.onchange || function (e) {
                var val = input.val();
                updateDependencies(param.name, options.dependencies, val);
            };
            options.setValue = options.setValue || function (value) {
                input.val(value);
                (typeof options.onchange == "function") && options.onchange.apply(input);
            };
            
            input.bind("selected.autocomplete-content", function(e, data) {
                var datePathPrefix = "";
                if (param.options.includeDatePath == "true" && data.content.type == "blogpost") {
                    var splitDate = data.content.createdDate.date.split("-");
                    datePathPrefix = "/" + splitDate[0] + "/" + splitDate[1]  + "/" + splitDate[2].substring(0, 2) + "/";
                }

                var spaceKey = data.content.space && data.content.space.key,
                    markup = ((spaceKey && spaceKey != AJS.Meta.get('space-key')) ? (spaceKey + ":") : "") + datePathPrefix + data.content.title;

                input.val(markup);

                if (options.onselect) {
                  options.onselect(data.selection);
                }
                else {
                  options.setValue(markup, input);
                }
            });

            if (param.options.spaceKey) {
                if (param.options.spaceKey.toLowerCase() == "@self") {
                    param.options.spaceKey = AJS.Meta.get('space-key');
                }
                input.attr("data-spacekey", param.options.spaceKey);
            }

            var type = param.options.type;
            if (typeof type == "string") {
                if(type == "page") {
                    input.addClass("autocomplete-page");
                    AJS.Confluence.Binder.autocompletePage(paramDiv);
                }
                else if (type == "blogpost") {
                    input.addClass("autocomplete-blogpost");
                    AJS.Confluence.Binder.autocompleteBlogpost(paramDiv);
                }
                else if (type == "attachment") {
                    input.addClass("autocomplete-attachment");
                    AJS.Confluence.Binder.autocompleteAttachment(paramDiv);
                }
            }
            else { // default to pages and blogs
                input.addClass("autocomplete-confluence-content");
                AJS.Confluence.Binder.autocompleteConfluenceContent(paramDiv);
            }

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },
    
        /**
         * Default field for all unknown types.
         */
        "string" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = $("input", paramDiv);

            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        /**
         * A checkbox - assumes not true means false, not null.
         */
        "boolean" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterBoolean());
            var input = $("input", paramDiv);

            options = options || {};
            options.setValue = options.setValue || function (value) {
                if (/true/i.test(value) ||
                    (/true/i.test(param.defaultValue) && !(/false/i).test(value))) {
                    input.prop("checked", true);
                }
            };

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        "enum" : function (param, options) {
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterSelect());
            var input = $("select", paramDiv);
            if (!(param.required || param.defaultValue)) {
                input.append(AJS.$("<option/>").attr("value", ""));
            }
            $(param.enumValues).each(function() {
                input.append(AJS.$("<option/>").attr("value", this).html("" + this));
            });

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        /**
         * Like a "string" field but hidden.
         */
        "_hidden" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterHidden()).hide();
            var input = $("input", paramDiv);

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        }
    
    };
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-smartfields.js' */
/**
 * Activates smart fields support for a pair of Page / Attachment fields in a macro.
 * 
 * Expects the following macro parameters for the "macroName" to be defined:
 * 
 *   <parameter name="page" type="confluence-content"/>
 *   <parameter name="name" type="attachment" required="true">
 *     <alias name=""/>
 *   </parameter>
 * 
 * Usage in macro specific js file:
 *   AJS.MacroBrowser.activateAttachmentsFromPageSmartFields("multimedia", ["swf","avi"]);
 *
 * Note this function uses AJS.MacroBrowser.setMacroJsOverride for the specified macro, so
 * this will replace any existing override previous set, or this functionality will stop working
 * if an override is set after calling activateSmartFieldsAttachmentsOnPage. 
 *
 * @param macroName the name of the macro to add page/attachment smart field support to
 * @param fileTypes an array containing the file extensions to be shown
 */
(function($) {

    var MacroJsOverrideForSmartFields = function(fileTypes) {
        this.fileTypes = fileTypes;
    };

    MacroJsOverrideForSmartFields.prototype.beforeParamsSet = function(params, inserting) {
        // If the macro has no parameters set for the page, date or space set the page to the one
        // currently being edited. See beforeParamsRetrieved for the reverse.
        if (!params.page && !(params.date || params.space)) {
            if (AJS.params.contentType == "page" || AJS.params.contentType == "blogpost") {
                params.page = AJS.Editor.getCurrentTitle();
            } else if (AJS.params.contentType == "comment") {
                params.page = AJS.params.pageTitle;
            }
        }
        if (params.date) {
            // will be in format mm/dd/yyyy, should be yyyy/mm/dd
            var parts = params.date.split("/");
            params.page = ["", parts[2], parts[0], parts[1], params.page].join("/");
        }
        if (params.space) {
            params.page = params.space + ":" + params.page;
        }
        return params;
    };

    MacroJsOverrideForSmartFields.prototype.beforeParamsRetrieved = function(params) {
        if (params.page) {
            var spacePageArr = params.page.split(":");
            if (spacePageArr.length > 1) {
                params.space = spacePageArr[0];
                params.page = spacePageArr[1];
            }
            var parts = params.page.split("/");
            if (parts.length > 1) {
                // will be in format yyyy/mm/dd/Page, should be mm/dd/yyyy
                params.date = [parts[2], parts[3], parts[1]].join("/");
                params.page = parts[4];
            }
            // If the page specified is the current page being edited, remove the page title parameter.
            // Even if a user entered it manually it is good to get rid of it as the macro parameters don't handle page renames
            // See beforeParamsSet for the reverse.
            if (((AJS.params.contentType == "page" || AJS.params.contentType == "blogpost") && params.page == AJS.Editor.getCurrentTitle()) ||
                 (AJS.params.contentType == "comment" && params.page == AJS.params.pageTitle)) {
                delete params.page;
            }
        }
        return params;
    };

    MacroJsOverrideForSmartFields.prototype.fields = {
        "attachment" : function(param) {

            /**
             *  Assumes value in form SPACEKEY:(/yyyy/mm/dd/)Title
             */
            var parsePageLink = function(pageLink) {
                var o = {};

                var bits = pageLink.split(":", 2);
                o.spaceKey = ((bits.length == 2) && bits[0]) || AJS.Meta.get('space-key');
                o.title = bits[bits.length - 1];

                if (o.title.indexOf("/") == 0) {
                    // blogpost
                    o.postingDay = o.title.substr(1, 10);
                    o.title = o.title.substr(12);
                }

                // If the page title is the same as the page being edited, leave it blank and use the content Id.
                if (o.title == AJS.Editor.getCurrentTitle()) {
                    o.title = "";
                }
                if (!o.title) {
                    if (AJS.params.newPage) {
                        o.draftId = AJS.Meta.get('content-id');
                    } else {
                        o.pageId = AJS.params.pageId;
                    }
                }
                return o;
            };

            var attachmentOptions = {
                fileTypes : this.fileTypes
            }

            var field = AJS.MacroBrowser.ParameterFields["attachment"](param, attachmentOptions);

            field.dependencyUpdated = function(dependencyName, dependencyValue) {
                AJS.log("attachment:dependencyUpdated called: " + dependencyName + ", " + dependencyValue);

                var req = parsePageLink(dependencyValue);
                this.getData(req);
            };
            return field;
        },

        "confluence-content" : function(param) {
            var options = {
                dependencies : ["name"]
            };

            return AJS.MacroBrowser.ParameterFields["confluence-content"](param, options);
        }
    };

    AJS.MacroBrowser.activateSmartFieldsAttachmentsOnPage = function(macroName, fileTypes) {
        AJS.MacroBrowser.setMacroJsOverride(macroName, new MacroJsOverrideForSmartFields(fileTypes));
    }

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'soy/macro-browser.soy' */
// This file was automatically generated from macro-browser.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.MacroBrowser == 'undefined') { Confluence.Templates.MacroBrowser = {}; }


Confluence.Templates.MacroBrowser.macroSummaryList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol id="category-', soy.$$escapeHtml(opt_data.category), '" class="macro-list"></ol>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroSummaryItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="macro-list-item"><h4 class="macro-title"></h4><div class="macro-desc"> </div></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroDescription = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-desc">', opt_data.description, ' </div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.insertMacroPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="macro-insert-container"><input class="macro-name" type="hidden"/><div class="macro-preview-container dialog-panel"><div class="macro-preview-header"><ul class="macro-preview-links"><li><a id="macro-browser-preview-link" class="refresh-link icon icon-refresh" href="#">', soy.$$escapeHtml("Refresh"), '</a></li></ul><span>', soy.$$escapeHtml("Preview"), '</span></div><div id="macro-browser-preview" class="macro-preview"></div></div><div class="macro-input-fields dialog-panel"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.missingUserMacroMetadataPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="macro-missing-metadata-container"><p>', "There is no metadata configured for this macro which means no configuration screen can be presented here.", '</p>', (opt_data.showAdminMessage) ? '<p>' + AJS.format("If this is a user macro then you can add metadata to the template using the \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eUser Macro Administration\x3c/a\x3e console.","" + '/admin/usermacros.action') + '</p>' : '<p>' + "You must contact an administrator to configure metadata for this macro." + '</p>', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroDocLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span><a href="', soy.$$escapeHtml(opt_data.href), '" class="macro-doco-link">', soy.$$escapeHtml("Documentation"), '</a></span>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameter = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><label></label><input type="text" class="text"/></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterBoolean = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div boolean-param"><label></label><input type="checkbox" value="true"/></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterSelect = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><label></label><select></select></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterHidden = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><input type="hidden"/></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterDesc = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-desc">', opt_data.description, '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroBody = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-body-div"><label>', soy.$$escapeHtml("Body Text"), '</label><textarea class="monospaceInput textarea" type="text" rows="10"></textarea></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  Confluence.Templates.Dialog.helpLink({href: "http://docs.atlassian.com/confluence/docs-54/Working+with+Macros"}, output);
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.gadgetLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class=\'macro-uri\' href="', soy.$$escapeHtml(opt_data.url), '" title="', soy.$$escapeHtml(opt_data.url), '" target=\'_blank\'>', soy.$$escapeHtml("Gadget URL"), '</a>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/page-editor.js' */
Confluence.Editor=AJS.$.extend(Confluence.Editor||{},(function(F){var E=[];
var A=[];
var B=[];
var C=false;
var H=function(){for(var J=0;
J<E.length;
J++){Confluence.Editor.UI.cancelButton.click(E[J])
}for(var J=0;
J<A.length;
J++){Confluence.Editor.UI.saveButton.click(A[J])
}var I=AJS.$(Confluence.Editor.getCurrentForm());
for(var J=0;
J<B.length;
J++){I.submit(B[J])
}AJS.$.unbind("init.rte",this)
};
var G=function(I,K,J,L){L.push(J);
if(AJS.Rte&&AJS.Rte.BootstrapManager&&AJS.Rte.BootstrapManager.isInitComplete()){I.bind(K,J)
}else{if(!C){C=true;
AJS.$.bind("init.rte",H)
}}};
var D=function(I,K,L){var M=null;
if(AJS.Rte&&AJS.Rte.BootstrapManager&&AJS.Rte.BootstrapManager.isInitComplete()){M=function(O,P,N){O.unbind(P,N)
}
}var J=L.pop();
while(J){M&&M(I,K,J);
J=L.pop()
}};
return{bookmark:"",MODE_RICHTEXT:"richtext",MODE_SOURCE:"source",MODE_PREVIEW:"preview",currentEditMode:null,contentHasChangedSinceLastSave:false,sourceInitialValue:false,isSubmitting:false,isCancelling:false,addCancelHandler:function(I){G(Confluence.Editor.UI.cancelButton,"click",I,E)
},addSaveHandler:function(I){G(Confluence.Editor.UI.saveButton,"click",I,A)
},addSubmitHandler:function(I){G(AJS.$(Confluence.Editor.getCurrentForm()),"submit",I,B)
},removeAllCancelHandlers:function(){D(Confluence.Editor.UI.cancelButton,"click",E)
},removeAllSaveHandlers:function(){D(Confluence.Editor.UI.saveButton,"click",A)
},removeAllSubmitHandlers:function(){D(AJS.$(Confluence.Editor.getCurrentForm()),"submit",B)
},hasContentChanged:function(){if(!this.inRichTextMode()&&!this.contentHasChangedSinceLastSave){return false
}return this.editorHasContentChanged()
},editorHasContentChanged:function(){if(AJS.Rte.getEditor()==null){AJS.log("Confluence.Editor: editorHasContentChanged - No active editor present. Returning false.");
return false
}return AJS.Rte.Content.editorHasContentChanged()
},getResumeDraftUrl:function(){var I=[];
I.push(Confluence.getContextPath());
I.push("/pages/"+(AJS.params.newPage?"create":"edit")+AJS.params.draftType+".action");
I.push("?useDraft=true");
I.push("&pageId="+AJS.params.pageId);
I.push("&contentChanged="+this.hasContentChanged());
this.getCurrentForm().spaceKey&&I.push("&spaceKey="+AJS.Meta.get("space-key"));
return I.join("")
},getCurrentTitle:function(){return F("#content-title")&&F("#content-title").val()
},contentFormSubmit:function(I){Confluence.Editor.Drafts.unBindUnloadMessage();
AJS.$(".editable-title #content-title").prop("disabled",true);
return true
},getPagePermissions:function(){return{viewPermissionsUsers:F("#viewPermissionsUsers").val(),editPermissionsUsers:F("#editPermissionsUsers").val(),viewPermissionsGroups:F("#viewPermissionsGroups").val(),editPermissionsGroups:F("#editPermissionsGroups").val()}
},heartbeat:function(){var I={dataType:"json",contentId:AJS.params.pageId,draftType:AJS.params.draftType,spaceKey:AJS.params.spaceKey};
if(AJS.params.pageId=="0"||AJS.Meta.get("content-type")=="comment"){AJS.safe.post(AJS.params.contextPath+"/json/heartbeat.action",{})
}else{AJS.safe.post(AJS.params.contextPath+"/json/startheartbeatactivity.action",I,function(J){Confluence.Editor.heartbeatType.normal();
AJS.trigger("rte.heartbeat",J);
var N=J.length;
if(N){var K=AJS.$("#other-users-span");
K.empty();
for(var M=0;
M<N;
++M){if(M>0){K.append(", ")
}var L=J[M];
K.append(AJS("a").attr("href",AJS.params.contextPath+"/display/~"+encodeURIComponent(L.userName)).text(L.fullName));
if(L.lastEditMessage!=null){K.append(" ").append(AJS("span").addClass("smalltext").text(L.lastEditMessage))
}}}AJS.setVisible("#heartbeat-div",!!N);
F(document).trigger("resize.resizeplugin")
},"json").fail(function(J){if(J.status===503||J.status===0){Confluence.Editor.heartbeatType.recovery()
}AJS.trigger("rte.heartbeat-error",J)
})
}},heartbeatType:(function(){var I=false;
var L;
var K=+AJS.Meta.get("heartbeat-interval")||30000;
var N=Math.max(K/5,5000);
function M(O,P){if(I!==O||!L){AJS.log("Changing heartbeat period to "+P+" (recoveryMode = "+O+")");
clearInterval(L);
I=O;
L=setInterval(Confluence.Editor.heartbeat,P)
}}var J={normal:function(){M(false,K)
},recovery:function(){M(true,N)
},isNormal:function(){return !I
},reset:function(){I=true;
J.normal()
}};
return J
}()),disableFrame:function(I){AJS.$("form",I).each(function(){AJS.$(this).unbind();
this.onsubmit=function(){return false
}
});
AJS.$("a",I).each(function(){AJS.$(this).attr("target","_top").unbind()
});
AJS.$("input, img",I).each(function(){AJS.$(this).unbind()
})
},previewFrameOnload:function(R,O){AJS.log("previewFrameOnload");
Confluence.Editor.setMode(Confluence.Editor.MODE_PREVIEW);
tinyMCE.activeEditor.setProgressState(false);
Confluence.Editor.disableFrame(R);
var S=AJS.$("#main",R)[0];
if(AJS.Meta.get("content-type")!="comment"&&AJS.$(S).find("#main-header").length==0){var U=AJS.$("#title-heading");
var N=U.attr("class");
AJS.$(S).prepend('<div id="preview-header"><div id="title-heading" class="'+N+'">'+U.html()+"</div></div>")
}AJS.$("a",R).attr("target","_parent");
if(F("#all-messages").children().length<1){F("#editor-precursor").css({display:"none"})
}if(AJS.Rte.getEditorContainer().hasClass("resize")){var V=F(O||"#previewArea iframe"),M=0,J=0,K,Q=V.height();
S&&(function(){var W=F(S).outerHeight(true);
if(M!=W){if(W!=V.height()){V.height(0).height(Math.max(W,Q))
}M=W;
J=0
}else{J++
}if(J<500){K=setTimeout(arguments.callee,500)
}})();
F(document).one("mode-changed.resize-editor",function(W,X){if(X!=Confluence.Editor.MODE_PREVIEW){K&&clearTimeout(K)
}})
}else{if(tinymce.isIE||tinymce.isOpera){var I=F(window).height(),P=F("#header-precursor").height()+F("#header").height()+F("#editor-precursor").height(),T=F("#savebar-container").height(),L=4;
F("#preview iframe").height(I-P-T-L);
F("#content.edit").height("auto")
}}},showRichText:function(I){AJS.setVisible("#wysiwyg",I);
F("#editor-precursor").css({display:"table-row"});
F(".toolbar-group-preview").toggleClass("assistive",!I);
F(".toolbar-group-edit").toggleClass("assistive",I);
F("#main").toggleClass("active-richtext",I);
if(tinymce.isGecko&&I){AJS.Rte.fixEditorFocus(Confluence.Editor.bookmark)
}},showPreview:function(I){if(AJS.Meta.get("content-type")!=="comment"){var J=F("#content-title");
if(J.hasClass("placeholded")){F("#preview-title-text").text("");
F("#title-text").text("")
}else{F("#preview-title-text").text(J.val());
F("#title-text").text(J.val())
}}AJS.setVisible("#preview",I);
F(".toolbar-group-preview").toggleClass("assistive",I);
F(".toolbar-group-edit").toggleClass("assistive",!I);
F("#main").toggleClass("active-preview",I);
!!F("#full-height-container").length&&F("#full-height-container").toggleClass("active-preview",I)
},showSource:function(I){if(I){this.showSourceArea()
}else{this.hideSourceArea()
}F("#main")[I?"addClass":"removeClass"]("active-source")
},setMode:function(I){AJS.log("Set mode: "+I);
if(I==Confluence.Editor.MODE_RICHTEXT){this.showRichText(true);
this.showPreview(false);
this.showSource(false)
}else{if(I==Confluence.Editor.MODE_SOURCE){this.showSource(true);
this.showRichText(false);
this.showPreview(false)
}else{if(I==Confluence.Editor.MODE_PREVIEW){this.showPreview(true);
this.showRichText(false);
this.showSource(false);
Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")
}}}setTimeout(function(){var J=F(".toolbar-group-preview");
J.height(0);
J.height();
J.height("auto")
},1);
this.currentEditMode=I;
F(document).trigger("mode-changed",[I])
},getContentId:function(){return Confluence.getContentId()
},addErrorMessage:function(M,K,L){var J=F("#"+M);
var I=(L?"#all-messages":"#editor-messages");
if(J.length){J.empty()
}else{J=F("<div></div>").attr("id",M).appendTo(I)
}AJS.messages.error(J,{closeable:true,body:K})
},changeMode:function(M,I){AJS.log("Change mode: "+M);
I=I||{};
if(this.inRichTextMode()&&!AJS.Rte.BootstrapManager.isInitComplete()){return false
}if(this.currentEditMode==M){return false
}var J=this.currentEditMode;
Confluence.Editor.Drafts.save();
if(M==Confluence.Editor.MODE_PREVIEW){var L=AJS.Rte.getEditor();
if(J==Confluence.Editor.MODE_SOURCE){Confluence.Editor.transferSourceToEditor()
}if(tinyMCE.isGecko&&(J==Confluence.Editor.MODE_RICHTEXT)&&!Confluence.Editor.bookmark){Confluence.Editor.bookmark=tinymce.activeEditor.selection.getBookmark()
}this.currentEditMode=M;
var K={contentId:Confluence.getContentId(),contentType:AJS.Meta.get("content-type"),spaceKey:AJS.Meta.get("space-key"),xHtml:L.getContent()};
AJS.safe.ajax({type:"POST",url:AJS.params.contextPath+"/pages/rendercontent.action",data:K,success:Confluence.Editor.replysetPreviewArea,timeout:20000,error:function(){Confluence.Editor.addErrorMessage("preview-error","There was an error loading preview. Please try again later.");
Confluence.Editor.currentEditMode=J;
I.errorCallback&&I.errorCallback()
}})
}else{this.setMode(M)
}if(M==Confluence.Editor.MODE_RICHTEXT){F(document).trigger("resize.resizeplugin")
}return false
},replysetPreviewArea:function(I){F("#preview-error").remove();
var L=AJS.params.staticResourceUrlPrefix+"/blank.html";
tinyMCE.activeEditor.setProgressState(true);
AJS.$("#previewArea").html('<iframe id="editor-preview-iframe" src="'+L+'" scrolling="yes" frameborder="0"></iframe>');
var J=AJS.$("#previewArea iframe")[0];
var K=J.contentDocument||J.contentWindow.document;
K.write(I);
K.close()
},inRichTextMode:function(){return this.currentEditMode==Confluence.Editor.MODE_RICHTEXT
},isNewPage:function(){return AJS.$("#createpageform, #createpagetemplate").length>0
},onInit:function(){Confluence.Editor.setMode(Confluence.Editor.MODE_RICHTEXT);
tinyMCE.activeEditor.onClick.add(function(I,J){F("#PostingDate").datepicker("hide")
})
},contentChangeHandler:function(){this.contentHasChangedSinceLastSave=true
},getCurrentForm:function(){return tinyMCE.activeEditor.formElement
},transferSourceToEditor:function(){var J=Confluence.Editor;
if(J.sourceInitialValue){var I=J.getSourceAreaVal();
if(I!=J.sourceInitialValue){var K=tinyMCE.activeEditor;
K.setContent(I);
K.setDirty(I)
}}J.sourceInitialValue=false
},hideSourceArea:function(){AJS.$("#editor-html-source-container").addClass("hidden");
this.setToolBarInactive(false);
this.transferSourceToEditor();
F("#rte-button-source-mode").removeClass("active");
F("#rte-button-publish").unbind("click.source-save")
},showSourceArea:function(){AJS.$("#editor-html-source-container").removeClass("hidden");
this.setSourceAreaHeight();
this.setToolBarInactive(true);
this.sourceInitialValue=tinyMCE.activeEditor.getContent();
this.setSourceAreaVal(this.sourceInitialValue);
F("#rte-button-source-mode").addClass("active");
F("#rte-button-publish").bind("click.source-save",Confluence.Editor.transferSourceToEditor)
},getSourceAreaVal:function(){return AJS.$("#editor-html-source").val()
},setSourceAreaVal:function(I){AJS.$("#editor-html-source").val(I)
},setSourceAreaHeight:function(){var I=AJS.Rte.getTinyMceEditorMinHeight();
AJS.log("HTML source height= "+I);
var J=F("#editor-html-source")[0].scrollHeight;
if(J>I){I=J;
AJS.log("ACTUAL HEIGHT "+J)
}F("#editor-html-source-container").height(I+"px")
},setToolBarInactive:function(I){F("#rte-toolbar").toggleClass("disabled",I)
},isVisible:function(){return(F("#wysiwyg:visible").length>0)||(F("#editor-html-source-container:visible").length>0)||(F("#preview:visible").length>0)
}}
})(AJS.$));
AJS.toInit(function(A){AJS.bind("init.rte",Confluence.Editor.onInit)
});
AJS.bind("init.rte",function(){var D=AJS.$;
var A=function(G){for(var H=0;
H<Confluence.Editor.UI.buttons.length;
H++){E(G,D(Confluence.Editor.UI.buttons[H]))
}};
var E=function(G,H){if(!H){return 
}if(G){H.removeAttr("aria-disabled")
}else{H.attr("aria-disabled","true")
}};
var B=function(G,H){AJS.$(G).replaceWith(H);
return AJS.$(G)
};
var F=function(){return B("#rte-button-publish",Confluence.Templates.Editor.Page.saveButton({contentType:AJS.Meta.get("content-type")}))
};
Confluence.Editor.UI={spinner:AJS.$("#rte-spinner"),saveButton:F(),overwriteButton:AJS.$("#rte-button-overwrite"),editButton:AJS.$("#rte-button-edit"),previewButton:AJS.$("#rte-button-preview"),cancelButton:AJS.$("#rte-button-cancel"),saveDraftButton:AJS.$("#rte-button-save-draft"),watchPageCheckbox:AJS.$("#watchPage"),watchPageToolbarGroup:AJS.$(".toolbar-group-watch-page"),setButtonsState:A,setButtonState:E,isFormEnabled:function(){return C.UI.saveButton.attr("aria-disabled")!=="true"
},toggleSavebarBusy:function(G,H){if(G&&!Confluence.Editor.UI.isFormEnabled()){if(H){Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")
}return false
}if(G){if(!Confluence.Editor.isCancelling){if(AJS.Meta.get("content-type")==="comment"&&AJS.Rte.Content.isEmpty()){AJS.Confluence.EditorNotification.notify("warning","Comment text is empty. Cannot create empty comments.",8);
return false
}if(H!==true){Confluence.Editor.UI.spinner.addClass("aui-icon-wait")
}}A(false)
}else{Confluence.Editor.UI.spinner.removeClass("aui-icon-wait");
A(true)
}return true
},toggleWatchPage:function(G){if(G&&AJS.Meta.get("content-type")==="comment"){Confluence.Editor.UI.watchPageToolbarGroup.show();
if(Confluence.Editor.UI.watchPageCheckbox.length){Confluence.Editor.UI.watchPageCheckbox[0].checked=false
}}else{Confluence.Editor.UI.watchPageToolbarGroup.hide()
}}};
AJS.trigger("rte.init.ui");
Confluence.Editor.UI.buttons=[Confluence.Editor.UI.saveButton,Confluence.Editor.UI.overwriteButton,Confluence.Editor.UI.editButton,Confluence.Editor.UI.previewButton,Confluence.Editor.UI.cancelButton,Confluence.Editor.UI.saveDraftButton];
var C=Confluence.Editor;
if(C.isNewPage()){AJS.$("#content-title").focus().select()
}C.addSubmitHandler(function(G){if(Confluence.Editor.UI.toggleSavebarBusy(true)){Confluence.Editor.isCancelling=false;
A(false);
return C.contentFormSubmit(G)
}else{return false
}});
C.addCancelHandler(function(G){Confluence.Editor.isCancelling=true
});
this.currentEditMode=this.MODE_RICHTEXT;
if(AJS.DarkFeatures.isEnabled("move.page.on.save")){C.UI.saveButton.click(function(H){H.preventDefault();
if(AJS.$("#move-page-dialog").length>0){AJS.$("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()
}var G;
if(AJS.Meta.getBoolean("new-page")&&AJS.Meta.get("content-type")!="blogpost"){new Confluence.MovePageDialog({spaceName:G,spaceKey:AJS.$("#newSpaceKey").val(),pageTitle:AJS.$("#content-title").val(),parentPageTitle:AJS.$("#parentPageString").val(),buttonName:"Save",title:"Set Page Location",hint:{text:"Hint: you can move this page later, from the Tools menu."},moveHandler:function(M,J,N,O,L,K,I){AJS.$("#newSpaceKey").val(J);
AJS.$("#parentPageString").val(O);
if(O!=""){AJS.$("#position").val("append")
}else{AJS.$("#position").val("topLevel")
}if(L){AJS.$("#targetId").val(L);
AJS.$("#position").val(K)
}AJS.$(C.getCurrentForm()).submit()
}})
}else{AJS.$(C.getCurrentForm()).submit()
}})
}C.UI.editButton.click(function(G){if(Confluence.Editor.UI.isFormEnabled()){Confluence.Editor.changeMode(C.MODE_RICHTEXT);
setTimeout(function(){AJS.Rte.getEditor().focus();
if(tinymce.isGecko&&Confluence.Editor.bookmark){AJS.Rte.getEditor().selection.moveToBookmark(Confluence.Editor.bookmark)
}},0)
}G.preventDefault()
});
C.UI.previewButton.click(function(G){if(Confluence.Editor.UI.isFormEnabled()&&C.currentEditMode!=C.MODE_PREVIEW){A(false);
Confluence.Editor.UI.spinner.addClass("aui-icon-wait");
if(tinymce.isGecko&&!Confluence.Editor.bookmark){Confluence.Editor.bookmark=tinymce.activeEditor.selection.getBookmark()
}C.changeMode(C.MODE_PREVIEW,{errorCallback:function(){A(true);
Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")
}})
}G.preventDefault()
});
AJS.$("#editor-html-source").change(C.setSourceAreaHeight).keyup(C.setSourceAreaHeight);
AJS.$("#rte-button-attachments").bind("updateLabel",function(){var H=+AJS.Meta.get("num-attachments");
var G=(H>1)?AJS.format("{0} Attachments",H):(H==0)?AJS.format("Attachments",H):AJS.format("{0} Attachment",H);
AJS.$("#rte-button-attachments > .trigger-text").text(G)
});
AJS.$("#rte-button-labels").bind("updateLabel",function(){var H=+AJS.Meta.get("num-labels")||0;
var G="Labels";
if(H===1){G=AJS.format("{0} Label",H)
}else{if(H>1){G=AJS.format("{0} Labels",H)
}}AJS.$("#rte-button-labels  > .trigger-text").text(G)
});
AJS.$("#PostingDate").datepicker({maxDate:new Date()});
AJS.$("#PostingDate").datepicker("widget").css("display","none");
AJS.$(".mceProgress, .mceBlocker",AJS.$("#wysiwygTextarea_parent")[0]).live("click",function(){AJS.Rte.getEditor().focus()
});
AJS.$(window).bind("render-content-loaded",function(I,G){var H=AJS.$("#previewArea iframe");
if(H.contents().find("body")[0]==G){C.previewFrameOnload(G,H);
C.UI.setButtonsState(true);
C.UI.setButtonState(false,C.UI.saveDraftButton);
H.focus();
window.focus();
AJS.$(document).trigger("iframeAppended",H)
}});
if(AJS.Meta.get("heartbeat")){C.heartbeat();
Confluence.Editor.heartbeatType.normal()
}AJS.bind("watchpage.pageoperation",function(){Confluence.Editor.UI.toggleWatchPage(false)
});
AJS.bind("unwatchpage.pageoperation",function(){Confluence.Editor.UI.toggleWatchPage(true)
});
AJS.trigger("init.rte-control")
});
AJS.Editor=Confluence.Editor;
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/image-dialog.soy' */
// This file was automatically generated from image-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Image == 'undefined') { Confluence.Templates.Image = {}; }


Confluence.Templates.Image.uploadFileForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="upload-attachment"><form action="', soy.$$escapeHtml(""), '/pages/attachfile.action" method="post" enctype="multipart/form-data" class="aui"><label for="file_0">', soy.$$escapeHtml("Upload image:"), '</label><input name="file_0" type="file" class="upfile"><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form><div class="image-uploading hidden">', "Image uploading\u2026", '</div><div class="warning hidden"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.attachedImagesPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="attached-images"><div class="loading-message">', "Loading\u2026", '</div><ul class="image-list"></ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.searchPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="search-image"><form class="aui search-form" id="search-image-form" action="#"><fieldset class="inline"><div class="search-input"><label for="search-image" class="assistive">', soy.$$escapeHtml("Search"), '</label><input type="text" class="text search-image-text" size="50" autocomplete="off"></div><select class="search-space select" id="search-image-space-select"><option value="">', soy.$$escapeHtml("All Spaces"), '</option><option value="', soy.$$escapeHtml(opt_data.spaceKey), '">', soy.$$escapeHtml(opt_data.spaceName), '</option></select><button type="submit" class="aui-button search-button">', soy.$$escapeHtml("Search"), '</button></fieldset></form></div><div id="searched-images"><div class="loading-message hidden">', soy.$$escapeHtml("Searching\u2026"), '</div><ul class="image-list"></ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.webPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="insert-web-image"><form id="insert-web-image-form" action="#" class="aui"><fieldset class="inline"><div class="web-image-input"><label for="insert-web-image-image-url" id="insert-web-image-image-url-label">', soy.$$escapeHtml("Image URL:"), '</label><input type="text" class="text image-url" value="http://" id="insert-web-image-image-url" name="insert-web-image-image-url"></div><input type="submit" class="image-preview aui-button" value="', soy.$$escapeHtml("Preview"), '"></fieldset></form><p class="faraway image-preview-area"></p><p class="hidden image-preview-error">', soy.$$escapeHtml("This image couldn\x27t be loaded for preview. Please check the URL."), '</p><p class="hidden image-preview-throbber">&nbsp;</p></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.imageDialogListItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="attached-image"><div class="image-container loading"><img class="thumbnail" src="', soy.$$escapeHtml(opt_data.nonceUrl), '" title="', soy.$$escapeHtml(opt_data.imageTooltip), '" width="', soy.$$escapeHtml(opt_data.image.thumbnailWidth), '" height="', soy.$$escapeHtml(opt_data.image.thumbnailHeight), '" style="margin-top: ', soy.$$escapeHtml(opt_data.topMargin), 'px"><a href="', soy.$$escapeHtml(opt_data.image.downloadUrl), '" class="zoom">Zoom</a></div><span class="caption filename" title="', soy.$$escapeHtml(opt_data.imageName), '">', opt_data.highlightedImageName, '</span><span class="caption owner-title ', soy.$$escapeHtml(opt_data.parentTitleClass), '" title="', soy.$$escapeHtml(opt_data.image.parentTitle), '">', opt_data.highlightedParentTitle, '</span></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dialog-help-link"><a href="', soy.$$escapeHtml("http://docs.atlassian.com/confluence/docs-54/Displaying+Images"), '" target="_blank">', soy.$$escapeHtml("Help"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/insert-wiki-markup.soy' */
// This file was automatically generated from insert-wiki-markup.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.InsertWiki == 'undefined') { Confluence.Templates.InsertWiki = {}; }


Confluence.Templates.InsertWiki.originalDefaultTempWikiMarkupDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action=\'#\' method=\'post\' id="insert-wiki-markup-form" class="aui"><textarea class=\'monospaceInput textarea originalDefault\' id=\'insert-wiki-textarea\' name=\'wikitext\'/></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.previewWikiIframeContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<!DOCTYPE><html class="insert-wiki-markup-dialog"><head></head><body class="wiki-content previewWiki"></body></html>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiMarkupDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action=\'#\' method=\'post\' id="insert-wiki-markup-form" class="aui"><h3 class="wiki-title"><span>', soy.$$escapeHtml(opt_data.markupLabel), '</span><span>', soy.$$escapeHtml(opt_data.previewLabel), '</span></h3><textarea class=\'monospaceInput textarea\' id=\'insert-wiki-textarea\' name=\'wikitext\'/><!-- --><div class=\'example-container\' id=\'insert-wiki-textarea-preview\'></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiErrorSubDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class=\'warning\'>', soy.$$escapeHtml(opt_data.warningMessage), '</p><p class=\'exception-report\'><span class=\'exceptionMessage\'>', soy.$$escapeHtml(opt_data.exceptionMessage), '</span></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiParserSelector = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="wiki-parser-selector"><form action="#" method="post" id="d" class="aui"><select class="select medium-field" id="wiki-parser-selection-tool" name="wiki-parser-selection-tool" title="wiki parser selector"><option value="', soy.$$escapeHtml(opt_data.DEFAULT.val), '">', soy.$$escapeHtml(opt_data.DEFAULT.label), '</option>');
  var wikiLangList24 = soy.$$getMapKeys(opt_data.WIKI);
  var wikiLangListLen24 = wikiLangList24.length;
  for (var wikiLangIndex24 = 0; wikiLangIndex24 < wikiLangListLen24; wikiLangIndex24++) {
    var wikiLangData24 = wikiLangList24[wikiLangIndex24];
    output.append((opt_data.WIKI[wikiLangData24].val != opt_data.DEFAULT.val) ? '<option value="' + soy.$$escapeHtml(opt_data.WIKI[wikiLangData24].val) + '">' + soy.$$escapeHtml(opt_data.WIKI[wikiLangData24].label) + '</option>' : '');
  }
  output.append('</select></form></span>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/page-editor.soy' */
// This file was automatically generated from page-editor.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Editor == 'undefined') { Confluence.Templates.Editor = {}; }
if (typeof Confluence.Templates.Editor.Page == 'undefined') { Confluence.Templates.Editor.Page = {}; }


Confluence.Templates.Editor.Page.saveButton = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button id="rte-button-publish" class="aui-button aui-button-primary" type="submit" name="confirm" value="Save"', (opt_data.contentType == 'blogpost') ? 'title="' + soy.$$escapeHtml("Publish your blog post") + '"' : (opt_data.contentType == 'page') ? 'title="' + soy.$$escapeHtml("Save your page") + '"' : 'title="' + soy.$$escapeHtml("Save") + '"', 'tabindex="101">', (opt_data.contentType == 'blogpost') ? '<span class="trigger-text">' + soy.$$escapeHtml("Publish") + '</span>' : '<span class="trigger-text">' + soy.$$escapeHtml("Save") + '</span>', '</button>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog.js' */
jQuery.fn.sizeToFit=function(){var A=jQuery;
this.each(function(){var D=this;
var B=A(this).parent();
var E=B.height();
B.children().each(function(){if(this!=D){E-=A(this).outerHeight()
}});
var C=A(this).outerHeight()-A(this).height();
A(this).css("height",Math.max(0,E-C)+"px")
});
return this
};
Confluence.Editor.ImageDialog={beforeShowListeners:[],afterThumbnailsDisplayedListeners:[],panelComponent:[]};
AJS.toInit(function(C){Confluence.Editor.ImageDialog.findPanelComponentById=function(H){var E=Confluence.Editor.ImageDialog.panelComponent;
for(var F=0,G=E.length;
F<G;
F++){if(E[F].id==H){return E[F]
}}return undefined
};
AJS.wikiAttrToString=function(E){var F=[];
for(var G in E){if(E.hasOwnProperty(G)){F.push(typeof E[G]=="boolean"?E[G]?G:"":G+"="+E[G])
}}return F.length?"|"+F.join(","):""
};
Confluence.Editor.defaultInsertImageDialog=function(){var F=function(G){AJS.Rte.BookmarkManager.restoreBookmark();
tinymce.confluence.ImageUtils.insertFromProperties(G);
if(!!C("#comments-section").length){AJS.Rte.fixEditorFocus()
}},E=function(){AJS.Rte.BookmarkManager.restoreBookmark()
};
AJS.Rte.BookmarkManager.storeBookmark();
Confluence.Editor.insertImageDialog(F,E)
};
Confluence.Editor.insertImageDialog=function(F,E){this.openImageDialog({submitCallback:F,cancelCallback:E})
};
var A=function(E,F,G){C(document).bind("keydown.insert-image",function(I){if(!E.is(":visible")){return 
}if(C("#fancybox-overlay").is(":visible")){if(I.which==32){C("#fancybox-close").click();
I.preventDefault();
I.stopPropagation();
return false
}}else{function H(N){var K=C(".attached-image",E);
var M=C(".attached-image.selected",E);
var J=K.index(M)+N;
if(J<0){J=K.length-1
}if(J>=K.length){J=0
}var L=K.eq(J);
L.click().focus();
E.simpleScrollTo(L)
}if(I.which==37){H(-1);
return AJS.stopEvent(I)
}else{if(I.which==38){H(-4);
return AJS.stopEvent(I)
}else{if(I.which==39){H(1);
return AJS.stopEvent(I)
}else{if(I.which==40){H(4);
return AJS.stopEvent(I)
}else{if(I.which==32&&C(".attached-image.selected").length>0){C(G.imageSelector+".selected .zoom").click();
return AJS.stopEvent(I)
}else{if(I.which==13&&F.isInsertAllowed()){F.insert();
return AJS.stopEvent(I)
}}}}}}}})
};
var D=function(E,G,I,L){var H=100,L=L||new Confluence.Highlighter(),J=G.name||G.fileName,N;
if(Math.max(G.thumbnailWidth,G.thumbnailHeight)>H){if(G.thumbnailHeight>G.thumbnailWidth){G.thumbnailWidth=G.thumbnailWidth*H/G.thumbnailHeight;
G.thumbnailHeight=H
}else{G.thumbnailHeight=G.thumbnailHeight*H/G.thumbnailWidth;
G.thumbnailWidth=H
}}if(!G.thumbnailUrl&&G.thumbnailLink){G.thumbnailUrl=G.thumbnailLink.href
}if(!G.downloadUrl&&G.link){for(var F=0,M=G.link.length;
F<M;
F++){var K=G.link[F];
if(K.rel=="download"){G.downloadUrl=K.href;
break
}}}N=C(Confluence.Templates.Image.imageDialogListItem({image:G,nonceUrl:G.thumbnailUrl&&G.thumbnailUrl+(G.thumbnailUrl.indexOf("?")+1?"&":"?")+"nonce="+(+new Date),imageTooltip:J+(G.space&&(" ("+G.space.name+")")||""),topMargin:G.thumbnailHeight&&(100-G.thumbnailHeight)/2,parentTitleClass:I?"":"hidden",imageName:J,parentTitle:G.parentTitle||"",highlightedImageName:L.highlight(J),highlightedParentTitle:L.highlight(G.parentTitle||"")}));
N.attr("data-owner-id",G.ownerId||"");
N.attr("data-destination",AJS.REST.wikiLink(G).destination);
N.find(".image-container").andSelf().hover(function(){C(this).addClass("hover")
},function(){C(this).removeClass("hover")
});
N.find("img").load(function(){N.find(".image-container").removeClass("loading")
});
N.click(function(O){C("#insert-image-dialog .image-list .selected").removeClass("selected");
C(this).addClass("selected").focus();
E.selectedName=this.name=this.name||C(".caption.filename",this).text();
E.selectedOwnerId=C(this).attr("data-owner-id");
E.selectedDestination=C(this).attr("data-destination");
E.allowInsert(true);
O.stopPropagation();
return false
});
N.dblclick(function(){C(this).click();
E.insert()
});
C(".zoom",N).fancybox({padding:0,zoomSpeedIn:500,zoomSpeedOut:500,overlayShow:true,overlayOpacity:0.5});
return N
};
var B=function(F,E){var H=E.imageContainer.find(".image-list"),I=C.map(E.justAttached||[],function(R){return R&&R.toLowerCase()
}),Q=F.options,M=E.imageContainer,N=E.images||[],J=E.noImageMessage,K=E.showParentTitle,O=E.highlighter,P=E.displayErrors,L=[],G;
M.find(".loading-message").addClass("hidden");
M.find(".no-images").remove();
C(N).each(function(){if(this.name&&C.inArray(this.name.toLowerCase(),I)!=-1){H.prepend(D(F,this,K,O))
}else{H.append(D(F,this,K,O))
}});
if(H.find("li").length==0){M.append(C("<p></p>").addClass("no-images").text(J))
}M.sizeToFit().click(function(){F.clearSelection()
});
if(I.length){H.find("li:first").click()
}else{if(Q.imageProperties&&Q.imageProperties.imageFileName){imageContainter.find("img[src*=/"+Q.imageProperties.imageFileName+"?]").click()
}}L=[];
G=C.map(N,function(R){return R.name&&R.name.toLowerCase()
});
C.each(I,function(R,S){if(C.inArray(S,G)==-1){L.push(AJS.format("Attached the file \u2018{0}\u2019 but no thumbnail could be displayed. The file may not be an image.",S))
}});
if(L.length){P(L)
}};
Confluence.Editor.openImageDialog=function(M){M=M||{};
var L="insert-image-dialog";
var J=new AJS.Dialog(840,590,L),F={baseElement:J.popup.element,selectedName:"",selectedOwnerId:null,selectedDestination:null,allowInsert:null,isInsertAllowed:null,insert:null,attachmentSourceContentId:AJS.Meta.get("attachment-source-content-id"),options:M,clearSelection:null,imageContainerSupport:{bindImageContainer:A,refreshImageList:B},addPanel:function(R,N,P,O){var Q=J.getPage(0).panel.length;
J.addPanel(R,N,P,O);
return Q
},selectPanel:function(N){J.selectPanel(N)
},getPanel:function(N){return J.getPanel(N)
}},E="Insert Image",K="Insert",I,G;
F.clearSelection=function(){F.selectedName="";
F.selectedOwnerId=null;
F.selectedDestination=null;
F.allowInsert(false);
F.baseElement.find(".image-list .selected").removeClass("selected")
};
function H(){J.hide().remove();
C(document).unbind(".insert-image");
M.cancelCallback&&M.cancelCallback();
return false
}C(document).bind("keydown.insert-image",function(N){if(N.which==27&&!C("#fancybox-overlay").is(":visible")){H();
return AJS.stopEvent(N)
}});
if(M.imageProperties){E="Edit Image";
K="Save"
}J.addHeader(E);
C("#"+L+" .dialog-components .dialog-title").prepend(Confluence.Templates.Image.helpLink());
J.addButton(K,function(O){var Q=O.getCurrentPanel().body;
var N=C("input.image-url",Q).val();
var P={url:N,filename:F.selectedName,contentId:F.selectedOwnerId||F.attachmentSourceContentId};
O.remove();
C(document).unbind(".insert-image");
if(M.submitCallback){M.submitCallback(P)
}},"insert");
I=J.popup.element;
I.attr("data-tab-default","0");
G=I.find(".dialog-button-panel .insert");
F.allowInsert=function(N){G.prop("disabled",!N)
};
F.allowInsert(false);
F.isInsertAllowed=function(){return !G.is(":disabled")
};
F.insert=function(){G.click()
};
C.each(Confluence.Editor.ImageDialog.panelComponent,function(){this&&this.createPanel&&this.createPanel(F)
});
J.addCancel("Cancel",H);
AJS.log(Confluence.Editor.ImageDialog.beforeShowListeners.length+" beforeShow listeners registered.");
C.each(Confluence.Editor.ImageDialog.beforeShowListeners,function(){this()
});
J.show();
J.popup.element.find(".dialog-button-panel").append(C("<div></div>").addClass("dialog-tip").html("Hint: type \"\u003cstrong>!\u003c\/strong>\" in the Editor to insert attached images on the page."))
}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-attachments.js' */
AJS.toInit(function(E){if(AJS.Meta.get("content-type")==="template"){return 
}var C,G,D,H=function(I){var J=function(){return E(".attachments-panel",I.baseElement)
},M=function(){return E("#attached-images")
},L=function(){return E(".image-list",M())
},N=function(){return E("form",J())
},K=function(P,Q){Q=Q?E.map(Q,function(R){return R&&R.toLowerCase()
}):[];
var O=M();
O.find(".image-list").empty();
AJS.getJSONWrap({url:Confluence.getContextPath()+"/pages/attachedimages.action",data:{contentId:I.attachmentSourceContentId},messageHandler:D,loadingElement:O.find(".loading-message"),errorMessage:"Error retrieving attachments from Confluence. The server may be unavailable.",successCallback:function(R){I.imageContainerSupport.refreshImageList(I,{imageContainer:O,images:R.images,noImageMessage:"There are no images attached to this page.",justAttached:Q,showParentTitle:false,displayErrors:function(S){G.displayErrors(S)
}});
AJS.Meta.set("num-attachments",+R.totalImages);
E("#rte-button-attachments").trigger("updateLabel");
P.trigger("afterThumbnail",[L()])
}})
};
return{getPanelElement:J,getContainer:M,getForm:N,refreshWithLatestImages:K,getPanel:function(){var O=Confluence.Templates.Image.attachedImagesPanel();
if(AJS.Meta.getBoolean("can-attach-files")){O=Confluence.Templates.Image.uploadFileForm({atlToken:AJS.Meta.get("atl-token")})+O
}return O
},focus:function(){E("select.img-align",J()).focus()
},upload:function(O){E.ajax({dataType:"json",data:{contentId:I.attachmentSourceContentId,responseFormat:"html"},resetForm:true,error:O.error,success:O.success})
},getUploaderController:function(){var O=function(P){return{onUploadSuccess:function(Q){B.refreshWithLatestImages(F,E.map(Q||[],function(R){return R.name.toLowerCase()
}))
},pack:function(){M().sizeToFit()
},getDefaultErrorMessage:function(){return "Could not upload the file to Confluence. The server may be unavailable."
},getDefaultUploadingMessage:function(){return "Image uploading\u2026"
},getUploadingMessageElement:function(){return E(".image-uploading",P.baseElement)
}}
};
return Confluence.AttachmentUploader({baseElement:E("#upload-attachment",I.baseElement)},O)
}}
},B,A={id:"attachments",createPanel:function(J,I){B=(I&&I(J))||H(J),C=J.addPanel("Attached Images",B.getPanel(),"attachments-panel");
G=B.getUploaderController(J);
D=G.getMessageHandler();
J.imageContainerSupport.bindImageContainer(B.getContainer(),J);
B.refreshWithLatestImages(F)
},refresh:function(I){B.refreshWithLatestImages(F,I)
},getImageContainer:function(){return B.getContainer()
},clearErrors:function(){D.clearMessages()
},displayErrors:function(){D.displayErrors()
},setUploadInProgress:function(I,J){G.setUploadInProgress(I,J)
}},F=E(A);
Confluence.Editor.ImageDialog.panelComponent.push(A)
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-external.js' */
AJS.toInit(function(B){var A;
var C=function(E){var G=function(){return B("#insert-web-image-form",E.baseElement)
},F=function(){return B("input.image-url",E.baseElement)
},D=function(){F().focus()
};
return{getForm:G,getContainer:function(){return B(".insert-web-image",E.baseElement)
},getImageInput:F,getPanel:function(){return Confluence.Templates.Image.webPanel()
},bindPanelSelection:function(){E.getPanel(A).onselect=D
}}
};
Confluence.Editor.ImageDialog.panelComponent.push({id:"external",createPanel:function(G,E){var E=(E&&E(G))||C(G),D,F,H;
A=G.addPanel("From the Web",E.getPanel(),"web-image-panel");
F=E.getForm();
D=E.getContainer();
H=E.getImageInput();
if(G.options&&G.options.imageProperties&&G.options.imageProperties.url){G.selectPanel(A);
H.val(G.options.imageProperties.url).click();
F.submit()
}H.bind("keyup click",function(I){var J=B(this).val();
G.clearSelection();
G.selectedName=J;
G.allowInsert(J!=""&&J!="http://")
});
F.submit(function(M){var N=H.val();
if(N==="http://"){return false
}var L=D.find(".image-preview-area"),K=D.find(".image-preview-throbber"),J=Raphael.spinner(K[0],60,"#666"),I=D.find(".image-preview-error");
K.removeClass("hidden");
L.addClass("faraway");
I.addClass("hidden");
L.html("");
B("<img>").load(function(){J();
K.addClass("hidden");
L.removeClass("faraway")
}).error(function(){J();
K.addClass("hidden");
I.removeClass("hidden")
}).appendTo(L).attr("src",N);
M.preventDefault();
return false
});
E.bindPanelSelection()
}})
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-search.js' */
AJS.toInit(function(B){var A;
var C=function(H){var I=function(){return B(".search-panel",H.baseElement)
},J=function(){return B("#searched-images")
},K=function(){return B(".search-form",H.baseElement)
},G=function(){return B("input.search-image-text",K())
},F=function(){return G().val()
},E=function(){return B(".search-space",K()).val()
},D=function(){G().focus()
};
return{clearContainer:function(){var L=J();
L.find(".loading-message").removeClass("hidden");
L.find(".image-list").empty();
L.find(".warning").remove()
},getPanelElement:I,getForm:K,getContainer:J,getSpaceKey:E,getQuery:F,getPanel:function(){return Confluence.Templates.Image.searchPanel({spaceKey:AJS.Meta.get("space-key"),spaceName:AJS.Meta.get("space-name")})
},loadImages:function(L){B.ajax({type:"GET",dataType:"json",url:Confluence.getContextPath()+AJS.REST.getBaseUrl()+"search.json",data:{spaceKey:E(),query:F(),search:"name",type:"attachment",attachmentType:["image"],groupResults:false,searchParentName:true,pageSize:Confluence.Defaults.maxResults},success:L.success,error:L.error})
},bindPanelSelection:function(){H.getPanel(A).onselect=D
}}
};
Confluence.Editor.ImageDialog.panelComponent.push({id:"search",createPanel:function(F,D){var D=(D&&D(F))||C(F),E,G;
A=F.addPanel("Search",D.getPanel(),"search-panel");
E=D.getForm();
E.focusin(F.clearSelection);
G=D.getContainer();
E.submit(function(I){var H=D.getQuery();
try{if(H){D.clearContainer();
D.loadImages({success:function(K){if(K.result){D.clearContainer();
var J=new Confluence.Highlighter(H.split(" "));
F.imageContainerSupport.refreshImageList(F,{imageContainer:D.getContainer(),images:K.result,noImageMessage:"No search results found.",justAttached:false,showParentTitle:true,highlighter:J})
}},error:function(){G.find(".loading-message").addClass("hidden");
G.append(B("<p></p>").addClass("warning").text("Error searching for attachments from Confluence. The server may be unavailable."))
}})
}}finally{I.preventDefault()
}return false
});
D.bindPanelSelection();
F.imageContainerSupport.bindImageContainer(G,F)
}})
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/page-editor-drafts.js' */
Confluence.Editor.Drafts=(function(E){var A=false,C=false,D=false,B=function(I,J,H){E("<input>").attr({type:"hidden",name:I,value:J}).appendTo(H)
};
var F=function(J){var K=J.getHours();
var H=J.getMinutes();
var I=K>11?"PM":"AM";
K=K%12;
return(K==0?"12":K)+":"+(H<10?"0":"")+H+" "+I
},G=function(I,H){Confluence.Editor.Drafts.unBindUnloadMessage();
var J=Confluence.Editor.getCurrentForm();
B(I,"true",J);
B("contentChanged",""+Confluence.Editor.hasContentChanged(),J);
B("pageId",AJS.params.pageId,J);
AJS.$("#draftId",Confluence.Editor.getCurrentForm()).val(H);
if(!J.spaceKey){B("spaceKey",AJS.Meta.get("space-key"),J)
}J.action=AJS.Confluence.getContextPath()+"/pages/"+(AJS.params.newPage?"create":"edit")+AJS.params.draftType+".action";
J.submit()
};
return{isDraftSaved:function(){return A
},isDraftManuallySaved:function(){return C
},isDraftBlank:function(){return AJS.Rte.Content.isEmpty()&&!E.trim(Confluence.Editor.getCurrentTitle())
},unloadMessage:function(){var H=function(){if(Confluence.Editor.Drafts.isDraftBlank()){Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("draft-id"));
return false
}else{Confluence.Editor.Drafts.save({skipErrorHandler:true});
return true
}};
if(typeof seleniumAlert!="undefined"){D||H();
D=true;
return 
}if(Confluence.Editor.hasContentChanged()||(Confluence.Editor.Drafts.isDraftSaved()&&!Confluence.Editor.Drafts.isDraftManuallySaved())){if(AJS.params.saveDrafts){if(!D){D=true;
H();
return "A draft will be saved. You can resume editing this draft the next time you open the editor or view all your drafts in your profile."
}}else{if(Confluence.Editor.UI.isFormEnabled()&&Confluence.Editor.hasContentChanged()){return "Your comment will be lost."
}}}},bindUnloadMessage:function(){E(window).bind("beforeunload.editor",Confluence.Editor.Drafts.unloadMessage)
},unBindUnloadMessage:function(){E(window).unbind("beforeunload.editor")
},useDraft:function(){G("useDraft",AJS.Meta.get("existing-draft-id"))
},discardDraft:function(H){AJS.safeAjax({url:Confluence.getContextPath()+"/json/deletedraft.action",type:"GET",dataType:"json",data:{draftId:H},success:function(K){if(K.actionErrors){var J=["<ul>"],L=K.actionErrors;
for(var I=0;
I<L.length;
I++){AJS.log("error: "+(L[I]));
J.push("<li>"+L[I]+"</li>")
}J.push("</ul>");
AJS.messages.error("#editor-messages",{title:"Error",body:"There were errors discarding your draft: "+J.join("\n")})
}else{AJS.$("#draft-messages").remove();
AJS.messages.success("#editor-messages",{body:"Your draft has been discarded."})
}},error:function(I){AJS.messages.error({title:"Error",body:I.errors||"An unknown error has occurred. Please check your logs."})
}})
},save:function(K){K=K||{};
if(!AJS.params.saveDrafts||Confluence.Editor.isSubmitting||(!Confluence.Editor.hasContentChanged()&&!K.forceSave)){AJS.debug("skipping draft save");
return 
}AJS.debug("preparing to save editor draft");
var I=E("#content-title"),H=E("#newSpaceKey"),L=E("#originalVersion"),M=Confluence.Editor.inRichTextMode();
var J={draftId:AJS.Meta.get("draft-id"),pageId:AJS.params.pageId,type:AJS.params.draftType,title:I.hasClass("placeholded")?"":I.val(),spaceKey:H.length?H.val():encodeURIComponent(AJS.Meta.get("space-key")),content:AJS.Rte.getEditor().getContent(),permissions:Confluence.Editor.getPagePermissions()};
if(L.length){J.pageVersion=parseInt(L.val(),10)
}var O=function(Q){if(Q==null){return 
}Confluence.Editor.contentHasChangedSinceLastSave=false;
if(M){AJS.Rte.Content.editorResetContentChanged()
}A=true;
C=!!K.manualSave;
AJS.Meta.set("draft-id",Q.draftId);
AJS.$("#draftId",Confluence.Editor.getCurrentForm()).val(Q.draftId);
E("#draft-error").remove();
var P=E("#draft-status"),R=Q.time||F(new Date());
if(AJS.params.newPage){if(K.manualSave){P.html(AJS.format("Draft saved at {0}",R))
}else{P.html(AJS.format("Draft autosaved at {0}",R))
}}else{if(K.manualSave){P.html(AJS.format("Draft saved at {0} ({1}view change{2})",R,"<a id='view-diff-link-heartbeat' class='view-diff-link' href='#'>","</a>"))
}else{P.html(AJS.format("Draft autosaved at {0} ({1}view change{2})",R,"<a id='view-diff-link-heartbeat' class='view-diff-link' href='#'>","</a>"))
}}if(!+AJS.Meta.get("content-id")){AJS.Meta.set("content-id",Q.pageId)
}if(E.isFunction(K.onSuccessHandler)){K.onSuccessHandler(Q)
}Confluence.Editor.Drafts.lastSaveTime=R;
if(C){Confluence.Editor.UI.saveDraftButton.addClass("disabled");
Confluence.Editor.UI.cancelButton.attr("value","close");
Confluence.Editor.UI.cancelButton.text(AJS.Meta.get("cancel-button-close-text"))
}};
var N=function(P,Q){if(K.skipErrorHandler){return 
}Confluence.Editor.addErrorMessage("draft-error",Confluence.Editor.Drafts.lastSaveTime?AJS.format("Error saving draft. Last draft saved at {0}",Confluence.Editor.Drafts.lastSaveTime):"Error saving draft. No draft has been saved.",true);
if(E.isFunction(K.onErrorHandler)){K.onErrorHandler(Q)
}};
E.ajax({type:"POST",url:AJS.params.contextPath+"/rest/tinymce/1/drafts",data:E.toJSON(J),contentType:"application/json",dataType:"text json",success:O,error:N,timeout:30000})
}}
})(AJS.$);
AJS.bind("init.rte",function(){Confluence.Editor.Drafts.bindUnloadMessage();
var B=Confluence.Editor.UI.saveDraftButton;
var C=function(D){if(D){B.text("Saving\u2026")
}else{B.text("Save Draft")
}Confluence.Editor.UI.setButtonsState(!D)
};
AJS.$("#draft-messages").find("a.use-draft").click(function(D){Confluence.Editor.Drafts.useDraft();
D.stopPropagation();
return false
});
AJS.$("#draft-messages").find("a.discard-draft").click(function(D){Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("existing-draft-id"));
D.stopPropagation();
return false
});
B.click(function(E){if(Confluence.Editor.UI.saveDraftButton.hasClass("disabled")){E.stopPropagation();
return false
}var D=function(){C(false)
};
C(true);
setTimeout(function(){Confluence.Editor.Drafts.save({forceSave:true,onSuccessHandler:D,onErrorHandler:D,manualSave:true})
},100);
E.stopPropagation();
return false
});
var A=function(){B.removeClass("disabled");
if(B[0]){B[0].disabled=false
}};
B.addClass("disabled");
AJS.Rte.getEditor().onChange.add(A);
AJS.Rte.getEditor().onKeyDown.add(A);
AJS.$("#content-title").bind("change keypress",A);
if(AJS.params.saveDrafts){setInterval(Confluence.Editor.Drafts.save,+AJS.params.draftSaveInterval||30000)
}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:draft-changes-js', location = '/includes/js/draft-changes.js' */
AJS.toInit(function(e){AJS.log("draft-changes initialising");var a,f;var h=function(j){a=new AJS.Dialog(860,530,"view-diff-draft-dialog");var k="Unpublished Changes for \'{0}\'";a.addHeader(k.replace(/\{0\}/,""));var i=e(Confluence.Templates.DraftChanges.dialogContent());a.addPanel("Diff",i);if(j){a.addButton("Edit",function(l){a.hide();if(Confluence.Editor&&Confluence.Editor.Drafts){Confluence.Editor.Drafts.useDraft()}else{window.location=e(this).attr("data-href")}},"resume-diff-link");a.addButton("Discard",function(m){if(Confluence.Editor&&Confluence.Editor.Drafts){a.hide();Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("existing-draft-id"))}else{var l=e(this).data("draftid");if(c(l)){a.hide()}}},"discard-diff-link")}a.addCancel("Close",function(){a.hide();return false});i.removeClass("hidden")};var d=function(l,j){e("#diff-view").html(l.htmlDiff);var m=AJS.format("Unpublished Changes for \'\'{0}\'\'",AJS.escapeHtml(l.title));a.addHeader(m);a.popup.element.find(".dialog-title").prepend(Confluence.Templates.DraftChanges.helpLink());var k=e("#atlassian-token").attr("content");var i=Confluence.getContextPath();e(".resume-diff-link").attr("data-href",i+"/pages/resumedraft.action?draftId="+j);e(".discard-diff-link").data("draftid",j);AJS.setVisible("#merge-warning",l.isMergeRequired)};var g=function(k){var i,m,j;var l=function(o){var n=/draftPageId:([^ ]*)/.exec(o);i=n?n[1]:AJS.Meta.get("page-id");n=/username:([^ ]*)/.exec(o);m=n?n[1]:AJS.Meta.get("remote-user");n=/draftId:([^ ]*)/.exec(o);j=n?n[1]:null};l(k.attr("class"));AJS.safeAjax({url:Confluence.getContextPath()+"/draftchanges/viewdraftchanges.action",type:"GET",dataType:"json",data:{pageId:i,username:m},success:function(p){if(p.actionErrors){var o="";var q=p.actionErrors;for(var n=0;n<q.length;n++){AJS.log("error: "+(q[n]));o=o+"<div>"+q[n]+"</div>"}e("#diff-view").html(o)}else{d(p,j)}},error:function(n){var o=n.errors||"An unknown error has occurred. Please check your logs";e("#diff-view").html(o)}})};var b=function(j,i){if(!a){h(i)}a.addHeader("Loading");e("#diff-view").html("<tr><td id='draft-changes-waiting-icon'>Loading...</td></tr>");g(j);a.show()};e("body").on("click","#draft-status .view-diff-link",function(i){b(e(this),false);return AJS.stopEvent(i)});e("body").on("click","#draft-messages .view-diff-link",function(i){b(e(this),true);return AJS.stopEvent(i)});e("#draft-space-list").on("click",".view-diff-link",function(i){b(e(this),true);return AJS.stopEvent(i)});var c=function(i){var j="Are you sure you want to discard this draft?";if(confirm(j)){AJS.safeAjax({url:Confluence.getContextPath()+"/json/deletedraft.action",type:"GET",dataType:"json",data:{draftId:i},success:function(o){if(o.actionErrors){var n=["<ul>"],q=o.actionErrors;for(var m=0;m<q.length;m++){AJS.log("error: "+(q[m]));n.push("<li>"+q[m]+"</li>")}n.push("</ul>");AJS.messages.error("#errors",{title:"Error",body:"There were errors discarding your draft."+" "+n.join("\n")})}else{var k=e("#draft-"+i);var l=k.closest("table");var p=l.closest(".drafts-container");k.remove();if(l.find("tbody tr").length==0){p.append('<span id="no-drafts-message">'+"No drafts found."+"</span>")}}},error:function(k){AJS.messages.error({title:"Error",body:k.errors||"An unknown error has occurred. Please check your logs."})}});return true}return false};e(".discard-draft-link").click(function(j){j.preventDefault();var i=e(this).data("draftid");c(i)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:draft-changes-js', location = '/includes/soy/draft-changes-dialog.soy' */
// This file was automatically generated from draft-changes-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.DraftChanges == 'undefined') { Confluence.Templates.DraftChanges = {}; }


Confluence.Templates.DraftChanges.dialogContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="draft-changes-dialog" class="hidden"><div id="diff-view" class="wiki-content"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.DraftChanges.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  Confluence.Templates.Dialog.helpLink({href: "http://docs.atlassian.com/confluence/docs-54/Working+with+Drafts#viewchange"}, output);
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/tinymce.js' */
(function(d){var a=/^\s*|\s*$/g,e,c="B".replace(/A(.)|B/,"$1")==="$1";var b={majorVersion:"3",minorVersion:"4.9-atlassian-11",releaseDate:"2012-03-06",_init:function(){var y=this,u=document,s=navigator,g=s.userAgent,r,f,o,m,k,x;y.isOpera=d.opera&&opera.buildNumber;y.isWebKit=/WebKit/.test(g);y.isChrome=y.isWebKit&&/Chrome/.test(g);y.isIE11=!!(g.indexOf("Trident/")!=-1&&(g.indexOf("rv:")!=-1||s.appName.indexOf("Netscape")!=-1));y.isIE=!y.isWebKit&&!y.isOpera&&(/MSIE/gi).test(g)&&(/Explorer/gi).test(s.appName);y.isIE=y.isIE&&/MSIE (\w+)\./.exec(g)[1];y.isIE=y.isIE||y.isIE11;y.isIE6=y.isIE&&/MSIE [56]/.test(g);y.isIE7=y.isIE&&/MSIE [7]/.test(g);y.isIE8=y.isIE&&/MSIE [8]/.test(g);y.isIE9=y.isIE&&/MSIE [9]/.test(g);y.isIE10=y.isIE&&/MSIE \d\d/.test(g);y.isIE10up=y.isIE&&/MSIE \d\d/.test(g)||y.isIE11;y.isGecko=!y.isWebKit&&!y.isIE11&&/Gecko/.test(g);y.isMac=g.indexOf("Mac")!=-1;y.isAir=/adobeair/i.test(g);y.isIDevice=/(iPad|iPhone)/.test(g);y.isIOS5=y.isIDevice&&g.match(/AppleWebKit\/(\d*)/)[1]>=534;if(d.tinyMCEPreInit){y.suffix=tinyMCEPreInit.suffix;y.baseURL=tinyMCEPreInit.base;y.query=tinyMCEPreInit.query;return}y.suffix="";f=u.getElementsByTagName("base");for(r=0;r<f.length;r++){if(x=f[r].href){if(/^https?:\/\/[^\/]+$/.test(x)){x+="/"}m=x?x.match(/.*\//)[0]:""}}if(!m){var q=document.location;m=q.protocol+"//"+q.hostname+(q.port?":"+q.port:"")}function j(l){var i=/editor/.test(l);if(l&&/tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(l)||i){if(/_(src|dev)\.js/g.test(l)){y.suffix="_src"}if((k=l.indexOf("?"))!=-1){y.query=l.substring(k+1)}if(i){y.baseURL=l.substring(0,l.indexOf("/download/"))}else{y.baseURL=l.substring(0,l.lastIndexOf("/"))}if(m&&y.baseURL.indexOf("://")==-1&&y.baseURL.indexOf("/")!==0){y.baseURL=m+y.baseURL}if(i){y.baseURL+="/download/resources/com.atlassian.plugins.editor/tinymcesource"}return y.baseURL}return null}var h=AJS.Meta.get("rte.src.url");if(h){j(h)}else{f=u.getElementsByTagName("script");for(r=0;r<f.length;r++){if(j(f[r].src)){return}}o=u.getElementsByTagName("head")[0];if(o){f=o.getElementsByTagName("script");for(r=0;r<f.length;r++){if(j(f[r].src)){return}}}}return},is:function(g,f){if(!f){return g!==e}if(f=="array"&&(g.hasOwnProperty&&g instanceof Array)){return true}return typeof(g)==f},makeMap:function(f,j,h){var g;f=f||[];j=j||",";if(typeof(f)=="string"){f=f.split(j)}h=h||{};g=f.length;while(g--){h[f[g]]={}}return h},each:function(i,f,h){var j,g;if(!i){return 0}h=h||i;if(i.length!==e){for(j=0,g=i.length;j<g;j++){if(f.call(h,i[j],j,i)===false){return 0}}}else{for(j in i){if(i.hasOwnProperty(j)){if(f.call(h,i[j],j,i)===false){return 0}}}}return 1},map:function(g,h){var i=[];b.each(g,function(f){i.push(h(f))});return i},grep:function(g,h){var i=[];b.each(g,function(f){if(!h||h(f)){i.push(f)}});return i},inArray:function(g,h){var j,f;if(g){for(j=0,f=g.length;j<f;j++){if(g[j]===h){return j}}}return -1},extend:function(k,j){var h,g,f=arguments;for(h=1,g=f.length;h<g;h++){j=f[h];b.each(j,function(i,l){if(i!==e){k[l]=i}})}return k},trim:function(f){return(f?""+f:"").replace(a,"")},create:function(o,f,j){var n=this,g,i,k,l,h,m=0;o=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(o);k=o[3].match(/(^|\.)(\w+)$/i)[2];i=n.createNS(o[3].replace(/\.\w+$/,""),j);if(i[k]){return}if(o[2]=="static"){i[k]=f;if(this.onCreate){this.onCreate(o[2],o[3],i[k])}return}if(!f[k]){f[k]=function(){};m=1}i[k]=f[k];n.extend(i[k].prototype,f);if(o[5]){g=n.resolve(o[5]).prototype;l=o[5].match(/\.(\w+)$/i)[1];h=i[k];if(m){i[k]=function(){return g[l].apply(this,arguments)}}else{i[k]=function(){this.parent=g[l];return h.apply(this,arguments)}}i[k].prototype[k]=i[k];n.each(g,function(p,q){i[k].prototype[q]=g[q]});n.each(f,function(p,q){if(g[q]){i[k].prototype[q]=function(){this.parent=g[q];return p.apply(this,arguments)}}else{if(q!=k){i[k].prototype[q]=p}}})}n.each(f["static"],function(p,q){i[k][q]=p});if(this.onCreate){this.onCreate(o[2],o[3],i[k].prototype)}},walk:function(i,h,j,g){g=g||this;if(i){if(j){i=i[j]}b.each(i,function(k,f){if(h.call(g,k,f,j)===false){return false}b.walk(k,h,j,g)})}},createNS:function(j,h){var g,f;h=h||d;j=j.split(".");for(g=0;g<j.length;g++){f=j[g];if(!h[f]){h[f]={}}h=h[f]}return h},resolve:function(j,h){var g,f;h=h||d;j=j.split(".");for(g=0,f=j.length;g<f;g++){h=h[j[g]];if(!h){break}}return h},addUnload:function(j,i){var h=this;j={func:j,scope:i||this};if(!h.unloads){function g(){var f=h.unloads,l,m;if(f){for(m in f){l=f[m];if(l&&l.func){l.func.call(l.scope,1)}}if(d.detachEvent){d.detachEvent("onbeforeunload",k);d.detachEvent("onunload",g)}else{if(d.removeEventListener){d.removeEventListener("unload",g,false)}}h.unloads=l=f=w=g=0;if(d.CollectGarbage){CollectGarbage()}}}function k(){var l=document;if(l.readyState=="interactive"){function f(){l.detachEvent("onstop",f);if(g){g()}l=0}if(l){l.attachEvent("onstop",f)}d.setTimeout(function(){if(l){l.detachEvent("onstop",f)}},0)}}if(d.attachEvent){d.attachEvent("onunload",g);d.attachEvent("onbeforeunload",k)}else{if(d.addEventListener){d.addEventListener("unload",g,false)}}h.unloads=[j]}else{h.unloads.push(j)}return j},removeUnload:function(i){var g=this.unloads,h=null;b.each(g,function(j,f){if(j&&j.func==i){g.splice(f,1);h=i;return false}});return h},explode:function(f,g){return f?b.map(f.split(g||","),b.trim):f},_addVer:function(g){var f;if(!this.query){return g}f=(g.indexOf("?")==-1?"?":"&")+this.query;if(g.indexOf("#")==-1){return g+f}return g.replace("#",f+"#")},_replace:function(h,f,g){if(c){return g.replace(h,function(){var l=f,j=arguments,k;for(k=0;k<j.length-2;k++){if(j[k]===e){l=l.replace(new RegExp("\\$"+k,"g"),"")}else{l=l.replace(new RegExp("\\$"+k,"g"),j[k])}}return l})}return g.replace(h,f)}};b._init();d.tinymce=d.tinyMCE=b})(window);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Dispatcher.js' */
tinymce.create("tinymce.util.Dispatcher",{scope:null,listeners:null,Dispatcher:function(a){this.scope=a||this;this.listeners=[]},add:function(a,b){this.listeners.push({cb:a,scope:b||this.scope});return a},addToTop:function(a,b){this.listeners.unshift({cb:a,scope:b||this.scope});return a},remove:function(a){var b=this.listeners,c=null;tinymce.each(b,function(e,d){if(a==e.cb){c=a;b.splice(d,1);return false}});return c},dispatch:function(){var f,d=arguments,e,b=this.listeners,g;for(e=0;e<b.length;e++){g=b[e];f=g.cb.apply(g.scope,d.length>0?d:[g.scope]);if(f===false){break}}return f}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/URI.js' */
(function(){var a=tinymce.each;tinymce.create("tinymce.util.URI",{URI:function(e,g){var f=this,i,d,c,h;e=tinymce.trim(e);g=f.settings=g||{};if(/^([\w\-]+):([^\/]{2})/i.test(e)||/^\s*#/.test(e)){f.source=e;return}if(e.indexOf("/")===0&&e.indexOf("//")!==0){e=(g.base_uri?g.base_uri.protocol||"http":"http")+"://mce_host"+e}if(!/^[\w-]*:?\/\//.test(e)){h=g.base_uri?g.base_uri.path:new tinymce.util.URI(location.href).directory;e=((g.base_uri&&g.base_uri.protocol)||"http")+"://mce_host"+f.toAbsPath(h,e)}e=e.replace(/@@/g,"(mce_at)");e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e);a(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(b,j){var k=e[j];if(k){k=k.replace(/\(mce_at\)/g,"@@")}f[b]=k});if(c=g.base_uri){if(!f.protocol){f.protocol=c.protocol}if(!f.userInfo){f.userInfo=c.userInfo}if(!f.port&&f.host=="mce_host"){f.port=c.port}if(!f.host||f.host=="mce_host"){f.host=c.host}f.source=""}},setPath:function(c){var b=this;c=/^(.*?)\/?(\w+)?$/.exec(c);b.path=c[0];b.directory=c[1];b.file=c[2];b.source="";b.getURI()},toRelative:function(b){var c=this,d;if(b==="./"){return b}b=new tinymce.util.URI(b,{base_uri:c});if((b.host!="mce_host"&&c.host!=b.host&&b.host)||c.port!=b.port||c.protocol!=b.protocol){return b.getURI()}d=c.toRelPath(c.path,b.path);if(b.query){d+="?"+b.query}if(b.anchor){d+="#"+b.anchor}return d},toAbsolute:function(b,c){var b=new tinymce.util.URI(b,{base_uri:this});return b.getURI(this.host==b.host&&this.protocol==b.protocol?c:0)},toRelPath:function(g,h){var c,f=0,d="",e,b;g=g.substring(0,g.lastIndexOf("/"));g=g.split("/");c=h.split("/");if(g.length>=c.length){for(e=0,b=g.length;e<b;e++){if(e>=c.length||g[e]!=c[e]){f=e+1;break}}}if(g.length<c.length){for(e=0,b=c.length;e<b;e++){if(e>=g.length||g[e]!=c[e]){f=e+1;break}}}if(f==1){return h}for(e=0,b=g.length-(f-1);e<b;e++){d+="../"}for(e=f-1,b=c.length;e<b;e++){if(e!=f-1){d+="/"+c[e]}else{d+=c[e]}}return d},toAbsPath:function(e,f){var c,b=0,h=[],d,g;d=/\/$/.test(f)?"/":"";e=e.split("/");f=f.split("/");a(e,function(i){if(i){h.push(i)}});e=h;for(c=f.length-1,h=[];c>=0;c--){if(f[c].length==0||f[c]=="."){continue}if(f[c]==".."){b++;continue}if(b>0){b--;continue}h.push(f[c])}c=e.length-b;if(c<=0){g=h.reverse().join("/")}else{g=e.slice(0,c).join("/")+"/"+h.reverse().join("/")}if(g.indexOf("/")!==0){g="/"+g}if(d&&g.lastIndexOf("/")!==g.length-1){g+=d}return g},getURI:function(d){var c,b=this;if(!b.source||d){c="";if(!d){if(b.protocol){c+=b.protocol+"://"}if(b.userInfo){c+=b.userInfo+"@"}if(b.host){c+=b.host}if(b.port){c+=":"+b.port}}if(b.path){c+=b.path}if(b.query){c+="?"+b.query}if(b.anchor){c+="#"+b.anchor}b.source=c}return b.source}})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Cookie.js' */
(function(){var a=tinymce.each;tinymce.create("static tinymce.util.Cookie",{getHash:function(d){var b=this.get(d),c;if(b){a(b.split("&"),function(e){e=e.split("=");c=c||{};c[unescape(e[0])]=unescape(e[1])})}return c},setHash:function(j,b,g,f,i,c){var h="";a(b,function(e,d){h+=(!h?"":"&")+escape(d)+"="+escape(e)});this.set(j,h,g,f,i,c)},get:function(i){var h=document.cookie,g,f=i+"=",d;if(!h){return}d=h.indexOf("; "+f);if(d==-1){d=h.indexOf(f);if(d!=0){return null}}else{d+=2}g=h.indexOf(";",d);if(g==-1){g=h.length}return unescape(h.substring(d+f.length,g))},set:function(i,b,g,f,h,c){document.cookie=i+"="+escape(b)+((g)?"; expires="+g.toGMTString():"")+((f)?"; path="+escape(f):"")+((h)?"; domain="+h:"")+((c)?"; secure":"")},remove:function(e,b){var c=new Date();c.setTime(c.getTime()-1000);this.set(e,"",c,b,c)}})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/JSON.js' */
(function(){function serialize(o,quote){var i,v,t;quote=quote||'"';if(o==null){return"null"}t=typeof o;if(t=="string"){v="\bb\tt\nn\ff\rr\"\"''\\\\";return quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){if(quote==='"'&&a==="'"){return a}i=v.indexOf(b);if(i+1){return"\\"+v.charAt(i+1)}a=b.charCodeAt().toString(16);return"\\u"+"0000".substring(a.length)+a})+quote}if(t=="object"){if(o.hasOwnProperty&&o instanceof Array){for(i=0,v="[";i<o.length;i++){v+=(i>0?",":"")+serialize(o[i],quote)}return v+"]"}v="{";for(i in o){if(o.hasOwnProperty(i)){v+=typeof o[i]!="function"?(v.length>1?","+quote:quote)+i+quote+":"+serialize(o[i],quote):""}}return v+"}"}return""+o}tinymce.util.JSON={serialize:serialize,parse:function(s){try{return eval("("+s+")")}catch(ex){}}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/XHR.js' */
tinymce.create("static tinymce.util.XHR",{send:function(g){var a,e,b=window,h=0;g.scope=g.scope||this;g.success_scope=g.success_scope||g.scope;g.error_scope=g.error_scope||g.scope;g.async=g.async===false?false:true;g.data=g.data||"";function d(i){a=0;try{a=new ActiveXObject(i)}catch(c){}return a}a=b.XMLHttpRequest?new XMLHttpRequest():d("Microsoft.XMLHTTP")||d("Msxml2.XMLHTTP");if(a){if(a.overrideMimeType){a.overrideMimeType(g.content_type)}a.open(g.type||(g.data?"POST":"GET"),g.url,g.async);if(g.content_type){a.setRequestHeader("Content-Type",g.content_type)}a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.send(g.data);function f(){if(!g.async||a.readyState==4||h++>10000){if(g.success&&h<10000&&a.status==200){g.success.call(g.success_scope,""+a.responseText,a,g)}else{if(g.error){g.error.call(g.error_scope,h>10000?"TIMED_OUT":"GENERAL",a,g)}}a=null}else{b.setTimeout(f,10)}}if(!g.async){return f()}e=b.setTimeout(f,10)}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/JSONRequest.js' */
(function(){var c=tinymce.extend,b=tinymce.util.JSON,a=tinymce.util.XHR;tinymce.create("tinymce.util.JSONRequest",{JSONRequest:function(d){this.settings=c({},d);this.count=0},send:function(f){var e=f.error,d=f.success;f=c(this.settings,f);f.success=function(h,g){h=b.parse(h);if(typeof(h)=="undefined"){h={error:"JSON Parse error."}}if(h.error){e.call(f.error_scope||f.scope,h.error,g)}else{d.call(f.success_scope||f.scope,h.result)}};f.error=function(h,g){if(e){e.call(f.error_scope||f.scope,h,g)}};f.data=b.serialize({id:f.id||"c"+(this.count++),method:f.method,params:f.params});f.content_type="application/json";a.send(f)},"static":{sendRPC:function(d){return new tinymce.util.JSONRequest().send(d)}}})}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/VK.js' */
(function(a){a.VK={DELETE:46,BACKSPACE:8,ENTER:13,TAB:9,SPACEBAR:32,UP:38,DOWN:40,modifierPressed:function(b){return b.shiftKey||b.ctrlKey||b.altKey}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Quirks.js' */
(function(m){var k=m.VK,l=k.BACKSPACE,i=k.DELETE;function c(o){var r=o.dom,p=o.selection;function q(s,t){var u;u=r.getParent(s.startContainer,r.isBlock);if(t){return[u,r.getNext(u,r.isBlock)]}return[r.getPrev(u,r.isBlock),u]}o.onKeyDown.add(function(t,v){var s,w,u;u=v.keyCode==i;if((u||v.keyCode==l)&&!k.modifierPressed(v)){v.preventDefault();s=p.getRng();w=q(s,u);m.each(AJS.$(w).find("span"),function(x){x.setAttribute("data-mce-mark","1")});t.getDoc().execCommand(u?"ForwardDelete":"Delete",false,null);m.each(AJS.$(w).find("span"),function(x){if(!x.getAttribute("data-mce-mark")){if(x.style.color){AJS.$(x).attr("style",("color: "+x.style.color))}else{r.remove(x,true)}}else{x.removeAttribute("data-mce-mark")}})}})}function d(o){function p(s){var r=o.dom.create("body");var t=s.cloneContents();r.appendChild(t);return o.selection.serializer.serialize(r,{format:"html"})}function q(r){var t=p(r);var u=o.dom.createRng();u.selectNode(o.getBody());var s=p(u);return t===s}o.onKeyDown.addToTop(function(s,u){var t=u.keyCode;if(t==i||t==l){var r=s.selection.getRng(true);if(!r.collapsed&&q(r)){s.setContent("",{format:"raw"});s.nodeChanged();u.preventDefault()}}})}function b(o){o.dom.bind(o.getDoc(),"focusin",function(){setTimeout(function(){o.selection.setRng(o.selection.getRng())},0)})}function e(o){o.onKeyDown.add(function(p,s){if(s.keyCode===l){if(p.selection.isCollapsed()&&p.selection.getRng(true).startOffset===0){var r=p.selection.getNode();var q=r.previousSibling;if(q&&q.nodeName&&q.nodeName.toLowerCase()==="hr"){p.dom.remove(q);m.dom.Event.cancel(s)}}}})}function f(o){function p(v){return v.parentNode?v.parentNode.childNodes||[]:[]}function u(v){var x=true,w=/TABLE|TH|TD/;x=!w.test(v.nodeName);x=(x&&v.previousSibling)?!w.test(v.previousSibling.nodeName):x;x=(x&&v.nextSibling)?!w.test(v.nextSibling.nodeName):x;return x}function r(v,x,w){var y=/^&nbsp;$|^<br>$/,z;w=w||x;z=p(w);return u(x)&&(y.test(v)||(z.length>1&&z[0].nodeName=="BR"))}function t(v,w){v.dom.remove(w)}function s(w,x){var y=w.selection,v=y.getRng(true);w.focus();x.focus();v.setStart(x,0);v.setEnd(x,0);y.setRng(v)}function q(v){return v&&v.innerHTML&&(v.innerHTML.replace(/\uFEFF|\u200B/g,"")||"&nbsp;")}o.onKeyDown.add(function(x,C){var z=x.selection.getNode(),A=z.nextSibling,w=x.selection.isCollapsed(),v,B,y;if(w&&z!=x.dom.getRoot()){if(C.keyCode===l){if(x.selection.getRng(true).startOffset===0){v=z.previousSibling;B=q(v);if(v&&r(B,z,v)){t(x,v);m.dom.Event.cancel(C)}}}else{if(C.keyCode==i){B=q(z);y=z.innerText||z.textContent||"";if(p(z).length<=1||z.childNodes.length>1){return}if(A&&r(B,z,A)){t(x,z);m.dom.Event.cancel(C);s(x,A)}}}}})}function h(o){if(!Range.prototype.getClientRects){o.onMouseDown.add(function(q,r){if(r.target.nodeName==="HTML"){var p=q.getBody();p.blur();setTimeout(function(){p.focus()},0)}})}}function g(o){o.onClick.add(function(p,q){q=q.target;if(/^(IMG|HR)$/.test(q.nodeName)){p.selection.getSel().setBaseAndExtent(q,0,q,1)}if(q.nodeName=="A"&&p.dom.hasClass(q,"mceItemAnchor")){p.selection.select(q)}p.nodeChanged()})}function j(o){o.onKeyDown.add(function(p,q){function r(s){var t=s.selection.getNode();var u="h1,h2,h3,h4,h5,h6";return s.dom.is(t,u)||s.dom.getParent(t,u)!==null}if(q.keyCode===k.ENTER&&!k.modifierPressed(q)&&r(p)){setTimeout(function(){var s=p.selection.getNode();if(p.dom.is(s,"p")){p.dom.setAttrib(s,"style",null);p.execCommand("mceCleanup")}},0)}})}function g(o){o.onClick.add(function(p,q){q=q.target;if(/^(IMG|HR)$/.test(q.nodeName)){p.selection.getSel().setBaseAndExtent(q,0,q,1)}if(q.nodeName=="A"&&p.dom.hasClass(q,"mceItemAnchor")){p.selection.select(q)}p.nodeChanged()})}function a(o){document.body.setAttribute("role","application")}function n(o){var q,p;o.dom.bind(o.getDoc(),"selectionchange",function(){if(p){clearTimeout(p);p=0}p=window.setTimeout(function(){var r=o.selection.getRng();if(!q||!m.dom.RangeUtils.compareRanges(r,q)){o.nodeChanged();q=r}},50)})}function a(o){document.body.setAttribute("role","application")}m.create("tinymce.util.Quirks",{Quirks:function(o){if(m.isWebKit){if(m.isChrome){c(o)}d(o);b(o);g(o);if(m.isIDevice){n(o)}f(o)}if(m.isIE){e(o);d(o);a(o);j(o);f(o)}if(m.isGecko){e(o);f(o);h(o)}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Entities.js' */
(function(j){var a,g,d,k=/[&<>\"\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,b=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=/[<>&\"\']/g,c=/&(#x|#)?([\w]+);/g,i={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"};g={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;"};d={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};function h(l){var m;m=document.createElement("div");m.innerHTML=l;return m.textContent||m.innerText||l}function e(m,p){var n,o,l,q={};if(m){m=m.split(",");p=p||10;for(n=0;n<m.length;n+=2){o=String.fromCharCode(parseInt(m[n],p));if(!g[o]){l="&"+m[n+1]+";";q[o]=l;q[l]=o}}return q}}a=e("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);j.html=j.html||{};j.html.Entities={encodeRaw:function(m,l){return m.replace(l?k:b,function(n){return g[n]||n})},encodeAllRaw:function(l){return(""+l).replace(f,function(m){return g[m]||m})},encodeNumeric:function(m,l){return m.replace(l?k:b,function(n){if(n.length>1){return"&#"+(((n.charCodeAt(0)-55296)*1024)+(n.charCodeAt(1)-56320)+65536)+";"}return g[n]||"&#"+n.charCodeAt(0)+";"})},encodeNamed:function(n,l,m){m=m||a;return n.replace(l?k:b,function(o){return g[o]||m[o]||o})},getEncodeFunc:function(l,o){var p=j.html.Entities;o=e(o)||a;function m(r,q){return r.replace(q?k:b,function(s){return g[s]||o[s]||"&#"+s.charCodeAt(0)+";"||s})}function n(r,q){return p.encodeNamed(r,q,o)}l=j.makeMap(l.replace(/\+/g,","));if(l.named&&l.numeric){return m}if(l.named){if(o){return n}return p.encodeNamed}if(l.numeric){return p.encodeNumeric}return p.encodeRaw},decode:function(l){return l.replace(c,function(n,m,o){if(m){o=parseInt(o,m.length===2?16:10);if(o>65535){o-=65536;return String.fromCharCode(55296+(o>>10),56320+(o&1023))}else{return i[o]||String.fromCharCode(o)}}return d[n]||a[n]||h(n)})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Styles.js' */
tinymce.html.Styles=function(d,f){var k=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,h=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,b=/\s*([^:]+):\s*([^;]+);?/g,l=/\s+$/,m=/rgb/,e,g,a={},j;d=d||{};j="\\\" \\' \\; \\: ; : \uFEFF".split(" ");for(g=0;g<j.length;g++){a[j[g]]="\uFEFF"+g;a["\uFEFF"+g]=j[g]}function c(n,q,p,i){function o(r){r=parseInt(r).toString(16);return r.length>1?r:"0"+r}return"#"+o(q)+o(p)+o(i)}return{toHex:function(i){return i.replace(k,c)},parse:function(r){var x={},p,n,v,q,u=d.url_converter,w=d.url_converter_scope||this;function o(B,E){var D,A,z,C;D=x[B+"-top"+E];if(!D){return}A=x[B+"-right"+E];if(D!=A){return}z=x[B+"-bottom"+E];if(A!=z){return}C=x[B+"-left"+E];if(z!=C){return}x[B+E]=C;delete x[B+"-top"+E];delete x[B+"-right"+E];delete x[B+"-bottom"+E];delete x[B+"-left"+E]}function t(A){var B=x[A],z;if(!B||B.indexOf(" ")<0){return}B=B.split(" ");z=B.length;while(z--){if(B[z]!==B[0]){return false}}x[A]=B[0];return true}function y(B,A,z,C){if(!t(A)){return}if(!t(z)){return}if(!t(C)){return}x[B]=x[A]+" "+x[z]+" "+x[C];delete x[A];delete x[z];delete x[C]}function s(z){q=true;return a[z]}function i(A,z){if(q){A=A.replace(/\uFEFF[0-9]/g,function(B){return a[B]})}if(!z){A=A.replace(/\\([\'\";:])/g,"$1")}return A}if(r){r=r.replace(/\\[\"\';:\uFEFF]/g,s).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(z){return z.replace(/[;:]/g,s)});while(p=b.exec(r)){n=p[1].replace(l,"").toLowerCase();v=p[2].replace(l,"");if(n&&v.length>0){if(n==="font-weight"&&v==="700"){v="bold"}else{if(n==="color"||n==="background-color"){v=v.toLowerCase()}}v=v.replace(k,c);v=v.replace(h,function(A,z,D,C,E,B){E=E||B;if(E){E=i(E);return"'"+E.replace(/\'/g,"\\'")+"'"}z=i(z||D||C);if(u){z=u.call(w,z,"style")}return"url('"+z.replace(/\'/g,"\\'")+"')"});x[n]=q?i(v,true):v}b.lastIndex=p.index+p[0].length}o("border","");o("border","-width");o("border","-color");o("border","-style");o("padding","");o("margin","");y("border","border-width","border-style","border-color");if(x.border==="medium none"){delete x.border}}return x},serialize:function(p,r){var o="",n,q;function i(t){var w,u,s,v;w=f.styles[t];if(w){for(u=0,s=w.length;u<s;u++){t=w[u];v=p[t];if(v!==e&&v.length>0){o+=(o.length>0?" ":"")+t+": "+v+";"}}}}if(r&&f&&f.styles){i("*");i(r)}else{for(n in p){q=p[n];if(q!==e&&q.length>0){o+=(o.length>0?" ":"")+n+": "+q+";"}}}return o}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Schema.js' */
(function(m){var h={},j,l,g,f,c={},b,e,d=m.makeMap,k=m.each;function i(o,n){return o.split(n||",")}function a(r,q){var o,p={};function n(s){return s.replace(/[A-Z]+/g,function(t){return n(r[t])})}for(o in r){if(r.hasOwnProperty(o)){r[o]=n(r[o])}}n(q).replace(/#/g,"#text").replace(/(\w+)\[([^\]]+)\]\[([^\]]*)\]/g,function(v,t,s,u){s=i(s,"|");p[t]={attributes:d(s),attributesOrder:s,children:d(u,"|",{"#comment":{}})}});return p}l="h1,h2,h3,h4,h5,h6,hr,p,div,address,pre,form,table,tbody,thead,tfoot,th,tr,td,li,ol,ul,caption,blockquote,center,dl,dt,dd,dir,fieldset,noscript,menu,isindex,samp,header,footer,article,section,hgroup";l=d(l,",",d(l.toUpperCase()));h=a({Z:"H|K|N|O|P",Y:"X|form|R|Q",ZG:"E|span|width|align|char|charoff|valign",X:"p|T|div|U|W|isindex|fieldset|table",ZF:"E|align|char|charoff|valign",W:"pre|hr|blockquote|address|center|noframes",ZE:"abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height",ZD:"[E][S]",U:"ul|ol|dl|menu|dir",ZC:"p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q",T:"h1|h2|h3|h4|h5|h6",ZB:"X|S|Q",S:"R|P",ZA:"a|G|J|M|O|P",R:"a|H|K|N|O",Q:"noscript|P",P:"ins|del|script",O:"input|select|textarea|label|button",N:"M|L",M:"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym",L:"sub|sup",K:"J|I",J:"tt|i|b|u|s|strike",I:"big|small|font|basefont",H:"G|F",G:"br|span|bdo",F:"object|applet|img|map|iframe",E:"A|B|C",D:"accesskey|tabindex|onfocus|onblur",C:"onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"lang|xml:lang|dir",A:"id|class|style|title"},"script[id|charset|type|language|src|defer|xml:space][]style[B|id|type|media|title|xml:space][]object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]param[id|name|value|valuetype|type][]p[E|align][#|S]a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]br[A|clear][]span[E][#|S]bdo[A|C|B][#|S]applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]h1[E|align][#|S]img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]map[B|C|A|name][X|form|Q|area]h2[E|align][#|S]iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]h3[E|align][#|S]tt[E][#|S]i[E][#|S]b[E][#|S]u[E][#|S]s[E][#|S]strike[E][#|S]big[E][#|S]small[E][#|S]font[A|B|size|color|face][#|S]basefont[id|size|color|face][]em[E][#|S]strong[E][#|S]dfn[E][#|S]code[E][#|S]q[E|cite][#|S]samp[E][#|S]kbd[E][#|S]var[E][#|S]cite[E][#|S]abbr[E][#|S]acronym[E][#|S]sub[E][#|S]sup[E][#|S]input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]optgroup[E|disabled|label][option]option[E|selected|disabled|label|value][]textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]label[E|for|accesskey|onfocus|onblur][#|S]button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[E|align][#|S]ins[E|cite|datetime][#|Y]h5[E|align][#|S]del[E|cite|datetime][#|Y]h6[E|align][#|S]div[E|align][#|Y]ul[E|type|compact][li]li[E|type|value][#|Y]ol[E|type|compact|start][li]dl[E|compact][dt|dd]dt[E][#|S]dd[E][#|Y]menu[E|compact][li]dir[E|compact][li]pre[E|width|xml:space][#|ZA]hr[E|align|noshade|size|width][]blockquote[E|cite][#|Y]address[E][#|S|p]center[E][#|Y]noframes[E][#|Y]isindex[A|B|prompt][]fieldset[E][#|legend|Y]legend[E|accesskey|align][#|S]table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]caption[E|align][#|S]col[ZG][]colgroup[ZG][col]thead[ZF][tr]tr[ZF|bgcolor][th|td]th[E|ZE][#|Y]form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]noscript[E][#|Y]td[E|ZE][#|Y]tfoot[ZF][tr]tbody[ZF][tr]area[E|D|shape|coords|href|nohref|alt|target][]base[id|href|target][]body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]");j=d("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected,autoplay,loop,controls");g=d("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,source");f=m.extend(d("td,th,iframe,video,audio,object"),g);b=d("pre,script,style,textarea,code");e=d("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");m.html.Schema=function(r){var z=this,n={},o={},x=[],q,p;r=r||{};if(r.verify_html===false){r.valid_elements="*[*]"}if(r.valid_styles){q={};k(r.valid_styles,function(B,A){q[A]=m.explode(B)})}p=r.whitespace_elements?d(r.whitespace_elements):b;function y(A){return new RegExp("^"+A.replace(/([?+*])/g,".$1")+"$")}function t(H){var G,C,V,R,W,B,E,Q,T,M,U,Y,K,F,S,A,O,D,X,Z,L,P,J=/^([#+-])?([^\[\/]+)(?:\/([^\[]+))?(?:\[([^\]]+)\])?$/,N=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,I=/[*?+]/;if(H){H=i(H);if(n["@"]){O=n["@"].attributes;D=n["@"].attributesOrder}for(G=0,C=H.length;G<C;G++){B=J.exec(H[G]);if(B){S=B[1];M=B[2];A=B[3];T=B[4];K={};F=[];E={attributes:K,attributesOrder:F};if(S==="#"){E.paddEmpty=true}if(S==="-"){E.removeEmpty=true}if(O){for(Z in O){K[Z]=O[Z]}F.push.apply(F,D)}if(T){T=i(T,"|");for(V=0,R=T.length;V<R;V++){B=N.exec(T[V]);if(B){Q={};Y=B[1];U=B[2].replace(/::/g,":");S=B[3];P=B[4];if(Y==="!"){E.attributesRequired=E.attributesRequired||[];E.attributesRequired.push(U);Q.required=true}if(Y==="-"){delete K[U];F.splice(m.inArray(F,U),1);continue}if(S){if(S==="="){E.attributesDefault=E.attributesDefault||[];E.attributesDefault.push({name:U,value:P});Q.defaultValue=P}if(S===":"){E.attributesForced=E.attributesForced||[];E.attributesForced.push({name:U,value:P});Q.forcedValue=P}if(S==="<"){Q.validValues=d(P,"?")}}if(I.test(U)){E.attributePatterns=E.attributePatterns||[];Q.pattern=y(U);E.attributePatterns.push(Q)}else{if(!K[U]){F.push(U)}K[U]=Q}}}}if(!O&&M=="@"){O=K;D=F}if(A){E.outputName=M;n[A]=E}if(I.test(M)){E.pattern=y(M);x.push(E)}else{n[M]=E}}}}}function v(A){n={};x=[];t(A);k(h,function(C,B){o[B]=C.children})}function s(B){var A=/^(~)?(.+)$/;if(B){k(i(B),function(F){var D=A.exec(F),E=D[1]==="~",G=E?"span":"div",C=D[2];o[C]=o[G];c[C]=G;if(!E){l[C]={}}k(o,function(H,I){if(H[G]){H[C]=H[G]}})})}}function u(B){var A=/^([+\-]?)(\w+)\[([^\]]+)\]$/;if(B){k(i(B),function(F){var E=A.exec(F),C,D;if(E){D=E[1];if(D){C=o[E[2]]}else{C=o[E[2]]={"#comment":{}}}C=o[E[2]];k(i(E[3],"|"),function(G){if(D==="-"){delete C[G]}else{C[G]={}}})}})}}function w(A){var C=n[A],B;if(C){return C}B=x.length;while(B--){C=x[B];if(C.pattern.test(A)){return C}}}if(!r.valid_elements){k(h,function(B,A){n[A]={attributes:B.attributes,attributesOrder:B.attributesOrder};o[A]=B.children});k(i("strong/b,em/i"),function(A){A=i(A,"/");n[A[1]].outputName=A[0]});n.img.attributesDefault=[{name:"alt",value:""}];k(i("ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr"),function(A){n[A].removeEmpty=true});k(i("p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption"),function(A){n[A].paddEmpty=true})}else{v(r.valid_elements)}s(r.custom_elements);u(r.valid_children);t(r.extended_valid_elements);u("+ol[ul|ol],+ul[ul|ol]");if(!w("span")){t("span[!data-mce-type|*]")}if(r.invalid_elements){m.each(m.explode(r.invalid_elements),function(A){if(n[A]){delete n[A]}})}z.children=o;z.styles=q;z.getBoolAttrs=function(){return j};z.getBlockElements=function(){return l};z.getShortEndedElements=function(){return g};z.getSelfClosingElements=function(){return e};z.getNonEmptyElements=function(){return f};z.getWhiteSpaceElements=function(){return p};z.isValidChild=function(A,C){var B=o[A];return !!(B&&B[C])};z.getElementRule=w;z.getCustomElements=function(){return c};z.addValidElements=t;z.setValidElements=v;z.addCustomElements=s;z.addValidChildren=u};m.html.Schema.boolAttrMap=j;m.html.Schema.blockElementsMap=l})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/SaxParser.js' */
(function(a){a.html.SaxParser=function(c,e){var b=this,d=function(){};c=c||{};b.schema=e=e||new a.html.Schema();if(c.fix_self_closing!==false){c.fix_self_closing=true}a.each("comment cdata text start end pi doctype".split(" "),function(f){if(f){b[f]=c[f]||d}});b.parse=function(C){var n=this,g,E=0,G,z,y=[],L,O,A,q,x,r,K,F,M,u,m,k,s,P,o,N,D,Q,J,f,H,l,B,I,h,v=0,j=a.html.Entities.decode,w,p;function t(R){var T,S;T=y.length;while(T--){if(y[T].name===R){break}}if(T>=0){for(S=y.length-1;S>=T;S--){R=y[S];if(R.valid){n.end(R.name)}}y.length=T}}l=new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([^\\s\\/<>]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/)>))","g");B=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:\\.|[^\"])*)\")|(?:\'((?:\\.|[^\'])*)\')|([^>\s]+)))?/g;I={script:/<\/script[^>]*>/gi,style:/<\/style[^>]*>/gi,noscript:/<\/noscript[^>]*>/gi};K=e.getShortEndedElements();H=e.getSelfClosingElements();F=e.getBoolAttrs();u=c.validate;r=c.remove_internals;w=c.fix_self_closing;p=a.isIE;o=/^:/;while(g=l.exec(C)){if(E<g.index){n.text(j(C.substr(E,g.index-E)))}if(G=g[6]){G=G.toLowerCase();if(p&&o.test(G)){G=G.substr(1)}t(G)}else{if(G=g[7]){G=G.toLowerCase();if(p&&o.test(G)){G=G.substr(1)}M=G in K;if(w&&H[G]&&y.length>0&&y[y.length-1].name===G){t(G)}if(!u||(m=e.getElementRule(G))){k=true;if(u){N=m.attributes;D=m.attributePatterns}if(P=g[8]){x=P.indexOf("data-mce-type")!==-1;if(x&&r){k=false}L=[];L.map={};P.replace(B,function(S,R,W,V,U){var X,T;R=R.toLowerCase();W=R in F?R:j(W||V||U||"");if(u&&!x&&R.indexOf("data-")!==0){X=N[R];if(!X&&D){T=D.length;while(T--){X=D[T];if(X.pattern.test(R)){break}}if(T===-1){X=null}}if(!X){return}if(X.validValues&&!(W in X.validValues)){return}}L.map[R]=W;L.push({name:R,value:W})})}else{L=[];L.map={}}if(u&&!x){Q=m.attributesRequired;J=m.attributesDefault;f=m.attributesForced;if(f){O=f.length;while(O--){s=f[O];q=s.name;h=s.value;if(h==="{$uid}"){h="mce_"+v++}L.map[q]=h;L.push({name:q,value:h})}}if(J){O=J.length;while(O--){s=J[O];q=s.name;if(!(q in L.map)){h=s.value;if(h==="{$uid}"){h="mce_"+v++}L.map[q]=h;L.push({name:q,value:h})}}}if(Q){O=Q.length;while(O--){if(Q[O] in L.map){break}}if(O===-1){k=false}}if(L.map["data-mce-bogus"]){k=false}}if(k){n.start(G,L,M)}}else{k=false}if(z=I[G]){z.lastIndex=E=g.index+g[0].length;if(g=z.exec(C)){if(k){A=C.substr(E,g.index-E)}E=g.index+g[0].length}else{A=C.substr(E);E=C.length}if(k&&A.length>0){n.text(A,true)}if(k){n.end(G)}l.lastIndex=E;continue}if(!M){if(!P||P.indexOf("/")!=P.length-1){y.push({name:G,valid:k})}else{if(k){n.end(G)}}}}else{if(G=g[1]){n.comment(G)}else{if(G=g[2]){n.cdata(G)}else{if(G=g[3]){n.doctype(G)}else{if(G=g[4]){n.pi(G,g[5])}}}}}}E=g.index+g[0].length}if(E<C.length){n.text(j(C.substr(E)))}for(O=y.length-1;O>=0;O--){G=y[O];if(G.valid){n.end(G.name)}}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Node.js' */
(function(d){var c=/^[ \t\r\n]*$/,e={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};function a(k,l,j){var i,h,f=j?"lastChild":"firstChild",g=j?"prev":"next";if(k[f]){return k[f]}if(k!==l){i=k[g];if(i){return i}for(h=k.parent;h&&h!==l;h=h.parent){i=h[g];if(i){return i}}}}function b(f,g){this.name=f;this.type=g;if(g===1){this.attributes=[];this.attributes.map={}}}d.extend(b.prototype,{replace:function(g){var f=this;if(g.parent){g.remove()}f.insert(g,f);f.remove();return f},attr:function(h,l){var f=this,g,j,k;if(typeof h!=="string"){for(j in h){f.attr(j,h[j])}return f}if(g=f.attributes){if(l!==k){if(l===null){if(h in g.map){delete g.map[h];j=g.length;while(j--){if(g[j].name===h){g=g.splice(j,1);return f}}}return f}if(h in g.map){j=g.length;while(j--){if(g[j].name===h){g[j].value=l;break}}}else{g.push({name:h,value:l})}g.map[h]=l;return f}else{return g.map[h]}}},clone:function(){var g=this,n=new b(g.name,g.type),h,f,m,j,k;if(m=g.attributes){k=[];k.map={};for(h=0,f=m.length;h<f;h++){j=m[h];if(j.name!=="id"){k[k.length]={name:j.name,value:j.value};k.map[j.name]=j.value}}n.attributes=k}n.value=g.value;n.shortEnded=g.shortEnded;return n},wrap:function(g){var f=this;f.parent.insert(g,f);g.append(f);return f},unwrap:function(){var f=this,h,g;for(h=f.firstChild;h;){g=h.next;f.insert(h,f,true);h=g}f.remove()},remove:function(){var f=this,h=f.parent,g=f.next,i=f.prev;if(h){if(h.firstChild===f){h.firstChild=g;if(g){g.prev=null}}else{i.next=g}if(h.lastChild===f){h.lastChild=i;if(i){i.next=null}}else{g.prev=i}f.parent=f.next=f.prev=null}return f},append:function(h){var f=this,g;if(h.parent){h.remove()}g=f.lastChild;if(g){g.next=h;h.prev=g;f.lastChild=h}else{f.lastChild=f.firstChild=h}h.parent=f;return h},insert:function(h,f,i){var g;if(h.parent){h.remove()}g=f.parent||this;if(i){if(f===g.firstChild){g.firstChild=h}else{f.prev.next=h}h.prev=f.prev;h.next=f;f.prev=h}else{if(f===g.lastChild){g.lastChild=h}else{f.next.prev=h}h.next=f.next;h.prev=f;f.next=h}h.parent=g;return h},getAll:function(g){var f=this,h,i=[];for(h=f.firstChild;h;h=a(h,f)){if(h.name===g){i.push(h)}}return i},empty:function(){var g=this,f,h,j;if(g.firstChild){f=[];for(j=g.firstChild;j;j=a(j,g)){f.push(j)}h=f.length;while(h--){j=f[h];j.parent=j.firstChild=j.lastChild=j.next=j.prev=null}}g.firstChild=g.lastChild=null;return g},isEmpty:function(l){l=l||new d.html.Schema();var g=this,k=g.firstChild,j,h,f=l.getNonEmptyElements(),m=l.getWhiteSpaceElements();if(k){do{if(k.type===1){if(k.attributes.map["data-mce-bogus"]){continue}if(f[k.name]){return false}j=k.attributes.length;while(j--){h=k.attributes[j].name;if(h==="name"||h.indexOf("data-")===0){return false}}}if(k.type===8){return false}if(k.type===3&&(!c.test(k.value)||(m[g.name]&&k.value&&k.value.length>0&&c.test(k.value)))){return false}}while(k=a(k,g))}return true},walk:function(f){return a(this,null,f)}});d.extend(b,{create:function(g,f){var i,h;i=new b(g,e[g]||1);if(f){for(h in f){i.attr(h,f[h])}}return i}});d.html.Node=b})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/DomParser.js' */
(function(b){var a=b.html.Node;b.html.DomParser=function(g,h){var f=this,e={},d=[],i={},c={};g=g||{};g.validate="validate" in g?g.validate:true;g.root_name=g.root_name||"body";f.schema=h=h||new b.html.Schema();function j(m){var o,p,w,v,y,n,q,l,t,u,k,s,x,r;s=b.makeMap("tr,td,th,tbody,thead,tfoot,table");k=h.getNonEmptyElements();for(o=0;o<m.length;o++){p=m[o];if(!p.parent){continue}v=[p];for(w=p.parent;w&&!h.isValidChild(w.name,p.name)&&!s[w.name];w=w.parent){v.push(w)}if(w&&v.length>1){v.reverse();y=n=f.filterNode(v[0].clone());for(t=0;t<v.length-1;t++){if(h.isValidChild(n.name,v[t].name)){q=f.filterNode(v[t].clone());n.append(q)}else{q=n}for(l=v[t].firstChild;l&&l!=v[t+1];){r=l.next;q.append(l);l=r}n=q}if(!y.isEmpty(h)){w.insert(y,v[0],true);w.insert(p,y)}else{w.insert(p,v[0],true)}w=v[0];if(w.isEmpty(h)||w.firstChild===w.lastChild&&w.firstChild.name==="br"){w.empty().remove()}}else{if(p.parent){if(p.name==="li"){x=p.prev;if(x&&(x.name==="ul"||x.name==="ul")){x.append(p);continue}x=p.next;if(x&&(x.name==="ul"||x.name==="ul")){x.insert(p,x.firstChild,true);continue}p.wrap(f.filterNode(new a("ul",1)));continue}if(h.isValidChild(p.parent.name,"div")&&h.isValidChild("div",p.name)){p.wrap(f.filterNode(new a("div",1)))}else{if(p.name==="style"||p.name==="script"){p.empty().remove()}else{p.unwrap()}}}}}}f.filterNode=function(m){var l,k,n;if(k in e){n=i[k];if(n){n.push(m)}else{i[k]=[m]}}l=d.length;while(l--){k=d[l].name;if(k in m.attributes.map){n=c[k];if(n){n.push(m)}else{c[k]=[m]}}}return m};f.addNodeFilter=function(k,l){b.each(b.explode(k),function(m){var n=e[m];if(!n){e[m]=n=[]}n.push(l)})};f.addAttributeFilter=function(k,l){b.each(b.explode(k),function(m){var n;for(n=0;n<d.length;n++){if(d[n].name===m){d[n].callbacks.push(l);return}}d.push({name:m,callbacks:[l]})})};f.parse=function(v,m){var n,G,z,y,B,A,w,r,D,J,x,o,C,I=[],t,k,s,p,u,q;m=m||{};i={};c={};o=b.extend(b.makeMap("script,style,head,html,body,title,meta,param"),h.getBlockElements());u=h.getNonEmptyElements();p=h.children;x=g.validate;q="forced_root_block" in m?m.forced_root_block:g.forced_root_block;s=h.getWhiteSpaceElements();C=/^[ \t\r\n]+/;t=/[ \t\r\n]+$/;k=/[ \t\r\n]+/g;function E(){var K=G.firstChild,l,L;while(K){l=K.next;if(K.type==3||(K.type==1&&K.name!=="p"&&!o[K.name]&&!K.attr("data-mce-type"))){if(!L){L=H(q,1);G.insert(L,K);L.append(K)}else{L.append(K)}}else{L=null}K=l}}function H(l,K){var L=new a(l,K),M;if(l in e){M=i[l];if(M){M.push(L)}else{i[l]=[L]}}return L}function F(L){var M,l,K;for(M=L.prev;M&&M.type===3;){l=M.value.replace(t,"");if(l.length>0){M.value=l;M=M.prev}else{K=M.prev;M.remove();M=K}}}n=new b.html.SaxParser({validate:x,fix_self_closing:!x,cdata:function(l){z.append(H("#cdata",4)).value=l},text:function(L,l){var K;if(!s[z.name]){L=L.replace(k," ");if(z.lastChild&&o[z.lastChild.name]){L=L.replace(C,"")}}if(L.length!==0){K=H("#text",3);K.raw=!!l;z.append(K).value=L}},comment:function(l){z.append(H("#comment",8)).value=l},pi:function(l,K){z.append(H(l,7)).value=K;F(z)},doctype:function(K){var l;l=z.append(H("#doctype",10));l.value=K;F(z)},start:function(l,S,L){var Q,N,M,K,O,T,R,P;M=x?h.getElementRule(l):{};if(M){Q=H(M.outputName||l,1);Q.attributes=S;Q.shortEnded=L;z.append(Q);P=p[z.name];if(P&&p[Q.name]&&!P[Q.name]){I.push(Q)}N=d.length;while(N--){O=d[N].name;if(O in S.map){D=c[O];if(D){D.push(Q)}else{c[O]=[Q]}}}if(o[l]){F(Q)}if(!L){z=Q}}},end:function(l){var O,L,N,K,M;L=x?h.getElementRule(l):{};if(L){if(o[l]){if(!s[z.name]){for(O=z.firstChild;O&&O.type===3;){N=O.value.replace(C,"");if(N.length>0){O.value=N;O=O.next}else{K=O.next;O.remove();O=K}}for(O=z.lastChild;O&&O.type===3;){N=O.value.replace(t,"");if(N.length>0){O.value=N;O=O.prev}else{K=O.prev;O.remove();O=K}}}}if(L.removeEmpty||L.paddEmpty){if(z.isEmpty(h)){if(L.paddEmpty){z.empty().append(new a("#text","3")).value="\u00a0"}else{if(!z.attributes.map.name){M=z.parent;z.empty().remove();z=M;return}}}}z=z.parent}}},h);G=z=new a(m.context||g.root_name,11);n.parse(v);if(x&&I.length){if(!m.context){j(I)}else{m.invalid=true}}if(q&&G.name=="body"){E()}if(!m.invalid){for(J in i){D=e[J];y=i[J];w=y.length;while(w--){if(!y[w].parent){y.splice(w,1)}}for(B=0,A=D.length;B<A;B++){D[B](y,J,m)}}for(B=0,A=d.length;B<A;B++){D=d[B];if(D.name in c){y=c[D.name];w=y.length;while(w--){if(!y[w].parent){y.splice(w,1)}}for(w=0,r=D.callbacks.length;w<r;w++){D.callbacks[w](y,D.name,m)}}}}return G};if(g.remove_trailing_brs){f.addNodeFilter("br",function(n,m){var r,q=n.length,o,u=h.getBlockElements(),k=h.getNonEmptyElements(),s,p,t;u.body=1;for(r=0;r<q;r++){o=n[r];s=o.parent;if(u[o.parent.name]&&o===s.lastChild){p=o.prev;while(p){t=p.name;if(t!=="span"||p.attr("data-mce-type")!=="bookmark"){if(t!=="br"){break}if(t==="br"){o=null;break}}p=p.prev}if(o){o.remove();if(s.isEmpty(h)){elementRule=h.getElementRule(s.name);if(elementRule){if(elementRule.removeEmpty){s.remove()}else{if(elementRule.paddEmpty){s.empty().append(new b.html.Node("#text",3)).value="\u00a0"}}}}}}}})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Writer.js' */
tinymce.html.Writer=function(e){var c=[],a,b,d,f,g;e=e||{};a=e.indent;b=tinymce.makeMap(e.indent_before||"");d=tinymce.makeMap(e.indent_after||"");f=tinymce.html.Entities.getEncodeFunc(e.entity_encoding||"raw",e.entities);g=e.element_format=="html";return{start:function(m,k,p){var n,j,h,o;if(a&&b[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!=="\n"){c.push("\n")}}c.push("<",m);if(k){for(n=0,j=k.length;n<j;n++){h=k[n];c.push(" ",h.name,'="',f(h.value,true),'"')}}if(!p||g){c[c.length]=">"}else{c[c.length]=" />"}if(p&&a&&d[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!=="\n"){c.push("\n")}}},end:function(h){var i;c.push("</",h,">");if(a&&d[h]&&c.length>0){i=c[c.length-1];if(i.length>0&&i!=="\n"){c.push("\n")}}},text:function(i,h){if(i.length>0){c[c.length]=h?i:f(i)}},cdata:function(h){c.push("<![CDATA[",h,"]]>")},comment:function(h){c.push("<!--",h,"-->")},pi:function(h,i){if(i){c.push("<?",h," ",i,"?>")}else{c.push("<?",h,"?>")}if(a){c.push("\n")}},doctype:function(h){c.push("<!DOCTYPE",h,">",a?"\n":"")},reset:function(){c.length=0},getContent:function(){return c.join("").replace(/\n$/,"")}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Serializer.js' */
(function(a){a.html.Serializer=function(c,d){var b=this,e=new a.html.Writer(c);c=c||{};c.validate="validate" in c?c.validate:true;b.schema=d=d||new a.html.Schema();b.writer=e;b.serialize=function(h){var g,i;i=c.validate;g={3:function(k,j){e.text(k.value,k.raw)},8:function(j){e.comment(j.value)},7:function(j){e.pi(j.name,j.value)},10:function(j){e.doctype(j.value)},4:function(j){e.cdata(j.value)},11:function(j){if((j=j.firstChild)){do{f(j)}while(j=j.next)}}};e.reset();function f(k){var t=g[k.type],j,o,s,r,p,u,n,m,q;if(!t){j=k.name;o=k.shortEnded;s=k.attributes;if(i&&s&&s.length>1){u=[];u.map={};q=d.getElementRule(k.name);for(n=0,m=q.attributesOrder.length;n<m;n++){r=q.attributesOrder[n];if(r in s.map){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}for(n=0,m=s.length;n<m;n++){r=s[n].name;if(!(r in u.map)){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}s=u}e.start(k.name,s,o);if(!o){if((k=k.firstChild)){do{f(k)}while(k=k.next)}e.end(j)}}else{t(k)}}if(h.type==1&&!c.inner){f(h)}else{g[11](h)}return e.getContent()}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/DOMUtils.js' */
(function(h){var f=h.each,e=h.is,d=h.isWebKit,b=h.isIE,c=h.html.Entities,a=/^([a-z0-9],?)+$/i,g=h.html.Schema.blockElementsMap,i=/^[ \t\r\n]*$/;h.create("tinymce.dom.DOMUtils",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},DOMUtils:function(o,m){var l=this,j,k;l.doc=o;l.win=window;l.files={};l.cssFlicker=false;l.counter=0;l.stdMode=!h.isIE||o.documentMode>=8;l.boxModel=!h.isIE||o.compatMode=="CSS1Compat"||l.stdMode;l.hasOuterHTML="outerHTML" in o.createElement("a");l.settings=m=h.extend({keep_values:false,hex_colors:1},m);l.schema=m.schema;l.styles=new h.html.Styles({url_converter:m.url_converter,url_converter_scope:m.url_converter_scope},m.schema);if(h.isIE6){try{o.execCommand("BackgroundImageCache",false,true)}catch(n){l.cssFlicker=true}}if(b&&m.schema){("abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video").replace(/\w+/g,function(p){o.createElement(p)});for(k in m.schema.getCustomElements()){o.createElement(k)}}h.addUnload(l.destroy,l)},getRoot:function(){var j=this,k=j.settings;return(k&&j.get(k.root_element))||j.doc.body},getViewPort:function(k){var l,j;k=!k?this.win:k;l=k.document;j=this.boxModel?l.documentElement:l.body;return{x:k.pageXOffset||j.scrollLeft,y:k.pageYOffset||j.scrollTop,w:k.innerWidth||j.clientWidth,h:k.innerHeight||j.clientHeight}},getRect:function(m){var l,j=this,k;m=j.get(m);l=j.getPos(m);k=j.getSize(m);return{x:l.x,y:l.y,w:k.w,h:k.h}},getSize:function(m){var k=this,j,l;m=k.get(m);j=k.getStyle(m,"width");l=k.getStyle(m,"height");if(j.indexOf("px")===-1){j=0}if(l.indexOf("px")===-1){l=0}return{w:parseInt(j)||m.offsetWidth||m.clientWidth,h:parseInt(l)||m.offsetHeight||m.clientHeight}},getParent:function(l,k,j){return this.getParents(l,k,j,false)},getParents:function(u,p,l,s){var k=this,j,m=k.settings,q=[];u=k.get(u);s=s===undefined;if(m.strict_root){l=l||k.getRoot()}if(e(p,"string")){j=p;if(p==="*"){p=function(o){return o.nodeType==1}}else{p=function(o){return k.is(o,j)}}}while(u){if(u==l||!u.nodeType||u.nodeType===9){break}if(!p||p(u)){if(s){q.push(u)}else{return u}}u=u.parentNode}return s?q:null},get:function(j){var k;if(j&&this.doc&&typeof(j)=="string"){k=j;j=this.doc.getElementById(j);if(j&&j.id!==k){return this.doc.getElementsByName(k)[1]}}return j},getNext:function(k,j){return this._findSib(k,j,"nextSibling")},getPrev:function(k,j){return this._findSib(k,j,"previousSibling")},select:function(l,k){var j=this;return h.dom.Sizzle(l,j.get(k)||j.get(j.settings.root_element)||j.doc,[])},is:function(l,j){var k;if(l.length===undefined){if(j==="*"){return l.nodeType==1}if(a.test(j)){j=j.toLowerCase().split(/,/);l=l.nodeName.toLowerCase();for(k=j.length-1;k>=0;k--){if(j[k]==l){return true}}return false}}return h.dom.Sizzle.matches(j,l.nodeType?[l]:l).length>0},add:function(m,q,j,l,o){var k=this;return this.run(m,function(s){var r,n;r=e(q,"string")?k.doc.createElement(q):q;k.setAttribs(r,j);if(l){if(l.nodeType){r.appendChild(l)}else{k.setHTML(r,l)}}return !o?s.appendChild(r):r})},create:function(l,j,k){return this.add(this.doc.createElement(l),l,j,k,1)},createHTML:function(r,j,p){var q="",m=this,l;q+="<"+r;for(l in j){if(j.hasOwnProperty(l)){q+=" "+l+'="'+m.encode(j[l])+'"'}}if(typeof(p)!="undefined"){return q+">"+p+"</"+r+">"}return q+" />"},remove:function(j,k){return this.run(j,function(m){var n,l=m.parentNode;if(!l){return null}if(k){while(n=m.firstChild){if(!h.isIE||n.nodeType!==3||n.nodeValue){l.insertBefore(n,m)}else{m.removeChild(n)}}}return l.removeChild(m)})},setStyle:function(m,j,k){var l=this;return l.run(m,function(p){var o,n;o=p.style;j=j.replace(/-(\D)/g,function(r,q){return q.toUpperCase()});if(l.pixelStyles.test(j)&&(h.is(k,"number")||/^[\-0-9\.]+$/.test(k))){k+="px"}switch(j){case"opacity":if(b){o.filter=k===""?"":"alpha(opacity="+(k*100)+")";if(!m.currentStyle||!m.currentStyle.hasLayout){o.display="inline-block"}}o[j]=o["-moz-opacity"]=o["-khtml-opacity"]=k||"";break;case"float":b?o.styleFloat=k:o.cssFloat=k;break;default:o[j]=k||""}if(l.settings.update_styles){l.setAttrib(p,"data-mce-style")}})},getStyle:function(m,j,l){m=this.get(m);if(!m){return}if(this.doc.defaultView&&l){j=j.replace(/[A-Z]/g,function(n){return"-"+n});try{return this.doc.defaultView.getComputedStyle(m,null).getPropertyValue(j)}catch(k){return null}}j=j.replace(/-(\D)/g,function(o,n){return n.toUpperCase()});if(j=="float"){j=b?"styleFloat":"cssFloat"}if(m.currentStyle&&l){return m.currentStyle[j]}return m.style?m.style[j]:undefined},setStyles:function(m,n){var k=this,l=k.settings,j;j=l.update_styles;l.update_styles=0;f(n,function(o,p){k.setStyle(m,p,o)});l.update_styles=j;if(l.update_styles){k.setAttrib(m,l.cssText)}},removeAllAttribs:function(j){return this.run(j,function(m){var l,k=m.attributes;for(l=k.length-1;l>=0;l--){m.removeAttributeNode(k.item(l))}})},setAttrib:function(l,m,j){var k=this;if(!l||!m){return}if(k.settings.strict){m=m.toLowerCase()}return this.run(l,function(q){var p=k.settings;var n=q.getAttribute(m);if(j!==null){switch(m){case"style":if(!e(j,"string")){f(j,function(r,s){k.setStyle(q,s,r)});return}if(p.keep_values){if(j&&!k._isRes(j)){q.setAttribute("data-mce-style",j,2)}else{q.removeAttribute("data-mce-style",2)}}q.style.cssText=j;break;case"class":q.className=j||"";break;case"src":case"href":if(p.keep_values){if(p.url_converter){j=p.url_converter.call(p.url_converter_scope||k,j,m,q)}k.setAttrib(q,"data-mce-"+m,j,2)}break;case"shape":q.setAttribute("data-mce-style",j);break}}if(e(j)&&j!==null&&j.length!==0){q.setAttribute(m,""+j,2)}else{q.removeAttribute(m,2)}if(tinyMCE.activeEditor&&n!=j){var o=tinyMCE.activeEditor;o.onSetAttrib.dispatch(o,q,m,j)}})},setAttribs:function(k,l){var j=this;return this.run(k,function(m){f(l,function(o,p){j.setAttrib(m,p,o)})})},getAttrib:function(o,p,l){var j,k=this,m;o=k.get(o);if(!o||o.nodeType!==1){return l===m?false:l}if(!e(l)){l=""}if(/^(src|href|style|coords|shape)$/.test(p)){j=o.getAttribute("data-mce-"+p);if(j){return j}}if(b&&k.props[p]){j=o[k.props[p]];j=j&&j.nodeValue?j.nodeValue:j}if(!j){j=o.getAttribute(p,2)}if(/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(p)){if(o[k.props[p]]===true&&j===""){return p}return j?p:""}if(o.nodeName==="FORM"&&o.getAttributeNode(p)){return o.getAttributeNode(p).nodeValue}if(p==="style"){j=j||o.style.cssText;if(j){j=k.serializeStyle(k.parseStyle(j),o.nodeName);if(k.settings.keep_values&&!k._isRes(j)){o.setAttribute("data-mce-style",j)}}}if(d&&p==="class"&&j){j=j.replace(/(apple|webkit)\-[a-z\-]+/gi,"")}if(b){switch(p){case"rowspan":case"colspan":if(j===1){j=""}break;case"size":if(j==="+0"||j===20||j===0){j=""}break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":if(j===0){j=""}break;case"hspace":if(j===-1){j=""}break;case"maxlength":case"tabindex":if(j===32768||j===2147483647||j==="32768"){j=""}break;case"multiple":case"compact":case"noshade":case"nowrap":if(j===65535){return p}return l;case"shape":j=j.toLowerCase();break;default:if(p.indexOf("on")===0&&j){j=h._replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1",""+j)}}}return(j!==m&&j!==null&&j!=="")?""+j:l},getPos:function(s,m){var k=this,j=0,q=0,o,p=k.doc,l;s=k.get(s);m=m||p.body;if(s){if(s.getBoundingClientRect){s=s.getBoundingClientRect();o=k.boxModel?p.documentElement:p.body;j=s.left+(p.documentElement.scrollLeft||p.body.scrollLeft)-o.clientTop;q=s.top+(p.documentElement.scrollTop||p.body.scrollTop)-o.clientLeft;return{x:j,y:q}}l=s;while(l&&l!=m&&l.nodeType){j+=l.offsetLeft||0;q+=l.offsetTop||0;l=l.offsetParent}l=s.parentNode;while(l&&l!=m&&l.nodeType){j-=l.scrollLeft||0;q-=l.scrollTop||0;l=l.parentNode}}return{x:j,y:q}},parseStyle:function(j){return this.styles.parse(j)},serializeStyle:function(k,j){return this.styles.serialize(k,j)},loadCSS:function(j){var l=this,m=l.doc,k;if(!j){j=""}k=l.select("head")[0];f(j.split(","),function(n){var o;if(l.files[n]){return}l.files[n]=true;o=l.create("link",{rel:"stylesheet",href:h._addVer(n)});if(b&&m.documentMode&&m.recalc){o.onload=function(){if(m.recalc){m.recalc()}o.onload=null}}k.appendChild(o)})},addClass:function(j,k){return this.run(j,function(l){var m;if(!k){return 0}if(this.hasClass(l,k)){return l.className}m=this.removeClass(l,k);return l.className=(m!=""?(m+" "):"")+k})},removeClass:function(l,m){var j=this,k;return j.run(l,function(o){var n;if(j.hasClass(o,m)){if(!k){k=new RegExp("(^|\\s+)"+m+"(\\s+|$)","g")}n=o.className.replace(k," ");n=h.trim(n!=" "?n:"");o.className=n;if(!n){o.removeAttribute("class");o.removeAttribute("className")}return n}return o.className})},hasClass:function(k,j){k=this.get(k);if(!k||!j){return false}return(" "+k.className+" ").indexOf(" "+j+" ")!==-1},show:function(j){return this.setStyle(j,"display","block")},hide:function(j){return this.setStyle(j,"display","none")},isHidden:function(j){j=this.get(j);return !j||j.style.display=="none"||this.getStyle(j,"display")=="none"},uniqueId:function(j){return(!j?"mce_":j)+(this.counter++)},setHTML:function(l,k){var j=this;return j.run(l,function(n){if(b){while(n.firstChild){n.removeChild(n.firstChild)}try{n.innerHTML="<br />"+k;n.removeChild(n.firstChild)}catch(m){n=j.create("div");n.innerHTML="<br />"+k;f(n.childNodes,function(p,o){if(o){n.appendChild(p)}})}}else{n.innerHTML=k}return k})},getOuterHTML:function(l){var k,j=this;l=j.get(l);if(!l){return null}if(l.nodeType===1&&j.hasOuterHTML){return l.outerHTML}k=(l.ownerDocument||j.doc).createElement("body");k.appendChild(l.cloneNode(true));return k.innerHTML},setOuterHTML:function(m,k,n){var j=this;function l(p,o,r){var s,q;q=r.createElement("body");q.innerHTML=o;s=q.lastChild;while(s){j.insertAfter(s.cloneNode(true),p);s=s.previousSibling}j.remove(p)}return this.run(m,function(p){p=j.get(p);if(p.nodeType==1){n=n||p.ownerDocument||j.doc;if(b){try{if(b&&p.nodeType==1){p.outerHTML=k}else{l(p,k,n)}}catch(o){l(p,k,n)}}else{l(p,k,n)}}})},decode:c.decode,encode:c.encodeAllRaw,insertAfter:function(j,k){k=this.get(k);return this.run(j,function(m){var l,n;l=k.parentNode;n=k.nextSibling;if(n){l.insertBefore(m,n)}else{l.appendChild(m)}return m})},isBlock:function(k){var j=k.nodeType;if(j){return !!(j===1&&g[k.nodeName])}return !!g[k]},replace:function(p,m,j){var l=this;if(e(m,"array")){p=p.cloneNode(true)}return l.run(m,function(k){if(j){f(h.grep(k.childNodes),function(n){p.appendChild(n)})}return k.parentNode.replaceChild(p,k)})},rename:function(m,j){var l=this,k;if(m.nodeName!=j.toUpperCase()){k=l.create(j);f(l.getAttribs(m),function(n){l.setAttrib(k,n.nodeName,l.getAttrib(m,n.nodeName))});l.replace(k,m,1)}return k||m},findCommonAncestor:function(l,j){var m=l,k;while(m){k=j;while(k&&m!=k){k=k.parentNode}if(m==k){break}m=m.parentNode}if(!m&&l.ownerDocument){return l.ownerDocument.documentElement}return m},toHex:function(j){var l=/^\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*$/i.exec(j);function k(m){m=parseInt(m).toString(16);return m.length>1?m:"0"+m}if(l){j="#"+k(l[1])+k(l[2])+k(l[3]);return j}return j},getClasses:function(){var n=this,j=[],m,o={},p=n.settings.class_filter,l;if(n.classes){return n.classes}function q(r){f(r.imports,function(s){q(s)});f(r.cssRules||r.rules,function(s){switch(s.type||1){case 1:if(s.selectorText){f(s.selectorText.split(","),function(t){t=t.replace(/^\s*|\s*$|^\s\./g,"");if(/\.mce/.test(t)||!/\.[\w\-]+$/.test(t)){return}l=t;t=h._replace(/.*\.([a-z0-9_\-]+).*/i,"$1",t);if(p&&!(t=p(t,l))){return}if(!o[t]){j.push({"class":t});o[t]=1}})}break;case 3:q(s.styleSheet);break}})}try{f(n.doc.styleSheets,q)}catch(k){}if(j.length>0){n.classes=j}return j},run:function(m,l,k){var j=this,n;if(j.doc&&typeof(m)==="string"){m=j.get(m)}if(!m){return false}k=k||this;if(!m.nodeType&&(m.length||m.length===0)){n=[];f(m,function(p,o){if(p){if(typeof(p)=="string"){p=j.doc.getElementById(p)}n.push(l.call(k,p,o))}});return n}return l.call(k,m)},getAttribs:function(k){var j;k=this.get(k);if(!k){return[]}if(b){j=[];if(k.nodeName=="OBJECT"){return k.attributes}if(k.nodeName==="OPTION"&&this.getAttrib(k,"selected")){j.push({specified:1,nodeName:"selected"})}k.cloneNode(false).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(l){j.push({specified:1,nodeName:l})});return j}return k.attributes},isEmpty:function(m,k){var r=this,o,n,q,j,l,p;m=m.firstChild;if(m){j=new h.dom.TreeWalker(m);k=k||r.schema?r.schema.getNonEmptyElements():null;do{q=m.nodeType;if(q===1){if(m.getAttribute("data-mce-bogus")){continue}l=m.nodeName.toLowerCase();if(k&&k[l]){p=m.parentNode;if(l==="br"&&r.isBlock(p)&&p.firstChild===m&&p.lastChild===m){continue}return false}n=r.getAttribs(m);o=m.attributes.length;while(o--){l=m.attributes[o].nodeName.toLowerCase();if(l==="name"||l==="data-mce-bookmark"||(l==="contenteditable"&&m.attributes[o].value==="true")){return false}}}if(q==8){return false}if((q===3&&!i.test(m.nodeValue))){return false}}while(m=j.next())}return true},destroy:function(k){var j=this;if(j.events){j.events.destroy()}j.win=j.doc=j.root=j.events=null;if(!k){h.removeUnload(j.destroy)}},createRng:function(){var j=this.doc;return j.createRange?j.createRange():new h.dom.Range(this)},nodeIndex:function(n,o){var j=0,l,m,k;if(n){for(l=n.nodeType,n=n.previousSibling,m=n;n;n=n.previousSibling){k=n.nodeType;if(o&&k==3){if(k==l||!n.nodeValue.length){continue}}j++;l=k}}return j},split:function(n,m,q){var s=this,j=s.createRng(),o,l,p;function k(w){var u,t=w.childNodes,v=w.nodeType;function x(A){var z=A.previousSibling&&A.previousSibling.nodeName=="SPAN";var y=A.nextSibling&&A.nextSibling.nodeName=="SPAN";return z&&y}if(v==1&&w.getAttribute("data-mce-type")=="bookmark"){return}for(u=t.length-1;u>=0;u--){k(t[u])}if(v!=9){if(v==3&&w.nodeValue.length>0){var r=h.trim(w.nodeValue).length;if(!s.isBlock(w.parentNode)||r>0||r==0&&x(w)){return}}else{if(v==1){t=w.childNodes;if(t.length==1&&t[0]&&t[0].nodeType==1&&t[0].getAttribute("data-mce-type")=="bookmark"){w.parentNode.insertBefore(t[0],w)}if(t.length||/^(br|hr|input|img)$/i.test(w.nodeName)){return}}}s.remove(w)}return w}if(n&&m){j.setStart(n.parentNode,s.nodeIndex(n));j.setEnd(m.parentNode,s.nodeIndex(m));o=j.extractContents();j=s.createRng();j.setStart(m.parentNode,s.nodeIndex(m)+1);j.setEnd(n.parentNode,s.nodeIndex(n)+1);l=j.extractContents();p=n.parentNode;p.insertBefore(k(o),n);if(q){p.replaceChild(q,m)}else{p.insertBefore(m,n)}p.insertBefore(k(l),n);s.remove(n);return q||m}},bind:function(n,j,m,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.add(n,j,m,l||this)},unbind:function(m,j,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.remove(m,j,l)},dumpRng:function(j){return"startContainer: "+j.startContainer.nodeName+", startOffset: "+j.startOffset+", endContainer: "+j.endContainer.nodeName+", endOffset: "+j.endOffset},_findSib:function(m,j,k){var l=this,n=j;if(m){if(e(n,"string")){n=function(o){return l.is(o,j)}}for(m=m[k];m;m=m[k]){if(n(m)){return m}}}return null},_isRes:function(j){return/^(top|left|bottom|right|width|height)/i.test(j)||/;\s*(top|left|bottom|right|width|height)/i.test(j)}});h.DOM=new h.dom.DOMUtils(document,{process_html:0})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Range.js' */
(function(a){function b(c){var M=this,e=c.doc,R=0,D=1,j=2,C=true,Q=false,T="startOffset",h="startContainer",O="endContainer",y="endOffset",k=tinymce.extend,n=c.nodeIndex;k(M,{startContainer:e,startOffset:0,endContainer:e,endOffset:0,collapsed:C,commonAncestorContainer:e,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:q,setEnd:s,setStartBefore:g,setStartAfter:H,setEndBefore:I,setEndAfter:u,collapse:z,selectNode:w,selectNodeContents:E,compareBoundaryPoints:v,deleteContents:p,extractContents:G,cloneContents:d,insertNode:B,surroundContents:L,cloneRange:J});function q(U,t){A(C,U,t)}function s(U,t){A(Q,U,t)}function g(t){q(t.parentNode,n(t))}function H(t){q(t.parentNode,n(t)+1)}function I(t){s(t.parentNode,n(t))}function u(t){s(t.parentNode,n(t)+1)}function z(t){if(t){M[O]=M[h];M[y]=M[T]}else{M[h]=M[O];M[T]=M[y]}M.collapsed=C}function w(t){g(t);u(t)}function E(t){q(t,0);s(t,t.nodeType===1?t.childNodes.length:t.nodeValue.length)}function v(X,t){var aa=M[h],V=M[T],Z=M[O],U=M[y],Y=t.startContainer,ac=t.startOffset,W=t.endContainer,ab=t.endOffset;if(X===0){return F(aa,V,Y,ac)}if(X===1){return F(Z,U,Y,ac)}if(X===2){return F(Z,U,W,ab)}if(X===3){return F(aa,V,W,ab)}}function p(){m(j)}function G(){return m(R)}function d(){return m(D)}function B(X){var U=this[h],t=this[T],W,V;if((U.nodeType===3||U.nodeType===4)&&U.nodeValue){if(!t){U.parentNode.insertBefore(X,U)}else{if(t>=U.nodeValue.length){c.insertAfter(X,U)}else{W=U.splitText(t);U.parentNode.insertBefore(X,W)}}}else{if(U.childNodes.length>0){V=U.childNodes[t]}if(V){U.insertBefore(X,V)}else{U.appendChild(X)}}}function L(U){var t=M.extractContents();M.insertNode(U);U.appendChild(t);M.selectNode(U)}function J(){return k(new b(c),{startContainer:M[h],startOffset:M[T],endContainer:M[O],endOffset:M[y],collapsed:M.collapsed,commonAncestorContainer:M.commonAncestorContainer})}function N(t,U){var V;if(t.nodeType==3){return t}if(U<0){return t}V=t.firstChild;while(V&&U>0){--U;V=V.nextSibling}if(V){return V}return t}function l(){return(M[h]==M[O]&&M[T]==M[y])}function F(W,Y,U,X){var Z,V,t,aa,ac,ab;if(W==U){if(Y==X){return 0}if(Y<X){return -1}return 1}Z=U;while(Z&&Z.parentNode!=W){Z=Z.parentNode}if(Z){V=0;t=W.firstChild;while(t!=Z&&V<Y){V++;t=t.nextSibling}if(Y<=V){return -1}return 1}Z=W;while(Z&&Z.parentNode!=U){Z=Z.parentNode}if(Z){V=0;t=U.firstChild;while(t!=Z&&V<X){V++;t=t.nextSibling}if(V<X){return -1}return 1}aa=c.findCommonAncestor(W,U);ac=W;while(ac&&ac.parentNode!=aa){ac=ac.parentNode}if(!ac){ac=aa}ab=U;while(ab&&ab.parentNode!=aa){ab=ab.parentNode}if(!ab){ab=aa}if(ac==ab){return 0}t=aa.firstChild;while(t){if(t==ac){return -1}if(t==ab){return 1}t=t.nextSibling}}function A(U,X,W){var t,V;if(U){M[h]=X;M[T]=W}else{M[O]=X;M[y]=W}t=M[O];while(t.parentNode){t=t.parentNode}V=M[h];while(V.parentNode){V=V.parentNode}if(V==t){if(F(M[h],M[T],M[O],M[y])>0){M.collapse(U)}}else{M.collapse(U)}M.collapsed=l();M.commonAncestorContainer=c.findCommonAncestor(M[h],M[O])}function m(aa){var Z,W=0,ac=0,U,Y,V,X,t,ab;if(M[h]==M[O]){return f(aa)}for(Z=M[O],U=Z.parentNode;U;Z=U,U=U.parentNode){if(U==M[h]){return r(Z,aa)}++W}for(Z=M[h],U=Z.parentNode;U;Z=U,U=U.parentNode){if(U==M[O]){return S(Z,aa)}++ac}Y=ac-W;V=M[h];while(Y>0){V=V.parentNode;Y--}X=M[O];while(Y<0){X=X.parentNode;Y++}for(t=V.parentNode,ab=X.parentNode;t!=ab;t=t.parentNode,ab=ab.parentNode){V=t;X=ab}return o(V,X,aa)}function f(Y){var aa,X,W,Z,t,V,U;if(Y!=j){aa=e.createDocumentFragment()}if(M[T]==M[y]){return aa}if(M[h].nodeType==3){X=M[h].nodeValue;W=X.substring(M[T],M[y]);if(Y!=D){M[h].deleteData(M[T],M[y]-M[T]);M.collapse(C)}if(Y==j){return}aa.appendChild(e.createTextNode(W));return aa}Z=N(M[h],M[T]);t=M[y]-M[T];while(t>0){V=Z.nextSibling;U=x(Z,Y);if(aa){aa.appendChild(U)}--t;Z=V}if(Y!=D){M.collapse(C)}return aa}function r(aa,X){var Z,Y,U,t,W,V;if(X!=j){Z=e.createDocumentFragment()}Y=i(aa,X);if(Z){Z.appendChild(Y)}U=n(aa);t=U-M[T];if(t<=0){if(X!=D){M.setEndBefore(aa);M.collapse(Q)}return Z}Y=aa.previousSibling;while(t>0){W=Y.previousSibling;V=x(Y,X);if(Z){Z.insertBefore(V,Z.firstChild)}--t;Y=W}if(X!=D){M.setEndBefore(aa);M.collapse(Q)}return Z}function S(Y,X){var aa,U,Z,t,W,V;if(X!=j){aa=e.createDocumentFragment()}Z=P(Y,X);if(aa){aa.appendChild(Z)}U=n(Y);++U;t=M[y]-U;Z=Y.nextSibling;while(t>0){W=Z.nextSibling;V=x(Z,X);if(aa){aa.appendChild(V)}--t;Z=W}if(X!=D){M.setStartAfter(Y);M.collapse(C)}return aa}function o(Y,t,ab){var V,ad,X,Z,aa,U,ac,W;if(ab!=j){ad=e.createDocumentFragment()}V=P(Y,ab);if(ad){ad.appendChild(V)}X=Y.parentNode;Z=n(Y);aa=n(t);++Z;U=aa-Z;ac=Y.nextSibling;while(U>0){W=ac.nextSibling;V=x(ac,ab);if(ad){ad.appendChild(V)}ac=W;--U}V=i(t,ab);if(ad){ad.appendChild(V)}if(ab!=D){M.setStartAfter(Y);M.collapse(C)}return ad}function i(Z,aa){var V=N(M[O],M[y]-1),ab,Y,X,t,U,W=V!=M[O];if(V==Z){return K(V,W,Q,aa)}ab=V.parentNode;Y=K(ab,Q,Q,aa);while(ab){while(V){X=V.previousSibling;t=K(V,W,Q,aa);if(aa!=j){Y.insertBefore(t,Y.firstChild)}W=C;V=X}if(ab==Z){return Y}V=ab.previousSibling;ab=ab.parentNode;U=K(ab,Q,Q,aa);if(aa!=j){U.appendChild(Y)}Y=U}}function P(Z,aa){var W=N(M[h],M[T]),X=W!=M[h],ab,Y,V,t,U;if(W==Z){return K(W,X,C,aa)}ab=W.parentNode;Y=K(ab,Q,C,aa);while(ab){while(W){V=W.nextSibling;t=K(W,X,C,aa);if(aa!=j){Y.appendChild(t)}X=C;W=V}if(ab==Z){return Y}W=ab.nextSibling;ab=ab.parentNode;U=K(ab,Q,C,aa);if(aa!=j){U.appendChild(Y)}Y=U}}function K(t,X,aa,ab){var W,V,Y,U,Z;if(X){return x(t,ab)}if(t.nodeType==3){W=t.nodeValue;if(aa){U=M[T];V=W.substring(U);Y=W.substring(0,U)}else{U=M[y];V=W.substring(0,U);Y=W.substring(U)}if(ab!=D){t.nodeValue=Y}if(ab==j){return}Z=t.cloneNode(Q);Z.nodeValue=V;return Z}if(ab==j){return}return t.cloneNode(Q)}function x(U,t){if(t!=j){return t==D?U.cloneNode(C):U}U.parentNode.removeChild(U)}}a.Range=b})(tinymce.dom);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/TridentSelection.js' */
(function(){function a(d){var b=this,h=d.dom,c=true,f=false;function e(i,j){var k,t=0,q,n,m,l,o,r,p=-1,s;k=i.duplicate();k.collapse(j);s=k.parentElement();if(s.ownerDocument!==d.dom.doc){return}while(s.contentEditable==="false"){s=s.parentNode}if(!s.hasChildNodes()){return{node:s,inside:1}}m=s.children;q=m.length-1;while(t<=q){r=Math.floor((t+q)/2);l=m[r];k.moveToElementText(l);p=k.compareEndPoints(j?"StartToStart":"EndToEnd",i);if(p>0){q=r-1}else{if(p<0){t=r+1}else{return{node:l}}}}if(p<0){if(!l){k.moveToElementText(s);k.collapse(true);l=s;n=true}else{k.collapse(false)}k.setEndPoint(j?"EndToStart":"EndToEnd",i);if(k.compareEndPoints(j?"StartToStart":"StartToEnd",i)>0){k=i.duplicate();k.collapse(j);o=-1;while(s==k.parentElement()){if(k.move("character",-1)==0){break}o++}}o=o||k.text.replace("\r\n"," ").length}else{k.collapse(true);k.setEndPoint(j?"StartToStart":"StartToEnd",i);o=k.text.replace("\r\n"," ").length}return{node:l,position:p,offset:o,inside:n}}function g(){var i=d.getRng(),r=h.createRng(),l,k,p,q,m,j;l=i.item?i.item(0):i.parentElement();if(l.ownerDocument!=h.doc){return r}k=d.isCollapsed();if(i.item){r.setStart(l.parentNode,h.nodeIndex(l));r.setEnd(r.startContainer,r.startOffset+1);return r}function o(z){var u=e(i,z),s,x,y=0,w,v,t;s=u.node;x=u.offset;if(u.inside&&!s.hasChildNodes()){r[z?"setStart":"setEnd"](s,0);return}if(x===v){r[z?"setStartBefore":"setEndAfter"](s);return}if(u.position<0){w=u.inside?s.firstChild:s.nextSibling;if(!w){r[z?"setStartAfter":"setEndAfter"](s);return}if(!x){if(w.nodeType==3){r[z?"setStart":"setEnd"](w,0)}else{r[z?"setStartBefore":"setEndBefore"](w)}return}while(w){t=w.nodeValue;y+=t.length;if(y>=x){s=w;y-=x;y=t.length-y;break}w=w.nextSibling}}else{w=s.previousSibling;if(!w){return r[z?"setStartBefore":"setEndBefore"](s)}if(!x){if(s.nodeType==3){r[z?"setStart":"setEnd"](w,s.nodeValue.length)}else{r[z?"setStartAfter":"setEndAfter"](w)}return}while(w){y+=w.nodeValue.length;if(y>=x){s=w;y-=x;break}w=w.previousSibling}}r[z?"setStart":"setEnd"](s,y)}try{o(true);if(!k){o()}}catch(n){if(n.number==-2147024809){m=b.getBookmark(2);p=i.duplicate();p.collapse(true);l=p.parentElement();if(!k){p=i.duplicate();p.collapse(false);q=p.parentElement();q.innerHTML=q.innerHTML}l.innerHTML=l.innerHTML;b.moveToBookmark(m);i=d.getRng();o(true);if(!k){o()}}else{throw n}}return r}this.getBookmark=function(m){var j=d.getRng(),o,i,l={};function n(u){var u,t,p,s,r,q=[];t=u.parentNode;p=h.doc.body.parentNode;while(t!=p&&t.nodeType!==9){s=t.children;r=s.length;while(r--){if(u===s[r]){q.push(r);break}}u=t;t=t.parentNode}return q}function k(q){var p;p=e(j,q);if(p){return{position:p.position,offset:p.offset,indexes:n(p.node),inside:p.inside}}}if(m===2){if(!j.item){l.start=k(true);if(!d.isCollapsed()){l.end=k()}}else{l.start={ctrl:true,indexes:n(j.item(0))}}}return l};this.moveToBookmark=function(k){var j,i=h.doc.body;function m(o){var r,q,n,p;r=h.doc.body;for(q=o.length-1;q>=0;q--){p=r.children;n=o[q];if(n<=p.length-1){r=p[n]}}return r}function l(r){var n=k[r?"start":"end"],q,p,o;if(n){q=n.position>0;p=i.createTextRange();p.moveToElementText(m(n.indexes));offset=n.offset;if(offset!==o){p.collapse(n.inside||q);p.moveStart("character",q?-offset:offset)}else{p.collapse(r)}j.setEndPoint(r?"StartToStart":"EndToStart",p);if(r){j.collapse(true)}}}if(k.start){if(k.start.ctrl){j=i.createControlRange();j.addElement(m(k.start.indexes));j.select()}else{j=i.createTextRange();l(true);l();j.select()}}};this.addRange=function(i){var n,l,k,p,s,q,r=d.dom.doc,m=r.body;function j(y){var u,x,t,w,v;t=h.create("a");u=y?k:s;x=y?p:q;w=n.duplicate();if(u==r||u==r.documentElement){u=m;x=0}if(u.nodeType==3){u.parentNode.insertBefore(t,u);w.moveToElementText(t);w.moveStart("character",x);h.remove(t);n.setEndPoint(y?"StartToStart":"EndToEnd",w)}else{v=u.childNodes;if(v.length){if(x>=v.length){h.insertAfter(t,v[v.length-1])}else{u.insertBefore(t,v[x])}w.moveToElementText(t)}else{t=r.createTextNode("\uFEFF");u.appendChild(t);w.moveToElementText(t.parentNode);w.collapse(c)}n.setEndPoint(y?"StartToStart":"EndToEnd",w);h.remove(t)}}k=i.startContainer;p=i.startOffset;s=i.endContainer;q=i.endOffset;n=m.createTextRange();if(k==s&&k.nodeType==1&&p==q-1){if(p==q-1){try{l=m.createControlRange();l.addElement(k.childNodes[p]);l.select();return}catch(o){}}}j(true);j();n.select()};this.getRangeAt=g}tinymce.dom.TridentSelection=a})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Sizzle.js' */
(function(){var p=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,j=0,d=Object.prototype.toString,o=false,i=true;[0,0].sort(function(){i=false;return 0});var b=function(v,e,y,z){y=y||[];e=e||document;var B=e;if(e.nodeType!==1&&e.nodeType!==9){return[]}if(!v||typeof v!=="string"){return y}var w=[],s,D,G,r,u=true,t=b.isXML(e),A=v,C,F,E,x;do{p.exec("");s=p.exec(A);if(s){A=s[3];w.push(s[1]);if(s[2]){r=s[3];break}}}while(s);if(w.length>1&&k.exec(v)){if(w.length===2&&f.relative[w[0]]){D=h(w[0]+w[1],e)}else{D=f.relative[w[0]]?[e]:b(w.shift(),e);while(w.length){v=w.shift();if(f.relative[v]){v+=w.shift()}D=h(v,D)}}}else{if(!z&&w.length>1&&e.nodeType===9&&!t&&f.match.ID.test(w[0])&&!f.match.ID.test(w[w.length-1])){C=b.find(w.shift(),e,t);e=C.expr?b.filter(C.expr,C.set)[0]:C.set[0]}if(e){C=z?{expr:w.pop(),set:a(z)}:b.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&e.parentNode?e.parentNode:e,t);D=C.expr?b.filter(C.expr,C.set):C.set;if(w.length>0){G=a(D)}else{u=false}while(w.length){F=w.pop();E=F;if(!f.relative[F]){F=""}else{E=w.pop()}if(E==null){E=e}f.relative[F](G,E,t)}}else{G=w=[]}}if(!G){G=D}if(!G){b.error(F||v)}if(d.call(G)==="[object Array]"){if(!u){y.push.apply(y,G)}else{if(e&&e.nodeType===1){for(x=0;G[x]!=null;x++){if(G[x]&&(G[x]===true||G[x].nodeType===1&&b.contains(e,G[x]))){y.push(D[x])}}}else{for(x=0;G[x]!=null;x++){if(G[x]&&G[x].nodeType===1){y.push(D[x])}}}}}else{a(G,y)}if(r){b(r,B,y,z);b.uniqueSort(y)}return y};b.uniqueSort=function(r){if(c){o=i;r.sort(c);if(o){for(var e=1;e<r.length;e++){if(r[e]===r[e-1]){r.splice(e--,1)}}}}return r};b.matches=function(e,r){return b(e,null,null,r)};b.find=function(x,e,y){var w;if(!x){return[]}for(var t=0,s=f.order.length;t<s;t++){var v=f.order[t],u;if((u=f.leftMatch[v].exec(x))){var r=u[1];u.splice(1,1);if(r.substr(r.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,"");w=f.find[v](u,e,y);if(w!=null){x=x.replace(f.match[v],"");break}}}}if(!w){w=e.getElementsByTagName("*")}return{set:w,expr:x}};b.filter=function(B,A,E,u){var s=B,G=[],y=A,w,e,x=A&&A[0]&&b.isXML(A[0]);while(B&&A.length){for(var z in f.filter){if((w=f.leftMatch[z].exec(B))!=null&&w[2]){var r=f.filter[z],F,D,t=w[1];e=false;w.splice(1,1);if(t.substr(t.length-1)==="\\"){continue}if(y===G){G=[]}if(f.preFilter[z]){w=f.preFilter[z](w,y,E,G,u,x);if(!w){e=F=true}else{if(w===true){continue}}}if(w){for(var v=0;(D=y[v])!=null;v++){if(D){F=r(D,w,v,y);var C=u^!!F;if(E&&F!=null){if(C){e=true}else{y[v]=false}}else{if(C){G.push(D);e=true}}}}}if(F!==undefined){if(!E){y=G}B=B.replace(f.match[z],"");if(!e){return[]}break}}}if(B===s){if(e==null){b.error(B)}else{break}}s=B}return y};b.error=function(e){throw"Syntax error, unrecognized expression: "+e};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(w,r){var t=typeof r==="string",v=t&&!/\W/.test(r),x=t&&!v;if(v){r=r.toLowerCase()}for(var s=0,e=w.length,u;s<e;s++){if((u=w[s])){while((u=u.previousSibling)&&u.nodeType!==1){}w[s]=x||u&&u.nodeName.toLowerCase()===r?u||false:u===r}}if(x){b.filter(r,w,true)}},">":function(w,r){var u=typeof r==="string",v,s=0,e=w.length;if(u&&!/\W/.test(r)){r=r.toLowerCase();for(;s<e;s++){v=w[s];if(v){var t=v.parentNode;w[s]=t.nodeName.toLowerCase()===r?t:false}}}else{for(;s<e;s++){v=w[s];if(v){w[s]=u?v.parentNode:v.parentNode===r}}if(u){b.filter(r,w,true)}}},"":function(t,r,v){var s=j++,e=q,u;if(typeof r==="string"&&!/\W/.test(r)){r=r.toLowerCase();u=r;e=n}e("parentNode",r,s,t,u,v)},"~":function(t,r,v){var s=j++,e=q,u;if(typeof r==="string"&&!/\W/.test(r)){r=r.toLowerCase();u=r;e=n}e("previousSibling",r,s,t,u,v)}},find:{ID:function(r,s,t){if(typeof s.getElementById!=="undefined"&&!t){var e=s.getElementById(r[1]);return e?[e]:[]}},NAME:function(s,v){if(typeof v.getElementsByName!=="undefined"){var r=[],u=v.getElementsByName(s[1]);for(var t=0,e=u.length;t<e;t++){if(u[t].getAttribute("name")===s[1]){r.push(u[t])}}return r.length===0?null:r}},TAG:function(e,r){return r.getElementsByTagName(e[1])}},preFilter:{CLASS:function(t,r,s,e,w,x){t=" "+t[1].replace(/\\/g,"")+" ";if(x){return t}for(var u=0,v;(v=r[u])!=null;u++){if(v){if(w^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(t)>=0)){if(!s){e.push(v)}}else{if(s){r[u]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(r,e){return r[1].toLowerCase()},CHILD:function(e){if(e[1]==="nth"){var r=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(r[1]+(r[2]||1))-0;e[3]=r[3]-0}e[0]=j++;return e},ATTR:function(u,r,s,e,v,w){var t=u[1].replace(/\\/g,"");if(!w&&f.attrMap[t]){u[1]=f.attrMap[t]}if(u[2]==="~="){u[4]=" "+u[4]+" "}return u},PSEUDO:function(u,r,s,e,v){if(u[1]==="not"){if((p.exec(u[3])||"").length>1||/^\w/.test(u[3])){u[3]=b(u[3],null,null,r)}else{var t=b.filter(u[3],r,s,true^v);if(!s){e.push.apply(e,t)}return false}}else{if(f.match.POS.test(u[0])||f.match.CHILD.test(u[0])){return true}}return u},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(s,r,e){return !!b(e[3],s).length},header:function(e){return(/h\d/i).test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toLowerCase()==="button"},input:function(e){return(/input|select|textarea|button/i).test(e.nodeName)}},setFilters:{first:function(r,e){return e===0},last:function(s,r,e,t){return r===t.length-1},even:function(r,e){return e%2===0},odd:function(r,e){return e%2===1},lt:function(s,r,e){return r<e[3]-0},gt:function(s,r,e){return r>e[3]-0},nth:function(s,r,e){return e[3]-0===r},eq:function(s,r,e){return e[3]-0===r}},filter:{PSEUDO:function(s,x,w,y){var e=x[1],r=f.filters[e];if(r){return r(s,w,x,y)}else{if(e==="contains"){return(s.textContent||s.innerText||b.getText([s])||"").indexOf(x[3])>=0}else{if(e==="not"){var t=x[3];for(var v=0,u=t.length;v<u;v++){if(t[v]===s){return false}}return true}else{b.error("Syntax error, unrecognized expression: "+e)}}}},CHILD:function(e,t){var w=t[1],r=e;switch(w){case"only":case"first":while((r=r.previousSibling)){if(r.nodeType===1){return false}}if(w==="first"){return true}r=e;case"last":while((r=r.nextSibling)){if(r.nodeType===1){return false}}return true;case"nth":var s=t[2],z=t[3];if(s===1&&z===0){return true}var v=t[0],y=e.parentNode;if(y&&(y.sizcache!==v||!e.nodeIndex)){var u=0;for(r=y.firstChild;r;r=r.nextSibling){if(r.nodeType===1){r.nodeIndex=++u}}y.sizcache=v}var x=e.nodeIndex-z;if(s===0){return x===0}else{return(x%s===0&&x/s>=0)}}},ID:function(r,e){return r.nodeType===1&&r.getAttribute("id")===e},TAG:function(r,e){return(e==="*"&&r.nodeType===1)||r.nodeName.toLowerCase()===e},CLASS:function(r,e){return(" "+(r.className||r.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(v,t){var s=t[1],e=f.attrHandle[s]?f.attrHandle[s](v):v[s]!=null?v[s]:v.getAttribute(s),w=e+"",u=t[2],r=t[4];return e==null?u==="!=":u==="="?w===r:u==="*="?w.indexOf(r)>=0:u==="~="?(" "+w+" ").indexOf(r)>=0:!r?w&&e!==false:u==="!="?w!==r:u==="^="?w.indexOf(r)===0:u==="$="?w.substr(w.length-r.length)===r:u==="|="?w===r||w.substr(0,r.length+1)===r+"-":false},POS:function(u,r,s,v){var e=r[2],t=f.setFilters[e];if(t){return t(u,s,r,v)}}}};var k=f.match.POS,g=function(r,e){return"\\"+(e-0+1)};for(var m in f.match){f.match[m]=new RegExp(f.match[m].source+(/(?![^\[]*\])(?![^\(]*\))/.source));f.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[m].source.replace(/\\(\d+)/g,g))}var a=function(r,e){r=Array.prototype.slice.call(r,0);if(e){e.push.apply(e,r);return e}return r};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(l){a=function(u,t){var r=t||[],s=0;if(d.call(u)==="[object Array]"){Array.prototype.push.apply(r,u)}else{if(typeof u.length==="number"){for(var e=u.length;s<e;s++){r.push(u[s])}}else{for(;u[s];s++){r.push(u[s])}}}return r}}var c;if(document.documentElement.compareDocumentPosition){c=function(r,e){if(!r.compareDocumentPosition||!e.compareDocumentPosition){if(r==e){o=true}return r.compareDocumentPosition?-1:1}var s=r.compareDocumentPosition(e)&4?-1:r===e?0:1;if(s===0){o=true}return s}}else{if("sourceIndex" in document.documentElement){c=function(r,e){if(!r.sourceIndex||!e.sourceIndex){if(r==e){o=true}return r.sourceIndex?-1:1}var s=r.sourceIndex-e.sourceIndex;if(s===0){o=true}return s}}else{if(document.createRange){c=function(t,r){if(!t.ownerDocument||!r.ownerDocument){if(t==r){o=true}return t.ownerDocument?-1:1}var s=t.ownerDocument.createRange(),e=r.ownerDocument.createRange();s.setStart(t,0);s.setEnd(t,0);e.setStart(r,0);e.setEnd(r,0);var u=s.compareBoundaryPoints(Range.START_TO_END,e);if(u===0){o=true}return u}}}}b.getText=function(e){var r="",t;for(var s=0;e[s];s++){t=e[s];if(t.nodeType===3||t.nodeType===4){r+=t.nodeValue}else{if(t.nodeType!==8){r+=b.getText(t.childNodes)}}}return r};(function(){var r=document.createElement("div"),s="script"+(new Date()).getTime();r.innerHTML="<a name='"+s+"'/>";var e=document.documentElement;e.insertBefore(r,e.firstChild);if(document.getElementById(s)){f.find.ID=function(u,v,w){if(typeof v.getElementById!=="undefined"&&!w){var t=v.getElementById(u[1]);return t?t.id===u[1]||typeof t.getAttributeNode!=="undefined"&&t.getAttributeNode("id").nodeValue===u[1]?[t]:undefined:[]}};f.filter.ID=function(v,t){var u=typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id");return v.nodeType===1&&u&&u.nodeValue===t}}e.removeChild(r);e=r=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(r,v){var u=v.getElementsByTagName(r[1]);if(r[1]==="*"){var t=[];for(var s=0;u[s];s++){if(u[s].nodeType===1){t.push(u[s])}}u=t}return u}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(r){return r.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,s=document.createElement("div");s.innerHTML="<p class='TEST'></p>";if(s.querySelectorAll&&s.querySelectorAll(".TEST").length===0){return}b=function(w,v,t,u){v=v||document;if(!u&&v.nodeType===9&&!b.isXML(v)){try{return a(v.querySelectorAll(w),t)}catch(x){}}return e(w,v,t,u)};for(var r in e){b[r]=e[r]}s=null})()}(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(r,s,t){if(typeof s.getElementsByClassName!=="undefined"&&!t){return s.getElementsByClassName(r[1])}};e=null})();function n(r,w,v,z,x,y){for(var t=0,s=z.length;t<s;t++){var e=z[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=z[e.sizset];break}if(e.nodeType===1&&!y){e.sizcache=v;e.sizset=t}if(e.nodeName.toLowerCase()===w){u=e;break}e=e[r]}z[t]=u}}}function q(r,w,v,z,x,y){for(var t=0,s=z.length;t<s;t++){var e=z[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=z[e.sizset];break}if(e.nodeType===1){if(!y){e.sizcache=v;e.sizset=t}if(typeof w!=="string"){if(e===w){u=true;break}}else{if(b.filter(w,[e]).length>0){u=e;break}}}e=e[r]}z[t]=u}}}b.contains=document.compareDocumentPosition?function(r,e){return !!(r.compareDocumentPosition(e)&16)}:function(r,e){return r!==e&&(r.contains?r.contains(e):true)};b.isXML=function(e){var r=(e?e.ownerDocument||e:0).documentElement;return r?r.nodeName!=="HTML":false};var h=function(e,x){var t=[],u="",v,s=x.nodeType?[x]:x;while((v=f.match.PSEUDO.exec(e))){u+=v[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var w=0,r=s.length;w<r;w++){b(e,s[w],t)}return b.filter(u,t)};window.tinymce.dom.Sizzle=b})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/EventUtils.js' */
(function(d){var f=d.each,c=d.DOM,b=d.isIE,e=d.isWebKit,a;d.create("tinymce.dom.EventUtils",{EventUtils:function(){this.inits=[];this.events=[]},add:function(m,p,l,j){var g,h=this,i=h.events,k;if(p instanceof Array){k=[];f(p,function(o){k.push(h.add(m,o,l,j))});return k}if(m&&m.hasOwnProperty&&m instanceof Array){k=[];f(m,function(n){n=c.get(n);k.push(h.add(n,p,l,j))});return k}m=c.get(m);if(!m){return}g=function(n){if(h.disabled){return}n=n||window.event;if(n&&b&&!d.isIE11){if(!n.target){n.target=n.srcElement}d.extend(n,h._stoppers)}if(!j){return l(n)}return l.call(j,n)};if(p=="unload"){d.unloads.unshift({func:g});return g}if(p=="init"){if(h.domLoaded){g()}else{h.inits.push(g)}return g}i.push({obj:m,name:p,func:l,cfunc:g,scope:j});h._add(m,p,g);return l},remove:function(l,m,k){var h=this,g=h.events,i=false,j;if(l&&l.hasOwnProperty&&l instanceof Array){j=[];f(l,function(n){n=c.get(n);j.push(h.remove(n,m,k))});return j}l=c.get(l);f(g,function(o,n){if(o.obj==l&&o.name==m&&(!k||(o.func==k||o.cfunc==k))){g.splice(n,1);h._remove(l,m,o.cfunc);i=true;return false}});return i},clear:function(l){var j=this,g=j.events,h,k;if(l){l=c.get(l);for(h=g.length-1;h>=0;h--){k=g[h];if(k.obj===l){j._remove(k.obj,k.name,k.cfunc);k.obj=k.cfunc=null;g.splice(h,1)}}}},cancel:function(g){if(!g){return false}this.stop(g);return this.prevent(g)},stop:function(g){if(g.stopPropagation){g.stopPropagation()}else{g.cancelBubble=true}return false},prevent:function(g){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}return false},destroy:function(){var g=this;f(g.events,function(j,h){g._remove(j.obj,j.name,j.cfunc);j.obj=j.cfunc=null});g.events=[];g=null},_add:function(h,i,g){if(h.attachEvent){h.attachEvent("on"+i,g)}else{if(h.addEventListener){h.addEventListener(i,g,false)}else{h["on"+i]=g}}},_remove:function(i,j,h){if(i){try{if(i.detachEvent){i.detachEvent("on"+j,h)}else{if(i.removeEventListener){i.removeEventListener(j,h,false)}else{i["on"+j]=null}}}catch(g){}}},_pageInit:function(h){var g=this;if(g.domLoaded){return}g.domLoaded=true;f(g.inits,function(i){i()});g.inits=[]},_wait:function(i){var g=this,h=i.document;if(i.tinyMCE_GZ&&tinyMCE_GZ.loaded){g.domLoaded=1;return}if(h.readyState==="complete"){g._pageInit(i);return}if(h.attachEvent){h.attachEvent("onreadystatechange",function(){if(h.readyState==="complete"){h.detachEvent("onreadystatechange",arguments.callee);g._pageInit(i)}});if(h.documentElement.doScroll&&i==i.top){(function(){if(g.domLoaded){return}try{h.documentElement.doScroll("left")}catch(j){setTimeout(arguments.callee,0);return}g._pageInit(i)})()}}else{if(h.addEventListener){g._add(i,"DOMContentLoaded",function(){g._pageInit(i)})}}g._add(i,"load",function(){g._pageInit(i)})},_stoppers:{preventDefault:function(){this.returnValue=false},stopPropagation:function(){this.cancelBubble=true}}});a=d.dom.Event=new d.dom.EventUtils();a._wait(window);d.addUnload(function(){a.destroy()})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Element.js' */
(function(a){a.dom.Element=function(f,d){var b=this,e,c;b.settings=d=d||{};b.id=f;b.dom=e=d.dom||a.DOM;if(!a.isIE){c=e.get(b.id)}a.each(("getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get").split(/,/),function(g){b[g]=function(){var h=[f],j;for(j=0;j<arguments.length;j++){h.push(arguments[j])}h=e[g].apply(e,h);b.update(g);return h}});a.extend(b,{on:function(i,h,g){return a.dom.Event.add(b.id,i,h,g)},getXY:function(){return{x:parseInt(b.getStyle("left")),y:parseInt(b.getStyle("top"))}},getSize:function(){var g=e.get(b.id);return{w:parseInt(b.getStyle("width")||g.clientWidth),h:parseInt(b.getStyle("height")||g.clientHeight)}},moveTo:function(g,h){b.setStyles({left:g,top:h})},moveBy:function(g,i){var h=b.getXY();b.moveTo(h.x+g,h.y+i)},resizeTo:function(g,i){b.setStyles({width:g,height:i})},resizeBy:function(g,j){var i=b.getSize();b.resizeTo(i.w+g,i.h+j)},update:function(h){var g;if(a.isIE6&&d.blocker){h=h||"";if(h.indexOf("get")===0||h.indexOf("has")===0||h.indexOf("is")===0){return}if(h=="remove"){e.remove(b.blocker);return}if(!b.blocker){b.blocker=e.uniqueId();g=e.add(d.container||e.getRoot(),"iframe",{id:b.blocker,style:"position:absolute;",frameBorder:0,src:'javascript:""'});e.setStyle(g,"opacity",0)}else{g=e.get(b.blocker)}e.setStyles(g,{left:b.getStyle("left",1),top:b.getStyle("top",1),width:b.getStyle("width",1),height:b.getStyle("height",1),display:b.getStyle("display",1),zIndex:parseInt(b.getStyle("zIndex",1)||0)-1})}}})}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Selection.js' */
(function(c){function e(f){return f.replace(/[\n\r]+/g,"")}var b=c.is,a=c.isIE,d=c.each;c.create("tinymce.dom.Selection",{Selection:function(i,h,g){var f=this;f.dom=i;f.win=h;f.serializer=g;d(["onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent"],function(j){f[j]=new c.util.Dispatcher(f)});if(!f.win.getSelection){f.tridentSel=new c.dom.TridentSelection(f)}if(c.isIE&&i.boxModel){this._fixIESelection()}c.addUnload(f.destroy,f)},setCursorLocation:function(h,i){var f=this;var g=f.dom.createRng();g.setStart(h,i);g.setEnd(h,i);f.setRng(g);f.collapse(false)},getContent:function(g){var f=this,h=f.getRng(),l=f.dom.create("body"),j=f.getSel(),i,k,m;g=g||{};i=k="";g.get=true;g.format=g.format||"html";g.forced_root_block="";f.onBeforeGetContent.dispatch(f,g);if(g.format=="text"){return f.isCollapsed()?"":(h.text||(j.toString?j.toString():""))}if(h.cloneContents){m=h.cloneContents();if(m){l.appendChild(m)}}else{if(b(h.item)||b(h.htmlText)){l.innerHTML="<br>"+(h.item?h.item(0).outerHTML:h.htmlText);l.removeChild(l.firstChild)}else{l.innerHTML=h.toString()}}if(/^\s/.test(l.innerHTML)){i=" "}if(/\s+$/.test(l.innerHTML)){k=" "}g.getInner=true;g.content=f.isCollapsed()?"":i+f.serializer.serialize(l,g)+k;f.onGetContent.dispatch(f,g);return g.content},setContent:function(h,j){var o=this,f=o.getRng(),k,l=o.win.document,n,m;j=j||{format:"html"};j.set=true;h=j.content=h;if(!j.no_events){o.onBeforeSetContent.dispatch(o,j)}h=j.content;if(f.insertNode){h+='<span id="__caret">_</span>';if(f.startContainer==l&&f.endContainer==l){l.body.innerHTML=h}else{f.deleteContents();if(l.body.childNodes.length==0){l.body.innerHTML=h}else{if(f.createContextualFragment){try{f.insertNode(f.createContextualFragment(h))}catch(g){if(f.startOffset===0&&f.endOffset===0&&f.startContainer.children.length===0){n=l.createDocumentFragment();m=l.createElement("div");m.innerHTML=h;m=m.children[0];n.appendChild(m.cloneNode());while(m=m.nextSibling){n.appendChild(m.cloneNode())}f.startContainer.parentNode.insertBefore(n,f.startContainer)}else{throw (g)}}}else{n=l.createDocumentFragment();m=l.createElement("div");n.appendChild(m);m.outerHTML=h;f.insertNode(n)}}}k=o.dom.get("__caret");f=l.createRange();f.setStartBefore(k);f.setEndBefore(k);o.setRng(f);o.dom.remove("__caret");try{o.setRng(f)}catch(i){}}else{if(f.item){l.execCommand("Delete",false,null);f=o.getRng()}if(/^\s+/.test(h)){f.pasteHTML('<span id="__mce_tmp">_</span>'+h);o.dom.remove("__mce_tmp")}else{f.pasteHTML(h)}}if(!j.no_events){o.onSetContent.dispatch(o,j)}},getStart:function(){var g=this.getRng(),h,f,j,i;if(g.duplicate||g.item){if(g.item){return g.item(0)}j=g.duplicate();j.collapse(1);h=j.parentElement();f=i=g.parentElement();while(i=i.parentNode){if(i==h){h=f;break}}return h}else{h=g.startContainer;if(h.nodeType==1&&h.hasChildNodes()){h=h.childNodes[Math.min(h.childNodes.length-1,g.startOffset)]}if(h&&h.nodeType==3){return h.parentNode}return h}},getEnd:function(){var g=this,h=g.getRng(),i,f;if(h.duplicate||h.item){if(h.item){return h.item(0)}h=h.duplicate();h.collapse(0);i=h.parentElement();if(i&&i.nodeName=="BODY"){return i.lastChild||i}return i}else{i=h.endContainer;f=h.endOffset;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[f>0?f-1:f]}if(i&&i.nodeType==3){return i.parentNode}return i}},getBookmark:function(r,s){var v=this,m=v.dom,g,j,i,n,h,o,p,l="\uFEFF",u;function f(w,x){var t=0;d(m.select(w),function(z,y){if(z==x){t=y}});return t}if(r==2){function k(){var w=v.getRng(true),t=m.doc.body,x={};function y(B,G){var A=B[G?"startContainer":"endContainer"],F=B[G?"startOffset":"endOffset"],z=[],C,E,D=0;if(A.nodeType==3){if(s){for(C=A.previousSibling;C&&C.nodeType==3;C=C.previousSibling){F+=C.nodeValue.length}}z.push(F)}else{E=A.childNodes;if(F>=E.length&&E.length){D=1;F=Math.max(0,E.length-1)}z.push(v.dom.nodeIndex(E[F],s)+D)}for(;A&&A!=t;A=A.parentNode){z.push(v.dom.nodeIndex(A,s))}return z}x.start=y(w,true);if(!v.isCollapsed()){x.end=y(w)}return x}if(v.tridentSel){return v.tridentSel.getBookmark(r)}return k()}if(r){return{rng:v.getRng()}}g=v.getRng();i=m.uniqueId();n=tinyMCE.activeEditor.selection.isCollapsed();u="overflow:hidden;line-height:0px";if(g.duplicate||g.item){if(!g.item){j=g.duplicate();try{g.collapse();g.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_start" style="'+u+'">'+l+"</span>");if(!n){j.collapse(false);g.moveToElementText(j.parentElement());if(g.compareEndPoints("StartToEnd",j)==0){j.move("character",-1)}j.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_end" style="'+u+'">'+l+"</span>")}}catch(q){return null}}else{o=g.item(0);h=o.nodeName;return{name:h,index:f(h,o)}}}else{o=v.getNode();h=o.nodeName;if(h=="IMG"){return{name:h,index:f(h,o)}}j=g.cloneRange();if(!n){j.collapse(false);j.insertNode(m.create("span",{"data-mce-type":"bookmark",id:i+"_end",style:u},l))}g.collapse(true);g.insertNode(m.create("span",{"data-mce-type":"bookmark",id:i+"_start",style:u},l))}v.moveToBookmark({id:i,keep:1});return{id:i}},moveToBookmark:function(n){var r=this,l=r.dom,i,h,f,q,j,s,o,p;if(n){if(n.start){f=l.createRng();q=l.doc.body;function g(y){var t=n[y?"start":"end"],v,w,x,u;if(t){x=t[0];for(w=q,v=t.length-1;v>=1;v--){u=w.childNodes;if(t[v]>u.length-1){return}w=u[t[v]]}if(w.nodeType===3){x=Math.min(t[0],w.nodeValue.length)}if(w.nodeType===1){x=Math.min(t[0],w.childNodes.length)}if(y){f.setStart(w,x)}else{f.setEnd(w,x)}}return true}if(r.tridentSel){return r.tridentSel.moveToBookmark(n)}if(g(true)&&g()){r.setRng(f)}}else{if(n.id){function k(z){var u=l.get(n.id+"_"+z),y,t,w,x,v=n.keep;if(u){y=u.parentNode;if(z=="start"){if(!v){t=l.nodeIndex(u)}else{y=u.firstChild;t=1}j=s=y;o=p=t}else{if(!v){t=l.nodeIndex(u)}else{y=u.firstChild;t=1}s=y;p=t}if(!v){x=u.previousSibling;w=u.nextSibling;d(c.grep(u.childNodes),function(A){if(A.nodeType==3){A.nodeValue=A.nodeValue.replace(/\uFEFF/g,"")}});while(u=l.get(n.id+"_"+z)){l.remove(u,1)}if(x&&w&&x.nodeType==w.nodeType&&x.nodeType==3&&!c.isOpera){t=x.nodeValue.length;x.appendData(w.nodeValue);l.remove(w);if(z=="start"){j=s=x;o=p=t}else{s=x;p=t}}}}}function m(t){if(l.isBlock(t)&&!t.innerHTML){t.innerHTML=!a?'<br data-mce-bogus="1" />':" "}return t}k("start");k("end");if(j){f=l.createRng();f.setStart(m(j),o);f.setEnd(m(s),p);r.setRng(f)}}else{if(n.name){r.select(l.select(n.name)[n.index])}else{if(n.rng){r.setRng(n.rng)}}}}}},select:function(k,j){var i=this,l=i.dom,g=l.createRng(),f;if(k){f=l.nodeIndex(k);g.setStart(k.parentNode,f);g.setEnd(k.parentNode,f+1);if(j){function h(m,o){var n=new c.dom.TreeWalker(m,m);do{if(m.nodeType==3&&c.trim(m.nodeValue).length!=0){if(o){g.setStart(m,0)}else{g.setEnd(m,m.nodeValue.length)}return}if(m.nodeName=="BR"){if(o){g.setStartBefore(m)}else{g.setEndBefore(m)}return}}while(m=(o?n.next():n.prev()))}h(k,1);h(k)}i.setRng(g)}return k},isCollapsed:function(){var f=this,h=f.getRng(),g=f.getSel();if(!h||h.item){return false}if(h.compareEndPoints){return h.compareEndPoints("StartToEnd",h)===0}return !g||h.collapsed},collapse:function(f){var h=this,g=h.getRng(),i;if(g.item){i=g.item(0);g=h.win.document.body.createTextRange();g.moveToElementText(i)}g.collapse(!!f);h.setRng(g)},getSel:function(){var g=this,f=this.win;return f.getSelection?f.getSelection():f.document.selection},getRng:function(m){var g=this,h,i,l,k=g.win.document;if(m&&g.tridentSel){return g.tridentSel.getRangeAt(0)}try{if(h=g.getSel()){i=h.rangeCount>0?h.getRangeAt(0):(h.createRange?h.createRange():k.createRange())}}catch(f){}try{if(c.isIE&&i&&i.setStart&&k.selection&&k.selection.createRange().item){l=k.selection.createRange().item(0);i=k.createRange();i.setStartBefore(l);i.setEndAfter(l)}}catch(j){}if(!i){i=k.createRange?k.createRange():k.body.createTextRange()}if(g.selectedRange&&g.explicitRange){if(i.compareBoundaryPoints(i.START_TO_START,g.selectedRange)===0&&i.compareBoundaryPoints(i.END_TO_END,g.selectedRange)===0){i=g.explicitRange}else{g.selectedRange=null;g.explicitRange=null}}return i},setRng:function(i){var h,g=this;if(!g.tridentSel){h=g.getSel();if(h){g.explicitRange=i;try{h.removeAllRanges()}catch(f){AJS.logError("Exception occurred at tinymce setRng() - removeAllRanges(): "+f)}try{h.addRange(i)}catch(f){AJS.logError("Exception occurred at tinymce setRng() - addRange(): "+f)}g.selectedRange=h.rangeCount>0?h.getRangeAt(0):null}}else{if(i.cloneRange){try{g.tridentSel.addRange(i);return}catch(f){AJS.logError("Exception occurred at tinymce setRng() - tridentSel.addRange(): "+f)}}try{i.select()}catch(f){AJS.logError("Exception occurred at tinymce setRng() - select(): "+f)}}},setNode:function(g){var f=this;f.setContent(f.dom.getOuterHTML(g));return g},getNode:function(){var h=this,g=h.getRng(),i=h.getSel(),l,k=g.startContainer,f=g.endContainer;if(!g){return h.dom.getRoot()}if(g.setStart){l=g.commonAncestorContainer;if(!g.collapsed){if(g.startContainer==g.endContainer){if(g.endOffset-g.startOffset<2){if(g.startContainer.hasChildNodes()){l=g.startContainer.childNodes[g.startOffset]}}}if(k.nodeType===3&&f.nodeType===3){function j(p,m){var o=p;while(p&&p.nodeType===3&&p.length===0){p=m?p.nextSibling:p.previousSibling}return p||o}if(k.length===g.startOffset){k=j(k.nextSibling,true)}else{k=k.parentNode}if(g.endOffset===0){f=j(f.previousSibling,false)}else{f=f.parentNode}if(k&&k===f){return k}}}if(l&&l.nodeType==3){return l.parentNode}return l}return g.item?g.item(0):g.parentElement()},getSelectedBlocks:function(o,g){var m=this,j=m.dom,l,k,h,i=[];l=j.getParent(o||m.getStart(),j.isBlock);k=j.getParent(g||m.getEnd(),j.isBlock);if(l){i.push(l)}if(l&&k&&l!=k){h=l;var f=new c.dom.TreeWalker(l,j.getRoot());while((h=f.next())&&h!=k){if(j.isBlock(h)){i.push(h)}}}if(k&&l!=k){i.push(k)}return i},normalize:function(){var g=this,f,i;if(c.isIE){return}function h(p){var k,o,n,m=g.dom,j=m.getRoot(),l;k=f[(p?"start":"end")+"Container"];o=f[(p?"start":"end")+"Offset"];if(k.nodeType===9){k=k.body;o=0}if(k===j){if(k.hasChildNodes()){k=k.childNodes[Math.min(!p&&o>0?o-1:o,k.childNodes.length-1)];o=0;if(k.nodeName==="TABLE"){return}if(k.hasChildNodes()){l=k;n=new c.dom.TreeWalker(k,j);do{if(l.nodeType===3){o=p?0:l.nodeValue.length-1;k=l;i=true;break}if(/^(BR|IMG)$/.test(l.nodeName)){o=m.nodeIndex(l);k=l.parentNode;if(l.nodeName=="IMG"&&!p){o++}i=true;break}}while(l=(p?n.next():n.prev()))}}}if(i){f["set"+(p?"Start":"End")](k,o)}}f=g.getRng();h(true);if(f.collapsed&&i){h()}if(i){g.setRng(f)}},destroy:function(g){var f=this;f.win=null;if(!g){c.removeUnload(f.destroy)}},_fixIESelection:function(){var g=this.dom,m=g.doc,h=m.body,j,n,f;m.documentElement.unselectable=true;function i(o,r){var p=h.createTextRange();try{p.moveToPoint(o,r)}catch(q){p=null}return p}function l(p){var o;if(p.button){o=i(p.x,p.y);if(o){if(o.compareEndPoints("StartToStart",n)>0){o.setEndPoint("StartToStart",n)}else{o.setEndPoint("EndToEnd",n)}o.select()}}else{k()}}function k(){var o=m.selection.createRange();if(n&&!o.item&&o.compareEndPoints("StartToEnd",o)===0){n.select()}g.unbind(m,"mouseup",k);g.unbind(m,"mousemove",l);n=j=0}g.bind(m,["mousedown","contextmenu"],function(o){if(o.target.nodeName==="HTML"){if(j){k()}f=m.documentElement;if(f.scrollHeight>f.clientHeight){return}j=1;n=i(o.x,o.y);if(n){g.bind(m,"mouseup",k);g.bind(m,"mousemove",l);g.win.focus();n.select()}}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Serializer.js' */
(function(a){a.dom.Serializer=function(e,i,f){var h,b,d=a.isIE,g=a.each,c;if(!e.apply_source_formatting){e.indent=false}i=i||a.DOM;f=f||new a.html.Schema(e);e.entity_encoding=e.entity_encoding||"named";e.remove_trailing_brs="remove_trailing_brs" in e?e.remove_trailing_brs:true;h=new a.util.Dispatcher(self);b=new a.util.Dispatcher(self);c=new a.html.DomParser(e,f);c.addAttributeFilter("src,href,style",function(k,j){var o=k.length,l,q,n="data-mce-"+j,p=e.url_converter,r=e.url_converter_scope,m;while(o--){l=k[o];q=l.attributes.map[n];if(q!==m){l.attr(j,q.length>0?q:null);l.attr(n,null)}else{q=l.attributes.map[j];if(j==="style"){q=i.serializeStyle(i.parseStyle(q),l.name)}else{if(p){q=p.call(r,q,j,l.name)}}l.attr(j,q.length>0?q:null)}}});c.addAttributeFilter("class",function(j,k){var l=j.length,m,n;while(l--){m=j[l];n=m.attr("class").replace(/\s*mce(Item\w+|Selected)\s*/g,"");m.attr("class",n.length>0?n:null)}});c.addAttributeFilter("data-mce-type",function(j,l,k){var m=j.length,n;while(m--){n=j[m];if(n.attributes.map["data-mce-type"]==="bookmark"&&!k.cleanup){n.remove()}}});c.addNodeFilter("script,style",function(k,l){var m=k.length,n,o;function j(p){return p.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(m--){n=k[m];o=n.firstChild?n.firstChild.value:"";if(l==="script"){n.attr("type",(n.attr("type")||"text/javascript").replace(/^mce\-/,""));if(o.length>0){n.firstChild.value="// <![CDATA[\n"+j(o)+"\n// ]]>"}}else{if(o.length>0){n.firstChild.value="<!--\n"+j(o)+"\n-->"}}}});c.addNodeFilter("#comment",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.value.indexOf("[CDATA[")===0){m.name="#cdata";m.type=4;m.value=m.value.replace(/^\[CDATA\[|\]\]$/g,"")}else{if(m.value.indexOf("mce:protected ")===0){m.name="#text";m.type=3;m.raw=true;m.value=unescape(m.value).substr(14)}}}});c.addNodeFilter("xml:namespace,input",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.type===7){m.remove()}else{if(m.type===1){if(k==="input"&&!("type" in m.attributes.map)){m.attr("type","text")}}}}});if(e.fix_list_elements){c.addNodeFilter("ul,ol",function(k,l){var m=k.length,n,j;while(m--){n=k[m];j=n.parent;if(j.name==="ul"||j.name==="ol"){if(n.prev&&n.prev.name==="li"){n.prev.append(n)}}}})}c.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style",function(j,k){var l=j.length;while(l--){j[l].attr(k,null)}});return{schema:f,addNodeFilter:c.addNodeFilter,addAttributeFilter:c.addAttributeFilter,onPreProcess:h,onPostProcess:b,serialize:function(o,m){var l,p,k,j,n;o=o.cloneNode(true);l=o.ownerDocument.implementation;if(l.createHTMLDocument){p=l.createHTMLDocument("");g(o.nodeName=="BODY"?o.childNodes:[o],function(q){p.body.appendChild(p.importNode(q,true))});if(o.nodeName!="BODY"){o=p.body.firstChild}else{o=p.body}k=i.doc;i.doc=p}m=m||{};m.format=m.format||"html";if(!m.no_events){m.node=o;h.dispatch(self,m)}j=new a.html.Serializer(e,f);m.content=j.serialize(c.parse(m.getInner?o.innerHTML:a.trim(i.getOuterHTML(o),m),m));if(!m.cleanup){m.content=m.content.replace(/\uFEFF|\u200B/g,"")}if(!m.no_events){b.dispatch(self,m)}if(k){i.doc=k}m.node=null;return m.content},addRules:function(j){f.addValidElements(j)},setRules:function(j){f.setValidElements(j)}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/ScriptLoader.js' */
(function(a){a.dom.ScriptLoader=function(h){var c=0,k=1,i=2,l={},j=[],f={},d=[],g=0,e;function b(m,v){var w=this,q=a.DOM,s,o,r,n;function p(){q.remove(n);if(s){s.onreadystatechange=s.onload=s=null}v()}function u(){AJS.log("Failed to load: "+m)}n=q.uniqueId();if(a.isIE6){o=new a.util.URI(m);r=location;if(o.host==r.hostname&&o.port==r.port&&(o.protocol+":")==r.protocol&&o.protocol.toLowerCase()!="file"){a.util.XHR.send({url:a._addVer(o.getURI()),success:function(x){var t=q.create("script",{type:"text/javascript"});t.text=x;document.getElementsByTagName("head")[0].appendChild(t);q.remove(t);p()},error:u});return}}s=q.create("script",{id:n,type:"text/javascript",src:a._addVer(m)});if(!a.isIE){s.onload=p}s.onerror=u;if(!a.isOpera){s.onreadystatechange=function(){var t=s.readyState;if(t=="complete"||t=="loaded"){p()}}}(document.getElementsByTagName("head")[0]||document.body).appendChild(s)}this.isDone=function(m){return l[m]==i};this.markDone=function(m){l[m]=i};this.add=this.load=function(m,q,n){var o,p=l[m];if(p==e){j.push(m);l[m]=c}if(q){if(!f[m]){f[m]=[]}f[m].push({func:q,scope:n||this})}};this.loadQueue=function(n,m){this.loadScripts(j,n,m)};this.loadScripts=function(m,q,p){var o;function n(r){a.each(f[r],function(s){s.func.call(s.scope)});f[r]=e}d.push({func:q,scope:p||this});o=function(){var r=a.grep(m);m.length=0;a.each(r,function(s){if(l[s]==i){n(s);return}if(l[s]!=k){l[s]=k;g++;b(s,function(){l[s]=i;g--;n(s);o()})}});if(!g){a.each(d,function(s){s.func.call(s.scope)});d.length=0}};o()}};a.ScriptLoader=new a.dom.ScriptLoader()})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/TreeWalker.js' */
tinymce.dom.TreeWalker=function(a,c){var b=a;function d(i,f,e,j){var h,g;if(i){if(!j&&i[f]){return i[f]}if(i!=c){h=i[e];if(h){return h}for(g=i.parentNode;g&&g!=c;g=g.parentNode){h=g[e];if(h){return h}}}}}this.current=function(){return b};this.next=function(e){return(b=d(b,"firstChild","nextSibling",e))};this.prev=function(e){return(b=d(b,"lastChild","previousSibling",e))}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/RangeUtils.js' */
(function(a){a.dom.RangeUtils=function(c){var b="\uFEFF";this.walk=function(d,s){var i=d.startContainer,l=d.startOffset,t=d.endContainer,m=d.endOffset,j,g,o,h,r,q,e;e=c.select("td.mceSelected,th.mceSelected");if(e.length>0){a.each(e,function(u){s([u])});return}function f(u){var v;v=u[0];if(v.nodeType===3&&v===i&&l>=v.nodeValue.length){u.splice(0,1)}v=u[u.length-1];if(m===0&&u.length>0&&v===t&&v.nodeType===3){u.splice(u.length-1,1)}return u}function p(w,v,u){var x=[];for(;w&&w!=u;w=w[v]){x.push(w)}return x}function n(v,u){do{if(v.parentNode==u){return v}v=v.parentNode}while(v)}function k(w,v,x){var u=x?"nextSibling":"previousSibling";for(h=w,r=h.parentNode;h&&h!=v;h=r){r=h.parentNode;q=p(h==w?h:h[u],u);if(q.length){if(!x){q.reverse()}s(f(q))}}}if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[l]}if(t.nodeType==1&&t.hasChildNodes()){t=t.childNodes[Math.min(m-1,t.childNodes.length-1)]}if(i==t){return s(f([i]))}j=c.findCommonAncestor(i,t);for(h=i;h;h=h.parentNode){if(h===t){return k(i,j,true)}if(h===j){break}}for(h=t;h;h=h.parentNode){if(h===i){return k(t,j)}if(h===j){break}}g=n(i,j)||i;o=n(t,j)||t;k(i,g,true);q=p(g==i?g:g.nextSibling,"nextSibling",o==t?o.nextSibling:o);if(q.length){s(f(q))}k(t,o)};this.split=function(e){var h=e.startContainer,d=e.startOffset,i=e.endContainer,g=e.endOffset;function f(j,k){return j.splitText(k)}if(h==i&&h.nodeType==3){if(d>0&&d<h.nodeValue.length){i=f(h,d);h=i.previousSibling;if(g>d){g=g-d;h=i=f(i,g).previousSibling;g=i.nodeValue.length;d=0}else{g=0}}}else{if(h.nodeType==3&&d>0&&d<h.nodeValue.length){h=f(h,d);d=0}if(i.nodeType==3&&g>0&&g<i.nodeValue.length){i=f(i,g).previousSibling;g=i.nodeValue.length}}return{startContainer:h,startOffset:d,endContainer:i,endOffset:g}}};a.dom.RangeUtils.compareRanges=function(c,b){if(c&&b){if(c.item||c.duplicate){if(c.item&&b.item&&c.item(0)===b.item(0)){return true}if(c.isEqual&&b.isEqual&&b.isEqual(c)){return true}}else{return c.startContainer==b.startContainer&&c.startOffset==b.startOffset}}return false}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/KeyboardNavigation.js' */
(function(b){var a=b.dom.Event,c=b.each;b.create("tinymce.ui.KeyboardNavigation",{KeyboardNavigation:function(e,f){var p=this,m=e.root,l=e.items,n=e.enableUpDown,i=e.enableLeftRight||!e.enableUpDown,k=e.excludeFromTabOrder,j,h,o,d,g;f=f||b.DOM;j=function(q){g=q.target.id};h=function(q){f.setAttrib(q.target.id,"tabindex","-1")};d=function(q){var r=f.get(g);f.setAttrib(r,"tabindex","0");r.focus()};p.focus=function(){f.get(g).focus()};p.destroy=function(){c(l,function(q){f.unbind(f.get(q.id),"focus",j);f.unbind(f.get(q.id),"blur",h)});f.unbind(f.get(m),"focus",d);f.unbind(f.get(m),"keydown",o);l=f=m=p.focus=j=h=o=d=null;p.destroy=function(){}};p.moveFocus=function(u,r){var q=-1,t=p.controls,s;if(!g){return}c(l,function(w,v){if(w.id===g){q=v;return false}});q+=u;if(q<0){q=l.length-1}else{if(q>=l.length){q=0}}s=l[q];f.setAttrib(g,"tabindex","-1");f.setAttrib(s.id,"tabindex","0");f.get(s.id).focus();if(e.actOnFocus){e.onAction(s.id)}if(r){a.cancel(r)}};o=function(x){var u=37,t=39,w=38,y=40,q=27,s=14,r=13,v=32;switch(x.keyCode){case u:if(i){p.moveFocus(-1)}break;case t:if(i){p.moveFocus(1)}break;case w:if(n){p.moveFocus(-1)}break;case y:if(n){p.moveFocus(1)}break;case q:if(e.onCancel){e.onCancel();a.cancel(x)}break;case s:case r:case v:if(e.onAction){e.onAction(g);a.cancel(x)}break}};c(l,function(s,q){var r;if(!s.id){s.id=f.uniqueId("_mce_item_")}if(k){f.bind(s.id,"blur",h);r="-1"}else{r=(q===0?"0":"-1")}f.setAttrib(s.id,"tabindex",r);f.bind(f.get(s.id),"focus",j)});if(l[0]){g=l[0].id}f.setAttrib(m,"tabindex","-1");f.bind(f.get(m),"focus",d);f.bind(f.get(m),"keydown",o)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Control.js' */
(function(c){var b=c.DOM,a=c.is;c.create("tinymce.ui.Control",{Control:function(f,e,d){this.id=f;this.settings=e=e||{};this.rendered=false;this.onRender=new c.util.Dispatcher(this);this.classPrefix="";this.scope=e.scope||this;this.disabled=0;this.active=0;this.editor=d},setAriaProperty:function(f,e){var d=b.get(this.id+"_aria")||b.get(this.id);if(d){b.setAttrib(d,"aria-"+f,!!e)}},focus:function(){b.get(this.id).focus()},setDisabled:function(d){if(d!=this.disabled){this.setAriaProperty("disabled",d);this.setState("Disabled",d);this.setState("Enabled",!d);this.disabled=d}},isDisabled:function(){return this.disabled},setActive:function(d){if(d!=this.active){this.setState("Active",d);this.active=d;this.setAriaProperty("pressed",d)}},isActive:function(){return this.active},setState:function(f,d){var e=b.get(this.id);f=this.classPrefix+f;if(d){b.addClass(e,f)}else{b.removeClass(e,f)}},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(d){b.setHTML(d,this.renderHTML())},postRender:function(){var e=this,d;if(a(e.disabled)){d=e.disabled;e.disabled=-1;e.setDisabled(d)}if(a(e.active)){d=e.active;e.active=-1;e.setActive(d)}},remove:function(){b.remove(this.id);this.destroy()},destroy:function(){c.dom.Event.clear(this.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Container.js' */
tinymce.create("tinymce.ui.Container:tinymce.ui.Control",{Container:function(c,b,a){this.parent(c,b,a);this.controls=[];this.lookup={}},add:function(a){this.lookup[a.id]=a;this.controls.push(a);return a},get:function(a){return this.lookup[a]}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Separator.js' */
tinymce.create("tinymce.ui.Separator:tinymce.ui.Control",{Separator:function(b,a){this.parent(b,a);this.classPrefix="mceSeparator";this.setDisabled(true)},renderHTML:function(){return tinymce.DOM.createHTML("span",{"class":this.classPrefix,role:"separator","aria-orientation":"vertical",tabindex:"-1"})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/MenuItem.js' */
(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create("tinymce.ui.MenuItem:tinymce.ui.Control",{MenuItem:function(g,f){this.parent(g,f);this.classPrefix="mceMenuItem"},setSelected:function(f){this.setState("Selected",f);this.setAriaProperty("checked",!!f);this.selected=f},isSelected:function(){return this.selected},postRender:function(){var f=this;f.parent();if(c(f.selected)){f.setSelected(f.selected)}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Menu.js' */
(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create("tinymce.ui.Menu:tinymce.ui.MenuItem",{Menu:function(h,g){var f=this;f.parent(h,g);f.items={};f.collapsed=false;f.menuCount=0;f.onAddItem=new d.util.Dispatcher(this)},expand:function(g){var f=this;if(g){a(f,function(h){if(h.expand){h.expand()}},"items",f)}f.collapsed=false},collapse:function(g){var f=this;if(g){a(f,function(h){if(h.collapse){h.collapse()}},"items",f)}f.collapsed=true},isCollapsed:function(){return this.collapsed},add:function(f){if(!f.settings){f=new d.ui.MenuItem(f.id||b.uniqueId(),f)}this.onAddItem.dispatch(this,f);return this.items[f.id]=f},addSeparator:function(){return this.add({separator:true})},addMenu:function(f){if(!f.collapse){f=this.createMenu(f)}this.menuCount++;return this.add(f)},hasMenus:function(){return this.menuCount!==0},remove:function(f){delete this.items[f.id]},removeAll:function(){var f=this;a(f,function(g){if(g.removeAll){g.removeAll()}else{g.remove()}g.destroy()},"items",f);f.items={}},createMenu:function(g){var f=new d.ui.Menu(g.id||b.uniqueId(),g);f.onAddItem.add(this.onAddItem.dispatch,this.onAddItem);return f}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/DropMenu.js' */
(function(e){var d=e.is,c=e.DOM,f=e.each,a=e.dom.Event,b=e.dom.Element;e.create("tinymce.ui.DropMenu:tinymce.ui.Menu",{DropMenu:function(h,g){g=g||{};g.container=g.container||c.doc.body;g.offset_x=g.offset_x||0;g.offset_y=g.offset_y||0;g.vp_offset_x=g.vp_offset_x||0;g.vp_offset_y=g.vp_offset_y||0;if(d(g.icons)&&!g.icons){g["class"]+=" mceNoIcons"}this.parent(h,g);this.onShowMenu=new e.util.Dispatcher(this);this.onHideMenu=new e.util.Dispatcher(this);this.classPrefix="mceMenu"},createMenu:function(j){var h=this,i=h.settings,g;j.container=j.container||i.container;j.parent=h;j.constrain=j.constrain||i.constrain;j["class"]=j["class"]||i["class"];j.vp_offset_x=j.vp_offset_x||i.vp_offset_x;j.vp_offset_y=j.vp_offset_y||i.vp_offset_y;j.keyboard_focus=i.keyboard_focus;g=new e.ui.DropMenu(j.id||c.uniqueId(),j);g.onAddItem.add(h.onAddItem.dispatch,h.onAddItem);return g},focus:function(){var g=this;if(g.keyboardNav){g.keyboardNav.focus()}},update:function(){var i=this,j=i.settings,g=c.get("menu_"+i.id+"_tbl"),l=c.get("menu_"+i.id+"_co"),h,k;h=j.max_width?Math.min(g.clientWidth,j.max_width):g.clientWidth;k=j.max_height?Math.min(g.clientHeight,j.max_height):g.clientHeight;if(!c.boxModel){i.element.setStyles({width:h+2,height:k+2})}else{i.element.setStyles({width:h,height:k})}if(j.max_width){c.setStyle(l,"width",h)}if(j.max_height){c.setStyle(l,"height",k);if(g.clientHeight<j.max_height){c.setStyle(l,"overflow","hidden")}}},showMenu:function(p,n,r){var z=this,A=z.settings,o,g=c.getViewPort(),u,l,v,q,i=2,k,j,m=z.classPrefix;z.collapse(1);if(z.isMenuVisible){return}if(!z.rendered){o=c.add(z.settings.container,z.renderNode());f(z.items,function(h){h.postRender()});z.element=new b("menu_"+z.id,{blocker:1,container:A.container})}else{o=c.get("menu_"+z.id)}if(!e.isOpera){c.setStyles(o,{left:-65535,top:-65535})}c.show(o);z.update();p+=A.offset_x||0;n+=A.offset_y||0;g.w-=4;g.h-=4;if(A.constrain){u=o.clientWidth-i;l=o.clientHeight-i;v=g.x+g.w;q=g.y+g.h;if((p+A.vp_offset_x+u)>v){p=r?r-u:Math.max(0,(v-A.vp_offset_x)-u)}if((n+A.vp_offset_y+l)>q){n=Math.max(0,(q-A.vp_offset_y)-l)}}c.setStyles(o,{left:p,top:n});z.element.update();z.isMenuVisible=1;z.mouseClickFunc=a.add(o,"click",function(s){var h;s=s.target;if(s&&(s=c.getParent(s,"tr"))&&!c.hasClass(s,m+"ItemSub")){h=z.items[s.id];if(h.isDisabled()){return}k=z;while(k){if(k.hideMenu){k.hideMenu()}k=k.settings.parent}if(h.settings.onclick){h.settings.onclick(s)}return a.cancel(s)}});if(z.hasMenus()){z.mouseOverFunc=a.add(o,"mouseover",function(w){var h,t,s;w=w.target;if(w&&(w=c.getParent(w,"tr"))){h=z.items[w.id];if(z.lastMenu){z.lastMenu.collapse(1)}if(h.isDisabled()){return}if(w&&c.hasClass(w,m+"ItemSub")){t=c.getRect(w);h.showMenu((t.x+t.w-i),t.y-i,t.x);z.lastMenu=h;c.addClass(c.get(h.id).firstChild,m+"ItemActive")}}})}a.add(o,"keydown",z._keyHandler,z);z.onShowMenu.dispatch(z);if(A.keyboard_focus){z._setupKeyboardNav()}},hideMenu:function(j){var g=this,i=c.get("menu_"+g.id),h;if(!g.isMenuVisible){return}if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(i,"mouseover",g.mouseOverFunc);a.remove(i,"click",g.mouseClickFunc);a.remove(i,"keydown",g._keyHandler);c.hide(i);g.isMenuVisible=0;if(!j){g.collapse(1)}if(g.element){g.element.hide()}if(h=c.get(g.id)){c.removeClass(h.firstChild,g.classPrefix+"ItemActive")}g.onHideMenu.dispatch(g)},add:function(i){var g=this,h;i=g.parent(i);if(g.isRendered&&(h=c.get("menu_"+g.id))){g._add(c.select("tbody",h)[0],i)}return i},collapse:function(g){this.parent(g);this.hideMenu(1)},remove:function(g){c.remove(g.id);this.destroy();return this.parent(g)},destroy:function(){var g=this,h=c.get("menu_"+g.id);if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(h,"mouseover",g.mouseOverFunc);a.remove(c.select("a",h),"focus",g.mouseOverFunc);a.remove(h,"click",g.mouseClickFunc);a.remove(h,"keydown",g._keyHandler);if(g.element){g.element.remove()}c.remove(h)},renderNode:function(){var i=this,j=i.settings,l,h,k,g;g=c.create("div",{role:"listbox",id:"menu_"+i.id,"class":j["class"],style:"position:absolute;left:0;top:0;z-index:200000;outline:0"});if(i.settings.parent){c.setAttrib(g,"aria-parent","menu_"+i.settings.parent.id)}k=c.add(g,"div",{role:"presentation",id:"menu_"+i.id+"_co","class":i.classPrefix+(j["class"]?" "+j["class"]:"")});i.element=new b("menu_"+i.id,{blocker:1,container:j.container});if(j.menu_line){c.add(k,"span",{"class":i.classPrefix+"Line"})}l=c.add(k,"table",{role:"presentation",id:"menu_"+i.id+"_tbl",border:0,cellPadding:0,cellSpacing:0});h=c.add(l,"tbody");f(i.items,function(m){i._add(h,m)});i.rendered=true;return g},_setupKeyboardNav:function(){var i,h,g=this;i=c.get("menu_"+g.id);h=c.select("a[role=option]","menu_"+g.id);h.splice(0,0,i);g.keyboardNav=new e.ui.KeyboardNavigation({root:"menu_"+g.id,items:h,onCancel:function(){g.hideMenu()},enableUpDown:true});i.focus()},_keyHandler:function(g){var h=this,i;switch(g.keyCode){case 37:if(h.settings.parent){h.hideMenu();h.settings.parent.focus();a.cancel(g)}break;case 39:if(h.mouseOverFunc){h.mouseOverFunc(g)}break}},_add:function(j,h){var i,q=h.settings,p,l,k,m=this.classPrefix,g;if(q.separator){l=c.add(j,"tr",{id:h.id,"class":m+"ItemSeparator"});c.add(l,"td",{"class":m+"ItemSeparator"});if(i=l.previousSibling){c.addClass(i,"mceLast")}return}i=l=c.add(j,"tr",{id:h.id,"class":m+"Item "+m+"ItemEnabled"});i=k=c.add(i,q.titleItem?"th":"td");i=p=c.add(i,"a",{id:h.id+"_aria",role:q.titleItem?"presentation":"option",href:"javascript:;",onclick:"return false;",onmousedown:"return false;"});if(q.parent){c.setAttrib(p,"aria-haspopup","true");c.setAttrib(p,"aria-owns","menu_"+h.id)}c.addClass(k,q["class"]);g=c.add(i,"span",{"class":"mceIcon"+(q.icon?" mce_"+q.icon:"")});if(q.icon_src){c.add(g,"img",{src:q.icon_src})}i=c.add(i,q.element||"span",{"class":"mceText",title:h.settings.title},h.settings.title);if(h.settings.style){c.setAttrib(i,"style",h.settings.style)}if(j.childNodes.length==1){c.addClass(l,"mceFirst")}if((i=l.previousSibling)&&c.hasClass(i,m+"ItemSeparator")){c.addClass(l,"mceFirst")}if(h.collapse){c.addClass(l,m+"ItemSub")}if(i=l.previousSibling){c.removeClass(i,"mceLast")}c.addClass(l,"mceLast")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Button.js' */
(function(b){var a=b.DOM;b.create("tinymce.ui.Button:tinymce.ui.Control",{Button:function(e,d,c){this.parent(e,d,c);this.classPrefix="mceButton"},renderHTML:function(){var f=this.classPrefix,e=this.settings,d,c;c=a.encode(e.label||"");d='<a role="button" id="'+this.id+'" href="javascript:;" class="'+f+" "+f+"Enabled "+e["class"]+(c?" "+f+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+a.encode(e.title)+'">';if(e.image&&!(this.editor&&this.editor.forcedHighContrastMode)){d+='<img class="mceIcon" src="'+e.image+'" alt="'+a.encode(e.title)+'" />'+c}else{d+='<span class="mceIcon '+e["class"]+'"></span>'+(c?'<span class="'+f+'Label">'+c+"</span>":"")}d+='<span class="mceVoiceLabel mceIconOnly" style="display: none;" id="'+this.id+'_voice">'+e.title+"</span>";d+="</a>";return d},postRender:function(){var d=this,e=d.settings,c;if(b.isIE&&d.editor){b.dom.Event.add(d.id,"mousedown",function(f){var g=d.editor.selection.getNode().nodeName;c=g==="IMG"?d.editor.selection.getBookmark():null})}b.dom.Event.add(d.id,"click",function(f){if(!d.isDisabled()){if(b.isIE&&d.editor&&c!==null){d.editor.selection.moveToBookmark(c)}return e.onclick.call(e.scope,f)}});b.dom.Event.add(d.id,"keyup",function(f){if(!d.isDisabled()&&f.keyCode==b.VK.SPACEBAR){return e.onclick.call(e.scope,f)}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ListBox.js' */
(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create("tinymce.ui.ListBox:tinymce.ui.Control",{ListBox:function(i,h,f){var g=this;g.parent(i,h,f);g.items=[];g.onChange=new a(g);g.onPostRender=new a(g);g.onAdd=new a(g);g.onRenderMenu=new d.util.Dispatcher(this);g.classPrefix="mceListBox"},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&typeof(h)=="function"){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){var h=this,i,j,g;if(f!=h.selectedIndex){i=c.get(h.id+"_text");g=c.get(h.id+"_voiceDesc");j=h.items[f];if(j){h.selectedValue=j.value;h.selectedIndex=f;c.setHTML(i,c.encode(j.title));c.setHTML(g,h.settings.title+" - "+j.title);c.removeClass(i,"mceTitle");c.setAttrib(h.id,"aria-valuenow",j.title)}else{c.setHTML(i,c.encode(h.settings.title));c.setHTML(g,c.encode(h.settings.title));c.addClass(i,"mceTitle");h.selectedValue=h.selectedIndex=null;c.setAttrib(h.id,"aria-valuenow",h.settings.title)}i=0}},add:function(i,f,h){var g=this;h=h||{};h=d.extend(h,{title:i,value:f});g.items.push(h);g.onAdd.dispatch(g,h)},getLength:function(){return this.items.length},renderHTML:function(){var i="",f=this,g=f.settings,j=f.classPrefix;i='<span role="listbox" aria-haspopup="true" aria-labelledby="'+f.id+'_voiceDesc" aria-describedby="'+f.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+f.id+'" cellpadding="0" cellspacing="0" class="'+j+" "+j+"Enabled"+(g["class"]?(" "+g["class"]):"")+'"><tbody><tr>';i+="<td>"+c.createHTML("span",{id:f.id+"_voiceDesc","class":"voiceLabel",style:"display:none;"},f.settings.title);i+=c.createHTML("a",{id:f.id+"_text",tabindex:-1,href:"javascript:;","class":"mceText",onclick:"return false;",onmousedown:"return false;"},c.encode(f.settings.title))+"</td>";i+="<td>"+c.createHTML("a",{id:f.id+"_open",tabindex:-1,href:"javascript:;","class":"mceOpen",onclick:"return false;",onmousedown:"return false;"},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span></span>')+"</td>";i+="</tr></tbody></table></span>";return i},showMenu:function(){var g=this,i,h=c.get(this.id),f;if(g.isDisabled()||g.items.length==0){return}if(g.menu&&g.menu.isMenuVisible){return g.hideMenu()}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}i=c.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.keyboard_focus=!d.isOpera;if(g.oldID){f.items[g.oldID].setSelected(0)}e(g.items,function(j){if(j.value===g.selectedValue){f.items[j.id].setSelected(1);g.oldID=j.id}});f.showMenu(0,h.clientHeight);b.add(c.doc,"mousedown",g.hideMenu,g);c.addClass(g.id,g.classPrefix+"Selected")},hideMenu:function(g){var f=this;if(f.menu&&f.menu.isMenuVisible){c.removeClass(f.id,f.classPrefix+"Selected");if(g&&g.type=="mousedown"&&(g.target.id==f.id+"_text"||g.target.id==f.id+"_open")){return}if(!g||!c.getParent(g.target,".mceMenu")){c.removeClass(f.id,f.classPrefix+"Selected");b.remove(c.doc,"mousedown",f.hideMenu,f);f.menu.hideMenu()}}},renderMenu:function(){var g=this,f;f=g.settings.control_manager.createDropMenu(g.id+"_menu",{menu_line:1,"class":g.classPrefix+"Menu mceNoIcons",max_width:150,max_height:150});f.onHideMenu.add(function(){g.hideMenu();g.focus()});f.add({title:g.settings.title,"class":"mceMenuItemTitle",onclick:function(){if(g.settings.onselect("")!==false){g.select("")}}});e(g.items,function(h){if(h.value===undefined){f.add({title:h.title,role:"option","class":"mceMenuItemTitle",onclick:function(){if(g.settings.onselect("")!==false){g.select("")}}})}else{h.id=c.uniqueId();h.role="option";h.onclick=function(){if(g.settings.onselect(h.value)!==false){g.select(h.value)}};f.add(h)}});g.onRenderMenu.dispatch(g,f);g.menu=f},postRender:function(){var f=this,g=f.classPrefix;b.add(f.id,"click",f.showMenu,f);b.add(f.id,"keydown",function(h){if(h.keyCode==32){f.showMenu(h);b.cancel(h)}});b.add(f.id,"focus",function(){if(!f._focused){f.keyDownHandler=b.add(f.id,"keydown",function(h){if(h.keyCode==40){f.showMenu();b.cancel(h)}});f.keyPressHandler=b.add(f.id,"keypress",function(i){var h;if(i.keyCode==13){h=f.selectedValue;f.selectedValue=null;b.cancel(i);f.settings.onselect(h)}})}f._focused=1});b.add(f.id,"blur",function(){b.remove(f.id,"keydown",f.keyDownHandler);b.remove(f.id,"keypress",f.keyPressHandler);f._focused=0});if(d.isIE6||!c.boxModel){b.add(f.id,"mouseover",function(){if(!c.hasClass(f.id,g+"Disabled")){c.addClass(f.id,g+"Hover")}});b.add(f.id,"mouseout",function(){if(!c.hasClass(f.id,g+"Disabled")){c.removeClass(f.id,g+"Hover")}})}f.onPostRender.dispatch(f,c.get(f.id))},destroy:function(){this.parent();b.clear(this.id+"_text");b.clear(this.id+"_open")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/NativeListBox.js' */
(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create("tinymce.ui.NativeListBox:tinymce.ui.ListBox",{NativeListBox:function(g,f){this.parent(g,f);this.classPrefix="mceNativeListBox"},setDisabled:function(f){c.get(this.id).disabled=f;this.setAriaProperty("disabled",f)},isDisabled:function(){return c.get(this.id).disabled},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&typeof(h)=="function"){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){c.get(this.id).selectedIndex=f+1;this.selectedValue=this.items[f]?this.items[f].value:null},add:function(j,g,f){var i,h=this;f=f||{};f.value=g;if(h.isRendered()){c.add(c.get(this.id),"option",f,j)}i={title:j,value:g,attribs:f};h.items.push(i);h.onAdd.dispatch(h,i)},getLength:function(){return this.items.length},renderHTML:function(){var g,f=this;g=c.createHTML("option",{value:""},"-- "+f.settings.title+" --");e(f.items,function(h){g+=c.createHTML("option",{value:h.value},h.title)});g=c.createHTML("select",{id:f.id,"class":"mceNativeListBox","aria-labelledby":f.id+"_aria"},g);g+=c.createHTML("span",{id:f.id+"_aria",style:"display: none"},f.settings.title);return g},postRender:function(){var g=this,h,i=true;g.rendered=true;function f(k){var j=g.items[k.target.selectedIndex-1];if(j&&(j=j.value)){g.onChange.dispatch(g,j);if(g.settings.onselect){g.settings.onselect(j)}}}b.add(g.id,"change",f);b.add(g.id,"keydown",function(k){var j;b.remove(g.id,"change",h);i=false;j=b.add(g.id,"blur",function(){if(i){return}i=true;b.add(g.id,"change",f);b.remove(g.id,"blur",j)});if(d.isWebKit&&(k.keyCode==37||k.keyCode==39)){return b.prevent(k)}if(k.keyCode==13||k.keyCode==32){f(k);return b.cancel(k)}});g.onPostRender.dispatch(g,c.get(g.id))}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/MenuButton.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create("tinymce.ui.MenuButton:tinymce.ui.Button",{MenuButton:function(g,f,e){this.parent(g,f,e);this.onRenderMenu=new c.util.Dispatcher(this);f.menu_container=f.menu_container||b.doc.body},showMenu:function(){var g=this,j,i,h=b.get(g.id),f;if(g.isDisabled()){return}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}if(g.isMenuVisible){return g.hideMenu()}j=b.getPos(g.settings.menu_container);i=b.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.vp_offset_x=i.x;f.settings.vp_offset_y=i.y;f.settings.keyboard_focus=g._focused;f.showMenu(0,h.clientHeight);a.add(b.doc,"mousedown",g.hideMenu,g);g.setState("Selected",1);g.isMenuVisible=1},renderMenu:function(){var f=this,e;e=f.settings.control_manager.createDropMenu(f.id+"_menu",{menu_line:1,"class":this.classPrefix+"Menu",icons:f.settings.icons});e.onHideMenu.add(function(){f.hideMenu();f.focus()});f.onRenderMenu.dispatch(f,e);f.menu=e},hideMenu:function(g){var f=this;if(g&&g.type=="mousedown"&&b.getParent(g.target,function(h){return h.id===f.id||h.id===f.id+"_open"})){return}if(!g||!b.getParent(g.target,".mceMenu")){f.setState("Selected",0);a.remove(b.doc,"mousedown",f.hideMenu,f);if(f.menu){f.menu.hideMenu()}}f.isMenuVisible=0},postRender:function(){var e=this,f=e.settings;a.add(e.id,"click",function(){if(!e.isDisabled()){if(f.onclick){f.onclick(e.value)}e.showMenu()}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/SplitButton.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create("tinymce.ui.SplitButton:tinymce.ui.MenuButton",{SplitButton:function(g,f,e){this.parent(g,f,e);this.classPrefix="mceSplitButton"},renderHTML:function(){var i,f=this,g=f.settings,e;i="<tbody><tr>";if(g.image){e=b.createHTML("img ",{src:g.image,role:"presentation","class":"mceAction "+g["class"]})}else{e=b.createHTML("span",{"class":"mceAction "+g["class"]},"")}e+=b.createHTML("span",{"class":"mceVoiceLabel mceIconOnly",id:f.id+"_voice",style:"display:none;"},g.title);i+="<td >"+b.createHTML("a",{role:"button",id:f.id+"_action",tabindex:"-1",href:"javascript:;","class":"mceAction "+g["class"],onclick:"return false;",onmousedown:"return false;",title:g.title},e)+"</td>";e=b.createHTML("span",{"class":"mceOpen "+g["class"]},'<span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span>');i+="<td >"+b.createHTML("a",{role:"button",id:f.id+"_open",tabindex:"-1",href:"javascript:;","class":"mceOpen "+g["class"],onclick:"return false;",onmousedown:"return false;",title:g.title},e)+"</td>";i+="</tr></tbody>";i=b.createHTML("table",{role:"presentation","class":"mceSplitButton mceSplitButtonEnabled "+g["class"],cellpadding:"0",cellspacing:"0",title:g.title},i);return b.createHTML("div",{id:f.id,role:"button",tabindex:"0","aria-labelledby":f.id+"_voice","aria-haspopup":"true"},i)},postRender:function(){var e=this,g=e.settings,f;if(g.onclick){f=function(h){if(!e.isDisabled()){g.onclick(e.value);a.cancel(h)}};a.add(e.id+"_action","click",f);a.add(e.id,["click","keydown"],function(h){var k=32,m=14,i=13,j=38,l=40;if((h.keyCode===32||h.keyCode===13||h.keyCode===14)&&!h.altKey&&!h.ctrlKey&&!h.metaKey){f();a.cancel(h)}else{if(h.type==="click"||h.keyCode===l){e.showMenu();a.cancel(h)}}})}a.add(e.id+"_open","click",function(h){e.showMenu();a.cancel(h)});a.add([e.id,e.id+"_open"],"focus",function(){e._focused=1});a.add([e.id,e.id+"_open"],"blur",function(){e._focused=0});if(c.isIE6||!b.boxModel){a.add(e.id,"mouseover",function(){if(!b.hasClass(e.id,"mceSplitButtonDisabled")){b.addClass(e.id,"mceSplitButtonHover")}});a.add(e.id,"mouseout",function(){if(!b.hasClass(e.id,"mceSplitButtonDisabled")){b.removeClass(e.id,"mceSplitButtonHover")}})}},destroy:function(){this.parent();a.clear(this.id+"_action");a.clear(this.id+"_open");a.clear(this.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ColorSplitButton.js' */
(function(d){var c=d.DOM,a=d.dom.Event,b=d.is,e=d.each;d.create("tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton",{ColorSplitButton:function(i,h,f){var g=this;g.parent(i,h,f);g.settings=h=d.extend({colors:"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",grid_width:8,default_color:"#888888"},g.settings);g.onShowMenu=new d.util.Dispatcher(g);g.onHideMenu=new d.util.Dispatcher(g);g.value=h.default_color},showMenu:function(){var f=this,g,j,i,h;if(f.isDisabled()){return}if(!f.isMenuRendered){f.renderMenu();f.isMenuRendered=true}if(f.isMenuVisible){return f.hideMenu()}i=c.get(f.id);c.show(f.id+"_menu");c.addClass(i,"mceSplitButtonSelected");h=c.getPos(i);c.setStyles(f.id+"_menu",{left:h.x,top:h.y+i.clientHeight,zIndex:200000});i=0;a.add(c.doc,"mousedown",f.hideMenu,f);f.onShowMenu.dispatch(f);if(f._focused){f._keyHandler=a.add(f.id+"_menu","keydown",function(k){if(k.keyCode==27){f.hideMenu()}});c.select("a",f.id+"_menu")[0].focus()}f.isMenuVisible=1},hideMenu:function(g){var f=this;if(f.isMenuVisible){if(g&&g.type=="mousedown"&&c.getParent(g.target,function(h){return h.id===f.id+"_open"})){return}if(!g||!c.getParent(g.target,".mceSplitButtonMenu")){c.removeClass(f.id,"mceSplitButtonSelected");a.remove(c.doc,"mousedown",f.hideMenu,f);a.remove(f.id+"_menu","keydown",f._keyHandler);c.hide(f.id+"_menu")}f.isMenuVisible=0;f.onHideMenu.dispatch()}},renderMenu:function(){var p=this,h,k=0,q=p.settings,g,j,l,o,f;o=c.add(q.menu_container,"div",{role:"listbox",id:p.id+"_menu","class":q.menu_class+" "+q["class"],style:"position:absolute;left:0;top:-1000px;"});h=c.add(o,"div",{"class":q["class"]+" mceSplitButtonMenu"});c.add(h,"span",{"class":"mceMenuLine"});g=c.add(h,"table",{role:"presentation","class":"mceColorSplitMenu"});j=c.add(g,"tbody");k=0;e(b(q.colors,"array")?q.colors:q.colors.split(","),function(m){m=m.replace(/^#/,"");if(!k--){l=c.add(j,"tr");k=q.grid_width-1}g=c.add(l,"td");var i={href:"javascript:;",style:{backgroundColor:"#"+m},title:p.editor.getLang("colors."+m,m),"data-mce-color":"#"+m};if(!d.isIE){i.role="option"}g=c.add(g,"a",i);if(p.editor.forcedHighContrastMode){g=c.add(g,"canvas",{width:16,height:16,"aria-hidden":"true"});if(g.getContext&&(f=g.getContext("2d"))){f.fillStyle="#"+m;f.fillRect(0,0,16,16)}else{c.remove(g)}}});if(q.more_colors_func){g=c.add(j,"tr");g=c.add(g,"td",{colspan:q.grid_width,"class":"mceMoreColors"});g=c.add(g,"a",{role:"option",id:p.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},q.more_colors_title);a.add(g,"click",function(i){q.more_colors_func.call(q.more_colors_scope||this);return a.cancel(i)})}c.addClass(h,"mceColorSplitMenu");new d.ui.KeyboardNavigation({root:p.id+"_menu",items:c.select("a",p.id+"_menu"),onCancel:function(){p.hideMenu();p.focus()}});a.add(p.id+"_menu","mousedown",function(i){return a.cancel(i)});a.add(p.id+"_menu","click",function(i){var m;i=c.getParent(i.target,"a",j);if(i&&i.nodeName.toLowerCase()=="a"&&(m=i.getAttribute("data-mce-color"))){p.setColor(m)}return a.cancel(i)});return o},setColor:function(f){this.displayColor(f);this.hideMenu();this.settings.onselect(f)},displayColor:function(g){var f=this;c.setStyle(f.id+"_preview","backgroundColor",g);f.value=g},postRender:function(){var f=this,g=f.id;f.parent();c.add(g+"_action","div",{id:g+"_preview","class":"mceColorPreview"});c.setStyle(f.id+"_preview","backgroundColor",f.value)},destroy:function(){this.parent();a.clear(this.id+"_menu");a.clear(this.id+"_more");c.remove(this.id+"_menu")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ToolbarGroup.js' */
(function(b){var d=b.DOM,c=b.each,a=b.dom.Event;b.create("tinymce.ui.ToolbarGroup:tinymce.ui.Container",{renderHTML:function(){var f=this,i=[],e=f.controls,j=b.each,g=f.settings;i.push('<div id="'+f.id+'" role="group" aria-labelledby="'+f.id+'_voice">');i.push("<span role='application'>");i.push('<span id="'+f.id+'_voice" class="mceVoiceLabel" style="display:none;">'+d.encode(g.name)+"</span>");j(e,function(h){i.push(h.renderHTML())});i.push("</span>");i.push("</div>");return i.join("")},focus:function(){var e=this;d.get(e.id).focus()},postRender:function(){var f=this,e=[];c(f.controls,function(g){c(g.controls,function(h){if(h.id){e.push(h)}})});f.keyNav=new b.ui.KeyboardNavigation({root:f.id,items:e,onCancel:function(){if(b.isWebKit){d.get(f.editor.id+"_ifr").focus()}f.editor.focus()},excludeFromTabOrder:!f.settings.tab_focus_toolbar})},destroy:function(){var e=this;e.parent();e.keyNav.destroy();a.clear(e.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Toolbar.js' */
(function(a){var c=a.DOM,b=a.each;a.create("tinymce.ui.Toolbar:tinymce.ui.Container",{renderHTML:function(){var m=this,f="",j,k,n=m.settings,e,d,g,l;l=m.controls;for(e=0;e<l.length;e++){k=l[e];d=l[e-1];g=l[e+1];if(e===0){j="mceToolbarStart";if(k.Button){j+=" mceToolbarStartButton"}else{if(k.SplitButton){j+=" mceToolbarStartSplitButton"}else{if(k.ListBox){j+=" mceToolbarStartListBox"}}}f+=c.createHTML("td",{"class":j},c.createHTML("span",null,"<!-- IE -->"))}if(d&&k.ListBox){if(d.Button||d.SplitButton){f+=c.createHTML("td",{"class":"mceToolbarEnd"},c.createHTML("span",null,"<!-- IE -->"))}}if(c.stdMode){f+='<td style="position: relative">'+k.renderHTML()+"</td>"}else{f+="<td>"+k.renderHTML()+"</td>"}if(g&&k.ListBox){if(g.Button||g.SplitButton){f+=c.createHTML("td",{"class":"mceToolbarStart"},c.createHTML("span",null,"<!-- IE -->"))}}}j="mceToolbarEnd";if(k.Button){j+=" mceToolbarEndButton"}else{if(k.SplitButton){j+=" mceToolbarEndSplitButton"}else{if(k.ListBox){j+=" mceToolbarEndListBox"}}}f+=c.createHTML("td",{"class":j},c.createHTML("span",null,"<!-- IE -->"));return c.createHTML("table",{id:m.id,"class":"mceToolbar"+(n["class"]?" "+n["class"]:""),cellpadding:"0",cellspacing:"0",align:m.settings.align||"",role:"presentation",tabindex:"-1"},"<tbody><tr>"+f+"</tr></tbody>")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/AddOnManager.js' */
(function(b){var a=b.util.Dispatcher,c=b.each;b.create("tinymce.AddOnManager",{AddOnManager:function(){var d=this;d.items=[];d.urls={};d.lookup={};d.onAdd=new a(d)},get:function(d){if(this.lookup[d]){return this.lookup[d].instance}else{return undefined}},dependencies:function(e){var d;if(this.lookup[e]){d=this.lookup[e].dependencies}return d||[]},requireLangPack:function(e){var d=b.settings;if(d&&d.language&&d.language_load!==false){b.ScriptLoader.add(this.urls[e]+"/langs/"+d.language+".js")}},add:function(f,e,d){this.items.push(e);this.lookup[f]={instance:e,dependencies:d};this.onAdd.dispatch(this,f,e);return e},createUrl:function(d,e){if(typeof e==="object"){return e}else{return{prefix:d.prefix,resource:e,suffix:d.suffix}}},addComponents:function(f,d){var e=this.urls[f];b.each(d,function(g){b.ScriptLoader.add(e+"/"+g)})},load:function(j,f,d,h){var g=this,e=f;function i(){var k=g.dependencies(j);b.each(k,function(m){var l=g.createUrl(f,m);g.load(l.resource,l,undefined,undefined)});if(d){if(h){d.call(h)}else{d.call(b.ScriptLoader)}}}if(g.urls[j]){return}if(typeof f==="object"){e=f.prefix+f.resource+f.suffix}if(e.indexOf("/")!=0&&e.indexOf("://")==-1){e=b.baseURL+"/"+e}g.urls[j]=e.substring(0,e.lastIndexOf("/"));if(b.settings.atlassian){AJS.log("Script for ["+j+"] will not be loaded by TinyMCE. Please use Atlassian's requireResource.")}else{if(g.lookup[j]){i()}else{b.ScriptLoader.add(e,i,h)}}}});b.PluginManager=new b.AddOnManager();b.ThemeManager=new b.AddOnManager()}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/EditorManager.js' */
(function(j){var g=j.each,d=j.extend,k=j.DOM,i=j.dom.Event,f=j.ThemeManager,b=j.PluginManager,e=j.explode,h=j.util.Dispatcher,a,c=0;j.documentBaseURL=j.baseURL;AJS.log("tinymce.documentBaseURL = "+j.documentBaseURL);if(!/[\/\\]$/.test(j.documentBaseURL)){j.documentBaseURL+="/"}j.baseURL=new j.util.URI(j.documentBaseURL).toAbsolute(j.baseURL);j.baseURI=new j.util.URI(j.baseURL);j.onBeforeUnload=new h(j);i.add(window,"beforeunload",function(l){j.onBeforeUnload.dispatch(j,l)});j.onAddEditor=new h(j);j.onRemoveEditor=new h(j);j.EditorManager=d(j,{editors:[],i18n:{},activeEditor:null,init:function(v){var u=this,p,o=j.ScriptLoader,r,l=[],q;function m(x,y,t){var w=x[y];if(!w){return}if(j.is(w,"string")){t=w.replace(/\.\w+$/,"");t=t?j.resolve(t):0;w=j.resolve(w)}return w.apply(t||this,Array.prototype.slice.call(arguments,2))}v=d({theme:"simple",language:"en"},v);u.settings=v;function n(){var s,w;m(v,"onpageload");switch(v.mode){case"exact":s=v.elements||"";if(s.length>0){g(e(s),function(x){if(k.get(x)){q=new j.Editor(x,v);l.push(q);q.render(1)}else{g(document.forms,function(y){g(y.elements,function(z){if(z.name===x){x="mce_editor_"+c++;k.setAttrib(z,"id",x);q=new j.Editor(x,v);l.push(q);q.render(1)}})})}})}break;case"textareas":case"specific_textareas":function t(y,x){return x.constructor===RegExp?x.test(y.className):k.hasClass(y,x)}g(k.select("textarea"),function(x){if(v.editor_deselector&&t(x,v.editor_deselector)){return}if(!v.editor_selector||t(x,v.editor_selector)){r=k.get(x.name);if(!x.id&&!r){x.id=x.name}if(!x.id||u.get(x.id)){x.id=k.uniqueId()}q=new j.Editor(x.id,v);l.push(q);q.render(1)}});break}if(v.oninit){s=w=0;g(l,function(x){w++;if(!x.initialized){x.onInit.add(function(){s++;if(s==w){m(v,"oninit")}})}else{s++}if(s==w){m(v,"oninit")}})}}if(v.atlassian){n()}else{i.add(document,"init",n)}},get:function(l){if(l===a){return this.editors}return this.editors[l]},getInstanceById:function(l){return this.get(l)},add:function(m){var l=this,n=l.editors;n[m.id]=m;n.push(m);l._setActive(m);l.onAddEditor.dispatch(l,m);if(j.adapter){j.adapter.patchEditor(m)}return m},remove:function(n){var m=this,l,o=m.editors;if(!o[n.id]){return null}delete o[n.id];for(l=0;l<o.length;l++){if(o[l]==n){o.splice(l,1);break}}if(m.activeEditor==n){m._setActive(o[0])}n.destroy();m.onRemoveEditor.dispatch(m,n);return n},execCommand:function(r,p,o){var q=this,n=q.get(o),l;switch(r){case"mceFocus":n.focus();return true;case"mceAddEditor":case"mceAddControl":if(!q.get(o)){new j.Editor(o,q.settings).render()}return true;case"mceAddFrameControl":l=o.window;l.tinyMCE=tinyMCE;l.tinymce=j;j.DOM.doc=l.document;j.DOM.win=l;n=new j.Editor(o.element_id,o);n.render();if(j.isIE){function m(){n.destroy();l.detachEvent("onunload",m);l=l.tinyMCE=l.tinymce=null}l.attachEvent("onunload",m)}o.page_window=null;return true;case"mceRemoveEditor":case"mceRemoveControl":if(n){n.remove()}return true;case"mceToggleEditor":if(!n){q.execCommand("mceAddControl",0,o);return true}if(n.isHidden()){n.show()}else{n.hide()}return true}if(q.activeEditor){return q.activeEditor.execCommand(r,p,o)}return false},execInstanceCommand:function(p,o,n,m){var l=this.get(p);if(l){return l.execCommand(o,n,m)}return false},triggerSave:function(){g(this.editors,function(l){l.save()})},addI18n:function(n,q){var l,m=this.i18n;if(!j.is(n,"string")){g(n,function(r,p){g(r,function(t,s){g(t,function(v,u){if(s==="common"){m[p+"."+u]=v}else{m[p+"."+s+"."+u]=v}})})})}else{g(q,function(r,p){m[n+"."+p]=r})}},_setActive:function(l){this.selectedInstance=this.activeEditor=l}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/Editor.js' */
(function(n){var o=n.DOM,k=n.dom.Event,f=n.extend,l=n.util.Dispatcher,i=n.each,a=n.isGecko,b=n.isIE,e=n.isWebKit,d=n.is,h=n.ThemeManager,c=n.PluginManager,p=n.inArray,m=n.grep,g=n.explode,j=n.VK;n.create("tinymce.Editor",{Editor:function(u,r){var q=this;q.id=q.editorId=u;q.execCommands={};q.queryStateCommands={};q.queryValueCommands={};q.isNotDirty=false;q.plugins={};i(["onPreInit","onBeforeRenderUI","onPostRender","onLoad","onInit","onRemove","onActivate","onDeactivate","onClick","onEvent","onMouseUp","onMouseDown","onDblClick","onKeyDown","onKeyUp","onKeyPress","onContextMenu","onSubmit","onReset","onPaste","onPreProcess","onPostProcess","onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent","onLoadContent","onSaveContent","onNodeChange","onChange","onBeforeExecCommand","onExecCommand","onUndo","onRedo","onVisualAid","onSetProgressState","onSetAttrib"],function(s){q[s]=new l(q)});q.settings=r=f({id:u,language:"en",docs_language:"en",theme:"simple",skin:"default",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:n.documentBaseURL,add_form_submit_trigger:1,submit_patch:1,add_unload_trigger:1,convert_urls:1,relative_urls:1,remove_script_host:1,table_inline_editing:0,object_resizing:1,cleanup:1,accessibility_focus:1,custom_shortcuts:1,custom_undo_redo_keyboard_shortcuts:1,custom_undo_redo_restore_selection:1,custom_undo_redo:1,doctype:n.isIE6?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">':"<!DOCTYPE html>",visual_table_class:"mceItemTable",visual:1,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",apply_source_formatting:1,directionality:"ltr",forced_root_block:"p",hidden_input:1,padd_empty_editor:1,render_ui:1,init_theme:1,force_p_newlines:1,indentation:"30px",keep_styles:1,fix_table_elements:1,inline_styles:1,convert_fonts_to_spans:true,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr",validate:true,entity_encoding:"named",url_converter:q.convertURL,url_converter_scope:q,ie7_compat:true},r);q.documentBaseURI=new n.util.URI(r.document_base_url||n.documentBaseURL,{base_uri:tinyMCE.baseURI});q.baseURI=n.baseURI;q.contentCSS=[];q.execCallback("setup",q)},render:function(u){var v=this,w=v.settings,x=v.id,q=n.ScriptLoader;if(!w.atlassian&&!k.domLoaded){k.add(document,"init",function(){v.render()});return}tinyMCE.settings=w;if(!v.getElement()){return}if(n.isIDevice&&!n.isIOS5){return}if(!/TEXTAREA|INPUT/i.test(v.getElement().nodeName)&&w.hidden_input&&o.getParent(x,"form")){o.insertAfter(o.create("input",{type:"hidden",name:x}),x)}if(n.WindowManager){v.windowManager=new n.WindowManager(v)}if(w.encoding=="xml"){v.onGetContent.add(function(s,t){if(t.save){t.content=o.encode(t.content)}})}if(w.add_form_submit_trigger){v.onSubmit.addToTop(function(){if(v.initialized){v.save();v.isNotDirty=1}})}if(w.add_unload_trigger){v._beforeUnload=tinyMCE.onBeforeUnload.add(function(){if(v.initialized&&!v.destroyed&&!v.isHidden()){v.save({format:"raw",no_events:true})}})}n.addUnload(v.destroy,v);if(w.submit_patch){v.onBeforeRenderUI.add(function(){var s=v.getElement().form;if(!s){return}if(s._mceOldSubmit){return}if(!s.submit.nodeType&&!s.submit.length){v.formElement=s;s._mceOldSubmit=s.submit;s.submit=function(){n.triggerSave();v.isNotDirty=1;return v.formElement._mceOldSubmit(v.formElement)}}s=null})}function r(){if(w.theme&&w.theme.charAt(0)!="-"&&!h.urls[w.theme]){h.load(w.theme,"themes/"+w.theme+"/editor_template"+n.suffix+".js")}i(g(w.plugins),function(y){if(y&&!c.urls[y]){if(y.charAt(0)=="-"){y=y.substr(1,y.length);var t=c.dependencies(y);i(t,function(A){var z={prefix:"plugins/",resource:A,suffix:"/editor_plugin"+n.suffix+".js"};var A=c.createUrl(z,A);c.load(A.resource,A)})}else{if(y=="safari"){return}c.load(y,{prefix:"plugins/",resource:y,suffix:"/editor_plugin"+n.suffix+".js"})}}});function s(){if(!v.removed){v.init()}}if(w.atlassian){s()}else{q.loadQueue(s)}}r()},init:function(){var v,I=this,J=I.settings,F,B,E=I.getElement(),r,q,G,z,D,H,A,x=[];n.add(I);J.aria_label=J.aria_label||o.getAttrib(E,"aria-label",I.getLang("aria.rich_text_area"));if(J.theme){J.theme=J.theme.replace(/-/,"");r=h.get(J.theme);I.theme=new r();if(I.theme.init&&J.init_theme){I.theme.init(I,h.urls[J.theme]||n.documentBaseURL.replace(/\/$/,""))}}function C(w){var K=c.get(w),t=c.urls[w]||n.documentBaseURL.replace(/\/$/,""),s;if(K&&n.inArray(x,w)===-1){AJS.log("initPlugin: initialise "+w);i(c.dependencies(w),function(u){C(u)});s=new K(I,t);I.plugins[w]=s;if(s.init){s.init(I,t);x.push(w)}AJS.log("initPlugin: finished initialisation of "+w)}}i(g(J.plugins.replace(/\-/g,"")),C);if(J.popup_css!==false){if(J.popup_css){J.popup_css=I.documentBaseURI.toAbsolute(J.popup_css)}else{J.popup_css=I.baseURI.toAbsolute("themes/"+J.theme+"/skins/"+J.skin+"/dialog.css")}}if(J.popup_css_add){J.popup_css+=","+I.documentBaseURI.toAbsolute(J.popup_css_add)}I.controlManager=new n.ControlManager(I);if(J.custom_undo_redo){I.onBeforeExecCommand.add(function(t,w,u,K,s){if(w!="Undo"&&w!="Redo"&&w!="mceRepaint"&&(!s||!s.skip_undo)){I.undoManager.beforeChange()}});I.onExecCommand.add(function(t,w,u,K,s){if(w!="Undo"&&w!="Redo"&&w!="mceRepaint"&&(!s||!s.skip_undo)){I.undoManager.add()}})}I.onExecCommand.add(function(s,t){if(!/^(FontName|FontSize)$/.test(t)){I.nodeChanged()}});if(a){function y(s,t){if(!t||!t.initial){I.execCommand("mceRepaint")}}I.onUndo.add(y);I.onRedo.add(y);I.onSetContent.add(y)}I.onBeforeRenderUI.dispatch(I,I.controlManager);if(J.render_ui){F=J.width||E.style.width||E.offsetWidth;B=J.height||E.style.height||E.offsetHeight;I.orgDisplay=E.style.display;H=/^[0-9\.]+(|px)$/i;if(H.test(""+F)){F=Math.max(parseInt(F)+(r.deltaWidth||0),100)}if(H.test(""+B)){B=Math.max(parseInt(B)+(r.deltaHeight||0),100)}r=I.theme.renderUI({targetNode:E,width:F,height:B,deltaWidth:J.delta_width,deltaHeight:J.delta_height});I.editorContainer=r.editorContainer}if(J.content_editable){E=v=r=null;return I.setupContentEditable()}if(document.domain&&location.hostname!=document.domain){n.relaxedDomain=document.domain}o.setStyles(r.sizeContainer||r.editorContainer,{width:F,height:B});if(J.content_css){n.each(g(J.content_css),function(s){I.contentCSS.push(I.documentBaseURI.toAbsolute(s))})}if(B<100){B=100}AJS.log("Editor:init iframe base href="+AJS.Rte.getCurrentBaseUrl());I.iframeHTML=J.doctype+'<html><head xmlns="http://www.w3.org/1999/xhtml">';if(J.document_base_url!=n.documentBaseURL){I.iframeHTML+='<base href="'+AJS.Rte.getCurrentBaseUrl()+'" />'}if(J.ie7_compat){I.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'}else{I.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=edge" />'}I.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';for(A=0;A<I.contentCSS.length;A++){I.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+I.contentCSS[A]+'" />'}if(J.contentCssTags){I.iframeHTML+=J.contentCssTags}I.contentCSS=[];z=J.body_id||"tinymce";if(z.indexOf("=")!=-1){z=I.getParam("body_id","","hash");z=z[I.id]||z}D=J.body_class||"";if(D.indexOf("=")!=-1){D=I.getParam("body_class","","hash");D=D[I.id]||""}I.iframeHTML+='</head><body id="'+z+'" class="mceContentBody aui-theme-default '+D+'" onload="window.parent.tinyMCE.get(\''+I.id+"').onLoad.dispatch();\"><br></body></html>";if(n.relaxedDomain&&(b||(n.isOpera&&parseFloat(opera.version())<11))){G='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinyMCE.get("'+I.id+'");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()'}v=o.add(r.iframeContainer,"iframe",{id:I.id+"_ifr",src:G||'javascript:""',frameBorder:"0",allowTransparency:"true",title:J.aria_label,style:{width:"100%",height:B,display:"block"}});I.contentAreaContainer=r.iframeContainer;o.get(r.editorContainer).style.display=I.orgDisplay;o.get(I.id).style.display="none";o.setAttrib(I.id,"aria-hidden",true);if(!n.relaxedDomain||!G){I.setupIframe()}E=v=r=null},setupIframe:function(){var r=this,w=r.settings,x=o.get(r.id),y=r.getDoc(),v,q;if(!b||!n.relaxedDomain){y.open();y.write(r.iframeHTML);y.close();if(n.relaxedDomain){y.domain=n.relaxedDomain}}q=r.getBody();q.disabled=true;if(!w.readonly){q.contentEditable=true}q.disabled=false;r.schema=new n.html.Schema(w);r.dom=new n.dom.DOMUtils(r.getDoc(),{keep_values:true,url_converter:r.convertURL,url_converter_scope:r,hex_colors:w.force_hex_style_colors,class_filter:w.class_filter,update_styles:1,fix_ie_paragraphs:1,schema:r.schema});r.parser=new n.html.DomParser(w,r.schema);if(!r.settings.allow_html_in_named_anchor){r.parser.addAttributeFilter("name",function(s,t){var A=s.length,C,z,B,D;while(A--){D=s[A];if(D.name==="a"&&D.firstChild){B=D.parent;C=D.lastChild;do{z=C.prev;B.insert(C,D);C=z}while(C)}}})}r.parser.addAttributeFilter("src,href,style",function(s,t){var z=s.length,B,D=r.dom,C,A;while(z--){B=s[z];C=B.attr(t);A="data-mce-"+t;if(!B.attributes.map[A]){if(t==="style"){B.attr(A,D.serializeStyle(D.parseStyle(C),B.name))}else{B.attr(A,r.convertURL(C,t,B.name))}}}});r.parser.addNodeFilter("script",function(s,t){var z=s.length,A;while(z--){A=s[z];A.attr("type","mce-"+(A.attr("type")||"text/javascript"))}});r.parser.addNodeFilter("#cdata",function(s,t){var z=s.length,A;while(z--){A=s[z];A.type=8;A.name="#comment";A.value="[CDATA["+A.value+"]]"}});r.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(t,z){var A=t.length,B,s=r.schema.getNonEmptyElements();while(A--){B=t[A];if(B.isEmpty(r.schema)){B.empty().append(new n.html.Node("br",1)).shortEnded=true}}});r.serializer=new n.dom.Serializer(w,r.dom,r.schema);r.selection=new n.dom.Selection(r.dom,r.getWin(),r.serializer);r.formatter=new n.Formatter(this);r.formatter.register({alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img.confluence-embedded-image",classes:"image-left"},{selector:"img,table",collapsed:false,styles:{"float":"left"}}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img.confluence-embedded-image",classes:"image-center"},{selector:"table",collapsed:false,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img.confluence-embedded-image",classes:"image-right"},{selector:"img,table",collapsed:false,styles:{"float":"right"}}],alignfull:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"justify"}}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"u",remove:"all"},{inline:"span",styles:{textDecoration:"underline"},exact:true}],strikethrough:[{inline:"s",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:false},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:false},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},link:{inline:"a",selector:"a",remove:"all",split:true,deep:true,onmatch:function(s){return true},onformat:function(z,s,t){i(t,function(B,A){r.dom.setAttrib(z,A,B)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});i("p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp".split(/\s/),function(s){r.formatter.register(s,{block:s,remove:"all"})});r.formatter.register(r.settings.formats);r.undoManager=new n.UndoManager(r);r.undoManager.onAdd.add(function(t,s){if(t.hasUndo()){return r.onChange.dispatch(r,s,t)}});r.undoManager.onUndo.add(function(t,s){return r.onUndo.dispatch(r,s,t)});r.undoManager.onRedo.add(function(t,s){return r.onRedo.dispatch(r,s,t)});r.forceBlocks=new n.ForceBlocks(r,{forced_root_block:w.forced_root_block});r.editorCommands=new n.EditorCommands(r);r.serializer.onPreProcess.add(function(s,t){return r.onPreProcess.dispatch(r,t,s)});r.serializer.onPostProcess.add(function(s,t){return r.onPostProcess.dispatch(r,t,s)});AJS.log("Editor:setupIframe: dispatch onPreInit");r.onPreInit.dispatch(r);if(!w.gecko_spellcheck){r.getBody().spellcheck=0}if(!w.readonly){r._addEvents()}AJS.log("Editor:setupIframe: dispatch controlManager onPostRender");r.controlManager.onPostRender.dispatch(r,r.controlManager);AJS.log("Editor:setupIframe: dispatch onPostRender");r.onPostRender.dispatch(r);r.quirks=new n.util.Quirks(this);if(w.directionality){r.getBody().dir=w.directionality}if(w.nowrap){r.getBody().style.whiteSpace="nowrap"}if(w.handle_node_change_callback){r.onNodeChange.add(function(t,s,z){r.execCallback("handle_node_change_callback",r.id,z,-1,-1,true,r.selection.isCollapsed())})}if(w.save_callback){r.onSaveContent.add(function(s,z){var t=r.execCallback("save_callback",r.id,z.content,r.getBody());if(t){z.content=t}})}if(w.onchange_callback){r.onChange.add(function(t,s){r.execCallback("onchange_callback",r,s)})}if(w.protect){r.onBeforeSetContent.add(function(s,t){if(w.protect){i(w.protect,function(z){t.content=t.content.replace(z,function(A){return"<!--mce:protected "+escape(A)+"-->"})})}})}if(w.convert_newlines_to_brs){r.onBeforeSetContent.add(function(s,t){if(t.initial){t.content=t.content.replace(/\r?\n/g,"<br />")}})}if(w.preformatted){r.onPostProcess.add(function(s,t){t.content=t.content.replace(/^\s*<pre.*?>/,"");t.content=t.content.replace(/<\/pre>\s*$/,"");if(t.set){t.content='<pre class="mceItemHidden">'+t.content+"</pre>"}})}if(w.verify_css_classes){r.serializer.attribValueFilter=function(B,z){var A,t;if(B=="class"){if(!r.classesRE){t=r.dom.getClasses();if(t.length>0){A="";i(t,function(s){A+=(A?"|":"")+s["class"]});r.classesRE=new RegExp("("+A+")","gi")}}return !r.classesRE||/(\bmceItem\w+\b|\bmceTemp\w+\b)/g.test(z)||r.classesRE.test(z)?z:""}return z}}if(w.cleanup_callback){r.onBeforeSetContent.add(function(s,t){t.content=r.execCallback("cleanup_callback","insert_to_editor",t.content,t)});r.onPreProcess.add(function(s,t){if(t.set){r.execCallback("cleanup_callback","insert_to_editor_dom",t.node,t)}if(t.get){r.execCallback("cleanup_callback","get_from_editor_dom",t.node,t)}});r.onPostProcess.add(function(s,t){if(t.set){t.content=r.execCallback("cleanup_callback","insert_to_editor",t.content,t)}if(t.get){t.content=r.execCallback("cleanup_callback","get_from_editor",t.content,t)}})}if(w.save_callback){r.onGetContent.add(function(s,t){if(t.save){t.content=r.execCallback("save_callback",r.id,t.content,r.getBody())}})}if(w.handle_event_callback){r.onEvent.add(function(s,t,z){if(r.execCallback("handle_event_callback",t,s,z)===false){k.cancel(t)}})}r.onSetContent.add(function(){r.addVisual(r.getBody())});if(w.padd_empty_editor){r.onPostProcess.add(function(s,t){t.content=t.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")})}if(a){function u(s,t){i(s.dom.select("a"),function(A){var z=A.parentNode;if(s.dom.isBlock(z)&&z.lastChild===A){s.dom.add(z,"br",{"data-mce-bogus":1})}})}r.onExecCommand.add(function(s,t){if(t==="CreateLink"){u(s)}});r.onSetContent.add(r.selection.onSetContent.add(u))}r.load({initial:true,format:"html"});r.startContent=r.getContent({format:"raw"});r.undoManager.add();r.initialized=true;AJS.log("Editor:setupIframe: dispatch onInit");r.onInit.dispatch(r);AJS.log("Editor:setupIframe: Callback setupcontent_callback");r.execCallback("setupcontent_callback",r.id,r.getBody(),r.getDoc());AJS.log("Editor:setupIframe: Completed setupcontent_callback");AJS.log("Editor:setupIframe: Callback init_instance_callback");r.execCallback("init_instance_callback",r);AJS.log("Editor:setupIframe: Completed init_instance_callback");r.focus(true);r.nodeChanged({initial:1});i(r.contentCSS,function(s){r.dom.loadCSS(s)});if(w.auto_focus){setTimeout(function(){var s=n.get(w.auto_focus);s.selection.select(s.getBody(),1);s.selection.collapse(1);s.getBody().focus();s.getWin().focus()},100)}x=null},setupContentEditable:function(){var q=this,r=q.settings,u=q.getElement();q.contentDocument=r.content_document||document;q.contentWindow=r.content_window||window;q.bodyElement=u;r.content_document=r.content_window=null;o.hide(u);u.contentEditable=q.getParam("content_editable_state",true);o.show(u);if(!r.gecko_spellcheck){q.getDoc().body.spellcheck=0}q.dom=new n.dom.DOMUtils(q.getDoc(),{keep_values:true,url_converter:q.convertURL,url_converter_scope:q,hex_colors:r.force_hex_style_colors,class_filter:r.class_filter,root_element:q.id,fix_ie_paragraphs:1,update_styles:1});q.serializer=new n.dom.Serializer(r,q.dom,schema);q.selection=new n.dom.Selection(q.dom,q.getWin(),q.serializer);q.forceBlocks=new n.ForceBlocks(q,{forced_root_block:r.forced_root_block});q.editorCommands=new n.EditorCommands(q);q.serializer.onPreProcess.add(function(s,t){return q.onPreProcess.dispatch(q,t,s)});q.serializer.onPostProcess.add(function(s,t){return q.onPostProcess.dispatch(q,t,s)});q.onPreInit.dispatch(q);q._addEvents();q.controlManager.onPostRender.dispatch(q,q.controlManager);q.onPostRender.dispatch(q);q.onSetContent.add(function(){q.addVisual(q.getBody())});q.startContent=q.getContent({format:"raw"});q.undoManager.add({initial:true});q.initialized=true;q.onInit.dispatch(q);q.focus(true);q.nodeChanged({initial:1});if(r.content_css){i(g(r.content_css),function(s){q.dom.loadCSS(q.documentBaseURI.toAbsolute(s))})}if(b){q.dom.bind(q.getElement(),"beforedeactivate",function(){q.lastSelectionBookmark=q.selection.getBookmark(1)});q.onBeforeExecCommand.add(function(s,v,t,x,w){if(!o.getParent(s.selection.getStart(),function(y){return y==s.getBody()})){w.terminate=1}if(!o.getParent(s.selection.getEnd(),function(y){return y==s.getBody()})){w.terminate=1}})}u=null},focus:function(u){var x,B=this,A=B.selection,r=B.settings.content_editable,w,y,z=B.getDoc(),s,q;if(!u){w=A.getRng();if(w.item){y=w.item(0)}B._refreshContentEditable();if(!r){if(n.isIE){try{s=this.getWin();q=o.getViewPort(s);B.dom.getRoot().focus();s.scrollTo(q.x,q.y)}catch(v){}}else{B.getWin().focus()}}if(n.isGecko){B.getBody().focus()}if(y&&y.ownerDocument==z){w=z.body.createControlRange();w.addElement(y);w.select()}if(r){if(n.isWebKit){B.getWin().focus()}else{if(n.isIE){B.getElement().setActive()}else{B.getElement().focus()}}}}if(n.activeEditor!=B){if((x=n.activeEditor)!=null){x.onDeactivate.dispatch(x,B)}B.onActivate.dispatch(B,x)}n._setActive(B)},execCallback:function(v){var q=this,u=q.settings[v],r;if(!u){return}if(q.callbackLookup&&(r=q.callbackLookup[v])){u=r.func;r=r.scope}if(d(u,"string")){r=u.replace(/\.\w+$/,"");r=r?n.resolve(r):0;u=n.resolve(u);q.callbackLookup=q.callbackLookup||{};q.callbackLookup[v]={func:u,scope:r}}return u.apply(r||q,Array.prototype.slice.call(arguments,1))},translate:function(q){var t=this.settings.language||"en",r=n.i18n;if(!q){return""}return r[t+"."+q]||q.replace(/{\#([^}]+)\}/g,function(u,s){return r[t+"."+s]||"{#"+s+"}"})},getLang:function(r,q){return n.i18n[(this.settings.language||"en")+"."+r]||(d(q)?q:"{#"+r+"}")},getParam:function(w,s,q){var t=n.trim,r=d(this.settings[w])?this.settings[w]:s,u;if(q==="hash"){u={};if(d(r,"string")){i(r.indexOf("=")>0?r.split(/[;,](?![^=;,]*(?:[;,]|$))/):r.split(","),function(x){x=x.split("=");if(x.length>1){u[t(x[0])]=t(x[1])}else{u[t(x[0])]=t(x)}})}else{u=r}return u}return r},nodeChanged:function(u){var q=this,r=q.selection,v=r.getStart()||q.getBody();if(q.initialized){u=u||{};v=b&&v.ownerDocument!=q.getDoc()?q.getBody():v;u.parents=[];q.dom.getParent(v,function(s){if(s.nodeName=="BODY"){return true}u.parents.push(s)});q.onNodeChange.dispatch(q,u?u.controlManager||q.controlManager:q.controlManager,v,r.isCollapsed(),u)}},addButton:function(u,r){var q=this;q.buttons=q.buttons||{};q.buttons[u]=r},addCommand:function(q,s,r){this.execCommands[q]={func:s,scope:r||this}},addQueryStateHandler:function(q,s,r){this.queryStateCommands[q]={func:s,scope:r||this}},addQueryValueHandler:function(q,s,r){this.queryValueCommands[q]={func:s,scope:r||this}},addShortcut:function(s,v,q,u){var r=this,w;if(!r.settings.custom_shortcuts){return false}r.shortcuts=r.shortcuts||{};if(d(q,"string")){w=q;q=function(){r.execCommand(w,false,null)}}if(d(q,"object")){w=q;q=function(){r.execCommand(w[0],w[1],w[2])}}i(g(s),function(t){var x={func:q,scope:u||this,desc:v,alt:false,ctrl:false,shift:false};i(g(t,"+"),function(y){switch(y){case"alt":case"ctrl":case"shift":x[y]=true;break;default:x.charCode=y.charCodeAt(0);x.keyCode=y.toUpperCase().charCodeAt(0)}});r.shortcuts[(x.ctrl?"ctrl":"")+","+(x.alt?"alt":"")+","+(x.shift?"shift":"")+","+x.keyCode]=x});return true},execCommand:function(x,w,z,q){var u=this,v=0,y,r;if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(x)&&(!q||!q.skip_focus)){u.focus()}q=f({},q);u.onBeforeExecCommand.dispatch(u,x,w,z,q);if(q.terminate){return false}if(u.execCallback("execcommand_callback",u.id,u.selection.getNode(),x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}if(y=u.execCommands[x]){r=y.func.call(y.scope,w,z);if(r!==true){u.onExecCommand.dispatch(u,x,w,z,q);return r}}i(u.plugins,function(s){if(s.execCommand&&s.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);v=1;return false}});if(v){return true}if(u.theme&&u.theme.execCommand&&u.theme.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}if(u.editorCommands.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}u.getDoc().execCommand(x,w,z);u.onExecCommand.dispatch(u,x,w,z,q)},queryCommandState:function(v){var r=this,w,u;if(r._isHidden()){return}if(w=r.queryStateCommands[v]){u=w.func.call(w.scope);if(u!==true){return u}}w=r.editorCommands.queryCommandState(v);if(w!==-1){return w}try{return this.getDoc().queryCommandState(v)}catch(q){}},queryCommandValue:function(w){var r=this,v,u;if(r._isHidden()){return}if(v=r.queryValueCommands[w]){u=v.func.call(v.scope);if(u!==true){return u}}v=r.editorCommands.queryCommandValue(w);if(d(v)){return v}try{return this.getDoc().queryCommandValue(w)}catch(q){}},show:function(){var q=this;o.show(q.getContainer());o.hide(q.id);q.load()},hide:function(){var q=this,r=q.getDoc();if(b&&r){r.execCommand("SelectAll")}q.save();o.hide(q.getContainer());o.setStyle(q.id,"display",q.orgDisplay)},isHidden:function(){return !o.isHidden(this.id)},setProgressState:function(q,r,s){this.onSetProgressState.dispatch(this,q,r,s);return q},load:function(u){var q=this,s=q.getElement(),r;if(s){u=u||{};u.load=true;r=q.setContent(d(s.value)?s.value:s.innerHTML,u);u.element=s;if(!u.no_events){q.onLoadContent.dispatch(q,u)}u.element=s=null;return r}},save:function(v){var q=this,u=q.getElement(),r,s;if(!u||!q.initialized){return}v=v||{};v.save=true;if(!v.no_events){q.undoManager.typing=false;q.undoManager.add()}v.element=u;r=v.content=q.getContent(v);if(!v.no_events){q.onSaveContent.dispatch(q,v)}r=v.content;if(!/TEXTAREA|INPUT/i.test(u.nodeName)){u.innerHTML=r;if(s=o.getParent(q.id,"form")){i(s.elements,function(t){if(t.name==q.id){t.value=r;return false}})}}else{u.value=r}v.element=u=null;return r},setContent:function(v,t){var s=this,r,q=s.getBody(),u;t=t||{};t.format=t.format||"html";t.set=true;t.content=v;if(!t.no_events){s.onBeforeSetContent.dispatch(s,t)}v=t.content;if(!n.isIE&&(v.length===0||/^\s+$/.test(v))){u=s.settings.forced_root_block;if(u){v="<"+u+'><br data-mce-bogus="1"></'+u+">"}else{v='<br data-mce-bogus="1">'}q.innerHTML=v;s.selection.select(q,true);s.selection.collapse(true)}if(t.format!=="raw"){v=new n.html.Serializer({},s.schema).serialize(s.parser.parse(v))}t.content=n.trim(v);s.dom.setHTML(q,t.content);if(!t.no_events){s.onSetContent.dispatch(s,t)}s.selection.normalize();return t.content},getContent:function(r){var q=this,s;r=r||{};r.format=r.format||"html";r.get=true;if(!r.no_events){q.onBeforeGetContent.dispatch(q,r)}if(r.format=="raw"){s=q.getBody().innerHTML}else{s=q.serializer.serialize(q.getBody(),r)}r.content=n.trim(s);if(!r.no_events){q.onGetContent.dispatch(q,r)}return r.content},isDirty:function(){var q=this;return n.trim(q.startContent)!=n.trim(q.getContent({format:"raw",no_events:1}))&&!q.isNotDirty},setDirty:function(r){var q=this;q.isNotDirty=r?0:1},getContainer:function(){var q=this;if(!q.container){q.container=o.get(q.editorContainer||q.id+"_parent")}return q.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return o.get(this.settings.content_element||this.id)},getWin:function(){var q=this,r;if(!q.contentWindow){r=o.get(q.id+"_ifr");if(r){q.contentWindow=r.contentWindow}}return q.contentWindow},getDoc:function(){var r=this,q;if(!r.contentDocument){q=r.getWin();if(q){r.contentDocument=q.document}}return r.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(q,x,w){var r=this,v=r.settings;if(v.urlconverter_callback){return r.execCallback("urlconverter_callback",q,w,true,x)}if(!v.convert_urls||(w&&w.nodeName=="LINK")||q.indexOf("file:")===0){return q}if(v.relative_urls){return r.documentBaseURI.toRelative(q)}q=r.documentBaseURI.toAbsolute(q,v.remove_script_host);return q},addVisual:function(u){var q=this,r=q.settings;u=u||q.getBody();if(!d(q.hasVisual)){q.hasVisual=r.visual}i(q.dom.select("table,a",u),function(t){var s;switch(t.nodeName){case"TABLE":s=q.dom.getAttrib(t,"border");if(!s||s=="0"){if(q.hasVisual){q.dom.addClass(t,r.visual_table_class)}else{q.dom.removeClass(t,r.visual_table_class)}}return;case"A":s=q.dom.getAttrib(t,"name");if(s){if(q.hasVisual){q.dom.addClass(t,"mceItemAnchor")}else{q.dom.removeClass(t,"mceItemAnchor")}}return}});q.onVisualAid.dispatch(q,u,q.hasVisual)},remove:function(){var q=this,r=q.getContainer();q.removed=1;q.hide();q.execCallback("remove_instance_callback",q);q.onRemove.dispatch(q);q.onExecCommand.listeners=[];n.remove(q);o.remove(r)},destroy:function(r){var q=this;if(q.destroyed){return}if(!r){n.removeUnload(q.destroy);tinyMCE.onBeforeUnload.remove(q._beforeUnload);if(q.theme&&q.theme.destroy){q.theme.destroy()}q.controlManager.destroy();q.selection.destroy();q.dom.destroy();if(!q.settings.content_editable){k.clear(q.getWin());k.clear(q.getDoc())}k.clear(q.getBody());k.clear(q.formElement)}if(q.formElement){q.formElement.submit=q.formElement._mceOldSubmit;q.formElement._mceOldSubmit=null}q.contentAreaContainer=q.formElement=q.container=q.settings.content_element=q.bodyElement=q.contentDocument=q.contentWindow=null;if(q.selection){q.selection=q.selection.win=q.selection.dom=q.selection.dom.doc=null}q.destroyed=1},_addEvents:function(){var C=this,u,D=C.settings,r=C.dom,x={mouseup:"onMouseUp",mousedown:"onMouseDown",click:"onClick",keyup:"onKeyUp",keydown:"onKeyDown",keypress:"onKeyPress",submit:"onSubmit",reset:"onReset",contextmenu:"onContextMenu",dblclick:"onDblClick",paste:"onPaste"};function q(t,F){var s=t.type;if(C.removed){return}if(C.onEvent.dispatch(C,t,F)!==false){C[x[t.fakeType||t.type]].dispatch(C,t,F)}}i(x,function(t,s){switch(s){case"contextmenu":r.bind(C.getDoc(),s,q);break;case"paste":r.bind(C.getBody(),s,function(F){q(F)});break;case"submit":case"reset":r.bind(C.getElement().form||o.getParent(C.id,"form"),s,q);break;default:r.bind(D.content_editable?C.getBody():C.getDoc(),s,q)}});r.bind(D.content_editable?C.getBody():(a?C.getDoc():C.getWin()),"focus",function(s){C.focus(true)});if(D.content_editable&&n.isOpera){function E(s){C.focus(true)}r.bind(C.getBody(),"click",E);r.bind(C.getBody(),"keydown",E)}if(n.isGecko){r.bind(C.getDoc(),"DOMNodeInserted",function(t){var s;t=t.target;if(t.nodeType===1&&t.nodeName==="IMG"&&(s=t.getAttribute("data-mce-src"))){t.src=C.documentBaseURI.toAbsolute(s)}})}if(a){function v(){var G=this,I=G.getDoc(),H=G.settings;if(a&&!H.readonly){G._refreshContentEditable();try{I.execCommand("styleWithCSS",0,false)}catch(F){if(!G._isHidden()){try{I.execCommand("useCSS",0,true)}catch(F){}}}if(!H.table_inline_editing){try{I.execCommand("enableInlineTableEditing",false,false)}catch(F){}}if(!H.object_resizing){try{I.execCommand("enableObjectResizing",false,false)}catch(F){}}}}C.onBeforeExecCommand.add(v);C.onMouseDown.add(v)}C.onMouseUp.add(C.nodeChanged);C.onKeyUp.add(function(s,t){var F=t.keyCode;if((F>=33&&F<=36)||(F>=37&&F<=40)||F==13||F==45||F==46||F==8||(n.isMac&&(F==91||F==93))||t.ctrlKey){C.nodeChanged()}});C.onKeyDown.add(function(t,F){if(F.keyCode!=j.BACKSPACE){return}var s=t.selection.getRng(true);if(!s.collapsed){return}var H=s.startContainer;var G=s.startOffset;while(H&&H.nodeType&&H.nodeType!=1&&H.parentNode){H=H.parentNode}if(H&&H.parentNode&&H.parentNode.tagName==="BLOCKQUOTE"&&H.parentNode.firstChild==H&&G===0){t.formatter.toggle("blockquote",null,H.parentNode);s.setStart(H,0);s.setEnd(H,0);t.selection.setRng(s);t.selection.collapse(false)}});C.onReset.add(function(){C.setContent(C.startContent,{format:"raw"})});if(D.custom_shortcuts){if(D.custom_undo_redo_keyboard_shortcuts){C.addShortcut("ctrl+z",C.getLang("undo_desc"),"Undo");C.addShortcut("ctrl+y",C.getLang("redo_desc"),"Redo")}C.addShortcut("ctrl+b",C.getLang("bold_desc"),"Bold");C.addShortcut("ctrl+i",C.getLang("italic_desc"),"Italic");C.addShortcut("ctrl+u",C.getLang("underline_desc"),"Underline");function w(t){var s=null;if(!t.altKey&&!t.ctrlKey&&!t.metaKey){return s}i(C.shortcuts,function(F){if(n.isMac&&(F.ctrl!=t.metaKey&&F.ctrl!=t.ctrlKey)){return}else{if(!n.isMac&&F.ctrl!=t.ctrlKey){return}}if(F.alt!=t.altKey){return}if(F.shift!=t.shiftKey){return}if(t.keyCode==F.keyCode||(t.charCode&&t.charCode==F.charCode)){s=F;return false}});return s}C.onKeyUp.add(function(s,t){var F=w(t);if(F){return k.cancel(t)}});C.onKeyPress.add(function(s,t){var F=w(t);if(F){return k.cancel(t)}});C.onKeyDown.add(function(s,t){var F=w(t);if(F){F.func.call(F.scope);return k.cancel(t)}})}if(n.isIE){r.bind(C.getDoc(),"controlselect",function(F){var t=C.resizeInfo,s;F=F.target;if(F.nodeName!=="IMG"){return}if(t){r.unbind(t.node,t.ev,t.cb)}if(!r.hasClass(F,"mceItemNoResize")){ev="resizeend";s=r.bind(F,ev,function(H){var G;H=H.target;if(G=r.getStyle(H,"width")){r.setAttrib(H,"width",G.replace(/[^0-9%]+/g,""));r.setStyle(H,"width","")}if(G=r.getStyle(H,"height")){r.setAttrib(H,"height",G.replace(/[^0-9%]+/g,""));r.setStyle(H,"height","")}})}else{ev="resizestart";s=r.bind(F,"resizestart",k.cancel,k)}t=C.resizeInfo={node:F,ev:ev,cb:s}})}if(n.isOpera){C.onClick.add(function(s,t){k.prevent(t)})}if(D.custom_undo_redo){function z(){C.undoManager.typing=false;C.undoManager.add()}var y=n.isGecko?"blur":"focusout";r.bind(C.getDoc(),y,function(s){if(!C.removed&&C.undoManager.typing){z()}});C.dom.bind(C.dom.getRoot(),"dragend",function(s){z()});C.onKeyUp.add(function(s,F){var t=F.keyCode;if((t>=33&&t<=36)||(t>=37&&t<=40)||t==13||t==45||F.ctrlKey){z()}});C.onKeyDown.add(function(s,G){var F=G.keyCode,t;if(F==8){t=C.getDoc().selection;if(t&&t.createRange&&t.createRange().item){C.undoManager.beforeChange();s.dom.remove(t.createRange().item(0));z();return k.cancel(G)}}if((F>=33&&F<=36)||(F>=37&&F<=40)||F==13||F==45){if(n.isIE&&F==13){C.undoManager.beforeChange()}if(C.undoManager.typing){z()}return}if((F<16||F>20)&&F!=224&&F!=91&&!C.undoManager.typing){C.undoManager.beforeChange();C.undoManager.typing=true;C.undoManager.add()}});C.onMouseDown.add(function(){if(C.undoManager.typing){z()}})}if(n.isGecko){function B(){var s=C.dom.getAttribs(C.selection.getStart().cloneNode(false));return function(){var t=C.selection.getStart();if(t!==C.getBody()){C.dom.setAttrib(t,"style",null);i(s,function(F){t.setAttributeNode(F.cloneNode(true))})}}}function A(){var t=C.selection;return !t.isCollapsed()&&t.getStart()!=t.getEnd()}C.onKeyPress.add(function(s,F){var t;if((F.keyCode==8||F.keyCode==46)&&A()){t=B();C.getDoc().execCommand("delete",false,null);t();return k.cancel(F)}});C.dom.bind(C.getDoc(),"cut",function(t){var s;if(A()){s=B();C.onKeyUp.addToTop(k.cancel,k);setTimeout(function(){s();C.onKeyUp.remove(k.cancel,k)},0)}})}},_refreshContentEditable:function(){var r=this,q,s;if(r._isHidden()){q=r.getBody();s=q.parentNode;s.removeChild(q);s.appendChild(q);q.focus()}},_isHidden:function(){var q;if(!a){return 0}q=this.selection.getSel();return(!q||!q.rangeCount||q.rangeCount==0)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/EditorCommands.js' */
(function(c){var d=c.each,e,a=true,b=false;c.EditorCommands=function(n){var m=n.dom,p=n.selection,j={state:{},exec:{},value:{}},k=n.settings,q=n.formatter,o;function r(y,x,w){var v;y=y.toLowerCase();if(v=j.exec[y]){v(y,x,w);return a}return b}function l(w){var v;w=w.toLowerCase();if(v=j.state[w]){return v(w)}return -1}function h(w){var v;w=w.toLowerCase();if(v=j.value[w]){return v(w)}return b}function u(v,w){w=w||"exec";d(v,function(y,x){d(x.toLowerCase().split(","),function(z){j[w][z]=y})})}c.extend(this,{execCommand:r,queryCommandState:l,queryCommandValue:h,addCommands:u});function f(x,w,v){if(w===e){w=b}if(v===e){v=null}return n.getDoc().execCommand(x,w,v)}function t(v){return q.match(v)}function s(v,w){q.toggle(v,w?{value:w}:e)}function i(v){o=p.getBookmark(v)}function g(){p.moveToBookmark(o)}u({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){n.undoManager.add()},"Cut,Copy,Paste":function(y){var x=n.getDoc(),v;try{f(y)}catch(w){v=a}if(v||!x.queryCommandSupported(y)){if(c.isGecko){n.windowManager.confirm(n.getLang("clipboard_msg"),function(z){if(z){open("http://www.mozilla.org/editor/midasdemo/securityprefs.html","_blank")}})}else{n.windowManager.alert(n.getLang("clipboard_no_support"))}}},unlink:function(v){if(p.isCollapsed()){p.select(p.getNode())}f(v);p.collapse(b)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(x){var y=x.substring(7);n.undoManager.add();var v=p.getRng();var w=p.getNode();d("left,center,right,full".split(","),function(z){if(y!=z){q.remove("align"+z)}if(!tinyMCE.isIE&&(w.nodeName=="IMG")&&((p.getRng().startContainer.nodeName=="#document")||(p.getRng().startContainer.nodeName=="#text"))){p.setRng(v)}});s("align"+y);r("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(x){var v,w;f(x);v=m.getParent(p.getNode(),"ol,ul");if(v){w=v.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(w.nodeName)){i();m.split(w,v);g()}}},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(v){s(v)},"ForeColor,HiliteColor,FontName":function(x,w,v){s(x,v)},FontSize:function(y,x,w){var v,z;if(w>=1&&w<=7){z=c.explode(k.font_size_style_values);v=c.explode(k.font_size_classes);if(v){w=v[w-1]||w}else{w=z[w-1]||w}}s(y,w)},RemoveFormat:function(v){q.remove(v)},mceBlockQuote:function(v){s("blockquote")},FormatBlock:function(x,w,v){return s(v||"p")},mceCleanup:function(){var v=p.getBookmark();n.setContent(n.getContent({cleanup:a}),{cleanup:a});p.moveToBookmark(v)},mceRemoveNode:function(y,x,w){var v=w||p.getNode();if(v!=n.getBody()){i();n.dom.remove(v,a);g()}},mceSelectNodeDepth:function(y,x,w){var v=0;m.getParent(p.getNode(),function(z){if(z.nodeType==1&&v++==w){p.select(z);return b}},n.getBody())},mceSelectNode:function(x,w,v){p.select(v)},mceInsertContent:function(A,H,J){var x,I,D,y,E,F,C,B,K,w,z,L,v,G;x=n.parser;I=new c.html.Serializer({},n.schema);v='<span id="mce_marker" data-mce-type="bookmark">\uFEFF</span>';F={content:J,format:"html"};p.onBeforeSetContent.dispatch(p,F);J=F.content;if(J.indexOf("{$caret}")==-1){J+="{$caret}"}J=J.replace(/\{\$caret\}/,v);if(!p.isCollapsed()&&p.getContent().length){n.execCommand("mceDelete",false,null,{skip_undo:true})}D=p.getNode();F={context:D.nodeName.toLowerCase()};E=x.parse(J,F);z=E.lastChild;if(z.attr("id")=="mce_marker"){C=z;for(z=z.prev;z;z=z.walk(true)){if(z.type==3||!m.isBlock(z.name)){z.parent.insert(C,z,z.name==="br");break}}}if(!F.invalid){J=I.serialize(E);z=D.firstChild;L=D.lastChild;if(!z||(z===L&&z.nodeName==="BR")){m.setHTML(D,J)}else{p.setContent(J)}}else{p.setContent(v);D=n.selection.getNode();y=n.getBody();if(D.nodeType==9){D=z=y}else{z=D}while(z!==y){D=z;z=z.parentNode}J=D==y?y.innerHTML:m.getOuterHTML(D);J=I.serialize(x.parse(J.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return I.serialize(E)})));if(D==y){m.setHTML(y,J)}else{m.setOuterHTML(D,J)}}C=m.get("mce_marker");B=m.getRect(C);K=m.getViewPort(n.getWin());if((B.y+B.h>K.y+K.h||B.y<K.y)||(B.x>K.x+K.w||B.x<K.x)){G=c.isIE?n.getDoc().documentElement:n.getBody();G.scrollLeft=B.x;G.scrollTop=B.y-K.h+25}w=m.createRng();z=C.previousSibling;if(z&&z.nodeType==3){w.setStart(z,z.nodeValue.length)}else{w.setStartBefore(C);w.setEndBefore(C)}m.remove(C);p.setRng(w);p.onSetContent.dispatch(p,F);n.addVisual()},mceInsertRawHTML:function(x,w,v){p.setContent("tiny_mce_marker");n.setContent(n.getContent().replace(/tiny_mce_marker/g,function(){return v}))},mceSetContent:function(x,w,v){n.setContent(v)},"Indent,Outdent":function(y){var w,v,x;w=k.indentation;v=/[a-z%]+$/i.exec(w);w=parseInt(w);if(!l("InsertUnorderedList")&&!l("InsertOrderedList")&&!l("InsertInlineTaskList")){d(p.getSelectedBlocks(),function(z){if(y=="outdent"){x=Math.max(0,parseInt(z.style.paddingLeft||0)-w);m.setStyle(z,"paddingLeft",x?x+v:"")}else{m.setStyle(z,"paddingLeft",(parseInt(z.style.paddingLeft||0)+w)+v)}})}else{f(y)}},mceRepaint:function(){var w;if(c.isGecko){try{i(a);if(p.getSel()){p.getSel().selectAllChildren(n.getBody())}p.collapse(a);g()}catch(v){}}},mceToggleFormat:function(x,w,v){q.toggle(v)},InsertHorizontalRule:function(){n.execCommand("mceInsertContent",false,"<hr />")},mceToggleVisualAid:function(){n.hasVisual=!n.hasVisual;n.addVisual()},mceReplaceContent:function(x,w,v){n.execCommand("mceInsertContent",false,v.replace(/\{\$selection\}/g,p.getContent({format:"text"})))},mceInsertLink:function(y,x,w){var v;if(typeof(w)=="string"){w={href:w}}v=m.getParent(p.getNode(),"a");w.href=w.href.replace(" ","%20");if(!v||!w.href){q.remove("link")}if(w.href){q.apply("link",w,v)}},selectAll:function(){var w=m.getRoot(),v=m.createRng();v.setStart(w,0);v.setEnd(w,w.childNodes.length);n.selection.setRng(v)}});u({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(y){var w="align"+y.substring(7);var v=p.isCollapsed()?[p.getNode()]:p.getSelectedBlocks();var x=c.map(v,function(z){return !!q.matchNode(z,w)});return c.inArray(x,a)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(v){return t(v)},mceBlockQuote:function(){return t("blockquote")},Outdent:function(){var v;if(k.inline_styles){if((v=m.getParent(p.getStart(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}if((v=m.getParent(p.getEnd(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}}return l("InsertUnorderedList")||l("InsertOrderedList")||l("InsertInlineTaskList")||(!k.inline_styles&&!!m.getParent(p.getNode(),"BLOCKQUOTE"))},"InsertUnorderedList,InsertOrderedList,InsertInlineTaskList":function(x){var w=m.getParent(p.getNode(),"ul,ol");var v;if(!w){return false}v=w.tagName;return(v==="OL")&&(x==="insertorderedlist")||(v==="UL")&&!m.hasClass(w,"inline-task-list")&&(x==="insertunorderedlist")||(v==="UL")&&m.hasClass(w,"inline-task-list")&&(x==="insertinlinetasklist")}},"state");u({"FontSize,FontName":function(x){var w=0,v;if(v=m.getParent(p.getNode(),"span")){if(x=="fontsize"){w=v.style.fontSize}else{w=v.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return w}},"value");if(k.custom_undo_redo){u({Undo:function(){n.undoManager.undo()},Redo:function(){n.undoManager.redo()}})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/UndoManager.js' */
(function(b){var a=b.util.Dispatcher;b.UndoManager=function(f){var d,e=0,h=[],c;function g(){return b.trim(f.getContent({format:"raw",no_events:1}))}return d={typing:false,onAdd:new a(d),onUndo:new a(d),onRedo:new a(d),beforeChange:function(){c=f.selection.getBookmark(2,true)},add:function(m){var j,k=f.settings,l;m=m||{};m.content=g();l=h[e];if(l&&l.content==m.content){return null}if(h[e]){h[e].beforeBookmark=c}if(k.custom_undo_redo_levels){if(h.length>k.custom_undo_redo_levels){for(j=0;j<h.length-1;j++){h[j]=h[j+1]}h.length--;e=h.length}}m.bookmark=f.selection.getBookmark(2,true);if(e<h.length-1){h.length=e+1}h.push(m);e=h.length-1;d.onAdd.dispatch(d,m);f.isNotDirty=0;return m},undo:function(){var k,j;if(d.typing){d.add();d.typing=false}if(e>0){k=h[--e];f.setContent(k.content,{format:"raw"});f.selection.moveToBookmark(k.beforeBookmark);d.onUndo.dispatch(d,k)}return k},redo:function(){var i;if(e<h.length-1){i=h[++e];f.setContent(i.content,{format:"raw"});f.selection.moveToBookmark(i.bookmark);d.onRedo.dispatch(d,i)}return i},clear:function(){h=[];e=0;d.typing=false},hasUndo:function(){return e>0||this.typing},hasRedo:function(){return e<h.length-1&&!this.typing},ignore:function(i,k){var j=h.slice();i.call(k||f);h=j}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ForceBlocks.js' */
(function(l){var j=l.dom.Event,c=l.isIE,a=l.isGecko,b=l.isOpera,i=l.each,h=l.extend,d=true,g=false;function k(o){var p,n,m;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(o.nodeName)){if(p){n=o.cloneNode(false);n.appendChild(p);p=n}else{p=m=o.cloneNode(false)}p.removeAttribute("id")}}while(o=o.parentNode);if(p){return{wrapper:p,inner:m}}}function f(n,o){var m=o.ownerDocument.createRange();m.setStart(n.endContainer,n.endOffset);m.setEndAfter(o);return m.cloneContents().textContent.length==0}function e(o,q,m){var n,p;if(q.isEmpty(m)){n=q.getParent(m,"ul,ol");if(!q.getParent(n.parentNode,"ul,ol")){q.split(n,m);p=q.create("p",0,'<br data-mce-bogus="1" />');q.replace(p,m);o.select(p,1)}AJS.Rte.showSelection();return g}return d}l.create("tinymce.ForceBlocks",{ForceBlocks:function(m){var n=this,o=m.settings,p;n.editor=m;n.dom=m.dom;p=(o.forced_root_block||"p").toLowerCase();o.element=p.toUpperCase();m.onPreInit.add(n.setup,n)},setup:function(){var n=this,m=n.editor,p=m.settings,u=m.dom,o=m.selection,q=m.schema.getBlockElements();if(p.forced_root_block){function v(){var x=o.getStart(),t=u.getRoot(),C=m.getDoc().body,s,y,E,G,F,w,z,B=-16777215;function A(H){return(H&&H.nodeType===1)}if(!A(x)){return}while(x!=t){if(A(x)){if(q[x.nodeName]){return}x=x.parentNode}else{return}}s=o.getRng();if(s.setStart){y=s.startContainer;E=s.startOffset;G=s.endContainer;F=s.endOffset}else{if(s.item){s=m.getDoc().body.createTextRange();s.moveToElementText(s.item(0))}tmpRng=s.duplicate();tmpRng.collapse(true);E=tmpRng.move("character",B)*-1;if(!tmpRng.collapsed){tmpRng=s.duplicate();tmpRng.collapse(false);F=(tmpRng.move("character",B)*-1)-E}}for(x=t.firstChild;x;x){if(x.nodeType===3||(x.nodeType==1&&!q[x.nodeName])){if(!w){w=u.create(p.forced_root_block);x.parentNode.insertBefore(w,x)}z=x;x=x.nextSibling;w.appendChild(z)}else{w=null;x=x.nextSibling}}if(s.setStart){s.setStart(y,E);s.setEnd(G,F);o.setRng(s)}else{try{s=C.createTextRange();s.moveToElementText(C);s.move("character",B);s.collapse(true);s.moveStart("character",E);if(F>0){s.moveEnd("character",F)}s.select()}catch(D){}}m.nodeChanged()}m.onKeyUp.add(v);m.onKeyDown.add(v);m.onClick.add(v)}if(p.force_br_newlines){if(c){m.onKeyPress.add(function(s,t){var w;if(t.keyCode==13&&o.getNode().nodeName!="LI"){o.setContent('<br id="__" /> ',{format:"raw"});w=u.get("__");w.removeAttribute("id");o.select(w);o.collapse();return j.cancel(t)}})}}if(p.force_p_newlines){if(!c){m.onKeyPress.add(function(s,t){if(t.keyCode==13&&!t.shiftKey&&!n.insertPara(t)){j.cancel(t)}})}if(a){m.onKeyDown.add(function(s,t){if((t.keyCode==8||t.keyCode==46)&&!t.shiftKey){n.backspaceDelete(t,t.keyCode==8)}})}}if(l.isWebKit){function r(z){var s=o.getRng(),C,t=u.create("div",null," "),B,x,w=u.getViewPort(z.getWin());s.insertNode(C=u.create("br"));s.setStartAfter(C);s.setEndAfter(C);o.setRng(s);if(o.getSel().focusNode==C.previousSibling){o.select(u.insertAfter(u.doc.createTextNode("\u00a0"),C));o.collapse(d)}u.insertAfter(t,C);B=u.getPos(t).y;x=u.getSize(t).h;u.remove(t);var y=B+x;var A=w.y+w.h;if(y>A){z.getWin().scrollTo(0,y-w.h)}}m.onKeyPress.add(function(s,t){if(t.keyCode==13&&(t.shiftKey||(p.force_br_newlines&&!u.getParent(o.getNode(),"h1,h2,h3,h4,h5,h6,ol,ul")))){r(s);j.cancel(t)}})}if(c){if(p.element!="P"){m.onKeyPress.add(function(s,t){n.lastElm=o.getNode().nodeName});m.onKeyUp.add(function(t,w){var y,x=o.getNode(),s=t.getBody();if(s.childNodes.length===1&&x.nodeName=="P"){x=u.rename(x,p.element);o.select(x);o.collapse();t.nodeChanged()}else{if(w.keyCode==13&&!w.shiftKey&&n.lastElm!="P"){y=u.getParent(x,"p");if(y){u.rename(y,p.element);t.nodeChanged()}}}})}}},getParentBlock:function(o){var m=this.dom;return m.getParent(o,m.isBlock)},insertPara:function(S){var D=this,v=D.editor,N=v.dom,T=v.getDoc(),Y=v.settings,E=v.selection.getSel(),F=E.getRangeAt(0),W=T.body;var K,L,H,P,O,q,o,u,x,m,B,V,p,w,I,M=N.getViewPort(v.getWin()),A,C,z;v.undoManager.beforeChange();K=T.createRange();K.setStart(E.anchorNode,E.anchorOffset);K.collapse(d);L=T.createRange();L.setStart(E.focusNode,E.focusOffset);L.collapse(d);H=K.compareBoundaryPoints(K.START_TO_END,L)<0;P=H?E.anchorNode:E.focusNode;O=H?E.anchorOffset:E.focusOffset;q=H?E.focusNode:E.anchorNode;o=H?E.focusOffset:E.anchorOffset;var R;if(l.isWebKit&&P===q&&P.nodeType===1&&P.childNodes.length>0&&v.dom.is(R=P.childNodes[O>0?O-1:0],"table")){var X=N.create("p",0,'<br data-mce-bogus="1" />');N.insertAfter(X,R);F.setStart(X,0);v.selection.setRng(F);var G=v.dom.getPos(X).y;if(G>M.y){v.getWin().scrollTo(0,G)}v.undoManager.add();return g}if(P===q&&/^(TD|TH)$/.test(P.nodeName)){if(P.firstChild.nodeName=="BR"){N.remove(P.firstChild)}if(P.childNodes.length==0){v.dom.add(P,Y.element,null,"<br />");V=v.dom.add(P,Y.element,null,"<br />")}else{I=P.innerHTML;P.innerHTML="";v.dom.add(P,Y.element,null,I);V=v.dom.add(P,Y.element,null,"<br />")}F=T.createRange();F.selectNodeContents(V);F.collapse(1);v.selection.setRng(F);return g}if(P==W&&q==W&&W.firstChild&&v.dom.isBlock(W.firstChild)){P=q=P.firstChild;O=o=0;K=T.createRange();K.setStart(P,0);L=T.createRange();L.setStart(q,0)}if(!T.body.hasChildNodes()){T.body.appendChild(N.create("br"))}P=P.nodeName=="HTML"?T.body:P;P=P.nodeName=="BODY"?P.firstChild:P;q=q.nodeName=="HTML"?T.body:q;q=q.nodeName=="BODY"?q.firstChild:q;var J=v.dom.getRoot();if(P.nodeName==J.nodeName){P=P.firstChild;O=0}if(q.nodeName==J.nodeName){q=q.firstChild;o=0}u=D.getParentBlock(P);x=D.getParentBlock(q);m=u?u.nodeName:Y.element;if(I=D.dom.getParent(u,"li,pre")){if(I.nodeName=="LI"){return e(v.selection,D.dom,I)}return d}if(u&&(u.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(N.getStyle(u,"position",1)))){m=Y.element;u=null}if(x&&(x.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(N.getStyle(u,"position",1)))){m=Y.element;x=null}if(/(TD|TABLE|TH|CAPTION)/.test(m)||(u&&m=="DIV"&&/left|right/gi.test(N.getStyle(u,"float",1)))){m=Y.element;u=x=null}B=(u&&u.nodeName==m)?u.cloneNode(0):v.dom.create(m);V=(x&&x.nodeName==m)?x.cloneNode(0):v.dom.create(m);V.removeAttribute("id");if(/^(H[1-6])$/.test(m)&&f(F,u)){V=v.dom.create(Y.element)}I=p=P;do{if(I==W||I.nodeType==9||D.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}p=I}while((I=I.previousSibling?I.previousSibling:I.parentNode));I=w=q;do{if(I==W||I.nodeType==9||D.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}w=I}while((I=I.nextSibling?I.nextSibling:I.parentNode));if(p.nodeName==m){K.setStart(p,0)}else{K.setStartBefore(p)}K.setEnd(P,O);B.appendChild(K.cloneContents()||T.createTextNode(""));try{L.setEndAfter(w)}catch(Q){}L.setStart(q,o);V.appendChild(L.cloneContents()||T.createTextNode(""));F=T.createRange();if(!p.previousSibling&&p.parentNode.nodeName==m){F.setStartBefore(p.parentNode)}else{if(K.startContainer.nodeName==m&&K.startOffset==0){F.setStartBefore(K.startContainer)}else{F.setStart(K.startContainer,K.startOffset)}}if(!w.nextSibling&&w.parentNode.nodeName==m){F.setEndAfter(w.parentNode)}else{F.setEnd(L.endContainer,L.endOffset)}F.deleteContents();if(b){v.getWin().scrollTo(0,M.y)}if(B.firstChild&&B.firstChild.nodeName==m){B.innerHTML=B.firstChild.innerHTML}if(V.firstChild&&V.firstChild.nodeName==m){V.innerHTML=V.firstChild.innerHTML}function U(y,s){var r=[],aa,Z,t;y.innerHTML="";if(Y.keep_styles){Z=s;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(Z.nodeName)){aa=Z.cloneNode(g);N.setAttrib(aa,"id","");r.push(aa)}}while(Z=Z.parentNode)}if(r.length>0){for(t=r.length-1,aa=y;t>=0;t--){aa=aa.appendChild(r[t])}r[0].innerHTML=b?"\u00a0":"<br />";return r[0]}else{y.innerHTML=b?"\u00a0":"<br />"}}if(N.isEmpty(B)){U(B,P)}if(N.isEmpty(V)){z=U(V,q)}if(b&&parseFloat(opera.version())<9.5){F.insertNode(B);F.insertNode(V)}else{F.insertNode(V);F.insertNode(B)}V.normalize();B.normalize();v.selection.select(V,true);v.selection.collapse(true);A=v.dom.getPos(V).y;if(A<M.y||A+25>M.y+M.h){v.getWin().scrollTo(0,A<M.y?A:A-M.h+25)}v.undoManager.add();return g},backspaceDelete:function(x,E){var F=this,v=F.editor,A=v.getBody(),s=v.dom,p,y=v.selection,o=y.getRng(),z=o.startContainer,p,C,D,m;var B=x.getPreventDefault?x.getPreventDefault():x.defaultPrevented;if(B){return}if(!E&&o.collapsed&&z.nodeType==1&&o.startOffset==z.childNodes.length){m=new l.dom.TreeWalker(z.lastChild,z);for(p=z.lastChild;p;p=m.prev()){if(p.nodeType==3){o.setStart(p,p.nodeValue.length);o.collapse(true);y.setRng(o);return}}}if(z&&v.dom.isBlock(z)&&!/^(TD|TH)$/.test(z.nodeName)&&E){if(z.childNodes.length==0||(z.childNodes.length==1&&z.firstChild.nodeName=="BR")){p=z;while((p=p.previousSibling)&&!v.dom.isBlock(p)){}if(p){if(z!=A.firstChild){C=v.dom.doc.createTreeWalker(p,NodeFilter.SHOW_TEXT,null,g);while(D=C.nextNode()){p=D}o=v.getDoc().createRange();o.setStart(p,p.nodeValue?p.nodeValue.length:0);o.setEnd(p,p.nodeValue?p.nodeValue.length:0);y.setRng(o);v.dom.remove(z)}return j.cancel(x)}}}if(!E&&o.collapsed&&/^(BODY)$/.test(z.nodeName)){var q=z.childNodes[o.startOffset];if(q&&v.dom.isBlock(q)&&!/^(TD|TH)$/.test(q.nodeName)){if(q.childNodes.length==0||(q.childNodes.length==1&&q.firstChild.nodeName=="BR")){p=q;var u;while((p=p.nextSibling)){if(v.dom.isBlock(p)){u=p;break}}if(u){if(q!=A.lastChild){C=v.dom.doc.createTreeWalker(u,NodeFilter.SHOW_TEXT,null,g);u=C.nextNode();o=v.getDoc().createRange();o.setStart(u,0);o.setEnd(u,0);y.setRng(o);v.dom.remove(q);return j.cancel(x)}}}}}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ControlManager.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each,e=c.extend;c.create("tinymce.ControlManager",{ControlManager:function(f,j){var h=this,g;j=j||{};h.editor=f;h.controls={};h.onAdd=new c.util.Dispatcher(h);h.onPostRender=new c.util.Dispatcher(h);h.prefix=j.prefix||f.id+"_";h._cls={};h.onPostRender.add(function(){d(h.controls,function(i){i.postRender()})})},get:function(f){return this.controls[this.prefix+f]||this.controls[f]},setActive:function(h,f){var g=null;if(g=this.get(h)){g.setActive(f)}return g},setDisabled:function(h,f){var g=null;if(g=this.get(h)){g.setDisabled(f)}return g},add:function(g){var f=this;if(g){f.controls[g.id]=g;f.onAdd.dispatch(g,f)}return g},createControl:function(i){var h,g=this,f=g.editor;d(f.plugins,function(j){if(j.createControl){h=j.createControl(i,g);if(h){return false}}});switch(i){case"|":case"separator":return g.createSeparator()}if(!h&&f.buttons&&(h=f.buttons[i])){return g.createButton(i,h)}return g.add(h)},createDropMenu:function(f,n,h){var m=this,i=m.editor,j,g,k,l;n=e({"class":"mceDropDown",constrain:i.settings.constrain_menus},n);n["class"]=n["class"]+" "+i.getParam("skin")+"Skin";if(k=i.getParam("skin_variant")){n["class"]+=" "+i.getParam("skin")+"Skin"+k.substring(0,1).toUpperCase()+k.substring(1)}f=m.prefix+f;l=h||m._cls.dropmenu||c.ui.DropMenu;j=m.controls[f]=new l(f,n);j.onAddItem.add(function(r,q){var p=q.settings;p.title=i.getLang(p.title,p.title);if(!p.onclick){p.onclick=function(o){if(p.cmd){i.execCommand(p.cmd,p.ui||false,p.value)}}}});i.onRemove.add(function(){j.destroy()});if(c.isIE){j.onShowMenu.add(function(){i.focus();g=i.selection.getBookmark(1)});j.onHideMenu.add(function(){if(g){i.selection.moveToBookmark(g);g=0}})}return m.add(j)},createListBox:function(f,n,h){var l=this,j=l.editor,i,k,m;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,"class":"mce_"+f,scope:n.scope,control_manager:l},n);f=l.prefix+f;function g(o){return o.settings.use_accessible_selects&&!c.isGecko}if(j.settings.use_native_selects||g(j)){k=new c.ui.NativeListBox(f,n)}else{m=h||l._cls.listbox||c.ui.ListBox;k=new m(f,n,j)}l.controls[f]=k;if(c.isWebKit){k.onPostRender.add(function(p,o){a.add(o,"mousedown",function(){j.bookmark=j.selection.getBookmark(1)});a.add(o,"focus",function(){j.selection.moveToBookmark(j.bookmark);j.bookmark=null})})}if(k.hideMenu){j.onMouseDown.add(k.hideMenu,k)}return l.add(k)},createButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.label=g.translate(i.label);i.scope=i.scope||g;if(!i.onclick&&!i.menu_button){i.onclick=function(){g.execCommand(i.cmd,i.ui||false,i.value)}}i=e({title:i.title,"class":"mce_"+m,unavailable_prefix:g.getLang("unavailable",""),scope:i.scope,control_manager:h},i);m=h.prefix+m;if(i.menu_button){f=l||h._cls.menubutton||c.ui.MenuButton;k=new f(m,i,g);g.onMouseDown.add(k.hideMenu,k)}else{f=h._cls.button||c.ui.Button;k=new f(m,i,g)}return h.add(k)},createMenuButton:function(h,f,g){f=f||{};f.menu_button=1;return this.createButton(h,f,g)},createSplitButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.scope=i.scope||g;if(!i.onclick){i.onclick=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}if(!i.onselect){i.onselect=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}i=e({title:i.title,"class":"mce_"+m,scope:i.scope,control_manager:h},i);m=h.prefix+m;f=l||h._cls.splitbutton||c.ui.SplitButton;k=h.add(new f(m,i,g));g.onMouseDown.add(k.hideMenu,k);return k},createColorSplitButton:function(f,n,h){var l=this,j=l.editor,i,k,m,g;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onclick){n.onclick=function(o){if(c.isIE){g=j.selection.getBookmark(1)}j.execCommand(n.cmd,n.ui||false,o||n.value)}}if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,"class":"mce_"+f,menu_class:j.getParam("skin")+"Skin",scope:n.scope,more_colors_title:j.getLang("more_colors")},n);f=l.prefix+f;m=h||l._cls.colorsplitbutton||c.ui.ColorSplitButton;k=new m(f,n,j);j.onMouseDown.add(k.hideMenu,k);j.onRemove.add(function(){k.destroy()});if(c.isIE){k.onShowMenu.add(function(){j.focus();g=j.selection.getBookmark(1)});k.onHideMenu.add(function(){if(g){j.selection.moveToBookmark(g);g=0}})}return l.add(k)},createToolbar:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||g._cls.toolbar||c.ui.Toolbar;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createToolbarGroup:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||this._cls.toolbarGroup||c.ui.ToolbarGroup;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createSeparator:function(g){var f=g||this._cls.separator||c.ui.Separator;return new f()},setControlType:function(g,f){return this._cls[g.toLowerCase()]=f},destroy:function(){d(this.controls,function(f){f.destroy()});this.controls=null}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/WindowManager.js' */
(function(d){var a=d.util.Dispatcher,e=d.each,c=d.isIE,b=d.isOpera;d.create("tinymce.WindowManager",{WindowManager:function(f){var g=this;g.editor=f;g.onOpen=new a(g);g.onClose=new a(g);g.params={};g.features={}},open:function(z,h){var v=this,k="",n,m,i=v.editor.settings.dialog_type=="modal",q,o,j,g=d.DOM.getViewPort(),r;z=z||{};h=h||{};o=b?g.w:screen.width;j=b?g.h:screen.height;z.name=z.name||"mc_"+new Date().getTime();z.width=parseInt(z.width||320);z.height=parseInt(z.height||240);z.resizable=true;z.left=z.left||parseInt(o/2)-(z.width/2);z.top=z.top||parseInt(j/2)-(z.height/2);h.inline=false;h.mce_width=z.width;h.mce_height=z.height;h.mce_auto_focus=z.auto_focus;if(i){if(c){z.center=true;z.help=false;z.dialogWidth=z.width+"px";z.dialogHeight=z.height+"px";z.scroll=z.scrollbars||false}}e(z,function(p,f){if(d.is(p,"boolean")){p=p?"yes":"no"}if(!/^(name|url)$/.test(f)){if(c&&i){k+=(k?";":"")+f+":"+p}else{k+=(k?",":"")+f+"="+p}}});v.features=z;v.params=h;v.onOpen.dispatch(v,z,h);r=z.url||z.file;r=d._addVer(r);try{if(c&&i){q=1;window.showModalDialog(r,window,k)}else{q=window.open(r,z.name,k)}}catch(l){}if(!q){alert(v.editor.getLang("popup_blocked"))}},close:function(f){f.close();this.onClose.dispatch(this)},createInstance:function(i,h,g,m,l,k){var j=d.resolve(i);return new j(h,g,m,l,k)},confirm:function(h,f,i,g){g=g||window;f.call(i||this,g.confirm(this._decode(this.editor.getLang(h,h))))},alert:function(h,f,j,g){var i=this;g=g||window;g.alert(i._decode(i.editor.getLang(h,h)));if(f){f.call(j||i)}},resizeBy:function(f,g,h){h.resizeBy(f,g)},_decode:function(f){return d.DOM.decode(f).replace(/\\n/g,"\n")}})}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/Formatter.js' */
(function(a){a.Formatter=function(U){var L={},O=a.each,c=U.dom,q=U.selection,t=a.dom.TreeWalker,J=new a.dom.RangeUtils(c),d=U.schema.isValidChild,E=c.isBlock,l=U.settings.forced_root_block,s=c.nodeIndex,D="\uFEFF",e=/^(src|href|style)$/,R=false,A=true,p;function y(V){return V instanceof Array}function m(W,V){return c.getParents(W,V,c.getRoot())}function b(V){return V.nodeType===1&&V.id==="_mce_caret"}function Q(V){return V?L[V]:L}function k(V,W){if(V){if(typeof(V)!=="string"){O(V,function(Y,X){k(X,Y)})}else{W=W.length?W:[W];O(W,function(X){if(X.deep===p){X.deep=!X.selector}if(X.split===p){X.split=!X.selector||X.inline}if(X.remove===p&&X.selector&&!X.inline){X.remove="none"}if(X.selector&&X.inline){X.mixed=true;X.block_expand=true}if(typeof(X.classes)==="string"){X.classes=X.classes.split(/\s+/)}});L[V]=W}}}var i=function(W){var V;U.dom.getParent(W,function(X){V=U.dom.getStyle(X,"text-decoration");return V&&V!=="none"});return V};var H=function(V){var W;if(V.nodeType===1&&V.parentNode&&V.parentNode.nodeType===1){W=i(V.parentNode);if(U.dom.getStyle(V,"color")&&W){U.dom.setStyle(V,"text-decoration",W)}else{if(U.dom.getStyle(V,"textdecoration")===W){U.dom.setStyle(V,"text-decoration",null)}}}};function S(Y,af,aa){var ab=Q(Y),ag=ab[0],ae,W,ad,ac=q.isCollapsed();function V(ak,aj){aj=aj||ag;if(ak){if(aj.onformat){aj.onformat(ak,aj,af,aa)}O(aj.styles,function(am,al){c.setStyle(ak,al,r(am,af))});O(aj.attributes,function(am,al){c.setAttrib(ak,al,r(am,af))});O(aj.classes,function(al){al=r(al,af);if(!c.hasClass(ak,al)){c.addClass(ak,al)}})}}function Z(){function al(ar,ap){var aq=new t(ap);for(aa=aq.current();aa;aa=aq.prev()){if(aa.childNodes.length>1||aa==ar){return aa}}}var ak=U.selection.getRng();var ao=ak.startContainer;var aj=ak.endContainer;if(ao!=aj&&ak.endOffset==0){var an=al(ao,aj);var am=an.nodeType==3?an.length:an.childNodes.length;ak.setEnd(an,am)}return ak}function X(am,ar,ap,ao,ak){var aj=[],al=-1,aq,au=-1,an=-1,at;O(am.childNodes,function(aw,av){if(aw.nodeName==="UL"||aw.nodeName==="OL"){al=av;aq=aw;return false}});O(am.childNodes,function(aw,av){if(aw.nodeName==="SPAN"&&c.getAttrib(aw,"data-mce-type")=="bookmark"){if(aw.id==ar.id+"_start"){au=av}else{if(aw.id==ar.id+"_end"){an=av}}}});if(al<=0||(au<al&&an>al)){O(a.grep(am.childNodes),ak);return 0}else{at=ap.cloneNode(R);O(a.grep(am.childNodes),function(aw,av){if((au<al&&av<al)||(au>al&&av>al)){aj.push(aw);aw.parentNode.removeChild(aw)}});if(au<al){am.insertBefore(at,aq)}else{if(au>al){am.insertBefore(at,aq.nextSibling)}}ao.push(at);O(aj,function(av){at.appendChild(av)});return at}}function ah(ak,am,ao){var aj=[],an,al;an=ag.inline||ag.block;al=c.create(an);V(al);J.walk(ak,function(ap){var aq;function ar(at){var aw=at.nodeName.toLowerCase(),av=at.parentNode.nodeName.toLowerCase(),au;if(g(aw,"br")){aq=0;if(ag.block){c.remove(at)}return}if(ag.wrapper&&w(at,Y,af)){aq=0;return}if(ag.block&&!ag.wrapper&&F(aw)){at=c.rename(at,an);V(at);aj.push(at);aq=0;return}if(ag.selector){O(ab,function(ax){if("collapsed" in ax&&ax.collapsed!==ac){return}if(c.is(at,ax.selector)&&!b(at)){V(at,ax);au=true}});if(!ag.inline||au){aq=0;return}}if(d(an,aw)&&d(av,an)&&!(!ao&&at.nodeType===3&&at.nodeValue.length===1&&at.nodeValue.charCodeAt(0)===65279)&&!b(at)){if(!aq){aq=al.cloneNode(R);at.parentNode.insertBefore(aq,at);aj.push(aq)}aq.appendChild(at)}else{if(aw=="li"&&am){aq=X(at,am,al,aj,ar)}else{aq=0;O(a.grep(at.childNodes),ar);aq=0}}}O(ap,ar)});if(ag.wrap_links===false){O(aj,function(ap){function aq(av){var au,at,ar;if(av.nodeName==="A"){at=al.cloneNode(R);aj.push(at);ar=a.grep(av.childNodes);for(au=0;au<ar.length;au++){at.appendChild(ar[au])}av.appendChild(at)}O(a.grep(av.childNodes),aq)}aq(ap)})}O(aj,function(ar){var ap;function at(av){var au=0;O(av.childNodes,function(aw){if(!f(aw)&&!G(aw)){au++}});return au}function aq(au){var aw,av;O(au.childNodes,function(ax){if(ax.nodeType==1&&!G(ax)&&!b(ax)){aw=ax;return R}});if(aw&&h(aw,ag)){av=aw.cloneNode(R);V(av);c.replace(av,au,A);c.remove(aw,1)}return av||au}ap=at(ar);if((aj.length>1||!E(ar))&&ap===0){c.remove(ar,1);return}if(ag.inline||ag.wrapper){if(!ag.exact&&ap===1){ar=aq(ar)}O(ab,function(au){O(c.select(au.inline,ar),function(aw){var av;if(au.wrap_links===false){av=aw.parentNode;do{if(av.nodeName==="A"){return}}while(av=av.parentNode)}T(au,af,aw,au.exact?aw:null)})});if(w(ar.parentNode,Y,af)){c.remove(ar,1);ar=0;return A}if(ag.merge_with_parents){c.getParent(ar.parentNode,function(au){if(w(au,Y,af)){c.remove(ar,1);ar=0;return A}})}if(ar&&ag.merge_siblings!==false){ar=u(B(ar),ar);ar=u(ar,B(ar,A))}}})}if(ag){if(aa){if(aa.nodeType){W=c.createRng();W.setStartBefore(aa);W.setEndAfter(aa);ah(o(W,ab),null,true)}else{ah(aa,null,true)}}else{if(!ac||!ag.inline||c.select("td.mceSelected,th.mceSelected").length){var ai=U.selection.getNode();U.selection.setRng(Z());ae=q.getBookmark();ah(o(q.getRng(A),ab),ae);if(ag.styles&&(ag.styles.color||ag.styles.textDecoration)){a.walk(ai,H,"childNodes");H(ai)}q.moveToBookmark(ae);M(q.getRng(A));U.nodeChanged()}else{P("apply",Y,af)}}}}function z(X,af,Z){var aa=Q(X),ah=aa[0],ae,ad,W;function Y(am){var al,ak,aj;al=a.grep(am.childNodes);for(ak=0,aj=aa.length;ak<aj;ak++){if(T(aa[ak],af,am,am)){break}}if(ah.deep){for(ak=0,aj=al.length;ak<aj;ak++){Y(al[ak])}}}function ab(aj){var ak;O(m(aj.parentNode).reverse(),function(al){var am;if(!ak&&al.id!="_start"&&al.id!="_end"){am=w(al,X,af);if(am&&am.split!==false){ak=al}}});return ak}function V(am,aj,ao,ar){var at,aq,ap,al,an,ak;if(am){ak=am.parentNode;for(at=aj.parentNode;at&&at!=ak;at=at.parentNode){aq=at.cloneNode(R);for(an=0;an<aa.length;an++){if(T(aa[an],af,aq,aq)){aq=0;break}}if(aq){if(ap){aq.appendChild(ap)}if(!al){al=aq}ap=aq}}if(ar&&(!ah.mixed||!E(am))){aj=c.split(am,aj)}if(ap){ao.parentNode.insertBefore(ap,ao);al.appendChild(ao)}}return aj}function ag(aj){return V(ab(aj),aj,aj,true)}function ac(al){var ak=c.get(al?"_start":"_end"),aj=ak[al?"firstChild":"lastChild"];if(G(aj)){aj=aj[al?"firstChild":"lastChild"]}c.remove(ak,true);return aj}function ai(aj){var ak,al;aj=o(aj,aa,A);if(ah.split){ak=I(aj,A);al=I(aj);if(ak!=al){ak=N(ak,"span",{id:"_start","data-mce-type":"bookmark"});al=N(al,"span",{id:"_end","data-mce-type":"bookmark"});ag(ak);ag(al);ak=ac(A);al=ac()}else{ak=al=ag(ak)}aj.startContainer=ak.parentNode;aj.startOffset=s(ak);aj.endContainer=al.parentNode;aj.endOffset=s(al)+1}J.walk(aj,function(am){O(am,function(an){Y(an);if(an.nodeType===1&&U.dom.getStyle(an,"text-decoration")==="underline"&&an.parentNode&&i(an.parentNode)==="underline"){T({deep:false,exact:true,inline:"span",styles:{textDecoration:"underline"}},null,an)}})})}if(Z){if(Z.nodeType){W=c.createRng();W.setStartBefore(Z);W.setEndAfter(Z);ai(W)}else{ai(Z)}return}if(!q.isCollapsed()||!ah.inline||c.select("td.mceSelected,th.mceSelected").length){ae=q.getBookmark();ai(q.getRng(A));q.moveToBookmark(ae);if(ah.inline&&j(X,af,q.getStart())){M(q.getRng(true))}U.nodeChanged()}else{P("remove",X,af)}if(a.isWebKit){U.execCommand("mceCleanup",false,p,{skip_undo:true})}}function C(W,Y,X){var V=Q(W);if(j(W,Y,X)&&(!("toggle" in V[0])||V[0]["toggle"])){z(W,Y,X)}else{S(W,Y,X)}}function w(W,V,ab,Z){var X=Q(V),ac,aa,Y;function ad(ah,aj,ak){var ag,ai,ae=aj[ak],af;if(aj.onmatch){return aj.onmatch(ah,aj,ak)}if(ae){if(ae.length===p){for(ag in ae){if(ae.hasOwnProperty(ag)){if(ak==="attributes"){ai=c.getAttrib(ah,ag)}else{ai=K(ah,ag)}if(Z&&!ai&&!aj.exact){return}if((!Z||aj.exact)&&!g(ai,r(ae[ag],ab))){return}}}}else{for(af=0;af<ae.length;af++){if(ak==="attributes"?c.getAttrib(ah,ae[af]):K(ah,ae[af])){return aj}}}}return aj}if(X&&W){for(aa=0;aa<X.length;aa++){ac=X[aa];if(h(W,ac)&&ad(W,ac,"attributes")&&ad(W,ac,"styles")){if(Y=ac.classes){for(aa=0;aa<Y.length;aa++){if(!c.hasClass(W,Y[aa])){return}}}return ac}}}}function j(X,Z,Y){var W;function V(aa){aa=c.getParent(aa,function(ab){return !!w(ab,X,Z,true)});return w(aa,X,Z)}if(Y){return V(Y)}Y=q.getNode();if(V(Y)){return A}W=q.getStart();if(W!=Y){if(V(W)){return A}}return R}function v(ac,ab){var Z,aa=[],Y={},X,W,V;Z=q.getStart();c.getParent(Z,function(af){var ae,ad;for(ae=0;ae<ac.length;ae++){ad=ac[ae];if(!Y[ad]&&w(af,ad,ab)){Y[ad]=true;aa.push(ad)}}});return aa}function x(Z){var ab=Q(Z),Y,X,aa,W,V;if(ab){Y=q.getStart();X=m(Y);for(W=ab.length-1;W>=0;W--){V=ab[W].selector;if(!V){return A}for(aa=X.length-1;aa>=0;aa--){if(c.is(X[aa],V)){return A}}}}return R}a.extend(this,{get:Q,register:k,apply:S,remove:z,toggle:C,match:j,matchAll:v,matchNode:w,canApply:x});function h(V,W){if(g(V,W.inline)){return A}if(g(V,W.block)){return A}if(W.selector){return c.is(V,W.selector)}}function g(W,V){W=W||"";V=V||"";W=""+(W.nodeName||W);V=""+(V.nodeName||V);return W.toLowerCase()==V.toLowerCase()}function K(W,V){var X=c.getStyle(W,V);if(V=="color"||V=="backgroundColor"){X=c.toHex(X)}if(V=="fontWeight"&&X==700){X="bold"}return""+X}function r(V,W){if(typeof(V)!="string"){V=V(W)}else{if(W){V=V.replace(/%(\w+)/g,function(Y,X){return W[X]||Y})}}return V}function f(V){return V&&V.nodeType===3&&/^([\t \r\n]+|)$/.test(V.nodeValue)}function N(X,W,V){var Y=c.create(W,V);X.parentNode.insertBefore(Y,X);Y.appendChild(X);return Y}function o(V,ah,Y){var X=V.startContainer,ac=V.startOffset,ak=V.endContainer,ae=V.endOffset,aj,ag,ab,af;function ai(aq){var al,ao,ap,an,am;al=ao=aq?X:ak;am=aq?"previousSibling":"nextSibling";root=c.getRoot();if(al.nodeType==3&&!f(al)){if(aq?ac>0:ae<al.nodeValue.length){return al}}for(;;){if(!ah[0].block_expand&&E(ao)){return ao}for(an=ao[am];an;an=an[am]){if(!G(an)&&!f(an)){return ao}}if(ao.parentNode==root){al=ao;break}ao=ao.parentNode}return al}function aa(al,am){if(am===p){am=al.nodeType===3?al.length:al.childNodes.length}while(al&&al.hasChildNodes()){al=al.childNodes[am];if(al){am=al.nodeType===3?al.length:al.childNodes.length}}return{node:al,offset:am}}if(X.nodeType==1&&X.hasChildNodes()){ag=X.childNodes.length-1;X=X.childNodes[ac>ag?ag:ac];if(X.nodeType==3){ac=0}}if(ak.nodeType==1&&ak.hasChildNodes()){ag=ak.childNodes.length-1;ak=ak.childNodes[ae>ag?ag:ae-1];if(ak.nodeType==3){ae=ak.nodeValue.length}}if(G(X.parentNode)||G(X)){X=G(X)?X:X.parentNode;X=X.nextSibling||X;if(X.nodeType==3){ac=0}}if(G(ak.parentNode)||G(ak)){ak=G(ak)?ak:ak.parentNode;ak=ak.previousSibling||ak;if(ak.nodeType==3){ae=ak.length}}if(ah[0].inline){if(V.collapsed){function ad(am,aq,at){var ap,an,ar,al;function ao(av,ax){var ay,au,aw=av.nodeValue;if(typeof(ax)=="undefined"){ax=at?aw.length:0}if(at){ay=aw.lastIndexOf(" ",ax);au=aw.lastIndexOf("\u00a0",ax);ay=ay>au?ay:au;if(ay!==-1&&!Y){ay++}}else{ay=aw.indexOf(" ",ax);au=aw.indexOf("\u00a0",ax);ay=ay!==-1&&(au===-1||ay<au)?ay:au}return ay}if(am.nodeType===3){ar=ao(am,aq);if(ar!==-1){return{container:am,offset:ar}}al=am}ap=new t(am,c.getParent(am,E)||U.getBody());while(an=ap[at?"prev":"next"]()){if(an.nodeType===3){al=an;ar=ao(an);if(ar!==-1){return{container:an,offset:ar}}}else{if(E(an)){break}}}if(al){if(at){aq=0}else{aq=al.length}return{container:al,offset:aq}}}af=ad(X,ac,true);if(af){X=af.container;ac=af.offset}af=ad(ak,ae);if(af){ak=af.container;ae=af.offset}}ab=aa(ak,ae);if(ab.node){while(ab.node&&ab.offset===0&&ab.node.previousSibling){ab=aa(ab.node.previousSibling)}if(ab.node&&ab.offset>0&&ab.node.nodeType===3&&ab.node.nodeValue.charAt(ab.offset-1)===" "){if(ab.offset>1){ak=ab.node;ak.splitText(ab.offset-1)}else{if(ab.node.previousSibling){}}}}}if(ah[0].inline||ah[0].block_expand){if(!ah[0].inline||(X.nodeType!=3||ac===0)){X=ai(true)}if(!ah[0].inline||(ak.nodeType!=3||ae===ak.nodeValue.length)){ak=ai()}}if(ah[0].selector&&ah[0].expand!==R&&!ah[0].inline){function Z(am,al){var an,ao,aq,ap;if(am.nodeType==3&&am.nodeValue.length==0&&am[al]){am=am[al]}an=m(am);for(ao=0;ao<an.length;ao++){for(aq=0;aq<ah.length;aq++){ap=ah[aq];if("collapsed" in ap&&ap.collapsed!==V.collapsed){continue}if(c.is(an[ao],ap.selector)){return an[ao]}}}return am}X=Z(X,"previousSibling");ak=Z(ak,"nextSibling")}if(ah[0].block||ah[0].selector){function W(am,al,ao){var an;if(am==c.getRoot()){return am}if(!ah[0].wrapper){an=c.getParent(am,ah[0].block)}if(!an){an=c.getParent(am.nodeType==3?am.parentNode:am,E)}if(an&&ah[0].wrapper){an=m(an,"ul,ol").reverse()[0]||an}if(!an){an=am;while(an[al]&&!E(an[al])){an=an[al];if(g(an,"br")){break}}}return an||am}X=W(X,"previousSibling");ak=W(ak,"nextSibling");if(ah[0].block){if(!E(X)){X=ai(true)}if(!E(ak)){ak=ai()}}}if(X.nodeType==1){ac=s(X);X=X.parentNode}if(ak.nodeType==1){ae=s(ak)+1;ak=ak.parentNode}return{startContainer:X,startOffset:ac,endContainer:ak,endOffset:ae}}function T(ab,aa,Y,V){var X,W,Z;if(!h(Y,ab)){return R}if(ab.remove!="all"){O(ab.styles,function(ad,ac){ad=r(ad,aa);if(typeof(ac)==="number"){ac=ad;V=0}if(!V||g(K(V,ac),ad)){c.setStyle(Y,ac,"")}Z=1});if(Z&&c.getAttrib(Y,"style")==""){Y.removeAttribute("style");Y.removeAttribute("data-mce-style")}O(ab.attributes,function(ae,ac){var ad;ae=r(ae,aa);if(typeof(ac)==="number"){ac=ae;V=0}if(!V||g(c.getAttrib(V,ac),ae)){if(ac=="class"){ae=c.getAttrib(Y,ac);if(ae){ad="";O(ae.split(/\s+/),function(af){if(/mce\w+/.test(af)){ad+=(ad?" ":"")+af}});if(ad){c.setAttrib(Y,ac,ad);return}}}if(ac=="class"){Y.removeAttribute("className")}if(e.test(ac)){Y.removeAttribute("data-mce-"+ac)}Y.removeAttribute(ac)}});O(ab.classes,function(ac){ac=r(ac,aa);if(!V||c.hasClass(V,ac)){c.removeClass(Y,ac)}});W=c.getAttribs(Y);for(X=0;X<W.length;X++){if(W[X].nodeName.indexOf("_")!==0){return R}}}if(ab.remove!="none"){n(Y,ab);return A}}function n(X,Y){var V=X.parentNode,W;if(Y.block){if(!l){function Z(ab,aa,ac){ab=B(ab,aa,ac);return !ab||(ab.nodeName=="BR"||E(ab))}if(E(X)&&!E(V)){if(!Z(X,R)&&!Z(X.firstChild,A,1)){X.insertBefore(c.create("br"),X.firstChild)}if(!Z(X,A)&&!Z(X.lastChild,R,1)){X.appendChild(c.create("br"))}}}else{if(V==c.getRoot()){if(!Y.list_block||!g(X,Y.list_block)){O(a.grep(X.childNodes),function(aa){if(d(l,aa.nodeName.toLowerCase())){if(!W){W=N(aa,l)}else{W.appendChild(aa)}}else{W=0}})}}}}if(Y.selector&&Y.inline&&!g(Y.inline,X)){return}c.remove(X,1)}function B(W,V,X){if(W){V=V?"nextSibling":"previousSibling";for(W=X?W:W[V];W;W=W[V]){if(W.nodeType==1||!f(W)){return W}}}}function G(V){return V&&V.nodeType==1&&V.getAttribute("data-mce-type")=="bookmark"}function u(Z,Y){var V,X,W;function ab(ae,ad){if(ae.nodeName!=ad.nodeName){return R}function ac(ag){var ah={};O(c.getAttribs(ag),function(ai){var aj=ai.nodeName.toLowerCase();if(aj.indexOf("_")!==0&&aj!=="style"){ah[aj]=c.getAttrib(ag,aj)}});return ah}function af(aj,ai){var ah,ag;for(ag in aj){if(aj.hasOwnProperty(ag)){ah=ai[ag];if(ah===p){return R}if(aj[ag]!=ah){return R}delete ai[ag]}}for(ag in ai){if(ai.hasOwnProperty(ag)){return R}}return A}if(!af(ac(ae),ac(ad))){return R}if(!af(c.parseStyle(c.getAttrib(ae,"style")),c.parseStyle(c.getAttrib(ad,"style")))){return R}return A}if(Z&&Y){function aa(ad,ac){for(X=ad;X;X=X[ac]){if(X.nodeType==3&&X.nodeValue.length!==0){return ad}if(X.nodeType==1&&!G(X)){return X}}return ad}Z=aa(Z,"previousSibling");Y=aa(Y,"nextSibling");if(ab(Z,Y)){for(X=Z.nextSibling;X&&X!=Y;){W=X;X=X.nextSibling;Z.appendChild(W)}c.remove(Y);O(a.grep(Y.childNodes),function(ac){Z.appendChild(ac)});return Z}}return Y}function F(V){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(V)}function I(W,aa){var V,Z,X,Y;V=W[aa?"startContainer":"endContainer"];Z=W[aa?"startOffset":"endOffset"];if(V.nodeType==1){X=V.childNodes.length-1;if(!aa&&Z){Z--}V=V.childNodes[Z>X?X:Z]}if(V.nodeType===3&&aa&&Z>=V.nodeValue.length){V=new t(V,U.getBody()).next()||V}if(V.nodeType===3&&!aa&&Z==0){V=new t(V,U.getBody()).prev()||V}return V}function P(ae,V,ac){var ah,af="_mce_caret",W=U.settings.caret_debug;ah=a.isGecko?"\u200B":D;function X(aj){var ai=c.create("span",{id:af,"data-mce-bogus":true,style:W?"color:red":""});if(aj){ai.appendChild(U.getDoc().createTextNode(ah))}return ai}function ad(aj,ai){while(aj){if((aj.nodeType===3&&aj.nodeValue!==ah)||aj.childNodes.length>1){return false}if(ai&&aj.nodeType===1){ai.push(aj)}aj=aj.firstChild}return true}function aa(ai){while(ai){if(ai.id===af){return ai}ai=ai.parentNode}}function Z(ai){var aj;if(ai){aj=new t(ai,ai);for(ai=aj.current();ai;ai=aj.next()){if(ai.nodeType===3){return ai}}}}function Y(ak,aj){var al,ai;if(!ak){ak=aa(q.getStart());if(!ak){while(ak=c.get(af)){Y(ak,false)}}}else{ai=q.getRng(true);if(ad(ak)){if(aj!==false){ai.setStartBefore(ak);ai.setEndBefore(ak)}c.remove(ak)}else{al=Z(ak);if(al.nodeValue.charAt(0)===D){al=al.deleteData(0,1)}c.remove(ak,1)}q.setRng(ai)}}function ab(){var ak,ai,ao,an,al,aj,am;ak=q.getRng(true);an=ak.startOffset;aj=ak.startContainer;am=aj.nodeValue;ai=aa(q.getStart());if(ai){ao=Z(ai)}if(am&&an>0&&an<am.length&&/\w/.test(am.charAt(an))&&/\w/.test(am.charAt(an-1))){al=q.getBookmark();ak.collapse(true);ak=o(ak,Q(V));ak=J.split(ak);S(V,ac,ak);q.moveToBookmark(al)}else{if(!ai||ao.nodeValue!==ah){ai=X(true);ao=ai.firstChild;ak.insertNode(ai);an=1;S(V,ac,ai)}else{S(V,ac,ai)}q.setCursorLocation(ao,an)}}function ag(){var ai=q.getRng(true),aj,al,ao,an,ak,ar,aq=[],am,ap;aj=ai.startContainer;al=ai.startOffset;ak=aj;if(aj.nodeType==3){if(al!=aj.nodeValue.length||aj.nodeValue===ah){an=true}ak=ak.parentNode}while(ak){if(w(ak,V,ac)){ar=ak;break}if(ak.nextSibling){an=true}aq.push(ak);ak=ak.parentNode}if(!ar){return}if(an){ao=q.getBookmark();ai.collapse(true);ai=o(ai,Q(V),true);ai=J.split(ai);z(V,ac,ai);q.moveToBookmark(ao)}else{ap=X();ak=ap;for(am=aq.length-1;am>=0;am--){ak.appendChild(aq[am].cloneNode(false));ak=ak.firstChild}ak.appendChild(c.doc.createTextNode(ah));ak=ak.firstChild;c.insertAfter(ap,ar);q.setCursorLocation(ak,1)}}if(!self._hasCaretEvents){U.onBeforeGetContent.addToTop(function(){var ai=[],aj;if(ad(aa(q.getStart()),ai)){aj=ai.length;while(aj--){c.setAttrib(ai[aj],"data-mce-bogus","1")}}});a.each("onMouseUp onKeyUp".split(" "),function(ai){U[ai].addToTop(function(){Y()})});U.onKeyDown.addToTop(function(ai,ak){var aj=ak.keyCode;if(aj==8||aj==37||aj==39){Y(aa(q.getStart()))}});self._hasCaretEvents=true}if(ae=="apply"){ab()}else{ag()}}function M(W){var V=W.startContainer,ab=W.startOffset,aa,Z,X,Y;if(V.nodeType==3&&ab>=V.nodeValue.length){V=V.parentNode;ab=s(V)+1}if(V.nodeType==1){X=V.childNodes;V=X[Math.min(ab,X.length-1)];aa=new t(V,c.getParent(V,c.isBlock));if(ab>X.length-1){aa.next()}for(Z=aa.current();Z;Z=aa.next()){if(Z.nodeType==3&&!f(Z)){Y=c.create("a",null,D);Z.parentNode.insertBefore(Y,Z);W.setStart(Z,0);q.setRng(W);c.remove(Y);return}}}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/LegacyInput.js' */
tinymce.onAddEditor.add(function(e,a){var d,h,g,c=a.settings;if(c.inline_styles){h=e.explode(c.font_size_legacy_values);function b(j,i){e.each(i,function(l,k){if(l){g.setStyle(j,k,l)}});g.rename(j,"span")}d={font:function(j,i){b(i,{backgroundColor:i.style.backgroundColor,color:i.color,fontFamily:i.face,fontSize:h[parseInt(i.size)-1]})},strike:function(j,i){b(i,{textDecoration:"line-through"})}};function f(i,j){g=i.dom;if(c.convert_fonts_to_spans){e.each(g.select("font,strike",j.node),function(k){d[k.nodeName.toLowerCase()](a.dom,k)})}}a.onPreProcess.add(f);a.onSetContent.add(f);a.onInit.add(function(){a.selection.onSetContent.add(f)})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/themes/atlassian/editor_template.js' */
(function(e){var d=e.DOM,b=e.dom.Event,h=e.extend,f=e.each,a=e.util.Cookie,g,c=e.explode;e.ThemeManager.requireLangPack("advanced");e.create("tinymce.themes.AtlassianTheme",{controlHandlers:{},controls:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",justifyleft:"JustifyLeft",justifycenter:"JustifyCenter",justifyright:"JustifyRight",bullist:"InsertUnorderedList",numlist:"InsertOrderedList",tasklist:"InsertInlineTaskList",outdent:"Outdent",indent:"Indent",cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",removeformat:"RemoveFormat",sub:"subscript",sup:"superscript",forecolor:"ForeColor",forecolorpicker:"mceForeColor",backcolor:"HiliteColor",backcolorpicker:"mceBackColor",charmap:"mceCharMap",visualaid:"mceToggleVisualAid",anchor:"mceInsertAnchor",newdocument:"mceNewDocument",blockquote:"mceBlockQuote"},stateControls:["bold","italic","underline","bullist","numlist","tasklist","justifyleft","justifycenter","justifyright","strikethrough","sub","sup","monospace"],init:function(j,k){var l=this,m,i,n;l.editor=j;l.url=k;l.settings=m=h({theme_advanced_toolbar_location:"bottom",theme_advanced_buttons1:"formatselect,bold,italic,underline,strikethrough,forecolor,separator,table,row_before,row_after,delete_row,col_before,col_after,delete_col,delete_table,separator,bullist,numlist,tasklist,outdent,indent,blockquote,justifyleft,justifycenter,justifyright,justifyfull,separator,sup,sub,separator,undo,redo,separator,conflink,oldlinkbrowserButton,confimage,conf_macro_browser,separator,search,code,customtoolbar, monospacep,h1,h2,h3,h4,h5,h6,pre,blockquote",theme_advanced_toolbar_align:"center",theme_advanced_fonts:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",theme_advanced_more_colors:1,theme_advanced_row_height:23,theme_advanced_resize_horizontal:1,theme_advanced_resizing_use_cookie:1,theme_advanced_font_sizes:"1,2,3,4,5,6,7",theme_advanced_font_selector:"span",theme_advanced_show_current_color:0,readonly:j.settings.readonly},j.settings);j.onInit.add(function(){if(!j.settings.readonly){j.onNodeChange.add(l.nodeChanged,l);j.onKeyUp.add(l._updateUndoStatus,l);j.onMouseUp.add(l._updateUndoStatus,l);j.dom.bind(j.dom.getRoot(),"dragend",function(){l._updateUndoStatus(j)})}})},execCommand:function(k,j,l){var i=this["_"+k];if(i){i.call(this,j,l);return true}return false},renderUI:function(j){var i;this.bindControls();return{iframeContainer:d.get("rte"),editorContainer:"wysiwyg",sizeContainer:i,deltaHeight:j.deltaHeight}},getInfo:function(){return{longname:"Atlassian theme",author:"Atlassian",authorurl:"http://tinymce.moxiecode.com",version:e.majorVersion+"."+e.minorVersion}},bindControls:function(){var i=this,j=i.settings;f(c(j.theme_advanced_buttons1),function(k){if(i.createEditorButtons(k)){return}switch(k){case"styleselect":return i._createStyleSelect();case"formatselect":return i.createBlockFormats();case"fontselect":return i._createFontSelect();case"fontsizeselect":return i._createFontSizeSelect();case"forecolor":return i.createForeColorMenu();case"backcolor":return i._createBackColorMenu()}});i.bindControlHandlers()},createEditorButtons:function(i){var j=this.editor.buttons[i];if(j){if(j.cmd){this.controls[i]=j.cmd}else{this.controls[i]=j.onclick}}else{return false}},bindControlHandlers:function(){var i=this;i.controlHandlers.buttons={};i.controlHandlers.buttons["state"]=new e.util.Dispatcher();i.controlHandlers.buttons["click"]=new e.util.Dispatcher();i.controlHandlers.buttons["click"].add(function(l){var j=i.controls[l];var k=(typeof j);if(k=="string"){i.editor.execCommand(i.controls[l])}else{if(k=="function"){j()}else{}}})},createBlockFormats:function(){var i=this;i.controlHandlers.formatselect={};i.controlHandlers.formatselect["state"]=new e.util.Dispatcher();i.controlHandlers.formatselect["click"]=new e.util.Dispatcher();i.controlHandlers.formatselect["click"].add(function(j){i.editor.execCommand("FormatBlock",false,j)})},createForeColorMenu:function(){return true},_updateUndoStatus:function(i){var j=i.undoManager;this.controlHandlers.buttons["state"].dispatch("undo","disabled",!j.hasUndo()&&!j.typing);this.controlHandlers.buttons["state"].dispatch("redo","disabled",!j.hasRedo())},nodeChanged:function(m,q,k,o,j){var r=this,i,u=r.settings;f(r.stateControls,function(n){r.controlHandlers.buttons["state"].dispatch(n,"active",!!m.queryCommandState(r.controls[n]))});function l(s){var p,n=j.parents;for(p=0;p<n.length;p++){if(s(n[p])){return n[p]}}}r._updateUndoStatus(m);r.controlHandlers.buttons["state"].dispatch("outdent","disabled",!m.queryCommandState("Outdent"));i=l(d.isBlock);if(i){r.controlHandlers.formatselect["state"].dispatch(i.nodeName.toLowerCase())}}});e.ThemeManager.add("atlassian",e.themes.AtlassianTheme)}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/atlassianemotions/editor_plugin_src.js' */
(function(a,b){a.create("tinymce.plugins.EmotionsPlugin",{init:function(c,d){c.addCommand("mceEmotion",function(){c.windowManager.open({file:tinyMCE.settings.editor_plugin_action_base_path+"/emotions.action",width:190+parseInt(c.getLang("emotions.delta_width",0)),height:125+parseInt(c.getLang("emotions.delta_height",0)),inline:1,id:"insert-emoticon-dialog",name:"emotions_dlg.title"},{plugin_url:d})});c.addButton("emotions",{title:"emotions.emotions_desc",cmd:"mceEmotion"});c.onClick.add(function(g,k){var l=k.target,j,f;if(l.nodeName==="IMG"){j=b(l);if(j.hasClass("emoticon")){f=g.selection.getRng(true);var i=k.offsetX||(k.layerX-l.x);var h=l.width;if(i<h/2){f.setStartBefore(l);f.setEndBefore(l)}else{f.setStartAfter(l);f.setEndAfter(l)}g.selection.setRng(f);g.selection.collapse();return a.dom.Event.prevent(k)}}})},getInfo:function(){return{longname:"Emotions",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/emotions",version:a.majorVersion+"."+a.minorVersion}}});a.PluginManager.add("emotions",a.plugins.EmotionsPlugin)})(tinymce,AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/lists/editor_plugin_src.js' */
(function(f){var o="list-style-type: none; background-image: none;";var k="a,b,i,em,strong,u,span,s,sub,sup,code,br";var d=tinymce.each,u=tinymce.dom.Event,h;function t(w,v){while(w&&(w.nodeType===8||(w.nodeType===3&&/^[ \t\n\r]*$/.test(w.nodeValue)))){w=v(w)}return w}function b(v){return t(v,function(w){return w.previousSibling})}function j(v){return t(v,function(w){return w.nextSibling})}function e(v,x,w){return v.dom.getParent(x,function(y){return tinymce.inArray(w,y)!==-1})}function q(v){return v&&(v.tagName==="OL"||v.tagName==="UL")}function c(x,y){var w,z,v;w=b(x.lastChild);while(q(w)){z=w;w=b(z.previousSibling)}if(z){v=y.create("li",{style:o});y.split(x,z);y.insertAfter(v,z);v.appendChild(z);v.appendChild(z);x=v.previousSibling}return x}function p(w,v,x){w=a(w,v,x);return r(w,v,x)}function a(x,v,y){var w=b(x.previousSibling);if(w){return i(w,x,v?w:false,y)}else{return x}}function r(x,w,y){var v=j(x.nextSibling);if(v){return i(x,v,w?v:false,y)}else{return x}}function i(x,v,w,y){if(n(x,v,!!w,y)){return g(x,v,w)}else{if(x&&x.tagName==="LI"&&q(v)){x.appendChild(v)}}return v}function n(x,w,v,y){if(!x||!w){return false}else{if(x.tagName==="LI"&&w.tagName==="LI"){return w.style.listStyleType==="none"||l(w)}else{if(q(x)){return(x.tagName===w.tagName&&x.className===w.className&&(v||x.style.listStyleType===w.style.listStyleType))||s(w)}else{return y&&x.tagName==="P"&&w.tagName==="P"}}}}function s(w){var v=j(w.firstChild),x=b(w.lastChild);return v&&x&&q(w)&&v===x&&(q(v)||v.style.listStyleType==="none"||l(v))}function l(x){var w=j(x.firstChild),v=b(x.lastChild);return w&&v&&w===v&&q(w)}function g(z,y,v){var x=b(z.lastChild),w=j(y.firstChild);if(z.tagName==="P"){z.appendChild(z.ownerDocument.createElement("br"))}while(y.firstChild){z.appendChild(y.firstChild)}if(v){z.style.listStyleType=v.style.listStyleType}y.parentNode.removeChild(y);i(x,w,false);return z}function m(w,x){var v;if(!x.is(w,"li,ol,ul")){v=x.getParent(w,"li");if(v){w=v}}return w}tinymce.create("tinymce.plugins.Lists",{init:function(D){var z="TABBING";var w="EMPTY";var N="ESCAPE";var Q="UNKNOWN";var B=Q;function H(Y){return Y.keyCode===tinymce.VK.TAB&&!(Y.altKey||Y.ctrlKey)&&(D.queryCommandState("InsertUnorderedList")||D.queryCommandState("InsertOrderedList")||D.queryCommandState("InsertInlineTaskList")||D.queryCommandState("InsertInlineTaskListNoToggle"))}function R(){var Z=D.selection.getNode();var Y=Z.tagName==="P"&&Z.parentNode.tagName==="LI"&&Z.parentNode.lastChild===Z;return D.selection.isCollapsed()&&Y&&AJS.EditorUtils.isCursorAtEndOf(Z,D.selection.getRng(true))}function A(){var Y=F();if(Y){var aa=Y.parentNode.parentNode;var Z=Y.parentNode.lastChild===Y;return Z&&!x(aa)&&T(Y)}return false}function x(Y){if(q(Y)){return Y.parentNode&&Y.parentNode.tagName==="LI"}else{return Y.tagName==="LI"}}function I(){return D.selection.isCollapsed()&&T(F())}function F(){var Y=D.selection.getStart();return(Y.tagName=="LI")?Y:D.dom.getParent(Y,"li")}function T(Y){if(Y){var ac=f(Y);var aa=ac.find("*");var Z=aa.filter(k);if(aa.length!=Z.length){return false}var ab=AJS.trim(ac.text());return ab.length===0&&Z.filter("br").length<=1}return false}function K(Y){if(Y&&(tinymce.isGecko||tinymce.isWebKit)){var aa=Y.childNodes,ab=aa.length,ac;for(var Z=(ab-1);Z>=0;Z--){ac=aa[Z];if(ac.nodeType==3&&!ac.length){D.dom.remove(ac)}}}}function X(Y){return Y.keyCode===tinymce.VK.ENTER}function E(Y){return X(Y)&&!Y.shiftKey}function L(Y){return Y.keyCode===tinymce.VK.BACKSPACE||Y.keyCode===tinymce.VK.DELETE}function P(Y){if(H(Y)){return z}else{if(E(Y)&&A()){return N}else{if(E(Y)&&I()){return w}else{return Q}}}}function G(Y,Z){if(B==z||B==w||(tinymce.isGecko||tinymce.isWebKit)&&B==N){u.cancel(Z)}}function M(){var ab=D.selection.getNode();var aa="h1,h2,h3,h4,h5,h6,p,div";var Z=D.dom.is(ab,aa)&&ab.parentNode.tagName==="LI"&&ab.parentNode.lastChild===ab;var Y=AJS.EditorUtils.isCursorAtEndOf(ab,D.selection.getRng(true));return D.selection.isCollapsed()&&Z&&Y}function O(aa,ac){if(E(ac)&&M()){aa.undoManager.beforeChange();aa.undoManager.add();var ab=aa.selection.getNode();var Z=aa.dom.create("li",{},!tinyMCE.isIE?'<br data-mce-bogus="true">':"");var Y=aa.dom.getParent(ab,"li");aa.dom.insertAfter(Z,Y);if(tinyMCE.isIE6||tinyMCE.isIE7||tinyMCE.isIE8){Z.appendChild(aa.dom.create("&nbsp;"));aa.selection.setCursorLocation(Z,1)}else{if(tinyMCE.isGecko){setTimeout(function(){aa.selection.setCursorLocation(Z,0)},0)}else{aa.selection.setCursorLocation(Z,0)}}aa.undoManager.add();ac.preventDefault()}}function y(ab,ad){var ag;if(!tinymce.isGecko){return}var Z=ab.selection.getStart();if(ad.keyCode!=tinymce.VK.BACKSPACE||Z.tagName!=="IMG"){return}function aa(ak){var al=ak.firstChild;var aj=null;do{if(!al){break}if(al.tagName==="LI"){aj=al}}while(al=al.nextSibling);return aj}function ai(ak,aj){while(ak.childNodes.length>0){aj.appendChild(ak.childNodes[0])}}ag=Z.parentNode.previousSibling;if(!ag){return}var ae;if(ag.tagName==="UL"||ag.tagName==="OL"){ae=ag}else{if(ag.previousSibling&&(ag.previousSibling.tagName==="UL"||ag.previousSibling.tagName==="OL")){ae=ag.previousSibling}else{return}}var ah=aa(ae);var Y=ab.dom.createRng();Y.setStart(ah,1);Y.setEnd(ah,1);ab.selection.setRng(Y);ab.selection.collapse(true);var ac=ab.selection.getBookmark();var af=Z.parentNode.cloneNode(true);if(af.tagName==="P"||af.tagName==="DIV"){ai(af,ah)}else{ah.appendChild(af)}Z.parentNode.parentNode.removeChild(Z.parentNode);ab.selection.moveToBookmark(ac)}function J(Y){var Z=D.dom.getParent(Y,"ol,ul");if(Z!=null){var aa=Z.lastChild;aa.appendChild(D.getDoc().createElement(""));D.selection.setCursorLocation(aa,0)}}this.ed=D;D.addCommand("Indent",this.indent,this);D.addCommand("Outdent",this.outdent,this);D.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this);D.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this);D.addCommand("InsertInlineTaskList",function(){if(AJS.Rte.Support.inlineTasks()){this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:AJS.I18n.getText("tinymce.confluence.placeholder.inline.tasks")})}},this);D.addCommand("InsertInlineTaskListNoToggle",function(){if(AJS.Rte.Support.inlineTasks()){this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:AJS.I18n.getText("tinymce.confluence.placeholder.inline.tasks"),noToggle:true})}},this);D.onInit.add(function(){D.editorCommands.addCommands({outdent:function(){var Z=D.selection,aa=D.dom;function Y(ab){ab=aa.getParent(ab,aa.isBlock);return ab&&(parseInt(D.dom.getStyle(ab,"margin-left")||0,10)+parseInt(D.dom.getStyle(ab,"padding-left")||0,10))>0}return Y(Z.getStart())||Y(Z.getEnd())||D.queryCommandState("InsertOrderedList")||D.queryCommandState("InsertUnorderedList")||D.queryCommandState("InsertInlineTaskList")}},"state")});D.onKeyUp.add(function(Z,aa){if(B==z){Z.execCommand(aa.shiftKey?"Outdent":"Indent",true,null);K(F());B=Q;return u.cancel(aa)}else{if(B==w){var Y=F();var ac=Z.settings.list_outdent_on_enter===true||aa.shiftKey;Z.execCommand(ac?"Outdent":"Indent",true,null);if(tinymce.isIE){J(Y)}K(Y);AJS.Rte.showSelection();return u.cancel(aa)}else{if(B==N){if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var ab=Z.getDoc().createTextNode("\uFEFF");Z.selection.getNode().appendChild(ab)}else{if(tinymce.isIE9||tinymce.isIE10||tinymce.isGecko||tinymce.isWebKit){Z.execCommand("Outdent");return u.cancel(aa)}}}}}});function U(Z,ad){function aa(ah,ae){var ag=[];var ai=new tinymce.dom.TreeWalker(ae,ah);for(var af=ai.current();af;af=ai.next()){if(Z.dom.is(af,"ol,ul,li")){ag.push(af)}}return ag}if(ad.keyCode==tinymce.VK.BACKSPACE){var Y=F();if(Y){var ac=Z.dom.getParent(Y,"ol,ul");if(ac&&ac.firstChild===Y){var ab=aa(ac,Y);Z.execCommand("Outdent",false,ab);Z.undoManager.add();return u.cancel(ad)}}}}function S(Z,ab){var Y=F();if(Y&&ab.keyCode===tinymce.VK.BACKSPACE&&Z.dom.is(Y,"li")&&Y.parentNode.firstChild!==Y){if(Z.dom.select("ul,ol",Y).length===1){var ad=Y.previousSibling;Z.dom.remove(Z.dom.select("br",Y));Z.dom.remove(Y,true);var aa=tinymce.grep(ad.childNodes,function(ae){return ae.nodeType===3});if(aa.length===1){var ac=aa[0];Z.selection.setCursorLocation(ac,ac.length)}Z.undoManager.add();return u.cancel(ab)}}}function W(aa,Y,ab){var Z;if(ab&&ab.nodeType==1&&aa.dom.is(ab,"li")){Z=ab.parentNode;tinymce.each(aa.dom.select("li>ul,li>ol",Z),function(ad){if(aa.dom.getAttrib(ad.parentNode,"data-mce-style")){return}var ac=ad.previousSibling;if(!ac){ad.parentNode.insertBefore(aa.dom.doc.createElement("br"),ad)}})}}function V(ac,ad){var aa=F(),ab,Z,ae;function Y(ai){var ag=ac.dom.doc.createTextNode(String.fromCharCode(160)),af=ai.previousSibling,ah=(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8)?ab:ac.getDoc().createRange();if(af&&af.nodeType==3&&af.nodeValue[af.length-1]==ag.nodeValue){ah.setStart(af,af.length-1);ah.setEnd(af,af.length-1);ah.collapse(true);ac.selection.setRng(ah)}else{ae.parentNode.insertBefore(ag,ai);ah.setStartBefore(ag);ah.setEndBefore(ag);ah.collapse(true);ac.selection.setRng(ah)}}if(aa&&(E(ad)||L(ad))){ab=ac.selection.getRng(true);Z=ab.endContainer;if(Z.nodeType==3){if(ab.endOffset!==Z.length){return}ae=Z.nextSibling}else{if(Z.nodeType==1){ae=Z.childNodes[ab.endOffset]}else{return}}if(ae&&ac.dom.is(ae,"ul,ol")){if(tinymce.isIE){Y(ae)}else{ae.parentNode.insertBefore(ac.dom.create("br"),ae)}}}}function v(ab){var Z=F();if(!Z){return}var aa=Z.parentNode;function Y(ae){var ac=ae.parentNode,af=ac.previousSibling,ad;K(ac);if(ac.childNodes[0]===ae){if(ab.dom.getAttrib(ac,"data-mce-style")){return}if(ab.selection.getStart().parentNode==ae){ad=ab.selection.getRng(true);ad={startOffset:ad.startOffset,startContainer:ad.startContainer}}if(af){af.appendChild(ae)}else{af=ab.dom.create("li",{style:o});af.appendChild(ae);ac.parentNode.insertBefore(af,ac)}if(ad){ab.selection.setCursorLocation(ad.startContainer||ae.firstChild,ad.startOffset)}if(T(ac)){ab.dom.remove(ac)}}}tinymce.grep(ab.dom.select("li>ul, li>ol",aa),Y);if(ab.dom.is(aa.parentNode,"li")){Y(aa)}if(Z===aa.lastChild&&aa.nextSibling&&ab.dom.is(aa.nextSibling,"ul, ol")){tinymce.grep(ab.dom.select("li>ul, li>ol",aa.nextSibling),Y)}}D.onKeyDown.add(function(Y,Z){B=P(Z)});D.onKeyDown.add(G);D.onKeyDown.add(y);D.onKeyDown.add(O);if(tinymce.isWebKit){D.onNodeChange.add(v);D.onKeyUp.add(v)}if(!tinymce.isIE){D.onNodeChange.add(W);if(tinymce.isGecko){D.onKeyDown.add(V)}}else{D.onKeyDown.add(V)}function C(ab,ad){if(ad.keyCode==46&&!ad.shiftKey){var Y=F();if(Y&&(Y.childNodes.length==0||(Y.childNodes.length==1&&Y.firstChild.nodeName=="BR"))){var ac,ae,aa,Z;if(ac=Y.nextSibling){aa=ab.dom.doc.createTreeWalker(ac,NodeFilter.SHOW_TEXT,null,false);ae=aa.nextNode();Z=ab.getDoc().createRange();Z.setStart(ae,0);Z.setEnd(ae,0);ab.selection.setRng(Z);ab.dom.remove(Y);ab.undoManager.add();u.cancel(ad)}}}}if(tinymce.isGecko){D.onKeyDown.add(C)}},applyList:function(D,y,K,z){var L=this,F=L.ed,R=F.dom,v=[],Q=false,x=false,A=false,w=false,J,P=F.selection.getSelectedBlocks();K=K||"";z=z||{};var I=z.attributesOnItems,H=z.placeholderText,S=z.noToggle;function O(W){if(W&&W.tagName==="BR"){R.remove(W)}}function E(W){if(W&&W.tagName==="LI"){R.removeClass(W,"checked");W.removeAttribute("data-inline-task-id")}}function C(W){if(I&&W&&W.tagName==="LI"){for(var X in I){W.setAttribute(X,I[X])}}}function N(Z){var ab=R.create(D),W;if(K!=""){ab.className=K}function Y(ad){if(ad.style.marginLeft||ad.style.paddingLeft){L.adjustPaddingFunction(false)(ad)}}if(Z.tagName==="LI"){C(Z)}else{if(Z.tagName==="P"||Z.tagName==="DIV"||Z.tagName==="BODY"){V(Z,function(ae,ad){T(ae,ad,Z.tagName==="BODY"?null:ae.parentNode);W=ae.parentNode;Y(W);if(!tinymce.isChrome){O(ad)}});if(W){if(W.tagName==="LI"&&(Z.tagName==="P"||P.length>1)){if(H&&L.isEmptyElement(W)){var ac=document.createTextNode(H),aa=R.create("span");aa.appendChild(ac);W.appendChild(aa);setTimeout(function(){F.selection.select(ac)},0);if(tinymce.isIE7||tinymce.isIE8){W.appendChild(F.dom.create("br",{_mce_bogus:"1"}))}function X(ae,ad){if((ad.which||ad.keyCode)==64){if(ac.textContent==H){ac.textContent=" "}else{if(ac.data==H){ac.data=" "}}}window.setTimeout(function(){F.onKeyPress.remove(X)},0)}F.onKeyPress.addToTop(X)}R.split(W.parentNode.parentNode,W.parentNode)}p(W.parentNode,true);C(W)}return}else{W=R.create("li");C(W);R.insertAfter(W,Z);W.appendChild(Z);Y(Z);Z=W}}R.insertAfter(ab,Z);ab.appendChild(Z);p(ab,true);v.push(Z)}function T(ac,X,aa){var W,ab=ac,Z;while(!R.isBlock(ac.parentNode)&&ac.parentNode!==R.getRoot()){ac=R.split(ac.parentNode,ac.previousSibling);ac=ac.nextSibling;ab=ac}if(aa){W=aa.cloneNode(true);ac.parentNode.insertBefore(W,ac);while(W.firstChild){R.remove(W.firstChild)}W=R.rename(W,"li")}else{W=R.create("li");ac.parentNode.insertBefore(W,ac)}if(ab&&ab==X){var Y=R.create("br");R.setAttrib(Y,"data-mce-bogus",1);W.appendChild(ab);R.insertAfter(Y,ab)}while(ab&&ab!=X){Z=ab.nextSibling;W.appendChild(ab);ab=Z}if(W.childNodes.length===0){W.innerHTML='<br _mce_bogus="1" />'}N(W)}function V(ac,af){var Z,ad,aa=3,X=1,W="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";function ab(aj,ag){var ah=R.createRng(),ai;h.keep=true;F.selection.moveToBookmark(h);h.keep=false;ai=F.selection.getRng(true);if(!ag){ag=aj.parentNode.lastChild}ah.setStartBefore(aj);ah.setEndAfter(ag);return !(ah.compareBoundaryPoints(aa,ai)>0||ah.compareBoundaryPoints(X,ai)<=0)}function ae(ag){if(ag.nextSibling){return ag.nextSibling}if(!R.isBlock(ag.parentNode)&&ag.parentNode!==R.getRoot()){return ae(ag.parentNode)}}Z=ac.firstChild;var Y=false;d(R.select(W,ac),function(ag){if(ag.hasAttribute&&ag.hasAttribute("_mce_bogus")){return true}if(ab(Z,ag)){R.addClass(ag,"_mce_tagged_br");Z=ae(ag)}});Y=(Z&&ab(Z,undefined));Z=ac.firstChild;d(R.select(W,ac),function(ah){var ag=ae(ah);if(ah.hasAttribute&&ah.hasAttribute("_mce_bogus")){return true}if(R.hasClass(ah,"_mce_tagged_br")){af(Z,ah,ad);ad=null}else{ad=ah}Z=ag});if(Y){af(Z,undefined,ad)}}function M(W){V(W,function(Y,X,Z){T(Y,X);O(X);O(Z)})}function G(W){E(W);if(tinymce.inArray(v,W)!==-1){return}if(W.parentNode.tagName===y||!w){R.split(W.parentNode,W);N(W);r(W.parentNode,false)}if(K!=""){W.parentNode.className=K}C(W);v.push(W)}function B(Y){E(Y);var aa,Z,X,W;if(tinymce.inArray(v,Y)!==-1){return}Y=c(Y,R);while(R.is(Y.parentNode,"ol,ul,li")){R.split(Y.parentNode,Y)}v.push(Y);Y=R.rename(Y,"p");X=p(Y,false,F.settings.force_br_newlines);if(X===Y){aa=Y.firstChild;while(aa){if(R.isBlock(aa)){aa=R.split(aa.parentNode,aa);W=true;Z=aa.nextSibling&&aa.nextSibling.firstChild}else{Z=aa.nextSibling;if(W&&aa.tagName==="BR"){R.remove(aa)}W=false}aa=Z}}}function U(X,Y){var X=m(X,Y);var W=X.tagName==="LI"?X.parentNode:X;return W}d(P,function(W){W=U(W,R);w=(W.className===K);if(W.tagName===y){x=true}else{if(W.tagName===D){Q=true}else{A=true}}});if(A&&!Q||x||!w||P.length===0){J={LI:G,H1:N,H2:N,H3:N,H4:N,H5:N,H6:N,P:N,BODY:N,DIV:P.length>1?N:M,defaultAction:M,elements:this.selectedBlocks()}}else{if(!S){J={defaultAction:B,elements:this.selectedBlocks()}}else{J={}}}this.process(J)},indent:function(){var x=this.ed,z=x.dom,A=[];function v(C){var B=z.create("li",{style:o});z.insertAfter(B,C);return B}function w(F){var B=v(F),H=z.getParent(F,"ol,ul"),G=H.tagName,I=z.getStyle(H,"list-style-type"),E=H.className||"",D={},C;if(I!==""){D.style="list-style-type: "+I+";"}C=z.create(G,D);if(E!=""){C.className=E}B.appendChild(C);return C}function y(C){if(!e(x,C,A)){C=c(C,z);var B=w(C);if(tinymce.isIE7||tinymce.isIE8){C.appendChild(x.dom.create("br",{_mce_bogus:"1"}))}B.appendChild(C);p(B.parentNode,false);p(B,false);A.push(C)}}this.process({LI:y,defaultAction:this.adjustPaddingFunction(true),elements:this.selectedBlocks()})},outdent:function(A,z){var y=this,w=y.ed,B=w.dom,v=[];function C(D){var F,E,G;if(!e(w,D,v)){if(B.getStyle(D,"margin-left")!==""||B.getStyle(D,"padding-left")!==""){return y.adjustPaddingFunction(false)(D)}G=B.getStyle(D,"text-align",true);if(G==="center"||G==="right"){B.setStyle(D,"text-align","left");return}D=c(D,B);F=D.parentNode;E=D.parentNode.parentNode;if(E.tagName==="P"){B.split(E,D.parentNode)}else{B.split(F,D);if(E.tagName==="LI"){B.split(E,D)}else{if(!B.is(E,"ol,ul")){B.rename(D,"p")}}}if(B.hasClass(D.parentNode,"inline-task-list")){if(!D.hasAttribute("data-inline-task-id")){D.setAttribute("data-inline-task-id","")}}else{D.removeAttribute("data-inline-task-id")}v.push(D)}}var x=z&&tinymce.is(z,"array")?z:this.selectedBlocks();this.process({LI:C,defaultAction:this.adjustPaddingFunction(false),elements:x});d(v,p)},isEmptyElement:function(w){var x=this.ed.dom;var v=tinymce.grep(w.childNodes,function(y){return !(y.nodeName==="BR"||y.nodeName==="SPAN"&&x.getAttrib(y,"data-mce-type")=="bookmark"||y.nodeType==3&&(y.nodeValue==String.fromCharCode(160)||y.nodeValue==""))});return v.length===0},process:function(z){var F=this,x=F.ed.selection,A=F.ed.dom,E,v;function y(H){if(tinymce.isIE7||tinymce.isIE8){f(H).find("br[_mce_bogus='1']").remove()}A.removeClass(H,"_mce_act_on");if(!H||H.nodeType!==1||E.length>1&&F.isEmptyElement(H)){return}H=m(H,A);var I=z[H.tagName];if(!I){I=z.defaultAction}I(H)}function w(H){F.splitSafeEach(H.childNodes,y)}function C(H,I){return I>=0&&H.hasChildNodes()&&I<H.childNodes.length&&H.childNodes[I].tagName==="BR"}function D(){var I=x.getNode();var H=A.getParent(I,"td");return H!==null}E=z.elements;v=x.getRng(true);if(!v.collapsed){if(C(v.endContainer,v.endOffset-1)){v.setEnd(v.endContainer,v.endOffset-1);x.setRng(v)}if(C(v.startContainer,v.startOffset)){v.setStart(v.startContainer,v.startOffset+1);x.setRng(v)}}if(tinymce.isIE7||tinymce.isIE8){var G=F.ed.selection.getNode();if(G.tagName==="LI"&&!(G.parentNode.lastChild===G)){var B=F.ed.getDoc().createTextNode("\uFEFF");G.appendChild(B)}}h=x.getBookmark();z.OL=z.UL=w;F.splitSafeEach(E,y);x.moveToBookmark(h);h=null;if(!D()){F.ed.execCommand("mceRepaint")}},splitSafeEach:function(w,v){if(tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))){this.classBasedEach(w,v)}else{d(w,v)}},classBasedEach:function(y,x){var z=this.ed.dom,v,w;d(y,function(A){z.addClass(A,"_mce_act_on")});v=z.select("._mce_act_on");while(v.length>0){w=v.shift();z.removeClass(w,"_mce_act_on");x(w);v=z.select("._mce_act_on")}},adjustPaddingFunction:function(x){var v,y,w=this.ed;v=w.settings.indentation;y=/[a-z%]+/i.exec(v);v=parseInt(v,10);return function(z){var B,A;B=parseInt(w.dom.getStyle(z,"margin-left")||0,10)+parseInt(w.dom.getStyle(z,"padding-left")||0,10);if(x){A=B+v}else{A=B-v}w.dom.setStyle(z,"padding-left","");w.dom.setStyle(z,"margin-left",A>0?A+y:"")}},selectedBlocks:function(){var v=this.ed;var w=v.selection.getSelectedBlocks();return w.length==0?[v.dom.getRoot()]:w},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/jquery/jquery-column.js' */
(function(g){var f=/([\+\-]?\d*)[nN]([\+\-]?\d*)/,b,c,d=jQuery.expr.filter.PSEUDO;function h(k){var j=[],i={multiplier:0,offset:0};if(k==="even"){k="2n"}else{if(k==="odd"){k="2n+1"}else{if(/^\d*$/.test(k)){k="0n+"+k}}}j=f.exec(k);if(j!==null){i.multiplier=j[1]-0;i.offset=j[2]-0}return i}function e(k,l){var j,o,i=[],n=0,m=[];g.each(k,function(q,p){var s=0,r=0,t=p.rowSpan||1,u=p.colSpan||1;if(p.parentNode!==j){j=p.parentNode;if(j.parentNode!==o){o=j.parentNode;i=[]}n=0;if(i[j.rowIndex]===undefined){i[j.rowIndex]=[]}}for(s=0;s<i[j.rowIndex].length+1;s+=1){if(i[j.rowIndex][s]===undefined){n=s;break}}m[q]=n;for(s=j.rowIndex;s<j.rowIndex+t;s+=1){if(i[s]===undefined){i[s]=[]}for(r=n;r<n+u;r+=1){i[s][r]=true}}});return m}function a(k,j,i){var l=b[i]-(c.offset-1);if(c.multiplier===0){return l===0}else{return(l%c.multiplier===0&&l/c.multiplier>=0)}}g.extend(jQuery.fn,{nthCol:function(i){c=h(i);b=e(this);return g(this).filter(function(j){return a(this,undefined,j)})}})}(jQuery));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/table/editor_plugin_src.js' */
(function(e,g){var f=e.each,d=AJS.storageManager("atlassian.editor","tables");function c(j,k){var l=k.ownerDocument,h=l.createRange(),m;h.setStartBefore(k);h.setEnd(j.endContainer,j.endOffset);m=l.createElement("body");m.appendChild(h.cloneContents());return m.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function a(j,h){return parseInt(j.getAttribute(h)||1)}function b(z,j,t){var N,m,w,M;p();M=j.getParent(t.getStart(),"th,td");if(M){m=B(M);w=I();M=k(m.x,m.y)}function F(Y,X){Y=Y.cloneNode(X);Y.removeAttribute("id");return Y}function p(){var X=0;N=[];f(["thead","tbody","tfoot"],function(Y){var Z=j.select("> "+Y+" tr",z);f(Z,function(aa,ab){ab+=X;f(j.select("> td, > th",aa),function(ah,ac){var ad,ae,af,ag;if(N[ab]){while(N[ab][ac]){ac++}}af=a(ah,"rowspan");ag=a(ah,"colspan");for(ae=ab;ae<ab+af;ae++){if(!N[ae]){N[ae]=[]}for(ad=ac;ad<ac+ag;ad++){N[ae][ad]={part:Y,real:ae==ab&&ad==ac,elm:ah,rowspan:af,colspan:ag}}}})});X+=Z.length})}function k(X,Z){var Y;Y=N[Z];if(Y){return Y[X]}}function T(Z,X,Y){if(Z){Y=parseInt(Y);if(Y===1){Z.removeAttribute(X,1)}else{Z.setAttribute(X,Y,1)}}}function U(X){return X&&(j.hasClass(X.elm,"mceSelected")||X==M)}function Q(){var X=[];f(z.rows,function(Y){f(Y.cells,function(Z){if(j.hasClass(Z,"mceSelected")||Z==M.elm){X.push(Y);return false}})});return X}function o(){var X=j.createRng();X.setStartAfter(z);X.setEndAfter(z);t.setRng(X);j.remove(z)}function C(X){var Y;e.walk(X,function(aa){var Z;if(aa.nodeType==3){f(j.getParents(aa.parentNode,null,X).reverse(),function(ab){ab=F(ab,false);if(!Y){Y=Z=ab}else{if(Z){Z.appendChild(ab)}}Z=ab});if(Z){Z.innerHTML=e.isIE?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");X=F(X,false);T(X,"rowSpan",1);T(X,"colSpan",1);if(Y){X.appendChild(Y)}else{if(!e.isIE){X.innerHTML='<br data-mce-bogus="1" />'}}return X}function n(){var X=j.createRng();f(j.select("tr",z),function(Y){if(Y.cells.length==0){j.remove(Y)}});if(j.select("tr",z).length==0){X.setStartAfter(z);X.setEndAfter(z);t.setRng(X);j.remove(z);return}f(j.select("thead,tbody,tfoot",z),function(Y){if(Y.rows.length==0){j.remove(Y)}});K()}function K(){var Y,X;p();Y=N[Math.min(N.length-1,m.y)];if(Y){X=Y[Math.min(Y.length-1,m.x)].elm;X&&S(X)}}function S(X){if(e.isIE9||e.isIE10up){t.setCursorLocation(X,0);t.collapse(true)}else{t.select(X,true);t.collapse(true)}}function A(ad,ab,af,ac){var aa,Y,X,Z,ae;aa=N[ab][ad].elm.parentNode;for(X=1;X<=af;X++){aa=j.getNext(aa,"tr");if(aa){for(Y=ad;Y>=0;Y--){ae=N[ab+X][Y].elm;if(ae.parentNode==aa){for(Z=1;Z<=ac;Z++){j.insertAfter(C(ae),ae)}break}}if(Y==-1){for(Z=1;Z<=ac;Z++){aa.insertBefore(C(aa.cells[0]),aa.cells[0])}}}}}function G(){f(N,function(X,Y){f(X,function(aa,Z){var ad,ac,ae,ab;if(U(aa)){aa=aa.elm;ad=a(aa,"colspan");ac=a(aa,"rowspan");if(ad>1||ac>1){T(aa,"rowSpan",1);T(aa,"colSpan",1);for(ab=0;ab<ad-1;ab++){j.insertAfter(C(aa),aa)}A(Z,Y,ac-1,ad)}}})})}function L(ag,ad,aj){var aa,Z,ai,ah,af,ac,ae,X,ag,Y,ab;if(ag){pos=B(ag);aa=pos.x;Z=pos.y;ai=aa+(ad-1);ah=Z+(aj-1)}else{aa=m.x;Z=m.y;ai=w.x;ah=w.y}ae=k(aa,Z);X=k(ai,ah);if(ae&&X&&ae.part==X.part){G();p();ae=k(aa,Z).elm;T(ae,"colSpan",(ai-aa)+1);T(ae,"rowSpan",(ah-Z)+1);for(ac=Z;ac<=ah;ac++){for(af=aa;af<=ai;af++){if(!N[ac]||!N[ac][af]){continue}ag=N[ac][af].elm;if(ag!=ae){Y=e.grep(ag.childNodes);f(Y,function(ak){ae.appendChild(ak)});if(Y.length){Y=e.grep(ae.childNodes);ab=0;f(Y,function(ak){if(ak.nodeName=="BR"&&j.getAttrib(ak,"data-mce-bogus")&&ab++<Y.length-1){ae.removeChild(ak)}})}j.remove(ag)}}}n()}}function r(ad){var X,af,ac,ae,ag,ah,Y,ai,ab,aa,Z;f(N,function(aj,ak){f(aj,function(am,al){if(U(am)){am=am.elm;ag=am.parentNode;ah=F(ag,false);X=ak;if(ad){return false}}});if(ad){return !X}});for(ae=0;ae<N[0].length;ae++){if(!N[X][ae]){continue}af=N[X][ae].elm;if(af!=ac){if(!ad){ab=a(af,"rowspan");if(ab>1){T(af,"rowSpan",ab+1);continue}}else{if(X>0&&N[X-1][ae]){ai=N[X-1][ae].elm;ab=a(ai,"rowSpan");if(ab>1){T(ai,"rowSpan",ab+1);continue}}}Z=AJS.Rte.Table.isColumnHeading(g(af).closest("table"),ae+1);Y=Z?j.create("th"):j.create("td");Y.colSpan=af.colSpan;Y.width=af.width;Y.innerHTML=e.isIE9?"":(e.isIE?"&nbsp;":'<br data-mce-bogus="1" />');Y.className=af.className;if(!Z){j.removeClass(Y,e.settings.confluence_table_heading_style);j.addClass(Y,e.settings.confluence_table_cell_style)}aa=j.getAttrib(af,"data-highlight-colour");if(!AJS.Rte.Table.isColumnHighlighted(z,ae+1)){j.removeClass(Y,"highlight-"+aa)}else{j.setAttrib("data-highlight-colour",aa)}ah.appendChild(Y);ac=af}}if(ah.hasChildNodes()){if(!ad){j.insertAfter(ah,ag)}else{ag.parentNode.insertBefore(ah,ag)}}}function l(Z){var aa,X;function Y(ab){var ac;var ad=j.create(ab.tagName);ad.colSpan=ab.colSpan;ad.width=ab.width;ad.className=ab.className;ad.innerHTML=e.isIE?"&nbsp;":'<br data-mce-bogus="1"/>';ac=j.getAttrib(ab,"data-highlight-colour");if(ac){j.setAttrib(ad,"data-highlight-colour",ac)}return ad}f(N,function(ab,ac){f(ab,function(ae,ad){if(U(ae)){aa=ad;if(Z){return false}}});if(Z){return !aa}});f(N,function(ae,af){var ab,ac,ad;if(!ae[aa]){return}ab=ae[aa].elm;if(ab!=X){ad=a(ab,"colspan");ac=a(ab,"rowspan");if(ad==1){if(!Z){j.insertAfter(Y(ab),ab);A(aa,af,ac-1,ad)}else{ab.parentNode.insertBefore(Y(ab),ab);A(aa,af,ac-1,ad)}}else{T(ab,"colSpan",ab.colSpan+1)}X=ab}})}function V(){var X=[];f(N,function(Y,Z){f(Y,function(ab,aa){if(U(ab)&&e.inArray(X,aa)===-1){f(N,function(ae){if(ae[aa]){var ac=ae[aa].elm,ad;ad=a(ac,"colSpan");if(ad>1){T(ac,"colSpan",ad-1)}else{j.remove(ac)}}});X.push(aa)}})});n()}function E(){var Y;function X(ab){var aa,ac,Z;aa=j.getNext(ab,"tr");f(ab.cells,function(ad){var ae=a(ad,"rowSpan");if(ae>1){T(ad,"rowSpan",ae-1);ac=B(ad);A(ac.x,ac.y,1,1)}});ac=B(ab.cells[0]);f(N[ac.y],function(ad){var ae;ad=ad.elm;if(ad!=Z){ae=a(ad,"rowSpan");if(ae<=1){j.remove(ad)}else{T(ad,"rowSpan",ae-1)}Z=ad}})}Y=Q();if(e.isIE9||e.isIE10){s(Y[0])}f(Y.reverse(),function(Z){X(Z)});n()}function J(){var X=Q();if(e.isIE9||e.isIE10){s(X[0])}j.remove(X);n();return X}function D(){var X=Q();f(X,function(Z,Y){X[Y]=F(Z,true)});return X}function H(Z,Y){var aa=Q(),X=aa[Y?0:aa.length-1],ab=X.cells.length;f(N,function(ad){var ac;ab=0;f(ad,function(af,ae){if(af.real){ab+=af.colspan}if(af.elm.parentNode==X){ac=1}});if(ac){return false}});if(!Y){Z.reverse()}f(Z,function(ae){var ad=ae.cells.length,ac;for(i=0;i<ad;i++){ac=ae.cells[i];T(ac,"colSpan",1);T(ac,"rowSpan",1)}for(i=ad;i<ab;i++){ae.appendChild(C(ae.cells[ad-1]))}for(i=ab;i<ad;i++){j.remove(ae.cells[i])}if(Y){X.parentNode.insertBefore(ae,X)}else{j.insertAfter(ae,X)}})}function s(X){if(X&&X.parentNode){t.select(X.parentNode);t.collapse(true)}}function P(Y){var X=k(Y.x,Y.y);var Z=X.elm;if((e.isGecko||e.isIE)&&Z.firstChild){Z=Z.firstChild}if(e.isIE9||e.isIE10up){var aa=t.getRng(1);aa.setStart(Z,0);aa.setEnd(Z,0);t.setRng(aa)}else{t.select(Z,true);t.collapse(true)}}function O(){m=B(j.getParent(t.getStart(),"th,td"))}function h(){var X=v();if(!X){r(false);p();X=v()}P(X)}function v(){var X,Y=N[0].length;if(!(m.x==Y-1&&m.y==N.length-1)){if(m.x==Y-1){X={x:0,y:m.y+1}}else{X={x:m.x+1,y:m.y}}}return X}function R(){var X=q();if(!X){r(true);p();O();X=q()}P(X)}function q(){var X;if(!(m.x==0&&m.y==0)){if(m.x>0){X={x:m.x-1,y:m.y}}else{var Y=m.y-1;X={x:N[Y].length-1,y:Y}}}return X}function B(X){var Y;f(N,function(Z,aa){f(Z,function(ac,ab){if(ac.elm==X){Y={x:ab,y:aa};return false}});return !Y});return Y}function u(X){m=B(X)}function I(){var Z,Y,X;Y=X=0;f(N,function(aa,ab){f(aa,function(ad,ac){var af,ae;if(U(ad)){ad=N[ab][ac];if(ac>Y){Y=ac}if(ab>X){X=ab}if(ad.real){af=ad.colspan-1;ae=ad.rowspan-1;if(af){if(ac+af>Y){Y=ac+af}}if(ae){if(ab+ae>X){X=ab+ae}}}}})});return{x:Y,y:X}}function W(ad){var aa,Z,af,ae,Y,X,ab,ac;w=B(ad);if(m&&w){aa=Math.min(m.x,w.x);Z=Math.min(m.y,w.y);af=Math.max(m.x,w.x);ae=Math.max(m.y,w.y);Y=af;X=ae;for(y=Z;y<=X;y++){ad=N[y][aa];if(!ad.real){if(aa-(ad.colspan-1)<aa){aa-=ad.colspan-1}}}for(x=aa;x<=Y;x++){ad=N[Z][x];if(!ad.real){if(Z-(ad.rowspan-1)<Z){Z-=ad.rowspan-1}}}for(y=Z;y<=ae;y++){for(x=aa;x<=af;x++){ad=N[y][x];if(ad.real){ab=ad.colspan-1;ac=ad.rowspan-1;if(ab){if(x+ab>Y){Y=x+ab}}if(ac){if(y+ac>X){X=y+ac}}}}}j.removeClass(j.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=Z;y<=X;y++){for(x=aa;x<=Y;x++){if(N[y][x]){j.addClass(N[y][x].elm,"mceSelected")}}}}}e.extend(this,{deleteTable:o,split:G,merge:L,insertRow:r,insertCol:l,deleteCols:V,deleteRows:E,cutRows:J,copyRows:D,pasteRows:H,getPos:B,setStartCell:u,setEndCell:W,moveCaretToNextCell:h,moveCaretToPrevCell:R})}e.create("tinymce.plugins.TablePlugin",{init:function(n,j){var q,o,p=true;function k(t){var s=n.selection,r;t=t||s.getNode().parentNode;r=n.dom.getParent(t,"table");if(r){return new b(r,n.dom,s)}}function l(){n.getBody().style.webkitUserSelect="";if(p){n.dom.removeClass(n.dom.select("td.mceSelected,th.mceSelected"),"mceSelected");p=false}}f([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(r){n.addButton(r[0],{title:r[1],cmd:r[2],ui:r[3]})});if(!e.isIE){n.onClick.add(function(r,s){s=s.target;if(s.nodeName==="TABLE"){r.selection.select(s);r.nodeChanged()}})}n.onPreProcess.add(function(s,t){var r,u,v,z=s.dom,w;r=z.select("table",t.node);u=r.length;while(u--){v=r[u];z.setAttrib(v,"data-mce-style","");if((w=z.getAttrib(v,"width"))){z.setStyle(v,"width",w);z.setAttrib(v,"width","")}if((w=z.getAttrib(v,"height"))){z.setStyle(v,"height",w);z.setAttrib(v,"height","")}}});n.onNodeChange.add(function(s,r,u){var t;u=s.selection.getStart();t=s.dom.getParent(u,"td,th,caption");r.setActive("table",u.nodeName==="TABLE"||!!t);if(t&&t.nodeName==="CAPTION"){t=0}r.setDisabled("delete_table",!t);r.setDisabled("delete_col",!t);r.setDisabled("delete_table",!t);r.setDisabled("delete_row",!t);r.setDisabled("col_after",!t);r.setDisabled("col_before",!t);r.setDisabled("row_after",!t);r.setDisabled("row_before",!t);r.setDisabled("row_props",!t);r.setDisabled("cell_props",!t);r.setDisabled("split_cells",!t);r.setDisabled("merge_cells",!t)});n.onInit.add(function(v){var t,z,u=v.dom,A;q=v.windowManager;v.onMouseDown.add(function(C,D){if(D.button!=2){l();z=u.getParent(D.target,"td,th");t=u.getParent(z,"table")}});u.bind(v.getDoc(),"mouseover",function(G){var E,D,F=u.getParent(G.target,"td,th");if(z&&(A||F!=z)&&F){D=u.getParent(F,"table");if(D==t){if(!A){A=k(D);A.setStartCell(z);v.getBody().style.webkitUserSelect="none"}A.setEndCell(F);p=true}E=v.selection.getSel();try{if(E.removeAllRanges){E.removeAllRanges()}else{E.empty()}}catch(C){}G.preventDefault()}});v.onMouseUp.add(function(G,H){var C,D=G.selection,I,E,F,J,K;if(!z){return}I=u.select("td.mceSelected, th.mceSelected");try{if(I.length===0){return}if(e.isWebKit&&A){G.getBody().style.webkitUserSelect=""}C=u.createRng();E=I[0];F=I[I.length-1];if(e.isWebKit&&u.is(E,"tr:first-child > *:first-child")&&u.is(F,"tr:last-child > *:last-child")){J=u.getParents(E,"table",G.getBody());if(J.length===0){return}K=J[0];C.setStartBefore(K);C.setEndAfter(K)}else{C.setStartBefore(E);C.setEndAfter(F)}D.setRng(C);G.nodeChanged()}finally{z=A=t=null}});v.onUndo.add(function(D,C,E){p=D.dom.select("td.mceSelected, th.mceSelected").length>0});v.onKeyUp.add(function(C,D){l()});v.onKeyDown.add(function(C,D){r(C)});v.onMouseDown.add(function(C,D){if(D.button!=2){r(C)}});function s(H,D,E,J){var F=3,K=H.dom.getParent(D.startContainer,"TABLE"),G,C,I;if(K){G=K.parentNode}C=D.startContainer.nodeType==F&&D.startOffset==0&&D.endOffset==0&&J&&(E.nodeName=="TR"||E==G);I=(E.nodeName=="TD"||E.nodeName=="TH")&&!J;return C||I}function r(E){if(!e.isWebKit){return}var D=E.selection.getRng();var G=E.selection.getNode();var F=E.dom.getParent(D.startContainer,"TD,TH");if(!s(E,D,G,F)){return}if(!F){F=G}var C=F.lastChild;while(C.lastChild){C=C.lastChild}D.setEnd(C,C.nodeValue.length);E.selection.setRng(D)}v.plugins.table.fixTableCellSelection=r;if(v&&v.plugins.contextmenu){v.plugins.contextmenu.onContextMenu.add(function(E,C,G){var H,F=v.selection,D=F.getNode()||v.getBody();if(v.dom.getParent(G,"td")||v.dom.getParent(G,"th")||v.dom.select("td.mceSelected,th.mceSelected").length){C.removeAll();if(D.nodeName=="A"&&!v.dom.getAttrib(D,"name")){C.add({title:"advanced.link_desc",icon:"link",cmd:v.plugins.advlink?"mceAdvLink":"mceLink",ui:true});C.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});C.addSeparator()}if(D.nodeName=="IMG"&&D.className.indexOf("mceItem")==-1){C.add({title:"advanced.image_desc",icon:"image",cmd:v.plugins.advimage?"mceAdvImage":"mceImage",ui:true});C.addSeparator()}C.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});C.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});C.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});C.addSeparator();H=C.addMenu({title:"table.cell"});H.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});H.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});H.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});H=C.addMenu({title:"table.row"});H.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});H.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});H.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});H.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});H.addSeparator();H.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});H.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});H.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!o);H.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!o);H=C.addMenu({title:"table.col"});H.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});H.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});H.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{C.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(e.isWebKit){function B(G,R){var P=e.VK;var U=R.keyCode;function S(ac,Y,W){var X=ac?"previousSibling":"nextSibling";var ad=G.dom.getParent(Y,"tr");var ab=ad[X];if(ab){D(G,Y,ab,ac);e.dom.Event.cancel(W);return true}else{var ae=G.dom.getParent(ad,"table");var aa=ad.parentNode;var V=aa.nodeName.toLowerCase();if(V==="tbody"||V===(ac?"tfoot":"thead")){var Z=C(ac,ae,aa,"tbody");if(Z!==null){return O(ac,Z,Y,W)}}return Q(ac,ad,X,ae,W)}}function C(Z,X,Y,ab){var W=G.dom.select(">"+ab,X);var V=W.indexOf(Y);if(Z&&V===0||!Z&&V===W.length-1){return F(Z,X)}else{if(V===-1){var aa=Y.tagName.toLowerCase()==="thead"?0:W.length-1;return W[aa]}else{return W[V+(Z?-1:1)]}}}function F(Y,X){var W=Y?"thead":"tfoot";var V=G.dom.select(">"+W,X);return V.length!==0?V[0]:null}function O(Z,X,W,Y){var V=N(X,Z);V&&D(G,W,V,Z);e.dom.Event.cancel(Y);return true}function Q(ac,Y,V,ab,aa){var W=ab[V];if(W){J(W);return true}else{var Z=G.dom.getParent(ab,"td,th");if(Z){return S(ac,Z,aa)}else{var X=N(Y,!ac);J(X);return e.dom.Event.cancel(aa)}}}function N(W,V){var X=W&&W[V?"lastChild":"firstChild"];return X&&X.nodeName==="BR"?G.dom.getParent(X,"td,th"):X}function J(V){G.selection.setCursorLocation(V,0)}function E(){return U==P.UP||U==P.DOWN}function H(V){var X=V.selection.getNode();var W=V.dom.getParent(X,"tr");return W!==null}function T(W){var V=0;var X=W;while(X.previousSibling){X=X.previousSibling;V=V+a(X,"colspan")}return V}function I(X,V){var Y=0;var W=0;f(X.children,function(Z,aa){Y=Y+a(Z,"colspan");W=aa;if(Y>V){return false}});return W}function D(X,aa,ac,Z){var ab=T(X.dom.getParent(aa,"td,th"));var W=I(ac,ab);var V=ac.childNodes[W];var Y=N(V,Z);J(Y||V)}function L(V){var X=G.selection.getNode();var Y=G.dom.getParent(X,"td,th");var W=G.dom.getParent(V,"td,th");return Y&&Y!==W&&M(Y,W)}function M(W,V){return G.dom.getParent(W,"TABLE")===G.dom.getParent(V,"TABLE")}if(E()&&H(G)){var K=G.selection.getNode();setTimeout(function(){if(L(K)){S(!R.shiftKey&&U===P.UP,K,R)}},0)}}v.onKeyDown.add(B)}if(!e.isIE){function w(){}if(e.isGecko){v.onKeyDown.add(function(D,F){var C,E,G=D.dom;if(F.keyCode==37||F.keyCode==38){C=D.selection.getRng();E=G.getParent(C.startContainer,"table");if(E&&D.getBody().firstChild==E){if(c(C,E)){C=G.createRng();C.setStartBefore(E);C.setEndBefore(E);D.selection.setRng(C);F.preventDefault()}}}})}v.onKeyUp.add(w);v.onSetContent.add(w);v.onVisualAid.add(w);if(e.isGecko){v.onKeyDown.add(function(D,F){if(F.keyCode===e.VK.ENTER&&F.shiftKey){var E=D.selection.getRng().startContainer;var G=u.getParent(E,"td,th");if(G){var C=D.getDoc().createTextNode("\uFEFF");u.insertAfter(C,E)}}})}w();v.startContent=v.getContent({format:"raw"})}});function h(s){var u=[],r="";for(var t=0;t<s.length;t++){u.push(AJS.Rte.getEditor().serializer.serialize(s[t]))}r="<tr>"+u.join("</tr><tr>")+"</tr>";d.setItem("copied",r,(60*60)*2)}function m(){var t=[],r=d.getItem("copied")||"",s;if(r){s=n.getDoc().createElement("div");s.innerHTML="<table>"+r+"</table>";t=g(s).find("tr")}return t}f({mceTableSplitCells:function(r){r.split()},mceTableMergeCells:function(s){var t,u,r;r=n.dom.getParent(n.selection.getNode(),"th,td");if(r){t=r.rowSpan;u=r.colSpan}if(n.dom.select("td.mceSelected,th.mceSelected").length){s.merge()}},mceTableInsertRowBefore:function(r){r.insertRow(true)},mceTableInsertRowAfter:function(r){r.insertRow()},mceTableInsertColBefore:function(r){r.insertCol(true)},mceTableInsertColAfter:function(r){r.insertCol()},mceTableDeleteCol:function(r){r.deleteCols()},mceTableDeleteRow:function(r){r.deleteRows()},mceTableCutRow:function(r){o=r.cutRows();h(o)},mceTableCopyRow:function(r){o=r.copyRows();h(o)},mceTablePasteRowBefore:function(r){r.pasteRows(m(),true)},mceTablePasteRowAfter:function(r){r.pasteRows(m())},mceTableDelete:function(r){r.deleteTable()},mceTableMoveCaretToNextCell:function(r){r.moveCaretToNextCell()},mceTableMoveCaretToPrevCell:function(r){r.moveCaretToPrevCell()}},function(s,r){n.addCommand(r,function(){var t=k();if(t){s(t);n.execCommand("mceRepaint");l()}})});f({mceInsertTable:function(r){q.open({url:j+"/table.htm",width:400+parseInt(n.getLang("table.table_delta_width",0)),height:320+parseInt(n.getLang("table.table_delta_height",0)),inline:1},{plugin_url:j,action:r?r.action:0})},mceTableRowProps:function(){q.open({url:j+"/row.htm",width:400+parseInt(n.getLang("table.rowprops_delta_width",0)),height:295+parseInt(n.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:j})},mceTableCellProps:function(){q.open({url:j+"/cell.htm",width:400+parseInt(n.getLang("table.cellprops_delta_width",0)),height:295+parseInt(n.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:j})}},function(s,r){n.addCommand(r,function(t,u){s(u)})})}});e.PluginManager.add("table",e.plugins.TablePlugin)})(tinymce,AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/table/js/table.js' */
(function(){AJS.$.extend(tinymce.plugins.TablePlugin.prototype,{insertTable:function(J){var v=AJS.$("#tinymce-table-form")[0];var n=AJS.Rte.getEditor(),L=n.dom;var D=2,z=2,I=0,N=-1,l=-1,K,G,F,m=tinymce.settings.confluence_table_style,O,E,A,M="";var C="",H,p;p=L.getParent(n.selection.getNode(),"table");var o,j;o=v.elements.heading.checked;j=v.elements["equal-width-columns"].checked;D=v.elements.cols.value;z=v.elements.rows.value;G=AJS.$("#tinymce-table-form input[name='width']").val();C+="<table";C+=e("data-mce-new","1");if(G&&n.settings.inline_styles){if(M){M+="; "}if(/^[0-9\.]+$/.test(G)){G+="px"}M+="width: "+G}else{C+=e("width",G)}C+=e("class",m);C+=e("style",M);C+=">";for(var u=0;u<z;u++){C+="<tr>";function B(x){return x.charAt(0).toUpperCase()+x.substring(1,x.length)}for(var w=0;w<D;w++){var t,s,k;if(u==0&&o){t="th";k=tinymce.settings.confluence_table_heading_style}else{t="td";k=tinymce.settings.confluence_table_cell_style}if(j){s=' width="'+(Math.round((100/D)*100)/100)+'%"'}C+="<"+t+(s?s:"")+' class="'+k+'">';if(!tinymce.isIE||tinymce.isIE11){C+='<br data-mce-bogus="1"/>'}else{if(tinymce.isIE9){C+="&nbsp;"}}C+="</"+t+">"}C+="</tr>"}C+="</table>";if(n.settings.fix_table_elements){var r="";AJS.Rte.BookmarkManager.restoreBookmark();n.selection.setContent('<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(x){if(r){r+=","}r+=x+" ._mce_marker"});tinymce.each(n.dom.select(r),function(x){n.dom.split(n.dom.getParent(x,"h1,h2,h3,h4,h5,h6,p"),x)});var q=L.select("br._mce_marker")[0];n.selection.select(q);n.selection.setContent(C);n.dom.remove(q)}else{n.execCommand("mceInsertContent",false,C)}tinymce.each(L.select("table[data-mce-new]"),function(Q){var y=o?"th":"td",x=L.select(y,Q);try{n.selection.setCursorLocation(x[0],0)}catch(P){}L.setAttrib(Q,"data-mce-new","")});n.addVisual();n.execCommand("mceEndUndoLevel",false,{},{skip_undo:true})}});function e(m,l){var k=document.forms[0];var j=k.elements[m];if(typeof(l)=="undefined"||l==null){l="";if(j){l=j.value}}if(l==""){return""}l=l.replace(/&/g,"&amp;");l=l.replace(/\"/g,"&quot;");l=l.replace(/</g,"&lt;");l=l.replace(/>/g,"&gt;");return" "+m+'="'+l+'"'}function g(){tinyMCEPopup.resizeToInnerSize();document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor");document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var s=2,r=2,z=tinyMCEPopup.getParam("table_default_border","0"),G=tinyMCEPopup.getParam("table_default_cellpadding",""),k=tinyMCEPopup.getParam("table_default_cellspacing","");var A="",y="",v="",D="",j="",l="";var w="",o="",E="",x="",H="",F="",j="",D="",q="",u="";var m=tinyMCEPopup.editor,C=m.dom;var p=document.forms[0];var n=C.getParent(m.selection.getNode(),"table");action=tinyMCEPopup.getWindowArg("action");if(!action){action=n?"update":"insert"}if(n&&action!="insert"){var t=n.rows;var s=0;for(var B=0;B<t.length;B++){if(t[B].cells.length>s){s=t[B].cells.length}}s=s;r=t.length;st=C.parseStyle(C.getAttrib(n,"style"));z=trimSize(getStyle(n,"border","borderWidth"));G=C.getAttrib(n,"cellpadding","");k=C.getAttrib(n,"cellspacing","");y=trimSize(getStyle(n,"width","width"));v=trimSize(getStyle(n,"height","height"));D=convertRGBToHex(getStyle(n,"bordercolor","borderLeftColor"));j=convertRGBToHex(getStyle(n,"bgcolor","backgroundColor"));A=C.getAttrib(n,"align",A);u=C.getAttrib(n,"frame");q=C.getAttrib(n,"rules");l=tinymce.trim(C.getAttrib(n,"class").replace(/mceItem.+/g,""));w=C.getAttrib(n,"id");o=C.getAttrib(n,"summary");E=C.serializeStyle(st);x=C.getAttrib(n,"dir");H=C.getAttrib(n,"lang");F=getStyle(n,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1");p.caption.checked=n.getElementsByTagName("caption").length>0;orgTableWidth=y;orgTableHeight=v;action="update";p.insert.value=m.getLang("update")}addClassesToList("class","table_styles");TinyMCE_EditableSelects.init();selectByValue(p,"align",A);selectByValue(p,"tframe",u);selectByValue(p,"rules",q);selectByValue(p,"class",l,true,true);p.cols.value=s;p.rows.value=r;p.border.value=z;p.cellpadding.value=G;p.cellspacing.value=k;p.width.value=y;p.height.value=v;p.bordercolor.value=D;p.bgcolor.value=j;p.id.value=w;p.summary.value=o;p.style.value=E;p.dir.value=x;p.lang.value=H;p.backgroundimage.value=F;updateColor("bordercolor_pick","bordercolor");updateColor("bgcolor_pick","bgcolor");if(isVisible("backgroundimagebrowser")){document.getElementById("backgroundimage").style.width="180px"}if(action=="update"){p.cols.disabled=true;p.rows.disabled=true}}function c(){var k=document.forms[0];var l=dom.parseStyle(k.style.value);var j=k.height.value;if(j!=""){l.height=getCSSSize(j)}else{l.height=""}k.style.value=dom.serializeStyle(l)}function f(j){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(j)}function b(k,j){k=tinymce.trim(k||j);if(!f(k)){return parseInt(k,10)+"px"}return k}function h(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);k["background-image"]="url('"+j.backgroundimage.value+"')";j.style.value=dom.serializeStyle(k)}function i(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);if(j.border.value!=""&&(f(j.border.value)||j.bordercolor.value!="")){k["border-width"]=b(j.border.value)}else{if(!j.border.value){k.border="";k["border-width"]=""}}j.style.value=dom.serializeStyle(k)}function a(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);k["background-color"]=j.bgcolor.value;if(j.bordercolor.value!=""){k["border-color"]=j.bordercolor.value;if(!k["border-width"]){k["border-width"]=b(j.border.value,1)}}j.style.value=dom.serializeStyle(k)}function d(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);if(k["background-image"]){j.backgroundimage.value=k["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1")}else{j.backgroundimage.value=""}if(k.width){j.width.value=trimSize(k.width)}if(k.height){j.height.value=trimSize(k.height)}if(k["background-color"]){j.bgcolor.value=k["background-color"];updateColor("bgcolor_pick","bgcolor")}if(k["border-color"]){j.bordercolor.value=k["border-color"];updateColor("bordercolor_pick","bordercolor")}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/autoresize/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.AutoResizePlugin",{init:function(b,d){var e=this,f=0;if(b.getParam("fullscreen_is_enabled")){return}function c(){var k,j=b.getDoc(),g=j.body,m=j.documentElement,i=tinymce.DOM,l=e.autoresize_min_height,h;h=AJS.$(j).height();if(h>e.autoresize_min_height){l=h}if(e.autoresize_max_height&&h>e.autoresize_max_height){l=e.autoresize_max_height;g.style.overflowY="auto";m.style.overflowY="auto"}else{g.style.overflowY="hidden";m.style.overflowY="hidden";g.scrollTop=0}if(l!==f){k=l-f;i.setStyle(i.get(b.id+"_ifr"),"height",l+"px");f=l;if(tinymce.isWebKit&&k<0){c()}}}e.editor=b;e.autoresize_min_height=parseInt(b.getParam("autoresize_min_height",b.getElement().offsetHeight));e.autoresize_max_height=parseInt(b.getParam("autoresize_max_height",0));b.onChange.add(c);b.onSetContent.add(c);b.onPaste.add(c);b.onKeyUp.add(c);b.onPostRender.add(c);if(b.getParam("autoresize_on_init",true)){b.onLoad.add(c);b.onLoadContent.add(c)}b.addCommand("mceAutoResize",c)},getInfo:function(){return{longname:"Auto Resize",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autoresize",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("autoresize",tinymce.plugins.AutoResizePlugin)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confluencepaste/editor_plugin_src.js' */
(function(d){var c=tinymce.each,a={paste_auto_cleanup_on_paste:true,paste_enable_default_filters:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:false,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:false,paste_text_sticky:false,paste_text_sticky_default:false,paste_text_notifyalways:false,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function b(f,g){return f.getParam(g,a[g])}function e(g,f){if(g.is("ul.inline-task-list")){f.each(function(){var h=d(this);if(!h.attr("data-inline-task-id")){h.attr("data-inline-task-id","")}})}else{f.removeAttr("data-inline-task-id").removeAttr("data-pasted-task")}}tinymce.create("tinymce.plugins.ConfluencePastePlugin",{init:function(f,h){var i=this;i.editor=f;i.url=h;i.onPreProcess=new tinymce.util.Dispatcher(i);i.onPostProcess=new tinymce.util.Dispatcher(i);i.onPreProcess.add(i._preProcess);i.onPostProcess.add(i._postProcess);i.onPreProcess.add(function(l,m){f.execCallback("paste_preprocess",l,m)});i.onPostProcess.add(function(l,m){f.execCallback("paste_postprocess",l,m)});f.onKeyDown.addToTop(function(l,m){if(((tinymce.isMac?m.metaKey:m.ctrlKey)&&!m.shiftKey&&m.keyCode==86)||(m.shiftKey&&m.keyCode==45)){return false}});f.pasteAsPlainText=b(f,"paste_text_sticky_default");function k(p,m){var n=f.dom,l;i.onPreProcess.dispatch(i,p);p.node=n.create("div",0,p.content);if(tinymce.isGecko){l=f.selection.getRng(true);if(l.startContainer==l.endContainer&&l.startContainer.nodeType==3){if(p.node.childNodes.length===1&&/^(p|h[1-6]|pre)$/i.test(p.node.firstChild.nodeName)&&p.content.indexOf("__MCE_ITEM__")===-1){n.remove(p.node.firstChild,true)}}}i.onPostProcess.dispatch(i,p);p.content=f.serializer.serialize(p.node,{getInner:1,forced_root_block:""});if((!m)&&(f.pasteAsPlainText)){i._insertPlainText(p.content);if(!b(f,"paste_text_sticky")){f.pasteAsPlainText=false;f.controlManager.setActive("pastetext",false)}}else{i._insert(p.content)}tinymce.isGecko&&f.dom.getRoot().focus()}f.addCommand("mceInsertClipboardContent",function(l,m){k(m,true)});if(!b(f,"paste_text_use_dialog")){f.addCommand("mcePasteText",function(m,l){var n=tinymce.util.Cookie;f.pasteAsPlainText=!f.pasteAsPlainText;f.controlManager.setActive("pastetext",f.pasteAsPlainText);if((f.pasteAsPlainText)&&(!n.get("tinymcePasteText"))){if(b(f,"paste_text_sticky")){f.windowManager.alert(f.translate("paste.plaintext_mode_sticky"))}else{f.windowManager.alert(f.translate("paste.plaintext_mode"))}if(!b(f,"paste_text_notifyalways")){n.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31))}}})}f.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});f.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});function g(l){if(!l){return}var m=l.firstChild;if(m&&m.nodeName=="DIV"&&m.style.marginTop&&m.style.backgroundColor){f.dom.remove(m,1)}tinymce.isWebKit&&c(f.dom.select("span.Apple-style-span",l),function(n){f.dom.removeClass(n,"Apple-style-span")});tinymce.isWebKit&&c(f.dom.select("br.Apple-interchange-newline",l),function(n){f.dom.remove(n)});c(f.dom.select("br[data-mce-bogus]",l),function(n){f.dom.remove(n)});c(f.dom.select("meta[charset]",l),function(n){f.dom.remove(n)})}function j(x){var q,t,m,y,p=f.selection,s=f.dom,v=f.getBody(),l,w;f.undoManager.add();function u(B){if(!B.clipboardData||d.inArray("text/html",B.clipboardData.types||[])==-1){return false}var A=B.clipboardData.getData("text/html"),z;if(!A||!d.browser.webkit){return false}z=AJS.ClipboardHelper.repair(A);if(z==A){return false}var n=AJS.ClipboardHelper.parse(z,f.getDoc()),C=d("<div></div>");C.append(n);g(C[0]);k({content:C.html()});return true}if(u(x)){d.Event(x).preventDefault();return}if(x.clipboardData||s.doc.dataTransfer){w=(x.clipboardData||s.doc.dataTransfer).getData("Text");if(f.pasteAsPlainText){x.preventDefault();k({content:s.encode(w).replace(/\r?\n/g,"<br />")});return}}if(s.get("_mcePaste")){return}var o=v;if(v.contentEditable!="true"){o=s.getParent(f.selection.getStart(),'[contenteditable="true"]',v)}q=s.add(o,"div",{id:"_mcePaste","class":"mcePaste","data-mce-bogus":"1"},"\uFEFF\uFEFF");if(v!=f.getDoc().body){l=s.getPos(f.selection.getStart(),v).y}else{l=(function(){var n=s.getViewPort(f.getWin());return n.y+parseInt(n.h/2,10)}())}s.setStyles(q,{position:"absolute",left:tinymce.isGecko?-40:0,top:l-25,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){y=p.getRng();m=s.doc.body.createTextRange();m.moveToElementText(q);m.execCommand("Paste");s.remove(q);if(q.innerHTML==="\uFEFF\uFEFF"){f.execCommand("mcePasteWord");x.preventDefault();return}p.setRng(y);p.setContent("");setTimeout(function(){k({content:q.innerHTML})},0);return tinymce.dom.Event.cancel(x)}else{function r(n){n.preventDefault()}s.bind(f.getDoc(),"mousedown",r);s.bind(f.getDoc(),"keydown",r);t=f.selection.getRng();q=q.firstChild;m=f.getDoc().createRange();m.setStart(q,0);m.setEnd(q,2);p.setRng(m);window.setTimeout(function(){var z="",n;if(!s.select("div.mcePaste > div.mcePaste").length){n=s.select("div.mcePaste");c(n,function(A){g(A);if(A.parentNode.className!="mcePaste"){z+=A.innerHTML}})}else{z="<p>"+s.encode(w).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>"}c(s.select("div.mcePaste"),function(A){s.remove(A)});if(t){p.setRng(t)}k({content:z});s.unbind(f.getDoc(),"mousedown",r);s.unbind(f.getDoc(),"keydown",r)},0)}}if(b(f,"paste_auto_cleanup_on_paste")){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){f.onKeyDown.addToTop(function(l,m){if(((tinymce.isMac?m.metaKey:m.ctrlKey)&&m.keyCode==86)||(m.shiftKey&&m.keyCode==45)){j(m)}})}else{f.onPaste.addToTop(function(l,m){return j(m)})}}f.onInit.add(function(){f.controlManager.setActive("pastetext",f.pasteAsPlainText);if(b(f,"paste_block_drop")){f.dom.bind(f.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(l){l.preventDefault();l.stopPropagation();return false})}});f.onSaveContent.add(function(l,n){var m=d("<div/>").html(n.content);d('ul.inline-task-list > li[data-pasted-task="true"]',m).each(function(){var p=d(this),o=p.attr("data-inline-task-id");if(o){var q=m.find('ul.inline-task-list > li[data-inline-task-id="'+o+'"]');if(q.size()>1){p.attr("data-inline-task-id","")}}});n.content=m.html()});i._legacySupport()},getInfo:function(){return{longname:"ConfluencePastePlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(j,g){var m=this.editor,l=g.content,r=tinymce.grep,q=tinymce.explode,i=tinymce.trim,n,k;function f(h){c(h,function(o){if(o.constructor==RegExp){l=l.replace(o,"")}else{l=l.replace(o[0],o[1])}})}if(m.settings.paste_enable_default_filters==false){return}if(tinymce.isIE&&document.documentMode>=9){f([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]);f([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(l)||g.wordContent){g.wordContent=true;f([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(b(m,"paste_convert_headers_to_strong")){l=l.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")}if(b(m,"paste_convert_middot_lists")){f([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]])}f([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{n=l.length;l=l.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(n!=l.length);if(b(m,"paste_retain_style_properties").replace(/^none$/i,"").length==0){l=l.replace(/<\/?span[^>]*>/gi,"")}else{f([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(o,h){return(h.length>0)?h.replace(/./," ").slice(Math.floor(h.length/2)).split("").join("\u00a0"):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(v,h,u){var w=[],o=0,t=q(i(u).replace(/&quot;/gi,"'"),";");c(t,function(s){var x,z,A=q(s,":");function y(B){return B+((B!=="0")&&(/\d$/.test(B)))?"px":""}if(A.length==2){x=A[0].toLowerCase();z=A[1].toLowerCase();switch(x){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":w[o++]=x.replace(/^mso-|-alt$/g,"")+":"+y(z);return;case"horiz-align":w[o++]="text-align:"+z;return;case"vert-align":w[o++]="vertical-align:"+z;return;case"font-color":case"mso-foreground":w[o++]="color:"+z;return;case"mso-background":case"mso-highlight":w[o++]="background:"+z;return;case"mso-default-height":w[o++]="min-height:"+y(z);return;case"mso-default-width":w[o++]="min-width:"+y(z);return;case"mso-padding-between-alt":w[o++]="border-collapse:separate;border-spacing:"+y(z);return;case"text-line-through":if((z=="single")||(z=="double")){w[o++]="text-decoration:line-through"}return;case"mso-zero-height":if(z=="yes"){w[o++]="display:none"}return}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(x)){return}w[o++]=x+":"+A[1]}});if(o>0){return h+' style="'+w.join(";")+'"'}else{return h}}]])}}if(b(m,"paste_convert_headers_to_strong")){f([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]])}f([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]);k=b(m,"paste_strip_class_attributes");if(k!=="none"){function p(s,o){if(k==="all"){return""}var h=r(q(o.replace(/^(["'])(.*)\1$/,"$2")," "),function(t){return(/^(?!mso)/i.test(t))});return h.length?' class="'+h.join(" ")+'"':""}l=l.replace(/ class="([^"]+)"/gi,p);l=l.replace(/ class=([\-\w]+)/gi,p)}if(b(m,"paste_remove_spans")){l=l.replace(/<\/?span[^>]*>/gi,"")}g.content=l},_postProcess:function(i,k){var h=this,g=h.editor,j=g.dom,f;if(g.settings.paste_enable_default_filters==false){return}if(k.wordContent){c(j.select("a",k.node),function(l){if(!l.href||l.href.indexOf("#_Toc")!=-1){j.remove(l,1)}});if(b(g,"paste_convert_middot_lists")){h._convertLists(i,k)}f=b(g,"paste_retain_style_properties");if((tinymce.is(f,"string"))&&(f!=="all")&&(f!=="*")){f=tinymce.explode(f.replace(/^none$/i,""));c(j.select("*",k.node),function(o){var p={},m=0,n,q,l;if(f){for(n=0;n<f.length;n++){q=f[n];l=j.getStyle(o,q);if(l){p[q]=l;m++}}}j.setAttrib(o,"style","");if(f&&m>0){j.setStyles(o,p)}else{if(o.nodeName=="SPAN"&&!o.className){j.remove(o,true)}}})}}if(b(g,"paste_remove_styles")||(b(g,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)){c(j.select("*[style]",k.node),function(l){l.removeAttribute("style");l.removeAttribute("data-mce-style")})}else{if(tinymce.isWebKit){c(j.select("*",k.node),function(l){l.removeAttribute("data-mce-style")})}}},_convertLists:function(i,g){var k=i.editor.dom,j,n,f=-1,h,p=[],m,l;c(k.select("p",g.node),function(u){var r,v="",t,s,o,q;for(r=u.firstChild;r&&r.nodeType==3;r=r.nextSibling){v+=r.nodeValue}v=u.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(v)){t="ul"}if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(v)){t="ol"}if(t){h=parseFloat(u.style.marginLeft||0);if(h>f){p.push(h)}if(!j||t!=m){j=k.create(t);k.insertAfter(j,u)}else{if(h>f){j=n.appendChild(k.create(t))}else{if(h<f){o=tinymce.inArray(p,h);q=k.getParents(j.parentNode,t);j=q[q.length-1-o]||j}}}c(k.select("span",u),function(x){var w=x.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(t=="ul"&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(w)){k.remove(x)}else{if(/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(w)){k.remove(x)}}});s=u.innerHTML;if(t=="ul"){s=u.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,"")}else{s=u.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"")}n=j.appendChild(k.create("li",0,s));k.remove(u);f=h;m=t}else{j=f=0}});l=g.node.innerHTML;if(l.indexOf("__MCE_ITEM__")!=-1){g.node.innerHTML=l.replace(/__MCE_ITEM__/g,"")}},_insert:function(l,g){var k=this.editor,j=k.selection.getRng(true),m=this,f,i;l=m._applyOnBeforeSetContentListeners(k,l);i=AJS.ClipboardHelper.parse(l,k.getDoc());f=this._getClipboardInserter(k,j,i);if(f){f.insert(k,j,i);k.selection.onSetContent.dispatch(k.selection,{content:l,format:"html"});k.addVisual()}else{if(!k.selection.isCollapsed()&&j.startContainer!=j.endContainer){k.execCommand("mceDelete",false,null,{skip_undo:true})}k.execCommand("mceInsertContent",false,l,{skip_undo:g})}},_getClipboardInserter:function(i,h,g){var f;d.each(this.clipboardInserters,function(k,j){if(j.shouldInsert(i,h,g)){f=j;return false}});return f},clipboardInserters:[{shouldInsert:function(h,g,f){var i=function(k){var j=k.startContainer.nodeType==3?k.startContainer.parentNode:k.startContainer;return tinymce.isIE?j.nodeName=="LI"&&j.childNodes.length===0:j.nodeName=="LI"&&j.childNodes.length===1&&j.firstChild.nodeName=="BR"};return i(g)&&f.length===f.filter("ol,ul").length&&f.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer.nodeType==3?h.startContainer.parentNode:h.startContainer),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.replaceWith(f);i.selection.select(f.last()[0],true);i.selection.collapse();i.undoManager.add()}},{shouldInsert:function(i,h,g){var f=function(l,k){if(!k.collapsed||k.startOffset!=0){return false}var m=d(k.startContainer).closest("ol, ul",l.getBody());if(m.length===0){return false}var n=true,j=new tinymce.dom.TreeWalker(k.startContainer,m[0]).prev(n);return j===undefined||d(j).is("li")};return f(i,h)&&g.length===g.filter("ol,ul").length&&g.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer).closest("li",i.getBody()),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.before(f);i.selection.select(j[0],true);i.selection.collapse(true);i.undoManager.add()}},{shouldInsert:function(i,h,g){var f=function(l,k){if(!k.collapsed){return false}if(k.startContainer.nodeType==3&&k.startOffset!=k.startContainer.nodeValue.length){return false}if(k.startContainer.nodeType===1&&k.startOffset!=k.startContainer.childNodes.length){return false}var m=d(k.startContainer).closest("ol, ul",l.getBody());if(m.length===0){return false}var n=true,j=new tinymce.dom.TreeWalker(k.startContainer,m[0]).next(n);return j===undefined||d(j).is("li")};return f(i,h)&&g.length===g.filter("ol,ul").length&&g.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer).closest("li",i.getBody()),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.after(f);i.selection.select(f.last()[0],true);i.selection.collapse(false);i.undoManager.add()}},{shouldInsert:function(h,g,f){if(g.collapsed){return false}if(!d(g.commonAncestorContainer).is("table.confluenceTable > tbody, table.confluenceTable > tbody > tr")){return false}return f.is("table:not(.wysiwyg-macro)")},insert:function(n,l,g){var p=g.children("tbody").length>0?g.children("tbody").children("tr"):g.children("tr"),i=p.children("td, th"),q=d(".mceSelected",n.getDoc()),m=q.parent(),f,j;n.undoManager.beforeChange();n.undoManager.add();function o(r,t){for(var u=r.shift(),s=t.shift();u&&s;u=r.shift(),s=t.shift()){d(s).html(d(u).html())}}if(m.length===1){o(d.makeArray(i),d.makeArray(q))}else{f=d.makeArray(p);j=d.makeArray(m);for(var k=f.shift(),h=j.shift();k&&h;k=f.shift(),h=j.shift()){o(d.makeArray(d(k).children()),d.makeArray(d(h).children()))}}n.selection.setRng(l);n.undoManager.add()}},{shouldInsert:function(j,i,h){var g=d(i.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent");if(g.length===0){return false}var k=g.closest("table.confluenceTable",".mceContent");if(k.length===0||k.children("tbody").length===0){return}if(!h.is("table:not(.wysiwyg-macro)")){return false}var f=false;k.find("*[colspan], *[rowspan]").each(function(l,m){if(d(m).attr("rowspan")>1||d(m).attr("colspan")>1){f=true;return false}});return !f},insert:function(n,u,h){var l=d(u.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent"),r=l.closest("table.confluenceTable",".mceContent"),p=h.children("tbody").length>0?h.children("tbody").children("tr"):h.children("tr"),t=r.children("tbody").children("tr"),A=p.length,q=p.first().children("td, th").length,s=t.length,f=t.first().children("td, th").length,D=l.parent().index(),B=l.index();n.undoManager.beforeChange();n.undoManager.add();var o=B+q-f,g=D+A-s;o=o<0?0:o;g=g<0?0:g;t.each(function(H,J){var j=d(J),G=j.children().last();for(var I=0;I<o;I++){j.append(G.clone().html(tinymce.isIE?"":"<br/>"))}});var w=t.last(),C;for(var y=0;y<g;y++){C=d("<tr></tr>").insertAfter(w);for(var x=0;x<f+o;x++){C.append('<td class="confluenceTd">'+(tinymce.isIE?"":"<br/>")+"</td>")}w=C}var F=[];r.children("tbody").children("tr").slice(D).each(function(i,j){F.push(d.makeArray(d(j).children("th, td").slice(B)))});var z=[];p.each(function(i,j){z.push(d.makeArray(d(j).children("th, td")))});for(var E=z.shift(),k=F.shift();E&&k;E=z.shift(),k=F.shift()){for(var m=E.shift(),v=k.shift();m&&v;m=E.shift(),v=k.shift()){d(v).html(d(m).html())}}n.selection.select(l[0],1);n.selection.collapse(true);n.undoManager.add()}}],_applyOnBeforeSetContentListeners:function(h,f){var g={content:f,format:"html"};h.selection.onBeforeSetContent.dispatch(h.selection,g);return g.content},_insertPlainText:function(i){var f=this.editor,g=b(f,"paste_text_linebreaktype"),k=b(f,"paste_text_replacements"),h=tinymce.is;function j(l){c(l,function(m){if(m.constructor==RegExp){i=i.replace(m,"")}else{i=i.replace(m[0],m[1])}})}if((typeof(i)==="string")&&(i.length>0)){if(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(i)){j([/[\n\r]+/g])}else{j([/\r+/g])}j([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"]]);i=f.dom.decode(tinymce.html.Entities.encodeRaw(i));if(h(k,"array")){j(k)}else{if(h(k,"string")){j(new RegExp(k,"gi"))}}if(g=="none"){j([[/\n+/g," "]])}else{if(g=="br"){j([[/\n/g,"<br />"]])}else{if(g=="p"){j([[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]])}else{j([[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]])}}}f.execCommand("mceInsertContent",false,i)}},_legacySupport:function(){var g=this,f=g.editor;f.addCommand("mcePasteWord",function(){f.windowManager.open({file:g.url+"/pasteword.htm",width:parseInt(b(f,"paste_dialog_width")),height:parseInt(b(f,"paste_dialog_height")),inline:1})});if(b(f,"paste_text_use_dialog")){f.addCommand("mcePasteText",function(){f.windowManager.open({file:g.url+"/pastetext.htm",width:parseInt(b(f,"paste_dialog_width")),height:parseInt(b(f,"paste_dialog_height")),inline:1})})}f.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}});tinymce.PluginManager.add("confluencepaste",tinymce.plugins.ConfluencePastePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confcharmap/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfCharmapPlugin",{init:function(b,c){b.addCommand("confCharmap",function(){b.windowManager.open({id:"insert-char-dialog",url:tinyMCE.settings.editor_plugin_action_base_path+"/charmap.action",width:600+parseInt(b.getLang("advanced.charmap_delta_width",0)),height:290+parseInt(b.getLang("advanced.charmap_delta_height",0)),inline:true,name:"advanced.charmap_desc"})})},getInfo:function(){return{longname:"Confluence Charmap Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confcharmap",tinymce.plugins.ConfCharmapPlugin)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confluencelist/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluenceListPlugin",{init:function(b,c){!tinymce.isIE8&&b.onKeyDown.add(function(k,l){if(l.keyCode!=8){return}var j=k.selection.getRng(true),i=a(j.startContainer).closest("li",k.getBody());if(i.length===0){return}if(!AJS.EditorUtils.isCursorAtStartOf(i[0],j)){return}var g=i.prev("li"),f,m=i[0],h;if(g.length>0){f=g[0];h=a(m.firstChild);if(tinymce.isIE9&&h.length===0){h=a("<br/>").appendTo(i)}else{if(h.is("p")){h=h.contents().first()}}function d(e){if(!e||!e.lastChild){return}if(!k.dom.isBlock(e.lastChild)&&!a(e.lastChild).is("br")){a(e).append("<br/>")}}k.undoManager.beforeChange();k.undoManager.add();if(a(f.lastChild).is("p")&&!k.dom.isBlock(m.firstChild)){d(f.lastChild);i.contents().each(function(e,n){if(k.dom.isBlock(n)){return false}a(f.lastChild).append(a(n).detach())})}else{if(a(m.firstChild).is("p")&&!k.dom.isBlock(f.lastChild)){d(f);a.each(a.makeArray(g.contents()).reverse(),function(e,n){if(k.dom.isBlock(n)){return false}a(m.firstChild).prepend(a(n).detach())})}else{d(f)}}g.append(i.detach().contents());if(h[0]){AJS.EditorUtils.setCursorAtStartOfContents(h[0])}k.undoManager.add();return tinymce.dom.Event.cancel(l)}})},getInfo:function(){return{longname:"Confluence List Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confluencelist",tinymce.plugins.ConfluenceListPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/flextofullsize/editor_plugin_src.js' */
(function(E){var H,K,B,D,L,C,F,I,A,G=5;
var J=function(O){var M=E("#wysiwyg").is(":hidden")?E("#preview"):E("#wysiwyg");
D=M.find("iframe"),$headerPrecursor=E("#header-precursor");
var P=E(window).height();
var N=$headerPrecursor.offset().top+$headerPrecursor.height()+E("#header").height();
E("#content.edit").height(P-N);
setTimeout(function(){if(E("#preview").is(":hidden")){D.height(0).height(M.height())
}else{E("#content.edit").height("auto");
var R=E("#savebar-container").height();
N+=E("#editor-precursor").height()+E("#conflict-wrapper").height();
var Q=4;
D.height(P-N-R-Q)
}},1)
};
tinymce.create("tinymce.plugins.flextofullsizeplugin",{init:function(M,N){M.onInit.add(function(Q,O){var R,P;
if(tinymce.isIE||tinymce.isOpera){R=M.getWin();
B=E(R.parent);
P=E(R.parent.document);
E("body").css({overflow:"hidden"});
B.bind("resize.resizeplugin",function(){J()
});
P.bind("messageClose",function(S){setTimeout(J,0)
});
P.bind("resize.resizeplugin",function(T,S){J(S&&S.height)
});
P.bind("mode-changed",function(T,S){J()
});
M.onChange.add(function(){J()
});
M.onInit.add(function(){J()
})
}})
},getInfo:function(){return{longname:"flex editor to full size plugin",description:"adjusts height of editor so it always occupies the right space in between the toolbars",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("flextofullsize",tinymce.plugins.flextofullsizeplugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinyMce-translations.i18n.js' */
TinyMCELang={popup_blocked:"The browser has blocked a popup opened by the Editor.",ctrl_key:"Ctrl",shift_key:"Shift",searchreplace:{search_desc:"Find",replace_desc:"Find\/Replace"},searchreplace_dlg:{allreplacedplural:"{0} replacements were made",allreplacedsingular:"1 replacement was made",notfound:"No replacements were made",findlabel:"Find",replacelabel:"Replace",findnext:"Next",findprevious:"Previous",replace:"Replace",replaceall:"Replace all",close:"Close"},advhr:{advhr_desc:"tinymce.advhr.advhr_desc"},emotions:{emotions_desc:"Emoticons"},emotions_dlg:{title:"Insert emoticon",desc:"Emoticons",smile:"Smile :)",sad:"Sad :(",tongue:"Tongue :p",biggrin:"Big grin :D",wink:"Wink ;)",thumbs_up:"Thumbs up (y)",thumbs_down:"Thumbs down (n)",information:"Info (i)",check:"Tick (\/)",error:"Error (x)",warning:"Warning (!)",add:"Plus (+)",forbidden:"Minus (-)",help_16:"Question mark (?)",lightbulb_on:"Lightbulb on (on)",lightbulb:"Lightbulb off (off)",star_yellow:"Yellow star (*y)",star_red:"Red star (*r)",star_green:"Green star (*g)",star_blue:"Blue star (*b)",heart:"Heart \u003c3",broken_heart:"Broken heart \u003c\/3"},confluence:{conf_macro_browser:"Macro",conf_macro_browser_desc:"Insert macro",conf_image:"Image",confimage_desc:"Insert image",conf_link:"Link",conflink_desc:"Insert link",conf_table:"Table",conf_attachment:"Attachment",conf_wikimarkup:"Markup",conf_wikimarkup_desc:"Insert markup",conf_wikimarkup_errors:"Wiki markup conversion errors",conf_wikimarkup_timeout:"The server took too long to convert the wiki markup. This may only be a temporary problem so you could try again.",conf_wikimarkup_hint:"Hint: you can also enter wiki markup directly in the editor, where it will be formatted as you type.",conf_wikimarkup_markdown_label:"Markdown",conf_wikimarkup_confluence_label:"Confluence wiki",conf_shortcuts_help_desc:"Keyboard shortcuts help",conf_insert_button_title:"Insert"},table:{desc:"Insert table",row_before_desc:"Insert row before",row_after_desc:"Insert row after",delete_row_desc:"Remove row",col_before_desc:"Insert column before",col_after_desc:"Insert column after",delete_col_desc:"Remove column",split_cells_desc:"Split merged table cells",merge_cells_desc:"Merge table cells",row_desc:"tinymce.table.row_desc",cell_desc:"tinymce.table.cell_desc",props_desc:"tinymce.table.props_desc",paste_row_before_desc:"Paste table row",paste_row_after_desc:"Paste row after",cut_row_desc:"Cut table row",copy_row_desc:"Copy table row",del:"Remove table",row:"Row",col:"Column",cell:"Cell",row_highlight:"Heading row",col_highlight:"Heading column",selection_highlight:"Change cell colour",invalid_table_field:"Rows and columns must both be numbers greater than zero.",cut_row_desc_shortcut:"Ctrl+Shift+X",copy_row_desc_shortcut:"Ctrl+Shift+C",paste_row_before_desc_shortcut:"Ctrl+Shift+V",row_before_desc_shortcut:"Alt+\u2191",row_after_desc_shortcut:"Alt+\u2193"},advanced:{style_select:"tinymce.advanced.style_select",font_size:"tinymce.advanced.font_size",fontdefault:"tinymce.advanced.fontdefault",block:"Format",paragraph:"Paragraph",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",blockquote:"Quote",code:"tinymce.advanced.code",samp:"tinymce.advanced.samp",dt:"tinymce.advanced.dt",dd:"tinymce.advanced.dd",bold_desc:"Bold",italic_desc:"Italic",underline_desc:"Underline",striketrough_desc:"Strikethrough",justifyleft_desc:"Align left",justifycenter_desc:"Align center",justifyright_desc:"Align right",justifyfull_desc:"Align full",bullist_desc:"Bullet list",numlist_desc:"Numbered list",tasklist_desc:"Task list",outdent_desc:"Outdent",indent_desc:"Indent",undo_desc:"Undo",redo_desc:"Redo",link_desc:"tinymce.advanced.link_desc",unlink_desc:"Unlink",image_desc:"tinymce.advanced.image_desc",cleanup_desc:"tinymce.advanced.cleanup_desc",code_desc:"tinymce.advanced.code_desc",sub_desc:"Subscript",sup_desc:"Superscript",hr_desc:"Horizontal rule",removeformat_desc:"tinymce.advanced.removeformat_desc",custom1_desc:"tinymce.advanced.custom1_desc",forecolor_desc:"Select text colour",backcolor_desc:"tinymce.advanced.backcolor_desc",charmap_desc:"Symbol",visualaid_desc:"tinymce.advanced.visualaid_desc",anchor_desc:"tinymce.advanced.anchor_desc",cut_desc:"tinymce.advanced.cut_desc",copy_desc:"tinymce.advanced.copy_desc",paste_desc:"tinymce.advanced.paste_desc",image_props_desc:"tinymce.advanced.image_props_desc",newdocument_desc:"tinymce.advanced.newdocument_desc",help_desc:"Help",blockquote_desc:"tinymce.advanced.blockquote_desc",path:"tinymce.advanced.path",newdocument:"tinymce.advanced.newdocument",toolbar_focus:"tinymce.advanced.toolbar_focus",more_colors:"tinymce.advanced.more_colors",paragraph_shortcut:"Ctrl+0",pre_shortcut:"Ctrl+7",h1_shortcut:"Ctrl+1",h2_shortcut:"Ctrl+2",h3_shortcut:"Ctrl+3",h4_shortcut:"Ctrl+4",h5_shortcut:"Ctrl+5",h6_shortcut:"Ctrl+6",blockquote_shortcut:"Ctrl+8",bullist_shortcut:"Ctrl+Shift+B",numlist_shortcut:"Ctrl+Shift+N",tasklist_shortcut:"[ then ]",undo_shortcut:"Ctrl+Z",redo_shortcut:"Ctrl+Y"},colorpicker:{more_colors:"More colours",title:"Select a colour",picker_tab:"Picker",picker_title:"Colour picker",palette_title:"tinymce.colorpicker.palette_title",named_tab:"tinymce.colorpicker.named_tab",named_title:"tinymce.colorpicker.named_title",color:"Colour",name:"tinymce.colorpicker.name",apply:"tinymce.colorpicker.apply"},hints:{drafts:"Hint: Confluence saves drafts automatically. If you ever lose a window, recover your work from the \"Username -> Drafts\" menu.",dnd:"Hint: you can drag and drop images and Office files from your computer right into this editor.",insert_link_recently_viewed:"Hint: type \"\u003cstrong>[\u003c\/strong>\" to see a list of suggested pages and insert a link.",insert_link_search:"Hint: type \"\u003cstrong>[\u003c\/strong>\" and part of a page title to find and link to that page.",insert_link_end:"Hint: press \u003cstrong>Ctrl+Shift+K\u003c\/strong> after a word to find and link to relevant pages. Press it again for more suggestions.",insert_link_newpage:"Hint: type \"\u003cstrong>[\u003c\/strong>\" and the title of a new page you wish to create, to see an insert link suggestion.",insert_link_user_mention:"Hint: you can mention somebody in Confluence by typing \"\u003cstrong>@\u003c\/strong>\" and then their name.",insert_image_on_page:"Hint: type \"\u003cstrong>!\u003c\/strong>\" to see images attached to the page and insert one of them.",insert_image_search:"Hint: type \"\u003cstrong>!\u003c\/strong>\" and part of an image name to find and insert the image.",insert_image_end:"Hint: press \u003cstrong>Ctrl+Shift+M\u003c\/strong> after a word to find and insert relevant images.",insert_wikimarkup:"Hint: the Editor will automatically convert wiki markup as you type it.",insert_wikimarkup_dialog:"Hint: press \u003cstrong>Ctrl+Shift+D\u003c\/strong> to open the Wiki Markup dialog.",insert_link:"Hint: press \u003cstrong>Ctrl+K\u003c\/strong> to open the link browser.",insert_image:"Hint: press \u003cstrong>Ctrl+M\u003c\/strong> to open the image browser.",insert_macro:"Hint: press \u003cstrong>Ctrl+Shift+A\u003c\/strong> to open the macro browser.",insert_macro_toc:"Hint: Let Confluence generate you a table of contents for this page. Use \"Insert -> Table of contents\"",insert_bullet_list:"Hint: press \u003cstrong>Ctrl+Shift+B\u003c\/strong> to start a bullet list.",insert_numbered_list:"Hint: press \u003cstrong>Ctrl+Shift+N\u003c\/strong> to start a numbered list.",insert_heading:"Hint: press \u003cstrong>Ctrl+1\u003c\/strong> to create a heading level 1, \u003cstrong>Ctrl+2\u003c\/strong> for heading level 2 and so on.",insert_table:"Hint: press \u003cstrong>Ctrl+Shift+I\u003c\/strong> to insert a table.",table_rows_copy:"Hint: press \u003cstrong>Ctrl+Shift+C\u003c\/strong> to copy a row and \u003cstrong>Ctrl+Shift+V\u003c\/strong> to paste a row in a table.",table_rows_cut:"Hint: press \u003cstrong>Ctrl+Shift+X\u003c\/strong> to cut a row and \u003cstrong>Ctrl+Shift+V\u003c\/strong> to paste a row in a table.",insert_newline:"Hint: Type \u003cstrong>Shift+Enter\u003c\/strong> to insert a new paragraph without spacing",autoformat_heading1:"Hint: Type \"\u003cstrong>h1. Title\u003c\/strong>\" to quickly insert a Heading 1.",autoformat_heading3:"Hint: Type \"\u003cstrong>h3. Title\u003c\/strong>\" to quickly insert a Heading 3.",autoformat_code:"Hint: Type \"\u003cstrong>{{code}}\u003c\/strong>\" to quickly insert monospaced text."},auiwindowmanager:{cancel:"Cancel",ok:"OK"},propertypanel:{links_goto:"Go to link",links_edit:"Edit",links_unlink:"Unlink",links_goto_disabled_tooltip:"This link goes to content on the page you are editing",links_edit_tooltip:"Edit link in a dialogue",links_unlink_tooltip:"Replace link with the text it contains",images_small:"Small",images_medium:"Medium",images_large:"Large",images_original:"Original",images_border:"Border",images_link_create:"Link",images_link_edit:"Edit link",images_link_remove:"Unlink",images_link_create_tooltip:"Link this image to other content",images_link_edit_tooltip:"Edit the link for this image",images_link_remove_tooltip:"Remove the link for this image",images_sizing_tooltip:"Resize image to a specific width",images_small_tooltip:"Resize image to small and link to the original",images_medium_tooltip:"Resize image to medium and link to the original",images_large_tooltip:"Resize image to large and link to the original",images_original_tooltip:"Reset image size to original",images_thumbnail_tooltip:"tinymce.propertypanel.images.thumbnail.tooltip",images_border_tooltip:"Display a border around image"}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-confluence.js' */
tinymce.confluence=tinymce.confluence||{};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-breadcrumbs.js' */
(function(A){AJS.bind("init.rte",function(){if(AJS.Meta.get("content-type")!=="comment"){var D=A("#quickedit-breadcrumbs");
if(D.length>0){A("#breadcrumbs").detach();
D.attr("id","breadcrumbs");
A("#breadcrumb-section").append(D)
}var E=A(".edited-page-title").parent().detach();
function B(){var F=A("#breadcrumbs");
F.detach();
if(!F.find(".edited-page-title").length&&E.length){F.append(E)
}A("#editor-precursor .cell").prepend(F)
}function C(){var F=A("#breadcrumbs").detach();
E.detach();
A("#breadcrumb-section").append(F)
}B();
A(document).bind("mode-changed",function(F,G){if(G==="preview"){C()
}else{if(G==="richtext"){B()
}}})
}})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-node-utils.js' */
(function(B){var A;
tinymce.confluence.NodeUtils=A={updateNode:function(F,D){var C=tinymce.activeEditor,E=B(F,C.getDoc());
var G=A.prepareNodeForUpdate(E);
return A.replaceNode(E,D).fail(G).promise()
},storeNodeState:function(E,F){var D={},C;
for(var G=0,H=F.length;
G<H;
G++){C=F[G];
D[C]=E.attr(C)
}return function(){for(var I in D){E.attr(I,D[I])
}}
},prepareNodeForUpdate:function(C){var D=null;
if(C.is("img")){D=A.storeNodeState(C,["width","height","src","class"]);
C.addClass("image-hotswap").attr({src:Confluence.getContextPath()+"/images/border/spacer.gif",width:C.attr("width"),height:C.attr("height")})
}return D
},replaceNode:function(H,E){var C=tinymce.activeEditor,G=A.getDoc(),D=B(E,G),F=B(H,G);
return B.Deferred(function(){var I=this;
if(D.is("img")){D[0].onload=function(){AJS.log("replaceNode: new node's src has been loaded by the browser.");
this.onload=null;
I.resolve(this)
};
if(B.browser.opera){D[0].src=D.attr("src")
}G.createDocumentFragment().appendChild(D[0])
}else{I.resolve(D[0])
}}).done(function(I){F.replaceWith(I)
}).promise()
},replaceSelection:function(F){var E=tinymce.activeEditor,D=E.selection.getRng(true),H,G,C;
if(B.browser.msie&&~~B.browser.version<9){C=D
}else{C=E.getDoc().createRange()
}H=B(F).clone(true,false)[0];
D.deleteContents();
if(D.startContainer.nodeType==3&&D.startContainer.nodeValue===""){D.startContainer.nodeValue=AJS.Rte.HIDDEN_CHAR
}D.insertNode(H);
if(B.browser.msie&&~~B.browser.version<9){G=H
}else{var I=E.getDoc().createTextNode(AJS.Rte.HIDDEN_CHAR);
E.dom.insertAfter(I,H);
G=I
}C.setStartBefore(G);
C.setEndAfter(G);
C.collapse(false);
E.selection.setRng(C);
return H
},normalize:function(H){var F=tinymce.activeEditor,E=F.selection.getRng(true),G,C=[],D,J;
if(!H||!H.childNodes){return 
}function I(L){var M=[],K=0;
B.each(L.childNodes,function(N,Q){var P={},O=(M[N-1]||{});
P.isTextNode=(Q.nodeType==3);
P.textNodesBefore=((P.isTextNode&&O.isTextNode)?1:0)+~~O.textNodesBefore;
P.precedingTextLength=K;
K=(P.isTextNode)?K+Q.nodeValue.length:0;
M.push(P)
});
return M
}if(tinymce.isWebKit){G=E
}else{if(tinymce.isGecko){G=E.cloneRange();
D={startIndex:B.inArray(E.startContainer,H.childNodes),startOffset:G.startOffset,endIndex:B.inArray(E.endContainer,H.childNodes),endOffset:G.endOffset};
if(D.startIndex>-1||D.endIndex>-1){C=I(H)
}}}H.normalize();
if(tinymce.isGecko){if(J=C[D.startIndex]){D.newStartIndex=D.startIndex-J.textNodesBefore;
D.newStartOffset=D.startOffset+J.precedingTextLength;
G.setStart(H.childNodes[D.newStartIndex],D.newStartOffset)
}if(J=C[D.endIndex]){D.newEndIndex=D.endIndex-J.textNodesBefore;
D.newEndOffset=D.endOffset+J.precedingTextLength;
G.setEnd(H.childNodes[D.newEndIndex],D.newEndOffset)
}}G&&F.selection.setRng(G)
},getDoc:function(){var C=tinymce.activeEditor;
return(B.browser.mozilla||B.browser.opera)?document:C.getDoc()
},isolateSelectedRange:function(){var I=tinymce.activeEditor,M=A.getDoc(),N=I.selection,C=N.getRng(true);
var E=C.startContainer,J=C.startOffset,G=C.endContainer,L=C.endOffset,P;
var H,D;
if(C.collapsed){return C
}function F(Q,T,V,X){var U=null,S=null,W,R,Y;
X=(X)?true:false;
W=(X)?"nextSibling":"previousSibling";
R=(T===0);
if(!R&&X){if(Q.nodeType===3){R=(T===Q.length)
}else{R=(T===Q.childNodes.length)
}}if(R){U=Q[W];
S=Q;
while(U===null){if(S===V){return 
}else{if(S.parentNode===V){break
}}S=S.parentNode;
U=S[W]
}}else{if(Q.nodeType===3){Y=Q.data;
Q.data=Y.slice(T);
U=M.createTextNode(Y.slice(0,T));
S=Q;
B(U).insertBefore(S);
if(X){Y=S;
S=U;
U=Y
}}else{S=Q.childNodes[T-(X?1:0)];
U=S[W]
}}return[S,U]
}function O(X,Q,R,U){var S,W,V,T;
U=(U)?true:false;
while(true){if(Q===R||Q.parentNode===R){break
}W=Q.parentNode;
S=W.cloneNode(false);
if(U){B(S).insertAfter(W);
V=X;
while(V){T=V.nextSibling;
S.appendChild(V);
V=T
}}else{B(S).insertBefore(W);
V=W.firstChild;
while(V!==Q){T=V.nextSibling;
S.appendChild(V);
V=T
}}X=S;
Q=W
}return Q
}function K(V,U,T){var S,R,Q;
S=I.dom.getParent(V,I.dom.isBlock);
if(!S){S=I.getBody()
}R=F(V,U,S,T);
if(!R){Q=undefined
}else{if(!R[1]){Q=R[0]
}else{Q=O(R[1],R[0],S,T)
}}return Q
}if(E===G){P=L-J
}H=K(E,J);
H&&C.setStartBefore(H);
if(E!==C.startContainer){L=P||L
}D=K(G,L,true);
D&&C.setEndAfter(D);
N.setRng(C);
return C
}}
}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/wiki-autoformat.js' */
AJS.bind("init.rte",function(E,V){AJS.Rte.autoformat={_REGEXES:{WIKI_MACRO:/(?:\s|^)(\{[^{^}]+)$/,WIKI_LINK:/(?:\s|^)(\[[^\[^\]]+)$/,WIKI_EMBED:/(?:\s|^)(![^!]{5,})$/}};
var O;
if(AJS.Meta.get("remote-user")&&AJS.Meta.get("confluence.prefs.editor.disable.autoformat")){return 
}function P(X){return AJS.$("<div>").append(X.cloneNode(true)).html()
}function I(X,Y,Z){var d,b;
if(!Y){throw new Error("text node is null")
}if(Y.nodeType!=3){Y=Y.childNodes[Z-1];
Z=Y.length
}for(var c=Y,a=Z;
c&&c.nodeType==3;
c=c.previousSibling){if(a==-1){a=c.nodeValue.length
}if(a>X){return{container:c,offset:a-X}
}else{if(a==X){b=0;
d=c.parentNode;
while(c=c.previousSibling){b++
}return{container:d,offset:b}
}else{X-=a;
a=-1
}}}return null
}function N(Y){var Z,a;
if(!Y||!Y.collapsed){throw new Error("range is null or not collapsed")
}Z=Y.startContainer;
a=Y.startOffset;
if(Z.nodeType==1&&a>0){Z=Z.childNodes[Y.startOffset-1];
if(Z.nodeType==3){a=Z.nodeValue.length
}else{return""
}}else{if(Z.nodeType!=3){return""
}}var X=Z.nodeValue.substring(0,a);
for(var b=Z.previousSibling;
b&&b.nodeType==3;
b=b.previousSibling){X=b.nodeValue+X
}return X
}function M(Z,a,Y,X){return{handles:function(d){var b=false,c=d.selection.getRng(true),e=c.commonAncestorContainer||{};
if(!c.collapsed){return false
}if(AJS.$(e).closest("pre,.text-placeholder").length){return false
}if(X&&AJS.$(e).closest(X).length){return false
}b=Z.test(N(c));
return b
},execute:function(g,c,k){var d,b,f,h=1,e,i,j=D(c);
if(j==32){g.execCommand("mceInsertContent",false,"&nbsp;")
}else{g.execCommand("mceInsertContent",false,String.fromCharCode(j))
}g.undoManager.beforeChange();
g.undoManager.add();
d=g.selection.getRng(true);
b=N(d);
if(b[b.length-1]=="|"){b+=" ";
h=0
}f=Z.exec(b.substring(0,b.length-1));
e=I(f[1].length+h,d.commonAncestorContainer,d.startOffset);
d.setStart(e.container,e.offset);
i=AJS.$(d.commonAncestorContainer);
g.selection.setRng(d);
if(i.closest(".wysiwyg-macro-body").length&&d.toString()==i.text()){i[0].innerHTML="<br>";
g.selection.select(i[0].childNodes[0]);
g.selection.collapse(true)
}else{g.execCommand("delete",false,{},{skip_undo:true})
}a(f,g.selection.getRng(true));
O=g.selection.getRng(true);
if(Y){k.preventDefault();
k.stopPropagation();
tinymce.dom.Event.cancel(c);
AJS.Rte.showElement(O.startContainer);
return false
}}}
}function D(X){return AJS.$.browser.msie?X.keyCode:X.which
}function G(){this.handlers={}
}G.prototype={registerHandler:function(Y,X){if(!this.handlers[Y]){this.handlers[Y]=[]
}this.handlers[Y].push(X)
},executeHandlers:function(b,a,Z,Y){var X=true;
AJS.$.each(this.handlers[b]||[],function(c,d){if(d.handles(a)){X=d.execute(a,Z,Y);
return false
}});
return X
}};
var F=V.editor,H=new G();
function J(b,f,a,c,Y,X){var d=b.charCodeAt(0),Z=AJS.Rte.getResourceUrlPrefix()+"/images/icons/emoticons/"+Y,e;
e=M(f,function(){var g=F.dom.createHTML("img",{src:Z,alt:F.getLang(c),title:F.getLang(c),border:0,"class":"emoticon emoticon-"+a,"data-emoticon-name":a});
F.execCommand("mceInsertContent",false,g,{skip_undo:true})
},true);
this.imagePath=Z;
H.registerHandler(d,e)
}var K=[new J(")",/(:-?)$/,"smile","emotions_dlg.smile","smile.png"),new J("(",/(:-?)$/,"sad","emotions_dlg.sad","sad.png"),new J("P",/(:-?)$/,"cheeky","emotions_dlg.tongue","tongue.png"),new J("p",/(:-?)$/,"cheeky","emotions_dlg.tongue","tongue.png"),new J("D",/(:-?)$/,"laugh","emotions_dlg.biggrin","biggrin.png"),new J(")",/(;-?)$/,"wink","emotions_dlg.wink","wink.png"),new J(")",/(\(y)$/,"thumbs-up","emotions_dlg.thumbs_up","thumbs_up.png"),new J(")",/(\(n)$/,"thumbs-down","emotions_dlg.thumbs_down","thumbs_down.png"),new J(")",/(\(i)$/,"information","emotions_dlg.information","information.png"),new J(")",/(\(\/)$/,"tick","emotions_dlg.check","check.png"),new J(")",/(\(x)$/,"cross","emotions_dlg.error","error.png"),new J(")",/(\(!)$/,"warning","emotions_dlg.warning","warning.png"),new J(")",/(\(\+)$/,"plus","emotions_dlg.add","add.png"),new J(")",/(\(-)$/,"minus","emotions_dlg.forbidden","forbidden.png"),new J(")",/(\(\?)$/,"question","emotions_dlg.help_16","help_16.png"),new J(")",/(\(on)$/,"light-on","emotions_dlg.lightbulb_on","lightbulb_on.png"),new J(")",/(\(off)$/,"light-off","emotions_dlg.lightbulb","lightbulb.png"),new J(")",/(\(\*)$/,"yellow-star","emotions_dlg.star_yellow","star_yellow.png"),new J(")",/(\(\*y)$/,"yellow-star","emotions_dlg.star_yellow","star_yellow.png"),new J(")",/(\(\*r)$/,"red-star","emotions_dlg.star_red","star_red.png"),new J(")",/(\(\*g)$/,"green-star","emotions_dlg.star_green","star_green.png"),new J(")",/(\(\*b)$/,"blue-star","emotions_dlg.star_blue","star_blue.png"),new J("3",/(<)$/,"heart","emotions_dlg.heart","heart.png"),new J("3",/(<\/)$/,"broken-heart","emotions_dlg.broken_heart","broken_heart.png")];
var L=new Array();
for(var R=0;
R<K.length;
R++){L[R]=new Image();
L[R].src=K[R].imagePath
}function C(a,Y){var Z=F.formatter.get(a)[0],X=F.dom.create(Z.inline,{style:Z.styles});
X.appendChild(document.createTextNode(Y+"{$caret}"));
F.execCommand("mceInsertContent",false,P(X),{skip_undo:true});
F.formatter.remove(a)
}var W={"*":"bold",_:"italic","~":"subscript","^":"superscript","+":"underline","-":"strikethrough"};
AJS.$.each(W,function(X,Z){var Y=new RegExp("(?:[\\s\\xA0\\u200b\\uFEFF]+|^)(\\"+X+"(?=[^\\s"+X+"])([^"+X+"]*?[^\\s]))$");
H.registerHandler(X.charCodeAt(0),M(Y,function(a){C(Z,a[2])
},true))
});
F.formatter.register("code",{inline:"code"});
H.registerHandler("}".charCodeAt(0),M(/(?:[\s\xA0\u200b]+|^)({{(?=[^\s])([^}]*?[^\s])})$/,function(X){C("code",X[2])
},true));
for(var R=1;
R<=6;
R++){(function(X){H.registerHandler(" ".charCodeAt(0),M(new RegExp("^\\u200b?(h"+X+"\\.)$"),function(){F.execCommand("formatBlock",false,"h"+X,{skip_undo:true})
},true))
})(R)
}H.registerHandler(" ".charCodeAt(0),M(/^\u200b?(bq\.)$/,function(){F.execCommand("formatBlock",false,"blockquote",{skip_undo:true})
},true));
H.registerHandler(" ".charCodeAt(0),M(/^\u200b?(\*)$/,function(){F.plugins.lists.applyList("UL","OL")
},true));
H.registerHandler(" ".charCodeAt(0),M(/^\u200b?(\#)$/,function(){F.plugins.lists.applyList("OL","UL")
},true));
H.registerHandler(" ".charCodeAt(0),M(/^\u200b?(1\.)$/,function(){F.plugins.lists.applyList("OL","UL")
},true));
H.registerHandler(" ".charCodeAt(0),M(/^\u200b?(\-)$/,function(){var Y=F.dom,X;
F.plugins.lists.applyList("UL","OL");
X=Y.getParent(F.selection.getNode(),"OL,UL");
if(X){Y.setStyles(X,{listStyleType:"square"});
X.removeAttribute("data-mce-style")
}},true));
if(AJS.Rte.Support.inlineTasks()){H.registerHandler("]".charCodeAt(0),M(/^\u200b?(\[)$/,function(){F.plugins.lists.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:"Type task here and @mention a user to assign them the task"})
},true))
}H.registerHandler(" ".charCodeAt(0),M(/[^-]*[\s](\-\-\-?)$/,function(X){var Y=X[1].length===2?"\u2013":"\u2014";
F.execCommand("mceInsertContent",false,Y,{skip_undo:true})
},false));
var U=M(/(([^\s-]+)(\-\-\-?)([^\s-]+))$/,function(X){var Y=X[3].length===2?"\u2013":"\u2014";
F.execCommand("mceInsertContent",false,X[2]+Y+X[4],{skip_undo:true})
},false);
H.registerHandler(" ".charCodeAt(0),U);
H.registerHandler(13,U);
var B=M(/^\u200b?(\-\-\-\-)$/,function(){F.execCommand("mceInsertContent",false,"<hr />",{skip_undo:true})
},true);
H.registerHandler(" ".charCodeAt(0),B);
H.registerHandler(13,B);
H.registerHandler(13,M(/(^\u200b?\|\|\s*(?:[^|]*\s?\|\|\s?)+$)/,function(Z){var c="<table class='confluenceTable'><tr>",b="",X=true,d=AJS.$(Z[1].slice(2,-2).split("||")).map(function(e){e=AJS.$.trim(this);
X=X&&e=="";
return e
});
if(X){d[0]="first cell"
}for(var a=0,Y=d.length;
a<Y;
a++){c+="<th class='confluenceTh'>"+d[a]+"</th>";
b+="<td class='confluenceTd'>"+AJS.Rte.ZERO_WIDTH_WHITESPACE+"</td>"
}c+="</tr><tr>"+b+"</tr></table>";
F.execCommand("mceInsertContent",false,c,{skip_undo:true});
F.selection.select(AJS.$(F.selection.getRng(true).commonAncestorContainer).parents("table").find(X?"th":"td")[0].childNodes[0]);
AJS.$(F.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus()
},true));
H.registerHandler(13,M(/(^\u200b?\|\s?(?:[^|]*\s?\|\s?)+$)/,function(Z){var b="<table class='confluenceTable'><tr>",X=true,c=AJS.$(Z[1].slice(1,-1).split("|")).map(function(d){d=AJS.$.trim(this);
X=X&&d=="";
return d
});
if(X){c[0]="first cell"
}for(var a=0,Y=c.length;
a<Y;
a++){b+="<td class='confluenceTd'>"+c[a]+"</td>"
}b+="</tr></table>";
F.execCommand("mceInsertContent",false,b,{skip_undo:true});
X&&F.selection.select(AJS.$(F.selection.getRng(true).commonAncestorContainer).parents("table").find("td")[0].childNodes[0]);
AJS.$(F.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus()
},true));
var Q=M(/\b(((https?|ftp):\/\/|(www\.))[\w\.\$\-_\+!\*'\(\),/\?:@=&%#~;\[\]]+)$/,function(X){var Y=X[3]?X[1]:"http://"+X[1],Z=F.dom.create("a",{href:Y});
Z.appendChild(document.createTextNode(X[1]));
F.execCommand("mceInsertContent",false,P(Z),{skip_undo:true});
F.getDoc().execCommand("unlink",false,{})
},false,"a");
H.registerHandler(" ".charCodeAt(0),Q);
H.registerHandler(13,Q);
var A=M(/\b((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)$/i,function(X){var Y=F.dom.create("a",{href:"mailto:"+X[1]});
Y.appendChild(document.createTextNode(X[1]));
F.execCommand("mceInsertContent",false,P(Y),{skip_undo:true});
F.getDoc().execCommand("unlink",false,{})
},false,"a");
H.registerHandler(" ".charCodeAt(0),A);
H.registerHandler(13,A);
var S=M(/(?:\b|^)([Jj]ira)$/,function(){F.execCommand("mceInsertContent",false,"JIRA",{skip_undo:true})
},false);
H.registerHandler(" ".charCodeAt(0),S);
H.registerHandler(13,S);
var T={"]":AJS.Rte.autoformat._REGEXES.WIKI_LINK,"}":AJS.Rte.autoformat._REGEXES.WIKI_MACRO,"!":AJS.Rte.autoformat._REGEXES.WIKI_EMBED};
AJS.$.each(T,function(X,Y){H.registerHandler(X.charCodeAt(0),M(Y,function(Z,b){var a=Z[1]+X;
var c={type:"POST",contentType:"application/json; charset=utf-8",url:AJS.Meta.get("context-path")+"/rest/tinymce/1/wikixhtmlconverter",data:AJS.$.toJSON({wiki:a,entityId:AJS.Meta.get("content-id"),spaceKey:AJS.Meta.get("space-key"),suppressFirstParagraph:true}),dataType:"text",timeout:5000};
if(X=="}"){tinymce.confluence.MacroUtils.insertMacro(c)
}else{if(X=="!"){AJS.$.ajax(c).done(function(d){if(!a===d){tinymce.confluence.ImageUtils.insertImagePlaceholder(d)
}else{F.execCommand("mceInsertContent",false,d,{skip_undo:true})
}})
}else{AJS.$.ajax(c).done(function(d){F.execCommand("mceInsertContent",false,d,{skip_undo:true})
})
}}},true))
});
F.onKeyPress.addToTop(function(Y,X){return H.executeHandlers(D(X),Y,X,E)
})
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/tinyMce-table-toolbar.js' */
AJS.$(document).bind("initContextToolbars.Toolbar",function(F,D){var C,B=function(M){var N=D.getLang(M),L=D.getLang(M+"_shortcut","");
if(L){N+=" ("+L+")"
}return N
},E=function(M){var L=AJS.$(M).closest("table:not(.wysiwyg-macro)");
return L.length
},H=function(M){function L(O,N){return parseInt(O.attr(N),10)
}return M.filter(function(O){var N=AJS.$(this);
return L(N,"rowspan")>1||L(N,"colspan")>1
}).length>=1
},K=function(M){var N=AJS.$(M).closest("td,th"),L=AJS.$(".mceSelected",N.closest("table"));
if(H(N.add(L))){D.plugins.customtoolbar.enableToolbarButton("table-split-cells")
}else{D.plugins.customtoolbar.disableToolbarButton("table-split-cells")
}},J=AJS.storageManager("atlassian.editor","tables");
D.onNodeChange.add(function(O,M,P){var L=AJS.$("body");
var N=!L.hasClass("no-tools")||L.hasClass("no-tools-toolbars-visible");
if((!C)&&(P.parentNode!=null)&&(P.nodeName!="BODY")){C=true;
if(E(P)){AJS.$(document).trigger("createContextToolbarRow.Toolbar",{buttons:Confluence.Editor.tableToolbar.Buttons,topToolbar:true,animate:N}).trigger("enableContextToolbarRow.Toolbar");
K(P)
}else{AJS.$(document).trigger("disableContextToolbarRow.Toolbar",{animate:N})
}C=false
}});
D.onUndo.add(function(M,L,N){M.nodeChanged()
});
function A(){var L=AJS.$("<ul/>").addClass("table-highlight-picker");
var N=["grey","red","green","blue","yellow",""];
var M=[false,false,false,false,false,true];
AJS.$.each(N,function(P,R){var O=AJS.$("<li/>");
var Q=AJS.$('<a href="#"></a>');
if(M[P]){Q.addClass("remove-highlight").attr("data-remove-highlight",true)
}else{Q.addClass("highlight-"+R).attr("data-highlight-colour",R)
}O.append(Q);
L.append(O)
});
return L
}function G(P){var L=AJS.$(this);
var O=AJS.$("#table-highlight-group");
var Q=O.attr("data-highlight-colour");
var N=O.attr("data-remove-highlight");
if(Q){O.removeClass("highlight-"+Q);
O.removeAttr("data-highlight-colour")
}O.removeClass("remove-highlight");
if(N){O.removeAttr("data-remove-highlight")
}var M=L.attr("data-highlight-colour");
if(M){O.addClass("highlight-"+M);
O.attr("data-highlight-colour",M)
}if(L.attr("data-remove-highlight")){O.addClass("remove-highlight");
O.attr("data-remove-highlight",true)
}D.focus();
D.execCommand("confTableSelectionToggleHighlight",false,{alwaysHighlight:true});
P.preventDefault()
}AJS.$(document).delegate("#table-highlight-colour .aui-dropdown a","click",G);
var I="table-";
Confluence.Editor.tableToolbar={Buttons:[new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.row_before_desc"),iconClass:I+"insert-row-before",click:function(){tinyMCE.execCommand("mceTableInsertRowBefore",false,"")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.row_after_desc"),iconClass:I+"insert-row-after",click:function(){tinyMCE.execCommand("mceTableInsertRowAfter",false,"")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.delete_row_desc"),iconClass:I+"delete-row",click:function(){tinyMCE.execCommand("mceTableDeleteRow",false,"")
}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.cut_row_desc"),iconClass:I+"cut",click:function(){tinyMCE.execCommand("mceTableCutRow",false,"");
D.plugins.customtoolbar.enableToolbarButton("table-paste")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.copy_row_desc"),iconClass:I+"copy",click:function(){tinyMCE.execCommand("mceTableCopyRow",false,"");
D.plugins.customtoolbar.enableToolbarButton("table-paste")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.paste_row_before_desc"),iconClass:I+"paste",click:function(){tinyMCE.execCommand("mceTablePasteRowBefore",false,"")
},disabled:!J.doesContain("copied")})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.col_before_desc"),iconClass:I+"insert-column-before",click:function(){tinyMCE.execCommand("mceTableInsertColBefore",false,"")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.col_after_desc"),iconClass:I+"insert-column-after",click:function(){tinyMCE.execCommand("mceTableInsertColAfter",false,"")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.delete_col_desc"),iconClass:I+"delete-column",click:function(){tinyMCE.execCommand("mceTableDeleteCol",false,"")
}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.merge_cells_desc"),iconClass:I+"merge-cells",click:function(){tinyMCE.execCommand("mceTableMergeCells",false,"")
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.split_cells_desc"),iconClass:I+"split-cells",click:function(){tinyMCE.execCommand("mceTableSplitCells",false,"")
}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.row_highlight"),iconClass:I+"heading-row",click:function(){tinyMCE.execCommand("confTableRowToggleHeading",false)
}}),new Confluence.Editor.Toolbar.Components.Button({text:B("table.col_highlight"),iconClass:I+"heading-column",click:function(){tinyMCE.execCommand("confTableColumnToggleHeading",false)
}})]),new Confluence.Editor.Toolbar.Components.SplitGroup([new Confluence.Editor.Toolbar.Components.Button({text:B("table.selection_highlight"),iconClass:I+"highlight-selection",click:function(){tinyMCE.execCommand("confTableSelectionToggleHighlight",false)
}})],{id:"table-highlight-group",dropDownOptions:{id:"table-highlight-colour",dropDownContent:A(),alignment:"right"},postProcess:function(M){M.attr("data-highlight-colour","grey");
M.addClass("highlight-grey");
var L=AJS.$("<span>&nbsp;</span>");
L.addClass("highlight-indicator");
M.find(".icon.table-highlight-selection").after(L)
}}),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:B("table.del"),iconClass:I+"delete-table",click:function(){tinyMCE.execCommand("mceTableDelete",false,"")
}})])],Events:[]}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/editor_plugin_src.js' */
(function(F){function R(){var a=F("#rte-button-source-mode");
a.click(function(){if(a.hasClass("active")){Confluence.Editor.changeMode(Confluence.Editor.MODE_RICHTEXT)
}else{Confluence.Editor.changeMode(Confluence.Editor.MODE_SOURCE)
}})
}function A(a,b){F(document).trigger("initContextToolbars.Toolbar",b);
F(document).bind("createContextToolbarRow.Toolbar",S).bind("removeContextToolbarRow.Toolbar",I).bind("enableContextToolbarRow.Toolbar",J).bind("disableContextToolbarRow.Toolbar",X);
a.addEventsForComponent("TableToolbar",Confluence.Editor.tableToolbar.Events)
}function M(c,b){var a=function(){b&&b.hide()
};
F(document).bind("showLayer",function(g,d,f){if(d=="dropdown"&&f==b){c.onClick.add(a);
c.onKeyUp.add(a)
}}).bind("hideLayer",function(g,d,f){if(d=="dropdown"&&f==b){c.onClick.remove(a);
c.onKeyUp.remove(a)
}})
}function T(a){a.addCallback("show",function(){if(a.$.parents(".disabled").length){a.hide()
}})
}function L(c){var e=F("#color-picker-control");
if(!e.length){return 
}var f=e.find(".aui-dd-parent"),a=F("#rte-button-color"),b=a.find(".selected-color"),g=f.dropDown("Standard",{alignment:"left"})[0],d=a.attr("data-color");
b.css("background-color","#"+d);
e.delegate("a[data-color]","click",function(j){var i=F(this),h=i.attr("data-color");
j.preventDefault();
if(i.closest(".disabled").length){return 
}tinyMCE.execCommand("ForeColor",false,"#"+h);
a.attr("data-color",h);
b.css("background-color","#"+h)
});
T(g);
C(f,g,160);
M(c,g)
}function H(a){AJS.Rte.TablePicker.bindToControl(a,F("#insert-table-dropdown"))
}function C(c,a,d){var b=false;
if(F.browser.msie&&parseInt(F.browser.version,10)==7){a.addCallback("show",function(){if(!b){var f=0,e=F(c).find(".aui-dropdown");
F(e).width("auto");
if(d){F(e).width(d)
}else{F(e).find(".item-link").each(function(h,g){f=Math.max(f,F(this).outerWidth(true))
});
F(e).width(f+20)
}b=true;
a.show()
}})
}}function D(a,c,b){var f=c.attr("data-macro-name"),g=c.attr("data-command"),e=c.attr("data-format"),d=c.attr("data-control-id");
if(f){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked({presetMacroName:f})
}if(g){a.execCommand(g,false)
}if(e){a.theme.controlHandlers.formatselect["click"].dispatch(e)
}if(d){a.theme.controlHandlers.buttons["click"].dispatch(d)
}}function J(c,a){var b=W(a);
F("#"+b).removeClass("disabled")
}function X(c,a){var b=W(a);
F("#"+b).addClass("disabled")
}function G(a){E(F("."+a.replace(".","")),true)
}function P(a){E(F("."+a.replace(".","")),false)
}function E(b,a){if(a){b.closest(".aui-button").prop("disabled",true).attr("aria-disabled","true")
}else{b.closest(".aui-button").prop("disabled",false).removeAttr("aria-disabled")
}}function U(a){var b=F("."+a.replace(".",""));
return !b.closest(".aui-button").prop("disabled")
}function O(a){F("."+a.replace(".","")).closest(".aui-button").focus()
}function Z(c){var a=W({id:c});
var b=F("#"+a);
if(b.length){return b[0]
}else{return null
}}var Y=function(){var e=function(h){h=F(h).closest("PRE,BLOCKQUOTE,.text-placeholder");
return function(i){return h.is(i)
}
},g=F("#toolbar").find("li.toolbar-item"),c=F("#insert-menu, #more-menu"),b=F("#insert-menu, #color-picker-control"),a=F("#format-dropdown"),f="disabled",d=function(h,i){g.toggleClass(f,h);
c.toggleClass(f,h);
b.toggleClass(f,h);
a.toggleClass(f,!!i);
AJS.Rte.TablePicker[h?"disable":"enable"]()
};
return function(j,h,o){var m=e(o),i=m("BLOCKQUOTE"),k=m("PRE"),l=m(".text-placeholder"),n;
if(k){n=F(o).parents("table").is("[data-macro-body-type='PLAIN_TEXT']");
d(true,n)
}else{if(l){d(true)
}else{if(i){h.setDisabled("justifyleft",i);
h.setDisabled("justifycenter",i);
h.setDisabled("justifyright",i)
}else{d(false)
}}}}
};
function W(a){var b="default";
if(a&&a.id){b=a.id
}return"rte-toolbar-row-"+b
}function N(a){return F("#"+a).length>0
}function K(a){var a=W({id:a});
return N(a)&&!F("#"+a).hasClass("disabled")
}var V;
function I(c,b){var a=b.animate;
if(a==undefined){a=true
}var d=function(){F(this).remove();
F(document).trigger("resize.resizeplugin");
if(b.onHide){b.onHide()
}};
clearTimeout(V);
V=setTimeout(function(){var e=W(b);
var f=F("#"+e);
if(a){f.slideUp(400,d)
}else{f.hide();
d.call(f)
}},100)
}function S(g,n){var h=W(n);
var b=n.animate;
if(b==undefined){b=true
}if(N(h)){return 
}var m=F("<div></div>").addClass("toolbar-split toolbar-split-row toolbar-contextual"),k;
m.attr("id",h);
if(n.editorAdjacent){m.addClass("editor-adjacent")
}var j=!n.topToolbar?F("#savebar-container .aui-toolbar"):F("#rte-toolbar.aui-toolbar");
for(var f=0,c=n.buttons.length;
f<c;
f++){m.append(n.buttons[f].render())
}m.css({display:"none"});
if(n.editorAdjacent){j.append(m)
}else{var d=F(".editor-adjacent",j).filter(":first");
if(d.length){d.before(m)
}else{j.append(m)
}}m.find(".toolbar-dropdown").each(function(){B(tinymce.activeEditor,this)
});
var l=function(){F(document).trigger("resize.resizeplugin").trigger("shown.contextToolbar");
if(n.onVisible){n.onVisible()
}};
clearTimeout(V);
V=setTimeout(function(){if(b){m.slideDown(400,l)
}else{m.show();
l()
}},100)
}function B(a,d){var b=F(d),c=b.dropDown("Standard",{alignment:b.data("dropdown-alignment")||"left"})[0];
b.find(".dropdown-item").click(function(g){var f=F(this);
D(a,f,g);
c.hide();
g.preventDefault()
});
T(c);
C(b,c);
M(a,c)
}function Q(a){var d=[];
for(var e in TinyMCELang.hints){d.push("hints."+e)
}var c=Confluence.hintManager(d);
var b=function(){F("#rte-savebar .hints-text").html(a.getLang(c.getNextHint()))
};
b();
F("#rte-savebar a.hints-close").click(function(f){F(this).closest(".toolbar-split").addClass("hidden");
f.preventDefault()
});
F("#rte-savebar a.hints-next").click(function(f){b();
f.preventDefault()
})
}tinymce.create("tinymce.plugins.customtoolbar",{init:function(a){B(a,"#format-dropdown");
B(a,"#more-menu .aui-dd-parent");
B(a,"#insert-menu .aui-dd-parent");
if(F("#pagelayout-menu").length){B(a,"#pagelayout-menu .aui-dd-parent")
}if(F("#template-menu").length){B(a,"#template-menu .aui-dd-parent")
}L(a);
H(a);
R();
Q(a);
F("#rte-button-attachments").click(function(d){tinyMCE.activeEditor.execCommand("mceConfAttachments",false)
});
A(AJS.Rte.EventDelegator(a),a);
var c=F("#format-dropdown"),b=c.find("span.dropdown-text");
a.onBeforeExecCommand.add(function(h,f,l,e,d){F.each(["pre","blockquote"],function(){if(f=="FormatBlock"&&e==this){h.formatter.remove("alignleft");
h.formatter.remove("aligncenter");
h.formatter.remove("alignright")
}});
if(F(h.selection.getNode()).closest("pre,.text-placeholder").length){var j=["Bold","Italic","Underline","Strikethrough","InsertUnorderedList","InsertOrderedList","InsertInlineTaskList","InsertInlineTaskListNoToggle","superscript","subscript","mceConfMacroBrowser","mceConfimage","mceConfAttachments","mceEmotion","InsertWikiMarkup","mceConflink","mceInsertTable","mceConfAutocompleteLink"];
var m=j.length;
for(var g=0;
g<m;
g++){if(f==j[g]){d.terminate=true
}}}if((f=="FormatBlock")&&(e=="pre")){h.undoManager.add();
h.execCommand("removeFormat")
}if(f=="FormatBlock"&&e=="p"){var k=c.find(".dropdown-item[data-format='blockquote']").text();
if(b.text()==k){d.terminate=true;
h.execCommand("FormatBlock",false,"blockquote")
}}else{if(f=="FormatBlock"&&e=="removeformat"&&h.selection.isCollapsed()){d.terminate=true;
AJS.log("Not removing format for no selected text")
}}});
a.onExecCommand.add(function(d,g,f,i,e){if(g=="FormatBlock"){var h=c.find(".dropdown-item[data-format='"+i+"']");
if(!h.length){h=c.find(".dropdown-item[data-format='p']")
}b.text(h.text())
}});
a.onNodeChange.add(Y());
a.onInit.add(function(d){AJS.log("customtoolbar: ed.onInit function");
var e={};
F(".aui-toolbar").find("[data-control-id]").each(function(g,f){var h,k,j;
f=F(f);
h=f.closest(".toolbar-item");
k=f.attr("data-control-id");
if(k=="formatselect"){j=d.theme.controlHandlers[k];
j.state.add(function(i){if(i=="p"){var m=d.selection.getNode();
if(F(m).closest("p").parent().is("blockquote")){i="blockquote"
}}var l=c.find(".dropdown-item[data-format='"+i+"']").text();
if(l){b.text(l)
}})
}else{e[k]=f
}});
control=d.theme.controlHandlers.buttons;
control.state.add(function(j,i,f){var g=e[j];
if(!g){return 
}var h=g.find(".icon-check");
toolbarItem=g.closest(".toolbar-item");
if(!h.length){toolbarItem.toggleClass(i,f)
}else{h.toggleClass("hidden",!f)
}});
F(".aui-toolbar").delegate(".toolbar-item","click",function(h){var f=F(this);
if(!f.hasClass("disabled")){var g=f.children(".toolbar-trigger[data-control-id]").attr("data-control-id");
if(g){control.click.dispatch(g);
h.preventDefault()
}}else{h.preventDefault()
}});
AJS.$.support.shrinkWrapBlocks=false;
AJS.log("customtoolbar: finished ed.onInit function")
})
},disableToolbarButton:G,enableToolbarButton:P,focusToolbarButton:O,isToolbarRowEnabled:K,getToolbarRow:Z,isToolbarButtonEnabled:U,bindDropdownMenu:B,getInfo:function(){return{longname:"customtoolbar",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com/",version:"1.0"}
}});
tinymce.PluginManager.add("customtoolbar",tinymce.plugins.customtoolbar)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/custom-toolbar-components.js' */
Confluence.Editor.Toolbar={Components:{}};
Confluence.Editor.Toolbar.Components.Button=function(B){var G=B.text;
var F=B.tooltip;
var E=B.triggerText;
var A=B.iconClass;
var D=B.click;
var C=!!B.disabled;
var H=B.id;
this.render=function(){var J=AJS.$('<button type="button"></button>').addClass("aui-button").attr("data-tooltip",F||G);
if(H){J.attr("id",H)
}if(C){J.prop("disabled",true).attr("aria-disabled","true")
}J.click(function(L){if(!J.prop("disabled")){D()
}});
if(A){var K=AJS.$("<span />");
K.addClass("icon "+A);
K.text(G);
J.append(K)
}if(E){var I=AJS.$("<span />");
I.addClass("trigger-text");
I.text(E);
J.append(I)
}return J[0]
}
};
Confluence.Editor.Toolbar.Components.DropDownButton=function(D){var G=D.id;
var F=D.text;
var A=D.iconClass;
var E=!!D.disabled;
var C=D.dropDownContent;
var B;
this.render=function(){var H=AJS.$("<div></div>").addClass("toolbar-item").addClass("toolbar-dropdown").attr("data-tooltip",F);
H.attr("id",G);
var K=AJS.$("<div/>").addClass("aui-dd-parent");
var I=AJS.$("<a href='#'></a>");
I.addClass("toolbar-trigger").addClass("aui-dd-trigger");
if(E){H.addClass("disabled");
I.addClass("disabled")
}if(A){var J=AJS.$("<span />");
J.addClass("icon "+A);
J.text(F);
I.append(J)
}var L=AJS.$("<span/>");
L.addClass("icon").addClass("icon-dropdown");
I.append(L);
B=AJS.$("<div/>").addClass("hidden").addClass("aui-dropdown").addClass("aui-dropdown-right");
if(C){B.append(C)
}K.append(I);
K.append(B);
H.append(K);
return H[0]
}
};
Confluence.Editor.Toolbar.Components.TextButton=function(B){var F=B.text;
var A=B.textClass;
var D=B.click;
var C=!!B.disabled;
var E=B.tooltip;
this.render=function(){var G=AJS.$('<button type="button"></button>').addClass("aui-button").addClass(A).text(F);
if(E){G.attr("data-tooltip",E)
}if(C){G.prop("disabled",true).attr("aria-disabled","true")
}G.click(function(H){if(!G.prop("disabled")){D()
}});
return G[0]
}
};
Confluence.Editor.Toolbar.Components.TextBox=function(C){var F=C.id;
var E=C.text;
var B=C.name;
var D=C.keydown;
var A=C.cssClass;
this.render=function(){var H=AJS.$("<div></div>").addClass("toolbar-item");
H.append(AJS.$("<label for='"+F+"'>"+E+"</label>"));
var G=AJS.$("<input id='"+F+"' type='text' name='"+B+"' class='"+A+" text' autocomplete='off'>");
G.keydown(function(I){D(I)
});
H.append(G);
return H[0]
}
};
Confluence.Editor.Toolbar.Components.Group=function(C,A){var B=C;
this.render=function(){var F=AJS.$("<div></div>");
F.addClass("aui-buttons");
if(A){A.id&&F.attr("id",A.id);
A.groupClass&&F.addClass(A.groupClass)
}for(var D=0,E=B.length;
D<E;
D++){F.append(B[D].render())
}return F[0]
}
};
Confluence.Editor.Toolbar.Components.SplitGroup=function(E,B){var D=E;
var A=(B&&B.dropDownOptions)||{};
function C(){var G=A.id;
var H=A.disabled;
var F=A.dropDownContent;
var L=A.title;
var J=A.alignment;
var O;
var N=AJS.$("<div></div>").addClass("toolbar-item").addClass("toolbar-dropdown").addClass("toolbar-splitbutton");
G&&N.attr("id",G);
L&&N.attr({"data-tooltip":L});
J&&N.data("dropdown-alignment",J);
var M=AJS.$("<div/>").addClass("aui-dd-parent");
var K=AJS.$("<a href='#'></a>");
K.addClass("toolbar-trigger aui-dd-trigger");
if(H){N.addClass("disabled");
K.addClass("disabled")
}var I=AJS.$("<span/>");
I.addClass("icon").addClass("icon-dropdown");
K.append(I);
O=AJS.$("<div/>").addClass("hidden").addClass("aui-dropdown");
if(F){O.append(F)
}M.append(K);
M.append(O);
N.append(M);
return N[0]
}this.render=function(){var H=AJS.$("<div></div>");
H.addClass("aui-buttons");
if(B){B.id&&H.attr("id",B.id);
B.groupClass&&H.addClass(B.groupClass)
}for(var F=0,G=D.length;
F<G;
F++){H.append(D[F].render())
}H.append(C(B));
B&&B.postProcess&&B.postProcess(H);
return H[0]
}
};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/thirdpartycode/tipsy.js' */
(function(A){A.fn.tipsy.autoBounds2=function(C,B){return function(){var D={},G=A(document).scrollTop()+C,E=A(document).scrollLeft()+C,F=A(this);
if(B.length>1){D.ns=B[0];
D.ew=B[1]
}else{if(B[0]=="e"||B[0]=="w"){D.ew=B[0]
}else{D.ns=B[0]
}}if(F.offset().top<G){D.ns="n"
}if(F.offset().left<E){D.ew="w"
}if(A(window).width()+A(document).scrollLeft()-(F.offset().left+F.width())<C){D.ew="e"
}if(A(window).height()+A(document).scrollTop()-(F.offset().top+F.height())<C){D.ns="s"
}if(D.ns){return D.ns+(D.ew?D.ew:"")
}return D.ew
}
}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/chunky-tips.js' */
(function(A){AJS.bind("init.rte",function(){AJS.log("Enabling Chunky Tooltip for the editor");
function F(){return A(this).attr("data-tooltip")||""
}var G={live:true,gravity:"n",title:F,delayIn:250,delayOut:0};
var J=A.fn.tipsy.autoBounds2(50,"n");
var D=A.fn.tipsy.autoBounds2(50,"s");
var B=A.fn.tipsy.autoBounds2(50,"w");
var L=A.extend({},G,{gravity:J});
var H=A.extend({},G,{gravity:D});
var E=A.extend({},G,{gravity:B});
A("#rte-toolbar [data-tooltip]:not(.dropdown-item)").tooltip(L);
A("#rte-toolbar .dropdown-item[data-tooltip]").tooltip(E);
A("#rte-savebar [data-tooltip]").tooltip(H);
A("#property-panel [data-tooltip]").tooltip(L);
function C(P,N,O){if(N==="dropdown"){A(".tipsy").remove();
if(O&&O.trigger&&O.trigger.jquery){var M=O.trigger.data("tipsy");
if(M){M.hoverState="out"
}}}}AJS.$(document).bind("showLayer",C);
AJS.$(document).bind("hideLayer",C);
function I(P,O,N,M){A(".tipsy").remove()
}AJS.bind("created.property-panel",I);
AJS.bind("destroyed.property-panel",I);
var K=/\+/g;
AJS.bind("register-contexts.keyboardshortcuts",function(){setTimeout(function(){AJS.$("#rte-savebar .aui-button[title]").each(function(){var M=A(this);
var O=M.attr("title");
M.removeAttr("title");
if(tinymce.isMac){var N=O.indexOf("(");
if(N>=0){O=O.substr(0,N)+O.substr(N).replace(K,"")
}}M.attr("data-tooltip",O)
})
},0)
})
})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepaste/post-paste-node-filter.js' */
(function(H){var M=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/,P=/((([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\b/;
function K(U,X){var S=H(U).find("["+X+"]"),W="",R="",Q="";
for(var T=0,V=S.length;
T<V;
T++){W=H(S[T]);
R=W&&["/",W.attr(X)].join("");
Q=W&&["/",W.attr("data-mce-"+X)].join("");
if(Confluence.getContextPath()&&R.indexOf(Confluence.getContextPath())===0){S[T]=W.attr(X,R)
}if(Confluence.getContextPath()&&Q.indexOf(Confluence.getContextPath())===0){S[T]=W.attr("data-mce-"+X,Q)
}}return S
}function N(Y,T){var S=[],U="",W,V=Y.attr("style"),Q=Y.attr("data-mce-style");
for(var R=0,X=T.length;
R<X;
R++){if(V&&V.toLowerCase().indexOf(T[R])>-1){S.push(T[R]+": "+Y.css(T[R])+";")
}else{if(Q&&Q.toLowerCase().indexOf(T[R])>-1){U=new RegExp(T[R]+":.+?(?:;|$)");
W=Q.match(U);
S.push(W[0].indexOf(";")>-1?W:W+";")
}}}return S.join(" ")
}function L(V,U,Q){var T=[];
if(Q){for(var R=0,S=Q.length;
R<S;
R++){if(V.is("["+U+"~="+Q[R]+"]")){T.push(Q[R])
}}}return T.join(" ")
}function E(T,Q,W){var X=H(T).find("["+Q+"]"),V="",Z,R;
if(X){for(var U=0,Y=X.length;
U<Y;
U++){Z=H(X[U]);
R=W.standard;
for(var S in W){if(W.hasOwnProperty(S)&&Z.is(S)){R=W[S]
}}if(Q.indexOf("style")>-1){V=N(Z,R)
}else{V=L(Z,Q,R)
}Z.removeAttr(Q);
if(V.length){Z.attr(Q,V)
}}}}function D(R,Q){var S={};
S.standard=["text-decoration","text-align","margin-left"];
S[".wysiwyg-macro"]=["background-image"];
S.p=["margin-left","text-align"];
S.span=["color","text-decoration"];
S.pre=["margin-left"];
S.td=S.th=["text-align"];
if(Q.indexOf("style")>-1){E(R,"style",S);
E(R,"data-mce-style",S)
}if(H.browser.mozilla){if(Q.indexOf("src")>-1){K(R,"src")
}if(Q.indexOf("href")>-1){K(R,"href")
}}E(R,"face",{standard:[]});
E(R,"id",{standard:[]});
E(R,"data-mce-href",{standard:[]});
return R
}function C(R,Q){H(Q,R).contents().unwrap()
}function G(R){var S,Q;
S=H(R);
Q="<p>"+S.html().replace(/<br>/gi,"</p><p>")+"</p>";
S.html(Q)
}function I(Q){var R=H(Q);
return R.children("br").length&&!R.find(":not(br)").length
}function O(R){var Q=[".contentLayout",".contentLayout2",".columnLayout",".header",".footer",".cell",".innerCell",".panelContent",".panel",".panelHeader",".Apple-converted-space","font",".jira-status",".jira-issue",".diff-html-removed",".diff-html-added",".diff-html-changed"];
H.each(Q,function(T,S){C(R,S)
});
H("img",R).map(function(){!H(this).attr("src")&&H(this).remove()
});
H("dl",R).map(function(){H(this).replaceWith("<p>"+H(this).text()+"</p>")
})
}function B(T,Q){var R,U;
function S(X){var W,V;
if(R.index){V=T.splitText(R.index);
T&&Q.push(T);
T=V
}W=T.splitText(R[0].length);
W&&Q.push(W);
H(T).wrap("<a href='"+X+T.data+"'></a>")
}if(R=M.exec(T.data)){U=R&&R[0].indexOf("://")==-1?"http://":"";
S(U)
}else{if(R=P.exec(T.data)){U="mailto:";
S(U)
}}}function F(S){var Q=H.makeArray(S.childNodes),R;
while(Q.length){R=Q.pop();
if(!H(R).is("a")){if(R.nodeType==3){B(R,Q)
}else{if(R.nodeType==1&&R.childNodes&&R.nodeName.toLowerCase()!=="pre"){Q=Q.concat(H.makeArray(R.childNodes))
}}}}}function J(R){var Q=H(R).find("li[data-inline-task-id]");
Q.each(function(){var T=H(this),S=T.parent();
if(!S.is("ul")){S.wrapInner('<ul class="inline-task-list"/>')
}else{if(!S.hasClass("inline-task-list")){S.addClass("inline-task-list")
}}})
}function A(R){J(R);
var T=AJS.Meta.get("content-type"),S=H(R).find("ul.inline-task-list"),Q=S.find("> li");
if(T=="comment"){Q.removeClass("checked").removeAttr("data-inline-task-id");
S.removeClass("inline-task-list")
}else{Q.attr("data-pasted-task","true")
}}H(document).bind("postPaste",function(R,Q,S){D(S.node,"style,src,href");
A(S.node);
O(S.node);
if(!H.browser.msie){F(S.node)
}if(H.browser.mozilla&&I(S.node)){G(S.node)
}})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepaste/clipboard-helper.js' */
(function(B){var A;
AJS.ClipboardHelper=A=function(){var C=[{repair:function(E){var D=/<meta charset='utf-8'>(<td.*<\/td>)<br class="Apple-interchange-newline">/,F=D.exec(E);
if(!F){return E
}else{return'<table class="confluenceTable"><tbody><tr>'+F[1]+"</tr></tbody></table>"
}}},{repair:function(D){var E=/<meta charset='utf-8'>(<tr.*<\/tr>)<br class="Apple-interchange-newline">/,F=E.exec(D);
if(!F){return D
}else{return'<table class="confluenceTable"><tbody>'+F[1]+"</tbody></table>"
}}}];
return{parse:function(D,E){if(D.charAt(0)==="<"&&D.charAt(D.length-1)===">"&&D.length>=3){return B(D,E||document)
}else{return B("<div>"+D+"</div>",E||document).contents()
}},repair:function(D){if(!D){return D
}B.each(C,function(E,F){D=F.repair(D)
});
return D
}}
}()
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepastetable/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfluencePasteTablePlugin",{init:function(B){B.onInit.add(function(){function G(J){return !J.tagName?false:J.tagName=="TABLE"?true:J.tagName=="TR"?true:J.tagName=="TH"?true:J.tagName=="TD"?true:J.tagName=="TBODY"?true:J.tagName=="THEAD"?true:J.tagName=="TFOOT"?true:J.tagName=="COL"?true:J.tagName=="COLGROUP"?true:J.tagName=="CAPTION"
}function F(J){return !J.tagName?"":J.tagName=="TABLE"?"confluenceTable":J.tagName=="TH"?"confluenceTh":J.tagName=="TD"?"confluenceTd":""
}function I(J){var K="";
if(J&&J.getAttribute){K=J.getAttribute("class")
}return !J.tagName?false:J.tagName!="TABLE"?false:!K?false:K.indexOf("wysiwyg-macro")!==-1
}function E(J){var K;
if(J&&J.getAttribute){K=J.getAttribute("class")
}return K&&K.indexOf("table-wrap")>=0
}function H(M){var Q={id:true,"class":true,style:true,rowspan:true,colspan:true,"data-mce-style":true,"data-mce-bogus":true,"data-macro-name":true,"data-macro-parameters":true,"data-macro-body-type":true,"data-highlight-colour":true,"data-highlight-class":true},U=["highlight","nohighlight"],K,P=0,O=[],T,N,S=A(M);
if(!M||I(M)){return M
}if(E(M)){var J=A("table",M);
if(J.length){A(J).unwrap();
M=J[0]
}else{return null
}}if(G(M)&&M.attributes){while(P<=M.attributes.length){K=M.attributes[P];
if(K&&K.specified===true&&!Q[K.name]){M.removeAttribute(K.name)
}else{P++
}}F(M)&&O.push(F(M));
for(var L=0,R=U.length;
L<R;
L++){if(U[L].exec){}else{S.hasClass(U[L])&&O.push(U[L])
}}T=S.attr("data-highlight-class");
T&&O.push(T);
N=S.attr("data-highlight-colour");
N&&O.push("highlight-"+N);
S.attr("class",O.join(" "))
}return M
}function D(K,J){return J.parentNode===K
}function C(J,M){var L=J,K="";
while(true){if(!L){break
}if(typeof M=="function"){L=M(L)
}if(!L){break
}else{if(L.firstChild&&!D(L,K)&&!I(L)){K=L;
L=L.firstChild
}else{if(L.nextSibling){K=L;
L=L.nextSibling
}else{K=L;
L=L.parentNode
}}}}return J
}A(document).bind("postPaste",function(K,J,L){L.node=C(L.node,H)
})
})
},getInfo:function(){return{longname:"ConfluencePasteTablePlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("confluencepastetableplugin",tinymce.plugins.ConfluencePasteTablePlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepastemacro/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfluencePasteMacroPlugin",{init:function(B){var C=this;
B.onInit.add(function(){A(document).bind("postPaste",function(H,E,I){var D=B.getDoc(),G,F;
if(A(B.selection.getStart()).closest("[data-macro-body-type='PLAIN_TEXT']").length){C.bindPostSerializeHandler(B);
G=C.parseHtml(B,I.node);
F=D.createElement("div");
F.appendChild(G);
I.node=F
}})
})
},bindPostSerializeHandler:function(D){var B=D.serializer.onPostProcess;
function C(E,F){F.content=F.content.replace(/^<pre>|<\/pre>$/g,"");
B.remove(C)
}B.add(C)
},parseHtml:function(D,F){var C=A.makeArray(F.childNodes),H,E,B=D.getDoc(),G=B.createElement("pre");
while(C.length){H=C.shift();
if(H.childNodes.length){tinymce.html.Schema.blockElementsMap[H.nodeName]&&C.unshift(B.createElement("br"));
C=A.makeArray(H.childNodes).concat(C)
}else{E=this.formatMacroContent(H,B);
E&&G.appendChild(E)
}}return G
},formatMacroContent:function(D,B){var E,F=3,C=/\xA0/g;
B=B||window.document;
if(D.nodeType==F){E=B.createTextNode(A(D).text().replace(C," "))
}else{if(D.nodeName=="BR"){E=B.createElement("br")
}}return E
},getInfo:function(){return{longname:"ConfluencePasteMacroPlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("confluencepastemacroplugin",tinymce.plugins.ConfluencePasteMacroPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confcursortarget/editor_plugin_src.js' */
(function(B){var A=".wysiwyg-macro,.placeholder,table";
AJS.Rte=AJS.Rte||{};
AJS.Rte.CursorTarget={addFixSelector:function(C){A+=","+C
}};
tinymce.create("tinymce.plugins.CursorTargetPlugin",{init:function(H,G){var T=true;
var I="ol, ul, p, pre, table, blockquote, div, h1, h2, h3, h4, h5, h6";
function V(Y){B(A,Y).each(function(Z,a){E(a)
})
}function L(Z){var Y=(tinyMCE.isIE)?"&nbsp;":"<br/>";
function a(b){return b&&b.childNodes&&b.childNodes.length===1&&b.childNodes[0].nodeType==3&&b.childNodes[0].nodeValue&&b.childNodes[0].nodeValue.length===1&&b.childNodes[0].nodeValue.charCodeAt(0)==160
}B("p, td.confluenceTd, th.confluenceTh",Z).each(function(b,c){if(a(c)){B(c).html(Y)
}})
}function E(b){var Z=B(b);
function a(f){if(f.length===0){throw new Error("no paragraph element specified")
}var e=f[0];
if(e.childNodes.length===0){if(tinymce.isIE&&!tinymce.isIE9){e.innerHTML="&nbsp;"
}else{e.innerHTML="<br />"
}}return e
}function c(e){return !B(e).is(I)
}function Y(f,e){var g=B("<p/>");
if(B(f.parentNode).is("li, td, th")){while(f[e]&&c(f[e])){g[e=="previousSibling"?"prepend":"append"](f[e])
}}return a(g)
}if(!Z.prev().length||Z.prev(A).length||(B(b.parentNode).is("li, td, th")&&c(b.previousSibling))){Z.before(Y(b,"previousSibling"))
}if(!Z.next().length||Z.next(A).length||(B(b.parentNode).is("li, td, th")&&c(b.nextSibling))){Z.after(Y(b,"nextSibling"))
}function d(i){function j(k){if(k[0].nodeName=="BR"||N(k[0])){k.replaceWith(a(B("<p/>")))
}}function g(l){var k=l.next();
while(k.length&&!k.is(A)){var m=k[0];
if(m.nodeName!="BR"&&m.nodeName!="P"){return false
}k=k.next()
}return true
}function h(l){var k=l.prev();
while(k.length&&!k.is(A)){var m=k[0];
if(m.nodeName!="BR"&&m.nodeName!="P"){return false
}k=k.prev()
}return true
}var f=i.prev();
if(f.length&&h(f)){j(f)
}var e=i.next();
if(e.length&&g(e)){j(e)
}}d(Z)
}function J(Y){B("p",Y).each(function(Z,a){if(N(a)&&P(a)){B(a).attr("data-tag","marked-for-deletion")
}});
B("p[data-tag=marked-for-deletion]",Y).remove();
return Y
}function N(Y){function Z(b){var c=0,d=0;
for(var f=0,a=b.childNodes.length;
f<a;
f++){var e=b.childNodes[f];
if(e.nodeName=="BR"){if(++c>1){return false
}}else{if(/^[\s|\u00A0]$/.test(e.nodeValue)){if(++d>1){return false
}}else{if(e.nodeValue!==""){return false
}}}}return true
}return Y.nodeType==1&&Y.childNodes.length===0||Z(Y)
}function P(c){if(!c||c.nodeType!=1){return false
}var b=O(c,false);
var a=O(c,true);
var Z=W(b)||B(b).is(A);
var Y=W(a)||B(a).is(A);
var d=W(b)&&W(a);
return Z&&Y&&!d
}function W(Y){if(!Y){return true
}else{return Y.className&&/cell|header|footer/.test(Y.className)
}}function O(b,a){var Y=".cell, .mceContentBody, td, li";
var c=B(b);
do{var Z=(a)?c[0].nextSibling:c[0].previousSibling;
if(Z){return Z
}c=c.parent()
}while(c.length>0&&!c.is(Y));
return null
}function M(Y){var Z=Y.startContainer;
if(Z.nodeType==3){var a=Z.previousSibling&&(Z.previousSibling.nodeType==3||B(Z.previousSibling).is("br"));
return !a&&Y.startOffset===0
}else{if(Z.nodeType==1){return Y.startOffset===0
}}return false
}function C(Z){var Y=H.getBody();
if(Y.childNodes.length){return Z.collapsed&&Z.startOffset===0&&Y.childNodes[0]==Z.startContainer
}return false
}function K(Z){var a=Z.startContainer;
if(a.nodeType==3){var Y=a.nextSibling&&(a.nextSibling.nodeType==3||B(a.nextSibling).is("br"));
return !Y&&Z.endOffset==a.nodeValue.length
}else{if(a.nodeType==1){var b=a.childNodes[Z.startOffset];
if(B(b).is("br")&&b.nextSibling==null){return true
}else{return Z.endOffset==a.childNodes.length
}}}return false
}function X(Y){var a=B(Y).children();
var Z;
for(Z=0;
Z<a.length;
Z++){if(N(a[Z])){continue
}if(B(a[Z]).contents().filter(function(){return this.nodeType==3
}).length||X(a[Z])){return true
}}return false
}function U(a,Y){function Z(c,b){var d=b.startOffset;
if(!c){d--
}return d>=0&&d<b.startContainer.childNodes.length&&b.startContainer.childNodes[d].nodeName=="TABLE"
}return Y.startContainer==Y.endContainer&&Y.startContainer.nodeType==1&&Z(a,Y)
}function S(Y){if(!Y.collapsed){return false
}var a=Y.startContainer,b;
if(a.nodeType==3){b=O(a,true);
return Y.startOffset==a.nodeValue.length&&(b==null||B(b).is("br"))
}else{if(a.nodeType===1){if(B(a).is("td, th")&&Y.startOffset===0&&a.childNodes.length>0){return B(a.childNodes[0]).is("br")
}else{var Z=(Y.startOffset===0)?0:Y.startOffset-1;
b=O(a.parentNode.childNodes[Z],true);
return b==null||B(b).is("br")
}}else{return false
}}}function F(Y){return Y&&Y.childNodes.length===1&&B(Y.childNodes[0]).is("br")
}function D(Z,Y){if(tinymce.isWebKit&&U(false,Y)){return true
}else{if(tinymce.isGecko){if(S(Y)||(P(Z)&&Y.startOffset===0&&F(Z))){return true
}}}return false
}function Q(Z,Y){if(tinymce.isWebKit&&(U(true,Y)||(M(Y)&&P(Z))||C(Y))){return true
}else{if(tinymce.isGecko&&M(Y)&&P(Z)&&F(Z)){return true
}}return false
}function R(Y,a){var Z=a.keyCode;
if(Z!=8&&Z!=46){return true
}if(!Y.selection.isCollapsed()){setTimeout(function(){V(Y.getBody())
},100)
}else{if(Z==8&&Q(Y.selection.getNode(),Y.selection.getRng(T))){tinymce.dom.Event.prevent(a)
}else{if(Z==46&&D(Y.selection.getNode(),Y.selection.getRng(T))){tinymce.dom.Event.prevent(a)
}}}return true
}H.onSetContent.add(function(Y,Z){V(Y.getBody());
L(Y.getBody())
});
H.onGetContent.add(function(Z,b){var d="<div class='root-node'>";
var Y="</div>";
var e=d+b.content+Y;
var c=J(B(e));
var a=AJS.Rte.getEditor().serializer.serialize(c[0],b);
b.content=a.substring(d.length,a.length-Y.length)
});
H.onInit.add(function(){H.selection.onSetContent.add(function(Y,Z){V(H.getBody())
});
H.dom.bind(H.getBody(),"cut",function(Y){setTimeout(function(){V(H.getBody())
},100)
});
AJS.bind("cursor-target-refresh",function(){V(H.getBody())
})
});
if(tinymce.isGecko){H.onKeyDown.add(function(Y,Z){if((Z.keyCode==13||Z.keyCode==8||Z.keyCode==46)){Y.selection.normalize()
}})
}H.onKeyDown.add(R);
H.onKeyUp.add(R);
tinymce.isGecko&&H.onKeyPress.add(R);
H.onPaste.add(function(Y,Z){V(Y.getBody())
});
B.extend(this,{_isTextContainerEmpty:N,_processCursorTargets:J,_isCursorAtStartOfContainer:M,_isCursorAtEndOfContainer:K,_getSiblingWithinBlockDisregardingNesting:O,_doesContainerHaveNestedContent:X,isCursorBeforeAfterTable:U,isCursorTarget:P,_addCursorTargetParagraphsToContent:V,_isCursorAtEndOfBottomRightCellInTable:S,_shouldCancelDelete:D,_shouldCancelBackspace:Q});
AJS.Rte.Cursor=AJS.Rte.Cursor||{};
B.extend(AJS.Rte.Cursor,{isTextContainerEmpty:N,fixCursorTargets:V})
},getInfo:function(){return{longname:"Cursor Target plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("cursorTarget",tinymce.plugins.CursorTargetPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confcleanup/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfluenceCleanupPlugin",{init:function(B){if(tinymce.isWebKit){var C={},E=function(I,G){var H=I[G];
if(!H){H={};
I[G]=H
}return H
},F=function(I){var G=C[I.css("color")],H;
if(G){H=G[I.css("font-weight")];
if(H){return H[I.css("font-size")]
}}return null
};
A("#format-dropdown").find("ul.aui-dropdown li").each(function(){var K=A("a",this),I=K.css("font-size"),L=K.css("font-weight"),G=K.css("color"),H=E(C,G),J=E(H,L);
if(!J[I]){J[I]=A(this).attr("data-format")
}});
B.onNodeChange.add(function(I,K){var L=I.dom.select("span.Apple-style-span",I.dom.doc.body),N=I.dom.select("font.Apple-style-span",I.dom.doc.body),J=L.concat(N);
for(var H=0,O=J.length;
H<O;
H++){if(I.dom.is(J[H],'[face="mceinline"]')){break
}var M=F(A(J[H]));
if(M){var G=I.selection.getBookmark();
M&&I.dom.remove(J[H],1);
I.selection.moveToBookmark(G);
I.execCommand("FormatBlock",false,M)
}}})
}B.onNodeChange.add(function(I){var L="file:///",H=I.dom.select("img",I.dom.doc.body),G=H.length;
for(var K=0;
K<G;
K++){var M=A(H[K]),J=M.attr("src");
if(J.substr(0,L.length)===L){I.dom.remove(H[K])
}}});
if(tinymce.isIE9){function D(G){if(!G.getBody().childNodes.length){G.setContent("<p>\uFEFF</p>")
}}B.onNodeChange.add(D);
B.onSetContent.add(D)
}},getInfo:function(){return{longname:"ConfluenceCleanupPlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("confluencecleanupplugin",tinymce.plugins.ConfluenceCleanupPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMce-auiwindowmanager.js' */
(function(){var G=56;
var B=51;
var F=20;
var A=tinymce.util.Dispatcher,E=tinymce.each,D=tinymce.isIE,C=tinymce.isOpera;
tinymce.create("tinymce.plugins.AUIWindowManager",{init:function(H,I){H.onBeforeRenderUI.add(function(){H.windowManager=new tinymce.AUIWindowManager(H)
})
},getInfo:function(){return{longname:"AUIWindowManager",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.create("tinymce.AUIWindowManager:tinymce.WindowManager",{AUIWindowManager:function(H){var I=this;
I.editor=H;
I.onOpen=new A(I);
I.onClose=new A(I);
I.params={};
I.features={};
I.modalDialogsStack=new Array();
I.dialogs={};
I.count=0
},open:function(J,K){var U=this,N="",Q,P,R,L,H=tinymce.DOM.getViewPort(),T;
J=J||{};
U.initialiseSettings(J);
K=K||{};
R=C?H.w:screen.width;
L=C?H.h:screen.height;
K=this.setDefaultParameters(K);
K.mce_width=J.width;
K.mce_height=J.height;
K.mce_auto_focus=J.auto_focus;
if(D){J.center=true;
J.help=false;
J.dialogWidth=J.width+"px";
J.dialogHeight=J.height+"px"
}U.features=J;
U.params=K;
U.onOpen.dispatch(U,J,K);
var S=J.height;
if(J.name){S+=G
}if(K.cancelLink||K.buttons){S+=B
}S+=(2*F);
if(J.popup){S=S+8
}var I=J.id||tinymce.DOM.uniqueId();
var O=new AJS.ConfluenceDialog({width:J.width,height:S,id:I,onCancel:function(){O.hide().remove()
}});
if(J.name){O.addHeader(this.editor.getLang(J.name))
}this.createDialogButtons(O,K,I);
J.file=J.file||J.url;
if(J.file){J.file=tinymce._addVer(J.file)
}this.createDialogContent(O,J,K,I);
K.helpLink&&this.createHelpLink(O,K.helpLink,K.helpName,I);
K.hintText&&this.createHintText(O,K.hintText,I);
var M={id:I,settings:J,params:K,dialog:O};
this.modalDialogsStack.push(M);
this.dialogs[I]=M;
this.count++;
AJS.Rte.BookmarkManager.storeBookmark();
O.show();
if(O.takeFocus!=undefined){O.takeFocus()
}if(D){AJS.$("#"+I).css("overflow","hidden");
AJS.$("#"+I+" ."+K.cssClass).css("overflow","hidden")
}return I
},initialiseSettings:function(H){H.width=parseInt(H.width||400,10);
H.height=parseInt(H.height||250,10);
H.resizable=false;
if(H.popup==undefined){H.popup=true
}if(H.popup&&H.content!=undefined){H.popup=false
}if(H.scrollbars){H.scrollbars="yes"
}else{H.scrollbars="no"
}},createDialogButtons:function(K,L,H){if(L.buttons){var J=0;
for(J=0;
J<L.buttons.length;
J++){var I=L.buttons[J];
K.addButton(this.editor.getLang(I.label),I.action)
}}if(L.cancelLink){K.addCancel(this.editor.getLang("auiwindowmanager.cancel"),function(){return tinyMCE.activeEditor.windowManager.close(H)
})
}},createDialogContent:function(I,J,K,M){var L=this.createContentId(M);
var H="panel_"+L;
if(J.popup){I.addPanel(H,AJS.$("<iframe id='"+L+"' width='100%' height='"+J.height+"px' frameborder='0' name='auidialogiframe' src='"+J.file+"' scrolling='"+J.scrollbars+"'></iframe>"),K.cssClass);
I.takeFocus=function(){AJS.$("#"+L).focus()
}
}else{if(J.content==undefined){I.addPanel(H,AJS.$("<div id='"+L+"'/>"),K.cssClass);
AJS.$("#"+L).load(J.file)
}else{I.addPanel(H,AJS.$("<div id='"+L+"'>"+J.content+"</div>"),K.cssClass)
}I.takeFocus=function(){var N=AJS.$("#"+L+" :input");
if(N.length){AJS.$(N[0]).focus()
}else{var O=AJS.$("#"+L+" .button-panel button");
if(O.length){AJS.$(O[0]).focus()
}}}
}I.gotoPanel(0,0)
},createHintText:function(H,I,K){var J=AJS.$("<div></div>").addClass("dialog-tip");
J.text(tinyMCE.activeEditor.getLang(I));
AJS.$("#"+K+" .dialog-button-panel").append(J)
},createHelpLink:function(J,I,K,L){var H=AJS.$("<div></div>").addClass("dialog-help-link");
H.load(AJS.params.contextPath+"/plugins/tinymce/helplink.action",{linkUrlKey:I,linkNameKey:(K||"")});
AJS.$("#"+L+" .dialog-components .dialog-title").append(H)
},close:function(J,K){var H;
if(typeof (J)=="string"){H=J
}else{if(K){H=K
}else{var I=this.modalDialogsStack.pop();
if(I){H=I.id
}}}if(!this.dialogs[H]){AJS.log("Couldn't find id "+H+" in dialogs array so dialog is not closed.")
}else{this.count--;
var I=this.dialogs[H];
I.dialog.remove();
this.dialogs[H]=null;
tinyMCE.activeEditor.focus();
AJS.Rte.BookmarkManager.restoreBookmark()
}return false
},alert:function(N,O,J,H){var I={content:"<p>"+N+"</p>",width:500,height:160,popup:false};
var M;
var K=function(){tinyMCE.activeEditor.windowManager.toggleOtherDialogs(M,true);
tinyMCE.activeEditor.windowManager.close(M);
if(O){O.call(J||this)
}};
var L={buttons:[{label:"auiwindowmanager.ok",action:K}],cancelLink:false,cssClass:"tinymce-auidialog-alert"};
M=this.open(I,L);
this.toggleOtherDialogs(M,false)
},createInstance:function(J,I,H,N,M,L){var K=tinymce.resolve(J);
return new K(I,H,N,M,L)
},toggleOtherDialogs:function(K,H){var J=0;
for(J=0;
J<this.modalDialogsStack.length;
J++){var I=this.modalDialogsStack[J];
if(I.id!=K){AJS.$("#"+I.id+" .dialog-button-panel").toggle(H)
}}},confirm:function(J,H,K,I){I=I||window;
H.call(K||this,I.confirm(this._decode(this.editor.getLang(J,J))))
},setBusy:function(H,L){var J=this.dialogs[H];
if(!J){return 
}if(L){var O=this.createContentId(H);
var K=AJS.$("#"+O);
K.hide();
var N=K.parent();
var M=this.createBusyContentId(H);
var I=AJS.$("#"+M,N);
if(!I.length){N.append(AJS.$("<div id='"+M+"' class='spinner'></div>"));
I=AJS.$("#"+M,N);
Raphael.spinner(I[0],50,"#666")
}AJS.$(".button-panel button",AJS.$("#"+H)).each(function(P,Q){AJS.$(Q).prop("disabled",true)
});
AJS.$(I[0]).show()
}else{var M=this.createBusyContentId(H);
var I=AJS.$("#"+M);
if(I.length){AJS.$(I[0]).hide()
}var O=this.createContentId(H);
var K=AJS.$("#"+O);
AJS.$(".button-panel button",AJS.$("#"+H)).each(function(P,Q){AJS.$(Q).prop("disabled",false)
});
AJS.$(K[0]).show()
}},logMCESelection:function(J){var I=tinyMCE.activeEditor.selection;
AJS.log("******************************");
AJS.log("Logging TinyMCE selection title:    "+J);
AJS.log("Bookmark:");
AJS.log(I.getBookmark());
var H=AJS.$(I.getRng().startContainer).text()||$(I.getRng().startContainer.parentNode).text();
AJS.log("Range: "+H);
AJS.log(I.getRng())
},setDefaultParameters:function(H){H.inline=false;
if(!H.cssClass){H.cssClass="tinymce-auidialog"
}if(H.cancelLink!=false){H.cancelLink=true
}return H
},createContentId:function(H){return"content_"+H
},createBusyContentId:function(H){return"content_busy_"+H
}});
tinymce.PluginManager.add("auiwindowmanager",tinymce.plugins.AUIWindowManager)
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMceMacroBrowser.js' */
tinymce.confluence.macrobrowser=(function(A){return{storedRange:null,bookmark:null,getCurrentNode:function(){return A(tinyMCE.activeEditor.selection.getNode())
},isMacroDiv:function(B){return A(B).hasClass("wysiwyg-macro")
},isMacroTag:function(C){var B=A(C);
return B.hasClass("wysiwyg-macro")||B.hasClass("editor-inline-macro")
},isBodylessMacro:function(B){return A(B).hasClass("editor-inline-macro")
},isMacroWithBody:function(B){return A(B).hasClass("wysiwyg-macro")
},isMacroStartTag:function(B){return A(B).hasClass("wysiwyg-macro-starttag")
},isMacroEndTag:function(B){return A(B).hasClass("wysiwyg-macro-endtag")
},isMacroBody:function(B){return A(B).hasClass("wysiwyg-macro-body")
},hasMacroBody:function(B){return A(B).attr("macrohasbody")=="true"
},getNestingMacros:function(C){var B=A(C||this.getCurrentNode());
var D=[];
B.parents(".wysiwyg-macro").each(function(){D.push(A(this).attr("data-macro-name"))
});
return D
},logMCESelection:function(D){var C=tinyMCE.activeEditor.selection;
AJS.log("******************************");
AJS.log("Logging TinyMCE selection title:    "+D);
AJS.log("Bookmark:");
AJS.log(C.getBookmark());
var B=A(C.getRng().startContainer).text()||A(C.getRng().startContainer.parentNode).text();
AJS.log("Range: "+B);
AJS.log(C.getRng())
},getSelectedMacro:function(D){var C=tinymce.confluence.macrobrowser,B=C.getCurrentNode();
AJS.log("getSelectedMacro: $selectionNode="+B[0]);
return C.isMacroDiv(B)?B:tinymce.confluence.MacroUtils.isInMacro(B)
},openMacro:function(B){AJS.MacroBrowser.open({selectedMacro:B,onComplete:tinymce.confluence.macrobrowser.macroBrowserComplete,onCancel:tinymce.confluence.macrobrowser.macroBrowserCancel})
},editMacro:function(B){var C=tinymce.confluence.macrobrowser;
var D=A(B);
C.editedMacroDiv=D[0];
var E=AJS.Rte.getEditor().serializer.serialize(D.clone()[0],{forced_root_block:false});
AJS.Rte.getEditor().selection.select(D[0]);
AJS.Rte.BookmarkManager.storeBookmark();
A.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:AJS.params.contextPath+"/rest/tinymce/1/macro/definition",data:AJS.$.toJSON({contentId:Confluence.getContentId(),macroHtml:E}),dataType:"text",success:function(F){C.openMacro(AJS.$.secureEvalJSON(F))
}})
},macroBrowserToolbarButtonClicked:function(C){var D=tinymce.confluence.macrobrowser,F=tinyMCE.activeEditor,B=D.getCurrentNode();
AJS.Rte.BookmarkManager.storeBookmark();
var E=A.extend({presetMacroName:null,nestingMacros:D.getNestingMacros(B),onComplete:D.macroBrowserComplete,onCancel:D.macroBrowserCancel,mode:"insert",selectedHtml:"",selectedText:""},C);
if(!C.ignoreEditorSelection){E.selectedHtml=F.selection.getContent();
E.selectedText=F.selection.getContent({format:"text"})
}AJS.MacroBrowser.open(E)
},macroBrowserComplete:function(C){var B=tinymce.confluence.macrobrowser,D={contentId:AJS.Meta.get("content-id")||"0",macro:{name:C.name,params:C.params,defaultParameterValue:C.defaultParameterValue,body:C.bodyHtml}};
AJS.Rte.BookmarkManager.restoreBookmark();
if(B.editedMacroDiv){tinymce.confluence.MacroUtils.insertMacro(D,B.editedMacroDiv);
delete B.editedMacroDiv
}else{tinymce.confluence.MacroUtils.insertMacro(D)
}},macroBrowserCancel:function(){var B=tinymce.confluence.macrobrowser;
AJS.Rte.BookmarkManager.restoreBookmark();
B.editedMacroDiv=null;
B.editedMacro=null
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-image-utils.js' */
(function(D){var F=["imagetext","src","align","border","width","height"],A=/\/download\/(thumbnails|attachments)\/([0-9]+)\//,C=function(J){var K=D(J).attr("src"),I=K.match(A);
if(I&&I.length==3){return I[2]
}AJS.log("ERROR: could not parse page id from image url "+K);
return"0"
},E=function(J){var I=J.destination;
if(G.isRemoteImg(I)){return I
}var L="/thumbnails/";
var K="/attachments/";
return(J.thumbnail)?I.replace(K,L):I.replace(L,K)
},B=function(I){return I&&D.nodeName(I,"img")&&D(I).hasClass("confluence-embedded-image")
},H=0,G;
tinymce.confluence.ImageProperties=function(I){if(B(I)){var J=D(I);
I={destination:J.attr("src"),url:J.attr("src"),border:(J.attr("class")&&J.attr("class").indexOf("confluence-content-image-border")!=-1)?1:0,width:J.prop("width"),height:J.prop("height")};
if(!G.isRemoteImg(I.destination)&&(!AJS.$(J).hasClass("confluence-external-resource"))){I.pageId=C(J)
}return D.extend({},I)
}else{if(I.destination){I.imageFileName=I.imageFileName||I.destination;
return D.extend({},I)
}}return null
};
G=tinymce.confluence.ImageUtils={updateImageElement:function(J,I){var M=D(J);
I.src=E(I);
M.toggleClass("confluence-content-image-border",!!I.border);
M.toggleClass("confluence-thumbnail",!!I.thumbnail);
for(var L=0,N=F.length;
L<N;
L++){var K=F[L],O=I[K];
if(O!==false&&O!=null){M.attr(K,O)
}else{M.removeAttr(K)
}}tinyMCE.activeEditor.undoManager.add()
},insertFromProperties:function(I){AJS.$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:AJS.params.contextPath+"/rest/tinymce/1/embed/placeholder/image",data:AJS.$.toJSON(I),dataType:"text",success:G.insertImagePlaceholder})
},insertImagePlaceholder:function(J){var I=tinyMCE.activeEditor,M="_"+(+new Date),L=D("<div></div>").append(D(J).attr("id",M));
I.selection.setContent(L.html());
var K=I.dom.get(M);
I.dom.setAttrib(K,"id","");
D(K).one("load",function(){AJS.Rte.showSelection(function(){AJS.trigger("trigger.property-panel",{elem:K});
I.undoManager.add()
});
I.onChange.dispatch()
})
},isRemoteImg:function(I){var J=AJS.Rte.getCurrentBaseUrl();
return I.match("(https?://)")&&I.indexOf(J)==-1
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-macro-utils.js' */
(function(C){var B;
function A(D){var I=tinymce.confluence.macrobrowser,G=tinymce.activeEditor,H=G.getDoc(),E,F=G.selection.getRng(true);
if(I.isMacroWithBody(D)){!tinymce.isIE&&C("p, pre",D).each(function(){if(this.childNodes.length===0){this.appendChild(H.createElement("br"))
}});
E=G.dom.select(".wysiwyg-macro-body",D)[0].firstChild;
if(E){F.setStart(E,0);
F.setEnd(E,0)
}else{AJS.debug("focusMacroNode: couldn't find anything to focus, cap'n!")
}}else{F.setStartAfter(D);
F.setEndAfter(D)
}G.selection.setRng(F)
}tinymce.confluence.MacroUtils=B={DEFAULT_INSERT_MACRO_TIMEOUT:5000,insertMacro:function(H,J){var G;
if(H.macro&&H.contentId){G={type:"POST",url:Confluence.getContextPath()+"/rest/tinymce/1/macro/placeholder",contentType:"application/json; charset=utf-8",data:C.toJSON(H),dataType:"text"}
}else{if(H.url&&H.type){G=H
}else{throw new Error("illegal argument received: "+H)
}}var D=C.Deferred(),E=AJS.Rte.getEditor(),I,F;
if(!J){F="macro-"+(new Date()).getTime();
I=E.dom.create("span",{id:F});
E.selection.setNode(I);
J=I=E.dom.select("#"+F)[0];
D.fail(function(){C(I).remove()
})
}C.extend(G,{timeout:B.DEFAULT_INSERT_MACRO_TIMEOUT});
AJS.log("Insert macro timeout = "+G.timeout);
Confluence.Editor.UI.setButtonsState(false);
C.ajax(G).done(function(K){if(K[0]!=="<"){K=document.createTextNode(K)
}tinymce.confluence.NodeUtils.updateNode(J,K).done(function(L){D.resolve(L,K)
}).fail(D.reject)
}).fail(function(K,M,L){AJS.log("Macro placeholder request failed "+M+": '"+L+"'");
D.rejectWith(this,arguments)
});
D.done(function(K,L){Confluence.Editor.UI.setButtonsState(true);
if(tinymce.confluence.macrobrowser.isMacroWithBody(K)&&/P|H\d/.test(K.parentNode.nodeName)){E.dom.split(K.parentNode,K)
}A(K);
E.nodeChanged();
AJS.Rte.showElement(K);
E.selection.onSetContent.dispatch(E.selection,{content:L,format:"html"});
tinymce.activeEditor.undoManager.add()
}).fail(function(){Confluence.Editor.UI.setButtonsState(true)
});
return D.promise()
},isInMacro:function(E){var D=E.jquery?E:C(E);
return D.closest(".wysiwyg-macro").length>0
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluence/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfluencePlugin",{init:function(B,C){B.addCommand("mceConfimage",Confluence.Editor.defaultInsertImageDialog);
B.addCommand("mceConfMacroBrowser",tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked);
B.addCommand("mceConfUnlink",function(J,F){var H=AJS.Rte.getEditor(),M=H.selection,E=F||M.getNode(),I=A(E);
if(E.nodeName!="A"){var L=I.closest("a");
if(!L.length){return 
}E=L[0];
I=L
}var D=I.attr("href");
if(!D){D="#";
I.attr("href",D)
}var G=function(O){var N=/(.*)[\/]$/.exec(O);
return N!=null?N[1]:O
};
if(!I.attr("data-linked-resource-id")&&Confluence.Link.isExternalLink(D)&&I.text()==G(D)){var K=H.dom.create("span",{"class":"nolink"},D);
H.dom.replace(K,E,false)
}else{M.select(E);
I.removeClass("createlink unresolved");
H.execCommand("UnLink")
}});
B.addButton("confimage",{title:"confluence.confimage_desc",cmd:"mceConfimage"});
B.addButton("conf_macro_browser",{title:"confluence.conf_macro_browser_desc",cmd:"mceConfMacroBrowser"})
},getInfo:function(){return{longname:"Confluence TinyMCE Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("confluence",tinymce.plugins.ConfluencePlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/macroplaceholder/editor_plugin_src.js' */
(function(A){var B=tinymce.VK;
tinymce.create("tinymce.plugins.MacroPlaceHolderPlugin",{init:function(D){var E=this;
D.onInit.add(function(H){H.selection.onSetContent.add(function(I){tinymce.each(I.dom.select("p > .wysiwyg-macro"),function(K){var L=I.dom.getParent(K.parentNode,"p");
try{I.dom.split(L,K)
}catch(J){}})
})
});
D.onSetContent.add(function(H){tinymce.each(H.dom.select('.wysiwyg-macro[data-macro-body-type="PLAIN_TEXT"] .wysiwyg-macro-body'),function(I){var J=H.dom.select("pre",I);
if(!J.length){if(tinymce.isIE){H.dom.setHTML(I,"<pre></pre>")
}else{H.dom.setHTML(I,"<pre><br /></pre>")
}}})
});
D.onKeyDown.add(function(J,N){var L=J.selection,M,H;
var K=[B.BACKSPACE,B.DELETE,B.ENTER,B.ESCAPE];
function O(P){var Q=false;
if(P.charCode===0){Q=(jQuery.inArray(P.keyCode,[B.SHIFT,B.CTRL,B.ALT,B.META])!=-1)
}return Q
}if(jQuery.inArray(N.keyCode,K)!=-1||O(N)||L.isCollapsed()){return 
}if(N.ctrlKey||N.metaKey||(!tinymce.isMac&&N.altKey)){return 
}M=L.getNode();
if(tinymce.confluence.macrobrowser.isMacroWithBody(M)){var I=A(".wysiwyg-macro-body",M);
if(I.length>0){AJS.debug("MacroPlaceholderPlugin: Adjusting text selection to only include macro's body.");
L.select(I[0],true)
}}});
D.onDblClick.add(function(J,L){var H=A(L.target),I=function(M){return M.closest("[data-macro-name]")
},K=I(H);
if(K.length){AJS.debug("Double-click triggered inside a macro.");
if(K.attr("data-macro-body-type")){if(tinymce.isIE){if(H.hasClass("wysiwyg-macro-body")||H.hasClass("wysiwyg-macro")){AJS.debug("Double-click inside macro body, but its IE so its OK I guess...")
}else{AJS.debug("Double-click was inside bodied macro content, even in IE. Skipping.");
return 
}}else{if(H.closest(".wysiwyg-macro-body").length){AJS.debug("Double-click was inside bodied macro content. Skipping.");
return 
}}}tinymce.confluence.macrobrowser.editMacro(K);
if(AJS.Confluence.PropertyPanel&&AJS.Confluence.PropertyPanel.current){AJS.Confluence.PropertyPanel.destroy()
}}});
D.onNodeChange.addToTop(function(H){var I=H.selection.getNode();
if(I.nodeName=="PRE"&&AJS.$(I).closest(".wysiwyg-macro").length){E._setTinymceControlsState(H,0)
}else{E._setTinymceControlsState(H,1)
}});
D.addCommand("mceConfRemoveMacro",function(H){A(H).remove();
if(tinymce.isGecko){AJS.Rte.getEditor().execCommand("mceRepaint",false)
}});
function C(H){D.onKeyDown.add(H);
if(tinymce.isGecko){D.onKeyPress.add(H);
D.onKeyUp.add(H)
}}function G(I,H){return I&&I.childNodes.length===1&&A(I).is(H)&&A(I.firstChild).is("br")
}function F(H){if(!H.collapsed){return false
}var I=H.startContainer.nodeType==3?H.startContainer.parentNode:H.startContainer;
if(!I||!I.parentNode){return false
}while(I&&!A(I).is(".wysiwyg-macro-body")){if(I.previousSibling||I.nextSibling){return false
}I=I.parentNode
}return true
}E._isCursorInMostNestedElement=F;
(function(){(tinymce.isWebKit||tinymce.isGecko)&&C(function(I,J){if(J.keyCode==46&&H(I.selection.getRng(true))){return tinymce.dom.Event.cancel(J)
}});
function H(I){if(!I.collapsed){return false
}var J=I.startContainer.nodeType==3?I.startContainer.parentNode:I.startContainer;
return J.previousSibling&&!J.nextSibling&&G(J,"p, pre")
}E._isCursorInLastParagraphOrPre=H
})();
(function(){tinymce.isWebKit&&C(function(J,L){if(L.keyCode!=8&&L.keyCode!=46){return true
}var I=J.selection.getRng(true),K=I.startContainer.nodeType==3?I.startContainer.parentNode:I.startContainer;
if(H(I)&&(L.keyCode==8?!A(K).is("li"):true)){return tinymce.dom.Event.cancel(L)
}return true
});
function H(I){if(!I.collapsed){return false
}var J=I.startContainer.nodeType==3?I.startContainer.parentNode:I.startContainer;
return F(I)&&J.childNodes.length===1&&A(J.firstChild).is("br")
}})();
(function(){tinymce.isWebKit&&C(function(I,J){if(J.keyCode!=8){return true
}if(H(I.selection.getRng(true))){I.execCommand("Outdent");
return tinymce.dom.Event.cancel(J)
}return true
});
function H(I){if(!I.collapsed){return false
}var J=I.startContainer.nodeType==3?I.startContainer.parentNode:I.startContainer;
return I.startOffset===0&&A(J).is(".wysiwyg-macro-body > ul > li")&&J.childNodes.length===1&&A(J.firstChild).is("br")
}E._isCursorInsideMacroPlacholderInsideListItemContainingSoloBr=H
})();
(function(){tinymce.isWebKit&&C(function(K,N){if(N.keyCode!=46){return true
}var J=K.selection.getRng(true),L=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(L);
if(H(J)){var M=L.nextSibling;
I.remove();
K.selection.select(M,true);
return tinymce.dom.Event.cancel(N)
}});
function H(J){var K=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(K);
return J.startOffset===0&&G(K,"p, pre")&&I.parent().is("td.wysiwyg-macro-body")&&!K.previousSibling&&K.nextSibling&&G(K.nextSibling,"p, pre")
}E._isCursorInFirstParagraphWhenThereAreTwoEmptyParagraphs=H
})();
(function(){tinymce.isWebKit&&C(function(K,N){if(N.keyCode!=8){return true
}var J=K.selection.getRng(true),M=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(M);
if(H(J)){var L=M.previousSibling;
I.remove();
K.selection.select(L,true);
return tinymce.dom.Event.cancel(N)
}});
function H(J){var K=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(K);
return J.startOffset===0&&G(K,"p, pre")&&I.parent().is("td.wysiwyg-macro-body")&&!K.nextSibling&&K.previousSibling&&!K.previousSibling.previousSibling&&G(K.previousSibling,"p, pre")
}E._isCursorInSecondParagraphWhenThereAreTwoEmptyParagraphs=H
})();
(function(){(tinymce.isWebKit||tinymce.isGecko)&&C(function(I,J){if(J.keyCode!=8&&J.keyCode!=46){return true
}if(H(I.selection.getRng(true))){return tinymce.dom.Event.cancel(J)
}});
function H(J){if(!J.collapsed){return false
}var K=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(K);
if(!K||J.startOffset>0){return false
}tinymce.confluence.NodeUtils.normalize(K);
return K&&J.startOffset===0&&G(K,"p, pre")&&I.parent().is("td.wysiwyg-macro-body")&&!K.previousSibling&&!K.nextSibling
}E._isCursorInSoloParagraphOrPreInsidePlaceholder=H
})();
(function(){function L(M){return M&&M.parentNode&&M.nodeName=="BR"&&M===M.parentNode.lastChild
}(tinymce.isWebKit||tinymce.isGecko)&&C(function(N,P){if(P.keyCode!=8&&P.keyCode!=46){return true
}var M=N.selection.getRng(true),O=M.startContainer.nodeType==3?M.startContainer.parentNode:M.startContainer;
if(!A(O).closest(".wysiwyg-macro-body").size()){return true
}tinymce.confluence.NodeUtils.normalize(O);
if((P.keyCode==46&&(K(M)||I(M)))||(P.keyCode==8&&(H(M)||J(M)))){if(O.lastChild&&!A(O.lastChild).is("br")){A(O).append("<br/>")
}A(O.firstChild).remove();
N.selection.select(O,1);
return tinymce.dom.Event.cancel(P)
}return true
});
function K(M){if(!M.collapsed){return false
}var N=M.startContainer;
return N&&M.startOffset===0&&N.nodeType==3&&F(M)&&N.nodeValue.length===1&&!N.previousSibling&&(!N.nextSibling||L(N.nextSibling))
}function H(M){if(!M.collapsed){return false
}var N=M.startContainer;
return N&&M.startOffset===1&&N.nodeType==3&&F(M)&&N.nodeValue.length===1&&!N.previousSibling&&(!N.nextSibling||L(N.nextSibling))
}function I(M){if(!M.collapsed){return false
}var N=M.startContainer;
return N&&M.startOffset===0&&N.nodeType==1&&N.childNodes.length===1&&F(M)&&!N.previousSibling&&!N.nextSibling
}function J(M){if(!M.collapsed){return false
}var N=M.startContainer;
return N&&M.startOffset===1&&N.nodeType==1&&N.childNodes.length===1&&F(M)&&!N.previousSibling&&!N.nextSibling
}E._isCursorBehindOnlyCharacterInNestedElement=K;
E._isCursorAfterOnlyCharacterInNestedElement=H;
E._isCursorBehindOnlyChildInNestedElement=I;
E._isCursorAfterOnlyChildInNestedElement=J
})();
(function(){tinymce.isWebKit&&C(function(N,O){if(O.keyCode!=8&&O.keyCode!=46){return true
}var M=N.selection.getRng(true);
if(I(M)){var L=A(M.startContainer).closest(".wysiwyg-macro-body");
if(L.length>0){var K=A(L[0].firstChild).is("pre");
N.undoManager.add();
L.empty();
var P;
if(K){P=A("<pre><br/></pre>").appendTo(L)
}else{P=A("<p><br/></p>").appendTo(L)
}N.selection.select(P[0],true);
return tinymce.dom.Event.cancel(O)
}}return true
});
function I(K){if(K.collapsed){return false
}var L=function(N){return !N.previousSibling
};
var M=function(N){return !N.nextSibling
};
return K.startOffset===0&&H(K.startContainer,L)&&J(K.endContainer,K.endOffset)&&H(K.endContainer,M)
}E._isMacroBodySelected=I;
function H(K,L){if(!K){return false
}if(A(K).is(".wysiwyg-macro-body")){return true
}do{if(!L(K)){return false
}K=K.parentNode
}while(K&&!A(K).is(".wysiwyg-macro-body"));
return true
}function J(K,L){if(!K){return false
}if(K.nodeType==3){return L===K.nodeValue.length
}else{if(K.nodeType===1){if(K.childNodes.length===1&&A(K.firstChild).is("br")){return L===0
}else{return L===K.childNodes.length
}}else{return false
}}}})();
(function(){tinymce.isWebKit&&C(function(I,J){if(J.keyCode==46&&H(I.selection.getRng(true))){return tinymce.dom.Event.cancel(J)
}});
function H(J){if(!J.collapsed){return false
}var K=J.startContainer.nodeType==3?J.startContainer.parentNode:J.startContainer,I=A(K);
return J.startOffset===0&&G(K,"p")&&I.next().is("table")
}E._isCursorInEmptyParagraphPrecedingPlaceholder=H
})();
(function(){tinymce.isWebKit&&tinymce.isMac&&C(function(N,O){var L=N.selection.getRng();
if((O.metaKey||O.ctrlKey)&&O.shiftKey&&O.keyCode==B.LEFT){var M=J(L);
if(M!==L){N.selection.setRng(M);
return tinymce.dom.Event.cancel(O)
}}});
function H(L){if(!L||A(L.parentNode).is(".wysiwyg-macro td")){return null
}if(A(L.parentNode).is("p")){return L.parentNode
}return H(L.parentNode)
}function K(L){if(!L){return null
}if(L.nodeType==3){return L
}return K(L.firstChild)||K(L.nextSibling)
}function I(L){if(!L||L.nodeName=="PRE"||L.nodeName=="TD"){return null
}if(L.nodeName=="BR"){return L
}return I(L.previousSibling)||I(L.parentNode)
}function J(L){var M,N;
if(A(L.commonAncestorContainer).closest(".wysiwyg-macro td").length>0){if(!I(L.startContainer)){M=K(H(L.startContainer))
}}if((N=A(L.commonAncestorContainer).closest(".wysiwyg-macro td > pre")).length>0){if(!I(L.startContainer)){M=K(N[0])
}}if(M){L=L.cloneRange();
L.setStart(M,0)
}return L
}E._selectTillStart=J
})();
(function(){D.onKeyDown.add(function(I,L){if(L.keyCode!=tinymce.VK.TAB){return 
}var H=I.selection.getRng(1),K=H.startContainer.nodeType==3?H.startContainer.parentNode:H.startContainer;
if(A(K).is(".wysiwyg-macro-body > pre")){I.undoManager.beforeChange();
I.undoManager.add();
var J=I.getDoc().createTextNode("\t");
H.insertNode(J);
I.selection.setCursorLocation(J,1);
I.undoManager.add();
return tinymce.dom.Event.prevent(L)
}})
})()
},_setTinymceControlsState:function(C,D){tinymce.each(C.controlManager.controls,function(E){E.setDisabled(!D)
})
},getInfo:function(){return{longname:"Macro Place Holder plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("macroplaceholder",tinymce.plugins.MacroPlaceHolderPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/insertwiki/editor_plugin_src.js' */
(function(C,D,B){var A={DEFAULT:null,WIKI:{CONFLUENCE:{val:"CONFLUENCE",label:"Confluence wiki",restApi:"/rest/tinymce/1/wikixhtmlconverter"},MARKDOWN:{val:"MARKDOWN",label:"Markdown",restApi:"/rest/tinymce/1/markdownxhtmlconverter"}}};
var E=new Confluence.localStorageCacheManager("insert-wiki-markup-dialog");
C.create("tinymce.plugins.InsertWikiMarkupPlugin",{init:function(F,G){F.addCommand("InsertWikiMarkup",function(){var J={dialog:{id:"insert-wiki-markup-dialog",content:AJS.DarkFeatures.isEnabled("editor.insert-wiki-markdown")?Confluence.Templates.InsertWiki.wikiMarkupDialog({markupLabel:"Markup",previewLabel:"Preview"}):Confluence.Templates.InsertWiki.originalDefaultTempWikiMarkupDialog(),width:980,height:500,popup:false,name:"confluence.conf_wikimarkup_desc"},markupEditId:"insert-wiki-textarea",previewAreaId:"insert-wiki-textarea-preview",selectionMenuId:"wiki-parser-selection-tool",serverRequestTimer:300,entityId:AJS.Meta.get("content-id"),spaceKey:AJS.Meta.get("space-key")};
A.DEFAULT=A.WIKI[E.get("parser")||"CONFLUENCE"];
var K={getElement:function(U){K[U]=K[U]||D(U);
return K[U]
}};
var S=null;
var R=function(W){var U=D(Confluence.Templates.InsertWiki.wikiParserSelector(A)),V=K.getElement("#"+W).find(".dialog-title");
V.append(U);
V.contents().filter(function(){return this.nodeType===3
}).appendTo(V);
return K.getElement("#"+J.selectionMenuId)
};
var T=function(a){var V=D("#wysiwygTextarea_ifr").contents().find("head").html(),X=Confluence.Templates.InsertWiki.previewWikiIframeContent(),W=D("<iframe />"),Y,Z,U;
K.getElement("#"+a).append(W);
Y=W.contents();
Z=Y[0];
Z.write(X);
Y.find("head").html(V);
S=Y.find("body")
};
var P=function(){var V=K.getElement("#"+J.selectionMenuId),U=V.length?V.val():A.DEFAULT.val;
return U
};
var L=function(){return AJS.params.contextPath+A.WIKI[P()].restApi
};
var H=function(V){V=V||{};
if(V.setBusy){F.windowManager.setBusy(J.dialog.id,true)
}var U={wiki:V.textToConvert,entityId:J.entityId,spaceKey:J.spaceKey};
D.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:V.API,data:D.toJSON(U),dataType:"text",success:V.successCallback,error:V.errorCallback||function(){},timeout:7500})
};
var M=function(V){var U=J.dialog.id;
F.windowManager.setBusy(U,false);
C.EditorManager.activeEditor.windowManager.close(U);
F.execCommand("mceInsertContent",false,V);
O(F)
};
var Q=function(W,Y,X){F.windowManager.setBusy(J.dialog.id,false);
var U={warningMessage:C.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_errors"),exceptionMessage:Y==="timeout"?C.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_timeout"):AJS.escapeHtml(Y)+" : "+AJS.escapeHtml(X)};
var V=Confluence.Templates.InsertWiki.wikiErrorSubDialog(U);
C.EditorManager.activeEditor.windowManager.alert(V)
};
var I=function(){var U=K.getElement("#"+J.markupEditId),V=U.val();
if(!D.trim(V)){S.html(V)
}else{H({API:L(),textToConvert:V,successCallback:function(W){S.html(W)
},errorCallback:function(){S.html(U.val())
}})
}};
var N=function(){E.put("parser",P());
I()
};
var O=function(U,V){C.each(U.dom.select("p > p"),function(X){try{U.dom.split(X.parentNode,X)
}catch(W){AJS.logError("insertwikimarkup - splitParas()",W)
}})
};
F.windowManager.open(J.dialog,{buttons:[{label:"confluence.conf_insert_button_title",action:function(){H({API:L(),successCallback:M,errorCallback:Q,textToConvert:K.getElement("#"+J.markupEditId).val(),setBusy:true})
}}],plugin_url:G,helpLink:"help.insert.wiki.markup",hintText:"confluence.conf_wikimarkup_hint",cssClass:"insert-wiki-markup-panel"});
if(AJS.DarkFeatures.isEnabled("editor.insert-wiki-markdown")){T(J.previewAreaId);
R(J.dialog.id).on("change",N);
K.getElement("#"+J.markupEditId).on("keydown",B.debounce(I,J.serverRequestTimer))
}});
F.addButton("insertwikimarkup",{title:"confluence.conf_wikimarkup_desc",cmd:"InsertWikiMarkup"})
},getInfo:function(){return{longname:"InsertWikiMarkip",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com/",version:"1.1"}
}});
C.PluginManager.add("insertwikimarkup",C.plugins.InsertWikiMarkupPlugin)
})(tinymce,AJS.$,_);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/editor_plugin_src.js' */
(function(B){var A=[];
AJS.bind("add-handler.property-panel",function(D,C){C&&A.push(C)
});
tinymce.create("tinymce.plugins.PropertyPanel",{init:function(C){AJS.log("init property panel plugin");
var H,D=function(){return !!B(".toolbar-contextual").length
},J=function(K){return !!K.closest("table:not(.wysiwyg-macro,.editor-inline-macro)").length
},G=function(K){if(K.type!="click"){return false
}if(K.which){return(K.which==3)
}if(K.button){return(K.button==2)
}},F=function(K){if(K.is("img")){return K[0]
}var L=K.closest("a,table,.wysiwyg-macro,.editor-inline-macro,.text-placeholder");
if(L.length){return L[0]
}return""
},E=function(O,R,N){var L={focusedEl:N,focusedNodeName:N.nodeName&&N.nodeName.toLowerCase(),ed:O,e:B.extend({},R)};
var Q=F(B(N)),S=J(B(N)),K=D();
L.containerEl=Q;
AJS.trigger("user-blurred-rte-element",L);
if(Q&&!G(R)&&!I()&&AJS.Confluence.PropertyPanel.shouldCreate){for(var M=0,P=A.length;
M<P;
M++){if(A[M].canHandleElement(B(Q))){AJS.log("PropertyPanel.create: Creating a panel for: "+A[M].name);
if(K||!S){return A[M].handle(L)
}(function(T){AJS.$(document).bind("shown.contextToolbar",function(U){T.handle(L)
})
})(A[M])
}}}},I=function(){return !!AJS.Confluence.PropertyPanel.current
};
if(tinymce.isIE){C.onMouseDown.add(function(K,L){H&&H.unbind("mouseup.IEDragHandlesWorkaround");
H=AJS.$(L.target);
H.filter("img, table").bind("mouseup.IEDragHandlesWorkaround",function(){E(K,L,L.target)
})
})
}AJS.bind("trigger.property-panel",function(L,K){E(C,L,K.elem)
});
C.onClick.add(function(K,L){E(K,L,L.target)
});
C.onKeyUp.addToTop(function(K,L,M){if(L.keyCode===27){return 
}E(K,L,K.selection.getNode())
});
C.onContextMenu.add(function(){AJS.Confluence.PropertyPanel.destroy()
});
AJS.bind("user-blurred-rte-element",function(L,K){if(I()){if(!K.containerEl||AJS.Confluence.PropertyPanel.current.hasAnchorChanged(K.containerEl)){AJS.Confluence.PropertyPanel.destroy()
}else{AJS.trigger("same-anchor.property-panel")
}}});
AJS.bind("created.property-panel",function(L,K){setTimeout(function(){AJS.Rte.bindScroll("property-panel",function(M){AJS.Confluence.PropertyPanel.destroy()
})
},0);
AJS.$(C.getDoc()).bind("keydown.property-panel.escape",function(M){if(M.keyCode===27&&I()){AJS.Confluence.PropertyPanel.destroy()
}})
});
AJS.bind("destroyed.property-panel",function(L,K){AJS.Rte.unbindScroll("property-panel");
AJS.$(C.getDoc()).unbind("keydown.property-panel.escape")
})
},getInfo:function(){return{longname:"Image, Link and Macro Property Panels",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("propertypanel",tinymce.plugins.PropertyPanel)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confmonospace/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfMonospacePlugin",{init:function(B,C){B.addCommand("confMonospace",function(){B.formatter.toggle("monospace",undefined)
});
tinymce.activeEditor.onInit.add(function(D){D.formatter.register({monospace:{inline:"code"}});
D.editorCommands.addCommands({confMonospace:function(){return D.formatter.match("monospace")
}},"state")
});
B.addButton("monospace",{title:"monospace",cmd:"confMonospace"})
},getInfo:function(){return{longname:"Monospace Formatting",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("confmonospace",tinymce.plugins.ConfMonospacePlugin)
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-links.js' */
(function(B){var A=0;
AJS.Confluence.PropertyPanel.Link={name:"link",canHandleElement:function(C){return C.is("a")&&C.attr("href")!="#"&&!C.hasClass("unresolved")
},handle:function(I){var H=I.containerEl;
var D=I.ed,C=function(J){return AJS.Rte.getEditor().getLang(J)
},E={anchorIframe:AJS.Rte.getEditorFrame()},F=B(H).attr("href").indexOf("#")==0,G=[{className:"link-property-panel-goto-button",text:C("propertypanel.links_goto"),tooltip:F?C("propertypanel.links_goto_disabled_tooltip"):H.href,href:H.href,disabled:F,click:function(){AJS.Confluence.PropertyPanel.destroy();
var J=tinymce.isIE?"_blank":"confluence-goto-link-"+AJS.params.pageId+"-"+A;
var K=window.open(H.href,J);
if(K){K.focus()
}}},{className:"link-property-panel-edit-button",text:C("propertypanel.links_edit"),tooltip:C("propertypanel.links_edit_tooltip"),disabled:B(H).hasClass("createlink")||!H.href,click:function(){AJS.Confluence.PropertyPanel.destroy();
D.selection.select(H);
Confluence.Editor.LinkBrowser.open()
}},{className:"link-property-panel-unlink-button",text:C("propertypanel.links_unlink"),tooltip:C("propertypanel.links_unlink_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();
D.execCommand("mceConfUnlink",false,H);
D.focus()
}}];
AJS.Confluence.PropertyPanel.createFromButtonModel(this.name,H,G,E);
A++
}}
})(AJS.$);
AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Link)
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-images.js' */
AJS.Confluence.PropertyPanel.Image=(function(G){var O={small:100,medium:300,large:500},K={small:".image-size-small",medium:".image-size-medium",large:".image-size-large",original:".image-size-original"},I=16,D=900;
function P(){var Q=[];
G.each(K,function(R,S){Q.push(S)
});
AJS.Confluence.PropertyPanel.current.panel.find(Q.join(", ")).removeClass("selected")
}function C(){return(G("#image-size-input").val())
}function L(Q,S){S=J(Q,S);
if(S){var R=!tinymce.confluence.ImageUtils.isRemoteImg(Q.destination);
delete Q.height;
Q.width=S;
Q.thumbnail=R&&(S<=AJS.Meta.get("max-thumb-width"));
E(Q);
P();
return true
}return false
}function M(Q,R){if(L(Q,O[R])){A(R);
E(Q);
return true
}return false
}function H(Q){delete Q.width;
delete Q.height;
Q.thumbnail=false;
P();
E(Q);
A("original");
return true
}function A(R){var Q=AJS.Confluence.PropertyPanel.current.panel.find(K[R]);
Q.addClass("selected")
}function F(Q){G(".image-border-toggle").toggleClass("selected",!Q.border);
Q.border=+!Q.border||false;
E(Q)
}function E(S){var Q=AJS.Confluence.PropertyPanel.current,T=G(Q.anchor),R=T.attr("src"),W=T.height();
Q.updating=true;
var U=function(){Q.updating=false;
Q.snapToElement({animate:true,animateDuration:100})
};
tinymce.confluence.ImageUtils.updateImageElement(T,S);
if(tinymce.isGecko){AJS.Rte.getEditor().execCommand("mceRepaint",false)
}if(S.src!=R){var V=setInterval(function(){var X=T.height();
if(X!=W){AJS.log("updateImageElement : height changed after image src change - "+W+" to "+X);
clearTimeout(V);
V=null;
U()
}},10);
setTimeout(function(){if(V){clearTimeout(V);
V=null;
U()
}},1000)
}else{U()
}N(S)
}function N(Q){var R=(Q.width)?Q.width:G(AJS.Confluence.PropertyPanel.current.anchor).width();
R=Math.floor(R);
G("#image-size-input").val(R+"px")
}function J(Q,R){R=parseInt(R);
if(!isNaN(R)){if(R<I){R=I
}else{if(R>D){R=D
}}return R
}else{return null
}}function B(Q){return{setPresetSize:function(R){M(Q,R)
},setPixelSize:function(R){L(Q,R)
},setToOriginalSize:function(){H(Q)
},toggleBorder:function(){F(Q)
},getWidth:function(){return Q.width
},getDisplayWidth:function(){return C()
},isButtonSelected:function(R){return AJS.Confluence.PropertyPanel.current.panel.find(K[R]).hasClass("selected")
}}
}return{pluginButtons:[],name:"image",canHandleElement:function(Q){return(Q.is("img")&&!Q.hasClass("editor-inline-macro")&&!Q.hasClass("template-variable"))
},handle:function(V){if(V.nodeName=="IMG"){var W=V
}else{var W=V.containerEl
}var R=G(W),T=tinymce.confluence.ImageProperties(W);
if(!T){return 
}var X=AJS.Rte.getEditor(),S=function(d){return X.getLang(d)
},b=function(d){return{className:"image-size-"+d,text:S("propertypanel.images_"+d),tooltip:S("propertypanel.images_"+d+"_tooltip"),click:function(e){M(T,d)
},selected:T.width==O[d]}
},Y=[{className:"editable",tooltip:S("propertypanel.images_sizing_tooltip"),html:'<input id="image-size-input"/>'},null,b("small"),b("medium"),b("large"),{className:"image-size-original",text:S("propertypanel.images_original"),tooltip:S("propertypanel.images_original_tooltip"),click:function(d){H(T)
},selected:!T.width&&!T.height&&!T.thumbnail},null,{className:"image-border-toggle",text:S("propertypanel.images_border"),tooltip:S("propertypanel.images_border_tooltip"),click:function(d){F(T)
},selected:(T.border||T.border==1)}];
Y.push(null);
var a=R.parent();
if(a.is("a[href]")){Y.push({className:"image-link-edit",text:S("propertypanel.images_link_edit"),tooltip:S("propertypanel.images_link_edit_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();
X.selection.select(a[0]);
Confluence.Editor.LinkBrowser.open()
}});
Y.push({className:"image-link-remove",text:S("propertypanel.images_link_remove"),tooltip:S("propertypanel.images_link_remove_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();
X.execCommand("mceConfUnlink",false,W);
X.focus()
}})
}else{Y.push({className:"image-make-link",text:S("propertypanel.images_link_create"),tooltip:S("propertypanel.images_link_create_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();
X.selection.select(W);
Confluence.Editor.LinkBrowser.open()
}})
}var Z=AJS.Confluence.PropertyPanel.Image.pluginButtons;
for(var U=0;
U<Z.length;
U++){if(Z[U]===null){Y.push(null)
}else{var c=Z[U].create(R);
if(c){Y.push(c)
}}}AJS.Confluence.PropertyPanel.createFromButtonModel(this.name,W,Y,{anchorIframe:AJS.Rte.getEditorFrame()});
var Q=G("#image-size-input");
Q.bind("focus",function(){G(this).select()
});
Q.bind("change",function(){L(T,C())?true:N(T)
});
AJS.Confluence.PropertyPanel.current.imageProps=T;
N(T);
return B(T)
}}
})(AJS.$);
AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Image)
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-macros.js' */
AJS.Confluence.PropertyPanel.Macro=(function(E){var D=[];
var C=[];
var F={};
var B=".property-panel";
var A="__PROPERTY_PANEL_SPACER";
return{name:"macro",registeredEvents:D,canHandleElement:function(G){return(G.hasClass("editor-inline-macro")||G.hasClass("wysiwyg-macro"))
},handle:function(P){if(P.e.type!="click"&&P.e.type!="mouseup"){return 
}var G=this;
var N=P.containerEl;
var K=E(N);
var J;
var O=[];
var U=!K.hasClass("editor-inline-macro");
var H=K.hasClass("wysiwyg-unknown-macro");
var S=[];
var V={originalHeight:U&&K.height(),anchorIframe:AJS.Rte.getEditorFrame()};
var I=function(W,X){return W+"-button-click"+(X?X+".macro":"")+B
};
if(!H){J=K.attr("data-macro-name");
if(AJS.MacroBrowser.getMacroMetadata(J)){O=AJS.MacroBrowser.getMacroMetadata(J).buttons
}var Q="macro-placeholder-property-panel-edit-button";
if(O.length>0&&O[0].key==A){Q+=" last"
}S.push({className:Q,text:"Edit",click:function(){AJS.Confluence.PropertyPanel.destroy();
tinymce.confluence.macrobrowser.editMacro(K)
}});
E.each(O,function(X,Y){if(Y.key==A){return 
}var W="macro-property-panel-"+Y.key;
if(X>0&&O[X-1].key==A){W+=" first"
}if(X<(O.length-1)&&O[X+1].key==A){W+=" last"
}S.push({className:W,text:Y.label,parameterName:Y.key,click:function(){E(document).trigger(I(Y.key),K);
E(document).trigger(I(Y.key,J),K);
AJS.Confluence.PropertyPanel.destroy()
}})
})
}var T="macro-placeholder-property-panel-remove-button";
if(O.length>0&&O[O.length-1].key==A){T+=" first"
}S.push({className:T,text:"Remove",click:function(){AJS.Confluence.PropertyPanel.destroy();
AJS.Rte.getEditor().execCommand("mceConfRemoveMacro",N)
}});
if(K.attr("data-macro-parameters")){var L=Confluence.MacroParameterSerializer.deserialize(K.attr("data-macro-parameters"));
if("atlassian-macro-output-type" in L){var R=function(W){return function(X){L["atlassian-macro-output-type"]=W;
K.attr("data-macro-parameters",Confluence.MacroParameterSerializer.serialize(L));
if(W=="INLINE"){E(".macro-placeholder-property-panel-display-newline-button").removeClass("selected")
}else{E(".macro-placeholder-property-panel-display-inline-button").removeClass("selected")
}E(X).addClass("selected")
}
};
S.push(null);
S.push({className:"macro-placeholder-property-panel-display-newline-button",tooltip:"Display on new line",selected:L["atlassian-macro-output-type"]=="BLOCK",click:R("BLOCK")});
S.push({className:"macro-placeholder-property-panel-display-inline-button",tooltip:"Display inline",selected:L["atlassian-macro-output-type"]=="INLINE",click:R("INLINE")})
}}E.each(D,function(){if(!this.macroName||this.macroName==J){E(document).bind(I(this.id,this.macroName),this.handler)
}});
var M=C;
if(J&&F[J]){M=M.concat(F[J])
}E.each(M,function(){try{this(N,S,V)
}catch(W){AJS.log("Property panel init handler failed for : "+J+".  Is global handler : "+(AJS.$.inArray(this,C)>-1),W)
}});
AJS.Confluence.PropertyPanel.createFromButtonModel("macro",N,S,V)
},registerButtonHandler:function(I,G,H){D.push({id:I,handler:G,macroName:H})
},registerInitHandler:function(G,H){if(H){F[H]=F[H]||[];
F[H].push(G)
}else{C.push(G)
}},yieldButtonFor:function(G,H){var I;
E.each(G,function(){if(this.parameterName&&this.parameterName==H){I=this
}});
return I
}}
})(AJS.$);
AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Macro)
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/conftable/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ConfluenceTablePlugin",{init:function(B,C){!tinymce.isIE8&&B.onKeyDown.add(function(G,H){if(!H.altKey||(H.keyCode!=38&&H.keyCode!=40)){return 
}var F=G.selection.getRng(true),D=A(F.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent");
if(D.length===0){return 
}G.execCommand(H.keyCode==38?"mceTableInsertRowBefore":"mceTableInsertRowAfter");
var E=D.parent()[H.keyCode==38?"prev":"next"]().find("td:first-child")[0];
F.setStart(E,0);
F.setEnd(E,0);
G.selection.setRng(F);
return tinymce.dom.Event.prevent(H)
})
},getInfo:function(){return{longname:"Confluence Table Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("conftable",tinymce.plugins.ConfluenceTablePlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/deletecommand/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.DeleteCommandPlugin",{init:function(B){B.addCommand("mceDelete",function(E,D){function C(){if(tinymce.isWebKit){var G=B.selection.getRng(1);
if(G.collapsed){return false
}var F=A(G.startContainer).closest(".wysiwyg-macro-body",B.getBody())[0];
if(F&&AJS.EditorUtils.isRangeAtStartOf(F,G)&&AJS.EditorUtils.isRangeAtEndOf(F,G)){var I=A(F.firstChild).is("pre"),J=(I?"pre":"p"),H=A("<"+J+"><br data-mce-bogus='1'></"+J+">")[0];
A(F).html(H);
B.selection.select(H,1);
return true
}}return false
}if(!C()){B.getDoc().execCommand("Delete",E,D)
}})
},getInfo:function(){return{longname:"Delete Command Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("deletecommand",tinymce.plugins.DeleteCommandPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencetasklist/editor_plugin_src.js' */
(function(E){function D(I,G){var F,J,H;
if(tinymce.isGecko){H=G.getBoundingClientRect();
F=I.pageX-(H.left+tinymce.DOM.getViewPort(tinymce.activeEditor.getWin()).x);
J=I.pageY-(H.top+tinymce.DOM.getViewPort(tinymce.activeEditor.getWin()).y)
}else{if(tinymce.isIE8){F=I.offsetX-G.offsetLeft;
J=I.offsetY-G.offsetTop
}else{F=I.offsetX;
J=I.offsetY
}}return F>=3&&F<=14&&J>=3&&J<=14
}function A(F,I){var G=I.target;
if(G.tagName!=="LI"){return 
}var H=F.dom.getParent(G,"ul,ol");
if(H.tagName==="UL"&&F.dom.hasClass(H,"inline-task-list")){if(D(I,G)){if(F.dom.hasClass(G,"checked")){F.dom.removeClass(G,"checked")
}else{F.dom.addClass(G,"checked")
}}}}function B(F){var G=F.selection.getStart();
return(G&&G.tagName.toUpperCase()==="LI")?G:F.dom.getParent(G,"li")
}function C(G,H){if(H.keyCode===tinymce.VK.ENTER&&!H.shiftKey){var F=B(G);
if(F){var I=AJS.$(F);
if(G.dom.hasClass(F.parentNode,"inline-task-list")){I.removeClass("checked").attr("data-inline-task-id","")
}else{I.removeClass("checked").removeAttr("data-inline-task-id")
}}}}tinymce.create("tinymce.plugins.ConfluenceTaskListPlugin",{init:function(F,G){F.onClick.add(A);
F.onKeyUp.add(C)
},getInfo:function(){return{longname:"Confluence Task List Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("confluencetasklist",tinymce.plugins.ConfluenceTaskListPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/draggable/editor_plugin_src.js' */
(function(W){if(W.browser.msie&&W.browser.version<=8){return 
}var D="img.confluence-embedded-image,img.editor-inline-macro,table.wysiwyg-macro";
var d="img";
var E=10;
var B,l,L,S,M,e,k,I,H,Z,h,c,O,U;
var Y=[800,800,400,400,400,300,300,300,300,300,300,300,300,300,300,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100];
function i(n){var o=0;
return{scrollUp:function(p){var q;
if(o===-p){return 
}o=-p;
q=(n.scrollTop()/p)*1000;
n.stop(false,false);
n.animate({scrollTop:0},{duration:q})
},scrollDown:function(q){var r,p;
if(o===q){return 
}o=q;
p=n[0].scrollHeight;
r=((p-n.scrollTop())/q)*1000;
n.stop(false,false);
n.animate({scrollTop:p},{duration:r})
},cancelScrolling:function(){o=0;
n.stop(true,false)
},scrollHeight:function(){return n[0].scrollHeight
}}
}var K="div.innerCell,div.cell";
var P="body";
var a="p,h1,h2,h3,h4,h5,h6,blockquote,li,td,th,img";
var G="li,td,th";
var m="p,h1,h2,h3,h4,h5,h6,blockquote";
var C="li,td,th";
function b(AJ){var AG=!!S.children(".contentLayout,.contentLayout2").length;
function AB(){return L.find("#move-indicator")
}function AC(){return AB().length>0
}function w(AK){return AK.attr("id")==="move-indicator"
}function AE(){return W('<span id="move-indicator">|</span>')
}function u(AL,AK){var AN,AM;
AN=AA(AL,AK);
if(AN){AI(AN.target,AN.before)
}}function AA(AL,AK){var AN=W(L[0].elementFromPoint(AL,AK));
var AM=true;
if(p(AN)){return{target:AN,before:n(AN,AL,AK)}
}if(x(AN)){AN=AH(AN);
if(o(AN,AK)){AN=AN.children().first()
}else{if(s(AN,AK)){AN=AN.children().last();
AM=false
}else{if(r(AN)){return null
}else{AN=y(AN);
AM=false
}}}return{target:AN,before:AM}
}return null
}function p(AK){if(AK.is(a)&&!w(AK)){if(AK.is("td.wysiwyg-macro-body")){if(AK.closest("table").attr("data-macro-body-type")==="PLAIN_TEXT"){return false
}}if(AK.is("img")&&!AJ.is("img")){return false
}return true
}return false
}function x(AK){if(AG){return AK.is(K)
}return AK.is(P)
}function AH(AK){if(AK.is("div.cell")){return AK.children("div.innerCell").first()
}return AK
}function z(AL){if(AL.is(G)){var AK=AL.children().first();
if(AK.is(m)){AL=AK
}}return AL
}function o(AL,AK){return AF(AL.children().first(),AK)<0
}function s(AL,AK){return q(AL.children().last(),AK)>0
}function r(AK){return AC()&&(AB().parent(AK).length>0)
}function y(AL){var AK=AJ.parent(a);
if(!AK.length){AK=AL.find(a).last()
}if(!AK.length){AK=S.find(a).last()
}return AK
}function AI(AM,AL){if(w(AM)){return 
}var AK=AB();
if(AM.is(G)&&AM.find(AK).length){return 
}if(!AK.length){AK=AE()
}else{AK.detach()
}AM=z(AM);
if(!AM.is("img")&&AJS.Rte.Cursor.isTextContainerEmpty(AM[0])){AM.prepend(AK)
}else{if(AM.is(C)){if(AL){AM.prepend(AK)
}else{AM.append(AK)
}}else{if(AL){AM.before(AK)
}else{AM.after(AK)
}}}}function n(AQ,AN,AM){if(AQ.is("img")){var AP=t(AQ,AN);
var AL=AQ.width();
return AP<(AL/2)
}var AO=AF(AQ,AM);
var AK=AQ.height();
return AO<(AK/2)
}function AF(AN,AL){var AO=AN.offset();
var AM=AL+L.scrollTop();
var AK=AM-AO.top;
return AK
}function t(AM,AK){var AO=AM.offset();
var AL=AK+L.scrollLeft();
var AN=AL-AO.left;
return AN
}function q(AO,AN){var AM=AF(AO,AN);
var AK=AO.height();
var AL=AM-AK;
return AL
}function AD(AL){var AK=AB();
if(AK.length){if(AL.is(d)&&x(AK.parent())){AL=W("<p></p>").append(AL)
}AK.replaceWith(AL);
AJS.Rte.showElement(AL);
B.selection.select(AL[0]);
B.selection.collapse(true)
}else{AJS.log("No cursor - abort drop");
B.undoManager.undo()
}AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody())
}function v(){var AK=AB();
if(AK.length){AK.remove();
AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody())
}}return{positionNear:u,replaceWith:AD,destroy:v}
}function N(n){h=n.attr("style")||"";
return n
}function V(n){if(n.which!=1){return 
}if(n.target!=n.currentTarget){return 
}if(Z){g(n);
return 
}Z=W(n.target);
B.selection.select(n.target);
n.preventDefault();
L.bind({"mousemove.moveable-zone":J,"mouseup.moveable-zone":g,"keydown.moveable-zone":X,"mouseover.moveable-zone":j});
var o=Z.offset();
I=n.pageX;
H=n.pageY;
e=o.top-H;
k=o.left-I;
c=true;
Z=N(Z)
}function X(n){if(n.keyCode==27){R(n)
}}function j(){L.find(".mceSelected").removeClass("mceSelected")
}function Q(p){var o=Math.abs(I-p.pageX);
var n=Math.abs(H-p.pageY);
return o<E&&n<E
}function J(p){var o,n;
if(c){if(Q(p)){return 
}AJS.Rte.BookmarkManager.storeBookmark();
B.undoManager.beforeChange();
B.undoManager.typing=true;
B.undoManager.add();
A();
Z.css({position:"absolute",width:Z.css("width"),"max-width":"50%"});
AJS.Confluence.PropertyPanel.current&&AJS.Confluence.PropertyPanel.destroy();
Z.detach();
AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody());
S.append(Z);
U=b(Z);
c=false
}p.preventDefault();
Z.hide();
f(p.clientX,p.clientY);
U.positionNear(p.clientX,p.clientY);
o=Math.min(p.pageY+e,O.scrollHeight()-Z.outerHeight());
n=p.pageX+k;
Z.css({top:o,left:n,opacity:0.5});
Z.show()
}function A(){var n=B.selection.getSel();
n&&n.removeAllRanges&&n.removeAllRanges()
}function f(q,p){var r,o;
var n=Y.length;
p=Math.max(p,0);
if(p<n){O.scrollUp(Y[p]);
return 
}r=l.height();
o=Math.max(0,r-p);
if(o<n){O.scrollDown(Y[o]);
return 
}O.cancelScrolling()
}function g(n){L.unbind(".moveable-zone");
O.cancelScrolling();
if(c){Z=null;
return 
}n.preventDefault();
Z.detach();
Z.attr("style",h);
U.replaceWith(Z);
U.destroy();
Z=null;
U=null;
j();
B.undoManager.add()
}function R(n){O.cancelScrolling();
L.unbind(".moveable-zone");
B.undoManager.undo();
B.selection.select(Z[0]);
B.selection.collapse(false);
Z=null
}function T(){L.delegate(D,{mousedown:V})
}function F(n){n.preventDefault()
}tinymce.create("tinymce.plugins.draggable",{init:function(n,o){B=n;
n.onInit.add(function(q,p){var r;
l=W(n.getWin());
L=W(n.getDoc());
S=W(n.getBody());
M=W(l[0].parent);
if(W.browser.webkit){r=S
}else{r=L.find("html")
}O=i(r);
T()
})
},getInfo:function(){return{longname:"Draggable objects (images, tables, placeholders) around the document via drag and drop",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("draggable",tinymce.plugins.draggable)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor.js' */
(function(A){function B(C){C=C&&C.jquery?C[0]:C;
if(!C){return false
}if(C.tagName==="BR"||C.nodeType==3){C=C.parentNode
}if(C&&C.nodeType==9){C=null
}return C
}AJS.Rte=A.extend({HIDDEN_CHAR:"\ufeff",ZERO_WIDTH_WHITESPACE:"&#x200b;",editorId:"wysiwygTextArea",getEditor:function(){return tinyMCE.activeEditor
},getCurrentBaseUrl:function(){if(!this.currentBaseUrl){var C=document.location;
this.currentBaseUrl=C.protocol+"//"+C.hostname+(C.port?":"+C.port:"")
}return this.currentBaseUrl
},showSelection:function(C){AJS.Rte.showElement(tinyMCE.activeEditor.selection.getStart(),C)
},isAnyPartShown:function(G){G=B(G);
if(!G){AJS.debug("AJS.Rte.isAnyPartShown: no element to find");
return false
}var E=A(G);
var D=E.offset().top;
var H=D+E.outerHeight();
var C=A(AJS.Rte.getEditor().getDoc()).scrollTop();
var F=C+A(AJS.Rte.getEditorFrame()).height();
return H>C&&D<F
},showElement:function(I,G){var J=B(I);
if(!J){AJS.log("AJS.Rte.showElement: no element to show - skipping");
return false
}var D=A(J);
var H=AJS.Rte.getEditor();
var M=A(H.getDoc());
var K=D.offset().top;
var C=K+D.outerHeight();
var E=M.scrollTop();
var F=E+A(AJS.Rte.getEditorFrame()).height();
var L=function(){AJS.Rte.bindScroll("AJS.Rte.showElement",function(){AJS.Rte.unbindScroll("AJS.Rte.showElement");
setTimeout(G,1)
})
};
if(K<E){AJS.Rte.scrollTo(K);
G&&L()
}else{if(C>F){AJS.Rte.scrollTo(Math.min(K,E+C-F));
G&&L()
}else{G&&G()
}}},scrollTo:function(D){var C=AJS.Rte.getEditor();
D=Math.ceil(D);
A(C.getDoc()).scrollTop(D)
},bindScroll:function(D,E){AJS.log("bind scroll for ed");
var C=AJS.Rte.getEditor();
A(document).add(C.getDoc()).add(C.getWin()).bind("scroll."+D,E)
},unbindScroll:function(D){AJS.log("unbind scroll for ed");
var C=AJS.Rte.getEditor();
A(document).add(C.getDoc()).add(C.getWin()).unbind("scroll."+D)
},getMainEditor:function(){var C=tinymce.EditorManager.editors[AJS.Rte.editorId];
if(!C){throw new Error("Main editor has not been initialised yet and is therefore not accessible via tinymce.EditorManager.editors")
}return C
},getEditorContainer:function(){return A("#wysiwyg")
},getEditorFrame:function(){return A("#"+AJS.Rte.getEditor().id+"_ifr")[0]
},getEditorTable:function(){return A("#"+AJS.Rte.getEditor().id+"_tbl")
},webResourcePath:"/download/resources/com.atlassian.confluence.tinymceplugin%3Atinymceeditor/",getResourceUrlPrefix:function(){if(!this.resourceUrlPrefix){this.resourceUrlPrefix=this.getCurrentBaseUrl()+AJS.Meta.get("editor-plugin-resource-prefix")
}return this.resourceUrlPrefix
},getTinyMceBaseUrl:function(){if(!this.absoluteUrl){this.absoluteUrl=this.getResourceUrlPrefix()+this.webResourcePath+"tinymcesource/"
}return this.absoluteUrl
},getMinEditorHeight:function(){return +AJS.Meta.get("min-editor-height")
},getTinyMceEditorMinHeight:function(D){D=D||0;
var C=AJS.Rte.getMinEditorHeight(),E=0;
if(C){return C
}A("#editor-precursor,#header-precursor,#header").each(function(){E+=A(this).outerHeight(true)
});
return(A(window).height()-E-D)
},fixEditorFocus:function(E){var D=AJS.Rte.getEditor(),C=D.getBody();
if(!tinyMCE.isGecko){return 
}AJS.log("Fixing FF cursor positioning");
if(C.contentEditable=="true"){C.contentEditable=false;
C.contentEditable=true
}}},AJS.Rte);
tinymce.VK=jQuery.extend({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,META:91},tinymce.VK)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-content.js' */
(function(A){AJS.Rte.Content={offset:function(E){var C=A(E),I=C.offset(),H=A(AJS.Rte.getEditorFrame()),B=H.offset(),F=H[0].contentWindow.document,G=A(AJS.Rte.getEditor().getBody()),D={top:(jQuery.support.boxModel&&F.documentElement.scrollTop||G.scrollTop()),left:(jQuery.support.boxModel&&F.documentElement.scrollLeft||G.scrollLeft())};
return{top:I.top-D.top+B.top,left:I.left-D.left+B.left}
},getSelectedText:function(){var B=AJS.Rte.getEditor(),C=B.selection;
return C.getRng().text||(C.getSel()&&C.getSel().toString&&C.getSel().toString())||""
},setHtml:function(B){AJS.log("AJS.Rte.Content.setHtml called with :"+B);
if(B){AJS.Rte.getEditor().setContent(B)
}},getHtml:function(){return""+AJS.Rte.getEditor().getContent()
},isEmpty:function(){var B=AJS.Rte.getEditor().getContent().replace("&nbsp;"," ");
return !AJS.$.trim(B)
},editorHasContentChanged:function(){return AJS.Rte.getEditor().isDirty()
},editorResetContentChanged:function(){AJS.Rte.getEditor().setDirty(false)
},getChildIndex:function(C,F){var E=C.childNodes;
for(var D=0,B=E.length;
D<B;
D++){if(E[D]==F){return D
}}return -1
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-bookmark-manager.js' */
(function(){var A;
AJS.Rte.BookmarkManager={storeBookmark:function(){var F=tinyMCE.activeEditor,C=tinyMCE.DOM.getViewPort(tinyMCE.activeEditor.getWin()),E,B,D;
F.focus();
E=F.selection;
B=E.getRng();
if(B.cloneRange&&typeof B.cloneRange=="function"){D=B.cloneRange()
}else{D=B.duplicate&&B.duplicate()||B
}A={scrollX:C.x,scrollY:C.y,range:D}
},restoreBookmark:function(){var B=tinyMCE.activeEditor.selection,C=tinyMCE.activeEditor.getWin();
if(A){C.scrollTo(A.scrollX,A.scrollY);
C.focus();
B.setRng(A.range)
}}}
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-support.js' */
(function(A){AJS.Rte.Support={inlineTasks:function(){var B=AJS.Meta.get("use-inline-tasks");
return B==="true"||B===true
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinyMce-eventDelegator.js' */
AJS.Rte.EventDelegator=function(B){var A={},D={},C=function(E,J){var G,I;
for(I in A){if(A.hasOwnProperty(I)&&A[I].isEnabled){for(var F=0,H=A[I].events.length;
F<H;
F++){G=A[I].events[F];
if(G.type.toLowerCase().indexOf(J.type)>-1){if(G.shouldTrigger(E,J)){G.callback.apply(this,[J.target])
}else{G.missed&&G.missed()
}}}}}};
return{addEventsForComponent:function(E,G){if(!(E in A)){A[E]={};
A[E].events=[];
A[E].isEnabled=true
}var I,J;
for(var F=0,H=G.length;
F<H;
F++){I=null;
!(G[F].type in D)&&(function(){D[G[F].type]=true;
B[G[F].type].add(C)
})();
if(!(typeof (G[F].shouldTrigger)=="function")){(function(K){G[F].shouldTrigger=function(L,M){return M.target.tagName.toLowerCase()==K
}
})(G[F].shouldTrigger)
}A[E].events.push(G[F])
}},disableEventsForComponent:function(E){for(var F=0,G=A.length;
F<G;
F++){if(E in A){A[E].isEnabled=false;
return true
}}return false
},enableEventsForComponent:function(E){for(var F=0,G=A.length;
F<G;
F++){if(E in A){A[E].isEnabled=true;
return true
}}return false
}}
};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinymce-cursor.js' */
(function(E){function C(L){if(E(L).closest("td").length==0){return true
}var K=L.parentNode;
while(K.nodeName.toLowerCase()!="td"){var J=E(K).prevAll().contents().filter(function(){return this.nodeType==3
});
if(J.length){return false
}K=K.parentNode
}return true
}function F(K,J,O){if(J.compareEndPoints){var N=K.getBody().createTextRange();
N.moveToElementText(O);
N.collapse(1);
return J.compareEndPoints("StartToStart",N)===0&&C(O)
}if(!K.selection.getSel().isCollapsed){return false
}function L(P){return P.nodeType==3&&P.nodeValue=="\n"
}var M=J.startContainer;
if(M.nodeType==3){return !M.previousSibling&&J.startOffset===0&&C(M)
}else{if(E(M).is("p:first-child")){return J.startOffset===0
}else{if(E(M).is(".wysiwyg-macro-body")){return J.startOffset==1&&L(J.startContainer.childNodes[0])
}}}}function A(K,J,M){if(J.compareEndPoints){var O=K.getBody().createTextRange();
O.moveToElementText(M);
O.collapse(0);
return J.compareEndPoints("EndToEnd",O)===0
}if(!K.selection.getSel().isCollapsed){return false
}var N=J.endContainer;
if(N.nodeType==3){return(N.wholeText.length==J.endOffset)
}var L=N.childNodes[J.endOffset];
return E(L).is(":last-child")
}function H(K,J,L){var M=K.dom.create("p",0,tinymce.isIE?"&nbsp;":'<br data-mce-bogus="1" />');
if(L){J.after(M)
}else{J.before(M)
}K.selection.select(M,true);
K.selection.collapse()
}function G(J){var K=J.contents();
if(!K.length){return true
}if(K.length==1){if(K.is("br")){return true
}else{if(K.html()=="&nbsp;"||K.text().charCodeAt(0)==160){return true
}else{if(K[0].nodeType==3&&K[0].nodeValue==AJS.Rte.HIDDEN_CHAR){return true
}}}}return false
}function D(J,K){return J.getBody().firstChild==K
}function B(J,K){return J.getBody().lastChild==K
}function I(){var J=AJS.Rte.getEditor();
tinymce.isIE&&J.onKeyPress.add(function(K,O){var L=K.selection,N=L.getNode();
if(O.keyCode==13&&N.nodeName=="P"&&K.dom.is(N,":first-child")&&tinymce.confluence.MacroUtils.isInMacro(N)){var M=K.dom.create("p","&#x200b");
K.dom.insertAfter(M,N);
L.select(M,1);
L.collapse();
return tinymce.dom.Event.cancel(O)
}});
tinymce.isGecko&&J.onKeyPress.add(function(L,O){var N,M,K;
if(O.charCode==E.ui.keyCode.SPACE){N=L.selection.getNode();
M=E(N).closest("a");
K=L.selection.getRng();
if(M.length&&A(L,L.selection.getRng(),N)){K.setStartAfter(M[0]);
K.setEndAfter(M[0]);
L.selection.setRng(K);
L.selection.collapse()
}}});
J.onKeyPress.addToTop(function(K,O){if(O.keyCode==13&&!O.shiftKey){var M=K.selection.getNode(),N=E(M).closest("pre");
if(N.length&&!tinymce.confluence.MacroUtils.isInMacro(N)&&A(K,K.selection.getRng(),M)){H(K,N,true);
return tinymce.dom.Event.cancel(O)
}var P=E(M).closest("blockquote");
if(P.length){var L=E(M).closest("p");
if(L.is(":first-child")&&F(K,K.selection.getRng(),M)){H(K,P,false);
return tinymce.dom.Event.cancel(O)
}if(L.is(":last-child")&&G(L)){K.dom.remove(L[0],false);
H(K,P,true);
return tinymce.dom.Event.cancel(O)
}}}return true
})
}AJS.Rte=AJS.Rte||{};
AJS.Rte.Cursor=AJS.Rte.Cursor||{};
E.extend(AJS.Rte.Cursor,{insertParagraph:H,isCursorAtStart:F,isCursorAtEnd:A});
AJS.bind("init.rte",I)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/showformat/editor_plugin_src.js' */
(function(C){var B="editor.showformat.show-eol-markers";
var D="show-eol-markup";
tinymce.create("tinymce.plugins.ShowFormat",{init:function(E){if(!AJS.DarkFeatures.isEnabled("editor.show-formatting")){return 
}C("#rte-show-eol-markers-button").click(A);
if(AJS.Cookie.read(B)==="true"){C(A)
}},getInfo:function(){return{longname:"Show Format Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
function A(){var F=C(AJS.Rte.getEditor().getBody());
var E=C("#rte-show-eol-markers-button");
E.toggleClass("active");
if(E.hasClass("active")){F.addClass(D);
AJS.Cookie.save(B,"true")
}else{F.removeClass(D);
AJS.Cookie.erase(B)
}}tinymce.PluginManager.add("showformat",tinymce.plugins.ShowFormat)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/highlightnode/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.ShowCurrentNode",{init:function(C){AJS.log("Hightlight Current Node Plugin");
var D=["strong","em","u","s","sub","sup","a","code","h1","h2","h3","h4","h5","h6","pre"];
var B={strong:"Bold",em:"Italic",u:"Underline",s:"Strikethrough",sub:"subscript",sup:"superscript"};
C.onNodeChange.add(function(G,F,J){var I=A(J);
$oldCurrentElement=A(".highlight-marker",G.getBody());
var H=(A.inArray(J.nodeName.toLowerCase(),D)!=-1)&&!(J.nodeName.toLowerCase() in B&&!G.queryCommandState(B[J.nodeName.toLowerCase()]))&&!(!(J.nodeName.toLowerCase() in B)&&!G.formatter.match(J.nodeName.toLowerCase()));
if(I.hasClass("highlight-marker")&&H){return 
}if($oldCurrentElement){$oldCurrentElement.removeClass("highlight-marker")
}if(!H){return 
}I.addClass("highlight-marker")
});
var E=function(F){$highlightedElement=A(".highlight-marker",F);
$highlightedElement.each(function(){A(this).removeClass("highlight-marker")
})
};
A(document).bind("mode-changed",function(F,G){if(G==="preview"){E(A("iframe").contents().find("#content"))
}});
C.onSaveContent.add(function(F,G){AJS.log("on save content");
$content=A("<div>"+G.content+"</div>");
E($content);
G.content=$content[0].innerHTML
})
},getInfo:function(){return{longname:"Atlassian Show Current Node",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
if(AJS.DarkFeatures.isEnabled("highlightnode")){tinymce.PluginManager.add("highlightnode",tinymce.plugins.ShowCurrentNode)
}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/iosediting/editor_plugin_src.js' */
(function(A){tinymce.create("tinymce.plugins.iOSEditing",{init:function(B){if(tinymce.isIDevice){setTimeout(function(){var C=A(AJS.Rte.getEditor().getBody());
C.addClass("ios")
},0)
}},getInfo:function(){return{longname:"iOS Comments Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("iosediting",tinymce.plugins.iOSEditing)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinymce-bootstrap.js' */
(function(C){var B={atlassian:true,keep_values:true,convert_urls:true,relative_urls:false,remove_script_host:false,button_tile_map:true,gecko_spellcheck:true,apply_source_formatting:false,list_outdent_on_enter:true,visual:false,confluence_table_style:"confluenceTable",confluence_table_cell_style:"confluenceTd",confluence_table_heading_style:"confluenceTh",confluence_table_default_rows:4,confluence_table_default_cols:3,confluence_table_default_heading:true,cleanup:true,cleanup_on_startup:true,fix_list_elements:false,fix_table_elements:true,valid_elements:"@[id|class|style|title|wysiwyg|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],a[*],strong/b,em/i,s,u,#p[align|user],-ol[type|compact],-ul[type|compact],li,br,img[imagetext|longdesc|usemap|src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,-blockquote[cite|markup],-table[*],-tr[rowspan|width|height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,div[*],#span[*],-code,#pre[*],address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],object[classid|width|height|codebase|*],param[name|value],embed[type|width|height|src|*],map[name],area[shape|coords|href|alt|target],bdo,button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value],kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],q[cite],samp,select[disabled|multiple|name|size],small,textarea[cols|rows|disabled|name|readonly],tt,var,big",extended_valid_elements:"img[*]",formats:{removeformat:[{selector:"h1,h2,h3,h4,h5,h6,pre",remove:"all",split:true,expand:false,block_expand:true,deep:true,block:"*"},{selector:"address,article,b,big,blockquote,center,cite,code,date,dd,del,dfn,dl,dt,em,embed,font,footer,header,hgroup,i,ins,kbd,link,menu,nav,object,param,q,s,samp,script,section,small,strike,strong,style,sub,sup,time,tt,u,var",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"table",attributes:["cellpadding","cellspacing","border"],split:false,expand:false,deep:true},{selector:"*",attributes:["style","color","bgcolor","title","lang"],split:false,expand:false,deep:true}]},forced_root_block:"p",force_p_newlines:true,force_br_newlines:false,oninit:"AJS.Rte.BootstrapManager.onInit",object_resizing:false,paste_preprocess:function(D,E){C(document).trigger("prePaste",[D,E])
},paste_postprocess:function(D,E){C("img",E.node).not("[data-emoticon-name]").not(".editor-inline-macro").not(".confluence-embedded-image").not(".template-variable").addClass("confluence-embedded-image confluence-external-resource");
C(document).trigger("postPaste",[D,E])
}};
var A=function(H){if(typeof TinyMCELang==undefined){AJS.log("ERROR: could not find the TinyMCE language pack")
}var G=new RegExp(TinyMCELang.ctrl_key+"\\+","g"),D=new RegExp(TinyMCELang.shift_key+"\\+","g");
var I=function(K){return K.replace(G,"\u2318").replace(D,"\u21E7")
};
for(var F in TinyMCELang){var E=TinyMCELang[F];
if(typeof E=="object"){for(var J in E){if(tinymce.isMac){E[J]=I(E[J])
}}}tinymce.EditorManager.addI18n(H+"."+F,TinyMCELang[F])
}if(tinymce.isMac){C("#rte-toolbar .toolbar-item, #rte-toolbar .dropdown-item, #rte-savebar .aui-button").each(function(){var L=C(this),M=L.attr("title"),K=L.attr("data-tooltip");
if(M){L.attr("title",I(M))
}if(K){L.attr("data-tooltip",I(K))
}})
}};
AJS.log("Creating AJS.Rte.BootstrapManager object.");
AJS.Rte.BootstrapManager={_tinyMceHasInit:false,_beforeInitCallbacks:[],_tinymcePluginInits:[],_settings:null,isInitComplete:function(){return this._tinyMceHasInit
},isEditorActive:function(){return this.isInitComplete()&&tinyMCE&&tinyMCE.activeEditor
},onInit:function(){AJS.log("AJS.Rte.Init:onInit oninit callback");
this._tinyMceHasInit=true;
var I=AJS.Rte.getEditor();
var H=C.browser.msie&&(parseInt(C.browser.version)==7);
var E=AJS.params.contentType=="comment"&&AJS.params.editorMode=="richtext";
AJS.trigger("init.rte",{editor:I});
var K=AJS.Meta.get("editor-auto-focus")!==false;
if(!K){AJS.log("Bootstrap: editor-auto-focus=false. Do not focus the editor automatically.")
}if(!(H&&E)&&K){setTimeout(function(){I.focus()
},0)
}if(tinymce.isGecko){var M=I.getDoc(),L=I.getBody(),G=I.settings;
if(!G.readonly){if(L.contentEditable=="true"){L.contentEditable=false;
L.contentEditable=true;
var F=AJS.Rte.getEditor().selection;
var D=F.getRng();
D.setEnd(D.startContainer,0);
F.setRng(D)
}try{M.execCommand("styleWithCSS",0,false)
}catch(J){if(!I._isHidden()){try{M.execCommand("useCSS",0,true)
}catch(J){}}}if(!G.table_inline_editing){try{M.execCommand("enableInlineTableEditing",false,false)
}catch(J){}}if(!G.object_resizing){try{M.execCommand("enableObjectResizing",false,false)
}catch(J){}}}}tinymce.dom.DOMUtils.prototype.getRoot=function(){function O(){var Q=C(I.selection.getNode()).closest("div.innerCell");
if(!!Q.length){return Q[0]
}return P.doc.body
}var P=I.dom,N=P.settings;
return(N&&P.get(N.root_element))||O()
};
tinymce.dom.DOMUtils.prototype.setRoot=function(N){I.dom.settings.root_element=N
}
},addOnInitCallback:function(D){if(C.isFunction(D)){if(this._tinyMceHasInit){D()
}else{AJS.bind("init.rte",D)
}}else{throw new Error("Attempt made to register an oninit callback that is not a function. Received: "+D)
}},addBeforeInitCallback:function(D){this._beforeInitCallbacks.push(D)
},addTinyMcePluginInit:function(D){this._tinymcePluginInits.push(D)
},preInitialise:function(D){this._settings=C.extend(B,D)
},initialise:function(){if(!this._settings){AJS.log("Bootstrap:initialise: No settings found. Has preInitialise been called?");
return 
}AJS.log("Bootstrap:initialise: Initialising TinyMce version "+tinymce.majorVersion+"."+tinymce.minorVersion);
C.each(this._beforeInitCallbacks,function(F,G){G(AJS.Rte.BootstrapManager._settings)
});
AJS.log("Bootstrap:initialise: executing tinymcePluginInits");
for(var D=0,E=this._tinymcePluginInits.length;
D<E;
D++){if(typeof this._tinymcePluginInits[D]=="function"){this._tinymcePluginInits[D](this._settings)
}}AJS.log("Bootstrap: set locale translations");
A(this._settings.language);
tinyMCE.init(this._settings);
AJS.log("Bootstrap:initialise: After editor TinyMCE init.");
AJS.Rte.Content.editorResetContentChanged();
C(AJS.Rte.getEditorFrame()).attr("tabindex",100);
if(tinymce.isIE){C(AJS.Rte.getEditorFrame()).attr("hidefocus","hidefocus")
}AJS.trigger("rte-ready")
}};
AJS.log("AJS.Rte.BootstrapManager created")
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/editor-utils.js' */
AJS.EditorUtils=(function(C){var A=true;
function D(E){return E&&E.nodeType==3&&E.nodeValue.length===0
}var B={isCursorAtStartOf:function(F,E){return E.collapsed&&B.isRangeAtStartOf(F,E)
},isRangeAtStartOf:function(H,F){if(!F||!F.startContainer){throw new Error("range is invalid. received: "+F)
}if(!H||!H.nodeType){throw new Error("context is invalid. received: "+H)
}var G=F.startContainer,J;
if(G.nodeType==3){if(F.startOffset!==0){return false
}J=G
}else{J=G.childNodes[F.startOffset];
if(J===undefined&&G.childNodes.length>0){return false
}}var I=new tinymce.dom.TreeWalker(J,H),E;
do{E=I.prev(A)
}while(D(E));
return E===undefined
},isCursorAtEndOf:function(F,E){return E.collapsed&&B.isRangeAtEndOf(F,E)
},isRangeAtEndOf:function(G,F){if(!F||!F.endContainer){throw new Error("range is invalid. received: "+F)
}if(!G||!G.nodeType){throw new Error("container is invalid. received: "+G)
}var H=F.endContainer,E;
if(H.nodeType==3){if(F.endOffset!=H.nodeValue.length){return false
}E=H
}else{E=H.childNodes[F.endOffset===0?F.endOffset:F.endOffset-1]
}var J=new tinymce.dom.TreeWalker(E,G),I;
do{I=J.next(A)
}while(D(I));
return I===undefined||(I.nodeName=="BR"&&J.next(A)===undefined)
},setCursorAtStartOfContents:function(F){if(!F){throw new Error("element is required.")
}if(F.nodeType!==1&&F.nodeType!=3){throw new Error("invalid argument: expected a DOM element or text node, got: "+F)
}var G=tinymce.activeEditor,E=G.dom.createRng();
if(C(F).is("br, img")){E.setStartBefore(F);
E.setEndBefore(F);
G.selection.setRng(E)
}else{G.selection.select(F,true);
G.selection.collapse(true)
}}};
return B
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table.js' */
(function(E){function G(){return AJS.$("#table-highlight-group").attr("data-highlight-colour")||""
}function I(){return !!AJS.$("#table-highlight-group").attr("data-remove-highlight")
}function F(){return !G()
}function A(K){var L;
B(K);
if(!F()){L=G();
K.attr("data-highlight-colour",L);
K.addClass("highlight-"+L)
}}function B(M){var N,L,K,O;
for(N=0,L=M.length;
N<L;
N++){K=M.eq(N);
O=K.attr("data-highlight-colour");
if(O){K.removeClass("highlight-"+O);
K.removeAttr("data-highlight-colour")
}}}function J(O){var M=G();
var L,K,N;
for(L=0,K=O.length;
L<K;
L++){N=O.eq(L).attr("data-highlight-colour")||"";
if(N!==M){return false
}}return true
}function H(K){var L=E(AJS.Rte.getEditor().selection.getNode());
if(!L.length){return false
}if(L[0]===K[0]){return true
}return !!L.closest(K).length
}function D(V,U){if(!V.length){return 
}var O=AJS.Rte.getEditor();
var Q=H(V);
var N=V[0];
var S=N.ownerDocument;
var K=S.createElement(U);
var T=N.attributes;
for(var M=0,L=T.length;
M<L;
M++){var P=T[M];
K.setAttribute(P.nodeName,P.nodeValue)
}while(N.hasChildNodes()){K.appendChild(N.firstChild)
}var R;
N.parentNode.replaceChild(K,N);
if(Q){O.selection.select(K,true);
O.selection.collapse()
}return E(K)
}AJS.Rte=AJS.Rte||{};
AJS.Rte.Table={convertToNormalCells:function(K){K.filter("th").each(function(){var L=E(this);
L=D(L,"td");
L.removeClass("confluenceTh");
L.addClass("confluenceTd")
})
},convertToHeadingCells:function(K){K.filter("td").each(function(){var L=E(this);
L=D(L,"th");
L.removeClass("confluenceTd");
L.addClass("confluenceTh")
})
},areCellsHeadings:function(L){var M=L.filter("th");
var K=M.length;
return(L.length==K)
},isColumnHeading:function(L,K){var N=E(L).children("tbody").children("tr");
if(N.length==1){return false
}var M=N.children().nthCol(K).filter("th");
return(M.length===N.length)
},areCellsHighlighted:function(K){var M=K.filter("td[data-highlight-colour],th[data-highlight-colour]");
var L=M.length;
return(K.length===L&&J(M))
},isColumnHighlighted:function(R,L){var P=E(R).children("tbody").children("tr").children("th,td").nthCol(L);
var Q=P.filter("td[data-highlight-colour],th[data-highlight-colour]");
var O=Q.length;
if(P.length!==O){return false
}var N=P.eq(0).attr("data-highlight-colour");
for(var M=1,K=P.length;
M<K;
M++){if(N!==P.eq(M).attr("data-highlight-colour")){return false
}}return true
}};
function C(R,M){var S,P=M.editor,N=function(W){var U=E(W.getBody()).find("td.mceSelected,th.mceSelected");
if(!U.length){U=E(W.selection.getNode())
}var Y=U.closest("tr"),V=Y.parent(),X=V.is("tbody")?Y.parent().parent():V;
while(Y.length!=0&&!X.is(".confluenceTable")){Y=X.closest("tr");
V=Y.parent();
X=V.is("tbody")?Y.parent().parent():V
}return Y
},Q=function(U){return E(U.selection.getNode()).closest("th.confluenceTh,td.confluenceTd")
},L=function(V){var U=E(V.getBody()).find("th.confluenceTh.mceSelected,td.confluenceTd.mceSelected");
if(U.length){return U
}return Q(V)
},O=function(U){return U.find("tbody > tr > td").length===0
};
P.addCommand("mceInsertTable",function(V,W){AJS.Rte.BookmarkManager.storeBookmark();
if(!S){S=new AJS.Dialog({width:400,height:230,id:"insert-table-dialog",keypressListener:function(X){if(X.keyCode===27){S.hide()
}}});
S.addHeader("Insert Table");
S.addPanel("Panel 1","panel1");
S.getCurrentPanel().html(AJS.renderTemplate("tableForm","4","3"));
E("#tinymce-table-form input[type='text']").click(function(){E(this).select()
});
var U=function(X){X.hide();
P.plugins.table.insertTable()
};
E("#tinymce-table-form").keypress(function(X){if(X.keyCode==13){U(S)
}});
S.addButton("Insert",U,"ok");
S.addCancel("Cancel",function(X){X.hide();
return false
},"cancel")
}S.show()
});
P.addCommand("confTableRowToggleHeading",function(W,U){var X=N(this),Y=X.children("td,th"),V=0;
if(AJS.Rte.Table.areCellsHeadings(Y)){if(!O(X.closest("table"))){Y=Y.filter(function(){var Z=E(this);
var a=Z.closest("table");
V+=Z.attr("colspan")||1;
return !AJS.Rte.Table.isColumnHeading(a,V)
})
}AJS.Rte.Table.convertToNormalCells(Y)
}else{AJS.Rte.Table.convertToHeadingCells(Y)
}});
P.addCommand("confTableColumnToggleHeading",function(Y,V){function X(Z){var a=E([]);
Z.each(function(){var b=E(this);
var c=b.index()+1;
var d=b.closest("table.confluenceTable");
var e=d.children("tbody").children("tr");
a=a.add(e.children().nthCol(c))
});
return a
}var U=L(this);
var W=X(U);
if(AJS.Rte.Table.areCellsHeadings(W)){if(!O(W.closest("table"))){W=W.filter(function(){var Z=E(this);
var c=Z.parent("tr");
var b=c.children();
var a=b.filter("th");
return b.length!==a.length
})
}AJS.Rte.Table.convertToNormalCells(W)
}else{AJS.Rte.Table.convertToHeadingCells(W)
}});
P.addCommand("confTableSelectionToggleHighlight",function(Y,W){var V=W&&W.alwaysHighlight;
var U=L(this);
var Z=U.filter("td");
var X=U.filter("th");
if(AJS.Rte.Table.areCellsHighlighted(U)&&!V||I()){B(U)
}else{A(U)
}});
if(tinymce.isIE8){P.onKeyDown.add(function(X,Z){function Y(b,a,c){while(b!=a){if(b[c]){return false
}b=b.parentNode
}return true
}function U(a,d){var b=P.selection.getRng(true),e=b.startContainer;
if(b.collapsed){var c=Y(e,a,d);
if(e.nodeType==3){return c&&b.startOffset==((d=="nextSibling")?e.length:0)
}else{if(e==a){return b.startOffset==((d=="nextSibling")?e.childNodes.length:0)
}else{return c
}}}return false
}if((Z.keyCode==37||Z.keyCode==39)&&!Z.shiftKey){var W=Q(this);
if(W.length){var V=W[0];
if(Z.keyCode==37&&(U(V,"previousSibling"))){P.execCommand("mceTableMoveCaretToPrevCell");
return tinymce.dom.Event.cancel(Z)
}else{if(Z.keyCode==39&&U(V,"nextSibling")){P.execCommand("mceTableMoveCaretToNextCell");
return tinymce.dom.Event.cancel(Z)
}}}}})
}if(tinymce.isWebKit){var K=E('<style type="text/css"></style>').html(".confluenceTable th,td { white-space: pre-wrap; }");
E(P.getDoc().head).append(K)
}function T(){var V=P.selection.getNode();
if(E(V).parents("table").is(".confluenceTable")){var U=P.dom.getParent(V,"UL,OL");
return !U
}return false
}P.onKeyDown.add(function(U,V){if(V.keyCode==9){if(T()){var W=V.shiftKey?"mceTableMoveCaretToPrevCell":"mceTableMoveCaretToNextCell";
P.execCommand(W);
V.preventDefault();
return false
}}})
}AJS.bind("init.rte",C)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table-picker.js' */
(function(j){var a={};
AJS.Rte.TablePicker={bindToControl:x,disable:D,enable:J,close:m,_internal:a};
var G,b,H,S,r,t,o,n;
var X,R,I,c,g,s;
var U=4;
var h=4;
var L=15;
var W=20;
var Z=25;
var T=17;
var e=20;
var N=0;
var E,B,d,M,p;
var k=false;
function x(y){AJS.debugEnabled()&&AJS.debug("Table Picker - bind to control");
G=j(document);
b=G.find("body");
S=j("#insert-table-dropdown");
r=j("#rte-button-insert-table");
t=S.find(".aui-dd-parent");
o=j("#table-picker-container");
X=o.find(".table-picker-box");
R=o.find(".picker-cell");
I=o.find(".picker-heading");
c=o.find(".picker-selected-cell");
g=o.find(".picker-selected-heading");
s=X.find(".desc");
H=j("<div></div>").attr("id","table-picker-backdrop").addClass("hidden").appendTo(S);
r.click(function(z){z.preventDefault();
if(!k){AJS.Rte.BookmarkManager.storeBookmark();
K()
}});
H.click(O);
c.click(w);
g.click(w)
}function l(){o.css({top:j("#insert-table-dropdown").outerHeight(true)});
l=function(){}
}function K(){var y,AA,AB,z;
l();
p=true;
q(1,1);
v();
H.removeClass("hidden");
o.removeClass("hidden");
f();
t.addClass("active");
r.focus()
}function m(){if(!o.hasClass("hidden")){u();
o.addClass("hidden");
H.addClass("hidden");
C();
t.removeClass("active")
}}function v(){var y=j(AJS.Rte.getEditor().getDoc());
G.bind("mousemove.atlassian-table-picker",P);
G.bind("keydown.atlassian-table-picker",F);
G.bind("keyup.atlassian-table-picker",F);
y.bind("keydown.atlassian-table-picker",F);
y.bind("keyup.atlassian-table-picker",F)
}function u(){var y=j(AJS.Rte.getEditor().getDoc());
G.unbind(".atlassian-table-picker");
y.unbind(".atlassian-table-picker")
}function D(){k=true;
S.addClass("disabled")
}function J(){k=false;
S.removeClass("disabled")
}function q(z,y){AJS.debugEnabled()&&AJS.debug("setSize("+[z,y]+")");
if(z==d&&y==M){return 
}z=Math.max(1,Math.min(L,z));
y=Math.max(1,Math.min(W,y));
E=Math.max(U,z);
B=Math.max(h,y);
d=z;
M=y;
X.width(E*Z+1);
X.height(B*T+e);
A(R,E,B);
A(c,d,M);
A(I,E,1);
A(g,d,1);
Y();
s.text(d+" x "+M);
if(!o.hasClass("hidden")){f()
}}function Y(){I.toggleClass("hidden",!p);
g.toggleClass("hidden",!p)
}function A(z,AA,y){z.width(Z*AA+1);
z.height(T*y+1)
}function f(){C();
n=Raphael.shadow(0,0,o.width(),o.height(),{target:o[0]});
n.offset(o.offset());
n.css("z-index",9999)
}function C(){if(n){n.remove();
n=null
}}function P(AH){var AF=R.offset(),AG=AF.top-G.scrollTop(),AA=AF.left-G.scrollLeft(),AJ=AG+R.outerHeight(true)+N,AE=AJ-T-N,AI=AA+R.outerWidth(true)+N,z=AI-Z-N,AB=AH.clientY,AC=AH.clientX,AL,AK,AD=E,y=B;
AJS.debugEnabled()&&AJS.debug("[mouseX,spLeft,spRightShrink,spRightGrow][mouseY,spTop,spBottomShrink,spBottomGrow] = "+[AC,AA,z,AI]+"/"+[AB,AG,AE,AJ]);
if(AC>AI){AL=AC-AI;
AK=~~((AL/Z)+1);
AD+=AK;
AJS.debugEnabled()&&AJS.debug("grow: xdelta = "+AK)
}else{if(AC<z){AL=AC-z;
AK=~~((AL/Z)-1);
AD+=AK;
AJS.debugEnabled()&&AJS.debug("shrink: xdelta = "+AK)
}}if(AB>AJ){AL=AB-AJ;
AK=~~((AL/T)+1);
y+=AK;
AJS.debugEnabled()&&AJS.debug("grow: ydelta = "+AK)
}else{if(AB<AE){AL=AB-AE;
AK=~~((AL/T)-1);
y+=AK;
AJS.debugEnabled()&&AJS.debug("shrink: ydelta = "+AK)
}}q(AD,y)
}function Q(y){AJS.debugEnabled()&&AJS.debug("enableHeading("+y+")");
if(y!=p){p=y;
Y()
}}function i(AC){var AB=~~(AC.offsetX||AC.originalEvent.layerX),AA=~~(AC.offsetY||AC.originalEvent.layerY),z=(~~(AB/Z))+1,y=(~~(AA/T))+1;
if(z<1||z>L||y<1||y>W){return null
}return{width:z,height:y}
}function w(z){var y=i(z);
z.preventDefault();
AJS.log("insertTable: size = "+(y&&[y.width,y.height]));
if(y){m();
V(y.width,y.height,p)
}}function V(AB,y,z){var AA,AC,AD;
AJS.debugEnabled()&&AJS.debug("shamefulInsertTable("+AB+","+y+","+z+")");
AA=j("#tinymce-table-form");
if(!AA.length){AC=AJS.renderTemplate("tableForm",y,AB);
AD=j("<div></div>").addClass("hidden");
AD.append(AC);
b.append(AD)
}else{AA.find('input[name="rows"]').val(y);
AA.find('input[name="cols"]').val(AB)
}j("#table-heading-checkbox").prop("checked",z);
AJS.Rte.BookmarkManager.restoreBookmark();
tinymce.activeEditor.undoManager.beforeChange();
tinymce.activeEditor.plugins.table.insertTable();
AD&&AD.remove()
}function F(y){AJS.debugEnabled()&&AJS.debug("key: "+y.charCode+"/"+y.keyCode+"/"+y.shiftKey);
AJS.log("key: "+y.charCode+"/"+y.keyCode+"/"+y.shiftKey);
if(j.browser.msie){if(y.keyCode==16){Q(!y.shiftKey)
}if(y.keyCode==27){m()
}}else{if(y.charCode==0){Q(!y.shiftKey)
}if(y.keyCode==27&&y.charCode==0){m()
}}}function O(y){m()
}a.insertTable=w
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table-migration.js' */
(function(B){function A(D){D.each(function(){var G=this;
var F=B(this);
var E=F.attr("data-highlight-class");
var H;
if(F.hasClass("nohighlight")){F.removeClass("nohighlight");
AJS.Rte.Table.convertToNormalCells(F);
return 
}else{if(F.hasClass("highlight")){F.removeClass("highlight");
if(!E){F.attr("data-highlight-colour","grey");
F.addClass("highlight-grey")
}}}if(E){F.removeClass(E);
F.removeAttr("data-highlight-class");
switch(E){case"warning":H="red";
break;
case"success":H="green";
break;
case"note":H="yellow";
break;
case"info":H="blue";
break
}if(H){F.addClass("highlight-"+H);
F.attr("data-highlight-colour",H)
}}})
}function C(H){H=H||B(AJS.Rte.getEditor().getBody());
var G=new Date().getTime();
var D=H.find("td.highlight,th.nohighlight,td[data-highlight-class],th[data-highlight-class]");
var F=new Date().getTime();
A(D);
var E=new Date().getTime();
AJS.log("Migration duration: selector: "+(F-G)+"ms; migration: "+(E-F)+"ms")
}AJS.Rte.Migration=AJS.Rte.Migration||{};
AJS.Rte.Migration.Table={migrateTables:C};
B(document).bind("postPaste",function(E,D,F){AJS.Rte.Migration.Table.migrateTables()
});
AJS.bind("init.rte",function(){AJS.Rte.Migration.Table.migrateTables()
})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/editor_plugin_src.js' */
(function(H){var G='<style type="text/css">.wiki-content .text-placeholder { display: inline; }</style>';
var N='<style type="text/css">.wiki-content .text-placeholder { display: inline-block; }</style>';
var K={click:false,keypress:true};
var L=tinymce.VK;
var M=tinymce.dom.Event;
var B=(AJS.Meta.get("content-type")==="template");
function J(){var O=H(AJS.Rte.getEditor().getDoc()).find("head");
if(H.browser.msie){O.append(G)
}else{O.append(N)
}}function F(O){AJS.trigger("cursor-target-refresh");
H("#rte-button-insert-placeholder").click(function(P){P.preventDefault();
AJS.Rte.Placeholder.insertTextPlaceHolder()
});
O.onKeyPress.addToTop(function(P,R){if(R.keyCode==13&&!R.shiftKey){var Q=P.selection.getNode(),S=H(Q).closest(".text-placeholder");
if(S.length&&AJS.Rte.Cursor.isCursorAtEnd(P,P.selection.getRng(),Q)){AJS.Rte.Cursor.insertParagraph(P,S,true);
return tinymce.dom.Event.cancel(R)
}}})
}var I={UL:true,OL:true,LI:true,TABLE:true,TBODY:true};
function E(O){return !I[O.nodeName]
}function A(O,Q){var P=Q.previousSibling;
var R;
while(Q&&!P){Q=Q.parentNode;
P=Q.previousSibling
}if(P){R=P;
while(!E(R)){if(!R.lastChild){break
}R=R.lastChild
}O.selection.select(R.lastChild||R);
O.selection.collapse(false);
O.selection.normalize()
}}function D(O,Q){var P=Q.nextSibling;
var R;
while(Q&&!P){Q=Q.parentNode;
P=Q.nextSibling
}if(P){R=P;
while(!E(R)){if(!R.firstChild){break
}R=R.firstChild
}O.selection.select(R.firstChild||R);
O.selection.collapse(true);
O.selection.normalize()
}}function C(O){function U(){var W=H(AJS.Rte.getEditor().getBody());
var X=W.find(".text-placeholder.selected");
if(X.length){AJS.Rte.getEditor().selection.select(X[0])
}}function S(W){W.onKeyDown.addToTop(Q);
W.onKeyPress.addToTop(P);
W.onClick.addToTop(P)
}function R(W){W.onKeyDown.remove(Q);
W.onKeyPress.remove(P);
W.onClick.remove(P)
}function Q(X,Y){var W=H(X.getBody());
var Z=W.find(".text-placeholder.selected");
if(!Z.length){R(X);
return 
}if(Y.keyCode===L.LEFT||Y.keyCode===L.UP){A(X,Z[0]);
return M.cancel(Y)
}else{if(Y.keyCode===L.RIGHT||Y.keyCode===L.DOWN){D(X,Z[0]);
return M.cancel(Y)
}else{if(Y.keyCode===L.BACKSPACE||Y.keyCode===L.DELETE){AJS.Rte.Placeholder.removePlaceholder(Z);
return M.cancel(Y)
}}}}function P(X,Y){if(tinymce.isGecko&&(!Y.isChar&&Y.type==="keypress")){return 
}var W=H(X.getBody());
var a=W.find(".text-placeholder.selected");
if(!a.length){R(X);
return 
}if(a.length){var Z=a.attr("data-placeholder-type");
if(V(Z,Y.type)){AJS.Rte.Placeholder.removePlaceholder(a);
AJS.trigger("editor.text-placeholder.activated",{placeholderType:Z||"",triggerEvent:Y})
}}}function V(Y,X){var W=AJS.Rte.Placeholder.getPlaceholderType(Y);
var Z=H.extend({},K,W&&W.activation);
return !!Z[X]
}function T(X,W,Y){var Z=H(Y).closest(".text-placeholder");
H(X.getBody()).find(".text-placeholder.selected").not(Z).removeClass("selected");
if(Z.length){if(!Z.hasClass("selected")){Z.addClass("selected");
S(X)
}setTimeout(U,0)
}else{R(X)
}}O.onNodeChange.addToTop(T)
}tinymce.create("tinymce.plugins.TextPlaceholderPlugin",{init:function(O){O.onInit.add(function(){if(B){F(O)
}else{C(O)
}J()
})
},getInfo:function(){return{longname:"Text Placeholder Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}
}});
tinymce.PluginManager.add("textplaceholders",tinymce.plugins.TextPlaceholderPlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/placeholder.js' */
(function(E){var C=[];
var B={};
AJS.Rte=AJS.Rte||{};
AJS.Rte.Placeholder=AJS.Rte.Placeholder||{};
var A;
var D;
if(tinymce.isIE){A="\uFEFF{$caret}";
D="<p>{$caret}</p>"
}else{if(tinymce.isWebKit){A="\uFEFF{$caret}<br>";
D=A
}else{A="\uFEFF{$caret}";
D=A
}}E.extend(AJS.Rte.Placeholder,{insertTextPlaceHolder:function(F){var G=E("<div></div>").append(AJS.Rte.Placeholder.Templates.textPlaceholder({content:A}));
F&&G.find(".text-placeholder").html(F);
AJS.Rte.getEditor().execCommand("mceInsertContent",false,G.html())
},removePlaceholder:function(J){var G=AJS.Rte.getEditor();
var F=E(G.getBody());
var I=A;
if(J.parent()[0].nodeName==="LI"){I=D
}J.replaceWith('<span id="placeholder-cursor">&nbsp;</span>');
var H=F.find("#placeholder-cursor")[0];
G.selection.select(H.firstChild);
G.execCommand("mceInsertContent",false,I);
G.dom.remove(H,true)
},addPlaceholderType:function(F){if(!F||!F.type){AJS.log("PlaceHolderRegister : unable to register new place holder type !");
return 
}C.push(F);
B[F.type]=F
},getPlaceholderTypes:function(){return[].concat(C)
},getPlaceholderType:function(F){return B[F]
}})
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/tinyMce-property-panel-text-placeholders.js' */
(function(A){AJS.Confluence.PropertyPanel.TextPlaceholder=(function(){return{name:"textplaceholder",canHandleElement:function(B){return B.hasClass("text-placeholder")
},handle:function(E){if(E.e.type!="click"&&E.e.type!="mouseup"){return 
}var K=AJS.Rte.Placeholder.getPlaceholderTypes();
var B=E.containerEl;
var L=A(B);
var I=L.attr("data-placeholder-type");
var J=[];
function M(O){if(O==="default"){L.removeAttr("data-placeholder-type")
}else{L.attr("data-placeholder-type",O)
}var N=A(".text-placeholder-property-panel-type-"+O);
N.parent().find(".text-placeholder-property-panel-type-item").removeClass("selected");
N.addClass("selected")
}function F(N,P,O){return{className:"text-placeholder-property-panel-type-item text-placeholder-property-panel-type-"+N,text:P,tooltip:O,selected:I===N,click:function(){M(N)
}}
}var H=F("default","Text","Instructional text is replaced with empty content when a person types.");
H.selected=!I;
J.push(H);
var G;
for(var D=0,C=K.length;
D<C;
D++){G=K[D];
J.push(F(G.type,G.label,G.tooltip))
}J.push(null);
J.push({className:"text-placeholder-property-panel-remove-button",text:"Remove",click:function(){AJS.Confluence.PropertyPanel.destroy();
AJS.Rte.Placeholder.removePlaceholder(L)
}});
AJS.Confluence.PropertyPanel.createFromButtonModel("textplaceholder",B,J,{anchorIframe:AJS.Rte.getEditorFrame()})
}}
})()
})(AJS.$);
AJS.bind("init.rte",function(){if(AJS.Meta.get("content-type")==="template"){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.TextPlaceholder)
}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/placeholder.soy' */
// This file was automatically generated from placeholder.soy.
// Please don't edit this file by hand.

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Rte == 'undefined') { AJS.Rte = {}; }
if (typeof AJS.Rte.Placeholder == 'undefined') { AJS.Rte.Placeholder = {}; }
if (typeof AJS.Rte.Placeholder.Templates == 'undefined') { AJS.Rte.Placeholder.Templates = {}; }


AJS.Rte.Placeholder.Templates.textPlaceholder = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="text-placeholder">', opt_data.content, '</span>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/imageproperties/js/image-properties-dialog.js' */
Confluence.Editor.ImageProps=(function(E){var J,L,H={},M="dialog-created.image-properties",D="dialog-before-show.image-properties",A;
return{init:P,registerPanel:G};
function P(){if(!A){L=null;
if(C().length>0){A=true;
AJS.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(){return{className:"image-properties",text:"Properties",tooltip:"Set additional image properties",click:function(R,Q){AJS.Confluence.PropertyPanel.destroy();
B(Q)
}}
}})
}}}function B(Q){E("#image-properties-dialog").remove();
J=new AJS.ConfluenceDialog({id:"image-properties-dialog",onSubmit:I});
AJS.trigger(M,{img:Q});
J.popup.element.attr("data-tab-default","0");
J.addHeader("Image Properties");
J.addSubmit("Save",I);
J.addCancel("Cancel",N);
O(J);
AJS.trigger(D);
J.show()
}function O(T){var R=C();
for(var S=0;
S<R.length;
S++){var U=R[S];
var Q=H[U.key];
if(Q){T.addPanel(U.label,Q.content,Q.panelClass,U.key)
}}if(R.length===1){T.popup.element.find(".dialog-page-menu").show()
}}function G(T,S,Q,R){H[T]={content:S,panelClass:Q,saveFn:R}
}function C(){if(!L){L=E("#image-properties-tab-items > div").map(function(){var Q=E(this);
return{key:Q.text(),weight:Q.attr("data-weight"),label:this.title}
}).sort(function(R,Q){return R.weight-Q.weight
})
}return L
}function I(){K();
var S=[];
for(var R in H){var Q=H[R];
var T=Q.saveFn&&Q.saveFn();
if(T&&T.done){S.push(T)
}}var U=E.when.apply(E,S);
U.done(function(){F();
J.hide().remove()
})
}function N(){J.hide().remove()
}function K(){var T=J.popup.element,Q=50,R=E('<div class="image-properties-loading-blanket"><div class="loading-data"></div></div>').appendTo(T.find(".dialog-page-body")),S=R.find(".loading-data");
R.css({width:R.parent().width(),height:T.height()});
S.css({marginTop:-Q*1.2,marginLeft:-Q*1.2});
S.data("spinner",Raphael.spinner(S[0],Q,"#666"))
}function F(){var Q=J.popup.element.find(".image-properties-loading-blanket .loading-data"),R=Q.data("spinner");
Q.css({marginTop:"",marginLeft:""});
if(R){R();
delete R;
Q.data("spinner",null)
}Q.closest(".image-properties-loading-blanket").remove()
}})(AJS.$);
AJS.toInit(Confluence.Editor.ImageProps.init);
AJS.bind("quickedit.success",Confluence.Editor.ImageProps.init);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMceAdapter.js' */
(function(B){function A(){AJS.log("TinyMceAdapter: initTinyMce");
var F=Confluence.getContextPath();
var D="wiki-content",C="auiwindowmanager,table,emotions,confluence,macroplaceholder,customtoolbar,insertwikimarkup,propertypanel,keyboardshortcuts,confmonospace,confcharmap,lists,confluencepaste,cursorTarget,confluencecleanupplugin,conftable,confluencepastetableplugin,confluencepastemacroplugin,showformat,pagelayoutplugin,highlightnode,iosediting,searchreplace,autoconvert,confluencelist,deletecommand,confluencetasklist,draggable,confluencesortabletablesplugin,textplaceholders";
var G={autoresize_min_height:"100%",width:"100%",height:"100%",document_base_url:Confluence.getBaseUrl()+"/",plugins:C,theme:"atlassian",theme_advanced_buttons1:"formatselect,bold,italic,underline,strikethrough,forecolor,separator,table,row_before,row_after,delete_row,col_before,col_after,delete_col,delete_table,separator,bullist,numlist,tasklist,outdent,indent,blockquote,justifyleft,justifycenter,justifyright,justifyfull,separator,sup,sub,separator,undo,redo,separator,confimage,conf_macro_browser,separator,code,customtoolbar,help,monospace,separator,searchreplace",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:false,theme_advanced_resize_horizontal:false,theme_advanced_statusbar_location:"none",theme_advanced_path:false,theme_advanced_blockformats:"p,h1,h2,h3,h4,h5,h6,pre,blockquote",mode:"specific_textareas",editor_selector:"tinymce-editor",body_class:D,popup_css:false,content_css:false,editor_css:false,custom_undo_redo:true,custom_undo_redo_levels:20,context_path:F,plugin_action_base_path:F+"/plugins/tinymce",editor_plugin_action_base_path:F+"/plugins/editor/tinymce",page_id:AJS.Meta.get("page-id"),draft_type:null,form_name:AJS.Meta.get("form-name"),space_key:encodeURI(AJS.Meta.get("space-key")),confluence_popup_width:620,confluence_popup_height:550,editor_id:"wysiwygTextarea"};
if(G.page_id==0){G.page_id=null;
G.draft_type=AJS.Meta.get("draft-type")
}AJS.Rte.BootstrapManager.addBeforeInitCallback(function(H){AJS.log("RTE refresh.settings handler: Modifying settings with values derived from the editor DOM.");
if(AJS.Rte.getEditorContainer().hasClass("resize")){AJS.log("RTE refresh.settings handler: The editor container has the resize class so the Editor will grow as required.");
H.plugins+=",autoresize";
H.body_class+=" editor-comment"
}else{AJS.log("RTE refresh.settings handler: The Editor should be full size");
H.plugins+=",flextofullsize";
H.body_class+=" fullsize"
}if(AJS.Meta.get("content-type")==="template"){H.body_class+=" template-editor"
}H.contentCssTags=AJS.$("script[title='editor-css']").html();
H.language=AJS.Meta.get("action-locale");
var I=AJS.Meta.get("min-editor-height");
if(I){H.autoresize_min_height=I
}});
AJS.Rte.BootstrapManager.preInitialise(G);
var E=AJS.Meta.get("auto-start");
if(E==null){E=false;
AJS.log("TinyMceAdapter: auto-start meta data was not set. Default to false.")
}if(AJS.Meta.get("auto-start")){AJS.log("TinyMceAdapter: auto-start=true. Calling AJS.Rte.BootstrapManager.initialise()");
AJS.Rte.BootstrapManager.initialise()
}else{AJS.log("TinyMceAdapter: Pre-initialisation complete. auto-start=false. You can now call AJS.Rte.BootstrapManager.initialise() to activate TinyMce.")
}}AJS.toInit(A)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-adapter-deprecated.js' */
(function(A){AJS.Editor.Adapter={putCursorAtPostionInElement:function(C,B,G){var E=tinyMCE.activeEditor,H=E.getDoc();
var F=A(C,G||H);
F=F.contents().filter(function(){return this.nodeType==3
})[0];
var D=E.selection.getRng(true);
D.setStart(F,B);
D.setEnd(F,B);
E.selection.setRng(D)
},storeCurrentSelectionState:AJS.Rte.BookmarkManager.storeBookmark,restoreSelectionState:AJS.Rte.BookmarkManager.restoreBookmark,insertLink:function(C,B){if(B){AJS.Rte.getEditor().selection.select(B)
}Confluence.Editor.LinkAdapter.setLink(C)
},getCurrentBaseUrl:AJS.Rte.getCurrentBaseUrl,addOnInitCallback:function(B){AJS.log("Adding callback to AJS.Rte.BootstrapManager. AJS.Rte.BootstrapManager = "+AJS.Rte.BootstrapManager);
AJS.Rte.BootstrapManager.addOnInitCallback(B)
},bindScroll:function(B,C){AJS.Rte.bindScroll(B,C)
},unbindScroll:function(B){AJS.Rte.unbindScroll(B)
},getTinyMceHasInit:function(){return AJS.Rte.BootstrapManager.isInitComplete()
},getEditor:AJS.Rte.getEditor,addTinyMcePluginInit:function(B){AJS.Rte.BootstrapManager.addTinyMcePluginInit(B)
},isExternalLink:function(B){return Confluence.Link.isExternalLink(B)
},isInMacroPlaceholder:function(B){return tinymce.confluence.MacroUtils.isInMacro(B)
},initialiseTinyMce:function(){var B=AJS.Editor.Adapter;
tinymce.EditorManager.preInit.apply(tinymce.EditorManager);
tinymce.EditorManager.init(B.settings)
},offset:function(B){AJS.Rte.Content.offset(B)
},getSelectedText:function(){return AJS.Rte.Content.getSelectedText()
},setEditorValue:function(B){AJS.Rte.Content.setHtml(B)
},getEditorHTML:function(){return""+AJS.Rte.getEditor.getContent()
},editorHasContentChanged:function(){return AJS.Rte.getEditor().isDirty()
},editorResetContentChanged:function(){AJS.Rte.getEditor().setDirty(false)
},getChildIndex:function(C,F){var E=C.childNodes;
for(var D=0,B=E.length;
D<B;
D++){if(E[D]==F){return D
}}return -1
},getMainEditor:function(){return AJS.Rte.getMainEditor()
},getEditorContainer:function(){return AJS.Rte.getEditorContainer()
},getEditorFrame:function(){return AJS.Rte.getEditorFrame()
},getEditorTable:function(){return AJS.Rte.getEditorTable()
},webResourcePath:AJS.Rte.webResourcePath,getResourceUrlPrefix:function(){return AJS.Rte.getResourceUrlPrefix()
},getTinyMceBaseUrl:function(){return AJS.Rte.getTinyMceBaseUrl()
},getMinEditorHeight:function(){return AJS.Rte.getMinEditorHeight()
},getTinyMceEditorMinHeight:function(B){return AJS.Rte.getTinyMceEditorMinHeight(B)
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jiraAnalytics', location = '/jira/jiraanalytics.js' */
AJS.Editor.JiraAnalytics={events:{paste:{key:"confluence.jira.plugin.paste"},panelAction:{key:"confluence.jira.plugin.panel.action"},search:{key:"confluence.jira.plugin.search"},trigger:{key:"confluence.jira.plugin.trigger"},customizeColumn:{key:"confluence.jira.plugin.column.customize"}},linkTypes:{jqlDirect:"direct_jql",jql:"jql_link",xml:"xml_link",rss:"rss_link",filter:"filter_link"},setupPanelActionProperties:function(a,d,b){var c={};c.action=a.analyticName;if(d===AJS.Editor.JiraConnector.source.instructionalText){if(a.analyticName==="create_new"){c.issueType=a.container.find('select[name="issuetype"] :selected').text()}else{if(a.analyticName==="search"){var e="single";if(a.container.find("#opt-table").is(":checked")){e="table"}else{if(a.container.find("#opt-total").is(":checked")){e="count"}}c.display=e}}c.label=b}return c},triggerPasteEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.paste.key,properties:a})},triggerPannelActionEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.panelAction.key,properties:a})},triggerSearchEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.search.key,properties:a})},triggerMarkupEvent:function(a){this.triggerSearchEvent(a)},triggerPannelTriggerEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.trigger.key,properties:a})},triggerCustomizeColumnEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.customizeColumn.key,properties:a})}};(function(a){a.aop.before({target:AJS.MacroBrowser,method:"loadMacroInBrowser"},function(b,c){if(b&&b[0]&&b[0].pluginKey=="confluence.extra.jira"){AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:AJS.Editor.JiraConnector.source.macroBrowser})}});a.aop.before({target:tinymce.confluence.macrobrowser,method:"macroBrowserToolbarButtonClicked"},function(b,c){if(b&&b[0]&&b[0].presetMacroMetadata&&b[0].presetMacroMetadata.pluginKey=="confluence.extra.jira"){AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:AJS.Editor.JiraConnector.source.editorBraceKey})}});AJS.bind("init.rte",function(){a.aop.before({target:tinyMCE.activeEditor,method:"execCommand"},function(l,k){if(l&&l[0]=="mceInsertContent"&&l[2]){var m=l[2];var e=a("<div></div>").html(m).children().first();var c=e.attr("data-macro-name");var h=["jira","jiraissues"];if(a.inArray(c,h)==-1){return}var j=AJS.Editor.JiraAnalytics;var n={source:"wiki_markup"};if(!e.attr("data-macro-parameters")){return}var g=e.attr("data-macro-parameters").split("|");for(var f=0;f<g.length;f++){var d=a.trim(g[f]);if(d.indexOf("jql")==0||d.indexOf("jqlQuery")==0){n.type=j.linkTypes.jqlDirect;break}else{if(d.indexOf("url")==0){var b=a.trim(d.substring(d.indexOf("=")+1,d.length));n.type=AJS.JQLHelper.checkQueryType(b);break}else{if(d.indexOf("http")==0){var b=d;n.type=AJS.JQLHelper.checkQueryType(b);break}}}}if(typeof n.type==="undefined"){n.type=j.linkTypes.jqlDirect}j.triggerMarkupEvent(n)}})})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jqlHelper', location = '/jira/jqlhelper.js' */
AJS.JQLHelper=(function(){var a=/^\s*((key|issuekey)\s*=\s*)?([A-Z]+)([0-9]+)?([A-Z]+)?-([0-9]+)\s*$/i;var e=/\s*([A-Z][A-Z]+)-[0-9]+\s*/;var j=/(issue|searchrequest)-xml/i;var g=/\/(i#)?browse\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+$)/i;var i=/\/jira\.issueviews:issue-xml\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+)\//;var c=/(jqlQuery|jql)\=([^&]+)/i;var h=/(\?|&)(requestId|filter)\=([^&]+)/i;var b=/(searchrequest-xml\/)([0-9]+)\/SearchRequest/i;var k=/(requestId|filter)\=([^&]+)/i;var d=/=|!=|~|>|<|!~| is | in | was | changed /i;var f=function(p){var m="";var q=g.exec(p);if(q){m="key="+q[2]}else{var n=c.exec(p);if(n){m=n[2]}else{var o=e.exec(p);if(o){m="key="+o[0]}}}m=m.replace(/\+/g," ");return m};var l=function(n,p){var m;var o=decodeURIComponent(n);var q=function(r){if(r.jql){m=r.jql}};AJS.JQLHelper.getJqlQueryFromJiraFilter(o,p,q);return m};return{isSingleKeyJQLExp:function(m){return a.exec(m)},isMultipleSingleKeyJQLExp:function(p){var o=p.split(",");for(var n in o){var m=$.trim(o[n]);if(!AJS.JQLHelper.isSingleKeyJQLExp(m)){return false}}return true},isIssueUrlOrXmlUrl:function(m){if(g.test(m)||j.test(m)||c.test(m)||i.test(m)){return true}return false},isFilterUrl:function(m){return h.test(m)||b.test(m)},getFilterFromFilterUrl:function(m){if(h.test(m)){var n=h.exec(m);return n[2]+"="+n[3]}else{if(b.test(m)){return"filter="+b.exec(m)[2]}}},getJqlQueryFromJiraFilter:function(p,q,r,o){var m=(h.exec(p)||b.exec(p))[2];var n="/rest/jiraanywhere/1.0/jira/appLink/"+q+"/filter/"+m;AJS.$.ajax({async:false,dataType:"json",url:Confluence.getContextPath()+n,success:r,error:o})},findServerIndexFromUrl:function(m,p){if(typeof(p)!=="undefined"||p.length>0){var o=m.toLowerCase();for(var n=0;n<p.length;n++){if(o.indexOf(p[n].url.toLowerCase())==0){if(m.charAt(p[n].url.length)=="/"){return n}}}}return -1},getJqlQueryFromUrl:f,getJqlAndServerIndexFromUrl:function(n,o){var m={};m.serverIndex=this.findServerIndexFromUrl(n,o);m.jqlQuery=f(n);return m},checkQueryType:function(m){if(!AJS.Editor.JiraAnalytics){return undefined}if(!m||$.trim(m).length==0){return}if(m.indexOf("http")!=0){return AJS.Editor.JiraAnalytics.linkTypes.jqlDirect}else{if(m.indexOf("jira.issueviews:searchrequest-xml")!=-1||m.indexOf("jira.issueviews:issue-xml")!=-1){return AJS.Editor.JiraAnalytics.linkTypes.xml}else{if(m.indexOf("jira.issueviews:searchrequest-rss")!=-1){return AJS.Editor.JiraAnalytics.linkTypes.rss}else{if(m.indexOf("filter=")!=-1||m.indexOf("filter\\=")!=-1){return AJS.Editor.JiraAnalytics.linkTypes.filter}else{return AJS.Editor.JiraAnalytics.linkTypes.jql}}}}},convertToJQL:function(n,p){var o;if(AJS.$.trim(n)!==""){if(n.indexOf("http")===0&&this.isFilterUrl(n)){o=l(n,p)}else{if(n.indexOf("http")===0&&this.isIssueUrlOrXmlUrl(n)){var m=f(decodeURIComponent(n));if(m.length>0){o=m}}else{if(n.indexOf("http")!==0&&n.match(d)){o=n}else{if(n.match(e)){o="key="+n}else{o='summary ~ "'+n+'" OR description ~ "'+n+'"'}}}}}return o}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/datatable.js' */
(function(a){AJS.DataTable=function(h,d,b){var g=null;if(h&&h.jquery){g=h}else{if(typeof h=="string"){g=a(h)}}g.addClass("data-table");if(d&&d.length){this.columns=d;var f=a("<tr></tr>").appendTo(g);f.addClass("data-table-header");for(var c=0;c<d.length;c++){var e=d[c];f.append('<th class="'+e.className+'">'+e.title+"</th>")}}this.tbl=g;this.rowIdx=0};AJS.DataTable.prototype.addRow=function(e){var f=a("<tr></tr>").appendTo(this.tbl);var c=this.columns;for(var b=0;b<this.columns.length;b++){var d=c[b];var g=a("<td></td>").appendTo(f);g.addClass(d.className);d.renderCell(g,e)}f.data("row-data",e);this._bindRowJs(f,this.rowIdx,"selected","hover");this.rowIdx+=1;f.attr("tabindex","-1")};AJS.DataTable.prototype.selectRow=function(b){var c=a("tbody tr",this.tbl)[b+1];a(c).focus()};AJS.DataTable.prototype._bindRowJs=function(f,g,c,b){var e=this;f.click(function(i){if(c){a(e.tbl).find("."+c).removeClass(c);a(this).addClass(c)}var h=f.data("row-data");e.tbl.trigger("row-select",[h])});var d=function(k){switch(k.keyCode){case 13:var j;var h=f.data("row-data");f.keyup(j=function(l){e.tbl.trigger("row-action",[h]);f.unbind("keyup",j);return AJS.stopEvent(l)});return AJS.stopEvent(k);break;case 38:if(g>0){f.prev().focus()}return AJS.stopEvent(k);case 40:var i=a("tbody tr",e.tbl).length;if(g<i-1){f.next().focus()}return AJS.stopEvent(k)}};if(a.browser.mozilla){f.keypress(d)}else{f.keydown(d)}f.focus(function(h){f.click()});if(b){f.hover(function(){a(this).addClass(b)},function(){a(this).removeClass(b)})}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/dialogs.js' */
(function(){tinymce.create("tinymce.plugins.JiraLink",{init:function(a){a.addCommand("mceJiralink",AJS.Editor.JiraConnector.hotKey);a.onPostRender.add(function(b){AJS.$.get(Confluence.getContextPath()+"/rest/jiraanywhere/1.0/servers",function(c){AJS.Editor.JiraConnector.servers=c});AJS.$("#jiralink").click(function(c){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.editorDropdownLink,true);return AJS.stopEvent(c)});AJS.$("#insert-menu .macro-jiralink").show();b.addShortcut("ctrl+shift+j","","mceJiralink")})},getInfo:function(){return{longname:"Confluence Jira Connector",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("jiraconnector",tinymce.plugins.JiraLink)})();AJS.Editor.Adapter.addTinyMcePluginInit(function(b){b.plugins+=",jiraconnector";var c=b.theme_advanced_buttons1;var a=c.indexOf("confimage");b.theme_advanced_buttons1=c.substring(0,a)+"jiralinkButton,"+c.substring(a)});AJS.Editor.JiraConnector=(function(j){var f="";var c="Insert JIRA Issue";var a="Insert";var h="Cancel";var l=function(){var p=navigator.platform.toLowerCase().indexOf("mac")!=-1;return p?"Cmd":"Ctrl"};var b={macroBrowser:"macro_browser",editorBraceKey:"editor_brace_key",editorHotKey:"editor_hot_key",editorDropdownLink:"editor_dropdown_link",instructionalText:"instructional text"};var o=AJS.format("Hint: type \"{0}+Shift+J\" in the editor to quickly access this dialog.",l());var n;var m;var d;var i=function(){var p=j("#createPageLabelsString");if(p.length>0){m=p.val().split(" ").join();AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n,label:m});return}j.getJSON(AJS.Meta.get("base-url")+"/rest/ui/1.0/content/"+AJS.Meta.get("page-id")+"/labels",function(r){var q=[];j.each(r.labels,function(t,s){q.push(s.name)});m=q.join();AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n,label:m})})};var g=function(p,q){if(AJS.Editor.JiraAnalytics){AJS.Editor.JiraConnector.analyticProperties=AJS.Editor.JiraAnalytics.setupPanelActionProperties(q,n,m);if(p.customizedColumn){AJS.Editor.JiraAnalytics.triggerCustomizeColumnEvent({columns:p.customizedColumn})}}};var e=function(s){if(!d){d=new AJS.ConfluenceDialog({width:840,height:590,id:"jira-connector"});d.addHeader(c);var r=AJS.Editor.JiraConnector.Panels;for(var t=0;t<r.length;t++){d.addPanel(r[t].title());var v=d.getCurrentPanel();var q=r[t];q.init(v)}d.addLink("Select Macro",function(){d.hide();AJS.MacroBrowser.open(false)},"dialog-back-link");d.addHelpText(o);j("#jira-connector .dialog-tip").attr("title",o);d.addButton(a,function(){var y=d.getCurrentPanel().id;var x=r[y];var w=r[0];g(w,x);x.insertLink()},"insert-issue-button");AJS.$(".insert-issue-button").disable();d.addCancel(h,function(){AJS.Editor.JiraConnector.closePopup()});d.gotoPanel(0);if(AJS.Editor.JiraConnector.servers){for(var t=0;t<AJS.Editor.JiraConnector.servers.length;t++){var u=AJS.Editor.JiraConnector.servers[t];AppLinks.makeRequest({appId:u.id,type:"GET",url:"/rest/api/2/field",dataType:"json",serverIndex:t,success:function(w){if(w&&w.length){AJS.Editor.JiraConnector.servers[this.serverIndex].columns=w}},error:function(){AJS.log("Jira Issues Macro: unable to retrieve fields from AppLink: "+u.id)}})}}}d.show();if(s){d.gotoPanel(1);var p=AJS.Editor.JiraConnector.Panels[1];p.setSummary(s)}else{d.gotoPanel(0)}};var k=function(){if(AJS.Editor.JiraConnector.clickConfigApplink){AJS.$.ajax({url:Confluence.getContextPath()+"/rest/jiraanywhere/1.0/servers",async:false}).done(function(p){AJS.Editor.JiraConnector.servers=p})}if(typeof(AJS.Editor.JiraConnector.servers)=="undefined"||AJS.Editor.JiraConnector.servers.length==0){AJS.Editor.JiraConnector.warningPopup(AJS.Meta.get("is-admin"));return false}AJS.Editor.JiraConnector.clickConfigApplink=false;if(AJS.Editor.JiraConnector.refreshAppLink){AJS.Editor.JiraConnector.refreshAppLink.call();AJS.Editor.JiraConnector.refreshAppLink=false}return true};return{warningPopup:function(r){var p=new AJS.ConfluenceDialog({width:600,height:400,id:"warning-applink-dialog"});var q="Connect Confluence To JIRA";p.addHeader(q);var s=Confluence.Templates.ConfluenceJiraPlugin.warningDialog({isAdministrator:r});p.addPanel("Panel 1",s);p.get("panel:0").setPadding(0);if(r){p.addButton("Set connection",function(t){AJS.Editor.JiraConnector.clickConfigApplink=true;t.hide();tinymce.confluence.macrobrowser.macroBrowserCancel();window.open(Confluence.getContextPath()+"/admin/listapplicationlinks.action")},"create-dialog-create-button app_link");p.popup.element.find(".create-dialog-create-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")}else{p.addButton("Contact admin",function(t){t.hide();tinymce.confluence.macrobrowser.macroBrowserCancel();window.open(Confluence.getContextPath()+"/wiki/contactadministrators.action")})}p.addLink("Cancel",function(t){t.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()});p.show();p.gotoPanel(0)},closePopup:function(){d.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()},open:function(s,u){if(!k()){return}AJS.Editor.Adapter.storeCurrentSelectionState();n=s;if(AJS.Editor.JiraAnalytics&&n){if(n===AJS.Editor.JiraConnector.source.instructionalText){i()}else{m=null;AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n})}}var q=tinymce.confluence.macrobrowser,r=q.getCurrentNode();if(q.isMacroTag(r)&&"jira"==j(r).attr("data-macro-name")){tinymce.confluence.macrobrowser.editMacro(r);return}var p=u&&tinyMCE.activeEditor.selection&&tinyMCE.activeEditor.selection.getContent({format:"text"});e(p)},edit:function(u){n=f;m=f;if(typeof(u.params)=="undefined"){AJS.Editor.JiraConnector.open();return}if(!k()){AJS.Editor.JiraConnector.open();return}var w=function(y){var x=y.indexOf("|");if(x>=0){return y.substring(0,x)}return y};var v=function(z){if(z.hasOwnProperty("jqlQuery")){return z.jqlQuery}var y=/^([0-9]\d*)$/;var x=["count","columns","title","renderMode","cache","width","height","server","serverId","anonymous","baseurl","showSummary"];for(var A in z){if(j.inArray(A,x)==-1&&z.hasOwnProperty(A)){if(y.test(A)){return z[A]}return A+=" = "+z[A]}}return""};var q=function(z){var A={};if(z.params.url){A.searchStr=z.params.url;return A}A.maximumIssues=z.params.maximumIssues;var x=z.defaultParameterValue||v(z.params);if(typeof(x)=="undefined"){A.searchStr=f}else{A.searchStr=x}if(typeof(z.params.server)!="undefined"){A.serverName=z.params.server}else{for(var y=0;y<AJS.Editor.JiraConnector.servers.length;y++){if(AJS.Editor.JiraConnector.servers[y].selected){A.serverName=AJS.Editor.JiraConnector.servers[y].name;break}}}return A};var s=function(y){var z={};var x=y.defaultParameterValue||y.params.jqlQuery||y.params.key||w(y.paramStr);z.searchStr=x;z.serverName=y.params.server;return z};var t=function(z){var A=q(z);var y=z.params.count;if(typeof y==="undefined"){y="false"}A.count=y;var x=z.params.columns;if(typeof(x)!="undefined"){if(x.length){A.columns=x}}return A};var r=t(u);if(u&&!AJS.Editor.inRichTextMode()){j("#markupTextarea").selectionRange(u.startIndex,u.startIndex+u.markup.length)}e();if(r.searchStr){d.gotoPanel(0);var p=AJS.Editor.JiraConnector.Panels[0];p.setMacroParams(r);p.doSearch(r.searchStr,r.serverName)}},source:b}})(AJS.$);AJS.MacroBrowser.setMacroJsOverride("jira",{opener:AJS.Editor.JiraConnector.edit});AJS.MacroBrowser.setMacroJsOverride("jiraissues",{opener:AJS.Editor.JiraConnector.edit});AJS.Editor.JiraConnector.Panels=[];AJS.Editor.JiraConnector.clickConfigApplink=false;AJS.Editor.JiraConnector.hotKey=function(){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.editorHotKey,true)};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/panelhelper.js' */
AJS.Editor.JiraConnector.Panel=function(){};AJS.Editor.JiraConnector.Panel.prototype={insertIssueLink:function(a){this.insertIssueLinkWithParams({key:a})},insertJqlLink:function(a){this.insertIssueLinkWithParams({jqlQuery:a})},insertIssueLinkWithParams:function(f){var d=AJS.$;var g=function(h){tinymce.confluence.macrobrowser.macroBrowserComplete(h)};f.server=this.selectedServer.name;f.serverId=this.selectedServer.id;if(AJS.Editor.inRichTextMode()){g({name:"jira",params:f})}else{var a="{jira:";for(var b in f){a=a+b+"="+f[b]+"|"}if(a.charAt(a.length-1)=="|"){a=a.substr(0,a.length-1)}var e=d("#markupTextarea");var c=e.selectionRange();e.selectionRange(c.start,c.end);e.selection(a);c=e.selectionRange();e.selectionRange(c.end,c.end)}if(AJS.Editor.JiraAnalytics&&AJS.Editor.JiraConnector.analyticProperties){AJS.Editor.JiraAnalytics.triggerPannelActionEvent(AJS.Editor.JiraConnector.analyticProperties);AJS.Editor.JiraConnector.analyticProperties=null}AJS.Editor.JiraConnector.closePopup()},disableInsert:function(){AJS.$(".insert-issue-button").disable()},isInsertDisabled:function(){return AJS.$(".insert-issue-button").is(":disabled")},getOAuthRealm:function(d){var b=d.getResponseHeader("WWW-Authenticate")||"";var a=/OAuth realm\=\"([^\"]+)\"/;var c=a.exec(b);if(c){return c[1]}else{return null}},enableInsert:function(){AJS.$(".insert-issue-button").enable()},msg:function(a,c,b){if(aui&&aui.message){try{var h=AJS.$('<div class="aui-message-container"/>');var f=c;if(c.html){f=c.html()}var i={content:f};var d;switch(b){case"error":d=aui.message.error(i);break;case"success":d=aui.message.success(i);break;case"warning":d=aui.message.warning(i);break;default:d=aui.message.info(i)}h.append(d);c=h}catch(g){if(AJS&&AJS.logError){AJS.logError("jira-connector",g)}}}a.append(c)},errorMsg:function(a,c){this.removeError(a);var b=AJS.$('<div class="jira-error"></div>').appendTo(a);this.msg(b,c,"error")},warningMsg:function(a,b){this.removeError(a);var c=AJS.$('<div class="jira-error"></div>').appendTo(a);this.msg(c,b,"warning")},noServerMsg:function(a,b){var d=$('<div class="data-table jiraSearchResults" ></div>').appendTo(a);var c=AJS.$('<div class="message-panel"/>').appendTo(d);this.msg(c,b,"info")},ajaxError:function(c,b){if(c.status==401){var a=this.getOAuthRealm(c);this.selectedServer.authUrl=a;b.call(this)}else{this.errorMsg(this.container,"Received the following HTTP error code from the server"+":"+c.status)}},removeError:function(a){AJS.$("div.jira-error",a).remove()},setActionOnEnter:function(a,c,b){a.unbind("keydown").keydown(function(d){if(d.which==13){var f=function(g){a.unbind("keyup",f);c(b);return AJS.stopEvent(g)};a.keyup(f);return AJS.stopEvent(d)}})},createOauthForm:function(e){var d=this.selectedServer;var c={onSuccess:function(){d.authUrl=null;e(d)},onFailure:function(){}};var a='<a class="oauth-init" href="#">'+"Login & Approve"+"</a> "+"to retrieve data from"+" "+AJS.escapeHtml(this.selectedServer.name);var b=AJS.$('<div class="jira-oauth-message-marker"/>');if(!(aui&&aui.message)){b.addClass("oauth-message")}this.msg(b,a,"info");AJS.$(".oauth-init",b).click(function(f){AppLinks.authenticateRemoteCredentials(d.authUrl,c.onSuccess,c.onFailure);f.preventDefault()});return b},applinkServerSelect:function(a,b){var c=AJS.Editor.JiraConnector.servers;AJS.$(c).each(function(){var d="<option ";if(this.selected){selectedServer=this;d+='selected="selected"'}d+='value="'+this.id+'"></option>';d=AJS.$(d);d.text(this.name);AJS.$(a).append(d);d.data("jiraapplink",this)});AJS.$(a).change(function(g){var d=AJS.$("option:selected",a);var f=d.data("jiraapplink");b(f)})},showSpinner:function(d,a,c,b){AJS.$.data(d,"spinner",Raphael.spinner(d,a,"#666"));if(c){AJS.$(d).css("marginLeft",-a*1.2)}if(b){AJS.$(d).css("marginTop",-a*1.2)}},hideSpinner:function(a){AJS.$(a).css("marginTop","");AJS.$(a).css("marginLeft","");var b=AJS.$.data(a,"spinner");if(b){b();delete b;AJS.$.data(a,"spinner",null)}},setSelectedIssue:function(a){this.selectedIssue=a;this.enableInsert()},insertSelected:function(){if(this.selectedIssue){this.insertIssueLink(this.selectedIssue.key)}},createIssueTableFromUrl:function(c,l,b,a,d,i,j,g,e){var f=AJS.$;f("div.data-table",c).remove();var k=f('<div class="data-table jiraSearchResults" ></div>').appendTo(c);var m=f('<div class="loading-data"></div>').appendTo(k);this.removeError(c);this.showSpinner(m[0],50,true,true);var h=this;this.currentXhr=AppLinks.makeRequest({appId:l,type:"GET",url:b,dataType:"xml",success:function(r){m.remove();var s=f("item",r);AJS.$(":disabled",c).enable();if(s.length){var v=f('<table class="my-result aui"></table>');f(".jiraSearchResults",c).append(v);var p=[];if(e){var u={className:"issue-checkbox-column",title:'<input type="checkbox" name="jira-issue-all" checked/>',renderCell:function(z,x){var y=Confluence.Templates.ConfluenceJiraPlugin.issueCheckbox({issueKey:x.key});AJS.$(y).appendTo(z)}};p.push(u)}var t=[{className:"issue-key-column",title:"Key",renderCell:function(z,y){var x=Confluence.Templates.ConfluenceJiraPlugin.issueKey({issueIconUrl:y.iconUrl,issueKey:y.key});AJS.$(x).appendTo(z)}},{className:"issue-summary-column",title:"Summary",renderCell:function(y,x){y.text(x.summary)}}];p=p.concat(t);var n=new AJS.DataTable(v,p);f(s).each(function(){var x={iconUrl:f("type",this).attr("iconUrl"),key:f("key",this).text(),summary:f("summary",this).text(),url:f("link",this).text()};n.addRow(x)});v.bind("row-action",function(y,x){d.call(h,x)});v.bind("row-select",function(y,x){a.call(h,x)});n.selectRow(0);if(j){var o=f("issue",r).attr("total");j.call(h,o)}}else{if(i){i()}var w="No search results found.";var q=AJS.$('<div class="message-panel"/>');h.msg(q,w,"info");f(".jiraSearchResults",c).append(q)}},error:function(n){AJS.$(":disabled",c).enable();m.remove();g.call(h,n)}})},retrieveJson:function(c,a,d,b){AppLinks.makeRequest({appId:c,type:"GET",url:a,dataType:"json",success:d,error:b})},};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/searchpanel.js' */
AJS.Editor.JiraConnector.Panel.Search=function(){this.jql_operators=/=|!=|~|>|<|!~| is | in /i};AJS.Editor.JiraConnector.Select2=AJS.Editor.JiraConnector.Select2||{};AJS.Editor.JiraConnector.Select2.getKeyColumnsSelectedOptions=function(b){var a=[];var d=b.select2("data");for(var c=0;c<d.length;c++){a[c]=d[c].id}return a.join()};AJS.Editor.JiraConnector.Panel.Search.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Search.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Search.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Search.prototype,{defaultColumns:"key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution",DEFAULT_MAX_ISSUES_VAL:20,MAXIMUM_MAX_ISSUES_VAL:1000,MINIMUM_MAX_ISSUES_VAL:1,title:function(){return "Search"},init:function(a){var e=AJS.$;a.html('<div id="my-jira-search"></div>');var h=this;var b=e("#my-jira-search");this.container=b;var i=function(){b.children(":not(div.jira-search-form)").remove()};var g=function(){e("input.text",b).enable();e("button",b).enable()};var m=function(){e("button",b).disable();e("input.text",b).disable()};var j=function(o){i();h.disableInsert();if(o){h.selectedServer=o}if(h.selectedServer.authUrl){m();var n=h.createOauthForm(function(){i();g()});b.append(n)}else{g();e(".search-help").show()}};this.authCheck=j;var f=function(q,o){if(q){e("input:text",b).val(q)}if(o&&o!=this.selectedServer.name){var y=AJS.Editor.JiraConnector.servers;for(var s=0;s<y.length;s++){if(y[s].name==o){e('option[value="'+y[s].id+'"]',b).attr("selected","selected");e("select",b).change();isServerExist=true;break}}if(!isServerExist){c(AJS.Meta.get("is-admin"));return}}if(this.currentXhr&&this.currentXhr.readyState!=4){return}var r=q||e("input",b).val();if(AJS.Editor.JiraAnalytics){var x=AJS.JQLHelper.checkQueryType(r);if(x){AJS.Editor.JiraAnalytics.triggerSearchEvent({type:x,source:"dialog"})}}var t=function(C,E,D){var B=b.find("#jiraIssueColumnSelector");var A=B.val()&&B.val().join();e("select",b).disable();m();h.lastSearch=C;h.createIssueTableFromUrl(b,h.selectedServer.id,"/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+encodeURIComponent(C)+"&returnMax=true&tempMax=20&field=summary&field=type&field=link",h.selectHandler,h.insertLinkFromForm,function(){h.addDisplayOptionPanel();h.loadMacroParams(A);h.bindEventToDisplayOptionPanel(true);h.enableInsert()},function(F){h.addDisplayOptionPanel();h.loadMacroParams(A);h.bindEventToDisplayOptionPanel();h.updateTotalIssuesDisplay(F);h.checkAutoSelectColumns()},function(F){h.disableInsert();if(F.status==400){if(D){D()}else{e("div.data-table",b).remove();h.warningMsg(b,AJS.format("The JIRA server didn\'\'t understand your search query. If you entered JQL, please ensure that it\'\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}",Confluence.Templates.ConfluenceJiraPlugin.learnMore()))}}else{e("div.data-table",b).remove();h.ajaxError(F,j)}},true)};var p=function(A){if(A.errors){i();h.warningMsg(b,"The URL filter is not available to you, perhaps it has been deleted or had its permissions changed")}else{if(A.jql){e("input",b).val(A.jql);t(A.jql)}else{i();h.warningMsg(b,AJS.format("The JIRA server didn\'\'t understand your search query. If you entered JQL, please ensure that it\'\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}",Confluence.Templates.ConfluenceJiraPlugin.learnMore()))}}};if(AJS.JQLHelper.isFilterUrl(r)){var n=decodeURIComponent(r);var w=AJS.JQLHelper.findServerIndexFromUrl(n,AJS.Editor.JiraConnector.servers);if(w!=-1){var u=AJS.Editor.JiraConnector.servers[w].id;AJS.$('option[value="'+u+'"]',b).attr("selected","selected");AJS.$("select",b).change();var z=AJS.JQLHelper.getFilterFromFilterUrl(n);if(z){e("input",b).val(z);t(z)}else{i();h.warningMsg(b,AJS.format("The JIRA server didn\'\'t understand your search query. If you entered JQL, please ensure that it\'\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}",Confluence.Templates.ConfluenceJiraPlugin.learnMore()))}}else{i();h.disableInsert();c(AJS.Meta.get("is-admin"))}}else{if(AJS.JQLHelper.isIssueUrlOrXmlUrl(r)){var n=decodeURIComponent(r);var v=AJS.JQLHelper.getJqlAndServerIndexFromUrl(n,AJS.Editor.JiraConnector.servers);if(d(v)){e("input",b).val(v.jqlQuery);t(v.jqlQuery,false,null)}}else{if(r.match(h.jql_operators)){t(r,false,null)}else{if(AJS.JQLHelper.isSingleKeyJQLExp(r)){t("key = "+r,true)}else{if(AJS.JQLHelper.isMultipleSingleKeyJQLExp(r)){t("key in ("+r+")",true)}else{t('summary ~ "'+r+'" OR description ~ "'+r+'"',false,null)}}}}}};this.doSearch=f;h.addSearchForm();var d=function(n){var o;if(n.serverIndex!=-1){AJS.$('option[value="'+AJS.Editor.JiraConnector.servers[n.serverIndex].id+'"]',b).attr("selected","selected");AJS.$("select",b).change();if(n.jqlQuery.length==0){i();h.errorMsg(b,"The JIRA server didn\'t understand your search query. If you entered JQL, please ensure that it\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}")}else{o=n.jqlQuery}}else{i();h.disableInsert();c(AJS.Meta.get("is-admin"))}return o};var c=function(n){var p=Confluence.Templates.ConfluenceJiraPlugin.showMessageNoServer({isAdministrator:n,contextPath:Confluence.getContextPath()});h.noServerMsg(b,p);var o=AJS.$("#open_applinks");o.bind("click",function(){AJS.Editor.JiraConnector.clickConfigApplink=true;AJS.Editor.JiraConnector.refreshAppLink=function(){h.refreshSearchForm()}})};AJS.$("#my-jira-search input:text").bind("paste",function(){var n=this;setTimeout(function(){var p=AJS.$(n).val();if(AJS.JQLHelper.isFilterUrl(p)){f()}else{if(AJS.JQLHelper.isIssueUrlOrXmlUrl(p)){var q=decodeURIComponent(p);var o=AJS.JQLHelper.getJqlAndServerIndexFromUrl(q,AJS.Editor.JiraConnector.servers);if(d(o)){AJS.$(n).val(o.jqlQuery);h.doSearch()}}}},100)});e(a).select(function(){h.validate()});var l=AJS.$(".jql-display-opts-open.disabled");var k={live:true,title:function(){return AJS.$(".jql-display-opts-open.disabled").data("title")},gravity:"s",delayIn:300,delayOut:0};l.tooltip(k)},addSearchForm:function(){var d=this;d.container.empty();var f=AJS.Editor.JiraConnector.servers;d.selectedServer=f[0];var a=false;if(f.length>1){a=true}var e=Confluence.Templates.ConfluenceJiraPlugin.searchForm({isMultiServer:a});var c=AJS.$(e).appendTo(d.container);if(f.length>1){var b=$('<select class="select" tabindex="0"></select>').insertAfter("div.search-input",c);d.applinkServerSelect(b,d.authCheck)}d.authCheck(d.selectedServer);AJS.$("button",d.container).click(function(){d.doSearch()});d.setActionOnEnter($("input.text",d.container),d.doSearch)},refreshSearchForm:function(){this.container.empty();this.addSearchForm()},validate:function(d){var c=this.container;var e=AJS.$("input:checkbox[name=jira-issue]",c);var b=AJS.Editor.JiraConnector.Panel.Search.prototype;if(e.length||d){var a=AJS.$("input:checkbox[name=jira-issue]:checked",c).length;if(a>0||d){b.enableInsert()}else{b.disableInsert()}b.changeInsertOptionStatus(a,d)}else{if(AJS.$(".jira-oauth-message-marker",c).length){b.authCheck(this.selectedServer)}AJS.$("input",c).focus();b.disableInsert()}if(b.isInsertDisabled()){return}b.validateMaxIssues()},validateMaxIssues:function(i){var b=AJS.$("#jira-maximum-issues");function d(){b.next("#jira-max-number-error").remove()}function f(){b.attr("disabled","disabled")}function h(){b.removeAttr("disabled")}function c(){d();b.after(Confluence.Templates.ConfluenceJiraPlugin.warningValMaxiumIssues())}switch($("input:radio[name=insert-advanced]:checked").val()){case"insert-single":case"insert-count":d();f();break;case"insert-table":var a=AJS.Editor.JiraConnector.Panel.Search.prototype;h();var g=b.val();if($.trim(g)===""){if(i&&i.type==="keyup"){d();break}if(i&&i.type==="blur"){g=a.MAXIMUM_MAX_ISSUES_VAL;b.val(g);break}}if(AJS.$.isNumeric(g)&&(a.MINIMUM_MAX_ISSUES_VAL<=g&&g<=a.MAXIMUM_MAX_ISSUES_VAL)){d();a.enableInsert()}else{c();a.disableInsert()}break}},customizedColumn:null,parseColumnsStringToArray:function(g){var f="";var b=[];var a=null;var c=function(i,h){i=AJS.$.trim(i);if(i!=""){h.push(i)}};for(var e=0;e<g.length;e++){var d=g.charAt(e);if(d!==","&&d!=='"'&&d!=="'"){f+=d}if(d==='"'||d==="'"){if(a==null){a=d}else{if(a===d){c(f,b);f="";a=null}}}else{if(d===","){if(a==null){c(f,b);f=""}else{f+=d}}}}c(f,b);return b},parseArrayToColumnString:function(b){var a="";for(var c=0;c<b.length;c++){var d=AJS.$.trim(b[c]);if(d!=""){if(d.indexOf(",")>=0){d='"'+d+'"'}if(c!=0){a+=","}a+=d}}},checkAndSetDefaultValueMaximumIssues:function(a){if(!a){AJS.log("Cannot set default value for Maximum Issues");return}var b=a.element||AJS.$("#jira-maximum-issues");var d=a.defaultVal||this.MAXIMUM_MAX_ISSUES_VAL;var c=AJS.$.trim(b.val());if(c===""){b.val(d)}},setMacroParams:function(a){this.macroParams=a},getMacroParamsFromUserInput:function(){var g=((AJS.$("input:radio[name=insert-advanced]:checked").val()=="insert-count")?true:false);var b=this.container;var f=new Array();var c=new Array();AJS.$("#my-jira-search .my-result.aui input:checkbox[name=jira-issue]").each(function(j){var k=AJS.$(this);if(k.is(":checked")){f[f.length]=k.val()}else{c[c.length]=k.val()}});var e={};if(g){e.count="true"}else{if(!AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox){e.columns=this.defaultColumns;return}e.columns=AJS.Editor.JiraConnector.Select2.getKeyColumnsSelectedOptions(AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox);if(!e.columns){e.columns=this.defaultColumns}}var d=AJS.$("input:radio[name=insert-advanced]:checked").val();if(d==="insert-single"){e.key=f.toString()}else{if(c.length==0){e.jqlQuery=this.lastSearch+" "}else{var a="key in ("+f.toString()+")";e.jqlQuery=a}}if(d==="insert-table"){var h=AJS.$("#jira-maximum-issues").val();e.maximumIssues=h}return e},insertLinkFromForm:function(){var c=this;var b=c.container;var d=AJS.$("input:checkbox[name=jira-issue]",b);if(d.length){var a=AJS.$("input:checkbox[name=jira-issue]:checked",b).length;if(a>0){c.insertLink()}}},insertLink:function(c){var a;if(c&&typeof c.insertIssueLinkWithParams==="function"){a=c}else{a=this}var b=a.getMacroParamsFromUserInput();a.insertIssueLinkWithParams(b);return true},loadMacroParams:function(a){var b=this.macroParams;if(!b){this.prepareColumnInput(a||this.defaultColumns);this.checkAndSetDefaultValueMaximumIssues({defaultVal:20})}else{b.columns=a||b.columns||this.defaultColumns;if(!b.maximumIssues){AJS.$("#jira-maximum-issues").attr("disabled","disabled")}if(b.count=="true"){AJS.$("#opt-total").prop("checked",true)}else{AJS.$("#opt-table").prop("checked",true);AJS.$("#jira-maximum-issues").removeAttr("disabled");var c=b.maximumIssues||this.DEFAULT_MAX_ISSUES_VAL;this.checkAndSetDefaultValueMaximumIssues({defaultVal:c})}this.prepareColumnInput(b.columns)}},selectHandler:function(){var a=this.container;var b=a.find("tr.selected");if(b.length){b.unbind("keydown.space").bind("keydown.space",function(c){if(c.which==32||c.keyCode==32){var d=b.find("[type=checkbox]");d.trigger("click")}})}},addDisplayOptionPanel:function(){var c=this;var a=Confluence.Templates.ConfluenceJiraPlugin.displayOptsHtml;var b=Confluence.Templates.ConfluenceJiraPlugin.displayOptsOverlayHtml;AJS.$(".jiraSearchResults").after(b());AJS.$("#jiraMacroDlg").unbind("submit").on("submit",function(d){return false})},updateTotalIssuesDisplay:function(b){var a=this.selectedServer.url+"/issues/?jql="+this.lastSearch;if(b>20){AJS.$(".my-result.aui").after(Confluence.Templates.ConfluenceJiraPlugin.viewAll({jiraIssuesLink:a}))}var c=AJS.format("{0} issues",b);AJS.$(".total-issues-text").html(c);AJS.$(".total-issues-link").attr("href",a)},prepareColumnInput:function(c){var b=c.split(/\s*,\s*/);for(var a in b){var g=b[a];if(g&&typeof g.toLowerCase==="function"){b[a]=g.toLowerCase()}}var f=this.selectedServer;var d={issuekey:"key",duedate:"due",issuetype:"type"};var e=function(k){var r=[];var t=AJS.$("#jiraIssueColumnSelector");var m="";var q="";for(var l=0;l<k.length;l++){if(d[k[l].id]){k[l].id=d[k[l].id]}var s;if(k[l].custom===true){s=k[l].name.toLowerCase()}else{s=k[l].id.toLowerCase()}var p=k[l].name;var j="";var o=AJS.template("<option value='{value}'>{displayValue}</option>");r[s]=p;if(AJS.$.inArray(s,b)<0){m+=o.fill({value:s,displayValue:p})}}r.key="Key";for(var l=0;l<b.length;l++){var h=AJS.template("<option selected='true' value='{value}'>{displayValue}</option>");var s=b[l].toLowerCase();var p=r[s];if(p!=null){q+=h.fill({value:s,displayValue:p})}}var n=q+m;t.html(n);t.auiSelect2({width:"415px",containerCssClass:"select2-container-jira-issue-columns"});AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox=t};if(f.columns&&f.columns.length>0){e(f.columns);return}this.retrieveJson(f.id,"/rest/api/2/field",function(h){if(h&&h.length){f.columns=h;e(f.columns)}})},expandDisplayOptPanel:function(){var b=AJS.$(".jql-display-opts-overlay");var c=b.height();var d=40;b.css("top","");var a=-(c-d);b.css("bottom",a+"px");b.animate({bottom:0},500)},minimizeDisplayOptPanel:function(){var a=AJS.$(".jql-display-opts-overlay");a.css("top",a.position().top+"px");a.css("bottom","");a.animate({top:420},500)},disableAutoSelectColumns:function(){AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox.auiSelect2("enable",false)},enableAutoSelectColumns:function(){AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox.auiSelect2("enable",true)},checkAutoSelectColumns:function(){if(AJS.$("#opt-table").prop("checked")){this.enableAutoSelectColumns()}else{this.disableAutoSelectColumns();this.enableInsert()}},bindEventToDisplayOptionPanel:function(g){var e=this;var b=AJS.$(".jql-display-opts-close, .jql-display-opts-open"),d=AJS.$(".jql-display-opts-overlay"),i=AJS.$(".jql-display-opts-inner .radio"),c=AJS.$("#opt-table"),a=AJS.$("#my-jira-search input:checkbox[name=jira-issue-all]"),f=AJS.$("#my-jira-search input:checkbox[name=jira-issue]");var h=AJS.$("#jira-maximum-issues");h.on("blur keyup",AJS.Editor.JiraConnector.Panel.Search.prototype.validateMaxIssues);d.css("top","420px");b.click(function(j){j.preventDefault();if($(this).hasClass("disabled")){return}var k=$(this).hasClass("jql-display-opts-open");if(k){e.expandDisplayOptPanel();jQuery(this).addClass("jql-display-opts-close");jQuery(this).removeClass("jql-display-opts-open")}else{e.minimizeDisplayOptPanel();jQuery(this).removeClass("jql-display-opts-close");jQuery(this).addClass("jql-display-opts-open")}});i.change(function(){e.checkAutoSelectColumns();e.validateMaxIssues()});a.bind("click",function(){var j=AJS.$(this);if(j.prop("checked")){f.prop("checked","checked")}else{f.removeAttr("checked")}e.validate()});f.change(function(){var j=AJS.$("#my-jira-search input:checkbox[name=jira-issue]:not(:checked)").length;if(j>0){a.removeAttr("checked")}else{a.prop("checked","checked")}e.validate()});e.validate(g)},changeInsertOptionStatus:function(l,b){var i=this;var j=AJS.$("#opt-single");var c=AJS.$("#opt-total");var h=AJS.$("#opt-table");var g=AJS.$("#my-jira-search input:checkbox[name=jira-issue]:checked");var n=AJS.$("#my-jira-search input:checkbox[name=jira-issue-all]").attr("checked")==="checked";var e=g.length===1;var d=g.length>1;var m=g.length===0;var k=AJS.JQLHelper.isSingleKeyJQLExp(AJS.$("#my-jira-search input[name=jiraSearch]").val());var a=function(){c.attr("disabled","disabled");h.attr("disabled","disabled");j.removeAttr("disabled").click();setTimeout(function(){j.removeAttr("disabled").click()},100)};var p=function(){j.attr("disabled","disabled");c.removeAttr("disabled");if(AJS.$("input[name=insert-advanced]:checked").val()==="insert-single"){h.removeAttr("disabled").click();setTimeout(function(){h.removeAttr("disabled").click()},100)}};var o=function(){h.removeAttr("disabled","disabled");c.removeAttr("disabled","disabled");j.removeAttr("disabled","disabled");var q=AJS.$("input:radio[name=insert-advanced]:checked").val();if(q==="insert-single"){h.click();setTimeout(function(){h.click()},100)}};var f=function(){j.attr("disabled","disabled");c.attr("disabled","disabled");h.attr("disabled","disabled");AJS.$(".jql-display-opts-close").click();AJS.$(".jql-display-opts-open").addClass("disabled")};AJS.$(".jql-display-opts-open").removeClass("disabled");j.removeAttr("disabled");c.removeAttr("disabled");h.removeAttr("disabled");if(n&&e&&k){a()}else{if(n&&e&&!k){o()}else{if(d){p()}else{if(e&&!n){a()}else{if(b){p()}else{if(m){f()}}}}}}},analyticName:"search"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Search());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/createissuepanel.js' */
AJS.Editor.JiraConnector.Panel.Create=function(){};AJS.Editor.JiraConnector.Panel.Create.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Create.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Create.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Create.prototype,{setSummary:function(a){AJS.$(".issue-summary",this.container).val(a)},resetIssue:function(){AJS.$(".issue-summary",this.container).empty();AJS.$(".issue-description",this.container).empty()},resetForm:function(){var a=this.container;AJS.$(".project-select",a).empty();AJS.$(".type-select",a).empty();$(".jira-field",a).remove()},authCheck:function(a){this.selectedServer=a;if(this.selectedServer.authUrl){this.showOauthChallenge()}else{this.serverSelect()}},ajaxAuthCheck:function(b){var a=this;this.endLoading();this.ajaxError(b,function(){a.authCheck(a.selectedServer)})},serverSelect:function(){AJS.$(".jira-oauth-message-marker",this.container).remove();AJS.$("div.field-group",this.container).show();this.resetForm();this.loadProjects()},showOauthChallenge:function(){AJS.$("div.field-group",this.container).not(".servers").hide();AJS.$(".jira-oauth-message-marker",this.container).remove();var a=this;var b=this.createOauthForm(function(){a.serverSelect()});this.container.append(b)},summaryOk:function(){return AJS.$(".issue-summary",this.container).val().replace("\\s","").length>0},projectOk:function(){var a=AJS.$(".project-select option:selected",this.container).val();return a&&a.length&&a!="-1"},setButtonState:function(){if(this.summaryOk()&&this.projectOk()){this.enableInsert();return true}else{this.disableInsert();return false}},startLoading:function(){this.removeError(this.container);AJS.$(".loading-blanket",this.container).removeClass("hidden");AJS.$("input,select,textarea",this.container).disable();this.disableInsert()},endLoading:function(){AJS.$(".loading-blanket",this.container).addClass("hidden");AJS.$("input,select,textarea",this.container).enable();this.setButtonState()},renderElement:function(field,key){var defaultFields=["project","summary","issuetype","reporter","assignee"];var allowFields=["versions","components"];var acceptedFieldsConfig=[{name:"Epic",fieldPath:"schema.custom",value:"com.pyxis.greenhopper.jira:gh-epic-label",afterElement:".type-select"},{name:"Priority",fieldPath:"schema.system",value:"priority",afterElement:".issue-summary"},{name:"Versions",key:"versions",afterElement:".issue-summary"},{name:"Components",key:"components",afterElement:".issue-summary"}];var getAcceptedFieldConfig=function(){var config;for(var i=0;i<acceptedFieldsConfig.length;i++){config=acceptedFieldsConfig[i];if(config.key===key||(config.value&&eval("field."+config.fieldPath)===config.value)){return acceptedFieldsConfig[i]}}};if((field.required||_.contains(allowFields,key))&&!_.contains(defaultFields,key)&&jiraIntegration.fields.canRender(field)){var fieldConfig=getAcceptedFieldConfig();if(fieldConfig){$(jiraIntegration.fields.renderField(null,field)).insertAfter($(fieldConfig.afterElement,this.container).parent())}}},renderCreateIssuesForm:function(b,a){var c=this;$(".jira-field",b).remove();$.each(a,function(d,e){c.renderElement(e,d)})},fillProjectOptions:function(c){var b=AJS.$(".project-select",this.container);b.empty();var a={id:-1,name:"Select a project"};b.append(Confluence.Templates.ConfluenceJiraPlugin.renderOption({option:a}));AJS.$(c).each(function(){var d=AJS.$(Confluence.Templates.ConfluenceJiraPlugin.renderOption({option:this})).appendTo(b);d.data("issuesType",this.issuetypes)});this.endLoading();b.focus()},fillIssuesTypeOptions:function(b,a){b.empty();AJS.$(a).each(function(){var c=AJS.$(Confluence.Templates.ConfluenceJiraPlugin.renderOption({option:this})).appendTo(b);c.data("fields",this.fields)});AJS.$("option:first",b).attr("selected","selected")},bindEvent:function(){var c=this;var b=AJS.$(".project-select",this.container);var a=AJS.$("select.type-select",this.container);b.change(function(){var d=AJS.$("option:selected",b);if(d.val()!="-1"){AJS.$('option[value="-1"]',b).remove();c.appLinkRequest("expand=projects.issuetypes.fields&projectIds="+d.val(),function(e){c.fillIssuesTypeOptions(a,e.projects[0].issuetypes);c.renderCreateIssuesForm(c.container,a.find("option:selected").data("fields"));if(c.summaryOk()){c.enableInsert()}c.endLoading()})}});a.change(function(){c.renderCreateIssuesForm(c.container,a.find("option:selected").data("fields"))})},appLinkRequest:function(b,c){var a=this;a.startLoading();AppLinks.makeRequest({appId:this.selectedServer.id,type:"GET",url:"/rest/api/2/issue/createmeta?"+b,dataType:"json",success:c,error:function(d){a.ajaxAuthCheck(d)}})},loadProjects:function(){var a=this;this.appLinkRequest("expand=projects",function(b){a.fillProjectOptions(b.projects)})},updateAllowedValuesHandler:function(){if(jiraIntegration&&jiraIntegration.fields&&jiraIntegration.fields.getFieldHandler("priority")){jiraIntegration.fields.getFieldHandler("priority")["canRender"]=function(a){return a.allowedValues.length>0}}},title:function(){return "Create New Issue"},init:function(b){b.html('<div class="create-issue-container"></div>');this.container=AJS.$("div.create-issue-container");var a=this.container;var g=AJS.Editor.JiraConnector.servers;this.selectedServer=g[0];a.append(Confluence.Templates.ConfluenceJiraPlugin.createIssuesForm());var f=this;var e=AJS.$("select.server-select",a);if(g.length>1){this.applinkServerSelect(e,function(h){f.authCheck(h)})}else{e.parent().remove()}var d=AJS.$(".issue-summary",a);d.keyup(function(){f.setButtonState()});this.showSpinner(AJS.$(".loading-data",a)[0],50,true,true);var c=function(){AJS.$(".insert-issue-button:enabled").click()};this.setActionOnEnter(d,c);b.onselect=function(){f.onselect()};this.updateAllowedValuesHandler();this.bindEvent()},convertFormToJSON:function(a){var c={};c.summary=AJS.$(".issue-summary",a).val();c.projectId=AJS.$(".project-select option:selected",a).val();c.issueTypeId=AJS.$(".type-select option:selected",a).val();c.description=AJS.$(".issue-description",a).val();if(jiraIntegration){a.children(".jira-field").find("input,select,textarea").each(function(d,f){var g=AJS.$(f);if(g){if(!c.fields){c.fields={}}var e=jiraIntegration.fields.getJSON(g);if(e instanceof Object){e=JSON.stringify(jiraIntegration.fields.getJSON(g))}c.fields[g.attr("name")]=e}})}var b=[];b.push(c);return JSON.stringify(b)},insertLink:function(){var b=Confluence.getContextPath()+"/rest/jiraanywhere/1.0";var c=AJS.$("div.create-issue-container form");this.startLoading();var a=this;$.ajax({type:"POST",contentType:"application/json",url:b+"/jira-issue/create-jira-issues/"+this.selectedServer.id,data:this.convertFormToJSON(c),success:function(f){if(!f||!f[0]||!f[0].key){var g=AJS.$(".errMsg, .error",f);var e=AJS.$("<ul></ul>");g.each(function(){AJS.$("<li></li>").appendTo(e).text(AJS.$(this).text())});a.errorMsg(AJS.$("div.create-issue-container"),AJS.$("<div>"+"There were errors creating an issue in JIRA. Some required fields may not be available on this form. Try creating this issue in "+' <a target="_blank" href="'+a.selectedServer.url+'" >JIRA</a></div>').append(e))}else{var d=f[0].key;a.insertIssueLink(d,a.selectedServer.url+"/browse/"+d);a.resetIssue()}a.endLoading()},error:function(e,d){a.ajaxAuthCheck(e)}})},onselect:function(){var a=this.container;if(!AJS.$(".project-select option",a).length||AJS.$(".oauth-message",a).length){this.authCheck(this.selectedServer)}},analyticName:"create_new"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Create());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/recentlyviewedpanel.js' */
AJS.Editor.JiraConnector.Panel.Recent=function(){};AJS.Editor.JiraConnector.Panel.Recent.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Recent.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Recent.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Recent.prototype,{title:function(){return "Recently Viewed"},init:function(a){var d=AJS.Editor.JiraConnector.servers;a.html('<div id="my-recent-issues" '+(d.length>1?'class="multi-server" ':"")+"></div>");var c=this;this.selectedServer=d[0];if(d.length>1){var b=AJS.$('<div class="jira-server-select"><form action="#" method="post" class="aui"><div class="field-group"><label>Server</label><select class="select" ></select></div></form></div>').appendTo("div#my-recent-issues");this.applinkServerSelect(AJS.$(".select",b),function(e){c.selectedServer=e;c.onselect()})}a.onselect=function(){c.onselect()}},insertLink:function(){this.insertSelected()},onselect:function(){var c=this;var b=AJS.$("div#my-recent-issues");this.container=b;var d=function(){b.children().not(".jira-server-select").remove()};var e;var a=function(){if(c.selectedServer.authUrl){d();var f=c.createOauthForm(function(){e()});b.append(f)}else{e()}};e=function(){if(c.currentXhr&&c.currentXhr.readyState!=4){return}AJS.$(".select",b).disable();d();var f="key+in+issueHistory()+ORDER+BY+lastViewed+DESC";c.createIssueTableFromUrl(b,c.selectedServer.id,"/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+f+"&field=summary&field=type&field=link&tempMax=50&returnMax=true",c.setSelectedIssue,c.insertLink,c.disableInsert,null,function(g){AJS.$("div.data-table",b).remove();c.ajaxError(g,a)},false)};a()},analyticName:"view_recent"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Recent());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = 'templates/soy/dialog.soy' */
// This file was automatically generated from dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.ConfluenceJiraPlugin == 'undefined') { Confluence.Templates.ConfluenceJiraPlugin = {}; }


Confluence.Templates.ConfluenceJiraPlugin.displayOptsHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jql-display-opts-bar data-table\'><a href=\'#\' class=\'jql-display-opts-open\' data-title="', soy.$$escapeHtml("Display options panel is not available without a selection."), '"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.displayOptsOverlayHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jql-display-opts-overlay data-table\'><form id="jiraMacroDlg" class="aui" action="#"><div class=\'jql-display-opts-inner\'><a href=\'#\' class=\'jql-display-opts-open\' data-title="', soy.$$escapeHtml("Display options panel is not available without a selection."), '"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a><fieldset class="group"><legend><span>', soy.$$escapeHtml("Display as"), '</span></legend><div class="radio"><input type=\'radio\' class=\'radio\' name=\'insert-advanced\' id=\'opt-single\' value=\'insert-single\'><label for=\'opt-single\'>', soy.$$escapeHtml("Single issue"), '</label><div class=\'description\'>', soy.$$escapeHtml("Display the macro as a single issue."), '</div></div><div class="radio"><input type=\'radio\' class=\'radio\' name=\'insert-advanced\' id=\'opt-total\' value=\'insert-count\'><label for=\'opt-total\'>', soy.$$escapeHtml("Total issue count"), '</label><div class=\'description\'>', soy.$$escapeHtml("Display total number of issues as a link. E.g. "), '<a class=\'total-issues-link\' target=\'_blank\' href=\'#\'><span class=\'total-issues-text\'>', soy.$$escapeHtml(AJS.format("{0} issues",12)), '</span></a></div></div><div class="radio"><input type=\'radio\' class=\'radio\' checked=\'checked\' name=\'insert-advanced\' id=\'opt-table\' value=\'insert-table\'><label for=\'opt-table\'>', soy.$$escapeHtml("Table"), '</label><div class=\'description\'>', soy.$$escapeHtml("Customise your columns below."), '</div></div></fieldset><fieldset><div class="field-group"><label>', soy.$$escapeHtml("Maximum issues"), '</label><input type="text" name="jira-maximum-issues" id="jira-maximum-issues" class="text short-field" /><div class="description">', soy.$$escapeHtml("Leave empty to get all issues."), '</div></div></fieldset><fieldset><div class="field-group"><label>', soy.$$escapeHtml("Columns to display"), '</label><select id="jiraIssueColumnSelector" data-placeholder="', soy.$$escapeHtml("Start typing to see possible columns"), '" multiple="true" class="select long-field"></select></div></fieldset></div></form></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.searchForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jira-search-form\'><form class=\'aui\'><fieldset class=\'inline\'>', (opt_data.isMultiServer == true) ? '<div class=\'search-input\'><input type=\'text\' class=\'text search-text\' name=\'jiraSearch\'/></div>' : '<div class=\'search-input one-server\'><input type=\'text\' class=\'text one-server long-field\' name=\'jiraSearch\'/></div>', '<button type=\'button\' title="', soy.$$escapeHtml("Search"), '" class=\'button\'><span class="aui-icon aui-icon-small aui-iconfont-search"></span></button></fieldset><div class=\'search-help\'>', soy.$$escapeHtml("Search using any issue key, search URL, JIRA link, JQL or plain text"), '</div></form></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'warning-body\'><p>', soy.$$escapeHtml("If you connect Confluence to JIRA you can easily link issues..."), '</p>', (opt_data.isAdministrator == false) ? '<p>' + soy.$$escapeHtml("Your administrator can set this up.") + '</p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.issueCheckbox = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type=\'checkbox\' name=\'jira-issue\' value=\'', soy.$$escapeHtml(opt_data.issueKey), '\' checked/>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.issueKey = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span><img class="icon" src="', soy.$$escapeHtml(opt_data.issueIconUrl), '"/> ', soy.$$escapeHtml(opt_data.issueKey), '</span>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showMessageNoServer = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.isAdministrator == true) ? soy.$$escapeHtml("No server found match with your URL.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/admin/listapplicationlinks.action">' + soy.$$escapeHtml("Click here to set this up") + '</a>' : soy.$$escapeHtml("No server found match with your URL. Your administrator can set this up.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/wiki/contactadministrators.action">' + soy.$$escapeHtml("Click here to contact your admin") + '</a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.viewAll = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'view-all\'>', soy.$$escapeHtml("Displaying first 20 results. "), '<a href=\'', soy.$$escapeHtml(opt_data.jiraIssuesLink), '\' target=\'_blank\'>', soy.$$escapeHtml("View all."), '</a></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.learnMore = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml("https://confluence.atlassian.com/display/DOC/JIRA+Issues+Macro"), '" target=\'_blank\'>', soy.$$escapeHtml("Learn More"), '</a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.contentJiraChart = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-chart-content"><div class=\'jira-chart-search\'><form class=\'aui\'><fieldset class=\'inline\'>', (opt_data.isMultiServer == true) ? '<div class=\'jira-chart-search-input\'><input type=\'text\' id="jira-chart-inputsearch" class=\'text search-text\' name=\'jiraSearch\'/></div><select id="jira-chart-servers" class="select" name="server" tabindex="0" />' : '<div class=\'jira-chart-search-input one-server\'><input type=\'text\' id="jira-chart-inputsearch" class=\'text one-server long-field\' name=\'jiraSearch\'/></div>', '<button id="jira-chart-search-button" type=\'button\' class=\'button\'>', soy.$$escapeHtml("Preview"), '</button></fieldset><div class=\'search-help\'>', soy.$$escapeHtml("Search using any issue key, search URL, JIRA link, JQL or plain text"), '</div></form></div><div class="jira-chart-img"></div><div class="jira-chart-option"><form action="#" class="aui" id="jiraChartMacroOption"><div class="jiraChartOption"><a class="jirachart-display-opts-open" href="#"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a><fieldset><div class="field-group"><label for="dBase">', soy.$$escapeHtml("Chart by"), '</label><select name="type" id="jira-chart-statType" class="select"><option value="statuses">', soy.$$escapeHtml("Status"), '</option><option value="priorities">', soy.$$escapeHtml("Priority"), '</option><option value="assignees">', soy.$$escapeHtml("Assignee"), '</option><option value="allFixfor">', soy.$$escapeHtml("Fix For Versions (all)"), '</option><option value="components">', soy.$$escapeHtml("Component"), '</option><option value="issuetype">', soy.$$escapeHtml("Issue Type"), '</option></select></div><div class="field-group"><label for="width">', soy.$$escapeHtml("Width"), '</label><input type="text" name="jira-chart-width" id="jira-chart-width" class="text short-field"><div class="description">', soy.$$escapeHtml("Enter a width in pixels, percent or leave blank to automatically resize"), '</div></div></fieldset><fieldset class="group"><div class="checkbox"><input type="checkbox" id="jira-chart-border" name="border" class="checkbox"><label for="jira-chart-show-border">', soy.$$escapeHtml("Show border"), '</label></div></fieldset><fieldset class="group"><div class="checkbox"><input type="checkbox" id="jira-chart-show-infor" name="jira-chart-show-infor" class="checkbox" value="checked" ><label for="jira-chart-show-infor">', soy.$$escapeHtml("Show chart information"), '</label></div></fieldset></div></form></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showMessageRenderJiraChart = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("The JIRA server didn\x27t understand your search query. If you entered JQL, please ensure that it\x27s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it."), '<!--<a href="', soy.$$escapeHtml("#"), '" target=\'_blank\'>', soy.$$escapeHtml("Learn More"), '</a>--><span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.noServerWarning = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', (opt_data.isAdministrator == true) ? soy.$$escapeHtml("No server found match with your URL.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/admin/listapplicationlinks.action">' + soy.$$escapeHtml("Click here to set this up") + '</a>' : soy.$$escapeHtml("No server found match with your URL. Your administrator can set this up.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/wiki/contactadministrators.action">' + soy.$$escapeHtml("Click here to contact your admin") + '</a>', '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.addMoreToComeLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="page-menu-item"><span class="item-button moreToCome"><a target="_blank" href="http://go.atlassian.com/confluencejiracharts">', soy.$$escapeHtml("More to come..."), '</a></span></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.jqlInvalid = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("The JIRA server didn\x27t understand your search query. If you entered JQL, please ensure that it\x27s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it."), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningValWidthColumn = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-chart-macro-dialog-validation-error">', (opt_data.error == 'wrongFormat') ? soy.$$escapeHtml("The width must be in correct format") : (opt_data.error == 'wrongNumber') ? soy.$$escapeHtml("The width must be a number between 100 and 9000") : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningValMaxiumIssues = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-max-number-error" class="error">', soy.$$escapeHtml("Must be a number between 1 and 1000."), '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showJiraUnsupportedVersion = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-unsupported-version aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("JIRA Charts are not available for your version of JIRA. Upgrade to JIRA 6.1.1 or later to use this macro."), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = 'templates/soy/create_issues.soy' */
// This file was automatically generated from create_issues.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.ConfluenceJiraPlugin == 'undefined') { Confluence.Templates.ConfluenceJiraPlugin = {}; }


Confluence.Templates.ConfluenceJiraPlugin.createIssuesForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui" id="create-issues-form"><div class="loading-blanket hidden"><div class="loading-data"/></div><div class="field-group servers"><label>', soy.$$escapeHtml("Server"), '</label><select class="select server-select"></select></div><div class="field-group project-select-parent" ><label>', soy.$$escapeHtml("Project"), '</label><select class="select project-select" name="pid"></select></div><div class="field-group type-select-parent issues-type-group" ><label>', soy.$$escapeHtml("Issue Type"), '</label><select class="select type-select" name="issuetype"></select></div><div class="field-group"><label>', soy.$$escapeHtml("Summary"), '<span class="aui-icon icon-required"/></label><input class="text issue-summary" type="text" name="summary"/></div><div class="field-group"><label>', soy.$$escapeHtml("Description"), '</label><textarea class="issue-description textarea" rows="5" name="description"/></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.renderOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var optionList15 = opt_data.options;
  var optionListLen15 = optionList15.length;
  for (var optionIndex15 = 0; optionIndex15 < optionListLen15; optionIndex15++) {
    var optionData15 = optionList15[optionIndex15];
    output.append('<option value="', soy.$$escapeHtml(optionData15.id), '">', soy.$$escapeHtml(optionData15.name), '</option>');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.renderOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="', soy.$$escapeHtml(opt_data.option.id), '">', soy.$$escapeHtml(opt_data.option.name), '</option>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/fields/fields.soy' */
// This file was automatically generated from fields.soy.
// Please don't edit this file by hand.

if (typeof jiraIntegration == 'undefined') { var jiraIntegration = {}; }
if (typeof jiraIntegration.templates == 'undefined') { jiraIntegration.templates = {}; }
if (typeof jiraIntegration.templates.fields == 'undefined') { jiraIntegration.templates.fields = {}; }


jiraIntegration.templates.fields.stringField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.form.textField({labelContent: soy.$$escapeHtml(opt_data.labelText), name: opt_data.name, value: opt_data.value, isRequired: opt_data.isRequired, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.textareaField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group jira-field', (opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '', '" data-jira-type="', soy.$$escapeHtml(opt_data.jiraType), '"><label for="', soy.$$escapeHtml(opt_data.name), '">', soy.$$escapeHtml(opt_data.labelText), (opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '', '</label><textarea rows="10" id="', soy.$$escapeHtml(opt_data.name), '" name="', soy.$$escapeHtml(opt_data.name), '" class="textarea long-field">', soy.$$escapeHtml(opt_data.value), '</textarea>');
  if (opt_data.errorTexts) {
    var errorList36 = opt_data.errorTexts;
    var errorListLen36 = errorList36.length;
    for (var errorIndex36 = 0; errorIndex36 < errorListLen36; errorIndex36++) {
      var errorData36 = errorList36[errorIndex36];
      output.append('<div class="error">', soy.$$escapeHtml(errorData36), '</div>');
    }
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.arrayField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.form.textField({id: opt_data.name, name: opt_data.name, labelContent: soy.$$escapeHtml(opt_data.labelText), value: opt_data.value, isRequired: opt_data.isRequired, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.numberField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.form.textField({id: opt_data.name, name: opt_data.name, labelContent: soy.$$escapeHtml(opt_data.labelText), value: opt_data.value, isRequired: opt_data.isRequired, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.allowedValuesField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.options.length) {
    aui.form.selectField({id: opt_data.name, name: opt_data.name, labelContent: soy.$$escapeHtml(opt_data.labelText), options: opt_data.options, isRequired: opt_data.isRequired, isMultiple: opt_data.isMultiple, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  } else {
    aui.form.valueField({id: opt_data.name, name: opt_data.name, labelContent: soy.$$escapeHtml(opt_data.labelText), value: "fields.allowedvalues.none", isRequired: opt_data.isRequired, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  }
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.timeTrackingField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.form.textField({id: opt_data.name, name: opt_data.name, labelContent: soy.$$escapeHtml(opt_data.labelText), value: opt_data.value, isRequired: opt_data.isRequired, extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''), extraAttributes: {'data-jira-type': opt_data.jiraType}, errorTexts: opt_data.errorTexts}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.fields.unrenderableTypeField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group jira-field jira-field-unrenderable', (opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '', '"><label>', soy.$$escapeHtml(opt_data.labelText), (opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '', '</label>');
  aui.form.value({content: opt_data.reasonContent}, output);
  if (opt_data.errorTexts) {
    var errorList116 = opt_data.errorTexts;
    var errorListLen116 = errorList116.length;
    for (var errorIndex116 = 0; errorIndex116 < errorListLen116; errorIndex116++) {
      var errorData116 = errorList116[errorIndex116];
      output.append('<div class="error">', soy.$$escapeHtml(errorData116), '</div>');
    }
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/fields/fields.js' */
var jiraIntegration=window.jiraIntegration||{};jiraIntegration.fields=(function(e,w){var o={template:jiraIntegration.templates.fields.stringField,getContext:b,getValue:t};var c={template:jiraIntegration.templates.fields.stringField,getContext:f,getValue:s};var p={template:jiraIntegration.templates.fields.textareaField,getContext:b,getValue:t};var r={template:jiraIntegration.templates.fields.numberField,getContext:b,getValue:t};var m={template:jiraIntegration.templates.fields.arrayField,getContext:l,getValue:g};var n={template:jiraIntegration.templates.fields.allowedValuesField,getContext:k,getValue:q};var h={template:jiraIntegration.templates.fields.timeTrackingField,getContext:v,getValue:u};var i={"com.pyxis.greenhopper.jira:gh-epic-label":o,string:o,summary:o,"com.atlassian.jira.plugin.system.customfieldtypes:textfield":o,"com.atlassian.jira.plugin.system.customfieldtypes:url":o,environment:o,"com.atlassian.jira.plugin.system.customfieldtypes:textarea":p,description:p,"com.atlassian.jira.plugin.system.customfieldtypes:float":r,array:m,labels:m,"com.atlassian.jira.plugin.system.customfieldtypes:labels":m,resolution:n,fixVersions:n,priority:n,versions:n,components:n,security:n,"com.atlassian.jira.plugin.system.customfieldtypes:version":n,"com.atlassian.jira.plugin.system.customfieldtypes:multiversion":n,"com.atlassian.jira.plugin.system.customfieldtypes:project":n,assignee:c,reporter:c,timetracking:h};function d(z,x,A){var y=x.schema.system||"customfield_"+x.schema.customId;return{labelText:x.name,name:y,isRequired:x.required,errorTexts:A[y],jiraType:z}}function b(B,x,y,z){var A=B.name;B.value=(e.isPlainObject(z[A])?z[A].name:z[A])||(y&&y.fields[A])||"";return B}function t(x){return x.val()}function l(B,x,y,z){var A=B.name;B.value=(z[A]&&z[A].join(","))||(y&&y.fields[A]&&y.fields[A].join(","));return B}function g(x){return w.map(x.val().split(","),e.trim)}function k(D,x,y,A){var B=D.name;var z=A[B];var E=y&&y.fields[B];var C;if(z){C=e.isArray(z)?w.pluck(z,"name"):[z.name]}else{if(E){C=e.isArray(E)?w.pluck(E,"name"):[E.name]}else{C=[]}}D.options=w.map(x.allowedValues,function(F){return{value:F.name,text:F.name,selected:w.contains(C,F.name)}});D.isMultiple=w.contains(x.operations,"add");return D}function q(y){var z=y.val();var x=y.attr("multiple");if(x){return e.isArray(z)?w.map(z,function(A){return{name:A}}):[{name:z}]}return{name:z}}function f(B,x,y,z){var A=B.name;B.value=(z[A]&&z[A].name)||(y&&y.fields[A]&&y.fields[A].name)||"";return B}function s(x){return{name:x.val()}}function v(B,x,y,z){var A=B.name;B.value=(z[A]&&z[A].remainingEstimate)||(y&&y.fields[A]&&y.fields[A].remainingEstimate)||"";return B}function u(x){return{remainingEstimate:x.val()}}function j(y,x){if(w.has(i,y)&&console&&console.warn){console.warn("Redefining handler for type "+y+".")}i[y]=x}function a(x){return i[x.schema?(x.schema.system||x.schema.customId):x]}return{addFieldHandler:j,getFieldHandler:a,canRender:function(x){var z=x.schema.system||x.schema.custom||x.schema.customId;var y=i[z];if(!y){return false}return x.operations&&x.operations.length&&(!y.canRender||y.canRender(x))},renderField:function(B,D,E,C){var x=D.schema.system||D.schema.custom||D.schema.customId;var z=i[x];var A=d(x,D,C||{});var F=!z||(z.canRender&&!z.canRender(D));var y=!D.operations||!D.operations.length;if(F||y){A.reasonContent=F?AJS.format("fields.unrenderable",'<a href="'+B.url+'">',"</a>"):y?AJS.format("fields.no.permission",'<a href="'+B.url+'">',"</a>"):null;if(!A.reasonContent){throw new Error("Invalid unrenderable reason.")}return jiraIntegration.templates.fields.unrenderableTypeField(A)}return z.template(z.getContext(A,D,B,E||{}))},getJSON:function(x){var z=x.closest(".jira-field").attr("data-jira-type");var y=z&&a(z);return y&&y.getValue&&y.getValue(x)}}}(AJS.$,window._));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-core', location = 'js/autoconvert/tinymce-autoconvert.js' */
(function($) {
    /***********
     * Constructor
     */
    tinymce.plugins.Autoconvert = function(ed){
        ed.onUndo.add(this.cleanLinks);
        this.editor = ed;
        this.handlers = [];
    };

    /***********
     * Instance Methods
     */
    tinymce.plugins.Autoconvert.prototype.addHandler = function (handler){
        this.handlers.push(handler)
    };
    
    tinymce.plugins.Autoconvert.prototype.cleanLinks = function(ed, level){
        $('a.atlassian-autoconvert', ed.getDoc()).removeClass('atlassian-autoconvert');
        return true;
    };

    tinymce.plugins.Autoconvert.prototype.callHandlers = function (node){
        var index = 0,
            self = this,
            originalNode = $(node),
            node = $(node).clone(),
            rawHref = node.attr('href'),
            uri = parseUri(hackAtSymbols(rawHref));
        
        /**
         * Runs handlers one at a time, this method acts as a continuation and is passed to each handler.
         */
        function run(newNode){
            if (newNode && (newNode.length !== 1 || !newNode.attr('href'))) {
                return handlersFinished(newNode);
            }

            if (newNode) {
                node = newNode;
                index = 0;
                uri = parseUri(node.attr('href'));
                callHandler(self.handlers[index], uri, node);
            } else {
                index++;
                if (index < self.handlers.length) {
                    callHandler(self.handlers[index], uri, node)
                } else {
                    return handlersFinished(node);
                }
            }
        }

        /**
         * This method ensures that a single handler can't break the event loop by never calling the continuation or by
         * calling it multiple times.
         */
        function callHandler(callback, uri, node){
            var modifiableRun = run,
                timer,
                continuation;
                
            continuation = function(){
                var localIndex = index;
                clearTimeout(timer);
                
                //actually call the next iteration of run
                modifiableRun.apply(self, arguments);
                
                //ensure a single handler can't call continuation multiple times
                modifiableRun = function(){
                    AJS.log('Autoconvert: Callback #' + localIndex + ' called the continuation multiple times.');
                }
            };
            timer = setTimeout(function(){
                AJS.log("Autoconvert: Callback #" + index + " failed to call continuation in time. If there is no subsequent log, the handler is improperly implemented and should be uninstalled.");
                modifiableRun = function(){
                    AJS.log("Autoconvert: Callback #" + index + " did eventualy return. Probably a slow async call.");
                };
                run();
            }, tinymce.plugins.Autoconvert.callbackTimeout);

            //Call the callback passing it a modified version of the continuation that allows us to prevent continuing after a timeout.
            callback(uri, node, continuation);
        }

        function handlersFinished(newNode){
            self.editor.undoManager.beforeChange();
            var selection = self.editor.selection,
                bm = self.editor.selection.getBookmark();
            
            
            //replace node that's actually in the editor with the newly modified node
            originalNode.replaceWith(newNode);
            
            selection.moveToBookmark(bm);
            self.editor.undoManager.add();
            
            
        }

        if (this.handlers.length !== 0) {
            callHandler(this.handlers[0], uri, node)
        }
    };

    /***********
     * Static properties
     */
    tinymce.plugins.Autoconvert.callbackTimeout = 5000;

    /***********
     * Static methods
     */
    tinymce.plugins.Autoconvert.convertMacroToDom = function(macro, success, error){
        var conversionData = {
            macro : macro,
            contentId :  AJS.Meta.get("content-id")
        };
        $.ajax( {
            type : "POST",
            contentType : "application/json; charset=utf-8",
            url : AJS.params.contextPath + "/rest/tinymce/1/macro/placeholder",
            data : $.toJSON(conversionData),
            dataType : "text", // if this is switched back to json be sure to use "text json". See CONFDEV-4799 for details.
            success : success,
            error : error,
            timeout: 45000
        });
    };
    
    tinymce.plugins.Autoconvert.convertMacroToDomViaWikiText = function(macro, success, error){
        var wikiTxt = ['{', macro.name];
        var firstParam = true;
        if (macro.defaultParameterValue){
            wikiTxt.push(':', macro.defaultParameterValue);
            firstParam = false;
        }
        for (var key in macro.params){
            if (firstParam){
                wikiTxt.push(':');
                firstParam = false;
            }
            else{
                wikiTxt.push('|');
            }
            wikiTxt.push(key,'=',macro.params[key]);
        }
        wikiTxt.push('}');
        tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup(
            wikiTxt.join(''),
            function(data){ 
                success($(data)[0]);
            },
            function(){
                error();
            }
        );

    };
    tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup = function(text, success, error){
        var conversionData = {
            wiki : text,
            entityId :  AJS.Meta.get("content-id"),
            spaceKey : AJS.Meta.get("space-key")
        };
        $.ajax( {
            type : "POST",
            contentType : "application/json; charset=utf-8",
            url : AJS.params.contextPath + "/rest/tinymce/1/wikixhtmlconverter",
            data : $.toJSON(conversionData),
            dataType : "text", // if this is switched back to json be sure to use "text json". See CONFDEV-4799 for details.
            success : success,
            error : error,
            timeout: 45000
        });
    };

    /***********
     * Private methods
     */

    // parseUri 1.2.2
    // (c) Steven Levithan <stevenlevithan.com>
    // MIT License
    function parseUri (str) {
        var o   = parseUri.options,
        m   = o.parser[o.strictMode ? "strict" : "loose"].exec(str),
        uri = {},
        i   = 14;

        while (i--) uri[o.key[i]] = m[i] || "";

        uri[o.q.name] = {};
        uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {
            if ($1) uri[o.q.name][$1] = $2;
        });

        return uri;
    }
    parseUri.options = {
        strictMode: false,
        key: ["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],
        q:   {
            name:   "queryKey",
            parser: /(?:^|&)([^&=]*)=?([^&]*)/g
        },
        parser: {
            strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
            loose:  /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
        }
    };


    /**
     * parseUri has a bug whereby it deems everything up to the first @ to be part of the "authority"
     * section of the Uri. Even in strict mode.  We should fix this properly, but for now, we're just
     * replacing the first @ with an encoded one.
     */
    function hackAtSymbols(rawHref) {
        return rawHref.replace(/^(.*?\/\/[^/]*?\/.*?)(@)/, "$1%40");
    };


    // ======== TinyMCE plugin creation ===========================================================
    // Since this process relies on tinymce.plugins.AutoConvert already existing these two separate 
    // concerns need to be included in the same source file. Otherwise you cannot create a new 
    // tinymce.plugins.Autoconvert until TinyMCE is initialised, yet you cannot initialise this 
    // TinyMCE plugin until tinymce.plugins.Autoconvert.autoConvert exists.

	tinymce.create('tinymce.plugins.AutoconvertPlugin', {
		init: function (ed){
			var autoConvert = tinymce.plugins.Autoconvert.autoConvert = new tinymce.plugins.Autoconvert(ed);
			
			ed.onInit.add(function(){
				AJS.$(document).bind('postPaste', function(e, pl, o) {
					var anchor = $(o.node).children('a');
					if ( anchor.length === 1 && anchor[0].tagName === "A" && anchor.text() === anchor.attr('href')) {
						anchor.attr('class', 'atlassian-autoconvert');
						setTimeout(function(){
							var anchor = $('a.atlassian-autoconvert', $(ed.selection.getNode().ownerDocument)).removeClass('atlassian-autoconvert');
							autoConvert.callHandlers(anchor);
						}, 0);
					}
				});

				ed.addCommand("addAutoconverter", function(ui, options) {
					autoConvert.addHandler(options);
				});
			});
		},
        getInfo: function() {
            return {
                longname: 'Atlassian Autoconvert',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
	});
	
	tinymce.PluginManager.add('autoconvert', tinymce.plugins.AutoconvertPlugin);
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:autoconvert-jira', location = '/jira/jirapaste.js' */
(function(){AJS.bind("init.rte",function(){AJS.Editor.JiraConnector.Paste={issueKeyOnlyRegEx:/\/(i#)?browse\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+$)/,singleTicketXMLEx:/\/jira\.issueviews:issue-xml\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+)\//,issueKeyWithinRegex:/\/(i#)?browse\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+)(?:\?|#)/,jqlRegEx:/jqlQuery\=([^&]+)/,jqlRegExAlternateFormat:/jql\=([^&]+)/,pasteHandler:function(e,g,k){var n=AJS.Editor.JiraConnector.servers;var m=AJS.Editor.JiraAnalytics;var d={};var o;if(!n){k();return}for(var l in n){var h=n[l];if(e.source.indexOf(h.url)==0){o=h;break}}var f;if(o){var b=AJS.Editor.JiraConnector.Paste.jqlRegEx.exec(e.source)||AJS.Editor.JiraConnector.Paste.jqlRegExAlternateFormat.exec(e.source);var a=AJS.JQLHelper.isFilterUrl(e.source);var j=AJS.Editor.JiraConnector.Paste.issueKeyOnlyRegEx.exec(e.source)||AJS.Editor.JiraConnector.Paste.issueKeyWithinRegex.exec(e.source);if(j){j=j[2];if(m){d.type=m.linkTypes.jql}}else{j=AJS.Editor.JiraConnector.Paste.singleTicketXMLEx.exec(e.source);if(j){j=j[1];if(m){d.type=m.linkTypes.xml}}}if(b){d.is_single_issue=false;d.type=AJS.JQLHelper.checkQueryType(e.source);f={name:"jira",params:{server:o.name,serverId:o.id,jqlQuery:decodeURIComponent(b[1].replace(/\+/g,"%20"))}}}else{if(a){var c=e.source;d.is_single_issue=false;d.type=AJS.JQLHelper.checkQueryType(c);f={name:"jira",params:{server:o.name,serverId:o.id,jqlQuery:AJS.JQLHelper.getFilterFromFilterUrl(c)}}}else{if(j){d.is_single_issue=true;f={name:"jira",params:{server:o.name,serverId:o.id,key:j}}}}}}if(f){tinymce.plugins.Autoconvert.convertMacroToDom(f,k,k);if(m){m.triggerPasteEvent(d)}}else{k()}}};tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.JiraConnector.Paste.pasteHandler)})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:text-placeholders-jira', location = '/jira/placeholder.js' */
(function(){AJS.bind("init.rte",function(){AJS.bind("editor.text-placeholder.activated",function(b,a){if(a&&a.placeholderType==="jira"){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.instructionalText)}});if(AJS.Rte.Placeholder&&AJS.Rte.Placeholder.addPlaceholderType){AJS.Rte.Placeholder.addPlaceholderType({type:"jira",label:"JIRA Macro",tooltip:"Instructional text is replaced with a JIRA Macro on click.",activation:{click:true,keypress:false}})}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jirachart-macro', location = '/jirachart/jirachart-dialog.js' */
AJS.Editor.JiraChart=(function(w){var r=-1;var l=6109;var n=6155;var p="Insert";var y="Cancel";var m="Insert JIRA Chart";var I="";var h=I;var c;var k=/^\d+$/;var t;var g=function(){if(!t){t=new AJS.ConfluenceDialog({width:840,height:590,id:"jira-chart"});t.addHeader(m);var M=AJS.Editor.JiraChart.Panels;for(var N=0;N<M.length;N++){t.addPanel(M[N].title);var P=t.getCurrentPanel();M[N].init(P)}w("#jira-chart ul.dialog-page-menu").show().append(Confluence.Templates.ConfluenceJiraPlugin.addMoreToComeLink());var O=w("#jira-chart-content");t.addLink("Select Macro",function(){t.hide();AJS.MacroBrowser.open(false)},"dialog-back-link");t.addButton(p,function(){if(j()){var Q=a(O);if(!AJS.Editor.JiraChart.validateWidth(Q.width)){Q.width=I}v(Q);AJS.Editor.JiraChart.close()}else{s(O)}},"insert-jira-chart-macro-button");t.addCancel(y,function(){AJS.Editor.JiraChart.close()});K(O)}z(O);t.gotoPanel(0);t.show()};var K=function(N){var M=N.find(".jira-chart-search button, #jira-chart-border, #jira-chart-show-infor");M.click(function(){s(N)});D(N.find("input[type='text']"),s,N);N.find("#jira-chart-width").focusout(function(O){var P=o(this.value);if(P!=h){h=P;s(N)}});N.find("#jira-chart-inputsearch").change(function(){if(this.value!==c){z(N);A()}c=I}).bind("paste",function(){q(N)});N.find("#jira-chart-statType").change(function(O){s(N)});i(N);if(AJS.Editor.JiraConnector.servers.length>0){AJS.Editor.JiraConnector.Panel.prototype.applinkServerSelect(AJS.$("#jira-chart-servers"),function(O){z(N);if(H(O)){G(N);C(N)}else{J(N,O);b(N)}})}};var i=function(N){var O=N.find(".jira-chart-option");O.css("top","430px");var M=N.find(".jirachart-display-opts-close, .jirachart-display-opts-open");M.click(function(Q){var P=w(this);Q.preventDefault();if(P.hasClass("disabled")){return}var R=P.hasClass("jirachart-display-opts-open");if(R){L(N,true);P.addClass("jirachart-display-opts-close");P.removeClass("jirachart-display-opts-open")}else{L(N);P.removeClass("jirachart-display-opts-close");P.addClass("jirachart-display-opts-open")}})};var f=function(O){var N=a(AJS.$("#jira-chart-content"));if(N.chartType==="pie"){var M=AJS.Editor.JiraChart.Panels[0];O(M,N)}};var s=function(M){var N=AJS.$("#jira-chart-width");f(function(O,P){if(O.validate(N)){x(M)}})};var x=function(M){if(E(M)===undefined){return}var O=M.find(".jira-chart-img");O.html('<div class="loading-data"></div>');var N=O.find(".loading-data")[0];AJS.$.data(N,"spinner",Raphael.spinner(N,50,"#666"));f(function(P,Q){P.renderChart(O,Q)})};var L=function(N,Q){var M=N.find(".jira-chart-option");var P=40;var S=M.position().top+"px";var O=I;var R={top:430};if(Q){S=I;O=P-M.height()+"px";R={bottom:0}}M.css("top",S);M.css("bottom",O);M.animate(R,500)};var q=function(M){setTimeout(function(){s(M)},100)};var E=function(N){var S=AJS.Editor.JiraConnector.servers;var P;var O=N.find("#jira-chart-inputsearch").val();if(O.indexOf("http")===0){var R=AJS.JQLHelper.findServerIndexFromUrl(O,S);if(R!==-1){P=S[R].id;N.find("#jira-chart-servers").val(P)}else{var Q=Confluence.Templates.ConfluenceJiraPlugin.noServerWarning({isAdministrator:AJS.Meta.get("is-admin"),contextPath:Confluence.getContextPath()});N.find(".jira-chart-img").html(Q);return}}var M=AJS.JQLHelper.convertToJQL(O,P);if(M){N.find("#jira-chart-inputsearch").val(M)}else{N.find(".jira-chart-img").html(Confluence.Templates.ConfluenceJiraPlugin.jqlInvalid());e()}return M};var a=function(M){var N=d(M);return{jql:encodeURIComponent(M.find("#jira-chart-inputsearch").val()),statType:M.find("#jira-chart-statType").val(),width:o(M.find("#jira-chart-width").val()),border:M.find("#jira-chart-border").prop("checked"),showinfor:M.find("#jira-chart-show-infor").prop("checked"),serverId:N.id,server:N.name,isAuthenticated:!N.authUrl,chartType:"pie"}};var o=function(M){M=M.replace("px",I);if(M==="auto"){M=I}if(M.indexOf("%")>0){M=M.replace("%",I)*4}return M};var v=function(M){var N=function(O){tinymce.confluence.macrobrowser.macroBrowserComplete(O)};if(AJS.Editor.inRichTextMode()){N({name:"jirachart",params:M})}};var u=function(M){if(M.attr("id")==="jira-chart-inputsearch"){c=M.val()}};var D=function(M,N,O){M.unbind("keydown").keydown(function(P){if(P.which==13){var Q=function(R){M.unbind("keyup",Q);N(O);u(M);return AJS.stopEvent(R)};M.keyup(Q);return AJS.stopEvent(P)}})};var B=function(N,M){if(M===undefined||M.serverId===undefined){w(":input",N).not(":button, :submit").val("").removeAttr("checked").removeAttr("selected")}else{N.find("#jira-chart-inputsearch").val(decodeURIComponent(M.jql));N.find("#jira-chart-statType").val(M.statType);N.find("#jira-chart-width").val(M.width);N.find("#jira-chart-border").attr("checked",(M.border==="true"));N.find("#jira-chart-show-infor").attr("checked",(M.showinfor==="true"));if(AJS.Editor.JiraConnector.servers.length>1){N.find("#jira-chart-servers").val(M.serverId)}}};var d=function(M){var N=AJS.Editor.JiraConnector.servers;if(N.length>1){return M.find("#jira-chart-servers option:selected").data("jiraapplink")}return N[0]};var F=function(){if(AJS.Editor.JiraConnector.servers===undefined||AJS.Editor.JiraConnector.servers.length===0){AJS.Editor.JiraConnector.warningPopup(AJS.Meta.get("is-admin"));return false}return true};var z=function(M){M=M||w("#jira-chart-content");M.find(".jira-oauth-message-marker").remove();M.find(".jira-chart-img").empty()};var e=function(){AJS.$("#jira-chart").find(".insert-jira-chart-macro-button").disable()};var A=function(){var M=AJS.$("#jira-chart").find(".insert-jira-chart-macro-button");if(M.is(":disabled")){M.enable()}};var J=function(O,N){AJS.$(".jira-oauth-message-marker",O).remove();var P={selectedServer:N,msg:AJS.Editor.JiraConnector.Panel.prototype.msg};if(N&&N.authUrl){var M=AJS.Editor.JiraConnector.Panel.prototype.createOauthForm.call(P,function(){AJS.$(".jira-oauth-message-marker",O).remove();AJS.Editor.JiraChart.search(O)});O.find("div.jira-chart-search").append(M)}};var j=function(){return w("#chart-preview-iframe").contents().find(".jira-chart-macro-img").length>0};var G=function(M){M.find(".jira-chart-img").html(Confluence.Templates.ConfluenceJiraPlugin.showJiraUnsupportedVersion())};var C=function(N){N.find("#jira-chart-inputsearch").attr("disabled","disabled");N.find("#jira-chart-search-button").attr("disabled","disabled");var M=N.find(".jirachart-display-opts-close, .jirachart-display-opts-open");if(M.hasClass("jirachart-display-opts-close")){M.click()}M.addClass("disabled");e()};var b=function(M){M.find("#jira-chart-inputsearch").removeAttr("disabled");M.find("#jira-chart-search-button").removeAttr("disabled");M.find(".jirachart-display-opts-open").removeClass("disabled");A()};var H=function(N){var M=N.buildNumber;return M==r||(M>=l&&M<n)};return{close:function(){t.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()},edit:function(M){if(!F()){return}g();var O=w("#jira-chart-content");B(O,M.params);var N=d(O);if(H(N)){G(O);C(O);return}b(O);if(M.params!==undefined&&M.params.serverId!==undefined){s(O)}J(O,N)},search:s,validateWidth:function(M){return this.isNumber(M)&&M>=100&&M<=9000},isNumber:function(M){return k.test(M)},convertFormatWidth:o,disableInsert:e,enableInsert:A}})(AJS.$);AJS.Editor.JiraChart.Panels=[];AJS.MacroBrowser.setMacroJsOverride("jirachart",{opener:AJS.Editor.JiraChart.edit});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jirachart-macro', location = '/jirachart/piechart-panel.js' */
AJS.Editor.JiraChart.Panels.PieChart=function(){var a="Pie Chart";var b=function(c){if(c.contents().find(".jira-chart-macro-img").length>0){AJS.Editor.JiraChart.enableInsert()}else{AJS.Editor.JiraChart.disableInsert()}};return{title:a,init:function(c){var d=Confluence.Templates.ConfluenceJiraPlugin.contentJiraChart({isMultiServer:AJS.Editor.JiraConnector.servers.length>1});c.html(d)},renderChart:function(e,g){var d=e;var c=Confluence.getContextPath()+"/rest/tinymce/1/macro/preview";var f={contentId:AJS.Meta.get("page-id"),macro:{name:"jirachart",params:{jql:g.jql,serverId:g.serverId,width:g.width,border:g.border,showinfor:g.showinfor,statType:g.statType}}};AJS.$.ajax({url:c,type:"POST",contentType:"application/json",data:JSON.stringify(f)}).done(function(h){d.html("").hide();var k=$('<iframe frameborder="0" name="macro-browser-preview-frame" id="chart-preview-iframe"></iframe>');k.appendTo(d);var j=k[0].contentWindow,i=j.document;i.open();i.write(h);i.close();k.on("load",function(){j.AJS.$("#main").addClass("chart-preview-main");d.show();b($(this))})}).error(function(h,j,i){AJS.log("Jira Chart Macro - Fail to get data from macro preview");e.html(Confluence.Templates.ConfluenceJiraPlugin.showMessageRenderJiraChart());AJS.Editor.JiraChart.disableInsert()})},validate:function(d){AJS.$(d).next("#jira-chart-macro-dialog-validation-error").remove();var c=AJS.$(d);var e=AJS.Editor.JiraChart.convertFormatWidth(c.val());if(!AJS.Editor.JiraChart.validateWidth(e)&&e!==""){var f="wrongFormat";if(AJS.Editor.JiraChart.isNumber(e)){f="wrongNumber"}c.after(Confluence.Templates.ConfluenceJiraPlugin.warningValWidthColumn({error:f}));return false}return true}}};AJS.Editor.JiraChart.Panels.push(new AJS.Editor.JiraChart.Panels.PieChart());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.widgetconnector:twitter-autoconvert-webresources', location = 'com/atlassian/confluence/extra/widgetconnector/js/autoconvert-twitter.js' */
(function(){AJS.bind("init.rte",function(){var A=/^\/(.*?)\/status\/([^/]+\/?$)/,C=/^\/(.*?)\/statuses\/([^/]+\/?$)/,B=function(H,G,D){var E,I,F;
if(H.host.match(/^twitter.com/)){if(E=decodeURI(H.path).match(A)){I=H.protocol+"://twitter.com/"+E[1]+"/status/"+E[2]
}else{if(E=decodeURI(H.path).match(C)){I=H.protocol+"://twitter.com/"+E[1]+"/statuses/"+E[2]
}}if(I){F={name:"widget",params:{url:I}};
tinymce.plugins.Autoconvert.convertMacroToDom(F,D,D)
}else{D()
}}else{D()
}};
tinymce.plugins.Autoconvert.autoConvert.addHandler(B)
})
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings.js' */
AJS.log("tinyMce-autocomplete-settings initialising");
Confluence.Editor.Autocompleter={Settings:{},log:function(A){return function(C,E,D){var F=(D!=null&&typeof D!="object");
var B=D!=null?(F?(" = "+D):" >"):"";
AJS.log(A+" - "+C+" : "+(E||null)+B);
D&&!F&&AJS.log(D)
}
}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-util.js' */
AJS.log("tinyMce-autocomplete-util starting");
Confluence.Editor.Autocompleter.Util=(function(B){var A=function(K,D,J,F,E){var I=K.statusMessage;
var G;
if(I){G=[[{html:K.statusMessage,className:"error"}]]
}else{var C=D?AJS.REST.makeRestMatrixFromSearchData(K):AJS.REST.makeRestMatrixFromData(K,F);
G=AJS.REST.convertFromRest(C)
}function H(M,L){if(E&&typeof E=="function"){E(G,M,L)
}}J(G,D,H)
};
return{dropdownLink:function(E,D,C){return"<a href='#' class='"+(D||"")+"'><span class='icon "+(C||"")+"'></span><span>"+E+"</span></a>"
},getRestData:function(E,G,K,D,J,M,H){var C=G(D),I=E.settings.cacheManager,F=I.get(D),L;
if(C){L=B.ajax({type:"GET",url:C,data:K(E,D),dataType:"json",global:false,timeout:5000});
L.done(function(N){I.put(D,N)
});
if(F){A(F,D,J,M,H)
}else{L.done(function(N){A(N,D,J,M,H)
});
L.fail(function(O,N){if(N=="timeout"){A({statusMessage:"Timeout",query:D},D,J,M)
}})
}}else{J([],D)
}}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-control.js' */
AJS.log("tinyMce-autocomplete-control starting");
(function(C){var B="autocomplete";
var A="autocomplete-trigger";
var D="autocomplete-search-text";
Confluence.Editor.Autocompleter.Control=function(L,K){var O=Confluence.Editor.Autocompleter.log("Autocompleter.Control");
var Q={},k=L.selection,N=k.getRng(true),P=N.startOffset,c=N.startContainer,W=c.nodeValue,E=K.leadingChar,l=L.getDoc(),J=K.backWords||0,f=Confluence.Editor.Autocompleter.Settings[E||"["],Y=(!f||typeof f.preventStartNodes==="undefined")?"div.code, a[href], img, pre":f.preventStartNodes;
if(C("#"+B,l).length){O("init","Autocomplete already exists, returning null.");
return null
}Q.backWords=J;
Q.maxResults=K.maxResults||10;
if(W==null&&N.collapsed&&P&&c.childNodes[P-1]){c=c.childNodes[P-1];
W=c.nodeValue;
P=(W&&W.length)||0
}var U="";
if(W!=null){U=(W+"").substring(0,P);
var d=c.previousSibling;
while(d&&d.nodeType==3){U=d.nodeValue+U;
d=d.previousSibling
}}function R(n,p){for(var o=0,m=p.length;
o<m;
o++){if(p[o].test(n)){return true
}}return false
}var M=[/([("'<\(\u201c\u2018]\[|[\ufeff\u200b\u2014\s\xa0].)$/,/(\([^!])$/];
if(!J&&U&&!R(U+E,M)){O("init","Cursor is in wrong word location to start autocomplete, returning null.");
return null
}var i=AJS.$(c);
if(i.closest(Y).length){O("init","Cursor is in wrong node to start autocomplete, returning null.");
return null
}if(Confluence.PropertyPanel&&Confluence.PropertyPanel.current){AJS.log("Trying to destroy property panel");
Confluence.PropertyPanel.shouldCreate=false;
Confluence.PropertyPanel.destroy()
}if(!E&&W==null){O("init","No text available for suggestion, range is",N);
W=""
}Q.getContainer=function(){return C("#"+B,l)
};
function e(q,s,r){var p,o;
function n(y,v,w){!v.global&&(v=new RegExp(v.source,"g"+"i".slice(0,v.ignoreCase)+"m".slice(0,v.multiLine)));
if(w==null){w=y.length
}else{if(w<0){w=0
}}var u=y.substring(0,w+1),t=-1,x=0;
while((result=v.exec(u))!=null){t=result.index;
v.lastIndex=++x
}return t
}for(var m=0;
m<r;
m++){p=q.nodeValue.substring(0,s);
s=n(p,(/\s+/),s);
while(s==-1){o=q.previousSibling;
if(o&&o.nodeType==3){q=o;
p=o.nodeValue;
if(p){s=n(p,(/\s+/),p.length)
}}else{m=r;
break
}}}return{node:q,offset:s+1}
}var S="";
if(N.collapsed&&J&&W){var h=e(c,P,J);
if(tinymce.isIE&&J==1){var V=k.getRng();
V.moveStart("character",h.offset-P);
V.select()
}else{V=k.getRng(true);
V.setStart(h.node,h.offset);
V.setEnd(c,P);
k.setRng(V)
}}S=k.getContent({format:"text"}).replace("\n","");
O("init","suggestionHtml",S);
var G=AJS("span").attr("id",B);
if(E){G.append(AJS("span").attr("id",A).text(E))
}var F=AJS("span").attr("id",D);
F.text(AJS.Rte.HIDDEN_CHAR);
G.append(F);
k.setNode(G[0]);
var X=Q.getContainer();
Q.previousSearchText="";
Q.settings=f;
if(f.cache!==false&&!f.cacheManager){f.cacheManager=new AJS.Confluence.localStorageCacheManager(f.ch)
}else{if(f.cache===false&&!f.cacheManager){f.cacheManager={get:C.noop,put:C.noop}
}}var g=C("#"+D,Q.getContainer()),j=C(l.createElement("span")).text(S||AJS.Rte.HIDDEN_CHAR);
g.empty().append(j);
k.select(j[0],true);
k.collapse();
var T=function(m,n){if(Q.onBeforeKey&&!Q.onBeforeKey(n,Q.text())){tinymce.dom.Event.cancel(n);
O("before","blocked by onBeforeKey: "+n.keyCode);
return false
}},I=function(o,t){var n=k.getRng(true),r=Q.getContainer(),s=n.startContainer,q=s.parentNode;
s.nodeType==3&&(q=q.parentNode);
var p=q.parentNode,m=q!=r[0]&&p!=r[0];
if(t.keyCode==27||m){O("after","dying because of: "+(m?"outside search span":"escape pressed"));
Q.die()
}else{if(Q.onAfterKey&&!Q.onAfterKey(t,Q.text())){tinymce.dom.Event.cancel(t);
O("after","blocked by onAfterKey: "+t.keyCode);
return false
}}},Z=function(m,n){if(Q.onKeyPress&&!Q.onKeyPress(n,Q.text())){tinymce.dom.Event.cancel(n);
O("press","blocked by onKeyPress: "+n.keyCode);
return false
}},b=function(m,n){if(Q.getContainer()[0]!=n.target.parentNode){O("click","Clicked outside of autocomplete, closing.");
Q.die()
}};
L.onKeyDown.addToTop(T);
L.onKeyUp.addToTop(I);
L.onKeyPress.addToTop(Z);
L.onClick.addToTop(b);
Q.word="";
if(!K.keepAlias){Q.word=S
}else{O("init","No suggestion based on previous or selected text")
}AJS.Rte.showElement(X[0]);
function H(){var n=tinymce.DOM.getPos(X[0]),m=X.height();
Q.left=n.x;
Q.top=n.y+m
}H();
Q.text=function(n){var m=C("#"+D,Q.getContainer());
if(n!=null){m.html(n);
return this
}else{n=AJS.escapeEntities(m.text());
return n.replace(AJS.Rte.HIDDEN_CHAR,"")
}};
Q.plainText=function(n){var m=C("#"+D,Q.getContainer());
if(n!=null){m.text(n);
return this
}else{n=m.text();
return n.replace(AJS.Rte.HIDDEN_CHAR,"")
}};
var a=function(o,n){var m=Q.getContainer();
return Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange(m,o,n)
};
Q.replaceWithSelectedSearchText=function(){var m=Q.text();
O("replaceWithSelectedSearchText",m);
a(m,false);
return m
};
Q.die=function(o){if(Q.dying){O("die","Already dying, returning.");
return 
}Q.dying=true;
if(Confluence.PropertyPanel){Confluence.PropertyPanel.shouldCreate=true
}var n=Q.getContainer();
if(n.length){O("die","Tearing down autocomplete, cleaning up autocompleter");
var m=((o||K.backWords)?"":Q.settings.ch)+Q.text();
N=a(m,true)
}setTimeout(function(){O("die","Removing autocomplete-control keyboard listeners.");
L.onKeyDown.remove(T);
L.onKeyUp.remove(I);
L.onClick.remove(b);
L.onKeyPress.remove(Z)
},1);
AJS.Rte.unbindScroll("autocomplete");
C(document).unbind("click.autocomplete-outside");
this.onDeath&&this.onDeath()
};
AJS.Rte.bindScroll("autocomplete",function(m){AJS.log("scrolling:",m);
if(!AJS.Rte.isAnyPartShown(X)){Q.die()
}else{Q.onScroll()
}});
C(document).bind("click.autocomplete-outside",function(m){if(!C(m.target).closest("#autocomplete-dropdown").length){Q.die()
}});
AJS.Rte.getEditor().onBeforeExecCommand.add(function(m,n){if(n=="mceConfSavePage"){Q.die()
}});
Q.update=function(m){AJS.Rte.BookmarkManager.storeBookmark();
a("",true);
this.settings.update(this,m)
};
Q.removeSpan=function(){Q.getContainer().remove()
};
return Q
};
Confluence.Editor.Autocompleter.Control.removeOrphanedControl=function(){var G=C(AJS.Rte.getEditor().getDoc()),H=G.find("#"+B),E,F;
if(!H.length){return null
}E=G.find("#"+A).text();
F=G.find("#"+D).text();
Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange(H,F,false);
return{leadingChar:E,content:F}
};
Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange=function(H,L,K){if(!H.length){AJS.log("replaceWithTextAndGetRange Error: attempting to replace a non-existent element");
return 
}L=L||"";
K=K||!L;
var G=AJS.Rte.getEditor(),F;
var I=H[0].parentNode,E=AJS.Rte.Content.getChildIndex(I,H[0]),J=K?1:0;
F=G.selection.getRng(true);
F.setStart(I,E+J);
F.setEnd(I,E+1);
H.before(L||AJS.Rte.HIDDEN_CHAR).remove();
G.selection.setRng(F);
return F
}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-manager.js' */
AJS.log("tinyMce-autocomplete-manager starting");
Confluence.Editor.Autocompleter.Manager=(function(E){var C=Confluence.Editor.Autocompleter.log("Autocompleter.Manager");
var G;
var F;
var B=function(U){C("startAutoComplete","Started");
G=Confluence.Editor.Autocompleter.Control(AJS.Rte.getEditor(),U);
if(!G){return false
}var R=function(X,W){X.preventDefault();
var V=AJS.$.data(W[0],"properties");
if(V&&typeof V.callback=="function"){V.callback(G)
}else{if(V.className!="menu-header"){C("selectionHandler","Inserting link from dropdown selection");
G.update(V)
}}G.die()
};
var N=function(W,V){var X=AJS.dropDown.current;
if(W&&W.find("a").is(".menu-header")){V=="up"?X.moveUp():X.moveDown()
}};
var J=AJS.$(window).width(),M,O;
var P=1,T=2;
var L;
var I=function(W,V){if(W.below>=V){return T
}else{if(W.above>=V){return P
}}return W.below>W.above?T:P
};
var Q=function(W,V){if(M==P){return W.above>=V
}return W.below>=V
};
var S=function(e,Y,X,b){var a,c,d,W;
if(window.Raphael){if(F.raphaelArrow&&O!=M){F.raphaelArrow.remove&&F.raphaelArrow.remove();
F.raphaelArrow=null
}if(M==P){a="#ffffff";
c="M0.001-1.000l6.001,6.001,6.001-6.001";
d=e+X-1
}else{a="#f0f0f0";
c="M0.001,6.001l6.001-6.001,6.001,6.001";
d=e-5
}W=Y+4;
if(F.raphaelArrow){F.raphaelArrow.canvas.style.left=W+"px";
F.raphaelArrow.canvas.style.top=d+"px"
}else{var V=Raphael(W,d,16,10),Z=V.path(c);
Z.attr({fill:a,stroke:"#bbb"});
V.canvas.style.zIndex=3000;
F.raphaelArrow=V;
O=M;
if(b&&E.support.opacity){Z.clone().translate(4,4).attr({fill:"#A0A0A0",stroke:"#A0A0A0",opacity:".5",blur:"1"}).toBack()
}}}};
var H=function(d){var g=E("#autocomplete-dropdown"),c=G.getContainer(),Y,e,Z,b,f,h=10,W=0,a,X,V;
if(!g.length){g=AJS("div").addClass("aui-dd-parent quick-nav-drop-down").attr("id","autocomplete-dropdown").appendTo("body")
}Y=AJS.Position.spaceAboveBelow(AJS.Rte.getEditorFrame(),c);
d.find("ol:has(a.menu-header)").addClass("top-menu-item");
d.find("ol:empty").hide();
g.append(d);
b=AJS.Rte.Content.offset(c);
f=g.width()+b.left-J+10;
Z=b.left-(f>0?f:0)-W;
a=d.outerHeight(true);
X=a+h;
if(M){if(!Q(Y,X)){M=null
}}if(!M){M=I(Y,X)
}if(M==P){e=b.top-a-h;
V=true
}else{e=b.top+c.height()+h;
V=false
}g.css({position:"absolute",top:e,left:Z});
S(e,b.left,a,V);
if(E.browser.msie&&parseInt(E.browser.version,10)<9){F.dd.show()
}};
F=AJS.inputDrivenDropdown({onShow:function(V){C("onShow","Post-processing the dropdown");
var W=AJS.Rte.getEditorFrame();
W&&W.shim&&W.shim.hide();
V.find("a.menu-header").unbind().click(function(X){X.preventDefault();
G.die()
});
this.reset();
if(G.settings.selectFirstItem&&V.find("a:not('.menu-header')").length){AJS.dropDown.current.moveDown()
}},dropdownPlacement:H,onDeath:function(){E("#autocomplete-dropdown").remove();
F.raphaelArrow&&F.raphaelArrow.remove&&F.raphaelArrow.remove()
},ajsDropDownOptions:{selectionHandler:R,moveHandler:N,className:"autocomplete "+G.settings.dropDownClassName},getDataAndRunCallback:function(V){G&&G.settings.getDataAndRunCallback&&G.settings.getDataAndRunCallback(G,V,function(W,Y,X){W.unshift([{className:"menu-header dropdown-prevent-highlight",href:"#",name:G.settings.getHeaderText(G,V)}]);
W.push(G.settings.getAdditionalLinks(G,V,X));
F&&F.show(W,Y,[Y])
})
},dropDownDelay:G.settings.dropDownDelay});
G.onBeforeKey=function(V,W){if(V.keyCode==40||V.keyCode==38||V.keyCode==13){tinymce.dom.Event.cancel(V);
return false
}if(V.keyCode==27||V.keyCode==9||(V.keyCode==8&&!W)){C("autoCompleteControl.onBeforeKey","killing autoCompleteControl and returning false");
this.die(V.keyCode==8);
return false
}return true
};
G.onKeyPress=function(Y,Z){var W=AJS.$.browser.msie?Y.keyCode:Y.which,X=String.fromCharCode(W);
if(Y.keyCode==13){tinymce.dom.Event.cancel(Y);
return false
}var V=AJS.indexOf(this.settings.endChars,X);
if(V!=-1){C("autoCompleteControl.onKeyPress","caught autocomplete-closing char "+X+", closing");
G.die()
}return true
};
var K=/\S{2,}/;
G.onAfterKey=function(X,Y){if(X.keyCode==40||X.keyCode==38||X.keyCode==13){var W=AJS.dropDown.current;
if(!W){C("autoCompleteControl.onBeforeKey","key caught before dropdown ready, ignoring");
return false
}if(W.getFocusIndex()==-1&&X.keyCode==13){D();
return true
}if(!X.which){X.which=X.keyCode
}return W.moveFocus(X)
}var V=(X.keyCode==8&&!Y);
if(V||K.test(Y)){C("onAfterKey","Changed search string to '"+Y+"'");
F.change(Y,V)
}return true
};
G.onDeath=function(){C("onDeath","autoCompleteControl onDeath called");
if(F){F.remove();
F.closing=true
}};
G.onScroll=function(){C("onScroll","autoCompleteControl onScroll called");
if(!F.dd){return 
}H(F.dd.$)
};
F.change(G.text(),"force");
return true
};
var D=function(){G.die();
G=null
};
var A=function(){var H=Confluence.Editor.Autocompleter.Control.removeOrphanedControl();
H&&Confluence.Editor.Autocompleter.Manager.shortcutFired(H.leadingChar)
};
return{getInputDrivenDropdown:function(){return F
},triggerListener:function(H,K){if(K.metaKey){return true
}var I=AJS.$.browser.msie?K.keyCode:K.which;
F&&F.closing&&(F=null);
var J=String.fromCharCode(I);
if(!F&&J in Confluence.Editor.Autocompleter.Settings){C("triggerListener","Auto-complete initiated: trigger is ",J);
B({leadingChar:J})&&tinymce.dom.Event.cancel(K)
}return true
},shortcutFired:function(H,I){var J=I?0:1;
F&&F.closing&&(F=null);
if(F){J=I?0:G.backWords+1;
C("shortcutFired","autocomplete active, increasing word selection to: "+J);
D()
}return B({leadingChar:H,backWords:J})
},reattach:A}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-links.js' */
(function(){AJS.log("tinyMce-autocomplete-settings-links initialising");
var C=Confluence.Editor.Autocompleter,A=function(D){if(D){return Confluence.getContextPath()+"/rest/prototype/1/search.json"
}else{if(AJS.Meta.get("remote-user")){return Confluence.getContextPath()+"/rest/prototype/1/session/history.json"
}}return null
},B=function(F,E){var D={"max-results":F.maxResults};
if(E){D.query=Confluence.unescapeEntities(E);
D.search="name";
D.preferredSpaceKey=AJS.Meta.get("space-key")
}return D
};
Confluence.Editor.Autocompleter.Settings["["]={ch:"[",cache:false,endChars:["]"],dropDownClassName:"autocomplete-links",selectFirstItem:true,getHeaderText:function(E,D){return "Link suggestions"
},getAdditionalLinks:function(J,I,F){var D;
if(I){var G="Search for &lsquo;{0}&rsquo;";
D=AJS.format(G,I)
}else{D="Search"
}var E=Confluence.Editor.LinkBrowser;
var H=[{className:"search-for",name:D,href:"#",callback:function(L){L.replaceWithSelectedSearchText();
var K=E.open({panelKey:E.SEARCH_PANEL});
K.doSearch(K.getLocationPresenter().getRawLinkText())
}},{className:"dropdown-insert-link",html:C.Util.dropdownLink("Insert web link","dropdown-prevent-highlight","editor-icon"),callback:function(K){K.replaceWithSelectedSearchText();
E.open({panelKey:E.WEBLINK_PANEL})
}}];
F&&F(I,H);
return H
},getDataAndRunCallback:function(G,E,F){function D(H,K,J){function I(){var L=H[1];
var M=L[0].restObj;
if(M.type=="page"){return M.space.key==AJS.Meta.get("space-key")&&M.title.toLowerCase()==K.toLowerCase()
}return false
}if(K){if(H.length<2||!I()){J.push({className:"insert-create-page-link",html:C.Util.dropdownLink("Insert link to create page","dropdown-prevent-highlight","editor-icon"),callback:function(N){var M=Confluence.unescapeEntities(K);
var L=Confluence.Link.createLinkToNewPage(M,AJS.Meta.get("space-key"));
N.update(L)
}})
}}}Confluence.Editor.Autocompleter.Util.getRestData(G,A,B,E,F,"content",D)
},update:function(E,D){if(D.restObj){D=Confluence.Link.fromREST(D.restObj)
}D.insert()
}}
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-media.js' */
(function(D){AJS.log("tinyMce-autocomplete-settings-media initialising");
var B=["image","word","excel","pdf","powerpoint","multimedia"],A=function(E){var F=AJS.params.attachmentSourceContentId||AJS.Meta.get("content-id");
if(E){return Confluence.getContextPath()+"/rest/prototype/1/search.json"
}else{if(+F){return Confluence.getContextPath()+"/rest/prototype/1/content/"+F+"/attachments.json"
}}return null
},C=function(F,E){return E?{type:"attachment",attachmentType:B,search:"name","max-results":F.maxResults,query:E}:{attachmentType:B,"max-results":F.maxResults}
};
Confluence.Editor.Autocompleter.Settings["!"]={ch:"!",cache:false,endChars:["!"],dropDownClassName:"autocomplete-media",selectFirstItem:true,getHeaderText:function(F,E){return "Media suggestions"
},getAdditionalLinks:function(F,E){return[{className:"dropdown-insert-image",html:Confluence.Editor.Autocompleter.Util.dropdownLink("Open image browser","dropdown-prevent-highlight","editor-icon"),callback:function(G){G.replaceWithSelectedSearchText();
Confluence.Editor.defaultInsertImageDialog()
}},{className:"dropdown-insert-macro",html:Confluence.Editor.Autocompleter.Util.dropdownLink("Insert other media","dropdown-prevent-highlight","editor-icon"),callback:function(G){G.replaceWithSelectedSearchText();
tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked({selectedCategory:"media"})
}}]
},getDataAndRunCallback:function(G,E,F){Confluence.Editor.Autocompleter.Util.getRestData(G,A,C,E,F,"attachment")
},update:function(H,I){var N=AJS.REST.wikiLink(I.restObj),E=I.restObj&&I.restObj.title||I.name;
if(I.restObj.niceType=="Image"){var L=N.destination&&N.destination.replace(/^\^/,"");
var K=D.extend({filename:E,contentId:I.ownerId||I.restObj.ownerId},N.params);
tinymce.confluence.ImageUtils.insertFromProperties(K)
}else{var G;
switch(I.restObj.niceType){case"PDF Document":G="viewpdf";
break;
case"Word Document":G="viewdoc";
break;
case"Excel Spreadsheet":G="viewxls";
break;
case"PowerPoint Presentation":G="viewppt";
break;
case"Multimedia":G="multimedia";
break
}var M=N.destination.substring(0,N.destination.indexOf("^"));
var J={page:M,name:E};
AJS.MacroBrowser.getMacroJsOverride("viewdoc").beforeParamsRetrieved(J);
if(!J.page){delete J.page
}var F={contentId:AJS.Meta.get("content-id")||"0",macro:{name:G,params:J,defaultParameterValue:"",body:""}};
tinymce.confluence.MacroUtils.insertMacro(F)
}}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-macros.js' */
(function(C){AJS.log("tinyMce-autocomplete-settings-macro initialising");
var B=function(F,E){var D=E.presetMacroMetadata;
F.replaceWithSelectedSearchText();
if(!D){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked(E)
}else{if(AJS.MacroBrowser.hasRequiredParameters(D)){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked(E)
}else{AJS.Rte.BookmarkManager.storeBookmark();
tinymce.confluence.MacroUtils.insertMacro({contentId:AJS.Meta.get("content-id")||"0",macro:{name:D.macroName,body:""}})
}}};
var A=function(D){if(D.hidden&&!AJS.MacroBrowser.isHiddenMacroShown(D)){return null
}var E={className:"autocomplete-macro-"+D.macroName,callback:function(F){B(F,{ignoreEditorSelection:true,presetMacroMetadata:D})
}};
if(D.icon){E.name=D.title;
E.href="#";
E.icon=(D.icon.relative?AJS.params.staticResourceUrlPrefix:"")+D.icon.location
}else{E.html=Confluence.Editor.Autocompleter.Util.dropdownLink(D.title)
}return E
};
Confluence.Editor.Autocompleter.Settings["{"]={ch:"{",cache:false,endChars:["}",":","{"],dropDownClassName:"autocomplete-macros",dropDownDelay:0,selectFirstItem:true,getHeaderText:function(E,D){return "Macro suggestions"
},getAdditionalLinks:function(E,D){return[{className:"dropdown-insert-macro",html:Confluence.Editor.Autocompleter.Util.dropdownLink("Open macro browser","dropdown-prevent-highlight","editor-icon"),callback:function(G){var F=G.text();
B(G,{searchText:F})
}}]
},getDataAndRunCallback:function(H,G,K){var F=[];
if(!G){C("#macro-insert-list li").each(function(){var M=AJS.MacroBrowser.getMacroMetadata(C(this).attr("data-macro-name"));
if(M){var N=A(M);
N&&F.push(N)
}})
}else{var J=AJS.MacroBrowser.searchSummaries(G,{keywordsField:"keywordsNoDesc"}),D;
for(var I=0,L=J.length;
I<L;
I++){var E=A(J[I]);
if(E&&F.push(E)==H.maxResults){break
}}}K([F],G)
},update:function(E,D){throw new Error("All items in the Macro Autocomplete dropdown must have a callback function")
}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/editor_plugin_src.js' */
(function(){AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(A){if(AJS.Meta.get("remote-user")&&AJS.Meta.get("confluence.prefs.editor.disable.autocomplete")){return 
}else{A.plugins+=",autocomplete"
}});
tinymce.create("tinymce.plugins.AutoComplete",{init:function(A){A.addCommand("mceConfAutocompleteLink",function(){Confluence.Editor.Autocompleter.Manager.shortcutFired("[")
});
A.addCommand("mceConfAutocompleteImage",function(){Confluence.Editor.Autocompleter.Manager.shortcutFired("!")
});
A.addShortcut("ctrl+shift+k",A.getLang("AutoComplete"),"mceConfAutocompleteLink");
A.addShortcut("ctrl+shift+m",A.getLang("AutoComplete"),"mceConfAutocompleteImage");
A.onPostRender.add(function(){AJS.$(function(){AJS.log("Autocomplete enabled, adding keyPress listener");
A.onKeyPress.addToTop(Confluence.Editor.Autocompleter.Manager.triggerListener);
AJS.trigger("ready-editor-autocomplete")
})
});
A.onUndo.add(Confluence.Editor.Autocompleter.Manager.reattach);
A.onRedo.add(Confluence.Editor.Autocompleter.Manager.reattach)
},getInfo:function(){return{longname:"Auto Complete",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("autocomplete",tinymce.plugins.AutoComplete)
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/editor_plugin_src.js' */
(function(E){var H="searchreplace";
var B=null;
var J=false;
var L=function(M,N){N.preventDefault();
N.stopPropagation()
};
var I=function(M,O){L(M,O);
var N=O.which;
if(!N){N=O.charCode?O.charCode:O.keyCode
}if(N<48){return 
}B.push(N)
};
var G=function(M){if(M>65535){M-=65536;
return String.fromCharCode(55296+(M>>10),56320+(M&1023))
}else{return String.fromCharCode(M)
}};
var D=function(){var M=AJS.Rte.getEditor();
B=[];
M.onKeyDown.add(I);
M.onKeyPress.add(L);
M.onKeyUp.add(L)
};
var A=function(N){var M=E("#rte-button-searchreplace a");
if(M.length){if(N){M.unbind("click",false)
}else{M.bind("click",false)
}}};
var F=function(){var M=AJS.Rte.getEditor();
M.onKeyDown.remove(I);
M.onKeyPress.remove(L);
M.onKeyUp.remove(L);
var N="";
for(var O=0;
O<B.length;
O++){N+=G(B[O])
}return N.toLowerCase()
};
var K=function(){if(J){return 
}J=true;
var P=E("#rte-button-searchreplace");
var O=!P.hasClass("active");
var M=E("body");
var N=!M.hasClass("no-tools")||M.hasClass("no-tools-toolbars-visible");
if(O){P.addClass("active");
if(!Confluence.Editor.searchManager){Confluence.Editor.searchManager=new Confluence.Editor.SearchManager(H)
}E(document).trigger("createContextToolbarRow.Toolbar",{id:H,buttons:Confluence.Editor.searchToolbar.Buttons,topToolbar:true,editorAdjacent:true,animate:N,onVisible:function(){var Q=F();
Confluence.Editor.searchManager.onVisible(Q);
A(true);
J=false;
Confluence.Editor.searchManager.initialised=true
}}).trigger("enableContextToolbarRow.Toolbar");
D();
Confluence.Editor.searchManager.init();
A(false)
}else{P.removeClass("active");
Confluence.Editor.searchManager.onHide();
E(document).trigger("removeContextToolbarRow.Toolbar",{id:H,animate:N,onHide:function(){E(document).trigger("contextToolbarRowRemoved.Toolbar");
A(true);
J=false;
Confluence.Editor.searchManager.initialised=false
}});
A(false);
if(!tinymce.isGecko){frames.wysiwygTextarea_ifr.focus()
}tinyMCE.activeEditor.focus()
}};
var C=function(N){if(tinyMCE.isIE){var M=N.createTextRange();
M.execCommand("SelectAll");
M.move("textedit");
M.select()
}else{if(tinyMCE.isGecko){var O=E(N).val().length;
N.setSelectionRange(O,O)
}}};
tinymce.create("tinymce.plugins.AtlassianSearchReplacePlugin",{init:function(M,N){M.addCommand("mceSearchReplaceToolbar",function(){K()
});
M.addCommand("mceConfSearch",function(P,O){if(!Confluence.Editor.searchManager){return 
}O=O||{};
if(O.backwards&&!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-find-previous-button")){Confluence.Editor.searchManager.focus();
return 
}if(!O.backwards&&!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-find-next-button")){Confluence.Editor.searchManager.focus();
return 
}Confluence.Editor.searchManager.find(O.backwards,O.onFound,O.onNotFound)
});
M.addCommand("mceConfReplace",function(P,O){if(!Confluence.Editor.searchManager){return 
}O=O||{};
if(!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-replace-button")){O.onInactive&&O.onInactive()
}else{Confluence.Editor.searchManager.replace(O.onFound,O.onNotFound)
}});
M.addCommand("mceConfReplaceAll",function(P,O){if(!Confluence.Editor.searchManager){return 
}O=O||{};
if(!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-replaceall-button")){return 
}Confluence.Editor.searchManager.replaceAll(O.onReplaced,O.onNotReplaced)
});
M.addCommand("mceConfSearchClose",function(P,O){if(!Confluence.Editor.searchManager){return 
}M.execCommand("mceSearchReplaceToolbar",false,null)
});
M.addButton("searchreplace",{title:"searchreplace.search_desc",cmd:"mceSearchReplaceToolbar"});
if(!tinyMCE.isIE8){M.addShortcut("ctrl+f","searchreplace.search_desc",function(){if(Confluence.Editor.searchManager&&Confluence.Editor.searchManager.isVisible()){Confluence.Editor.searchManager.focus()
}else{M.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})
}})
}},getInfo:function(){return{longname:"Search/Replace",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}
}});
tinymce.PluginManager.add("searchreplace",tinymce.plugins.AtlassianSearchReplacePlugin)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/searchreplace.js' */
(function(){if(typeof Confluence=="undefined"){Confluence={}
}if(!Confluence.Editor){Confluence.Editor={}
}var C='<mark class="find-current">';
var B="</mark>";
var A=function(F){if(tinyMCE.isIE){var E=F.createTextRange();
E.execCommand("SelectAll");
E.move("textedit");
E.select()
}else{if(tinyMCE.isGecko){var G=AJS.$(F).val().length;
F.setSelectionRange(G,G)
}}};
function D(F,E){return F.selection?F.selection.createRange():E.getDoc().body.createTextRange()
}Confluence.Editor.SearchManager=function(M){var L=M;
var K=null;
var E=null;
var I=null;
var G=null;
var H=null;
var F=function(){G=null;
H=null
};
var J=function(N,O){O.content=O.content.replace(new RegExp(C,"g"),"");
O.content=O.content.replace(new RegExp(B,"g"),"")
};
this.initialised=false;
this.find=function(N,R,O){var P=K.getFindInput().val();
var Q=I.findText(P,true,N);
if(Q&&R){R()
}else{if(!Q&&O){O()
}}};
this.replace=function(S,O){var N=K.getFindInput();
var P=K.getReplaceInput();
var R="";
if(P){R=P.val()
}var Q=I.replaceText(N.val(),R,true);
if(Q&&S){S()
}else{if(!Q&&O){O()
}}};
this.replaceAll=function(O,P){var N=K.getFindInput();
var R=K.getReplaceInput();
var S="";
if(R){S=R.val()
}var Q=I.replaceAll(N.val(),S);
if(Q&&O){O()
}else{if(!Q&&P){P()
}}};
this.focus=function(){K.focusFindTextBox()
};
this.isVisible=function(){return K!=null
};
this.init=function(){K=new Confluence.Editor.SearchManager.UI(L,G,H);
E=new Confluence.Editor.SearchManager.MarkManager();
E.addListener(K);
I=null;
if(tinyMCE.isIE){I=new Confluence.Editor.SearchManager.implIE(K)
}else{I=new Confluence.Editor.SearchManager.impl(K,E)
}tinyMCE.activeEditor.undoManager.onAdd.add(J)
};
this.onVisible=function(P){if(P!=null&&P.length>0){var N=K.getFindInput();
var O=N.val();
N.val(O+P)
}K.onVisible()
};
this.onHide=function(){G=K.getFindInput().val();
H=K.getReplaceInput().val();
I.destroy();
I=null;
K.destroy();
K=null;
E.destroy();
E=null;
tinyMCE.activeEditor.undoManager.onAdd.remove(J)
};
this._clearSavedValues=F
};
Confluence.Editor.SearchManager.impl=function(J,I){var F=new tinymce.html.Writer();
var G=I;
var L=J;
var N=function(V,S,P){if(!V){return false
}var Q=tinyMCE.activeEditor,T=Q.selection,O=Q.getWin();
if(G.isCursorAtCurrentMark()){T=G.selectCurrentMark()
}if(!T.isCollapsed()){T.collapse(P)
}function U(){G.markCurrentlySelectedRange();
return true
}function R(){G.removeCurrentMark(true);
if(!tinyMCE.activeEditor.selection.isCollapsed()){tinyMCE.activeEditor.selection.collapse()
}return false
}if(tinymce.isGecko){if(O.find(V,false,P)){return U()
}else{if(S){T.select(Q.getBody(),false);
T.collapse(!P);
return N(V,false,P)
}else{return R()
}}}else{if(O.find(V,false,P,true,false,false,false)){return U()
}else{return R()
}}};
var H=function(O,R,P){if(!G.hasCurrentMark()){return N(O,P)
}var Q=G.replaceCurrentMark(R);
if(Q){tinyMCE.activeEditor.selection.select(Q)
}return N(O,P)
};
var E=function(O){var P=tinyMCE.activeEditor;
F.text(O);
P.selection.setContent(F.getContent(),{format:"raw"});
F.reset();
P.selection.collapse(true)
};
var K=function(S,V){var R=tinyMCE.activeEditor,T=R.selection,Q=R.getWin(),P=R.undoManager;
G.removeCurrentMark(false);
R.execCommand("selectAll");
R.selection.collapse(true);
var O=0;
while(Q.find(S,false,false,false,false,false,false)){E(V);
O++
}R.undoManager.add();
if(O==0){AJS.Confluence.EditorNotification.notify("info",R.getLang("searchreplace_dlg.notfound"))
}else{if(O==1){AJS.Confluence.EditorNotification.notify("success",R.getLang("searchreplace_dlg.allreplacedsingular"))
}else{if(O>1){var U=R.getLang("searchreplace_dlg.allreplacedplural");
AJS.Confluence.EditorNotification.notify("success",U.replace("{0}",O))
}}}return O
};
var M=function(){L=null;
G=null;
F=null
};
this.findText=N;
this.replaceText=H;
this.replaceAll=K;
this.destroy=M
};
Confluence.Editor.SearchManager.implIE=function(L){var N=L;
var R=null;
var F=new tinymce.html.Writer();
var Q=function(a,U,Z){if(!a){return false
}var W=tinyMCE.activeEditor,Y=W.getDoc();
W.focus();
if(R){R.select()
}W.selection.collapse(!Z);
var b=D(Y,W);
J();
if(Z&&R){var T=W.getBody().createTextRange();
T.moveToElementText(AJS.$("p:first",W.getBody())[0]);
b.setEndPoint("StartToStart",T);
var X=R.text;
if(X.length){X=X.replace(/s+$/,"");
if(X.length){b.moveEnd("character",-X.length)
}}var V=b.text.length;
b.moveEnd("word",-1);
if(b.text.length>=V){b.moveEnd("character",-1)
}b.select();
b.collapse(false)
}R=null;
if(b.findText(a,Z?-1:1,0)){b.scrollIntoView();
b=I(b);
b.select();
R=b;
return true
}else{if(U){W.selection.select(tinyMCE.activeEditor.getBody(),true);
W.selection.collapse(!Z);
return Q(a,false,Z)
}}};
var K=function(U,T,V){J()
};
var H=function(){var T=tinyMCE.activeEditor;
T.onChange.add(K);
T.onBeforeSetContent.add(K)
};
var E=function(){var T=tinyMCE.activeEditor;
T.onChange.remove(K);
T.onBeforeSetContent.remove(K)
};
var I=function(T){var U=T.htmlText;
T.pasteHTML(C+U+B);
N.marked();
H();
return T
};
var J=function(){E();
var V=tinyMCE.activeEditor;
var U=AJS.$("mark",V.getDoc());
if(U.length){var W=false;
var T=V.selection.getRng(true).commonAncestorContainer;
var X=AJS.$(T).closest("mark");
if(X.length){W=true
}U.each(function(Y,Z){$markElement=AJS.$(Z);
$markElement.contents().each(function(a,b){$markElement.before(b)
})
}).remove();
if(W){V.execCommand("RemoveFormat")
}}N.markRemoved()
};
var G=function(U,Z,V){var T=tinyMCE.activeEditor;
if(R){var X=T.getDoc().createTextNode(Z);
var W=AJS.$("mark",T.getDoc());
W.parent()[0].replaceChild(X,W[0]);
T.undoManager.add();
var Y=T.getDoc().createElement("mark");
Y.setAttribute("class","current");
X.parentNode.insertBefore(Y,X);
Y.appendChild(T.getDoc().createTextNode(Z));
Y.parentNode.removeChild(X)
}return Q(U,V)
};
var M=function(V,Y){var W=tinyMCE.activeEditor,X=W.selection,b=W.getWin(),Z=W.undoManager,a=W.getDoc();
J();
X.select(W.getBody(),false);
X.collapse(true);
W.focus();
var T=D(a,W);
var c=0;
while(T.findText(V,1,0)){T.scrollIntoView();
T.select();
F.text(Y);
W.selection.setContent(F.getContent(),{format:"raw"});
F.reset();
c++;
T=D(a,W)
}Z.add();
if(c==0){AJS.Confluence.EditorNotification.notify("info",W.getLang("searchreplace_dlg.notfound"))
}else{if(c==1){AJS.Confluence.EditorNotification.notify("success",W.getLang("searchreplace_dlg.allreplacedsingular"))
}else{if(c>1){var U=W.getLang("searchreplace_dlg.allreplacedplural");
AJS.Confluence.EditorNotification.notify("success",U.replace("{0}",c))
}}}return c
};
var P=function(T,U){J()
};
var S=function(){tinyMCE.activeEditor.onBeforeGetContent.add(P)
};
var O=function(){tinyMCE.activeEditor.onBeforeGetContent.remove(P);
J();
N=null;
R=null;
F=null
};
this.findText=Q;
this.replaceText=G;
this.replaceAll=M;
this.destroy=O;
S()
};
Confluence.Editor.SearchManager.UI=function(I,T,J){var O=null;
if(tinyMCE.activeEditor&&tinyMCE.activeEditor.plugins&&tinyMCE.activeEditor.plugins.customtoolbar){O=tinyMCE.activeEditor.plugins.customtoolbar.getToolbarRow(I)
}var L=function(){var Y=AJS.$(".toolbar-find-input",O);
if(!Y.length){return null
}return Y
};
var W=function(){top.focus();
L().focus()
};
var H=function(){var Y=AJS.$(".toolbar-replace-input",O);
if(!Y.length){return null
}return Y
};
var U=function(a){if(a.type=="input"||a.type=="propertychange"){var Y=L();
var Z=(Y!=null)&&(Y.val().length>0);
S(Z);
M(Z)
}};
var G=function(Z){var Y=L();
K(Y&&Y.val())
};
var P=function(){function Y(c,b){if(!c){return 
}if(tinymce.isIE9){c[0].attachEvent("onpropertychange",b)
}else{var a=tinymce.isIE8?"propertychange":"input";
c.bind(a,b)
}}var Z=L();
Y(Z,U);
Y(Z,G);
AJS.$(O).focusin(function(a){M(true)
}).focusout(function(a){M(false)
});
Z.focus(function(a){M(true)
})
};
var S=function(Y){if(Y){tinyMCE.activeEditor.plugins.customtoolbar.enableToolbarButton("search-toolbar-find-next-button");
tinyMCE.activeEditor.plugins.customtoolbar.enableToolbarButton("search-toolbar-find-previous-button")
}else{tinyMCE.activeEditor.plugins.customtoolbar.disableToolbarButton("search-toolbar-find-next-button");
tinyMCE.activeEditor.plugins.customtoolbar.disableToolbarButton("search-toolbar-find-previous-button")
}};
var M=function(Z){var Y=L();
X().toggleClass("default-action",Z&&Y.val().length>0)
};
var X=function(){var Y=AJS.$(".search-toolbar-find-next-button",O).closest(".aui-button");
if(!Y.length){return null
}return Y
};
var Q=function(){F(false)
};
var N=function(){F(true)
};
var F=function(Z){var a=tinyMCE.activeEditor.plugins.customtoolbar;
var Y="search-toolbar-replace-button";
if(Z){a.enableToolbarButton(Y)
}else{a.disableToolbarButton(Y)
}};
var K=function(Z){var a=tinyMCE.activeEditor.plugins.customtoolbar;
var Y="search-toolbar-replaceall-button";
if(Z){a.enableToolbarButton(Y)
}else{a.disableToolbarButton(Y)
}};
var R=function(c,Y){var Z=L();
var a=false;
if(c&&c.length){Z.val(c);
a=true
}if(Y&&Y.length){var b=H();
b.val(Y)
}P();
S(a);
K(a);
F(false)
};
var E=function(){var Y=L();
Y.focus();
if(Y.val().length>0){A(Y[0]);
S(true);
K(true)
}};
var V=function(){};
this.getFindInput=L;
this.getReplaceInput=H;
this.focusFindTextBox=W;
this.onVisible=E;
this.destroy=V;
this.marked=N;
this.markRemoved=Q;
R(T,J);
return this
};
Confluence.Editor.SearchManager.MarkManager=function(){var W=null;
var I=new tinymce.html.Writer();
var M=null;
var O=[];
var H=function(a,Z,b){G()
};
var J=function(Z){O.push(Z)
};
var U=function(){if(!W){return null
}var Z=tinyMCE.activeEditor;
Z.selection.select(W[0]);
return Z.selection
};
var S=function(){var a=tinyMCE.activeEditor;
if(W){var b=a.selection.getBookmark();
Q(false);
a.selection.moveToBookmark(b)
}M=null;
var Z=a.selection.getRng(true);
W=AJS.$(C+B,a.getDoc());
try{Z.surroundContents(W[0]);
L(false)
}catch(c){if(c.code==1){M=Z.toString();
W=null;
L(true)
}}AJS.$.each(O,function(d,e){e.marked()
});
if(!M){U().collapse()
}};
var E=function(){if(!W){return false
}var b=tinyMCE.activeEditor;
var c=b.selection;
if(!c.isCollapsed()){c.collapse()
}var a=c.getRng(true);
if(a.startContainer.nodeType==3){a.startContainer.parentNode.normalize();
return a.startContainer.nextSibling===W[0]||a.startContainer.previousSibling===W[0]
}else{if(a.startContainer.nodeType==1){var d=a.startContainer.childNodes;
var Z=a.startOffset;
if(Z>0&&d[Z-1]===W[0]){return true
}if((Z+1)<d.length&&d[Z+1===W[0]]){return true
}return false
}}};
var Q=function(Z){F();
if(K(W,Z)||(M&&tinyMCE.activeEditor.selection.getRng(true).toString()==M)){W=null;
M=null;
AJS.$.each(O,function(a,b){b.markRemoved()
})
}};
var G=function(){F();
AJS.$("mark",tinyMCE.activeEditor.getDoc()).each(function(Z,a){var b=K(AJS.$(a),false)
});
W=null;
M=null;
AJS.$.each(O,function(Z,a){a.markRemoved()
})
};
var K=function(g,Z){var b=tinyMCE.activeEditor.selection.getRng(true);
if(!g){return false
}function f(h,j){if(h.intersectsNode){return h.intersectsNode(j)
}else{var i=tinyMCE.activeEditor.getDoc().createRange();
i.selectNodeContents(j);
if(h.compareBoundaryPoints(Range.START_TO_END,i)<=0||h.compareBoundaryPoints(Range.END_TO_START,i)>=0){return false
}else{return true
}}}var e=f(b,g[0]);
var d=null;
var a=null;
g.contents().each(function(h,i){g.before(i);
if(!d){d=i
}a=i
});
if(e||Z){var c=tinyMCE.activeEditor.selection.getRng(true);
c.setStartBefore(d);
c.setEndAfter(a);
if(!Z){c.collapse(false)
}tinyMCE.activeEditor.selection.setRng(c)
}g.remove();
return true
};
var R=function(){if(W){return true
}if(M){return tinyMCE.activeEditor.selection.getRng(true).toString()==M
}};
var P=function(a){if(W||!R()){return false
}var Z=tinyMCE.activeEditor;
I.text(a);
Z.selection.setContent(I.getContent(),{format:"raw"});
I.reset();
Z.undoManager.add();
Q(false);
return true
};
var Y=function(d){if(P(d)){return null
}if(!W){return null
}var Z=[];
W.contents().each(function(e,f){Z.push(f)
});
Q(false);
var a=tinyMCE.activeEditor;
var c=AJS.$(Z[0]).before(a.getDoc().createTextNode(d))[0].previousSibling;
for(var b=Z.length-1;
b>=0;
b--){AJS.$(Z[b]).remove()
}a.undoManager.add();
return c
};
var X=function(Z,a){G()
};
var N=function(Z,a){F();
AJS.$.each(O,function(b,c){c.markRemoved()
})
};
var L=function(a){var Z=tinyMCE.activeEditor;
Z.onChange.add(H);
Z.onBeforeSetContent.add(H);
if(a){Z.onClick.add(N);
Z.onDblClick.add(N)
}};
var F=function(){var Z=tinyMCE.activeEditor;
Z.onChange.remove(H);
Z.onBeforeSetContent.remove(H);
Z.onClick.remove(N);
Z.onDblClick.remove(N)
};
var T=function(){tinyMCE.activeEditor.onBeforeGetContent.add(X)
};
var V=function(){Q(true);
tinyMCE.activeEditor.onBeforeGetContent.remove(X)
};
this.markCurrentlySelectedRange=S;
this.removeCurrentMark=Q;
this.removeAllMarks=G;
this.selectCurrentMark=U;
this.isCursorAtCurrentMark=E;
this.hasCurrentMark=R;
this.replaceCurrentMark=Y;
this.addListener=J;
this.destroy=V;
T()
}
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/tinyMce-search-toolbar.js' */
AJS.$(document).bind("initContextToolbars.Toolbar",function(J,I){var B=function(S){if(tinyMCE.isIE){var R=S.createTextRange();
R.execCommand("SelectAll");
R.move("textedit");
R.select()
}else{if(tinyMCE.isGecko){var T=AJS.$(S).val().length;
S.setSelectionRange(T,T)
}}};
var C=function(R){top.focus();
tinyMCE.activeEditor.plugins.customtoolbar.focusToolbarButton(R)
};
var G=function(){top.focus();
var R=AJS.$("#search-toolbar-find-text");
R.focus();
B(R[0])
};
var D=function(){top.focus();
var R=AJS.$("#search-toolbar-replace-text");
R.focus();
B(R[0])
};
var F=function(){if(tinyMCE.isIE){frames.wysiwygTextarea_ifr.focus()
}if(tinyMCE.isIE||tinyMCE.isGecko){var R=tinyMCE.activeEditor;
R.focus();
R.selection.select(R.getBody());
R.selection.collapse(false);
R.focus()
}};
var Q=function(S){if(!tinyMCE.isIE8&&(S.ctrlKey||(tinymce.isMac&&S.metaKey))&&S.which=="70"){S.preventDefault()
}else{if(S.which=="13"){S.preventDefault();
var R={backwards:false,onFound:G,onNotFound:G};
tinyMCE.activeEditor.execCommand("mceConfSearch",false,R,{skip_undo:true})
}else{if(S.which=="27"){S.preventDefault();
tinyMCE.activeEditor.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})
}}}};
var N=function(S){if(!tinyMCE.isIE8&&(S.ctrlKey||(tinymce.isMac&&S.metaKey))&&S.which=="70"){S.preventDefault()
}else{if(S.which=="13"){S.preventDefault();
var R={onFound:D,onNotFound:G,onInactive:function(){tinyMCE.activeEditor.execCommand("mceConfSearch",false,{backwards:false,onFound:D,onNotFound:G},{skip_undo:true})
}};
tinyMCE.activeEditor.execCommand("mceConfReplace",false,R,{skip_undo:true})
}else{if(S.which=="27"){S.preventDefault();
tinyMCE.activeEditor.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})
}}}};
var E=new Confluence.Editor.Toolbar.Components.TextBox({id:"search-toolbar-find-text",text:I.getLang("searchreplace_dlg.findlabel"),name:"find",keydown:Q,cssClass:"toolbar-find-input"});
var M=new Confluence.Editor.Toolbar.Components.TextBox({id:"search-toolbar-replace-text",text:I.getLang("searchreplace_dlg.replacelabel"),name:"replace",keydown:N,cssClass:"toolbar-replace-input"});
var O=new Confluence.Editor.Toolbar.Components.TextButton({text:I.getLang("searchreplace_dlg.findprevious"),click:function(){var R={backwards:true,onFound:function(){top.focus();
C("search-toolbar-find-previous-button")
},onNotFound:G};
I.execCommand("mceConfSearch",false,R,{skip_undo:true})
},textClass:"search-toolbar-find-previous-button"});
var P=new Confluence.Editor.Toolbar.Components.TextButton({text:tinyMCE.isIE?I.getLang("searchreplace_dlg.findlabel"):I.getLang("searchreplace_dlg.findnext"),click:function(){var R={backwards:false,onFound:function(){top.focus();
C("search-toolbar-find-next-button")
},onNotFound:G};
I.execCommand("mceConfSearch",false,R,{skip_undo:true})
},textClass:"search-toolbar-find-next-button"});
var H=new Confluence.Editor.Toolbar.Components.TextButton({text:I.getLang("searchreplace_dlg.replace"),click:function(){I.execCommand("mceConfReplace",false,{onFound:function(){top.focus();
C("search-toolbar-replace-button")
},onNotFound:G},{skip_undo:true})
},textClass:"search-toolbar-replace-button"});
var L=new Confluence.Editor.Toolbar.Components.TextButton({text:I.getLang("searchreplace_dlg.replaceall"),click:function(){var R={onReplaced:F,onNotReplaced:G};
I.execCommand("mceConfReplaceAll",false,R)
},textClass:"search-toolbar-replaceall-button"});
var A=new Confluence.Editor.Toolbar.Components.Button({text:I.getLang("searchreplace_dlg.close"),iconClass:"icon-close",click:function(){I.execCommand("mceConfSearchClose",false,null)
}});
var K=null;
if(tinyMCE.isIE){K=[new Confluence.Editor.Toolbar.Components.Group([A],{groupClass:"close"}),new Confluence.Editor.Toolbar.Components.Group([E,M]),new Confluence.Editor.Toolbar.Components.Group([P]),new Confluence.Editor.Toolbar.Components.Group([H,L])]
}else{K=[new Confluence.Editor.Toolbar.Components.Group([A],{groupClass:"close"}),new Confluence.Editor.Toolbar.Components.Group([E,M]),new Confluence.Editor.Toolbar.Components.Group([O,P]),new Confluence.Editor.Toolbar.Components.Group([H,L])]
}Confluence.Editor.searchToolbar={Buttons:K}
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'js/help-tip.js' */
(function ($) {
    function nope() {
        return false;
    }

    function yep() {
        return true;
    }

    var cidCounter = 0, seed = new Date().getTime();
    var restUrl = AJS.contextPath() + "/rest/helptips/1.0/tips";

    // to un-fuck graphite event names
    function cleanAnalyticsName(name) {
        name = "" + (name || "");
        return name.replace(/\./g, "-");
    }

    function analytics(eventId, model) {
        if (AJS.EventQueue && model && model.attributes.id) {
            var event = {};
            var cleanId = cleanAnalyticsName(model.attributes.id);
            event.name = "helptips." + cleanId + "." + eventId;
            event.properties = {};
            AJS.EventQueue.push(event);
        }
    }

    function getCid() {
        return "c" + seed + (cidCounter++);
    }

    var Manager = {
        dismissedTipIds: [],
        loaded: $.Deferred(),
        url: function () {
            return restUrl;
        },
        sync: function (verb, data) {
            verb || (verb = "get");
            data || (data = null);
            return $.ajax(this.url(), {
                type: verb,
                context: this,
                dataType: "json",
                contentType: "application/json",
                data: data && JSON.stringify(data),
                processData: false
            }).promise();
        },
        fetch: function () {
            var result = this.sync();
            result.done(function (response) {
                $.merge(this.dismissedTipIds, response);
                this.loaded.resolve();
            });
            return result.promise();
        },
        show: function (showFunction) {
            this.loaded.done(showFunction);
        },
        dismiss: function (tip) {
            var id = tip.attributes.id;
            if (!id) {
                tip._dismissed = true;
            } else {
                this.dismissedTipIds.push(id);
                this.sync("post", {id: id});
            }
        },
        undismiss: function (tip) {
            var id = tip.attributes.id;
            if (!id) {
                tip._dismissed = false;
            } else {
                this.dismissedTipIds.splice($.inArray(id, this.dismissedTipIds), 1);
                this.sync("delete", {id: id});
            }
        },
        isDismissed: function (tip) {
            var id = tip.attributes.id;
            return (id) ? $.inArray(id, this.dismissedTipIds) >= 0 : tip._dismissed;
        }
    };

    var HelpTip = AJS.HelpTip = function (attributes) {
        var anchor;
        this.attributes = $.extend({}, attributes);
        this.attributes.id || (this.attributes.id = false);
        // Map renamed attribute body to bodyHtml
        if (this.attributes.body) {
            this.attributes.bodyHtml = this.attributes.body;
            delete this.attributes.body;
        }
        this.cid = getCid();

        anchor = this.attributes.anchor;

        delete this.attributes.anchor;

        this.view = anchor ? new AnchoredView(this, anchor) : new UnanchoredView(this);
        this.view.$el.addClass('aui-help-tip');
    };

    AJS.HelpTip.Manager = Manager;

    $.extend(HelpTip.prototype, {
        show: function () {
            var self = this;
            AJS.HelpTip.Manager.show(function () {
                if (!self.isDismissed()) {
                    if (AJS.Popups && AJS.Popups.DisplayController) {
                        AJS.Popups.DisplayController.request({
                            name:self.id,
                            weight:1000,
                            show:function () {
                                self.view.show();
                            }})
                    }
                    else {
                        self.view.show();
                    }
                    analytics("shown", self);
                }
            });
        },
        dismiss: function () {
            var reason = cleanAnalyticsName(arguments[0] || "programmatically");
            this.view.dismiss();
            if (!this.isDismissed()) {
                AJS.HelpTip.Manager.dismiss(this);
                analytics("dismissed." + reason, this);
            }
        },
        isVisible: function () {
            return this.view.$el.is(":visible");
        },
        isDismissed: function () {
            return AJS.HelpTip.Manager.isDismissed(this);
        }
    });

    var AnchoredView = function (model, anchor) {
        this.initialize(model, anchor);
    };

    $.extend(AnchoredView.prototype, {
        initialize: function (model, anchor) {
            var self = this;
            var elementDocument = anchor.prop("ownerDocument");
            var inFrames = elementDocument != window.document;

            if (inFrames) {
                // Find out which iframe owns this element.
                var $iframeOwner = $("iframe").filter(function() {
                    return this.contentDocument == elementDocument;
                });

                // Move tip as the iframe scrolls.
                $iframeOwner.contents().scroll(function() {
                    var scrollTop = $(this).contents().find("body").scrollTop();
                    var iframeTop = $iframeOwner.offset().top;
                    var originalOffsetTop = self.popup.data("offset-top");
                    var arrowHeight = self.popup.find(".arrow").height();

                    self.popup.css("top", originalOffsetTop - scrollTop);
                    self.popup.toggle(scrollTop <= originalOffsetTop - iframeTop - arrowHeight
                                     && scrollTop + $iframeOwner.height() - arrowHeight + iframeTop - self.popup.height() >= originalOffsetTop);

                });
            }

            this.model = model;
            this.beforeHide = nope;
            this.dismissButton = $(AJS.Templates.HelpTip.tipDismiss());
            this.dismissButton.click(function (e) {
                model.dismiss("close-button");
                e.preventDefault();
            });
            this.popup = AJS.InlineDialog(anchor, model.cid, function (content, trigger, show) {
                content.html(AJS.Templates.HelpTip.tipContent(model.attributes));
                content.find(".helptip-body").after(self.dismissButton);
                content.unbind('mouseover mouseout');
                content.find(".helptip-link").click(function () {
                    analytics("learn-more.clicked", model);
                });
                show();
            }, {
                container: "body",
                noBind: true,
                preHideCallback: function () {
                    return self.beforeHide()
                },
                calculatePositions: function (popup, targetPosition, mousePosition, opts) {
                    var cssData = AJS.InlineDialog.opts.calculatePositions(popup, targetPosition, mousePosition, opts);

                    if (inFrames) {
                        var arrowHeight = popup.find(".arrow").height();
                        var scrollOffset = $iframeOwner.contents().find("body").scrollTop();
                        cssData.popupCss.top = $iframeOwner.offset().top + (anchor.offset().top - scrollOffset) + anchor.height() + arrowHeight;
                        cssData.popupCss.left = anchor.offset().left;
                        $iframeOwner.contents().scroll();
                    }

                    popup.data("offset-top", cssData.popupCss.top)
                    return cssData;
                }

            });

            this.popup.refresh();

            this._popupHide = this.popup.hide;
            this.popup.hide = nope;
            this.$el = $(this.popup[0]);
            AJS.$(document).bind("showLayer", function (e, type, layer) {
                    if (type === "inlineDialog" && layer.id === model.cid) {
                        AJS.InlineDialog.current = null; // Tips shouldn't be considered InlineDialogs.
                        AJS.$(document.body).unbind("click." + model.cid + ".inline-dialog-check");
                        layer._validateClickToClose = nope;
                        layer.hide = nope;
                    }
            });
        },

        show: function () {
            var popup = this.popup,

                hidePopup = function (e) {
                    if (!popup.has(e.target).length) {
                        popup.shadow.remove(); //Needed for IE
                        popup.remove();
                    }
                };

            popup.show();

        },
        dismiss: function () {
            this.beforeHide = yep;
            this._popupHide();
        }
    });

    var UnanchoredView = function (model) {
        this.initialize(model);
    };

    $.extend(UnanchoredView.prototype, {
        initialize: function () {
            this.$el = $("<div />");
        },
        show: $.noop,
        dismiss: $.noop
    });

    // Load up the user's dismissed tips.
    Manager.fetch();
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'templates/help-tip.soy' */
// This file was automatically generated from help-tip.soy.
// Please don't edit this file by hand.

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Templates == 'undefined') { AJS.Templates = {}; }
if (typeof AJS.Templates.HelpTip == 'undefined') { AJS.Templates.HelpTip = {}; }


AJS.Templates.HelpTip.tipContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.title) ? '<h4 class="helptip-title">' + soy.$$escapeHtml(opt_data.title) + '</h4>' : '', '<div class="helptip-body">', opt_data.bodyHtml, '</div>', (opt_data.url) ? '<a class="helptip-link" href="' + soy.$$escapeHtml(opt_data.url) + '" target="_blank">' + soy.$$escapeHtml("Learn more") + '</a>' : '');
  return opt_sb ? '' : output.toString();
};


AJS.Templates.HelpTip.tipDismiss = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button class="helptip-dismiss aui-button" type="button">', soy.$$escapeHtml("Dismiss"), '</button>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.confluence-editor-hide-tools:confluence-editor-hide-tools-resources', location = '/js/confluence-editor-hide-tools.js' */
(function(g){if(tinymce.isIE){return}AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(y){y.plugins+=",dfe"});var s=function(y){return{"-moz-transform":y,"-webkit-transform":y,transform:y}};var p=function(z){var y=z.css("transform")||z.css("-webkit-transform")||z.css("-moz-transform");if(y=="none"){return 0}return parseInt((y.match(/^matrix\(.*?(-?[\d.]+)\)$/)||[])[1])||0};var u=function(y){return"translateY("+y+"px)"};var l=function(){return"transitionend webkitTransitionEnd MSTransitionEnd"};var n=function(){if(window.fullScreen){return window.fullScreen}return(window.innerWidth==screen.width&&window.innerHeight==screen.height)};var w=false;var t=true;var r="dfe.";var h=0;var m=0;var b=null;var x=null;var f=0;var a=null;var j=+new Date;var q=function(y,z){z=z||{};z.uid=j;AJS.trigger("analyticsEvent",{name:r+y,data:z})};var i=null;var e=false;var o=0;var k=null;var d=null;var c=null;g(function(){k="confluence."+AJS.params.remoteUser+".dfe.";d=k+"totalEdits";c=k+"hasUsed";if(window.localStorage){o=window.localStorage.getItem(d)||0;e=!!window.localStorage.getItem(c)}});var v=function(){f+=(+new Date-x)};g(window).on("beforeunload",function(){if(!w){return}q("hoveredOverToolbarsCount",{header:h,footer:m});var y=(+new Date-b-f);q("editorInteractionTimeSeconds",{normal:Math.round(y/1000),dfe:Math.round(f/1000)})});tinymce.create("tinymce.plugins.DFEPlugin",{active:false,transitioning:false,hangOnScreenHeightHeader:t?0:8,hangOnScreenHeightFooter:8,hideToolsButton:null,editorToolbar:null,savebarContainer:null,wysiwyg:null,iframe:null,activatedDropdownContext:false,originalEditorToolbarHeight:0,originalEditorToolbarTranslateY:0,editorToolbarCurrentHeight:0,editorToolbarCurrentTranslateY:0,init:function(y){y.onInit.add(_.bind(function(H){var J=g("body");var X=!!g(H.formElement).closest("#comments-section").length;var E=this.editorToolbar=g("#toolbar");var R=this.savebarContainer=g("#savebar-container");var W=this.hangOnScreenHeightHeader;var P=this.hangOnScreenHeightFooter;var L=[E,R];this.wysiwyg=g("#wysiwyg");this.iframe=this.wysiwyg.find("iframe");this.messages=g("#editor-messages, #all-messages");if(X){return}b=+new Date;g(function(){o++;window.localStorage&&window.localStorage.setItem(d,o)});w=true;g(window).scroll(function(Y){Y.preventDefault()});J.toggleClass("no-tools-pin-toolbar",t);var T=g("<ul />",{"class":"aui-buttons"});var U=g("<li />",{"class":"toolbar-item aui-button",id:"rte-button-toolbartoggle","data-tooltip":"Hide tools (Ctrl+Shift+F)"});var V=g("<a />",{href:"#"});var S=g("<span />",{"class":"icon icon-toolbartoggle",text:"Hide tools (Ctrl+Shift+F)"});S.prependTo(V);V.appendTo(U);U.appendTo(T);T.prependTo("#rte-toolbar .aui-toolbar2-secondary");this.hideToolsButton=T;J.toggleClass("no-transition",!this.useTransition());setTimeout(function(Y){Y.contents().find("body").addClass("no-tools-capable")},500,this.iframe);this.hideToolsButton.click(_.bind(this.toggle,this));this.bindKeyboardShortcuts();var M=_.bind(function(aa){if(i){setTimeout(function(){i.view.popup.refresh();i.view.$el.find(".arrow svg").slice(1).remove()},100)}if(!this.active){return}var Z=u(this.editorToolbarCurrentTranslateY-(E.height()-this.editorToolbarCurrentHeight));var Y=u(R.height()-P);N({header:Z,footer:Y})},this);AJS.bind("messageClose",M);var B=[];var A=function(Y){return/\((?:max|min)-(?:width|height):\s*/.test(Y)};window.matchMedia&&_.each(document.styleSheets,function(Y){try{if(Y.media&&A(Y.media.mediaText)){B.push(Y.media.mediaText)}_.each(Y.cssRules,function(aa){if(aa instanceof CSSMediaRule){if(A(aa.media.mediaText)){B.push(aa.media.mediaText)}}})}catch(Z){}});_.each(B,function(Z){var Y=window.matchMedia(Z);Y.addListener(M)});var O=_.bind(this.showHelpTips,this);g(setTimeout(O,3000));g(window).resize(_.debounce(O,100));function I(){J.toggleClass("no-tools-probably-full-screen",n())}g(window).resize(_.debounce(I,100));I();g(document).on("hideLayer",function(Z,Y,aa){if(Y!="inlineDialog"){return}setTimeout(function(){a=null},5000)});g("#rte-button-preview").click(this.hideHelpTips);if(!this.useTransition()){return}var Q=g("<div class='editor-toolbar-transition-cover' />");!t&&Q.clone().addClass("header").appendTo("body");Q.addClass("footer").appendTo("body");var F;var N=_.bind(function(Y){var Z="no-tools-dont-animate";if(t&&this.active){setTimeout(_.bind(function(){var aa=this.originalEditorToolbarTranslateY+this.editorToolbar.height()-this.originalEditorToolbarHeight;this.wysiwyg.css(s(u(aa)));this.adjustIframeHeight()},this),0);return}J.addClass(Z);E.css(s(Y.header));R.css(s(Y.footer));clearTimeout(F);F=setTimeout(function(){J.removeClass(Z)},1000)},this);var D=null;g(window).resize(_.bind(function(){if(!this.active){return}var Y=g(window).width();if(Y!=D&&D<1024){M()}D=Y},this));this.originalEditorToolbarTranslateY=p(E);this.savebarContainerOriginalTranslateY=p(R);var K=false;var G=false;g(document).on("mouseenter",".tipsy",function(){K=true}).on("mouseleave",".tipsy",function(){setTimeout(function(){if(K){g.each(L,function(){g(this).trigger("mouseleave")})}K=false},50)});g.each(L,_.bind(function(Z,aa){var ac=aa[0]==R[0];if(t&&!ac){return}var ab=null;var ad="no-tools-toolbars-visible";var Y=null;var ae=aa.find(".extended-hit-zone");if(!ae.length){ae=g("<div class='extended-hit-zone' />").appendTo(aa)}aa.on("mouseenter",_.bind(function(){if(!this.active||this.transitioning){return}if(ac){var ag=this.iframe;var af=ag.contents().find("body").prop("scrollWidth")>ag.width();ae.toggle(!af);m++}else{h++}K=false;G=true;J.addClass(ad);var ai=ac?this.savebarContainerOriginalTranslateY:this.originalEditorToolbarTranslateY-W+E.height()-(E.height()-this.originalEditorToolbarHeight);var ah=u(ai);aa.css(s(ah))},this));aa.on("mouseleave",_.bind(function(){clearTimeout(Y);if(!this.active||this.transitioning){return}G=false;this.hideStragglers();var ag=ac?this.savebarContainerOriginalTranslateY+R.height()-P:this.originalEditorToolbarTranslateY-(E.height()-this.originalEditorToolbarHeight);var af=u(ag);Y=setTimeout(function(){if(K){return}aa.css(s(af));J.removeClass(ad)},50)},this))},this));g(document).on("createContextToolbarRow.Toolbar resize.resizeplugin rte.heartbeat",_.bind(function(aa,Y){if(!this.active){M();return}if(G){return}if(Y&&Y.id=="searchreplace"){this.deactivate();return}this.updateToolbarsDimensions();var Z=u(this.editorToolbarCurrentTranslateY);N({header:Z,footer:null})},this));var z=AJS.Meta.get("page-id")!="0";if(z){var C=_.bind(this.setActiveStateFromLastSession,this);g(function(){setTimeout(C,500)})}},this))},useTransition:(function(){var y=null;return function(){if(y===null){var z=["","webkit","moz"];if(g.browser.msie){return false}var A=function(B){return(B?"-"+B+"-":"")};y=!!g.grep(z,function(B){return document.body.style[A(B)+"transition"]!==undefined}).length}return y}})(),toggle:function(){this.active=!this.active;this[this.active?"activate":"deactivate"].call(this)},deactivate:function(){this.active=false;this.update();q("deactivate")},activate:function(){this.active=true;this.update();var y={viewportSize:window.innerWidth+"x"+window.innerHeight,helpTipDiscovered:a};q("activate",y);window.localStorage.setItem(c,true);this.hideHelpTips()},update:function(){var D=function(Y,X){X===undefined&&(X="auto");return E?Y:X};var H=g("body");var E=this.active;var W=E?"Show tools (Esc)":"Hide tools (Ctrl+Shift+F)";g("#rte-button-toolbartoggle").toggleClass("active",E).attr({title:W,"data-tooltip":W,"original-title":W});if(E){x=+new Date}else{v()}this.hideStragglers();H.scrollTop(0);if(!this.useTransition()){H.toggleClass("no-tools",E);g.browser.msie&&g(window).resize();return}this.transitioning=true;var A=this.wysiwyg;var M=g("#editor-precursor");var P=g("#header");var G=g("#header-precursor");var U=this.messages;var B=this.editorToolbar;var T=this.savebarContainer;var F=T.height();var O=P.height();var I=G.height();var z=g("form.editor");var J=M.height()+O+B.height()+I;var V=this.hangOnScreenHeightHeader;var R=this.hangOnScreenHeightFooter;this.originalEditorToolbarHeight=B.height();E&&H.css("overflow-y","hidden");this.adjustIframeHeight();!E&&U.insertAfter(M.find("#content-title-div"));H.removeClass("no-tools-toolbars-visible no-tools-animate no-tools-animate-end");var S=A.add(P).add(G).add(B).add(M);E&&S.css({top:function(){return g(this).offset().top}});H.addClass("no-tools");var Q=AJS.dropDown.current||g(".aui-property-panel-parent");M.css({height:D(M.height()),overflow:D("hidden")});if(t){J-=B.height()}var K=D(u(V-J),"none");var y=D(u(F-R),"none");if(Q.length){var L=u((-J+(V*2)+(t?0:2))*(this.activatedDropdownContext?-1:1));var C="none";var N=this.activatedDropdownContext?D(C,L):D(L,C)}this.originalEditorToolbarTranslateY=V-J;this.savebarContainerOriginalTranslateY=p(T);!this.active&&H.addClass("no-tools-show-tools");if(!t){this.iframe.contents().find("body").toggleClass("no-tools-enabled",E)}setTimeout(function(X){var Y=l();z.off(Y).on(Y,function(Z){if(Z.target!=M[0]){return}if(E){AJS.messages.makeCloseable(U.find(".aui-message").not(".closeable").addClass("closeable"));U.appendTo(H);setTimeout(function(){H.addClass("no-tools-animate-end")},0)}else{A.css("height","100%");H.removeClass("no-tools no-tools-animate").css("overflow-y","auto")}X.transitioning=false;document.activeElement.tagName.toLowerCase()!="input"&&AJS.Rte.getEditor().focus();X.updateToolbarsDimensions()});H.addClass("no-tools-animate");S.css(s(K));T.css(s(y));if(Q){(Q instanceof jQuery?Q:Q.$.parent().add("body > svg")).css(s(N))}},0,this);this.storeActiveStateForNextSession()},updateToolbarsDimensions:function(){this.editorToolbarCurrentHeight=this.editorToolbar.height();this.editorToolbarCurrentTranslateY=this.originalEditorToolbarTranslateY-(this.editorToolbarCurrentHeight-this.originalEditorToolbarHeight)},hideStragglers:function(){g(".aui-dropdown, #table-picker-backdrop").each(function(){if(g(this).hasClass("hidden")){return true}var y=this.id=="table-picker-backdrop"?g(this):g(this).closest(".toolbar-item");y.click()})},adjustIframeHeight:function(){this.iframe.css("paddingBottom",this.active?this.editorToolbar.height()+this.hangOnScreenHeightFooter+1:0)},bindKeyboardShortcuts:(function(){var A=false;var C={};var B=function(D){if(typeof D!="string"){D=D.type}return D};var y=function(D){D=B(D);C[D]=true};var z=function(D){if(!_.keys(C).length){return}D=B(D);setTimeout(function(){delete C[D]},500)};return function(){if(A){return}A=true;var H=_.bind(function(I){if(!this.transitioning&&I.ctrlKey&&I.shiftKey&&I.keyCode=="F".charCodeAt(0)){I.preventDefault();this.toggle();q("keyboardShortcutUsed",{shortcut:"toggle"})}},this);var E=AJS.Rte.getEditor();E.onKeyDown.add(_.bind(function(I,J){H(J)},this));g(document).on("keydown",H);E.onKeyUp.add(_.bind(function(I,J){if(!this.active||_.keys(C).length||J.keyCode!=27){return}this.deactivate();q("keyboardShortcutUsed",{shortcut:"escape"})},this));var F=function(I){return I=="dropdown"||(g.isPlainObject(I)&&I.panel)};var G=_.bind(function(J,I,K){if(I.dialog){return}if(F(I)){this.activatedDropdownContext=this.active}y(I)},this);var D=_.bind(function(J,I,K){if(F(I)){this.activatedDropdownContext=false}z(I)},this);AJS.bind("show.dialog created.property-panel",G);g(document).bind("showLayer",G);AJS.bind("hide.dialog destroyed.property-panel",D);g(document).bind("hideLayer",D)}})(),hideHelpTips:function(){if(!i){return}i.view.$el.remove();i=null},showHelpTips:(function(){var y={};var A="dfe.betteruseofscreen";var z="dfe.neverused";return function(){var B=parseInt(AJS.Meta.get("build-number"),10);var C=B>4370;if(!AJS.HelpTip||!C){return}AJS.HelpTip.Manager.loaded.done(_.bind(function(){var J=n();if(this.active||g(".aui-help-tip").length||i!=null){if(!J&&i!=null&&i.attributes.fullScreen){this.hideHelpTips()}return}var L=AJS.HelpTip.Manager.dismissedTipIds;var N=function(O){return g.inArray(O,L)>-1};var F=25;var M=20;var D=g(window).height();var I=(D-this.wysiwyg.height())/D;var G={id:null,body:null,anchor:this.hideToolsButton};if(!e&&o>F&&!N(z)&&!N(A)){G.body="\u003cstrong>Get in the zone.\u003c\/strong> Hide the toolbar and focus on your content with distraction-free editing. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=a=z}else{if(o>M&&I>0.3&&!N(A)){G.body="\u003cstrong>Want more room?\u003c\/strong> Hide the toolbar and focus on your content with distraction-free editing. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=A;a="smalleditingspace"}else{if(J){G.body="\u003cstrong>Looks like you\'re in full-screen mode\u003c\/strong>. Get even more editing space by hiding the editor toolbar. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=A;G.fullScreen=true;a="fullscreen"}}}if(!G.id){this.hideHelpTips();return}var K=new AJS.HelpTip(G);if(window.localStorage){var H=k+"helptip."+G.id+".showncount";var E=+window.localStorage.getItem(H)||0;if(!y.hasOwnProperty(G.id)){E++;window.localStorage.setItem(H,E);y[G.id]=true}if(E>4){K.dismiss();return}}K.show();i=K},this))}})(),setActiveStateFromLastSession:function(){var y=window.localStorage&&window.localStorage.getItem(k+"activeState");if(y==="true"){this.activate()}},storeActiveStateForNextSession:function(){window.localStorage&&window.localStorage.setItem(k+"activeState",this.active)},getInfo:function(){return{longname:"Distraction Free Editor Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("dfe",tinymce.plugins.DFEPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:editor-scripts', location = 'scripts/paste-cleanup.js' */
AJS.$(document).bind("postPaste",function(b,a,c){AJS.$(c.node).find('span[class|="code"]').contents().unwrap();AJS.$(c.node).find('pre[class|="code"]').each(function(d,f){f.className=f.className.replace(/\bcode-.[^\s]*\b/gi,"")})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.status-macro:editor_status', location = 'js/status-editor.js' */
(function(d){var v="macro-placeholder-property-panel-edit-button";var n="status-macro-title first last editable";var r=13;var f=27;var o="status";var q=["Grey","Red","Yellow","Green","Blue"];var k=q[0];var t;var u,m,a;function s(){e();var z=Confluence.MacroParameterSerializer.deserialize(d(u).attr("data-macro-parameters")),A=false,y=false;if(z&&m){A=z.title!==m.title;y=z.colour!==m.colour}return A||y}function e(){if(a){var y=(b(m)==a.val());var z=(a.val()==="");if(y||z){delete m.title}else{m.title=a.val()}}}function p(){if(t&&t.state&&t.state()==="pending"){AJS.log("Macro update already in progress.");return}e();var z={contentId:Confluence.Editor.getContentId(),macro:{name:o,params:m,defaultParameterValue:"",body:""}};t=tinymce.confluence.MacroUtils.insertMacro(z,u);function y(A){AJS.Rte.getEditor().selection.select(A);AJS.Rte.BookmarkManager.storeBookmark();AJS.Rte.getEditor().selection.collapse()}t.done(function(A,B){u=A;y(u)}).fail(function(A){AJS.logError("Failed to load status macro - "+A)})}function b(y){return((y.colour||y.color)||k)}function j(){a=null;return true}function c(y){var z=d("<input/>");z.attr("class",n);z.keyup(function(A){if(A.keyCode===r){AJS.Confluence.PropertyPanel.destroy();return false}return true});z.keydown(function(A){if(A.keyCode===f){return j()}return true});return z}function x(y){a=c(m);a.val(y.find("span.panel-button-text").text());y.replaceWith(a);a.select().focus()}function h(){d.each(q,function(y,A){var z=function(C,B){m.colour=A;AJS.Confluence.PropertyPanel.destroy()};AJS.Confluence.PropertyPanel.Macro.registerButtonHandler(A,z,o)})}function i(y){return y.title||b(y)}function g(y){return{className:n,text:AJS.escapeHtml(y),click:x}}function l(z){for(var y=0;y<z.length;y++){if(z[y].className.indexOf(v)>-1){return z[y]}}return null}function w(y){var z=l(y);var A=function(B){tinymce.confluence.macrobrowser.editMacro(d(B))};z.click=function(){AJS.Confluence.PropertyPanel.destroy();if(!s()){A(u)}else{t.always(A)}}}AJS.Confluence.PropertyPanel.Macro.registerInitHandler(function(A,z,y){u=A;w(z);m=Confluence.MacroParameterSerializer.deserialize(d(u).attr("data-macro-parameters"));a=null;z.splice(1,0,g(i(m)))},"status");h();AJS.bind("destroyed.property-panel",function(y){if(s()){p()}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.macros.advanced:editor_includemacro', location = 'com/atlassian/confluence/plugins/macros/advanced/js/include-macro.js' */
AJS.bind("init.rte",function(){var b=AJS.Meta.get("context-path"),d=AJS.Meta.get("content-id"),c="plugins/servlet/confluence/include-page-macro/goto",a=function(e){var j=AJS.$(e),f=j.attr("data-macro-default-parameter"),h=b+"/"+c+"?location="+f+"&contentId="+d,g=(AJS.$.browser&&AJS.$.browser.msie)?"_blank":"confluence-goto-link-include-macro-"+e.id,i=window.open(h,g);if(i){i.focus()}};AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("goto-page",function(g,f){a(f)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-image-attributes:soy-resources', location = 'soy/image-attributes-panel.soy' */
// This file was automatically generated from image-attributes-panel.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Editor == 'undefined') { Confluence.Templates.Editor = {}; }
if (typeof Confluence.Templates.Editor.ImageAttributes == 'undefined') { Confluence.Templates.Editor.ImageAttributes = {}; }


Confluence.Templates.Editor.ImageAttributes.content = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="field-group"><label for="image-title-attribute">', soy.$$escapeHtml("Title text"), '</label><input class="text" type="text" id="image-title-attribute" name="image-title-attribute" value="', (opt_data.imgTitle) ? soy.$$escapeHtml(opt_data.imgTitle) : '', '"><div class="description">', soy.$$escapeHtml("Appears when the cursor hovers over the image"), '</div></div><div class="field-group"><label for="image-alt-attribute">', soy.$$escapeHtml("Alt text"), '</label><input class="text" type="text" id="image-alt-attribute" name="image-alt-attribute" value="', (opt_data.imgAlt) ? soy.$$escapeHtml(opt_data.imgAlt) : '', '"><div class="description">', soy.$$escapeHtml("Used by screen readers and when the image cannot be shown"), '</div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-image-attributes:image-attributes', location = 'js/image-attributes-panel.js' */
AJS.toInit(function(F){AJS.bind("dialog-created.image-properties",function(K,L){A=F(L.img);
J()
});
var C="image-attributes",D="image-attributes-panel",A,B,I;
function J(){var K=F(Confluence.Templates.Editor.ImageAttributes.content({imgTitle:A.attr("data-element-title"),imgAlt:A.attr("alt")}));
B=K.find("#image-title-attribute");
I=K.find("#image-alt-attribute");
E();
Confluence.Editor.ImageProps.registerPanel(C,K,D,H)
}function H(){var K=B.val();
A.attr({"data-element-title":K,title:G(A.attr("data-location"),K),alt:I.val()})
}function E(){if(B.val()===I.val()){B.bind("input.chained",function(K){I.val(B.val())
});
I.on("change",function(){B.unbind("input.chained")
})
}}function G(K,L){if(K&&K.length>0&&L&&L.length>0){return K+" ("+L+")"
}if(K&&K.length>0){return K
}if(L&&L.length>0){return"("+L+")"
}return""
}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.keyboardshortcuts:confluence-tinymce-keyboard-shortcuts', location = 'js/tinymce-plugin.js' */
(function($) {
	tinymce.create('tinymce.plugins.KeyboardShortcutsPlugin', {
        init : function(ed) {

            AJS.log("Init Editor Keyboard shortcuts plugin");

            var buildFormatFunction = function(format) {
                return function() {
                    ed.execCommand("FormatBlock", false, format);
                };
            };
            for (var i=1; i<7; i++) {
                ed.addCommand("FormatBlock-h" + i, buildFormatFunction("h" + i));
            }
            ed.addCommand("FormatBlock-p", buildFormatFunction("p"));
            ed.addCommand("FormatBlock-pre", buildFormatFunction("pre"));
            ed.addCommand("FormatBlock-blockquote", buildFormatFunction("blockquote"));

            ed.addCommand("mceConfShortcutDialog", Confluence.KeyboardShortcuts.openDialog);
            ed.addButton("help", {title : "confluence.conf_shortcuts_help_desc", cmd : "mceConfShortcutDialog"});
        },
        getInfo : function () {
            return {
                longname : "Atlassian Editor Keyboard Shortcuts Plugin",
                author : "Atlassian",
                authorurl : "http://www.atlassian.com",
                version : tinymce.majorVersion + "." + tinymce.minorVersion
            };
        }
    });

    // Register plugin
    tinymce.PluginManager.add("keyboardshortcuts", tinymce.plugins.KeyboardShortcutsPlugin);
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:editor-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/move-hidden-fields-hack.js' */
AJS.toInit(function(a){a("fieldset.create-content-template-fields > input").appendTo("form.editor")});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-macro-browser-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-from-template-macro-fields.js' */
AJS.toInit(function(f){function b(h,i){h=h||AJS.Meta.get("space-key");Confluence.Blueprint.Dialog.requestWebItems(h,false).done(function(j){var k=Confluence.Blueprint.Dialog.loadedWebitems[h];if(_.isEmpty(k)){AJS.log("create-from-template-macro-fields: No Create dialog web items found for spaceKey >"+h+"<");return}i(j,k)}).fail(function(){AJS.log("create-from-template-macro-fields: requestWebItems call for spaceKey >"+h+"< failed")})}function c(h,i){b(i,function(k,l){var j=h.val();h.empty();_.each(l,function(m){var o=m.itemModuleCompleteKey;if((o=="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blank-page"||o=="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post")){return}if(!(m.templateId||m.contentBlueprintId)){return}var n=f("<option></option>").text(m.name);n.attr("data-template-id",m.templateId);n.attr("data-blueprint-module-complete-key",m.blueprintModuleCompleteKey);n.attr("data-content-blueprint-id",m.contentBlueprintId);n.attr("data-create-result",m.createResult);n.val(m.templateId||m.contentBlueprintId);h.append(n)});h.val(j)})}var g={fields:{spacekey:{spaceKey:function e(k){var j=AJS.MacroBrowser.ParameterFields.spacekey(k),h=j.input.val();var i=function(){var l=j.input.val();if(l!=h){c(AJS.MacroBrowser.fields.templateName.input,l)}h=l};j.input.bind("selected.autocomplete-content",i);j.input.blur(i);return j}}},beforeParamsSet:function a(i,h){i.buttonLabel=i.buttonLabel||i.createButtonLabel||"Create from template";c(f("#macro-param-templateName"),i.spaceKey);return i},beforeParamsRetrieved:function d(j,k,h){var i=AJS.MacroBrowser.fields.templateName.input.find("option:selected");j.blueprintModuleCompleteKey=i.data("blueprint-module-complete-key");j.contentBlueprintId=i.data("content-blueprint-id");j.templateId=i.data("template-id");j.createResult=i.data("create-result");return j}};AJS.MacroBrowser.setMacroJsOverride("create-from-template",g)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/class/class.js' */
(function(){var b=function(e){var d=function(){};d.prototype=e;return new d()};var a=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){var k;var h=this.prototype;if(arguments.length>1){var j=AJS.$.makeArray(arguments);k=j.pop();var i;AJS.$.each(j,function(m,l){if(i){i=i.extend(l)}else{i=l}});return i.extend(this.prototype).extend(k)}else{k=arguments[0]}a=true;var g=new this();a=false;for(var f in k){if(g[f]=typeof k[f]=="function"&&typeof h[f]=="function"&&c.test(k[f])){g[f]=(function(l,m){return function(){var o=this._super;this._super=h[l];var n=m.apply(this,arguments);this._super=o;return n}})(f,k[f])}else{if(typeof h[f]==="object"){var e=b(k[f]);AJS.$.each(h[f],function(m,n){if(!e[m]){e[m]=n}else{if(typeof e[m]==="object"){var l=b(e[m]);AJS.$.each(n,function(p,o){if(!l[p]){l[p]=o}});e[m]=l}}});g[f]=e}else{g[f]=k[f]}}}function d(){if(!a&&this.init){this.init.apply(this,arguments)}}d.prototype=g;d.constructor=d;d.extend=arguments.callee;return d}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/control/control.js' */
AJS.jiraTrigger=function(a,b){a=new jQuery.Event(a);jQuery(b||window.top.document).trigger(a);return !a.isDefaultPrevented()};AJS.Control=Class.extend({INVALID:"INVALID",_throwReadOnlyError:function(a){new Error(this.CLASS_SIGNATURE+": Sorry ["+a+"] is a read-only property")},_assignEvents:function(c,a){this._unassignEvents(c,a);if(typeof a==="string"){for(var b in this._events[c]){AJS.$(document).delegate(a,b,this._getDispatcher(c,b))}}else{a=jQuery(a);for(b in this._events[c]){a.bind(b,this._getDispatcher(c,b));AJS.debug("AJS.Control bound eventType '"+b+"' for group '"+c+"' on target '"+(a[0].type||a[0])+"'")}}},_unassignEvents:function(h,a){if(typeof a==="string"){for(var e in this._events[h]){AJS.$(document).undelegate(a,e,this._getDispatcher(h,e))}}else{a=jQuery(a);try{for(e in this._events[h]){a.unbind(e,this._getDispatcher(h,e))}}catch(g){var d=a.data("events");if(d){for(e in d){if(e in this._events[h]){var f=this._getDispatcher(h,e);var b=d[e];for(var c=0;c<b.length;c++){if(b[c]===f){b.splice(c,1);break}}AJS.debug("AJS.Control unbound eventType '"+e+"' for group '"+h+"' on target '"+(a[0].type||a[0])+"'")}}}}}},_getDispatcher:function(e,b){var d=e+"/"+b;if(!this._dispatchers){this._dispatchers={}}if(!this._dispatchers[d]){var c=this._events[e][b];var a=this;this._dispatchers[d]=function(f){AJS.debug("AJS.Control dispatching eventType '"+b+"' for group '"+e+"' on instance '"+a.type+"'");return c.call(a,f,AJS.$(this))}}return this._dispatchers[d]},_isValidInput:function(){return true},_handleKeyEvent:function(f){var b=this;if(b._isValidInput(f)){var c=AJS.Keyboard.SpecialKey,a=AJS.Keyboard.shortcutEntered(f);if(a){if(b.keys[a]){b.keys[a].call(b,f);return}else{if((a===c.BACKSPACE||a===c.DELETE)&&b.keys.onEdit){b.keys.onEdit.call(b,f);return}}}var d=AJS.Keyboard.characterEntered(f);if(d&&b.keys.onEdit){b.keys.onEdit.call(b,f,d)}}},getCustomEventName:function(a){return(this.CLASS_SIGNATURE||"")+"_"+a},_getCustomEventArgs:function(){return[this]},trigger:function(a){return AJS.jiraTrigger(a,this)},_supportsBoxShadow:function(){var a=document.body.style;return a.WebkitBoxShadow!==undefined||a.MozBoxShadow!==undefined||a.boxShadow!==undefined},_setOptions:function(a){var b,c;a=a||{};if(a instanceof AJS.$||typeof a==="string"||(typeof a==="object"&&a.nodeName)){a={element:a}}b=AJS.$(a.element);c=b.getOptionsFromAttributes();this.options=AJS.$.extend(true,this._getDefaultOptions(a),c,a);if(b.length===0){return this.INVALID}return undefined},getCaret:function(a){var c=a.selectionStart;if(c>=0){return(a.selectionEnd>c)?-1:c}if(document.selection){var d=document.selection.createRange();if(d.text.length===0){var b=d.duplicate();b.moveToElementText(a);b.setEndPoint("EndToStart",d);return b.text.length}}return -1},_render:function(){var c,b=arguments[0],a=[];for(c=1;c<arguments.length;c++){a.push(arguments[c])}return this._renders[b].apply(this,a)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/input/keyboard.js' */
AJS.Keyboard={};(function(e){var f={},i={},d={};var g=AJS.Keyboard.SpecialKey={BACKSPACE:h("backspace",8,true),TAB:h("tab",9,true),RETURN:h("return",13,true),SHIFT:h("shift",16),CTRL:h("ctrl",17),ALT:h("alt",18),PAUSE:h("pause",19),CAPS_LOCK:h("capslock",20),ESC:h("esc",27,true),SPACE:h("space",32,true),PAGE_UP:h("pageup",33),PAGE_DOWN:h("pagedown",34),END:h("end",35),HOME:h("home",36),LEFT:h("left",37),UP:h("up",38),RIGHT:h("right",39),DOWN:h("down",40),INSERT:h("insert",45),DELETE:h("del",46),F1:h("f1",112),F2:h("f2",113),F3:h("f3",114),F4:h("f4",115),F5:h("f5",116),F6:h("f6",117),F7:h("f7",118),F8:h("f8",119),F9:h("f9",120),F10:h("f10",121),F11:h("f11",122),F12:h("f12",123),NUMLOCK:h("numlock",144),SCROLL:h("scroll",145),META:h("meta",224)};function h(l,m,k){f[m]=l;i[l]=m;if(k){d[m]=true}return l}g.eventType=function(){return e.browser.mozilla?"keypress":"keydown"};g.fromKeyCode=function(k){return f[k]};g.toKeyCode=function(k){return i[k]};g.isAscii=function(k){return !!d[k]};g.isSpecialKey=function(k){return !!g.toKeyCode(k)};function a(k){return k.originalEvent||k}AJS.Keyboard.characterEntered=function(k){var m=a(k);if(m.type==="keypress"){var l=c(m);if(l!==null&&(!g.isAscii(l)||g.fromKeyCode(l)===g.SPACE)){return String.fromCharCode(l)}}return undefined};function c(k){var l=a(k);if(l.which==null){return l.keyCode}else{if(l.which!=0&&l.charCode!=0){return l.which}else{return null}}}AJS.Keyboard.specialKeyEntered=function(l){l=a(l);if(e.browser.mozilla){if(l.type==="keypress"){var k=c(l);if(k===null){return g.fromKeyCode(l.keyCode)}else{if(g.isAscii(k)){return g.fromKeyCode(k)}}}}else{if(l.type!=="keypress"){return g.fromKeyCode(l.keyCode)}}return undefined};function j(m){m=a(m);var l=AJS.Keyboard.specialKeyEntered(m);if(l){return l}else{if(e.browser.mozilla){if(m.type==="keypress"){var k=c(m);if(k!==null){return String.fromCharCode(k).toLowerCase()}}}else{if(m.type!=="keypress"){return String.fromCharCode(m.keyCode).toLowerCase()}}}return undefined}AJS.Keyboard.shortcutEntered=function(n){n=a(n);if(n.type===AJS.Keyboard.SpecialKey.eventType()){var m=AJS.Keyboard.specialKeyEntered(n),k="";if(n.altKey&&m!==g.ALT){k+=b(g.ALT)}if(n.ctrlKey&&m!==g.CTRL){k+=b(g.CTRL)}if(n.metaKey&&!n.ctrlKey&&m!==g.META){k+=b(g.META)}if(n.shiftKey&&m!==g.SHIFT){k+=b(g.SHIFT)}if(m){return k+m}else{if(k.length>0&&k!=="shift+"){var l=j(n);if(l){return k+l}}}}return undefined};function b(k){return k+"+"}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/input/mouse.js' */
(function(b){AJS.Mouse={};var a=AJS.Mouse.MotionDetector=function(){this.reset()};a.prototype.reset=function(){this._handler=null;this._x=null;this._y=null;this.moved=false};a.prototype.wait=function(d){var c=this;if(!c._handler){this.reset();b(window.top.document).bind("mousemove",c._handler=function(f){if(!c._x&&!c._y){c._x=f.pageX;c._y=f.pageY}else{if(!(f.pageX===c._x&&f.pageY===c._y)){c.unbind();c.moved=true;if(d){d.call(this,f)}}}})}};a.prototype.unbind=function(){if(this._handler){b(window.top.document).unbind("mousemove",this._handler);this.reset()}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/group/group.js' */
AJS.Group=AJS.Control.extend({init:function(){this.type=this.type||"Group";this.items=[];this.index=-1;this._assignEvents("instance",this)},addItem:function(a){this.items.push(a);this._assignEvents("item",a)},removeItem:function(b){var a=AJS.$.inArray(b,this.items);if(a<0){throw new Error("AJS.Group: item ["+b+"] is not a member of this group")}b.trigger("blur");if(a<this.index){this.index--}this.items.splice(a,1);this._unassignEvents("item",b)},removeAllItems:function(){for(var a=0;a<this.items.length;a++){this._unassignEvents("item",this.items[a]);this.items[a].trigger("blur")}this.index=-1;this.items.length=0;this._unassignEvents("keys",document)},shiftFocus:function(b){AJS.debug("Group.shiftFocus called with offset: "+b);if(this.index===-1&&b===1){b=0}if(this.items.length>0){var a=(Math.max(0,this.index)+this.items.length+b)%this.items.length;this.items[a].trigger("focus")}},prepareForInput:function(){this._assignEvents("keys",document)},_events:{instance:{focus:function(){if(this.items.length===0){return}if(this.index<0){this.items[0].trigger("focus")}else{this._assignEvents("keys",document)}},blur:function(){if(this.index>=0){this.items[this.index].trigger("blur")}else{this._unassignEvents("keys",document)}}},keys:{"keydown keypress":function(a){this._handleKeyEvent(a)}},item:{focus:function(b){var a=this.index;this.index=AJS.$.inArray(b.target,this.items);if(a<0){this.trigger("focus")}else{if(a!==this.index){this.items[a].trigger("blur")}}},blur:function(a){if(this.index===AJS.$.inArray(a.target,this.items)){this.index=-1;this.trigger("blur")}},remove:function(a){this.removeItem(a.target)}}},keys:{}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/select-grid.js' */
(function(c){AJS.SelectGrid=AJS.Group.extend({init:function(e){this.type=this.type||"SelectGrid";this._super();var f=c(Confluence.Templates.SelectGrid.gridOutline());var g=f.find("thead tr");c(e.columns).each(function(h,j){var k=AJS("th").addClass(j.getClassName()).text(j.heading);g.append(k)});this.gridContainer=c(e.gridContainer).append(f);this.getRowId=e.getRowId;this.table=f;this.columns=e.columns;this.selectionCallback=e.selectionCallback;this.body=f.find("tbody");this.body.delegate("a","click",function(h){h.preventDefault()});this.dontShiftFocus=e.dontShiftFocus||function(){}},keys:{up:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(-1);f.preventDefault()},down:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(1);f.preventDefault()}},_addRow:function(h,g,e,i){if(c.isFunction(e)){i=e;e=false}e?this.body.prepend(h):this.body.append(h);var f=new b({row:h,data:g,callback:i,getRowId:this.getRowId,selectionCallback:i});this.addItem(f);return f},clear:function(){this.removeAllItems();this.body.children().remove()},_addRows:function(g,e){var f=this;var h=[];c(g).each(function(j,k){var l=a(k,f.columns);l.attr("data-id",f.getRowId(k));h.push(f._addRow(l,k,e,f.selectionCallback))});return h},update:function(e){this.clear();if(!e||!e.length){AJS.debug("SelectGrid.update called with no data, returning.");return}this._addRows(e);this.prepareForInput()},prependAndSelect:function(f,e){if(!f||!f.length){AJS.debug("SelectGrid.prependAndSelect called with no data, returning.");return}var g=this._addRows(f,true);g[e||0].selectRow()},findItem:function(g){for(var e=0;e<this.items.length;e++){var f=this.items[e].getRowId();if(f==g){return this.items[e]}}AJS.debug("SelectGrid.findItem didn't find item, returning null.");return null},select:function(f){var e=this.findItem(f);e&&e.selectRow()},selectIndex:function(e){e=e||0;if(this.items[e]){this.items[e].selectRow()}else{AJS.debug("SelectGrid.selectIndex couldn't select row with index "+e+", not found")}},show:function(){this.gridContainer.removeClass("hidden")},hide:function(){this.gridContainer.addClass("hidden")},isVisible:function(){return !this.gridContainer.hasClass("hidden")}});var b=AJS.Control.extend({init:function(e){this.type="SelectableRow";this.$row=AJS.$(e.row);this.$row.data("properties",e.data);this.getRowId=function(){return e.getRowId(e.data)};this.selectionCallback=e.selectionCallback;this._assignEvents("element",this.$row);this._assignEvents("instance",this);AJS.debug("SelectableRow initialized")},_events:{instance:{focus:function(f){var g=this.$row;g.addClass("selected");this.selectionCallback(g,g.data("properties"))},blur:function(f){this.$row.removeClass("selected")}},element:{click:function(){this.trigger("focus")}}},selectRow:function(){this.trigger("focus")}});var d=function(f,e){return{outerClass:e.getClassName(f)||"",href:e.getHref&&e.getHref(f)||"",innerClass:e.getInnerClass&&e.getInnerClass(f)||"",title:e.getTitle&&e.getTitle(f)||"",text:e.getText(f)||""}};var a=function(i,h){var j,g,f,e;j=AJS("tr");c(h).each(function(k,l){g=d(i,l);f=g.href?"cellWithLink":"cellWithoutLink";e=Confluence.Templates.SelectGrid[f](g);j.append(e)});return j};AJS.SelectGrid.Column=function(g){var e=function(){return g.className||(g.key+"-field")},f=function(h){return h[g.key]};return{key:g.key,heading:g.heading,getClassName:g.getClassName||e,getHref:g.getHref,getInnerClass:g.getInnerClass,getTitle:g.getTitle,getText:g.getText||f}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/select-grid.soy' */
// This file was automatically generated from select-grid.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.SelectGrid == 'undefined') { Confluence.Templates.SelectGrid = {}; }


Confluence.Templates.SelectGrid.gridOutline = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<table class="select-grid aui"><thead><tr class="data-table-header"></tr></thead><tbody></tbody></table>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.SelectGrid.cellWithLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="', soy.$$escapeHtml(opt_data.outerClass), '"><a class="', soy.$$escapeHtml(opt_data.innerClass), '" href="', soy.$$escapeHtml(opt_data.href), '" title="', soy.$$escapeHtml(opt_data.title), '"><span>', soy.$$escapeHtml(opt_data.text), '</span></a></td>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.SelectGrid.cellWithoutLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="', soy.$$escapeHtml(opt_data.outerClass), '"><span class="', soy.$$escapeHtml(opt_data.innerClass), '" title="', soy.$$escapeHtml(opt_data.title), '">', soy.$$escapeHtml(opt_data.text), '</span></td>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/result-grid.js' */
(function(a){AJS.ResultGrid=AJS.Control.extend({init:function(k){this.type=this.type||"ResultGrid";var b,d,g,i,j,f,e;d=k.gridContainer||a(k.baseElement).find(".data-table");if(!d.length){AJS.debug("gridContainer for AJS.ResultGrid not found!")}g=function(l){return l.id};b=new AJS.SelectGrid({gridContainer:d,columns:k.columns,selectionCallback:k.selectionCallback,getRowId:k.getRowId||g,dontShiftFocus:k.dontShiftFocus});f=k.messageHandler||AJS.MessageHandler({baseElement:a(k.baseElement).find(".message-panel")});function c(o,m){if(i){return}var n,p,q,l;l=60;q=13;n=o/2-(l+q);p=m/2-(l+q);o=o-n;m=m-p;j=AJS("div").addClass("spinner-container").width(o).height(m).css({"padding-left":n,"padding-top":p}).insertAfter(d);i=Raphael.spinner(j[0],l,"#666")}function h(){if(i){i();j.remove();i=null}}e=k.noResultMessage||"There are no results.";a.extend(this,{update:function(m,l){f.clearMessages();h();b.clear();if(!m||!m.length){b.hide();var n=a.isFunction(e)?e(l):e;f.displayMessages(n);return false}b.update(m);b.show();return true},updateAndSelect:function(n,m,l){if(this.update(n,m)){this.selectIndex(l)}},prependAndSelect:function(m,l){if(!m||!m.length){AJS.debug("ResultGrid.prependAndSelect called with no data, returning.");return}f.clearMessages();b.prependAndSelect(m,l);b.show()},select:function(l){b.select(l)},selectIndex:function(l){b.selectIndex(l)},clear:function(){f.clearMessages();b.hide()},loading:function(){b.show();var m=d.width();var l=d.height();this.clear();c(m,l)},isVisible:function(){return b.isVisible()}})}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-object.js' */
(function ($) {
/**
 * The Link object contains all of Confluence's business logic about a front-end Link.
 *
 * It should not interact with the RTE directly but rather use the LinkAdapter singleton.
 */
Confluence.Link = {

    // Until this code gets refactored to use proper prototyping just do a duck-type check
    // instead of a constructor check.
    isLink: function (obj) {
        return obj && !!obj.fillNode;
    }
};

var newLink = function (props) {

    // If the object passed in is already a Link just return it.
    if (Confluence.Link.isLink(props)) {
        return props;
    }

    var link = {

        /**
         * Inserts this link into the RTE
         */
        insert: function () {
            Confluence.Editor.LinkAdapter.setLink(link);
        },

        /**
         * Fills the passed DOM node with the contents of this Link object.
         * @param $link the jQuery-wrapped node to fill with the link data
         */
        fillNode: function ($link) {
            var attrs = this.attrs;
            attrs.href = attrs.href || '#';
            $link.attr(attrs);

            if (this.classes && this.classes.length) {
                $link.addClass(this.classes.join(" "));
            }

            $link.html(this.body.html);
            return $link;
        },

        /**
         * Returns a representation of this link as data only - no functions.
         */
        getData: function () {
            var props = {}, key;

            for (key in this) {
                if (this.hasOwnProperty(key) && !$.isFunction(this[key]))
                    props[key] = this[key];
            }
            return props;
        },

        /**
         * If the body for this link is a lone image, return it.
         */
        getLinkedImage: function () {
            if (this.body && this.body.jquery) {
                return this.body.length == 1 && this.body.is('img') && this.body;
            }
            return null;
        },

        getResourceId: function () {
            return this.attrs["data-linked-resource-id"] || "";
        },

        /**
         * Returns true if this link points to Confluence content like a Page, Attachment, Space, et al.
         */
        isToConfluenceEntity: function () {
            return this.attrs["data-linked-resource-id"];
        },

        isToAttachmentOnSamePage: function (contentId) {
            return this.attrs["data-linked-resource-type"] == 'attachment' && this.attrs["data-linked-resource-container-id"] == contentId;
        },

        /**
         * A standard link will be stored as an a tag whereas a custom 'atlassian-content' link will be stored as an ac:link
         * tag. This method lets you differentiate between them in the browser.
         *
         * When used in conjunction with isToConfluenceEntity this can identify a relative link (link to the current page).
         *
         * @return true if the link is an atlassian-content (custom XHTML namespace) link (as opposed to an HTML link)
         */
        isCustomAtlassianContentLink: function() {
            if (this.classes && this.classes.length) {
                return $.inArray("confluence-link", this.classes) != -1;
            } else {
                return false;
            }
        },

        /**
         * @return true if the link has the correct anchor attribute
         */
        hasAnchor: function() {
            return this.attrs["data-anchor"];
        },

        getResourceType: function () {
            return this.attrs["data-linked-resource-type"];
        },

        getDefaultAlias: function () {
            return this.attrs["data-linked-resource-default-alias"];
        },

        getHref: function () {
            return this.attrs.href;
        },

        getAnchor: function () {
            return this.attrs["data-anchor"];
        },

        getHtml: function () {
            return this.body.html;
        },

        isHrefValid: function () {
            return this.attrs.href && this.attrs.href != 'http://';
        },

        isImage: function () {
            return this.body.isImage;
        },

        isNewLink: function () {
            return $.isEmptyObject(this.attrs);    // a link with no attributes has no destination ==> new
        },

        showsBreadcrumbs: function () {
            return true;
        }
    };

    // if the attrs in the property contain class values extract them
    if (props && props.attrs) {
        var attrsOnly = {};
        var classAttrValue = null;

        $.each(props.attrs, function(key, value) {
           if (key == "class") {
               classAttrValue = value;
           } else {
               attrsOnly[key] = value;
           }
        });

        props.attrs = attrsOnly;
        if (classAttrValue) {
            var classAttrArray = classAttrValue.split(" ");

            if (props.classes && props.classes.length) {
                props.classes = props.classes.concat(classAttrArray);
            } else {
                props.classes = classAttrArray;
            }
        }
    }

    $.extend(link, props);

    return link;
};

/**
 * Returns the image node if the node is an image or if it is a linked image.
 * If no image node is found, null is returned.
 * @param node the node to inspect
 */
function getImageNode(node) {
    if ($.nodeName(node, 'img'))
        return node;

    //we are only interested in nodes that have just an image node.
    var hasOneChild = node.hasChildNodes() && node.childNodes.length == 1;
    if (hasOneChild && $.nodeName(node, "a") && $.nodeName(node.firstChild, "img"))
        return node.firstChild;

    return null;
}

/**
 * Returns the name of given image node. If the node is null, an empty string is returned.
 * @param imageNode - the image node to inspect.
 */
function getImageName(imageNode) {
    if (!imageNode)
        return "";

    return ($(imageNode).attr('data-linked-resource-default-alias') || $(imageNode).attr('src'));
}

/**
 * Returns a map of the attributes present in a link node.
  * @param node
 */
function getLinkNodeAttributes(node) {
    var attrs = {};
    if (node.nodeName == "A") {
        $(node.attributes).each(function () {
            attrs[this.name] = this.value;
        });
    }

    return attrs;
}

/**
 * Returns true if the range between two sibling nodes (have the same parent)
 * contains only text nodes.
 * @param startNode - the node to start from
 * @param endNode - the node to end with
 */
function areSiblingsTextNodes(startNode, endNode) {
    var currentNode = startNode;
    while (currentNode && currentNode != endNode) {
        if (currentNode.nodeType != 3)
            return false;

        currentNode = currentNode.nextSibling;
    }

    return endNode.nodeType == 3;
}

/**
 * This attempts to resolves the given range to account for the situation
 * where one cursor is set just inside of an element, while the other
 * is set inside the parent element.
 * If the range can be resolved such that the start and end container
 * share the same parent, the two values are returned.
 * Otherwise, null is returned.
 * @param rng
 */
function resolveRange(rng) {
    var dom = tinymce.activeEditor.dom,
        start = dom.isBlock(rng.startContainer) ? rng.startContainer.childNodes[rng.startOffset] : rng.startContainer,
    	end = dom.isBlock(rng.endContainer) ? rng.endContainer.childNodes[rng.endOffset - 1] : rng.endContainer;

    if (start && end && (start.parentNode == end.parentNode)) {
        return {
            start: start,
            end: end
        };
    } else {
        return null;
    }
}

function isSelectionContainsEditableLinkText(rng) {
    // Collapsed ranges are always editable - the link text field will be empty
    if (rng.collapsed) {
        return true;
    }

    var start = rng.startContainer,
        end = rng.endContainer;

    // If the selection is a single text node that text can be edited.
    // Anything else - including selected images - cannot be edited.
    if (start == end) {
        if (start.nodeType == 3)
            return true;

        return areSiblingsTextNodes(start.childNodes[rng.startOffset], start.childNodes[rng.endOffset - 1]);
    }

    var resolvedContainers = resolveRange(rng);
    return !!resolvedContainers && areSiblingsTextNodes(resolvedContainers.start, resolvedContainers.end);
}

Confluence.Link.fromData = function(data){
	return newLink(data);
}

/**
 * Given a link node and an alias, creates a link object with correct body and attributes.
 * @param linkNode The link node DOM object. The node is not expected to exist in the Editor.
 * @param alias The link alias.
 */
Confluence.Link.fromNode = function(linkNode, alias) {
    var link = newLink({
        attrs: {},
        body: {
            html: alias,
            text: alias
        }
    });

    return newLink({
      attrs: getLinkNodeAttributes(linkNode),
      body: {
          html: alias,
          text: alias
      }
    });
};


/**
 * Creates a link object from a provided link in the Editor.
 *
 * @param linkEl - an existing link in the editor
 * @param linkText - formatted link text
 */
Confluence.Link.fromSelectedAnchor = function (linkEl, linkText) {
    var $linkEl = $(linkEl),
        imageNode = getImageNode(linkEl),
        isEditable = !imageNode && areSiblingsTextNodes(linkEl.firstChild, linkEl.lastChild);

    return newLink({
        attrs: getLinkNodeAttributes(linkEl),
        body: {
            isEditable: isEditable,
            isImage: !!imageNode,
            html: $linkEl.html(),
            imgName: getImageName(imageNode),
            text: linkText
        }
    });
};

/**
 * Called when creating a Link from an editor selection.
 *
 * If the selection is inside an existing link use #fromSelectedAnchor
 *
 * @param rng - a w3c range object of the selection
 * @param selectedNode - the common ancestor node of the start and end containers
 * @param selectedHtml - the raw html of the selection
 * @param selectedText - formatted selection text
 */
Confluence.Link.fromSelection = function (rng, selectedNode, selectedHtml, selectedText) {
    var imageNode = getImageNode(selectedNode),
        isEditable = !imageNode && isSelectionContainsEditableLinkText(rng);

    return newLink({
        attrs: {},
        body: {
            isEditable: isEditable,
            isImage: !!imageNode,
            html: selectedHtml,
            imgName: getImageName(imageNode),
            text: selectedText
        }
    });
};

/**
 * Creates a Link object from a REST object
 * @param restObj
 */
Confluence.Link.fromREST = function (restObj) {
    var link = newLink({
        attrs: {
            "data-base-url": AJS.Confluence.getBaseUrl(),
            "data-linked-resource-id": restObj.id,
            "data-linked-resource-type": restObj.type,
            href: AJS.REST.findLink(restObj.link),
            "data-linked-resource-default-alias": restObj.title
        },
        body: {
            html: AJS.escapeHtml(restObj.title),
            text: AJS.escapeHtml(restObj.title)
        },
        classes: ["confluence-link"]
    });

    // CONDEV-5286: The problem here is that the REST response will have a type of 'user'
    // whereas the conversion to storage format requires 'userinfo'.
    if (restObj.type == "user")
        link.attrs["data-linked-resource-type"] = "userinfo";

    return link;
};

/**
 * Creates a link that points to a new page.
 */
Confluence.Link.createLinkToNewPage = function (pageTitle, spaceKey) {
    return newLink({
        attrs: {
            "data-space-key": spaceKey,
            "data-content-title": pageTitle,
            href: AJS.contextPath() + '/pages/createpage.action?spaceKey=' + spaceKey + '&title=' + pageTitle
        },
        body: {
            html: AJS.escapeEntities(pageTitle),
            text: pageTitle
        },
        classes: ["createlink", "confluence-link"]
    });
};

/**
 * Creates a link to an external webpage or email address.
 */
Confluence.Link.makeExternalLink = function (href) {
    return newLink({
        attrs: {
            href: href
        },
        body: {
            html: href,
            text: href
        }
    });
};

Confluence.Link.isExternalLink = function(destination) { //Same check as ConfluenceLinkResolver.java
    return destination && (destination.match(/^(\/\/|mailto:|file:|http:|https:)/) || destination.indexOf("\\") === 0);
};

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-adapter.js' */
/**
 * LinkAdapter is an adapter between the RTE and a Link object.
 *
 * It should not know about the Link Browser or how the internals of a Link object work.
 * Any interaction with RTE nodes and Links should be via this object.
 */
Confluence.Editor.LinkAdapter = (function ($) {
    return {

        /**
         * Inserts a link at the position of the current range.
         * @param linkObj a Confluence.Link instance
         */
        setLink: function (linkObj) {
            var ed = AJS.Rte.getEditor(),
                newLinkNode = $(ed.dom.create("a"), ed.getDoc());

            linkObj.fillNode(newLinkNode);
            tinymce.confluence.NodeUtils.replaceSelection(newLinkNode);

            // CONFDEV-5203 - Prevent cursor loss when using arrow keys after inserting an
            // image. This is a FF-specific issue that occurs when adding or editing comments.
            if (!!$("#comments-section").length) {
                AJS.Rte.fixEditorFocus();
            }
        },

        /**
         * Constructs a javascript object containing link information.
         * Invoked when the user tries to edit an existing link or make a piece of selected content into a link.
         *
         * Returns a new or existing link based on the current Editor selection.
         */
        getLink: function() {
            var selectedHtml, selectedText, rng,
                ed = AJS.Rte.getEditor(),
                selection = ed.selection,
                selectedNode = selection.getNode(),
                linkNode = $(selectedNode).parents().andSelf().filter("a[href]")[0];

            if (linkNode) {
                selection.select(linkNode);
                selectedText = selection.getContent({format : 'text'});

                return Confluence.Link.fromSelectedAnchor(linkNode, selectedText);
            } else {
                rng = selection.getRng(true);
                selectedText = selection.getContent({format : 'text'});
                selectedHtml = selection.getContent();
                return Confluence.Link.fromSelection(rng, selectedNode, selectedHtml, selectedText);
            }
        }

    };
}(AJS.$));

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser.js' */
Confluence.Editor.LinkBrowser = (function($) {

    var popup, locationPresenter, submitButton, currentTab, dialogId = "insert-link-dialog";

    // The key of the search panel, uses internally and exposed.
    var SEARCH_PANEL = 'search',
        ATTACHMENTS_PANEL = 'attachments',
        WEBLINK_PANEL = 'weblink',
        ADVANCED_PANEL = 'advanced';

    /**
     * Called when the user pressed the Insert/Edit button or presses Enter.
     */
    function submit() {
        if (submitButton.prop("disabled")) return;

        submitButton.prop('disabled', true);
        AJS.debug("link-browser.js: submit");

        // Some tabs may need to alter the location if the submit has been called before blur on some element.
        currentTab.preSubmit && currentTab.preSubmit();

        var link = locationPresenter.getLink();
        close();

        link.insert();

        // CONFDEV-10562 (AUI's remove.dialog event fires before the link has been inserted)
        AJS.trigger('closed.link-browser');
    }

    /**
     * Closes the dialog and resets state to before it was opened - called by both submit and cancel.
     */
    function close() {
        popup.hide().remove();
        AJS.Rte.BookmarkManager.restoreBookmark();
    }

    /**
     * Called when the user presses the Cancel link or presses Escape
     */
    function cancel() {
        close();
        AJS.trigger('closed.link-browser');
    }

    /**
     * Make the Link Browser dialog element, setting button text based on whether a link is being created or edited.
     */
    function makePopup(isNew) {
        var dialog, dialogTitle, submitText;

        dialog = new AJS.ConfluenceDialog({
            width: 840,
            height: 590,
            id: dialogId,
            onCancel: cancel,
            onSubmit: submit
        });

        dialogTitle = isNew ? "Insert link" : "Edit link";
        submitText = isNew ? "Insert" : "Save";

        dialog.addHeader(dialogTitle);

        dialog.addButton(submitText, submit);

        dialog.addCancel("Cancel", cancel);
        dialog.addHelpText("Hint: type \"[\" in the editor to see a list of suggested pages and insert a link.");

        // See CONFDEV-14467 - this can be removed when CONFDEV-12434 is implemented
        var $dialogTip = $('#' + dialogId + ' .dialog-tip');
        $dialogTip.attr('title', $dialogTip.text());

        // CONFDEV-12853: Add help link via prepend() instead of append() to prevent FF display issue
        $("#" + dialogId + " .dialog-components .dialog-title").prepend(Confluence.Templates.LinkBrowser.helpLink());

        submitButton = dialog.get("button:0")[0].item;
        submitButton.attr("id", 'link-browser-insert');
        submitButton.prop("disabled", true);

        return dialog;
    }

    // Creates the panel element for the tab specified by the web-item,
    // and initializes the tab-controller for it.
    function makeTab(i, tabPresenter, controller) {
        var key = tabPresenter.key,
            tabTitle = tabPresenter.label,
            className = key + "-panel",
            panel = Confluence.Templates.LinkBrowser[key + 'Panel']({atlToken: AJS.Meta.get('atl-token')});

        popup.addPanel(tabTitle, panel, className, className + '-id');

        // The Panel object instance.
        var panelObj = popup.get("panel:" + i);

        // The controller.tabs map will have been pre-populated by a 'dialog-created.link-browser' event binding.
        var tab = controller.tabs[key];
        tab.panelObj = panelObj;
        tab.key = key;
        tab.createPanel({
            baseElement: $(panelObj[0].body)
        });

        // Called automatically by the AJS.Dialog code when a panel is changed
        panelObj[0].onblur = tab.onDeselect;

        panelObj[0].onselect = function () {
            // Most tabs don't show breadcrumbs so it's opt-in by declaring a property.
            var hasBreadcrumbs = !!tab.hasBreadcrumbs;
            AJS.debug("Link Browser: on tab select, breadcrumbs enabled: " + hasBreadcrumbs);
            tab.onSelect();
            locationPresenter.refresh(hasBreadcrumbs);
            currentTab = tab;
        };

        return tab;
    }

    /**
     * Browser tabs are pluggable based on web-items with section
     * "system.editor.link.browser.tabs", sorted by item weight.
     * {@see link-browser-web-items.vm}
     */
    function getTabPresenters() {
        var supportedLinkTypes =  $("#link-browser-tab-items").find("div").map(function() {
            var item = $(this);
            return {
                key: item.text(),
                weight: item.attr("data-weight"),
                label: this.title
            }
        }).sort(function (a, b) {
                return a.weight - b.weight;
        });
        var isAttachmentSupported = AJS.Meta.get("content-type") !== "template";
        return $.grep(supportedLinkTypes, function(item, index) {
            return isAttachmentSupported || item.key !==  "attachments";
        });
    }

    /**
     * Sets up the Link Browser tabs and the tab it will be opened to, based on any existing link being edited or a
     * present panel key.
     *
     * @param controller the LB controller
     * @param presetPanelKey a panel key like 'search', 'attachments' or 'web-link'
     * @param linkObj a existing link object being edited
     */
    function setupTabs(controller, linkObj, presetPanelKey) {

        var tabPresenters = getTabPresenters();

        // Loops through each web-item tab, setting up the associated panel.
        var firstTab;
        var currentTab = null;
        for (var i = 0, ii = tabPresenters.length; i < ii; i++) {
            var tab = makeTab(i, tabPresenters[i], controller);
            if (i == 0) {
                firstTab = tab;
            }
            if (!linkObj.isNewLink() && $.isFunction(tab.handlesLink) && tab.handlesLink(linkObj)){
                currentTab = tab;
                tab.openedLink = linkObj;
            }
            else if (presetPanelKey == tab.key) {
                // User wants to open the Link Browser to a particular panel
                currentTab = tab;
            }
        }
        if (currentTab) {
            // A particular tab is selected either by user choice or editing an existing link:
            // don't let the dialog perform its default action of opening the last tab selected.
            controller.popup.overrideLastTab();
        } else {
            currentTab = firstTab;  // Select the first tab by default
        }
        return currentTab;
    }

    /**
     * Returns the Main controller object, separate to the DOM. Should be QUnit-testable.
     */
    function makeController() {
        return {

            // Contains a map of LinkTabPanel objects.
            tabs: {},

            // Called by Tabs when the link they represent is changed
            setLink: function (link, hasBreadcrumbs) {
                locationPresenter.setLink(link, hasBreadcrumbs);
            },

            getLink: function () {
                return locationPresenter.getLink();
            },

            getSelectedDataTableItem: function () {
                return $('.data-table:visible tr.selected');
            },

            // Called by Tabs when the link they represent is valid or not.
            linkValid: function (valid) {
                submitButton.prop("disabled", !valid);
            },

            // If the link text can't be focused because it isn't visible, focus the submit button instead.
            focusLinkText: function () {
                if (!locationPresenter.focusLinkText()) {
                    AJS.debug('LinkBrowser: focusing submit button');
                    submitButton.focus();
                }
            },

            getLinkText: function () {
                return locationPresenter.getLinkText();
            },

            isLinkTextVisible: function () {
                return locationPresenter.isLinkTextVisible();
            },

            hasBreadcrumbs: function (crumbTexts) {
                return locationPresenter.hasBreadcrumbs(crumbTexts);
            },

            getLocationPresenter: function () {
                return locationPresenter;
            },

            // Select the 'Search' tab and perform a search on the passed text
            doSearch: function (searchText) {
                this.tabs[SEARCH_PANEL].doSearch(searchText);
            },

            getSearchTextField: function () {
                return this.tabs[SEARCH_PANEL].getSearchTextField();
            },

            // Moves the location panel to be inside the new parent. Used for styling.
            moveLocationPanel: function (newParent) {
                locationPresenter.moveLocationPanel(newParent);
            },

            // Moves the location panel back to its normal position
            restoreLocationPanel: function () {
                locationPresenter.restoreLocationPanel();
            },

            /**
             * Selects the Link Browser tab with the given index.
             */
            gotoPanel: function (index) {
                this.popup.gotoPanel(index);
            },

            /**
             * Returns the currently-selected tab.
             */
            getCurrentPanel: function () {
                return this.popup.getCurrentPanel();
            },

            /**
             * If the web-link panel is visible, sets the URL field to be the passed value.
             */
            setWebLinkURL: function (url) {
                var webLinkTab = this.tabs[WEBLINK_PANEL];
                if (currentTab != webLinkTab) {
                    AJS.log('Cannot set URL ' + url + ' on hidden Web Link panel');
                    return;
                }
                webLinkTab.setURL(url);
            },

            getWebLinkUrl: function () {
                var webLinkTab = this.tabs[WEBLINK_PANEL];
                if (currentTab != webLinkTab) {
                    AJS.log('Cannot get URL ' + url + ' on hidden Web Link panel');
                    return null;
                }
                return webLinkTab.getURL();
            },

            getTitle: function () {
                return this.popup.getTitle();
            },

            getSubmitButtonText: function () {
                return submitButton.text();
            },

            isSubmitButtonEnabled: function () {
                return submitButton.is(':enabled');
            },

            isVisible: function () {
                return this.popup.isVisible();
            },

            /**
             * If the advanced panel is visible, sets the link field.
             */
            getAdvancedTextField: function () {
                var advancedTab = this.tabs[ADVANCED_PANEL];
                if (currentTab != advancedTab) {
                    AJS.log('Cannot get link text on hidden advanced panel');
                    return null;
                }
                return advancedTab.getLink();
            },

            setAdvancedTextField: function (text) {
                var advancedTab = this.tabs[ADVANCED_PANEL];
                if (currentTab != advancedTab) {
                    AJS.log('Cannot set link text on hidden advanced panel');
                    return;
                }
                advancedTab.setLink(text);
            },

            submit: submit,
            cancel: cancel
        };
    }

    /**
     * Main method to open the Link Browser, called from open.
     */
    function openLinkDialog(options) {

        var controller = makeController();

        var linkObj = options.linkInfo;
        popup = makePopup(linkObj.isNewLink());
        controller.popup = popup;

        // Link browser tabs aren't registered until this point - new tabs
        // need to add a binding to this event.
        AJS.trigger("dialog-created.link-browser", [controller]);

        // Create the location panel that is shared between all Dialog panels.
        locationPresenter = Confluence.Editor.LinkBrowser.LinkInfoPresenter(controller);
        locationPresenter.setLinkBody(linkObj.body);

        currentTab = setupTabs(controller, linkObj, options.panelKey);

        popup.popup.element.find('.dialog-page-body:first').append(locationPresenter.getContainer());

        currentTab.panelObj.select();
        currentTab.openedLink = null;   // this ref shouldn't be used after the first tab is selected, so kill it

        popup.show();
        //controller the right thing to send?
        AJS.trigger("dialog-shown.link-browser", popup);
        return controller;
    }

    return {
        // These ids let RTE menu and autocomplete items open the Link Browser to a particular panel.
        SEARCH_PANEL: SEARCH_PANEL,
        ATTACHMENTS_PANEL: ATTACHMENTS_PANEL,
        WEBLINK_PANEL: WEBLINK_PANEL,
        ADVANCED_PANEL: ADVANCED_PANEL,

        /**
         * If the options include an "opener" function, that is used to launch the dialog; otherwise a LinkInfo object is
         * created for the current Editor and the default launcher called.
         *
         * @param options : panelKey - (optional) a panel of the Link Browser to open to
         *                  opener - (optional) a function used to launch the Link Browser
         */
        open: function (options) {
            // Prevent it from opening if another popup dialog is open
            if ($('.aui-dialog:visible').length) return null;

            options = options || {};

            // Store the current selection and scroll position, and get the selected text.
            AJS.Rte.BookmarkManager.storeBookmark();

            options.linkInfo = options.linkInfo || Confluence.Editor.LinkAdapter.getLink();

            if (options.opener)
                // Any supplied opener function must include required state in its scope.
                return options.opener(options.linkInfo.alias, options.linkInfo);

            return openLinkDialog(options);
        },

        cancel: cancel
    };
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-location.js' */
/**
 * Represents the destination panel containing the Link location (internal or external) and the link Alias.
 */
(function($) {
Confluence.Editor.LinkBrowser.LinkInfoPresenter = function (lbController) {

    var container,              // the top-level container holding the location elements
        breadcrumbsEl,          // the element containing any Breadcrumbs
        breadcrumbController,   // the controller for updating and rendering Breadcrumbs
        currentLink,            // the link object currently selected or entered
        defaultAliasClass,      // class that indicates the default alias has been used
        linkTextField,
        linkTextRow,
        linkImageRow,
        linkMixedRow,
        linkMixedContent,
        linkImageName,
        finalBody,              // the body of the link when an image or range is selected - it cannot be changed
        movedPanel,             // when panels are moved, stores the panel that was moved
        movedPanelParent;       // when panels are moved, stores the location the panel should be restored to

    container = $(Confluence.Templates.LinkBrowser.locationPanel());
    breadcrumbsEl = container.find('#breadcrumbs-container');
    breadcrumbController = AJS.MoveDialog.Breadcrumbs(breadcrumbsEl, AJS.Breadcrumbs.getBreadcrumbs);
    defaultAliasClass = "default-alias";
    linkImageRow = container.find('.link-image');
    linkMixedRow = container.find('.link-mixed');
    linkImageName = container.find('#link-image-filename');
    linkMixedContent = container.find('#link-mixed-content');
    linkTextRow = container.find('.link-text');
    linkTextField = linkTextRow.find('input');

    // If the user types in the link text field, we remove the default alias class to indicate this.
    linkTextField.change(function(e) {
        e.keyCode = e.keyCode || e.which;
        if (e.keyCode && e.keyCode != 13)
            linkTextField.removeClass(defaultAliasClass);
    });

    /**
     * Returns the text in the link text field.
     */
    function getLinkText() {
        return AJS.escapeHtml(getRawLinkText());
    }

    function getRawLinkText() {
        return linkTextField.val();
    }

    /**
     * Sets the link text in the link text field only if the field is empty
     * or has the default alias class (signifying that the text currently in the field
     * was generated from the link details and is not user-specified).
     * @param text The text to display in the link text field
     */
    function setLinkText(text) {
        if ((getLinkText() == "") || linkTextField.hasClass(defaultAliasClass)) {
            linkTextField.addClass(defaultAliasClass);
            linkTextField.val(text);
        }
    }

    /**
     * Sets the link text from a link object. Uses the data-linked-resource-default-alias if
     * available, otherwise defaults to the body html.
     */
    function setLinkTextFromLink(linkObj) {
        var alias = linkObj.attrs["data-linked-resource-default-alias"] || linkObj.getHtml();
        setLinkText(alias);
    }

    /**
     * Returns the name of the image being linked.
     */
    function getLinkImageName() {
        return linkImageName.text();
    }

    /**
     * Updates the link body fields to reflect current link body information. Sets and toggles
     * the link text, link image or link mixed content as appropriate.
     *
     * @param body - a body object
     */
    function setLinkBody(body) {
        // Don't modify the link body if the original selection should persist.
        if (finalBody) return;

        if (body.isEditable) {
            linkTextField.val(body.text);
        }
        else if (body.isImage) {
            linkImageName.text(body.imgName);
        }
        else {
            linkMixedContent.text(body.text);
        }

        finalBody = body.isEditable ? null : body;

        linkTextRow.toggleClass('hidden',  !body.isEditable);
        linkImageRow.toggleClass('hidden', !body.isImage);
        linkMixedRow.toggleClass('hidden', body.isEditable || body.isImage);
    }

    /**
     * If true, show the Breadcrumbs element, else hide it. After the element is shown/hidden, resize the location
     * container by setting a CSS class.
     *
     * @param show true if breadcrumbs should be displayed
     */
    function showBreadcrumbsElement(show) {
        breadcrumbsEl.closest('.row').toggleClass('hidden', !show);
        container.toggleClass('has-breadcrumbs', !!show);       // must pass a boolean to toggleClass to force!
    }

    function hasBreadcrumbs(crumbTexts) {
        if (!breadcrumbsEl.is(':visible')) {
            return false;
        }

        var numCrumbs = crumbTexts.length;
        var crumbItems = breadcrumbsEl.find('li');
        if (crumbItems.length != numCrumbs) {
            return false;
        }

        for (var i = 0; i < numCrumbs; i++) {
            if (crumbItems.eq(i).text() != crumbTexts[i]) {
                return false;
            }
        }

        return true;
    }

    /**
     * Updates the breadcrumbs for the passed Link object, retrieving breadcrumb data from the back end and display
     * it.
     */
    function updateBreadcrumbs(linkObj) {
        var controls = {
            clearErrors: function () {
                // do nothing - errors will appear in the breadcrumbs element
            },
            error: function (errMsg) {
                // do nothing - errors will appear in the breadcrumbs element
            },

            // called when a destination is selected on one of the panels
            select: function (options) {
                breadcrumbController.update(options, controls);
            }
        };

        var options = {
            id: linkObj.getResourceId(),
            type: linkObj.getResourceType()
        };
        breadcrumbController.update(options, controls);
    }

    /**
     * Updates the link destination in the Location panel of the Link Browser.
     *
     * @param linkObj a linkable ContentEntity with an id and title, or some other object with an href property
     * @param showBreadcrumbs
     */
    function setLink(linkObj, showBreadcrumbs) {
        AJS.debug("Link Browser: setting link : " + linkObj);

        setLinkTextFromLink(linkObj);

        showBreadcrumbs && updateBreadcrumbs(linkObj);
        // Show/hide breadcrumbs element immediately (before any potential AJAX requests). This allows the breadcrumb
        // controller to show loading messages.
        showBreadcrumbsElement(showBreadcrumbs);

        currentLink = linkObj;
        lbController.linkValid(currentLink && currentLink.isHrefValid());
    }

    /**
     * Returns the link object currently stored in the panel.
     */
    function getLink() {
        if (!currentLink) return null;

        var body = finalBody;
        if (!body) {
            // Not an image/mixed content link. Perhaps there is alias text entered in the field?
            var linkText = getLinkText();
            if (!linkText) {
                // If there is no link text, use a defaultAlias in the case of internal Confluence
                // links, or the href for an external link.
                linkText = currentLink.getDefaultAlias() || currentLink.getHref();
            }
            body = {
                html: linkText
            }
        }
        currentLink.body = body;

        return currentLink;
    }

    /**
     * Puts the cursor in the 'Link Text' field, selecting the current text. Returns true on success, else false.
     */
    function focusLinkText() {
        if (isLinkTextVisible()) {
            AJS.debug('LinkInfoPresenter.focusLinkText focusing alias');
            linkTextField.select();
            return true;
        }
        return false;
    }

    function isLinkTextVisible() {
        return linkTextField.is(':visible');
    }

    function isLinkImageVisible() {
        return linkImageName.is(':visible');
    }

    function isLinkMixedContentVisible() {
        return linkMixedContent.is(':visible');
    }

    /**
     * Called when the Link Browser tab is changed, has the location panel refresh itself based on required size
     * and whether breadcrumbs should be shown.
     */
    function refresh(tabShowsBreadcrumbs) {
        currentLink && showBreadcrumbsElement(tabShowsBreadcrumbs);
    }

    /**
     * Returns the container with the Location elements.
     */
    function getContainer() {
        return container;
    }

    /**
     * Moves the location panel to be the last element inside the new parent. Used for styling.
     * @param newParent
     */
    function moveLocationPanel(newParent) {
        if (!movedPanel) {
            movedPanel = container.find('.row:not(.hidden) .field-group');
            movedPanelParent = movedPanel.parent();
        }
        newParent.append(movedPanel);
        container.hide();
    }

    /**
     * Moves the location panel back to its normal position
     */
    function restoreLocationPanel() {
        if (!movedPanelParent) {
            // Due to AJS.Dialog selection weirdness, the Web Link may be deselected when the Search panel is
            // selected *before* the Link Browser opens. Just ignore it, it doesn't matter.
            return;
        }
        // Put the location panel back where it was.
        movedPanelParent.append(movedPanel);
        container.show();

        movedPanel = null;
        movedPanelParent = null;
    }

    return {
        setLink: setLink,
        getLink: getLink,
        refresh: refresh,
        setLinkBody: setLinkBody,
        getContainer: getContainer,
        isLinkTextVisible: isLinkTextVisible,
        isLinkImageVisible: isLinkImageVisible,
        isLinkMixedContentVisible: isLinkMixedContentVisible,
        focusLinkText: focusLinkText,
        getLinkText: getLinkText,
        getRawLinkText: getRawLinkText,
        getLinkImageName: getLinkImageName,
        moveLocationPanel: moveLocationPanel,
        restoreLocationPanel: restoreLocationPanel,
        hasBreadcrumbs: hasBreadcrumbs
    };
};
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-search.js' */
// :focus selector is added in jQuery 1.6
if (typeof jQuery.expr[':'].focus === 'undefined') {
    jQuery.expr[':'].focus = function ( elem ) {
        return elem === document.activeElement && ( elem.type || elem.href );
    };
}

(function($) {
// The Search tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var searchTextField,
        searchSpaceField,
        resultGrid,
        messageHandler,
        key = 'search',
        restSearchUrl = AJS.REST.getBaseUrl() + "search.json";

    var setLink = function (linkObj, updateSearchField) {
        if (!Confluence.Link.isLink(linkObj)) {
            linkObj = Confluence.Link.fromREST(linkObj);
        }
        updateSearchField && searchTextField.val(linkObj.attrs['data-linked-resource-default-alias']);
        linkBrowser.setLink(linkObj, true);
        linkBrowser.focusLinkText();
    };

    // Perform a search on the passed text
    var doSearch = function (callback) {
        AJS.debug("link-browser-tab-search.js: doing search");

        searchTextField.trigger('hide.autocomplete');
        var searchText = $.trim(searchTextField.val());

        if (searchText) {
            resultGrid.loading();

            AJS.getJSONWrap({
                url: restSearchUrl,
                data: {
                    search: 'site',
                    query: searchText,
                    spaceKey: searchSpaceField.val()
                },
                successCallback: function (data) {
                    if ($.isFunction(callback)) {
                        resultGrid.update(data.result);
                        callback();
                    } else {
                        resultGrid.updateAndSelect(data.result);
                    }

                    // If the autocomplete result has appeared, hide it.
                    searchTextField.trigger('hide.autocomplete');
                },
                messageHandler: messageHandler
            });
        } else {
            $.isFunction(callback) && callback();
        }
    };

    linkBrowser.tabs[key] = {

        hasBreadcrumbs: true,

        createPanel: function (context) {

            var $panel = context.baseElement;
            searchTextField = $panel.find("#link-search-text");
            searchSpaceField = $panel.find("#search-panel-space");

            // Space may have changed since page load if page has been moved.
            var currentLocation = Confluence.PageLocation.get();
            searchSpaceField.find("option:eq(1)").text(currentLocation.spaceName).val(currentLocation.spaceKey);

            searchSpaceField.change(function () {
                // When the space changes update the attribute on the autocomplete field so it can re-loaded when the
                // field gets focus.
                searchTextField.attr('data-spacekey', searchSpaceField.val());
                searchTextField.trigger('clearCache.autocomplete');
            });

            Confluence.Binder.autocompleteSearch(searchTextField.parent());

            searchTextField.bind("selected.autocomplete-content", function (e, data) {
                // If the user selects the "Search for" link from the autocomplete, perform the search.
                if (data.searchFor) {
                    doSearch();
                } else {
                    resultGrid.clear();
                    setLink(data.content, false);
                }
            });

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "Title",
                    getHref: function (rowData) {
                        return AJS.REST.findLink(rowData.link);
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass || ('content-type-' + rowData.type);
                    }
                }),

                // Space column
                AJS.SelectGrid.Column({
                    key: 'space',
                    heading: "Space",
                    getText: function (rowData) {
                        return rowData.space && rowData.space.title || '';
                    }
                }),

                // Last Modified column
                AJS.SelectGrid.Column({
                    key: 'last-modified',
                    heading: "Last Modified",
                    getText: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.friendly || '';
                    },
                    getTitle: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.date || '';
                    }
                })
            ];

            messageHandler = AJS.MessageHandler({
                baseElement: context.baseElement.find('.message-panel')
            });

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,

                // Called when a row of the search results is selected by mouse or keyboard.
                selectionCallback: function (rowElement, data) {
                    setLink(data);
                },

                noResultMessage: "No search results found.",

                // Disable the up/down keys of the grid when the search field or space select have the focus
                dontShiftFocus: function () {
                    return $(searchTextField).add(searchSpaceField).is(':focus');
                }
            });

            // Performs the search when the form at the top of the panel is submitted.
            // The form may be submitted by the user clicking the Search button or pressing
            // 'Enter' in one of the form components.
            $panel.find('.search-form').submit(function () {
                doSearch();
                return false;
            }).keydown(function (e) {
                if (e.keyCode === 13) {
                    // If the search autocomplete has a dropdown visible with an item selected we should let it handle
                    // the Enter - if nothing is selected we should close the dropdown and do the search.
                    var dropdownWithSelection = $('.aui-dropdown:visible .active', this).length;
                    if (!dropdownWithSelection) {
                        $("#search-panel-button").focus();
                        e.stopPropagation();     // Don't let the dialog try to Submit itself when it catches the enter.
                    }
                }
            });
        },

        onSelect: function () {
            AJS.debug('Link Browser Search panel selected');

            var openedLink = this.openedLink;
            if (openedLink) {
                AJS.debug('Link Browser Search panel setting link info');
                setLink(openedLink, true);
            } else {
                searchTextField.focus();
            }
        },

        // The Search panel handles links that have a Confluence resource id, unless they're attachment links on the
        // same page or links with anchors.
        handlesLink: function (linkObj) {
            return linkObj.isCustomAtlassianContentLink() && !linkObj.hasAnchor() && !linkObj.isToAttachmentOnSamePage(AJS.Meta.get('content-id'));
        },

        /*
         * Perform the search by setting the search field value and reproducing a search-form submit.
         *
         * @param searchText - the text to set in the search field and search on
         * @param callback (optional) - a function to call after the search results have been populated
         */
        doSearch: function (searchText, callback) {
            searchTextField.val(searchText);
            doSearch(callback);
        },

        isResultGridVisible: function() {
            return resultGrid.isVisible();
        },

        getSearchTextField: function () {
            return searchTextField;
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-history.js' */
(function($) {
// The History tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    /**
        Link Dialog tab object is a method that initializes the tab and returns an object
        with these methods:
            1. onSelect - code that should run every time the panel is selected
            2. getLinkDetails - returns the current link represented by this panel's state
        The init method takes the following arguments:
            a. linkDialog - the JS link dialog controller
    */
    var restSearchUrl = AJS.REST.makeUrl('session/history.json?max-results=20'),
        resultGrid,
        messageHandler,
        key = 'recentlyviewed';

    linkBrowser.tabs[key] = {

        createPanel: function (context, getOverrideController) {

            var rowSelected = function (rowElement, data) {
                var linkObj = Confluence.Link.fromREST(data);
                linkBrowser.setLink(linkObj);
                linkBrowser.focusLinkText();
            };

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "Title",
                    getHref: function (rowData) {
                        return AJS.REST.findLink(rowData.link);
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass || ('content-type-' + rowData.type);
                    }
                }),
                // Space column
                AJS.SelectGrid.Column({
                    key: 'space',
                    heading: "Space",
                    getText: function (rowData) {
                        return rowData.space && rowData.space.title || '';
                    }
                }),

                // Last Modified column
                AJS.SelectGrid.Column({
                    key: 'last-modified',
                    heading: "Last Modified",
                    getText: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.friendly || '';
                    },
                    getTitle: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.date || '';
                    }
                })
            ];
            var getRowId = function (rowData) {
                return rowData.attachmentId;
            };

            messageHandler = AJS.MessageHandler({
                baseElement: context.baseElement.find('.message-panel')
            });

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,
                getRowId: getRowId,
                selectionCallback: rowSelected,
                messageHandler: messageHandler,
                noResultMessage: "You have no recently viewed content."
            });
        },

        // The History list is refreshed each time the user selects the "Recently Viewed" tab
        onSelect: function () {
            resultGrid.loading();

            AJS.getJSONWrap({
                url: restSearchUrl,
                messageHandler: messageHandler,
                successCallback: function (data) {
                    resultGrid.update(data.content);
                    AJS.trigger('updated.link-browser-recently-viewed');
                }
            });
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-attachment.js' */
(function($) {
// Not supported for templates
if(AJS.Meta.get("content-type") === "template")
    return;

AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var restUrl = AJS.REST.makeUrl("content/" + AJS.Meta.get('attachment-source-content-id') + "/attachments.json"),
        key = 'attachments',
        controller,
        uploaderController,
        messageHandler,
        resultGrid;

    // Returns the controller for this panel
    var getController = function (context, getOverrideController) {

        var uploadForm = context.baseElement.find('.attach-file-form');

        return $.extend({
                getUploaderController: function () {
                    var uploaderContext = {
                        baseElement: uploadForm
                    },
                    uploaderControllerOverride = function (context) {
                        return {
                            onUploadSuccess: function (attachmentsAdded) {
                                // Jsonated object properties should match REST ones.
                                for (var i = 0, len = attachmentsAdded.length; i < len; i++) {
                                    attachmentsAdded[i].type = 'attachment';
                                }
                                resultGrid.prependAndSelect(attachmentsAdded);
                                AJS.Meta.set("num-attachments", $("#attachments-table").find("tr[data-id]").length);
                                $("#rte-button-attachments").trigger("updateLabel");
                            }
                        };
                    };
                    return Confluence.AttachmentUploader(uploaderContext, uploaderControllerOverride);
                }
            },
            getOverrideController && getOverrideController(context)
        );
    };

    linkBrowser.tabs[key] = {
        hasBreadcrumbs: false,

        // Called by the main Link Browser controller on startup to initialize the by-now-existing panel DOM
        // element.
        createPanel: function (context, getOverrideController) {

            var tab = this;

            controller = getController(context, getOverrideController);
            uploaderController = controller.getUploaderController(context);
            messageHandler = uploaderController.getMessageHandler();

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "Name",
                    getHref: function (rowData) {
                        if (rowData.link) {
                            // REST object returned by attachment search
                            return AJS.REST.findLink(rowData.link);
                        }
                        // JSON returned by upload attachment action
                        return rowData.url;
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass;
                    }
                }),
                // Size column
                AJS.SelectGrid.Column({
                    key: 'size',
                    heading: "Size",
                    getText: function (rowData) {
                        return rowData.niceFileSize;
                    }
                }),

                // Comment column
                AJS.SelectGrid.Column({
                    key: 'comment',
                    heading: "Comment"
                })
            ];

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,

                selectionCallback: function (rowElement, data) {
                    var linkObj = Confluence.Link.fromREST(data);
                    // The attachment will be on the same page so set the data-linked-resource-container-id.
                    linkObj.attrs["data-linked-resource-container-id"] = AJS.Meta.get('content-id');

                    // Need to check that the href leads to the download path for the attachment.
                    if (AJS.$.isArray(data.link)) {
                        for (var i=0,ii=data.link.length; i<ii; i++) {
                            var link = data.link[i];
                               if (link.rel == "download") {
                                   linkObj.attrs.href= link.href;
                               }
                            }
                        }
                    linkBrowser.setLink(linkObj);
                    linkBrowser.focusLinkText();
                },
                noResultMessage: "There are no attachments on this page."
            });
        },

        // When the Attachment tab is selected the current attachments are refreshed.
        onSelect: function () {
            // Store a ref in scope to last across the AJAX request - the tab.openedLink ref is dropped by the
            // main controller after the tab.select() call is made.
            var openedLink = this.openedLink,
                selectedLink = linkBrowser.getLink();

            resultGrid.loading();
            AJS.getJSONWrap({
                url: restUrl,
                messageHandler: messageHandler,
                successCallback: function (data) {

                    resultGrid.update(data.attachment);

                    if (selectedLink) {
                       if (selectedLink.getResourceType() == "attachment") {
                           resultGrid.select(selectedLink.getResourceId());
                       }
                    } else if (openedLink) {
                        // If this panel has been opened automatically to edit an existing attachment link,
                        // select that link.
                        resultGrid.select(openedLink.getResourceId());
                    } else if (data.attachment.length) {
                        resultGrid.select(data.attachment[0].id);
                    }
                    AJS.debug('Loaded attachments');
                }
            });
        },

        // The Attachment panel opens existing links for attachments that are on the current page or blogpost.
        handlesLink: function (linkObj) {
            return linkObj.isToAttachmentOnSamePage(AJS.Meta.get('content-id'));
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-weblink.js' */
(function($) {
// The Web Link tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var urlField,
        key = 'weblink',
        thisPanel,
        tab,
        protocolDelimRegex= new RegExp('[:/]');

    function getURL() {
        return $.trim(urlField.val());
    }

    // Checks that the URL has a protocol, fixes if it can.
    function fixUrl() {
        var url = getURL();
        if (AJS.Validate.url(url) || url.indexOf('mailto:') == 0) {
            // A complete URL - leave it alone
            return;
        }
        // If the URL is not an absolute URL it might be a http URL missing the http or a mailto: missing the mailto.
        var defaultAlias = url;
        if (AJS.Validate.email(url)) {
            // Email link is missing mailto - add it
            url = 'mailto:' + url;
        }
        else if (!protocolDelimRegex.test(url)) {
            // *Probably* just a web address like 'www.atlassian.com' that needs an http:// prefix
            url = 'http://' + url;
        } else {
            // Not a valid URL that we know of - might have deleted half of the protocol or something... as they wish!
            return;
        }

        AJS.debug('Updating Link Browser Web Link URL to: ' + url);
        urlField.val(url);

        // Pass the original URL as the title so that the alias can be set to the non-prefixed URL if it
        // isn't already set.
        var linkObj = Confluence.Link.makeExternalLink(url);
        linkBrowser.setLink(linkObj);
    }

    tab = linkBrowser.tabs[key] = {

        createPanel: function (context) {
            thisPanel = context.baseElement;
            urlField = thisPanel.find("input[name='destination']");
            urlField.keyup(function (e) {
                var url = getURL();
                var linkObj = url ? Confluence.Link.makeExternalLink(url) : null;
                if (linkObj) {
                    linkBrowser.setLink(linkObj); // will enable the Submit button when a URL is added
                }
            });

            urlField.change(fixUrl);
            urlField.bind('paste', function () {
                AJS.debug('Link Browser web link url pasted');
                // CONF-22287 - use setTimeout to wait for the paste event to update the field value
                setTimeout(fixUrl, 0);
            });
        },

        // Called when the panel is selected - may be called before the LB dialog has its 'show' method called
        onSelect: function () {
            // Put the location panel inside the web-link panel for easier styling.
            linkBrowser.moveLocationPanel(thisPanel.find("form"));

            if (this.openedLink) {
                tab.setURL(this.openedLink.attrs.href);
                linkBrowser.setLink(this.openedLink);
            }

            // Defer focus to after LB is shown, gets around AJS.Dialog tabindex issues
            setTimeout(function() {
                urlField.focus();
            });
        },

        onDeselect: linkBrowser.restoreLocationPanel,

        // Called when the submit button is clicked, before the location is retrieved from the Location controller.
        // Re-validate and prefix the URL.
        preSubmit: fixUrl,

        // The Web link panel handles non Confluence links
        handlesLink: function (linkObj) {
            return !linkObj.isCustomAtlassianContentLink();
        },

        setURL: function (url) {
            urlField.val(url);
            urlField.keyup();
            urlField.change();
        },

        getURL: getURL
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-advanced.js' */
(function($) {

    // The Advanced tab registers itself when the Link Browser is created.
    AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

        var key = 'advanced',                   // This panel's key.
            linkFieldName = 'advanced-link',    // The ID of the link input element.
            errorFieldName = 'advanced-error',  // The ID of the error element.
            $linkField,                         // The jQueryfied link input element.
            $errorField,                        // The jQueryfied error field.
            thisPanel,                          // A reference to this panel.
            keyTimeout,                         // Used to tell when the user has stopped typing.


        /**
         * Triggered on a successful AJAX request.
         */
        successfulConversion = function (data, textStatus) {
            var $data = $(data);

            if (!$data.length) {
                return; // Do nothing if no data was returned.
            }

            // Use the first available link.
            var $link = $data.find("a:first");

            if (!$link.length) { // The markup wasn't link markup.
                $errorField.text("The markup provided is not valid link markup");
            } else if ($link.hasClass("unresolved")) {
                // If the link used an unspecified shortcut or unrecognised space, it will return with an unresolved class
                var shortcutKey = $link.attr("shortcut-key");
                var spaceKey = $link.attr("data-space-key");
                if (!!shortcutKey) {
                    $errorField.text(AJS.format("{0} is not a recognised shortcut", shortcutKey));
                } else if (!!spaceKey) {
                    $errorField.text(AJS.format("{0} is not a recognised space", spaceKey));
                }
            } else { // The link is valid.
                var linkObj = Confluence.Link.fromNode($link[0], $linkField.val());
                linkBrowser.setLink(linkObj);
            }
        },


        /**
         * Triggered on an unsuccessful AJAX request.
         */
        erroredConversion = function(XMLHttpRequest, textStatus, errorThrown) {
            AJS.debug("Error during conversion: textStatus = " + textStatus + ", errorThrown = " + errorThrown);
            $errorField.text("An internal server error occurred");
        },


        /**
         * Uses the wikixhtmlconverter REST API to convert the provided wikimarkup into XHTML.
         */
        convert = function(markup, successfulConversion, erroredConversion) {
            var conversionData = {
                wiki: markup,
                entityId: AJS.Meta.get("content-id"),
                spaceKey: AJS.Meta.get("space-key")
            };

            AJS.$.ajax({
                type : "POST",
                contentType : "application/json; charset=utf-8",
                url : AJS.params.contextPath + "/rest/tinymce/1/wikixhtmlconverter",
                data : AJS.$.toJSON(conversionData),
                dataType : "text", 
                success : successfulConversion,
                error : erroredConversion,
                timeout: 10000
            });
        },

        /**
         * Wraps the text currently in the link input field with square braces and sends
         * it to the convert() method.
         */
        parseLinkText = function () {
            var text = $linkField.val();
            convert("[" + text + "]", successfulConversion, erroredConversion);
        };

        // Define the available Link Browser Advanced tab methods.
        tab = linkBrowser.tabs[key] = {

            createPanel: function (context) {
                thisPanel = context.baseElement;
                $linkField = thisPanel.find("input[name='advanced-link']");
                $errorField = thisPanel.find("div[name='advanced-error']");
                thisPanel.find("form").keydown(function(e) {
                    if(e.keyCode == 13 && !linkBrowser.isSubmitButtonEnabled()) {
                        e.preventDefault();
                    }
                });
                $linkField.keyup(function (e) {
                    clearTimeout(keyTimeout);
                    $errorField.text('');

                    if (!!$linkField.val()) {
                        keyTimeout = setTimeout(function () {
                            parseLinkText();
                        }, 200);
                    }
                });
            },

            setLink: function (text) {
                $linkField.val(text);
                $linkField.keyup();
                $linkField.change();
            },

            getLink: function () {
                return $linkField.val();
            },

            // Called when the panel is selected
            onSelect: function () {
                linkBrowser.moveLocationPanel(thisPanel.find("form"));

                if (this.openedLink) {
                    if (this.openedLink.getResourceId()) { //anchor to external page.
                        tab.setLink(this.openedLink.getDefaultAlias());
                    }
                    else { //anchor in the same page.
                        tab.setLink('#' + this.openedLink.getAnchor());
                    }
                    linkBrowser.setLink(this.openedLink);
                }
                // Defer focus to after LB is shown, gets around AJS.Dialog tabindex issues
                setTimeout(function() {
                    $linkField.focus();
                });
            },

            // Called when this panel is no longer selected
            onDeselect: function () {
                linkBrowser.restoreLocationPanel();
            },

            handlesLink: function (linkObj) {
                return linkObj.hasAnchor();
            }
        };
    });

})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'templates/link-browser.soy' */
// This file was automatically generated from link-browser.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.LinkBrowser == 'undefined') { Confluence.Templates.LinkBrowser = {}; }


Confluence.Templates.LinkBrowser.searchPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui search-form" onsubmit="return false;"><fieldset class="inline"><div class="search-input"><label for="link-search-text" id="linkSearch-label" class="assistive">', soy.$$escapeHtml("Search"), '</label><input id="link-search-text" type="text" tabindex="0" class="text autocomplete-search" name="linkSearch" autocomplete="off" data-search-link-message="', soy.$$escapeHtml("Search for \x26lsquo;{0}\x26rsquo;"), '"></div><select tabindex="0" class="search-space select" id="search-panel-space"><option value="">', soy.$$escapeHtml("All spaces"), '</option><option value=""> </option></select><button type="submit" tabindex="0" class="aui-button" id="search-panel-button">', soy.$$escapeHtml("Search"), '</button></fieldset></form><div class="message-panel hidden"></div><div id="search-results-table" class="data-table hidden"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.recentlyviewedPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="recently-viewed-panel"><div class="message-panel hidden"></div><div class="data-table"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.attachmentsPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="attach-file-form"><form method="post" enctype="multipart/form-data" id="attachments-attachfile-form" action="', soy.$$escapeHtml(""), '/pages/attachfile.action" class="aui"><p>', soy.$$escapeHtml("Link to a file that is attached to this page or attach a new one."), '</p><div class="upload-field field-group"><label for="file_0">', soy.$$escapeHtml("Upload file"), '</label> <input type="file" name="file_0" class="upfile" id="file_0"></div><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form><div class="upload-in-progress upload-field hidden">', soy.$$escapeHtml("Upload in progress\u2026"), '</div><div class="warning"><ul class="hidden message-panel"></ul></div></div><div class="message-panel hidden"></div><div id="attachments-table" class="attachment-list data-table"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.weblinkPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="field-group"><label id="destination-label" for="weblink-destination">', soy.$$escapeHtml("Address"), '</label><input type="text" tabindex="0" class="text" id="weblink-destination" name="destination"><div class="web-link-desc description">', soy.$$escapeHtml("Web, email or any other internet address"), '</div></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.advancedPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="advanced-desc title">', AJS.format("Here you can insert a link into the page using \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3ewiki markup\x3c/a\x3e.","http://docs.atlassian.com/confluence/docs-54/Working+with+Links"), '</div><div class="field-group"><label id="advanced-label" for="advanced-link">', soy.$$escapeHtml("Link"), '</label><input type="text" tabindex="0" class="text" id="advanced-link" name="advanced-link"><div class="advanced-desc description">', soy.$$escapeHtml("To insert a link to a new page, type in the desired page title."), '<br/>', soy.$$escapeHtml("To insert an anchor link, type #anchorname."), '</div><div name="advanced-error" class="advanced-error error"></div></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.locationPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="link-browser-location" class="location-info"><form class="aui"><div class="row hidden field-group"><label class="link-location-label" for="breadcrumbs-link">', soy.$$escapeHtml("Link location"), '</label><div class="breadcrumbs-container" id="breadcrumbs-link"><div class="breadcrumbs-line"><ol id="breadcrumbs-container" class="breadcrumbs"></ol></div></div></div></form><div class="row link-text"><form class="aui" onsubmit="return false;"><div class="field-group"><label for="alias" id="alias-label">', soy.$$escapeHtml("Link text"), '</label><input type="text" tabindex="0" class="text" name="alias" id="alias"></div></form></div><div class="row link-image hidden"><div class="readonly"><label for="link-image-filename">', soy.$$escapeHtml("Link image"), '</label><span id="link-image-filename" class="content-type-attachment-image"></span></div></div><div class="row link-mixed hidden"><div class="readonly"><label for="link-mixed-content">', soy.$$escapeHtml("Link text"), '</label><span id="link-mixed-content"></span></div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dialog-help-link"><a href="', soy.$$escapeHtml("http://docs.atlassian.com/confluence/docs-54/Working+with+Links"), '" target="_blank">', soy.$$escapeHtml("Help"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-editor-resources', location = 'tinymce/editor_plugin_src.js' */
// Register TinyMCE plugin

AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(settings) {
    settings.plugins += ",linkbrowser";
    settings.theme_advanced_buttons1 += ",linkbrowserButton";
});

tinymce.create('tinymce.plugins.LinkBrowser', {
    init : function(ed) {
        var LinkBrowser = Confluence.Editor.LinkBrowser;
        ed.addButton("linkbrowserButton", {title: "confluence.conflink_desc", cmd: "mceConflink", "class": "mce_conflink" });

        ed.addCommand('mceConflink', LinkBrowser.open);
        ed.addCommand('mceConfAttachments', function () {
            return LinkBrowser.open({
                panelKey: LinkBrowser.ATTACHMENTS_PANEL
            });
        }); // attachments item in insert menu
    },
    getInfo : function () {
        return {
            longname : "Confluence Link Browser",
            author : "Atlassian",
            authorurl : "http://www.atlassian.com",
            version : tinymce.majorVersion + "." + tinymce.minorVersion
        };
    }
});

tinymce.PluginManager.add('linkbrowser', tinymce.plugins.LinkBrowser);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:editor-autocomplete-mentions', location = 'js/editor_plugin_src.js' */
(function(b){AJS.EventQueue=AJS.EventQueue||[];function c(){AJS.EventQueue.push({name:"confluencementioninsert"});Confluence.Editor.Autocompleter.Manager.shortcutFired("@",true)}function a(d){return d&&d.shiftKey&&!d.ctrlKey&&!d.altKey&&!d.altGraphKey&&!d.metaKey&&d.which===64}tinymce.create("tinymce.plugins.InsertMention",{init:function(d){b("#insertmention-button").click(function(e){e.stopPropagation();e.preventDefault();var f=Confluence.Editor.Autocompleter.Manager.getInputDrivenDropdown();if(!f||f.inactive){tinymce.execCommand("mceFocus",false,d.id);c()}});AJS.bind("editor.text-placeholder.activated",function(g,f){if(f&&f.placeholderType==="mention"){if(a(f.triggerEvent)){tinymce.dom.Event.cancel(f.triggerEvent)}c()}});if(AJS.Rte.Placeholder&&AJS.Rte.Placeholder.addPlaceholderType){AJS.Rte.Placeholder.addPlaceholderType({type:"mention",label:"User mention",tooltip:"Instructional text is replaced with suggested people when a person types."})}},getInfo:function(){return{longname:"Insert Mention",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("insertmention",tinymce.plugins.InsertMention)})(AJS.$);AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(a){a.plugins+=",insertmention"});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:editor-autocomplete-mentions', location = 'js/tinyMce-autocomplete-settings-mentions.js' */
AJS.Rte.BootstrapManager.addOnInitCallback(function(){if(!Confluence.Editor.Autocompleter){Confluence.Editor.Autocompleter=tinymce.confluence.Autocompleter}var b=function(e){if(e){return AJS.params.contextPath+"/rest/prototype/1/search.json"}else{if(AJS.Meta.get("remote-user")){return AJS.params.contextPath+"/rest/mentions/1/network.json"}}return null},c=function(g,f){var e={"max-results":g.maxResults||10};if(f){e.query=Confluence.unescapeEntities(f);e.search="user"}return e},a=function(m,f,l,h,g){var k=m.statusMessage;var i;if(k){i=[[{html:m.statusMessage,className:"error"}]]}else{var e=[];i=[e];if(m.result){AJS.$.each(m.result,function(n,p){var o=AJS.$.extend({},p);o.key=o.username;o.linkAlias=o.title;o.title=o.title+" ("+o.username+")";e.push(o)})}i=AJS.REST.convertFromRest(i)}function j(o,n){if(g&&typeof g=="function"){g(i,o,n)}}l(i,f,j)},d=function(g,i,m,f,l,o,j){var e=i(f),k=g.settings.cacheManager,h=k.get(f),n;if(e){n=$.ajax({type:"GET",url:e,data:m(g,f),dataType:"json",global:false,timeout:10000});n.done(function(p){k.put(f,p)});if(h){a(h,f,l,o,j)}else{n.done(function(p){a(p,f,l,o,j)});n.fail(function(q,p){if(p=="timeout"){a({statusMessage:"Timeout",query:f},f,l,o)}})}}else{l([],f)}};Confluence.Editor.Autocompleter.Settings["@"]={ch:"@",endChars:[],dropDownClassName:"autocomplete-mentions",selectFirstItem:true,getHeaderText:function(f,e){if(e){return "User suggestions"}else{return "Mention someone by typing their name..."}},getAdditionalLinks:function(h,f,g){var e=[];g(f,e);return e},getDataAndRunCallback:function(g,e,f){d(g,b,c,e,f,"content",function(h,j,i){if(j!==""&&h.length<2){if(i.length==0){i.push({html:'<span class="no-result">'+"No user found"+"</span>"})}}else{i.length=0}})},update:function(g,e){if(e.restObj){var f=AJS.$.extend(e.restObj,{title:e.restObj.linkAlias});e=Confluence.Link.fromREST(f)}e.insert()}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/editor.js' */
AJS.toInit(function(d){var g;var c=/^\w+:\/\/[^\/?#]+/.exec(location.href);var a=function(h){var k=document.getElementById("fileuploadShim"),i=false;if(!k){k=document.createElement("div");k.setAttribute("id","fileuploadShim");document.body.appendChild(k)}if(jQuery.browser.mozilla&&jQuery.browser.version.indexOf("1.9.2")>-1){h.addEventListener("drop",function(l){l.stopPropagation()},false)}var j=new plupload.Uploader({runtimes:"html5",dragdrop:true,drop_element:h,browse_button:k.getAttribute("id"),multipart:false,max_file_size:+AJS.Meta.get("global-settings-attachment-max-size")});if(!g){g=new AJS.DragAndDropProgressDialog()}j.init();j.bind("FilesAdded",function(l,p){for(var n=0,o=p.length;n<o;n++){var m=p[n];if(m.status!==plupload.FAILED){g.render({workId:m.id,status:m.status,file:m})}}j.start()});j.bind("BeforeUpload",function(l,o){if(AJS.Meta.get("content-type")==="template"){l.stop();f();return}var n=c+Confluence.getContextPath()+"/plugins/drag-and-drop/upload.action";var r={};var m=AJS.Meta.get("page-id");if(m){r.pageId=m}var p=AJS.Meta.get("draft-id");if(m==0&&p>0){r.draftId=p}var q=AJS.Meta.get("drag-and-drop-entity-id");if(q){r.dragAndDropEntityId=q}var s=o.name.substr(o.name.lastIndexOf(".")+1);r.filename=o.name;r.size=o.size;r.spaceKey=AJS.Meta.get("space-key")||"";r.mimeType=plupload.mimeTypes[s.toLowerCase()]||"application/x-upload-data";r.atl_token=AJS.Meta.get("atl-token");l.settings.url=plupload.buildUrl(n,r);g.cancelListeners.push(function(v,t){var u=l.getFile(t.workId);u&&l.removeFile(u);g.renderInfo(t.workId,"File was manually removed from the queue.")});g.show()});j.bind("UploadProgress",function(l,m){g.renderUpdateToBytesUploaded(m.id,m.loaded,m.size);g.hideCloseButton()});d.browser.mozilla&&(function(){plupload.addEvent(h,"dragenter",function(l){if(l.rangeParent&&(l.rangeOffset!=undefined)){i={startElement:l.rangeParent,startOffset:l.rangeOffset}}else{i=false}})})();j.bind("FileUploaded",function(m,o,n){if(!n.status){g.renderError(o.id,"The server is not responding. Please check that it is running.")
}else{if(n.response){try{var l=AJS.$.parseJSON(n.response);if(i&&d(i.startElement.parentNode).closest('[contenteditable="true"]',h).length){tinymce.activeEditor.selection.setCursorLocation(i.startElement,i.startOffset)}AJS.Rte.getEditor().execCommand("mceInsertContent",false,l.htmlForEditor,{skip_focus:true})}catch(p){AJS.log("FileUploaded threw an exception "+p)}}AJS.Meta.set("num-attachments",+AJS.Meta.get("num-attachments")+1);d("#rte-button-attachments").trigger("updateLabel");g.renderComplete(o.id)}});j.bind("Error",function(m,n){var l,o;if(n.response){try{l=AJS.$.parseJSON(n.response);o=l.actionErrors[0]}catch(p){if(p.name==="SyntaxError"){o="Invalid response recieved from the server."}else{o=n.message}}g.renderError(n.file.id,o)}else{o=n.message;if(n.code==plupload.FILE_SIZE_ERROR){o=AJS.format("File of size {0} exceeds maximum upload limit of {1}",AJS.DragAndDropUtils.niceSize(n.file.size).toString(),AJS.DragAndDropUtils.niceSize(AJS.Meta.get("global-settings-attachment-max-size")).toString());g.render({workId:n.file.id,status:n.file.status,file:n.file,errorMessage:o});if(!g.isVisible()){g.show();g.showCloseButton()}}}});j.bind("UploadComplete",function(){if(!j.total.queued){j.stop();g.showCloseButton();if(!g.hasErrors()){setTimeout(function(){g.hide();g.clearRenderOutput();AJS.Rte.BookmarkManager.restoreBookmark()},1000)}}});AJS.Confluence.Uploader=j;AJS.Confluence.EditorUploadProgressDialog=g};function e(){var i=AJS.Rte.getEditor(),h=i.getBody().parentNode;AJS.DragAndDropUtils.init(function(j){if(j){a(h)}})}var b=false;function f(){if(b){return}var h=new AJS.Dialog(450,180);h.addHeader("Not Supported");h.addSubmit("Ok",function(){h.remove()});h.addPanel("Panel 1","panel1");h.getCurrentPanel().html("\u003cp>Attachments are not supported in Templates.\u003c\/p> \u003cp>Files may be attached to a Page, and added as an image via the Insert menu.\u003c\/p>");h.show();b=true}AJS.Rte.BootstrapManager.addOnInitCallback(e)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/image-dialog-client.js' */
AJS.toInit(function(g){var b=function(){this._workIdToBytesUploaded={};this._totalBytes=0},a=/^\w+:\/\/[^\/?#]+/.exec(location.href);b.prototype={update:function(l,k,j){if(!(l in this._workIdToBytesUploaded)){this._totalBytes+=j}this._workIdToBytesUploaded[l]=k},percentComplete:function(){var j=0;g.each(this._workIdToBytesUploaded,function(k,l){j+=l});return Math.round(j*100/this._totalBytes)}};var i=Confluence.Editor.ImageDialog.beforeShowListeners,c,e=[],f=new b(),d=Confluence.Editor.ImageDialog.findPanelComponentById("attachments");i&&i.push(function(){var j=g("#attached-images")[0];if(!j){return}if(DragnDropSupport.hasXhrSupport){h(j)}});var h=function(k){var l=document.getElementById("fileuploadShim");f;if(!l){l=document.createElement("div");l.setAttribute("id","fileuploadShim");document.body.appendChild(l)}document.body.appendChild(l);var j=new plupload.Uploader({runtimes:"html5",dragdrop:true,drop_element:k,browse_button:l.getAttribute("id"),multipart:false,stop_propagation:true});j.init();j.bind("FilesAdded",function(m,n){j.start()});j.bind("BeforeUpload",function(m,p){var o=a+Confluence.getContextPath()+"/plugins/drag-and-drop/upload.action";var n=AJS.Meta.get("page-id");var r=n!=0?{pageId:n}:{draftId:AJS.Meta.get("draft-id")},s=p.name.substr(p.name.lastIndexOf(".")+1);var q=AJS.Meta.get("drag-and-drop-entity-id");if(q){r.dragAndDropEntityId=q}r.filename=p.name;r.size=p.size;r.spaceKey=AJS.Meta.get("space-key")||"";r.mimeType=plupload.mimeTypes[s.toLowerCase()]||"application/x-upload-data";r.atl_token=AJS.Meta.get("atl-token");m.settings.url=plupload.buildUrl(o,r);e=[];f=new b()});j.bind("UploadProgress",function(m,n){f.update(n.id,n.loaded,n.size);d.setUploadInProgress(true,AJS.format("Image(s) uploading\u2026 {0}%",f.percentComplete().toString()))});j.bind("FileUploaded",function(m,o,n){o.name&&e.push(o.name)});j.bind("Error",function(n,o){var p;if(o.response){try{var m=AJS.$.parseJSON(o.response);p=m.actionErrors[0]}catch(q){p=o.message}}else{p=o.message
}d.displayErrors([p])});j.bind("UploadComplete",function(){d.setUploadInProgress(false);!!e.length&&d.refresh(e);e=[];f=new b()})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/link-dialog-drop-zone.js' */
AJS.toInit(function(a){AJS.bind("dialog-shown.link-browser",function(c,b){if(!a.browser.msie){AJS.DragAndDropUtils.bindDrop(a("#insert-link-dialog")[0],function(d){d.preventDefault();d.stopPropagation()})}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drop-zone-for-image-dialog', location = 'js/image-dialog-drop-zone.js' */
AJS.toInit(function(b){if(!AJS.DragAndDropUtils.hasXhrSupport){AJS.debug("Browser doesn't have XHR upload support. Skipping image dialog drop zone..");return}if(!(AJS.Meta.get("remote-user"))){AJS.debug("Skipping image attachment drop-zone for anonymous user creating new content");return}var a=Confluence.Editor.ImageDialog.findPanelComponentById("attachments");if(!a){AJS.log("Skipping image attachment drop-zone - no Image Dialog attachment panel");return}b(a).bind("afterThumbnail",function(d,c){if(c.find(".image-dialog-drop-zone-container").length){return}var f=b("<li/>").addClass("attached-image");var e=b("<div/>").addClass("image-dialog-drop-zone-container image-container");b("<div/>").addClass("drop-zone-image").attr("title","Drop files here to attach them").appendTo(e);b("<div/>").addClass("drop-zone-text").text("Drop Here").appendTo(e);e.appendTo(f);c.prepend(f);if(!b.browser.msie){AJS.DragAndDropUtils.bindDragEnter(e[0],function(){e.addClass("drop-zone-on-hover")});AJS.DragAndDropUtils.bindDragOver(e[0],function(){e.addClass("drop-zone-on-hover")});AJS.DragAndDropUtils.bindDragLeave(e[0],function(){e.removeClass("drop-zone-on-hover")})}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-manager.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    function caseInsensitiveLocalCompare(a, b) {
        var la = a.toLocaleLowerCase();
        var lb = b.toLocaleLowerCase();
        var r = la.localeCompare(lb);
        if(r == 0)
            r = a.localCompare(b);
        return r;
    }

    function defaultVariable(type) {
        var defaultVar = Confluence.VariableManager.defaults[type] || Confluence.VariableManager.defaults["string"];
        return $.extend(true, {}, defaultVar);
    }

    Confluence.VariableManager = function() {
        var variables = {};

        return {
            find : function(startName) {
                var search = startName.toLocaleLowerCase();
                var result = {};
                for(var k in variables) {
                    if(variables.hasOwnProperty(k)) {
                        if(!search.length || k.toLocaleLowerCase().indexOf(search) === 0) {
                            result[k] = variables[k];
                        }
                    }
                }
                return result;
            },

            contains: function(name) {
                return !!variables[name];
            },

            get : function(name) {
                return variables[name];
            },

            getAll : function() {
                return $.extend(true, {}, variables); // clone a copy
            },

            getSortedNames : function() {
                var names = [];
                for(var name in variables)
                    names.push(name);
                return names.sort(caseInsensitiveLocalCompare);
            },

            add : function(name, details) {
                variables[name] = details || defaultVariable();
                AJS.trigger('add.confluence-variable', {
                    name: name,
                    details :$.extend(true, {}, details)
                });
            },

            del : function(name) {
                var details = variables[name];
                delete variables[name];
                AJS.trigger('delete.confluence-variable', {
                    name: name,
                    details :$.extend(true, {}, details)
                });
            },

            rename : function(oldName, newName) {
                var old = variables[oldName];
                delete variables[oldName];
                if(old) {
                    variables[newName] = old;
                    AJS.trigger('rename.confluence-variable', {
                        oldName: oldName,
                        newName: newName,
                        details :$.extend(true, {}, details)
                    });
                }
            },

            createDefault: defaultVariable
        };
    }

    Confluence.VariableManager.defaultVariableManager = Confluence.VariableManager();
    Confluence.VariableManager.defaults =  {
        textarea: {
            type: "textarea",
            rows: 5,
            columns: 100
        },
        list: {
            type: "list",
            options: []
        },
        string: {
            type: "string"
        }
    }

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-placeholder.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    Confluence.VariablePlaceHolder = {
        insertPlaceholder : function(name) {
            var variable;
            var label = '$' + name;
            var ed = AJS.Rte.getEditor();
            AJS.Rte.BookmarkManager.storeBookmark();

            variable = $('<img/>').attr({
                title: label,
                src: AJS.Meta.get("context-path") + '/plugins/servlet/confluence/placeholder/template-variable?name=' + encodeURIComponent(name),
                'data-variable-name': name,
                'class': 'template-variable'
            });

            ed.selection.setNode(variable[0]);
        }
    };

    AJS.bind("init.rte", function() {
        // CONFDEV-9297 - prevent default browser drag behaviour for template variables.
        $(AJS.Rte.getEditor().getBody()).delegate('img.template-variable', 'dragstart', function(e) {
            e.preventDefault();
        });
    });
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-toolbar.js' */
(function($) {
    AJS.bind("init.rte", function() {
        if(AJS.Meta.get("content-type") !== "template") return;

        var variableManager = Confluence.VariableManager.defaultVariableManager;
        var menu = $('#template-menu');
        var variableList = menu.find('.variables-list');

        AJS.bind('add.confluence-variable,delete.confluence-variable,rename.confluence-variable', function(e, v) {
            // Simple implementation - just reload the div
            var variables = variableManager.getSortedNames();
            var len = variables.length;
            var items = "";
            variableList.toggleClass('hidden', !len);

            for(var i = 0; i < len; i++) {
                items += Confluence.Templates.Variables.renderVariableItem({
                    variableName : '$' + variables[i],
                    tooltip : AJS.format("Insert the \'\'{0}\'\' field into the page for the template user to fill out.", variables[i])
                });
            }

            variableList.html(items);
        });

        menu.delegate('.variables-list a', 'click', function() {
            var name = $(this).attr('data-variable-name');
            !variableManager.contains(name) && variableManager.add(name);
            Confluence.VariablePlaceHolder.insertPlaceholder(name);
        });

        menu.delegate('.variables-add', 'click', function(e) {
            var inputDrivenDropdown = Confluence.Editor.Autocompleter.Manager.getInputDrivenDropdown();
            AJS.Rte.getEditor().focus();
            if (!inputDrivenDropdown || inputDrivenDropdown.inactive) {
                Confluence.Editor.Autocompleter.Manager.shortcutFired("$", true);
            }
            e.stopPropagation();
        });

        AJS.$(document).bind("showLayer", function(event, type, dd) {
            if(type === "dropdown" && dd.$.closest(menu).length) {
                // is template menu drop down - reset to ensure hover highlights work
                dd.reset();
            }
        });
    });
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/tinyMce-autocomplete-settings-variables.js' */

/**
 * Settings that each Autocomplete will be initialized on, depending on the trigger character used to activate the
 * autocomplete.
 */
AJS.bind("init.rte", function() {

    if(AJS.Meta.get("content-type") !== "template") return;

    // Confluence 4.1.x uses tinymce.confluence, 4.2 onwards use Confluence.Editor
    if (!Confluence.Editor.Autocompleter) {
        Confluence.Editor.Autocompleter = tinymce.confluence.Autocompleter;
    }

    var variableManager = Confluence.VariableManager.defaultVariableManager;
    var autoComplete = Confluence.Editor.Autocompleter;

    function makeVariableDropdownItem(name, details) {
        var item = {
            callback: function(autoCompleteControl) {
                autoCompleteControl.replaceWithSelectedSearchText();
                createVariable(name);
            },
            name : AJS.escapeHtml(name),
            href : '#'
        };

        return item;
    };

    function createVariable(name) {
        !variableManager.contains(name) && variableManager.add(name);
        Confluence.VariablePlaceHolder.insertPlaceholder(name);
    }

    function ignoreCaseComparator(a, b) {
        if(!a && !b) return 0;
        if(!a) return -1;
        if(!b) return 1;

        return a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase());
    }

    // Link settings.
    Confluence.Editor.Autocompleter.Settings["$"] = {

        ch : "$",
        cache: false,
        endChars : [],
        dropDownDelay: 0, // No delay needed because there is no AJAX request involved
        preventStartNodes: "",

        dropDownClassName: "autocomplete-variables",
        selectFirstItem: true,

        getHeaderText : function (autoCompleteControl, value) {
            if (value)
            {
                return "Variable suggestions";
            }
            else
            {
                return "Variable suggestions";
            }
        },

        getAdditionalLinks : function (autoCompleteControl, value) {
            var unescapedValue = Confluence.unescapeEntities(value);
            if(variableManager.get(unescapedValue) || value.length == 0) {
                // Variable exists or has no value yet.
                return [];
            }
            return [
                {
                    className: "dropdown-create-variable",
                    href: '#',
                    callback: function(autoCompleteControl) {
                        var searchText = autoCompleteControl.plainText();
                        autoCompleteControl.replaceWithSelectedSearchText();
                        createVariable(searchText);
                    },
                    name : AJS.format("Create variable \'\'{0}\'\'", value)
                }
            ];
        },

        getDataAndRunCallback : function(autoCompleteControl, val, callback) {
            var k, i, l;
            var unescapedVal = Confluence.unescapeEntities(val);
            var variables = variableManager.find(unescapedVal);
            var sortedVariables = [];
            var dropdownItems = [];

            for(var k in variables) {
                if(variables.hasOwnProperty(k)) {
                    sortedVariables.push(k);
                }
            }
            sortedVariables.sort(ignoreCaseComparator);
            for(i = 0, l = sortedVariables.length; i < l; i++) {
                k = sortedVariables[i];
                dropdownItems.push(makeVariableDropdownItem(k, variables[k]));
            }
            callback([dropdownItems], val);
        },

        update : function(autoCompleteControl, link) {
        }
    }

});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/tinyMce-property-panel-variables.js' */
(function($) {
    AJS.Confluence.PropertyPanel.Variable = (function() {
        return {
            name : "variable",

            canHandleElement : function ($element) {
                return $element.hasClass("template-variable");
            },

            handle : function (data) {
                if (data.e.type != "click" && data.e.type != "mouseup") { // only activate this panel on click
                    return;
                }

                var variableNode = data.containerEl,
                    $variableNode = $(variableNode);

                var variableName, variableButtons = [];

                var buttons = [],
                    options = {
                        originalHeight : $variableNode.height(),
                        anchorIframe: AJS.Rte.getEditorFrame()
                    };

                variableName = $variableNode.attr("data-variable-name");

                var variableManager = Confluence.VariableManager.defaultVariableManager;
                var variable = variableManager.get(variableName);
                var variableType = (variable && variable.type) || "string";

                function changeType(type) {
                    variable = variableManager.createDefault(type);
                    variableManager.add(variableName, variable);
                    $('.variable-property-panel-type-item').removeClass('selected');
                    $('.variable-property-panel-type-' + type).addClass('selected');
                    refreshPanel(type);
                }

                function refreshPanel(type) {
                    AJS.log('clicked type: ' + type);
                    var pp = $('#property-panel');

                    pp.find('.panel-buttons').toggleClass('no-inputs', type === 'string');
                    pp.find('.textarea-section,.list-section,.string-section').addClass('hidden');
                    pp.find('.' + type + '-section').removeClass('hidden');
                    if(type === "textarea") {
                        $('#variable-property-panel-textarea-rows').val(variable.rows);
                        $('#variable-property-panel-textarea-columns').val(variable.columns);
                    } else if(type === "list") {
                        $('#variable-property-panel-list-values').val(variable.options.join(","));
                    }
                }

                function createTypeButton(type, text, tooltip) {
                    return {
                        className: "variable-property-panel-type-item variable-property-panel-type-" + type,
                        text: text,
                        tooltip: tooltip,
                        selected: variableType === type,
                        click: function() {
                            variable.type = type;
                            changeType(type);
                        }
                    };
                }

                function typeHiddenClass(type) {
                    return (variableType === type) ? "" : " hidden";
                }

                buttons.push(createTypeButton("string", "Text", "Single line text input field."));
                buttons.push(createTypeButton("textarea", "Multi-line Text", "Multi-line text input field."));
                buttons.push(createTypeButton("list", "List", "Drop down list."));
                buttons.push(null);
                buttons.push({
                    className: "editable textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "Number of rows to display for the field.",
                    html: "<input id=\"variable-property-panel-textarea-rows\"/>"
                });
                buttons.push({
                    className: "variable-property-panel-textarea-split textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "",
                    html: "<span>x</span>"
                });
                buttons.push({
                    className: "editable textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "Number of columns to display for the field.",
                    html: "<input id=\"variable-property-panel-textarea-columns\"/>"
                });
                buttons.push(null);
                buttons.push({
                    className: "editable list-section" + typeHiddenClass("list"),
                    tooltip: "Enter each item for the list, separating each with a comma.",
                    html: "<input id=\"variable-property-panel-list-values\" size='50'/>"
                });

                AJS.Confluence.PropertyPanel.createFromButtonModel("variable", variableNode, buttons, options);

                refreshPanel(variable.type);

                $('#variable-property-panel-textarea-rows').change(function() {
                    variable.rows = +$(this).val() || Confluence.VariableManager.defaults.textarea.rows;
                });
                $('#variable-property-panel-textarea-columns').change(function() {
                    variable.columns = +$(this).val() || Confluence.VariableManager.defaults.textarea.columns;
                });
                $('#variable-property-panel-list-values').change(function() {
                    var i, l, v;
                    var opts = $(this).val().split(',');
                    variable.options = [];
                    for(i = 0, l = opts.length; i < l; i++) {
                        // trim and filter empty values
                        v = $.trim(opts[i]);
                        v && variable.options.push(v);
                    }
                });
                $('#variable-property-panel-textarea-rows,#variable-property-panel-textarea-columns,#variable-property-panel-list-values').keypress(function(e) {
                    if(e.which === 13) {
                        $(this).blur();
                    }
                });
            }

        }})();
})(AJS.$);

AJS.bind("init.rte", function() {
    // defer trigger to ensure any listeners have had a chance to load.
    AJS.trigger("add-handler.property-panel", AJS.Confluence.PropertyPanel.Variable);
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-marshaller.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    var DEFAULT_ROWS = 5;
    var DEFAULT_COLUMNS = 100;

    function toVariable(li) {
        var type = li.attr('data-variable-type');
        if(type === "textarea") {
            return {
                type: type,
                rows: +li.attr('data-variable-rows') || DEFAULT_ROWS,
                columns: +li.attr('data-variable-columns') || DEFAULT_COLUMNS
            };
        } else if (type === "list") {
            return {
                type: type,
                options : li.find('li').map(function() { return $(this).attr('data-variable-option'); }).toArray()
            }
        }
        return {
            type: "string" // be explicit in case a bad / missing type
        };
    }

    function encodeVariable(name, details) {
        var optionsGroup, optionLi;
        var type = details.type;
        var li = AJS.$('<li></li>');
        li.attr('data-variable-name', name);
        li.attr('data-variable-type', type);
        li.text(name);
        if(type === "textarea") {
            li.attr('data-variable-rows', details.rows);
            li.attr('data-variable-columns', details.columns);
        } else if (type === "list") {
            optionsGroup = $('<ul></ul>');
            for(var option in details.options) {
                var val = details.options[option];
                optionLi = $('<li></li>').text(val).attr('data-variable-option', val);
                optionsGroup.append(optionLi);
            }
            li.append(optionsGroup);
        }
        return li;
    }

    function getUsedVariables() {
        var usages = $(AJS.Rte.getEditor().getBody()).find('img[data-variable-name]');
        var used = {};
        $.map(usages, function(el) {
            used[$(el).attr('data-variable-name')] = true;
        });
        return used;
    }

    AJS.bind("init.rte", function() {

        var ed = AJS.Rte.getEditor();
        var edBody = $(ed.getBody());
        var dGroup, dec;
        var varMgr = Confluence.VariableManager.defaultVariableManager;

        function addUndeclaredVariables(inUse) {
            for(var used in inUse) {
                if(inUse.hasOwnProperty(used)) {
                    if(!varMgr.contains(used)) {
                        AJS.log('adding: ', used);
                        varMgr.add(used);
                    }
                }
            }
        }

        ed.onGetContent.add(function(ed, o) {
            var variableDeclaration = $('<div></div>');
            var ul = $('<ul></ul>').attr('data-variable-declarations', 'true');
            var li;

            variableDeclaration.append(ul);

            var inUse = getUsedVariables();

            // Handle case of variables missing from variable manager (e.g. copy and paste)
            addUndeclaredVariables(inUse);

            var variables = varMgr.getAll();
            for(var variable in variables) {
                if(inUse.hasOwnProperty(variable)) {
                    li = encodeVariable(variable, variables[variable]);
                    ul.append(li);
                }
            }

            o.content = variableDeclaration.html() + o.content;
        });

        // Extract declared variables
        dGroup = edBody.find('ul[data-variable-declarations]');
        dGroup.remove();
        dec = dGroup.find('li[data-variable-name]');
        dec.each(function() {
            var el = $(this);
            varMgr.add(el.attr('data-variable-name'), toVariable(el));
        });
        // Cover case where there's undeclared variables (e.g. a blueprint missing some declarations)
        addUndeclaredVariables(getUsedVariables());
    });

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-template-resources', location = 'js/variable-templates.soy' */
// This file was automatically generated from variable-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Variables == 'undefined') { Confluence.Templates.Variables = {}; }


Confluence.Templates.Variables.renderVariableItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="dropdown-item" data-tooltip="', soy.$$escapeHtml(opt_data.tooltip), '"><a href="#" class="item-link variable-item" title="', soy.$$escapeHtml(opt_data.variableName), '" data-variable-name="', soy.$$escapeHtml(opt_data.variableName), '">', soy.$$escapeHtml(opt_data.variableName), '</a></li>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.image.effects.ImageEffectsPlugin:propertiespanel', location = 'com/atlassian/confluence/image/effects/property-panel.js' */
AJS.toInit(function(e){var p,i=/(\?|\&)(effects\=[^&]+)($|&)/,t=/(^|\&)(effects\=([^&]+))($|&)/,s=null,j=[],h=2000;q();if(Confluence.Editor.ImageProps){f()}else{l()}function f(){AJS.bind("dialog-created.image-properties",function(x,y){p=y.img;var z="image-effects",w="image-effects-panel";if(!a()){Confluence.Editor.ImageProps.registerPanel(z,c("Image effects can\'t be applied to web images"),w,null)}else{if(!n()){Confluence.Editor.ImageProps.registerPanel(z,c("The image\'s dimensions are too large to apply effects.\nThe width and height must be under 2000 pixels."),w,null)}else{Confluence.Editor.ImageProps.registerPanel("image-effects",c(),"image-effects-panel",r)}}});AJS.bind("dialog-before-show.image-properties",function(){b();o(m(e(p)))})}function l(){var w=new AJS.Dialog({width:600,height:500,id:"image-effects-dialog"});w.addHeader("Add Image Effect");w.addPanel("",c(),"");b();w.addSubmit("Save",function(){var x=v();x.done(function(){w.hide()})});w.addCancel("Close",function(){w.hide()});AJS.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(x){p=x[0];var z=m(x),y=!a();return{className:"image-effects",text:"Effects...",tooltip:y?"Image effects can\'t be applied to web images":"Add an image effect like drop shadow or picture frame",click:function(){if(!n()){alert("The image\'s dimensions are too large to apply effects.\nThe width and height must be under 2000 pixels.");return false}o(m(e(p)));AJS.Confluence.PropertyPanel.destroy();w.show()},disabled:y,selected:!!z}}})}function g(y,A){var B=y.attr("src");var x=i.exec(B);var w=A?"effects="+A:"";if(x){B=B.replace(x[2],w)}else{if(A){B=B+(B.indexOf("?")!=-1?"&":"?")+w}}y.attr("src",B);y.attr("data-mce-src",B);var z=y.attr("confluence-query-params");if(z){var x=t.exec(z);if(x){z=z.replace(x[2],w)}else{z=z+"&"+w}}else{z=w}y.attr("confluence-query-params",z)}function m(x){var y=x.attr("confluence-query-params");var w=t.exec(y);if(w){return w[3]}}function o(w){e(".image-effect-preview.selected").removeClass("selected");if(w){e(j).each(function(x,y){if(y.effects==w){e(e(".image-effect-preview")[x]).addClass("selected");return false}})}else{e(".image-effect-preview.image-effect-none").addClass("selected")}s=w}function q(){j.push({name:"None",effects:null});j.push({name:"Taped",effects:"border-simple,blur-border,tape"});j.push({name:"Instant Camera",effects:"border-polaroid,blur-border"});j.push({name:"Curl Shadow",effects:"border-simple,shadow-kn"});j.push({name:"Snapshot",effects:"border-simple,blur-border"});j.push({name:"Drop Shadow",effects:"drop-shadow"})}function c(w){if(w){return'<div class="aui-message warning"><span class="aui-icon icon-warning"></span>'+w+"</div>"}return'<div class="image-effects"><ul class="image-list"></ul></div>'}function b(){var x=e("div.image-effects ul.image-list");var z=Math.floor(Math.random()*22)+1;for(var y=0;y<j.length;y++){var w=e('<li class="attached-image image-effect-preview'+(!j[y].effects?" image-effect-none":"")+'"><div class="image-container"><img class="thumbnail" src="'+AJS.contextPath()+"/plugins/servlet/imgFilter.png?preview=true&id="+z+"&effects="+j[y].effects+'" title="'+j[y].name+'" style="margin-top: 5px"></div><span class="caption filename" title="'+j[y].name+'">'+j[y].name+"</span></li>");w.hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")});x.append(w);var A=j[y];w.click(A,function(B){e(".image-effect-preview.selected").removeClass("selected");e(this).addClass("selected");s=B.data.effects})}}function a(){return !e(p).hasClass("confluence-external-resource")}function n(){return !(p.naturalHeight&&p.naturalWidth&&(p.naturalHeight*p.naturalWidth)>(h*h))}function r(){return u()}function v(){return u(d,k)}function u(w,z){var y=e.Deferred();w&&w();p.onload=A;var x=p.src;g(e(p),s);if(p.src==x){A()}function A(){z&&z();y.resolve();p.onload=null;tinyMCE.activeEditor.undoManager.add()}return y}function d(){var z=e("#image-effects-dialog"),w=50,x=e('<div class="image-effects-loading-blanket"><div class="loading-data"></div></div>').appendTo(z.find(".dialog-page-body")),y=x.find(".loading-data");x.css({width:x.parent().width(),height:z.height()});y.css({marginTop:-w*1.2,marginLeft:-w*1.2});y.data("spinner",Raphael.spinner(y[0],w,"#666"))}function k(){var w=e(".image-effects-loading-blanket .loading-data"),x=w.data("spinner");w.css({marginTop:"",marginLeft:""});if(x){x();delete x;w.data("spinner",null)}w.closest(".image-effects-loading-blanket").remove()}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.profile-picture:profile-picture-editor_resources', location = 'js/profile-picture.js' */
AJS.bind("init.rte", function() {
    AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("viewProfile", function(e, macroNode) {
        var $macroDiv = AJS.$(macroNode);

        var params = {};
        if ($macroDiv.attr("data-macro-parameters")) {
            AJS.$.each($macroDiv.attr("data-macro-parameters").split("|"), function(idx, item) {
                var param = item.split("=");
                params[param[0]] = param[1];
            });
        }
        window.open(AJS.Confluence.getBaseUrl() + "/display/~" + params["user"]);
    });
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.officeconnector:officeconnector-editor-resources', location = 'javascript/property-panel.js' */
(function(){AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("office-connector-download-file-button",function(L,G){var C=AJS.$(G).attr("data-macro-parameters");
var J=C.split("|");
var D={};
var H;
for(H=0;
H<J.length;
H++){var N=J[H];
var F=N.split("=");
if(F.length>1){D[F[0]]=F[1]
}}var B=AJS.Meta.get("page-id");
var O=AJS.Meta.get("content-type");
if(!D.space){D.space=AJS.Meta.get("space-key")
}addToUrlIfDefined=function(Q,R,P){if(Q&&R){if(P.charAt(P.length-1)!="?"){P+="&"
}P=P+Q+"="+encodeURI(R)
}return P
};
var K=AJS.Meta.get("context-path");
var E="/plugins/servlet/oc/getattachment?";
var A=K+E;
A=addToUrlIfDefined("title",D.page,A);
A=addToUrlIfDefined("date",D.date,A);
A=addToUrlIfDefined("space",D.space,A);
A=addToUrlIfDefined("filename",D.name,A);
A=addToUrlIfDefined("contextid",B,A);
A=addToUrlIfDefined("contexttype",O,A);
var M=(AJS.$.browser&&AJS.$.browser.msie)?"_blank":"download-office-attachment";
var I=window.open(A,M)
})
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:timeline-resources', location = 'com/atlassian/confluence/extra/calendar3/js/timeline.js' */
if(typeof links==="undefined"){links={}}if(typeof google==="undefined"){google=undefined}links.Timeline=function(a){this.dom={};this.conversion={};this.eventParams={};this.groups=[];this.groupIndexes={};this.items=[];this.renderQueue={show:[],hide:[],update:[]};this.renderedItems=[];this.clusterGenerator=new links.Timeline.ClusterGenerator(this);this.currentClusters=[];this.selection=undefined;this.listeners={};this.size={actualHeight:0,axis:{characterMajorHeight:0,characterMajorWidth:0,characterMinorHeight:0,characterMinorWidth:0,height:0,labelMajorTop:0,labelMinorTop:0,line:0,lineMajorWidth:0,lineMinorHeight:0,lineMinorTop:0,lineMinorWidth:0,top:0},contentHeight:0,contentLeft:0,contentWidth:0,frameHeight:0,frameWidth:0,groupsLeft:0,groupsWidth:0,items:{top:0}};this.dom.container=a;this.options={width:"100%",height:"auto",minHeight:0,autoHeight:true,eventMargin:10,eventMarginAxis:20,dragAreaWidth:10,min:undefined,max:undefined,intervalMin:10,intervalMax:1000*60*60*24*365*10000,moveable:true,zoomable:true,selectable:true,editable:false,snapEvents:true,groupChangeable:true,showCurrentTime:true,showCustomTime:false,showMajorLabels:true,showMinorLabels:true,showNavigation:false,showButtonNew:false,groupsOnRight:false,axisOnTop:false,stackEvents:true,animate:true,animateZoom:true,cluster:false,style:"box",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]};this.clientTimeOffset=0;var b=this.dom;while(b.container.hasChildNodes()){b.container.removeChild(b.container.firstChild)}this.step=new links.Timeline.StepDate();this.itemTypes={box:links.Timeline.ItemBox,range:links.Timeline.ItemRange,dot:links.Timeline.ItemDot};this.data=[];this.firstDraw=true;this.setVisibleChartRange(undefined,undefined,false);this.render();this.trigger("ready")};links.Timeline.prototype.draw=function(b,a){this.setOptions(a);this.setData(b);if(a&&(a.start||a.end)){this.setVisibleChartRange(a.start,a.end)}else{if(this.firstDraw){this.setVisibleChartRangeAuto()}}this.firstDraw=false};links.Timeline.prototype.setOptions=function(a){if(a){for(var b in a){if(a.hasOwnProperty(b)){this.options[b]=a[b]}}if(a.showButtonAdd!=undefined){this.options.showButtonNew=a.showButtonAdd;console.log("WARNING: Option showButtonAdd is deprecated. Use showButtonNew instead")}if(a.scale&&a.step){this.step.setScale(a.scale,a.step)}}this.options.autoHeight=(this.options.height==="auto")};links.Timeline.prototype.addItemType=function(a,b){this.itemTypes[a]=b};links.Timeline.mapColumnIds=function(b){var c={},f=b.getNumberOfColumns(),e=true;for(var a=0;a<f;a++){var d=b.getColumnId(a)||b.getColumnLabel(a);c[d]=a;if(d=="start"||d=="end"||d=="content"||d=="group"||d=="className"||d=="editable"){e=false}}if(e){c.start=0;c.end=1;c.content=2}return c};links.Timeline.prototype.setData=function(e){this.unselectItem();if(!e){e=[]}this.stackCancelAnimation();this.clearItems();this.data=e;var b=this.items;this.deleteGroups();if(google&&google.visualization&&e instanceof google.visualization.DataTable){var f=links.Timeline.mapColumnIds(e);for(var g=0,d=e.getNumberOfRows();g<d;g++){b.push(this.createItem({start:((f.start!=undefined)?e.getValue(g,f.start):undefined),end:((f.end!=undefined)?e.getValue(g,f.end):undefined),content:((f.content!=undefined)?e.getValue(g,f.content):undefined),group:((f.group!=undefined)?e.getValue(g,f.group):undefined),className:((f.className!=undefined)?e.getValue(g,f.className):undefined),editable:((f.editable!=undefined)?e.getValue(g,f.editable):undefined)}))}}else{if(links.Timeline.isArray(e)){for(var g=0,d=e.length;g<d;g++){var a=e[g];var c=this.createItem(a);b.push(c)}}else{throw"Unknown data type. DataTable or Array expected."}}if(this.options.cluster){this.clusterGenerator.setData(this.items)}this.render({animate:false})};links.Timeline.prototype.getData=function(){return this.data};links.Timeline.prototype.updateData=function(e,j){var d=this.data,a;if(google&&google.visualization&&d instanceof google.visualization.DataTable){var g=(e+1)-d.getNumberOfRows();if(g>0){d.addRows(g)}var f=links.Timeline.mapColumnIds(d);for(a in j){if(j.hasOwnProperty(a)){var b=f[a];if(b==undefined){var h=j[a];var c="string";if(typeof(h)=="number"){c="number"}else{if(typeof(h)=="boolean"){c="boolean"}else{if(h instanceof Date){c="datetime"}}}b=d.addColumn(c,a)}d.setValue(e,b,j[a])}}}else{if(links.Timeline.isArray(d)){var k=d[e];if(k==undefined){k={};d[e]=k}for(a in j){if(j.hasOwnProperty(a)){k[a]=j[a]}}}else{throw"Cannot update data, unknown type of data"}}};links.Timeline.prototype.getItemIndex=function(f){var g=f,j=this.dom,h=j.items.frame,b=this.items,c=undefined;while(g.parentNode&&g.parentNode!==h){g=g.parentNode}if(g.parentNode===h){for(var d=0,a=b.length;d<a;d++){if(b[d].dom===g){c=d;break}}}return c};links.Timeline.prototype.setSize=function(b,a){if(b){this.options.width=b;this.dom.frame.style.width=b}if(a){this.options.height=a;this.options.autoHeight=(this.options.height==="auto");if(a!=="auto"){this.dom.frame.style.height=a}}this.render({animate:false})};links.Timeline.prototype.setVisibleChartRange=function(f,b,e){var c={};if(!f||!b){c=this.getDataRange(true)}if(!f){if(b){if(c.min&&c.min.valueOf()<b.valueOf()){f=c.min}else{f=new Date(b);f.setDate(f.getDate()-7)}}else{f=new Date();f.setDate(f.getDate()-3)}}if(!b){if(c.max){b=c.max}else{b=new Date(f);b.setDate(b.getDate()+7)}}if(b.valueOf()<=f.valueOf()){b=new Date(f);b.setDate(b.getDate()+7)}var d=this.options.min?this.options.min.valueOf():undefined;if(d!=undefined&&f.valueOf()<d){f=new Date(d)}var a=this.options.max?this.options.max.valueOf():undefined;if(a!=undefined&&b.valueOf()>a){b=new Date(a)}this.applyRange(f,b);if(e==undefined||e==true){this.render({animate:false})}else{this.recalcConversion()}};links.Timeline.prototype.setVisibleChartRangeAuto=function(){var b=this.getDataRange(true),c=undefined,a=undefined;this.setVisibleChartRange(b.min,b.max)};links.Timeline.prototype.setVisibleChartRangeNow=function(){var a=new Date();var b=(this.end.getTime()-this.start.getTime());var d=new Date(a.getTime()-b/2);var c=new Date(d.getTime()+b);this.setVisibleChartRange(d,c)};links.Timeline.prototype.getVisibleChartRange=function(){return{start:new Date(this.start),end:new Date(this.end)}};links.Timeline.prototype.getDataRange=function(b){var g=this.items,d=undefined,h=undefined;if(g){for(var f=0,e=g.length;f<e;f++){var k=g[f],a=k.start?k.start.valueOf():undefined,c=k.end?k.end.valueOf():a;if(d!=undefined&&a!=undefined){d=Math.min(d,a)}else{d=a}if(h!=undefined&&c!=undefined){h=Math.max(h,c)}else{h=c}}}if(d&&h&&b){var j=(h.valueOf()-d.valueOf());d=new Date(d.valueOf()-j*0.05);h=new Date(h.valueOf()+j*0.05)}return{min:d?new Date(d):undefined,max:h?new Date(h):undefined}};links.Timeline.prototype.render=function(j){var e=this.reflowFrame();var h=this.reflowAxis();var d=this.reflowGroups();var g=this.reflowItems();var f=(e||h||d||g);var a=this.options.animate;if(j&&j.animate!=undefined){a=j.animate}this.recalcConversion();this.clusterItems();this.filterItems();this.stackItems(a);this.recalcItems();var b=this.repaint();if(b){var c=j?j.renderTimesLeft:undefined;if(c==undefined){c=5}if(c>0){this.render({animate:j?j.animate:undefined,renderTimesLeft:(c-1)})}}};links.Timeline.prototype.repaint=function(){var b=this.repaintFrame();var a=this.repaintAxis();var d=this.repaintGroups();var c=this.repaintItems();this.repaintCurrentTime();this.repaintCustomTime();return(b||a||d||c)};links.Timeline.prototype.reflowFrame=function(){var f=this.dom,d=this.options,e=this.size,b=false;var a=f.frame?f.frame.offsetWidth:0,c=f.frame?f.frame.children[0].clientHeight:0;b=b||(e.frameWidth!==a);b=b||(e.frameHeight!==c);e.frameWidth=a;e.frameHeight=c;return b};links.Timeline.prototype.repaintFrame=function(){var b=false,d=this.dom,j=this.options,h=this.size;if(!d.frame){d.frame=document.createElement("DIV");d.frame.className="timeline-frame";d.frame.style.position="relative";d.frame.style.overflowX="hidden";d.frame.style.overflowY="auto";d.container.appendChild(d.frame);b=true}var g=j.autoHeight?(h.actualHeight+"px"):(j.height||"100%");var a=j.width||"100%";b=b||(d.frame.style.height!=g);b=b||(d.frame.style.width!=a);d.frame.style.height=j.viewHeight?j.viewHeight:g;d.frame.style.width=a;if(!d.content){d.content=document.createElement("DIV");d.content.style.position="relative";d.content.style.overflow="hidden";d.frame.appendChild(d.content);var e=document.createElement("DIV");e.style.position="absolute";e.style.left="0px";e.style.top="0px";e.style.height="100%";e.style.width="0px";d.content.appendChild(e);d.contentTimelines=e;var c=this.eventParams,f=this;if(!c.onMouseDown){c.onMouseDown=function(k){f.onMouseDown(k)};links.Timeline.addEventListener(d.content,"mousedown",c.onMouseDown)}if(!c.onTouchStart){c.onTouchStart=function(k){f.onTouchStart(k)};links.Timeline.addEventListener(d.content,"touchstart",c.onTouchStart)}if(!c.onDblClick){c.onDblClick=function(k){f.onDblClick(k)};links.Timeline.addEventListener(d.content,"dblclick",c.onDblClick)}b=true}d.content.style.left=h.contentLeft+"px";d.content.style.top="0px";d.content.style.width=h.contentWidth+"px";d.content.style.height=g;this.repaintNavigation();this.reflowAxis();this.repaintAxis();return b};links.Timeline.prototype.reflowAxis=function(){var j=false,h=this.dom,o=this.options,n=this.size,l=h.axis;var k=(l&&l.characterMinor)?l.characterMinor.clientWidth:0,g=(l&&l.characterMinor)?l.characterMinor.clientHeight:0,b=(l&&l.characterMajor)?l.characterMajor.clientWidth:0,e=(l&&l.characterMajor)?l.characterMajor.clientHeight:0,d=(o.showMinorLabels?g:0)+(o.showMajorLabels?e:0);var f=h.frame?h.frame.children[0].clientHeight:n.frameHeight;var a=o.axisOnTop?0:f-d,c=o.axisOnTop?d:a;j=j||(n.axis.top!==a);j=j||(n.axis.line!==c);j=j||(n.axis.height!==d);n.axis.top=a;n.axis.line=c;n.axis.height=d;n.axis.labelMajorTop=o.axisOnTop?0:c+(o.showMinorLabels?g:0);n.axis.labelMinorTop=o.axisOnTop?(o.showMajorLabels?e:0):c;n.axis.lineMinorTop=o.axisOnTop?n.axis.labelMinorTop:0;if(l&&l.minorLines&&l.minorLines.length){n.axis.lineMinorWidth=l.minorLines[0].offsetWidth}else{n.axis.lineMinorWidth=1}if(l&&l.majorLines&&l.majorLines.length){n.axis.lineMajorWidth=l.majorLines[0].offsetWidth}else{n.axis.lineMajorWidth=1}j=j||(n.axis.characterMinorWidth!==k);j=j||(n.axis.characterMinorHeight!==g);j=j||(n.axis.characterMajorWidth!==b);j=j||(n.axis.characterMajorHeight!==e);n.axis.characterMinorWidth=k;n.axis.characterMinorHeight=g;n.axis.characterMajorWidth=b;n.axis.characterMajorHeight=e;var m=Math.max(n.frameHeight-d,0);n.contentLeft=o.groupsOnRight?0:n.groupsWidth;n.contentWidth=Math.max(n.frameWidth-n.groupsWidth,0);n.contentHeight=m;n.axis.lineMinorHeight=m;return j};links.Timeline.prototype.repaintAxis=function(){var f=false,j=this.dom,r=this.options,q=this.size,e=this.step;var g=j.axis;if(!g){g={};j.axis=g}if(!q.axis.properties){q.axis.properties={}}if(!g.minorTexts){g.minorTexts=[]}if(!g.minorLines){g.minorLines=[]}if(!g.majorTexts){g.majorTexts=[]}if(!g.majorLines){g.majorLines=[]}if(!g.frame){g.frame=document.createElement("DIV");g.frame.style.position="absolute";g.frame.style.left="0px";g.frame.style.top="0px";j.content.appendChild(g.frame)}j.content.removeChild(g.frame);g.frame.style.width=(q.contentWidth)+"px";g.frame.style.height=(q.axis.height)+"px";var d=this.screenToTime(0);var h=this.screenToTime(q.contentWidth);if(q.axis.characterMinorWidth){this.minimumStep=this.screenToTime(q.axis.characterMinorWidth*6).valueOf()-this.screenToTime(0).valueOf();e.setRange(d,h,this.minimumStep)}var o=this.repaintAxisCharacters();f=f||o;this.repaintAxisStartOverwriting();e.start();var a=undefined;var l=0;while(!e.end()&&l<1000){l++;var p=e.getCurrent(),n=this.timeToScreen(p),k=e.isMajor();if(r.showMinorLabels){this.repaintAxisMinorText(n,e.getLabelMinor())}if(k&&r.showMajorLabels){if(n>0){if(a===undefined){a=n}this.repaintAxisMajorText(n,e.getLabelMajor(r))}this.repaintAxisMajorLine(n)}else{this.repaintAxisMinorLine(n)}e.next()}if(r.showMajorLabels){var c=this.screenToTime(0),m=this.step.getLabelMajor(r,c),b=m.length*q.axis.characterMajorWidth+10;if(a===undefined||b<a){this.repaintAxisMajorText(0,m,c)}}this.repaintAxisEndOverwriting();this.repaintAxisHorizontal();j.content.insertBefore(g.frame,j.content.firstChild);return f};links.Timeline.prototype.repaintAxisCharacters=function(){var c=false,f=this.dom,b=f.axis,e;if(!b.characterMinor){e=document.createTextNode("0");var a=document.createElement("DIV");a.className="timeline-axis-text timeline-axis-text-minor";a.appendChild(e);a.style.position="absolute";a.style.visibility="hidden";a.style.paddingLeft="0px";a.style.paddingRight="0px";b.frame.appendChild(a);b.characterMinor=a;c=true}if(!b.characterMajor){e=document.createTextNode("0");var d=document.createElement("DIV");d.className="timeline-axis-text timeline-axis-text-major";d.appendChild(e);d.style.position="absolute";d.style.visibility="hidden";d.style.paddingLeft="0px";d.style.paddingRight="0px";b.frame.appendChild(d);b.characterMajor=d;c=true}return c};links.Timeline.prototype.repaintAxisStartOverwriting=function(){var a=this.size.axis.properties;a.minorTextNum=0;a.minorLineNum=0;a.majorTextNum=0;a.majorLineNum=0};links.Timeline.prototype.repaintAxisEndOverwriting=function(){var b=this.dom,j=this.size.axis.properties,a=this.dom.axis.frame,e;var l=b.axis.minorTexts;e=j.minorTextNum;while(l.length>e){var c=l[e];a.removeChild(c);l.splice(e,1)}var d=b.axis.minorLines;e=j.minorLineNum;while(d.length>e){var f=d[e];a.removeChild(f);d.splice(e,1)}var m=b.axis.majorTexts;e=j.majorTextNum;while(m.length>e){var h=m[e];a.removeChild(h);m.splice(e,1)}var g=b.axis.majorLines;e=j.majorLineNum;while(g.length>e){var k=g[e];a.removeChild(k);g.splice(e,1)}};links.Timeline.prototype.repaintAxisHorizontal=function(){var e=this.dom.axis,d=this.size,c=this.options;var a=(c.showMinorLabels||c.showMajorLabels);if(a){if(!e.backgroundLine){var f=document.createElement("DIV");f.className="timeline-axis";f.style.position="absolute";f.style.left="0px";f.style.width="100%";f.style.border="none";e.frame.insertBefore(f,e.frame.firstChild);e.backgroundLine=f}if(e.backgroundLine){e.backgroundLine.style.top=d.axis.top+"px";e.backgroundLine.style.height=d.axis.height+"px"}}else{if(e.backgroundLine){e.frame.removeChild(e.backgroundLine);delete e.backgroundLine}}if(a){if(e.line){var b=e.frame.removeChild(e.line);e.frame.appendChild(b)}else{var b=document.createElement("DIV");b.className="timeline-axis";b.style.position="absolute";b.style.left="0px";b.style.width="100%";b.style.height="0px";e.frame.appendChild(b);e.line=b}e.line.style.top=d.axis.line+"px"}else{if(e.line&&e.line.parentElement){e.frame.removeChild(e.line);delete e.line}}};links.Timeline.prototype.repaintAxisMinorText=function(h,j){var k=this.size,b=this.dom,e=k.axis.properties,a=b.axis.frame,g=b.axis.minorTexts,c=e.minorTextNum,f;if(c<g.length){f=g[c]}else{var d=document.createTextNode("");f=document.createElement("DIV");f.appendChild(d);f.className="timeline-axis-text timeline-axis-text-minor";f.style.position="absolute";a.appendChild(f);g.push(f)}f.childNodes[0].nodeValue=j;f.style.left=(h-8)+"px";f.style.top=k.axis.labelMinorTop+"px";e.minorTextNum++};links.Timeline.prototype.repaintAxisMinorLine=function(a){var e=this.size.axis,h=this.dom,d=e.properties,g=h.axis.frame,f=h.axis.minorLines,c=d.minorLineNum,b;if(c<f.length){b=f[c]}else{b=document.createElement("DIV");b.className="timeline-axis-grid timeline-axis-grid-minor";b.style.position="absolute";b.style.width="0px";g.appendChild(b);f.push(b)}b.style.top=e.lineMinorTop+"px";b.style.height=e.lineMinorHeight+"px";b.style.left=(a-e.lineMinorWidth/2)+"px";d.minorLineNum++};links.Timeline.prototype.repaintAxisMajorText=function(f,h){var j=this.size,d=j.axis.properties,a=this.dom.axis.frame,g=this.dom.axis.majorTexts,b=d.majorTextNum,e;if(b<g.length){e=g[b]}else{var c=document.createTextNode(h);e=document.createElement("DIV");e.className="timeline-axis-text timeline-axis-text-major";e.appendChild(c);e.style.position="absolute";e.style.top="0px";a.appendChild(e);g.push(e)}e.childNodes[0].nodeValue=h;e.style.top=j.axis.labelMajorTop+"px";e.style.left=f+"px";d.majorTextNum++};links.Timeline.prototype.repaintAxisMajorLine=function(a){var e=this.size,g=e.axis.properties,f=this.size.axis,h=this.dom.axis.frame,d=this.dom.axis.majorLines,c=g.majorLineNum,b;if(c<d.length){b=d[c]}else{b=document.createElement("DIV");b.className="timeline-axis-grid timeline-axis-grid-major";b.style.position="absolute";b.style.top="0px";b.style.width="0px";h.appendChild(b);d.push(b)}b.style.left=(a-f.lineMajorWidth/2)+"px";b.style.height=e.contentHeight+"px";g.majorLineNum++};links.Timeline.prototype.reflowItems=function(){var h=false,g,f,j,e=this.dom,d=this.groups,c=this.renderedItems;if(d){AJS.$.each(d,function(n,m){m.itemsHeight=0})}for(g=0,f=c.length;g<f;g++){var l=c[g],a=l.dom;j=l.group;if(a){var b=a?a.clientWidth:0;var k=a?a.clientHeight:0;h=h||(l.width!=b);h=h||(l.height!=k);l.width=b;l.height=k;l.reflow()}if(j){j.itemsHeight=j.itemsHeight?Math.max(j.itemsHeight,l.height):l.height}}return h};links.Timeline.prototype.recalcItems=function(){var q=false,p,l,r,t,f,d,s=this.groups,k=this.size,b=this.options,n=this.renderedItems;var a=0;if(s.length==0){if(b.autoHeight||b.cluster){var m=0,o=0;if(this.stack&&this.stack.finalItems){f=this.stack.finalItems;t=f[0];if(t&&t.top){m=t.top;o=t.top+t.height}for(p=1,l=f.length;p<l;p++){t=f[p];m=Math.min(m,t.top);o=Math.max(o,t.top+t.height)}}else{r=n[0];if(r&&r.top){m=r.top;o=r.top+r.height}for(p=1,l=n.length;p<l;p++){r=n[p];if(r.top){m=Math.min(m,r.top);o=Math.max(o,(r.top+r.height))}}}a=(o-m)+2*b.eventMarginAxis+k.axis.height;if(a<b.minHeight){a=b.minHeight}if(k.actualHeight!=a&&b.autoHeight&&!b.axisOnTop){var g=a-k.actualHeight;if(this.stack&&this.stack.finalItems){f=this.stack.finalItems;for(p=0,l=f.length;p<l;p++){f[p].top+=g;f[p].item.top+=g}}else{for(p=0,l=n.length;p<l;p++){n[p].top+=g}}}}}else{a=k.axis.height+2*b.eventMarginAxis;for(p=0,l=s.length;p<l;p++){d=s[p];var j=Math.max(d.labelHeight||0,d.itemsHeight||0);q=q||(j!=d.height);d.height=j;a+=s[p].height+b.eventMargin}var c=b.eventMargin,h=b.axisOnTop?b.eventMarginAxis+c/2:k.contentHeight-b.eventMarginAxis+c/2,e=k.axis.height;for(p=0,l=s.length;p<l;p++){d=s[p];if(b.axisOnTop){d.top=h+e;d.labelTop=h+e+(d.height-d.labelHeight)/2;d.lineTop=h+e+d.height+c/2;h+=d.height+c}else{h-=d.height+c;d.top=h;d.labelTop=h+(d.height-d.labelHeight)/2;d.lineTop=h-c/2}}for(p=0,l=n.length;p<l;p++){r=n[p];d=r.group;if(d){r.top=d.top}}q=true}if(a<b.minHeight){a=b.minHeight}q=q||(a!=k.actualHeight);k.actualHeight=a;return q};links.Timeline.prototype.clearItems=function(){var a=this.renderQueue.hide;AJS.$.each(this.renderedItems,function(c,b){a.push(b)});this.clusterGenerator.clear();this.items=[]};links.Timeline.prototype.repaintItems=function(){var h,g,n,k;var d=false,f=this.dom,o=this.size,m=this,b=this.renderedItems;if(!f.items){f.items={}}var a=f.items.frame;if(!a){a=document.createElement("DIV");a.style.position="relative";f.content.appendChild(a);f.items.frame=a}a.style.left="0px";a.style.top=o.items.top+"px";a.style.height="0px";f.content.removeChild(a);var j=this.renderQueue;var c=[];d=d||(j.show.length>0)||(j.update.length>0)||(j.hide.length>0);while(n=j.show.shift()){n.showDOM(a);n.getImageUrls(c);b.push(n)}while(n=j.update.shift()){n.updateDOM(a);n.getImageUrls(c);k=AJS.$.inArray(n,this.renderedItems);if(k==-1){b.push(n)}}while(n=j.hide.shift()){n.hideDOM(a);k=AJS.$.inArray(n,this.renderedItems);if(k!=-1){b.splice(k,1)}}AJS.$.each(b,function(q,p){p.updatePosition(m)});this.repaintDeleteButton();this.repaintDragAreas();f.content.appendChild(a);if(c.length){var l=function(){m.render()};var e=false;links.imageloader.loadAll(c,l,e)}return d};links.Timeline.prototype.reflowGroups=function(){var f=false,m=this.options,l=this.size,d=this.dom;var j=0;var b=this.groups;var g=this.dom.groups?this.dom.groups.labels:[];for(var e=0,c=b.length;e<c;e++){var k=b[e];var h=g[e];k.labelWidth=h?h.clientWidth:0;k.labelHeight=h?h.clientHeight:0;k.width=k.labelWidth;j=Math.max(j,k.width)}if(m.groupsWidth!==undefined){j=d.groups.frame?d.groups.frame.clientWidth:0}j+=1;var a=m.groupsOnRight?l.frameWidth-j:0;f=f||(l.groupsWidth!==j);f=f||(l.groupsLeft!==a);l.groupsWidth=j;l.groupsLeft=a;return f};links.Timeline.prototype.repaintGroups=function(){var s=this.dom,b=this.options,m=this.size,v=this.groups;if(s.groups===undefined){s.groups={}}var u=s.groups.labels;if(!u){u=[];s.groups.labels=u}var f=s.groups.labelLines;if(!f){f=[];s.groups.labelLines=f}var n=s.groups.itemLines;if(!n){n=[];s.groups.itemLines=n}var l=s.groups.frame;if(!l){l=document.createElement("DIV");l.className="timeline-groups-axis";l.style.position="absolute";l.style.overflow="hidden";l.style.top="0px";l.style.height="100%";s.frame.appendChild(l);s.groups.frame=l}l.style.left=m.groupsLeft+"px";l.style.width=(b.groupsWidth!==undefined)?b.groupsWidth:m.groupsWidth+"px";if(v.length==0){l.style.display="none"}else{l.style.display=""}var p=u.length,j=v.length;for(var r=0,q=Math.min(p,j);r<q;r++){var g=v[r];var h=u[r];h.innerHTML=this.getGroupName(g);h.style.display=""}for(var r=p;r<j;r++){var g=v[r];var h=document.createElement("DIV");h.className="timeline-groups-text";h.style.position="absolute";if(b.groupsWidth===undefined){h.style.whiteSpace="nowrap"}h.innerHTML=this.getGroupName(g);l.appendChild(h);u[r]=h;var e=document.createElement("DIV");e.className="timeline-axis-grid timeline-axis-grid-minor";e.style.position="absolute";e.style.left="0px";e.style.width="100%";e.style.height="0px";e.style.borderTopStyle="solid";l.appendChild(e);f[r]=e;var d=document.createElement("DIV");d.className="timeline-axis-grid timeline-axis-grid-minor";d.style.position="absolute";d.style.left="0px";d.style.width="100%";d.style.height="0px";d.style.borderTopStyle="solid";s.content.insertBefore(d,s.content.firstChild);n[r]=d}for(var r=j;r<p;r++){var h=u[r],e=f[r],d=n[r];l.removeChild(h);l.removeChild(e);s.content.removeChild(d)}u.splice(j,p-j);f.splice(j,p-j);n.splice(j,p-j);l.style.borderStyle=b.groupsOnRight?"none none none solid":"none solid none none";for(var r=0,q=v.length;r<q;r++){var g=v[r],h=u[r],e=f[r],d=n[r];h.style.top=g.labelTop+"px";e.style.top=g.lineTop+"px";d.style.top=g.lineTop+"px";d.style.width=m.contentWidth+"px"}if(!s.groups.background){var t=document.createElement("DIV");t.className="timeline-axis";t.style.position="absolute";t.style.left="0px";t.style.width="100%";t.style.border="none";l.appendChild(t);s.groups.background=t}s.groups.background.style.top=m.axis.top+"px";s.groups.background.style.height=m.axis.height+"px";if(!s.groups.line){var k=document.createElement("DIV");k.className="timeline-axis";k.style.position="absolute";k.style.left="0px";k.style.width="100%";k.style.height="0px";l.appendChild(k);s.groups.line=k}s.groups.line.style.top=m.axis.line+"px";if(s.groups.frame&&v.length){var o=[];links.imageloader.filterImageUrls(s.groups.frame,o);if(o.length){var c=function(){timeline.render()};var a=false;links.imageloader.loadAll(o,c,a)}}};links.Timeline.prototype.repaintCurrentTime=function(){var l=this.options,e=this.dom,k=this.size;if(!l.showCurrentTime){if(e.currentTime){e.contentTimelines.removeChild(e.currentTime);delete e.currentTime}return}if(!e.currentTime){var a=document.createElement("DIV");a.className="timeline-currenttime";a.style.position="absolute";a.style.top="0px";a.style.height="100%";e.contentTimelines.appendChild(a);e.currentTime=a}else{e.currentTime.style.height=k.contentHeight+"px"}var b=new Date();var f=new Date(b.getTime()+this.clientTimeOffset);var h=this.timeToScreen(f);var d=(h>-k.contentWidth&&h<2*k.contentWidth);e.currentTime.style.display=d?"":"none";e.currentTime.style.left=h+"px";e.currentTime.title="Current time: "+f;if(this.currentTimeTimer!=undefined){clearTimeout(this.currentTimeTimer);delete this.currentTimeTimer}var j=this;var g=function(){j.repaintCurrentTime()};var c=1/this.conversion.factor/2;if(c<30){c=30}this.currentTimeTimer=setTimeout(g,c)};links.Timeline.prototype.repaintCustomTime=function(){var c=this.options,g=this.dom,d=this.size;if(!c.showCustomTime){if(g.customTime){g.contentTimelines.removeChild(g.customTime);delete g.customTime}return}if(!g.customTime){var b=document.createElement("DIV");b.className="timeline-customtime";b.style.position="absolute";b.style.top="0px";b.style.height="100%";var e=document.createElement("DIV");e.style.position="relative";e.style.top="0px";e.style.left="-10px";e.style.height="100%";e.style.width="20px";b.appendChild(e);g.contentTimelines.appendChild(b);g.customTime=b;this.customTime=new Date()}var a=this.timeToScreen(this.customTime),f=(a>-d.contentWidth&&a<2*d.contentWidth);g.customTime.style.display=f?"":"none";g.customTime.style.left=a+"px";g.customTime.title="Time: "+this.customTime};links.Timeline.prototype.repaintDeleteButton=function(){var d=this,g=this.dom,f=g.items.frame;var h=g.items.deleteButton;if(!h){h=document.createElement("DIV");h.className="timeline-navigation-delete";h.style.position="absolute";f.appendChild(h);g.items.deleteButton=h}var a=this.selection?this.selection.index:-1,c=this.selection?this.items[a]:undefined;if(c&&c.rendered&&this.isEditable(c)){var b=c.getRight(this),e=c.top;h.style.left=b+"px";h.style.top=e+"px";h.style.display="";f.removeChild(h);f.appendChild(h)}else{h.style.display="none"}};links.Timeline.prototype.repaintDragAreas=function(){var k=this,m=this.options,d=this.dom,a=this.dom.items.frame;var c=d.items.dragLeft;if(!c){c=document.createElement("DIV");c.className="timeline-event-range-drag-left";c.style.width=m.dragAreaWidth+"px";c.style.position="absolute";a.appendChild(c);d.items.dragLeft=c}var e=d.items.dragRight;if(!e){e=document.createElement("DIV");e.className="timeline-event-range-drag-right";e.style.width=m.dragAreaWidth+"px";e.style.position="absolute";a.appendChild(e);d.items.dragRight=e}var f=this.selection?this.selection.index:-1,l=this.selection?this.items[f]:undefined;if(l&&l.rendered&&this.isEditable(l)&&(l instanceof links.Timeline.ItemRange)){var b=this.timeToScreen(l.start),h=this.timeToScreen(l.end),g=l.top,j=l.height;c.style.left=b+"px";c.style.top=g+"px";c.style.height=j+"px";c.style.display="";a.removeChild(c);a.appendChild(c);e.style.left=(h-m.dragAreaWidth)+"px";e.style.top=g+"px";e.style.height=j+"px";e.style.display="";a.removeChild(e);a.appendChild(e)}else{c.style.display="none";e.style.display="none"}};links.Timeline.prototype.repaintNavigation=function(){var j=this,k=this.options,e=this.dom,b=e.frame,d=e.navBar;if(!d){if(k.showNavigation||k.showButtonNew){d=document.createElement("DIV");d.style.position="absolute";d.className="timeline-navigation";if(k.groupsOnRight){d.style.left="10px"}else{d.style.right="32px"}if(k.axisOnTop){d.style.bottom="10px"}else{d.style.top="10px"}e.navBar=d;e.container.appendChild(d)}if(k.editable&&k.showButtonNew){d.addButton=document.createElement("DIV");d.addButton.className="timeline-navigation-new";d.addButton.title="Create new event";var g=function(r){links.Timeline.preventDefault(r);links.Timeline.stopPropagation(r);var m=j.size.contentWidth;var l=m/2;var n=j.screenToTime(l-m/10);var p=j.screenToTime(l+m/10);if(k.snapEvents){j.step.snap(n);j.step.snap(p)}var q="New";var s=j.groups.length?j.groups[0].content:undefined;j.addItem({start:n,end:p,content:q,group:s});var o=(j.items.length-1);j.selectItem(o);j.applyAdd=true;j.trigger("add");if(!j.applyAdd){j.deleteItem(o)}};links.Timeline.addEventListener(d.addButton,"mousedown",g);d.appendChild(d.addButton)}if(k.editable&&k.showButtonNew&&k.showNavigation){d.addButton.style.borderRightWidth="1px";d.addButton.style.borderRightStyle="solid"}if(k.showNavigation){d.zoomInButton=document.createElement("DIV");d.zoomInButton.className="timeline-navigation-zoom-in";d.zoomInButton.title="Zoom in";var c=function(l){links.Timeline.preventDefault(l);links.Timeline.stopPropagation(l);j.zoom(0.4);j.trigger("rangechange");j.trigger("rangechanged")};links.Timeline.addEventListener(d.zoomInButton,"mousedown",c);d.appendChild(d.zoomInButton);d.zoomOutButton=document.createElement("DIV");d.zoomOutButton.className="timeline-navigation-zoom-out";d.zoomOutButton.title="Zoom out";var f=function(l){links.Timeline.preventDefault(l);links.Timeline.stopPropagation(l);j.zoom(-0.4);j.trigger("rangechange");j.trigger("rangechanged")};links.Timeline.addEventListener(d.zoomOutButton,"mousedown",f);d.appendChild(d.zoomOutButton);d.moveLeftButton=document.createElement("DIV");d.moveLeftButton.className="timeline-navigation-move-left";d.moveLeftButton.title="Move left";var h=function(l){links.Timeline.preventDefault(l);links.Timeline.stopPropagation(l);j.move(-0.2);j.trigger("rangechange");j.trigger("rangechanged")};links.Timeline.addEventListener(d.moveLeftButton,"mousedown",h);d.appendChild(d.moveLeftButton);d.moveRightButton=document.createElement("DIV");d.moveRightButton.className="timeline-navigation-move-right";d.moveRightButton.title="Move right";var a=function(l){links.Timeline.preventDefault(l);links.Timeline.stopPropagation(l);j.move(0.2);j.trigger("rangechange");j.trigger("rangechanged")};links.Timeline.addEventListener(d.moveRightButton,"mousedown",a);d.appendChild(d.moveRightButton)}}};links.Timeline.prototype.setCurrentTime=function(b){var a=new Date();this.clientTimeOffset=b.getTime()-a.getTime();this.repaintCurrentTime()};links.Timeline.prototype.getCurrentTime=function(){var a=new Date();return new Date(a.getTime()+this.clientTimeOffset)};links.Timeline.prototype.setCustomTime=function(a){this.customTime=new Date(a);this.repaintCustomTime()};links.Timeline.prototype.getCustomTime=function(){return new Date(this.customTime)};links.Timeline.prototype.setScale=function(b,a){this.step.setScale(b,a);this.render()};links.Timeline.prototype.setAutoScale=function(a){this.step.setAutoScale(a);this.render()};links.Timeline.prototype.redraw=function(){this.setData(this.data)};links.Timeline.prototype.checkResize=function(){this.render()};links.Timeline.prototype.isEditable=function(a){if(a){if(a.editable!=undefined){return a.editable}else{return this.options.editable}}return false};links.Timeline.prototype.recalcConversion=function(){this.conversion.offset=parseFloat(this.start.valueOf());this.conversion.factor=parseFloat(this.size.contentWidth)/parseFloat(this.end.valueOf()-this.start.valueOf())};links.Timeline.prototype.screenToTime=function(a){var b=this.conversion,c=new Date(parseFloat(a)/b.factor+b.offset);return c};links.Timeline.prototype.timeToScreen=function(c){var b=this.conversion;var a=(c.valueOf()-b.offset)*b.factor;return a};links.Timeline.prototype.onTouchStart=function(c){var e=this.eventParams,b=this;if(e.touchDown){return}e.touchDown=true;e.zoomed=false;this.onMouseDown(c);if(!e.onTouchMove){e.onTouchMove=function(f){b.onTouchMove(f)};links.Timeline.addEventListener(document,"touchmove",e.onTouchMove)}if(!e.onTouchEnd){e.onTouchEnd=function(f){b.onTouchEnd(f)};links.Timeline.addEventListener(document,"touchend",e.onTouchEnd)}var d=links.Timeline.getTarget(c);var a=this.getItemIndex(d);e.doubleTapStartPrev=e.doubleTapStart;e.doubleTapStart=(new Date()).getTime();e.doubleTapItemPrev=e.doubleTapItem;e.doubleTapItem=a;links.Timeline.preventDefault(c)};links.Timeline.prototype.onTouchMove=function(d){var g=this.eventParams;if(d.scale&&d.scale!==1){g.zoomed=true}if(!g.zoomed){this.onMouseMove(d)}else{if(this.options.zoomable){g.zoomed=true;var f=d.scale,b=(g.end.valueOf()-g.start.valueOf()),c=b/f,e=c-b,h=new Date(parseInt(g.start.valueOf()-e/2)),a=new Date(parseInt(g.end.valueOf()+e/2));this.setVisibleChartRange(h,a);this.trigger("rangechange")}}links.Timeline.preventDefault(d)};links.Timeline.prototype.onTouchEnd=function(d){var f=this.eventParams;var c=this;f.touchDown=false;if(f.zoomed){this.trigger("rangechanged")}if(f.onTouchMove){links.Timeline.removeEventListener(document,"touchmove",f.onTouchMove);delete f.onTouchMove}if(f.onTouchEnd){links.Timeline.removeEventListener(document,"touchend",f.onTouchEnd);delete f.onTouchEnd}this.onMouseUp(d);var g=500;var a=(new Date()).getTime();var e=links.Timeline.getTarget(d);var b=this.getItemIndex(e);if(f.doubleTapStartPrev&&(a-f.doubleTapStartPrev)<g&&f.doubleTapItem==f.doubleTapItemPrev){f.touchDown=true;c.onDblClick(d);f.touchDown=false}links.Timeline.preventDefault(d)};links.Timeline.prototype.onMouseDown=function(b){b=b||window.event;var e=this.eventParams,q=this.options,f=this.dom;var p=b.which?(b.which==1):(b.button==1);if(!p&&!e.touchDown){return}if(!e.touchDown){e.mouseX=b.clientX;e.mouseY=b.clientY}else{e.mouseX=b.targetTouches[0].clientX;e.mouseY=b.targetTouches[0].clientY}if(e.mouseX===undefined){e.mouseX=0}if(e.mouseY===undefined){e.mouseY=0}e.frameLeft=links.Timeline.getAbsoluteLeft(this.dom.content);e.frameTop=links.Timeline.getAbsoluteTop(this.dom.content);e.previousLeft=0;e.previousOffset=0;e.moved=false;e.start=new Date(this.start);e.end=new Date(this.end);e.target=links.Timeline.getTarget(b);var d=(f.items&&f.items.dragLeft)?f.items.dragLeft:undefined;var g=(f.items&&f.items.dragRight)?f.items.dragRight:undefined;e.itemDragLeft=(e.target===d);e.itemDragRight=(e.target===g);if(e.itemDragLeft||e.itemDragRight){e.itemIndex=this.selection?this.selection.index:undefined}else{e.itemIndex=this.getItemIndex(e.target)}e.customTime=(e.target===f.customTime||e.target.parentNode===f.customTime)?this.customTime:undefined;e.addItem=(q.editable&&b.ctrlKey);if(e.addItem){var l=e.mouseX-e.frameLeft;var k=e.mouseY-e.frameTop;var n=this.screenToTime(l);if(q.snapEvents){this.step.snap(n)}var a=new Date(n);var h="New";var m=this.getGroupFromHeight(k);this.addItem({start:n,end:a,content:h,group:this.getGroupName(m)});e.itemIndex=(this.items.length-1);this.selectItem(e.itemIndex);e.itemDragRight=true}var o=this.items[e.itemIndex];var c=this.isSelected(e.itemIndex);e.editItem=c&&this.isEditable(o);if(e.editItem){e.itemStart=o.start;e.itemEnd=o.end;e.itemGroup=o.group;e.itemLeft=o.start?this.timeToScreen(o.start):undefined;e.itemRight=o.end?this.timeToScreen(o.end):undefined}else{this.dom.frame.style.cursor="move"}if(!e.touchDown){var j=this;if(!e.onMouseMove){e.onMouseMove=function(r){j.onMouseMove(r)};links.Timeline.addEventListener(document,"mousemove",e.onMouseMove)}if(!e.onMouseUp){e.onMouseUp=function(r){j.onMouseUp(r)};links.Timeline.addEventListener(document,"mouseup",e.onMouseUp)}links.Timeline.preventDefault(b)}};links.Timeline.prototype.onMouseMove=function(v){v=v||window.event;var C=this.eventParams,r=this.size,w=this.dom,e=this.options;var m,k;if(!C.touchDown){m=v.clientX;k=v.clientY}else{m=v.targetTouches[0].clientX;k=v.targetTouches[0].clientY}if(m===undefined){m=0}if(k===undefined){k=0}if(C.mouseX===undefined){C.mouseX=m}if(C.mouseY===undefined){C.mouseY=k}var t=parseFloat(m)-C.mouseX;var s=parseFloat(k)-C.mouseY;if(Math.abs(t)>=1){C.moved=true}if(C.customTime){var o=this.timeToScreen(C.customTime);var q=o+t;this.customTime=this.screenToTime(q);this.repaintCustomTime();this.trigger("timechange")}else{if(C.editItem){this.trigger("moved");var A=this.items[C.itemIndex],f,B;if(C.itemDragLeft){f=C.itemLeft+t;B=C.itemRight;A.start=this.screenToTime(f);if(e.snapEvents){this.step.snap(A.start);f=this.timeToScreen(A.start)}if(f>B){f=B;A.start=this.screenToTime(f)}}else{if(C.itemDragRight){f=C.itemLeft;B=C.itemRight+t;A.end=this.screenToTime(B);if(e.snapEvents){this.step.snap(A.end);B=this.timeToScreen(A.end)}if(B<f){B=f;A.end=this.screenToTime(B)}}else{f=C.itemLeft+t;A.start=this.screenToTime(f);if(e.snapEvents){this.step.snap(A.start);f=this.timeToScreen(A.start)}if(A.end){B=f+(C.itemRight-C.itemLeft);A.end=this.screenToTime(B)}}}A.setPosition(f,B);if(this.groups.length==0){this.render()}else{var n=k-C.frameTop;var j=this.getGroupFromHeight(n);if(e.groupsChangeable&&A.group!==j){var g=AJS.$.inArray(A,this.items);this.changeItem(g,{group:this.getGroupName(j)})}else{this.repaintDeleteButton();this.repaintDragAreas()}}}else{if(e.moveable){var z=(C.end.valueOf()-C.start.valueOf());var D=Math.round(parseFloat(-t)/r.contentWidth*z);var b=new Date(C.start.valueOf()+D);var a=new Date(C.end.valueOf()+D);this.applyRange(b,a);var l=(this.start.valueOf()-b.valueOf());if(l){D+=l}this.recalcConversion();var d=C.previousLeft||0;var u=parseFloat(w.items.frame.style.left)||0;var p=C.previousOffset||0;var c=p+(u-d);var h=-D/z*r.contentWidth+c;w.items.frame.style.left=(h)+"px";C.previousOffset=c;C.previousLeft=parseFloat(w.items.frame.style.left)||h;this.repaintCurrentTime();this.repaintCustomTime();this.repaintAxis();this.trigger("rangechange")}}}links.Timeline.preventDefault(v)};links.Timeline.prototype.onMouseUp=function(d){var e=this.eventParams,a=this.options;d=d||window.event;this.dom.frame.style.cursor="auto";if(e.onMouseMove){links.Timeline.removeEventListener(document,"mousemove",e.onMouseMove);delete e.onMouseMove}if(e.onMouseUp){links.Timeline.removeEventListener(document,"mouseup",e.onMouseUp);delete e.onMouseUp}if(e.customTime){this.trigger("timechanged")}else{if(e.editItem){var c=this.items[e.itemIndex];if(e.moved||e.addItem){this.applyChange=true;this.applyAdd=true;this.updateData(e.itemIndex,{start:c.start,end:c.end});this.trigger(e.addItem?"add":"change");if(e.addItem){if(this.applyAdd){this.updateData(e.itemIndex,{start:c.start,end:c.end,content:c.content,group:this.getGroupName(c.group)})}else{this.deleteItem(e.itemIndex)}}else{if(this.applyChange){this.updateData(e.itemIndex,{start:c.start,end:c.end})}else{delete this.applyChange;delete this.applyAdd;var c=this.items[e.itemIndex],b=c.dom;c.start=e.itemStart;c.end=e.itemEnd;c.group=e.itemGroup;c.setPosition(e.itemLeft,e.itemRight)}}this.render()}}else{if(!e.moved&&!e.zoomed){if(e.target===this.dom.items.deleteButton){if(this.selection){this.confirmDeleteItem(this.selection.index)}}else{if(a.selectable){if(e.itemIndex!==undefined){if(!this.isSelected(e.itemIndex)){this.selectItem(e.itemIndex);this.trigger("select")}}else{this.unselectItem();this.trigger("select")}}}}else{this.render();if((e.moved&&a.moveable)||(e.zoomed&&a.zoomable)){this.trigger("rangechanged")}}}}};links.Timeline.prototype.onDblClick=function(d){var f=this.eventParams,a=this.options,e=this.dom,b=this.size;d=d||window.event;if(f.itemIndex!==undefined){var c=this.items[f.itemIndex];if(c&&this.isEditable(c)){this.trigger("edit")}}else{this.trigger("add")}links.Timeline.preventDefault(d)};links.Timeline.prototype.onMouseWheel=function(c){if(!this.options.zoomable){return}if(!c){c=window.event}var d=0;if(c.wheelDelta){d=c.wheelDelta/120}else{if(c.detail){d=-c.detail/3}}if(d){var b=this;var a=function(){var f=d/5;var e=links.Timeline.getAbsoluteLeft(b.dom.content);var g=(c.clientX!=undefined&&e!=undefined)?b.screenToTime(c.clientX-e):undefined;b.zoom(f,g);b.trigger("rangechange");b.trigger("rangechanged")};a()}links.Timeline.preventDefault(c)};links.Timeline.prototype.zoom=function(e,f){if(f==undefined){f=new Date((this.start.valueOf()+this.end.valueOf())/2)}if(e>=1){e=0.9}if(e<=-1){e=-0.9}if(e<0){e=e/(1+e)}var c=parseFloat(this.start.valueOf()-f.valueOf());var b=parseFloat(this.end.valueOf()-f.valueOf());var a=new Date(this.start.valueOf()-c*e);var d=new Date(this.end.valueOf()-b*e);this.applyRange(a,d,f);this.render({animate:this.options.animate&&this.options.animateZoom})};links.Timeline.prototype.move=function(b){var d=parseFloat(this.end.valueOf()-this.start.valueOf());var a=new Date(this.start.valueOf()+d*b);var c=new Date(this.end.valueOf()+d*b);this.applyRange(a,c);this.render()};links.Timeline.prototype.applyRange=function(c,g,a){var d=c.valueOf();var o=g.valueOf();var e=(o-d);var q=this.options;var k=1000*60*60*24*365;var n=Number(q.intervalMin)||10;if(n<10){n=10}var b=Number(q.intervalMax)||10000*k;if(b>10000*k){b=10000*k}if(b<n){b=n}var h=q.min?q.min.valueOf():undefined;var m=q.max?q.max.valueOf():undefined;if(h!=undefined&&m!=undefined){if(h>=m){var l=1000*60*60*24;m=h+l}if(b>(m-h)){b=(m-h)}if(n>(m-h)){n=(m-h)}}if(d>=o){o+=1000*60*60*24}if(e<n){var p=(n-e);var j=a?(a.valueOf()-d)/e:0.5;d-=Math.round(p*j);o+=Math.round(p*(1-j))}if(e>b){var p=(e-b);var j=a?(a.valueOf()-d)/e:0.5;d+=Math.round(p*j);o-=Math.round(p*(1-j))}if(h!=undefined){var p=(d-h);if(p<0){d-=p;o-=p}}if(m!=undefined){var p=(m-o);if(p<0){d+=p;o+=p}}this.start=new Date(d);this.end=new Date(o)};links.Timeline.prototype.confirmDeleteItem=function(a){this.applyDelete=true;if(!this.isSelected(a)){this.selectItem(a)}this.trigger("delete");if(this.applyDelete){this.deleteItem(a)}delete this.applyDelete};links.Timeline.prototype.deleteItem=function(a,c){if(a>=this.items.length){throw"Cannot delete row, index out of range"}if(this.selection){if(this.selection.index==a){this.unselectItem()}else{if(this.selection.index>a){this.selection.index--}}}var b=this.items.splice(a,1)[0];this.renderQueue.hide.push(b);if(this.data){if(google&&google.visualization&&this.data instanceof google.visualization.DataTable){this.data.removeRow(a)}else{if(links.Timeline.isArray(this.data)){this.data.splice(a,1)}else{throw"Cannot delete row from data, unknown data type"}}}if(!c){this.render()}};links.Timeline.prototype.deleteAllItems=function(){this.unselectItem();this.clearItems();this.deleteGroups();if(this.data){if(google&&google.visualization&&this.data instanceof google.visualization.DataTable){this.data.removeRows(0,this.data.getNumberOfRows())}else{if(links.Timeline.isArray(this.data)){this.data.splice(0,this.data.length)}else{throw"Cannot delete row from data, unknown data type"}}}this.render()};links.Timeline.prototype.getGroupFromHeight=function(b){var c,d,a=this.groups;if(a){if(this.options.axisOnTop){for(c=a.length-1;c>=0;c--){d=a[c];if(b>d.top){return d}}}else{for(c=0;c<a.length;c++){d=a[c];if(b>d.top){return d}}}return d}return undefined};links.Timeline.Item=function(c,a){if(c){this.start=c.start;this.end=c.end;this.content=c.content;this.className=c.className;this.editable=c.editable;this.group=c.group;if(this.start){if(this.end){this.center=(this.start.valueOf()+this.end.valueOf())/2}else{this.center=this.start.valueOf()}}}this.top=0;this.left=0;this.width=0;this.height=0;this.lineWidth=0;this.dotWidth=0;this.dotHeight=0;this.rendered=false;if(a){for(var b in a){if(a.hasOwnProperty(b)){this[b]=a[b]}}}};links.Timeline.Item.prototype.reflow=function(){return false};links.Timeline.Item.prototype.getImageUrls=function(a){if(this.dom){links.imageloader.filterImageUrls(this.dom,a)}};links.Timeline.Item.prototype.select=function(){};links.Timeline.Item.prototype.unselect=function(){};links.Timeline.Item.prototype.createDOM=function(){};links.Timeline.Item.prototype.showDOM=function(a){};links.Timeline.Item.prototype.hideDOM=function(a){};links.Timeline.Item.prototype.updateDOM=function(){};links.Timeline.Item.prototype.updatePosition=function(a){};links.Timeline.Item.prototype.isRendered=function(){return this.rendered};links.Timeline.Item.prototype.isVisible=function(b,a){return false};links.Timeline.Item.prototype.setPosition=function(b,a){};links.Timeline.Item.prototype.getRight=function(a){return 0};links.Timeline.ItemBox=function(b,a){links.Timeline.Item.call(this,b,a)};links.Timeline.ItemBox.prototype=new links.Timeline.Item();links.Timeline.ItemBox.prototype.reflow=function(){var e=this.dom,c=e.dot.offsetHeight,d=e.dot.offsetWidth,a=e.line.offsetWidth,b=((this.dotHeight!=c)||(this.dotWidth!=d)||(this.lineWidth!=a));this.dotHeight=c;this.dotWidth=d;this.lineWidth=a;return b};links.Timeline.ItemBox.prototype.select=function(){var a=this.dom;links.Timeline.addClassName(a,"timeline-event-selected");links.Timeline.addClassName(a.line,"timeline-event-selected");links.Timeline.addClassName(a.dot,"timeline-event-selected")};links.Timeline.ItemBox.prototype.unselect=function(){var a=this.dom;links.Timeline.removeClassName(a,"timeline-event-selected");links.Timeline.removeClassName(a.line,"timeline-event-selected");links.Timeline.removeClassName(a.dot,"timeline-event-selected")};links.Timeline.ItemBox.prototype.createDOM=function(){var c=document.createElement("DIV");c.style.position="absolute";c.style.left=this.left+"px";c.style.top=this.top+"px";var b=document.createElement("DIV");b.className="timeline-event-content";b.innerHTML=this.content;c.appendChild(b);var d=document.createElement("DIV");d.style.position="absolute";d.style.width="0px";c.line=d;var a=document.createElement("DIV");a.style.position="absolute";a.style.width="0px";a.style.height="0px";c.dot=a;this.dom=c;this.updateDOM();return c};links.Timeline.ItemBox.prototype.showDOM=function(a){var b=this.dom;if(!b){b=this.createDOM()}if(b.parentNode!=a){if(b.parentNode){this.hideDOM()}a.appendChild(b);a.insertBefore(b.line,a.firstChild);a.appendChild(b.dot);this.rendered=true}};links.Timeline.ItemBox.prototype.hideDOM=function(){var c=this.dom;if(c){var b=c.parentNode;if(b){var a=function(d){if(d&&d.parentNode){d.parentNode.removeChild(d)}};a(c.line);a(c.dot);a(c);this.rendered=false}}};links.Timeline.ItemBox.prototype.updateDOM=function(){var b=this.dom;if(b){var c=b.line;var a=b.dot;b.firstChild.innerHTML=this.content;b.className="timeline-event timeline-event-box";c.className="timeline-event timeline-event-line";a.className="timeline-event timeline-event-dot";if(this.isCluster){links.Timeline.addClassName(b,"timeline-event-cluster");links.Timeline.addClassName(c,"timeline-event-cluster");links.Timeline.addClassName(a,"timeline-event-cluster")}if(this.className){links.Timeline.addClassName(b,this.className);links.Timeline.addClassName(c,this.className);links.Timeline.addClassName(a,this.className)}}};links.Timeline.ItemBox.prototype.updatePosition=function(g){var e=this.dom;if(e){var c=g.timeToScreen(this.start),f=g.options.axisOnTop,a=g.size.axis.top,d=g.size.axis.height,h=(g.options.box&&g.options.box.align)?g.options.box.align:undefined;e.style.top=this.top+"px";if(h=="right"){e.style.left=(c-this.width)+"px"}else{if(h=="left"){e.style.left=(c)+"px"}else{e.style.left=(c-this.width/2)+"px"}}var j=e.line;var b=e.dot;j.style.left=(c-this.lineWidth/2)+"px";b.style.left=(c-this.dotWidth/2)+"px";if(f){j.style.top=d+"px";j.style.height=Math.max(this.top-d,0)+"px";b.style.top=(d-this.dotHeight/2)+"px"}else{j.style.top=(this.top+this.height)+"px";j.style.height=Math.max(a-this.top-this.height,0)+"px";b.style.top=(a-this.dotHeight/2)+"px"}}};links.Timeline.ItemBox.prototype.isVisible=function(b,a){if(this.cluster){return false}return(this.start>b)&&(this.start<a)};links.Timeline.ItemBox.prototype.setPosition=function(b,a){var c=this.dom;c.style.left=(b-this.width/2)+"px";c.line.style.left=(b-this.lineWidth/2)+"px";c.dot.style.left=(b-this.dotWidth/2)+"px";if(this.group){this.top=this.group.top;c.style.top=this.top+"px"}};links.Timeline.ItemBox.prototype.getRight=function(c){var a=(c.options.box&&c.options.box.align)?c.options.box.align:undefined;var d=c.timeToScreen(this.start);var b;if(a=="right"){b=d}else{if(a=="left"){b=(d+this.width)}else{b=(d+this.width/2)}}return b};links.Timeline.ItemRange=function(b,a){links.Timeline.Item.call(this,b,a)};links.Timeline.ItemRange.prototype=new links.Timeline.Item();links.Timeline.ItemRange.prototype.select=function(){var a=this.dom;links.Timeline.addClassName(a,"timeline-event-selected")};links.Timeline.ItemRange.prototype.unselect=function(){var a=this.dom;links.Timeline.removeClassName(a,"timeline-event-selected")};links.Timeline.ItemRange.prototype.createDOM=function(){var b=document.createElement("DIV");b.style.position="absolute";var a=document.createElement("DIV");a.className="timeline-event-content";b.appendChild(a);this.dom=b;this.updateDOM();return b};links.Timeline.ItemRange.prototype.showDOM=function(a){var b=this.dom;if(!b){b=this.createDOM()}if(b.parentNode!=a){if(b.parentNode){this.hideDOM()}a.appendChild(b);this.rendered=true}};links.Timeline.ItemRange.prototype.hideDOM=function(){var b=this.dom;if(b){var a=b.parentNode;if(a){a.removeChild(b);this.rendered=false}}};links.Timeline.ItemRange.prototype.updateDOM=function(){var a=this.dom;if(a){a.firstChild.innerHTML=this.content;a.className="timeline-event timeline-event-range";if(this.isCluster){links.Timeline.addClassName(a,"timeline-event-cluster")}if(this.className){links.Timeline.addClassName(a,this.className)}}};links.Timeline.ItemRange.prototype.updatePosition=function(c){var e=this.dom;if(e){var a=c.size.contentWidth,d=c.timeToScreen(this.start),b=c.timeToScreen(this.end);if(d<-a){d=-a}if(b>2*a){b=2*a}e.style.top=this.top+"px";e.style.left=d+"px";e.style.width=Math.max(b-d,1)+"px"}};links.Timeline.ItemRange.prototype.isVisible=function(b,a){if(this.cluster){return false}return(this.end>b)&&(this.start<a)};links.Timeline.ItemRange.prototype.setPosition=function(b,a){var c=this.dom;c.style.left=b+"px";c.style.width=(a-b)+"px";if(this.group){this.top=this.group.top;c.style.top=this.top+"px"}};links.Timeline.ItemRange.prototype.getRight=function(a){return a.timeToScreen(this.end)};links.Timeline.ItemDot=function(b,a){links.Timeline.Item.call(this,b,a)};links.Timeline.ItemDot.prototype=new links.Timeline.Item();links.Timeline.ItemDot.prototype.reflow=function(){var e=this.dom,c=e.dot.offsetHeight,d=e.dot.offsetWidth,b=e.content.offsetHeight,a=((this.dotHeight!=c)||(this.dotWidth!=d)||(this.contentHeight!=b));this.dotHeight=c;this.dotWidth=d;this.contentHeight=b;return a};links.Timeline.ItemDot.prototype.select=function(){var a=this.dom;links.Timeline.addClassName(a,"timeline-event-selected")};links.Timeline.ItemDot.prototype.unselect=function(){var a=this.dom;links.Timeline.removeClassName(a,"timeline-event-selected")};links.Timeline.ItemDot.prototype.createDOM=function(){var c=document.createElement("DIV");c.style.position="absolute";var b=document.createElement("DIV");b.className="timeline-event-content";c.appendChild(b);var a=document.createElement("DIV");a.style.position="absolute";a.style.width="0px";a.style.height="0px";c.appendChild(a);c.content=b;c.dot=a;this.dom=c;this.updateDOM();return c};links.Timeline.ItemDot.prototype.showDOM=function(a){var b=this.dom;if(!b){b=this.createDOM()}if(b.parentNode!=a){if(b.parentNode){this.hideDOM()}a.appendChild(b);this.rendered=true}};links.Timeline.ItemDot.prototype.hideDOM=function(){var b=this.dom;if(b){var a=b.parentNode;if(a){a.removeChild(b);this.rendered=false}}};links.Timeline.ItemDot.prototype.updateDOM=function(){if(this.dom){var b=this.dom;var a=b.dot;b.firstChild.innerHTML=this.content;a.className="timeline-event timeline-event-dot";if(this.isCluster){links.Timeline.addClassName(b,"timeline-event-cluster");links.Timeline.addClassName(a,"timeline-event-cluster")}if(this.className){links.Timeline.addClassName(b,this.className);links.Timeline.addClassName(a,this.className)}}};links.Timeline.ItemDot.prototype.updatePosition=function(a){var c=this.dom;if(c){var b=a.timeToScreen(this.start);c.style.top=this.top+"px";c.style.left=(b-this.dotWidth/2)+"px";c.content.style.marginLeft=(1.5*this.dotWidth)+"px";c.dot.style.top=((this.height-this.dotHeight)/2)+"px"}};links.Timeline.ItemDot.prototype.isVisible=function(b,a){if(this.cluster){return false}return(this.start>b)&&(this.start<a)};links.Timeline.ItemDot.prototype.setPosition=function(b,a){var c=this.dom;c.style.left=(b-this.dotWidth/2)+"px";if(this.group){this.top=this.group.top;c.style.top=this.top+"px"}};links.Timeline.ItemDot.prototype.getRight=function(a){return a.timeToScreen(this.start)+this.width};links.Timeline.prototype.getItem=function(a){if(a>=this.items.length){throw"Cannot get item, index out of range"}var c=this.items[a];var b={};b.start=new Date(c.start);if(c.end){b.end=new Date(c.end)}b.content=c.content;if(c.group){b.group=this.getGroupName(c.group)}return b};links.Timeline.prototype.addItem=function(a){var b=[a];this.addItems(b)};links.Timeline.prototype.addItems=function(c){var b=this,a=this.items;AJS.$.each(c,function(f,d){var e=a.length;a.push(b.createItem(d));b.updateData(e,d)});this.render({animate:false})};links.Timeline.prototype.createItem=function(a){var c=a.end?"range":this.options.style;var e={start:a.start,end:a.end,content:a.content,className:a.className,editable:a.editable,group:this.getGroup(a.group)};var d,b=this.options;if(b.axisOnTop){d=this.size.axis.height+b.eventMarginAxis+b.eventMargin/2}else{d=this.size.contentHeight-b.eventMarginAxis-b.eventMargin/2}if(c in this.itemTypes){return new this.itemTypes[c](e,{top:d})}console.log('ERROR: Unknown event style "'+c+'"');return new links.Timeline.Item(e,{top:d})};links.Timeline.prototype.changeItem=function(b,a){var d=this.items[b];if(!d){throw"Cannot change item, index out of range"}var c=this.createItem({start:a.hasOwnProperty("start")?a.start:d.start,end:a.hasOwnProperty("end")?a.end:d.end,content:a.hasOwnProperty("content")?a.content:d.content,group:a.hasOwnProperty("group")?a.group:this.getGroupName(d.group)});this.items[b]=c;this.renderQueue.hide.push(d);this.renderQueue.show.push(c);this.updateData(b,a);this.render({animate:false});c.select()};links.Timeline.prototype.deleteGroups=function(){this.groups=[];this.groupIndexes={}};links.Timeline.prototype.getGroup=function(g){var b=this.groups,c=this.groupIndexes,e=undefined;var f=c[g];if(f===undefined&&g!==undefined){e={content:g,labelTop:0,lineTop:0};b.push(e);b=b.sort(function(j,h){if(j.content>h.content){return 1}if(j.content<h.content){return -1}return 0});for(var d=0,a=b.length;d<a;d++){c[b[d].content]=d}}else{e=b[f]}return e};links.Timeline.prototype.getGroupName=function(a){return a?a.content:undefined};links.Timeline.prototype.cancelChange=function(){this.applyChange=false};links.Timeline.prototype.cancelDelete=function(){this.applyDelete=false};links.Timeline.prototype.cancelAdd=function(){this.applyAdd=false};links.Timeline.prototype.setSelection=function(g,h){if(g!=undefined&&g.length>0){if(g[0].row!=undefined){var e=g[0].row;if(this.items[e]){var j=this.items[e];this.selectItem(e);var a=j.start;var c=j.end;var k;if(c!=undefined){k=new Date((c.valueOf()+a.valueOf())/2)}else{k=new Date(a)}var f=(this.end.valueOf()-this.start.valueOf()),d=new Date(k.valueOf()-f/2),b=new Date(k.valueOf()+f/2);if(!h){this.setVisibleChartRange(d,b)}return true}}}else{this.unselectItem()}return false};links.Timeline.prototype.getSelection=function(){var a=[];if(this.selection){a.push({row:this.selection.index})}return a};links.Timeline.prototype.selectItem=function(a){this.unselectItem();this.selection=undefined;if(this.items[a]!==undefined){var c=this.items[a],b=c.dom;this.selection={index:a,item:b};if(this.isEditable(c)){b.style.cursor="move"}c.select();this.repaintDeleteButton();this.repaintDragAreas()}};links.Timeline.prototype.isSelected=function(a){return(this.selection&&this.selection.index===a)};links.Timeline.prototype.unselectItem=function(){if(this.selection){var b=this.items[this.selection.index];if(b&&b.dom){var a=b.dom;a.style.cursor="";b.unselect()}this.selection=undefined;this.repaintDeleteButton();this.repaintDragAreas()}};links.Timeline.prototype.stackItems=function(b){if(this.groups.length>0){return}if(b==undefined){b=false}var a=this.stack;if(!a){a={};this.stack=a}a.sortedItems=this.stackOrder(this.renderedItems);a.finalItems=this.stackCalculateFinal(a.sortedItems);if(b||a.timer){var d=this;var c=function(){var e=d.stackMoveOneStep(a.sortedItems,a.finalItems);d.repaint();if(!e){a.timer=setTimeout(c,30)}else{delete a.timer}};if(!a.timer){a.timer=setTimeout(c,30)}}else{this.stackMoveToFinal(a.sortedItems,a.finalItems)}};links.Timeline.prototype.stackCancelAnimation=function(){if(this.stack&&this.stack.timer){clearTimeout(this.stack.timer);delete this.stack.timer}};links.Timeline.prototype.stackOrder=function(a){var c=a.concat([]);var b=function(f,e){var d;if((f instanceof links.Timeline.ItemRange)&&!(e instanceof links.Timeline.ItemRange)){return -1}if(!(f instanceof links.Timeline.ItemRange)&&(e instanceof links.Timeline.ItemRange)){return 1}d=(f.start-e.start);if(!d){d=(e.width-f.width)}if(!d){d=(e.bottom-f.bottom)}return d};c.sort(b);return c};links.Timeline.prototype.stackCalculateFinal=function(l){var p,o,j=this.size,d=j.axis.top,g=j.axis.height,a=this.options,t=a.axisOnTop,c=a.eventMargin,n=a.eventMarginAxis,f=[];for(p=0,o=l.length;p<o;p++){var r=l[p],h,e,k=r.height,m=r.width,s=r.getRight(this),b=s-m;if(t){h=g+n+c/2}else{h=d-k-n-c/2}e=h+k;f[p]={left:b,top:h,right:s,bottom:e,height:k,item:r}}if(this.options.stackEvents){for(p=0,o=f.length;p<o;p++){var u=f[p];var q=null;do{q=this.stackItemsCheckOverlap(f,p,0,p-1);if(q!=null){if(t){u.top=q.top+q.height+c}else{u.top=q.top-u.height-c}u.bottom=u.top+u.height}}while(q)}}return f};links.Timeline.prototype.stackMoveOneStep=function(e,j){var c=true;for(i=0,iMax=e.length;i<iMax;i++){var d=j[i],k=d.item;var h=parseInt(k.top);var f=parseInt(d.top);var g=(f-h);if(g){var a=(f==h)?0:((f>h)?1:-1);if(Math.abs(g)>4){a=g/4}var b=parseInt(h+a);if(b!=f){c=false}k.top=b;k.bottom=k.top+k.height}else{k.top=d.top;k.bottom=d.bottom}k.left=d.left;k.right=d.right}return c};links.Timeline.prototype.stackMoveToFinal=function(a,b){for(i=0,iMax=a.length;i<iMax;i++){var c=a[i],d=b[i];c.left=d.left;c.top=d.top;c.right=d.right;c.bottom=d.bottom}};links.Timeline.prototype.stackItemsCheckOverlap=function(h,a,g,f){var b=this.options.eventMargin,j=this.collision;var e=h[a];for(var c=f;c>=g;c--){var d=h[c];if(j(e,d,b)){if(c!=a){return d}}}return undefined};links.Timeline.prototype.collision=function(b,a,c){if(c==undefined){c=0}return(b.left-c<a.right&&b.right+c>a.left&&b.top-c<a.bottom&&b.bottom+c>a.top)};links.Timeline.prototype.trigger=function(d){var c=null,b,a;switch(d){case"rangechange":case"rangechanged":c={start:new Date(this.start),end:new Date(this.end)};break;case"timechange":case"timechanged":c={time:new Date(this.customTime)};break;case"add":b=this.eventParams.mouseX-links.Timeline.getAbsoluteLeft(this.dom.content);a=this.screenToTime(b);c={start:a};break}links.events.trigger(this,d,c);if(google&&google.visualization){google.visualization.events.trigger(this,d,c)}};links.Timeline.prototype.clusterItems=function(){if(!this.options.cluster){return}var b=this.clusterGenerator.getClusters(this.conversion.factor);if(this.clusters!=b){var a=this.renderQueue;if(this.clusters){AJS.$.each(this.clusters,function(d,c){a.hide.push(c);AJS.$.each(c.items,function(f,e){e.cluster=undefined})})}AJS.$.each(b,function(d,c){AJS.$.each(c.items,function(f,e){e.cluster=c})});this.clusters=b}};links.Timeline.prototype.filterItems=function(){var a=this.renderQueue,d=this.end.valueOf()-this.start.valueOf(),e=new Date(this.start.valueOf()-d),b=new Date(this.end.valueOf()+d);function c(f){AJS.$.each(f,function(h,g){var k=g.rendered;var j=g.isVisible(e,b);if(k!=j){if(k){a.hide.push(g)}if(j&&AJS.$.inArray(g,a.show)==-1){a.show.push(g)}}})}c(this.items);if(this.clusters){c(this.clusters)}};links.Timeline.ClusterGenerator=function(a){this.timeline=a;this.clear()};links.Timeline.ClusterGenerator.prototype.clear=function(){this.items=[];this.groups={};this.clearCache()};links.Timeline.ClusterGenerator.prototype.clearCache=function(){this.cache={};this.cacheLevel=-1;this.cache[this.cacheLevel]=[]};links.Timeline.ClusterGenerator.prototype.setData=function(a,b){this.items=a||[];this.dataChanged=true;this.applyOnChangedLevel=true;if(b&&b.applyOnChangedLevel){this.applyOnChangedLevel=b.applyOnChangedLevel}};links.Timeline.ClusterGenerator.prototype.filterData=function(){var b=this.items||[];var a={};this.groups=a;AJS.$.each(b,function(e,d){var g=d.group?d.group.content:"";var f=a[g];if(!f){f=[];a[g]=f}f.push(d)});for(var c in a){if(a.hasOwnProperty(c)){a[c].sort(function(e,d){return(e.center-d.center)})}}this.dataChanged=false};links.Timeline.ClusterGenerator.prototype.getClusters=function(K){var a=-1,b=2,x=0,H=5;if(K>0){a=Math.round(Math.log(100/K)/Math.log(b));x=Math.pow(b,a);if(this.timeline.groups&&this.timeline.groups.length){x*=4}}if(this.dataChanged){var w=(a!=this.cacheLevel);var D=this.applyOnChangedLevel?w:true;if(D){this.clearCache();this.filterData()}}this.cacheLevel=a;var h=this.cache[a];if(!h){h=[];for(var q in this.groups){if(this.groups.hasOwnProperty(q)){var r=this.groups[q];var z=r.length;var G=0;while(G<z){var J=r[G];var v=1;var E=G-1;while(E>=0&&(J.center-r[E].center)<x/2){if(!r[E].cluster){v++}E--}var C=G+1;while(C<r.length&&(r[C].center-J.center)<x/2){v++;C++}var A=h.length-1;while(A>=0&&(J.center-h[A].center)<x/2){if(J.group==h[A].group){v++}A--}if(v>H){var n=v-H+1;var d=[];var t=undefined;var y=undefined;var F=undefined;var f=false;var g=0;var u=G;while(d.length<n&&u<r.length){var s=r[u];var e=s.start.valueOf();var c=s.end?s.end.valueOf():s.start.valueOf();d.push(s);if(g){t=(g/(g+1))*t+(1/(g+1))*s.center}else{t=s.center}y=(y!=undefined)?Math.min(y,e):e;F=(F!=undefined)?Math.max(F,c):c;f=f||(s instanceof links.Timeline.ItemRange);g++;u++}var I;var L="Cluster containing "+g+" events. Zoom in to see the individual events.";var B='<div title="'+L+'">'+g+" events</div>";var o=J.group?J.group.content:undefined;if(f){I=this.timeline.createItem({start:new Date(y),end:new Date(F),content:B,group:o})}else{I=this.timeline.createItem({start:new Date(t),content:B,group:o})}I.isCluster=true;I.items=d;AJS.$.each(I.items,function(k,j){j.cluster=I});h.push(I);G+=n}else{delete J.cluster;G+=1}}}}this.cache[a]=h}return h};links.events=links.events||{listeners:[],indexOf:function(b){var d=this.listeners;for(var c=0,a=this.listeners.length;c<a;c++){var e=d[c];if(e&&e.object==b){return c}}return -1},addListener:function(b,d,f){var a=this.indexOf(b);var e=this.listeners[a];if(!e){e={object:b,events:{}};this.listeners.push(e)}var c=e.events[d];if(!c){c=[];e.events[d]=c}if(AJS.$.inArray(f,c)==-1){c.push(f)}},removeListener:function(c,a,j){var f=this.indexOf(c);var b=this.listeners[f];if(b){var h=b.events[a];if(h){var f=AJS.$.inArray(j,h);if(f!=-1){h.splice(f,1)}if(h.length==0){delete b.events[a]}}var d=0;var k=b.events;for(var g in k){if(k.hasOwnProperty(g)){d++}}if(d==0){delete this.listeners[f]}}},removeAllListeners:function(){this.listeners=[]},trigger:function(c,g,e){var b=this.indexOf(c);var h=this.listeners[b];if(h){var f=h.events[g];if(f){for(var d=0,a=f.length;d<a;d++){f[d](e)}}}}};links.Timeline.StepDate=function(c,a,b){this.current=new Date();this._start=new Date();this._end=new Date();this.autoScale=true;this.scale=links.Timeline.StepDate.SCALE.DAY;this.step=1;this.setRange(c,a,b)};links.Timeline.StepDate.SCALE={MILLISECOND:1,SECOND:2,MINUTE:3,HOUR:4,DAY:5,WEEKDAY:6,MONTH:7,YEAR:8};links.Timeline.StepDate.prototype.setRange=function(c,a,b){if(isNaN(c)||isNaN(a)){return}this._start=(c!=undefined)?new Date(c):new Date();this._end=(a!=undefined)?new Date(a):new Date();if(this.autoScale){this.setMinimumStep(b)}};links.Timeline.StepDate.prototype.start=function(){this.current=new Date(this._start);this.roundToMinor()};links.Timeline.StepDate.prototype.roundToMinor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step));this.current.setMonth(0);case links.Timeline.StepDate.SCALE.MONTH:this.current.setDate(1);case links.Timeline.StepDate.SCALE.DAY:case links.Timeline.StepDate.SCALE.WEEKDAY:this.current.setHours(0);case links.Timeline.StepDate.SCALE.HOUR:this.current.setMinutes(0);case links.Timeline.StepDate.SCALE.MINUTE:this.current.setSeconds(0);case links.Timeline.StepDate.SCALE.SECOND:this.current.setMilliseconds(0)}if(this.step!=1){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate((this.current.getDate()-1)-(this.current.getDate()-1)%this.step+1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step);break;default:break}}};links.Timeline.StepDate.prototype.end=function(){return(this.current.getTime()>this._end.getTime())};links.Timeline.StepDate.prototype.next=function(){var b=this.current.getTime();if(this.current.getMonth()<6){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.getTime()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current=new Date(this.current.getTime()+this.step*1000);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current=new Date(this.current.getTime()+this.step*1000*60);break;case links.Timeline.StepDate.SCALE.HOUR:this.current=new Date(this.current.getTime()+this.step*1000*60*60);var a=this.current.getHours();this.current.setHours(a-(a%this.step));break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step);break;default:break}}else{switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.getTime()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()+this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()+this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()+this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step);break;default:break}}if(this.step!=1){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:if(this.current.getMilliseconds()<this.step){this.current.setMilliseconds(0)}break;case links.Timeline.StepDate.SCALE.SECOND:if(this.current.getSeconds()<this.step){this.current.setSeconds(0)}break;case links.Timeline.StepDate.SCALE.MINUTE:if(this.current.getMinutes()<this.step){this.current.setMinutes(0)}break;case links.Timeline.StepDate.SCALE.HOUR:if(this.current.getHours()<this.step){this.current.setHours(0)}break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:if(this.current.getDate()<this.step+1){this.current.setDate(1)}break;case links.Timeline.StepDate.SCALE.MONTH:if(this.current.getMonth()<this.step){this.current.setMonth(0)}break;case links.Timeline.StepDate.SCALE.YEAR:break;default:break}}if(this.current.getTime()==b){this.current=new Date(this._end)}};links.Timeline.StepDate.prototype.getCurrent=function(){return this.current};links.Timeline.StepDate.prototype.setScale=function(b,a){this.scale=b;if(a>0){this.step=a}this.autoScale=false};links.Timeline.StepDate.prototype.setAutoScale=function(a){this.autoScale=a};links.Timeline.StepDate.prototype.setMinimumStep=function(f){if(f==undefined){return}var b=(1000*60*60*24*30*12);var a=(1000*60*60*24*30);var e=(1000*60*60*24);var g=(1000*60*60);var d=(1000*60);var h=(1000);var c=(1);if(b*1000>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=1000}if(b*500>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=500}if(b*100>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=100}if(b*50>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=50}if(b*10>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=10}if(b*5>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=5}if(b>f){this.scale=links.Timeline.StepDate.SCALE.YEAR;this.step=1}if(a*3>f){this.scale=links.Timeline.StepDate.SCALE.MONTH;this.step=3}if(a>f){this.scale=links.Timeline.StepDate.SCALE.MONTH;this.step=1}if(e*5>f){this.scale=links.Timeline.StepDate.SCALE.DAY;this.step=5}if(e*2>f){this.scale=links.Timeline.StepDate.SCALE.DAY;this.step=2}if(e>f){this.scale=links.Timeline.StepDate.SCALE.DAY;this.step=1}if(e/2>f){this.scale=links.Timeline.StepDate.SCALE.WEEKDAY;this.step=1}if(g*4>f){this.scale=links.Timeline.StepDate.SCALE.HOUR;this.step=4}if(g>f){this.scale=links.Timeline.StepDate.SCALE.HOUR;this.step=1}if(d*15>f){this.scale=links.Timeline.StepDate.SCALE.MINUTE;this.step=15}if(d*10>f){this.scale=links.Timeline.StepDate.SCALE.MINUTE;this.step=10}if(d*5>f){this.scale=links.Timeline.StepDate.SCALE.MINUTE;this.step=5}if(d>f){this.scale=links.Timeline.StepDate.SCALE.MINUTE;this.step=1}if(h*15>f){this.scale=links.Timeline.StepDate.SCALE.SECOND;this.step=15}if(h*10>f){this.scale=links.Timeline.StepDate.SCALE.SECOND;this.step=10}if(h*5>f){this.scale=links.Timeline.StepDate.SCALE.SECOND;this.step=5}if(h>f){this.scale=links.Timeline.StepDate.SCALE.SECOND;this.step=1}if(c*200>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=200}if(c*100>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=100}if(c*50>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=50}if(c*10>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=10}if(c*5>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=5}if(c>f){this.scale=links.Timeline.StepDate.SCALE.MILLISECOND;this.step=1}};links.Timeline.StepDate.prototype.snap=function(a){if(this.scale==links.Timeline.StepDate.SCALE.YEAR){var b=a.getFullYear()+Math.round(a.getMonth()/12);a.setFullYear(Math.round(b/this.step)*this.step);a.setMonth(0);a.setDate(0);a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0)}else{if(this.scale==links.Timeline.StepDate.SCALE.MONTH){if(a.getDate()>15){a.setDate(1);a.setMonth(a.getMonth()+1)}else{a.setDate(1)}a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0)}else{if(this.scale==links.Timeline.StepDate.SCALE.DAY||this.scale==links.Timeline.StepDate.SCALE.WEEKDAY){switch(this.step){case 5:case 2:a.setHours(Math.round(a.getHours()/24)*24);break;default:a.setHours(Math.round(a.getHours()/12)*12);break}a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0)}else{if(this.scale==links.Timeline.StepDate.SCALE.HOUR){switch(this.step){case 4:a.setMinutes(Math.round(a.getMinutes()/60)*60);break;default:a.setMinutes(Math.round(a.getMinutes()/30)*30);break}a.setSeconds(0);a.setMilliseconds(0)}else{if(this.scale==links.Timeline.StepDate.SCALE.MINUTE){switch(this.step){case 15:case 10:a.setMinutes(Math.round(a.getMinutes()/5)*5);a.setSeconds(0);break;case 5:a.setSeconds(Math.round(a.getSeconds()/60)*60);break;default:a.setSeconds(Math.round(a.getSeconds()/30)*30);break}a.setMilliseconds(0)}else{if(this.scale==links.Timeline.StepDate.SCALE.SECOND){switch(this.step){case 15:case 10:a.setSeconds(Math.round(a.getSeconds()/5)*5);a.setMilliseconds(0);break;case 5:a.setMilliseconds(Math.round(a.getMilliseconds()/1000)*1000);break;default:a.setMilliseconds(Math.round(a.getMilliseconds()/500)*500);break}}else{if(this.scale==links.Timeline.StepDate.SCALE.MILLISECOND){var c=this.step>5?this.step/2:1;a.setMilliseconds(Math.round(a.getMilliseconds()/c)*c)}}}}}}}};links.Timeline.StepDate.prototype.isMajor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return(this.current.getMilliseconds()==0);case links.Timeline.StepDate.SCALE.SECOND:return(this.current.getSeconds()==0);case links.Timeline.StepDate.SCALE.MINUTE:return(this.current.getHours()==0)&&(this.current.getMinutes()==0);case links.Timeline.StepDate.SCALE.HOUR:return(this.current.getHours()==0);case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return(this.current.getDate()==1);case links.Timeline.StepDate.SCALE.MONTH:return(this.current.getMonth()==0);case links.Timeline.StepDate.SCALE.YEAR:return false;default:return false}};links.Timeline.StepDate.prototype.getLabelMinor=function(a){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];if(a==undefined){a=this.current}switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return String(a.getMilliseconds());case links.Timeline.StepDate.SCALE.SECOND:return String(a.getSeconds());case links.Timeline.StepDate.SCALE.MINUTE:return this.addZeros(a.getHours(),2)+":"+this.addZeros(a.getMinutes(),2);case links.Timeline.StepDate.SCALE.HOUR:return this.addZeros(a.getHours(),2)+":"+this.addZeros(a.getMinutes(),2);case links.Timeline.StepDate.SCALE.WEEKDAY:return c[a.getDay()]+" "+a.getDate();case links.Timeline.StepDate.SCALE.DAY:return String(a.getDate());case links.Timeline.StepDate.SCALE.MONTH:return b[a.getMonth()];case links.Timeline.StepDate.SCALE.YEAR:return String(a.getFullYear());default:return""}};links.Timeline.StepDate.prototype.getLabelMajor=function(c,b){var a=c.months,d=c.days;if(b==undefined){b=this.current}switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.addZeros(b.getHours(),2)+":"+this.addZeros(b.getMinutes(),2)+":"+this.addZeros(b.getSeconds(),2);case links.Timeline.StepDate.SCALE.SECOND:return b.getDate()+" "+a[b.getMonth()]+" "+this.addZeros(b.getHours(),2)+":"+this.addZeros(b.getMinutes(),2);case links.Timeline.StepDate.SCALE.MINUTE:return d[b.getDay()]+" "+b.getDate()+" "+a[b.getMonth()]+" "+b.getFullYear();case links.Timeline.StepDate.SCALE.HOUR:return d[b.getDay()]+" "+b.getDate()+" "+a[b.getMonth()]+" "+b.getFullYear();case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return a[b.getMonth()]+" "+b.getFullYear();case links.Timeline.StepDate.SCALE.MONTH:return String(b.getFullYear());default:return""}};links.Timeline.StepDate.prototype.addZeros=function(b,a){var c=""+b;while(c.length<a){c="0"+c}return c};links.imageloader=(function(){var g={};var c={};function a(h){if(g[h]==true){return true}var j=new Image();j.src=h;if(j.complete){return true}return false}function b(h){return(c[h]!=undefined)}function f(h,m,j){if(j==undefined){j=true}if(a(h)){if(j){m(h)}return}if(b(h)&&!j){return}var l=c[h];if(!l){var k=new Image();k.src=h;l=[];c[h]=l;k.onload=function(o){g[h]=true;delete c[h];for(var n=0;n<l.length;n++){l[n](h)}}}if(AJS.$.inArray(m,l)==-1){l.push(m)}}function e(k,m,j){var l=[];AJS.$.each(k,function(o,n){if(!a(n)){l.push(n)}});if(l.length){var h=l.length;AJS.$.each(l,function(o,n){f(n,function(){h--;if(h==0){m()}},j)})}else{if(j){m()}}}function d(j,k){var l=j.firstChild;while(l){if(l.tagName=="IMG"){var h=l.src;if(AJS.$.inArray(h,k)==-1){k.push(h)}}d(l,k);l=l.nextSibling}}return{isLoaded:a,isLoading:b,load:f,loadAll:e,filterImageUrls:d}})();links.Timeline.addEventListener=function(b,d,c,a){if(b.addEventListener){if(a===undefined){a=false}if(d==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){d="DOMMouseScroll"}b.addEventListener(d,c,a)}else{b.attachEvent("on"+d,c)}};links.Timeline.removeEventListener=function(b,d,c,a){if(b.removeEventListener){if(a===undefined){a=false}if(d==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){d="DOMMouseScroll"}b.removeEventListener(d,c,a)}else{b.detachEvent("on"+d,c)}};links.Timeline.getTarget=function(a){if(!a){a=window.event}var b;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType!==undefined&&b.nodeType==3){b=b.parentNode}return b};links.Timeline.stopPropagation=function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}};links.Timeline.preventDefault=function(a){if(!a){a=window.event}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};links.Timeline.getAbsoluteLeft=function(a){var b=0;while(a!=null){b+=a.offsetLeft;b-=a.scrollLeft;a=a.offsetParent}if(!document.body.scrollLeft&&window.pageXOffset){b-=window.pageXOffset}return b};links.Timeline.getAbsoluteTop=function(a){var b=0;while(a!=null){b+=a.offsetTop;b-=a.scrollTop;a=a.offsetParent}if(!document.body.scrollTop&&window.pageYOffset){b-=window.pageYOffset}return b};links.Timeline.addClassName=function(c,b){var a=c.className.split(" ");if(AJS.$.inArray(b,a)==-1){a.push(b);c.className=a.join(" ")}};links.Timeline.removeClassName=function(d,c){var b=d.className.split(" ");var a=AJS.$.inArray(c,b);if(a!=-1){b.splice(a,1);d.className=b.join(" ")}};links.Timeline.isArray=function(a){if(a instanceof Array){return true}return(Object.prototype.toString.call(a)==="[object Array]")};links.Timeline.parseJSONDate=function(b){if(b==undefined){return undefined}if(b instanceof Date){return b}var a=b.match(/\/Date\((-?\d+)([-\+]?\d{2})?(\d{2})?\)\//i);if(a){var c=a[2]?(3600000*a[2])+(60000*a[3]*(a[2]/Math.abs(a[2]))):0;return new Date((1*a[1])+c)}return Date.parse(b)};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/calendar-util.js' */
(function($){if(!Confluence.TeamCalendars){Confluence.TeamCalendars={}}Confluence.TeamCalendars.ajaxTimeout=120000;Confluence.TeamCalendars.Dialogs={};Confluence.TeamCalendars.getSortedSubCalendarsByTypeAndName=function(subCalendars){if(!subCalendars){return[]}var subCalendarsByTypes={};$.each(subCalendars,function(subCalendarIdx,subCalendar){var subCalendarType=subCalendar.subscriptionType||subCalendar.type,subCalendarsOfType;if(!subCalendarsByTypes[subCalendarType]){subCalendarsOfType=[];subCalendarsByTypes[subCalendarType]=subCalendarsOfType}else{subCalendarsOfType=subCalendarsByTypes[subCalendarType]}subCalendarsOfType.push(subCalendar)});$.each(subCalendarsByTypes,function(subCalendarType,subCalendarsOfType){subCalendarsOfType.sort(function(leftSubCalendar,rightSubCalendar){var leftName=(leftSubCalendar.name||"").toLowerCase(),rightName=(rightSubCalendar.name||"").toLowerCase();return leftName>rightName?-1:(rightName>leftName?1:0)})});var sortedSubCalendars=[];$.each($.grep((function(){var theOrder=[];$.each(Confluence.TeamCalendars.subcalendar,function(handleType,handler){theOrder.push(handleType)});theOrder.sort(function(leftType,rightType){return Confluence.TeamCalendars.subcalendar[leftType].weight-Confluence.TeamCalendars.subcalendar[rightType].weight});return theOrder})(),function(subCalendarType){return subCalendarsByTypes[subCalendarType]}),function(typeIdx,subCalendarType){$.each(subCalendarsByTypes[subCalendarType],function(subCalendarIdx,subCalendar){sortedSubCalendars.push(subCalendar)})});$.each(sortedSubCalendars,function(subCalendarIdx,subCalendar){if($.isArray(subCalendar.childSubCalendars)&&subCalendar.childSubCalendars.length){subCalendar.childSubCalendars.sort(function(leftChild,rightChild){var leftChildWeight=window.Confluence.TeamCalendars.subcalendar[leftChild.subscriptionType||leftChild.type].weight,rightChildWeight=window.Confluence.TeamCalendars.subcalendar[rightChild.subscriptionType||rightChild.type].weight;return leftChildWeight<rightChildWeight?-1:(leftChildWeight>rightChildWeight?1:0)})}});return sortedSubCalendars},Confluence.TeamCalendars.getAsArray=function(){var theArray=[];$.each(arguments,function(argIdx,argument){if($.isArray(argument)){$.each(argument,function(argIdx,argElem){if(typeof argElem==="string"){theArray.push(argElem)}else{if($.isPlainObject(argElem)&&argElem.id&&typeof argElem.id==="string"){theArray.push(argElem.id)}else{theArray.push(argElem.toString())}}})}else{theArray.push(argument.toString())}});return theArray};Confluence.TeamCalendars.showDialogInUpdatedHeight=function(aDialog){if(!aDialog.getCurrentPanel().body.is(":visible")){aDialog.show()}aDialog.updateHeight();aDialog.popup.element.css("height","");aDialog.popup.element.find("div.dialog-panel-body").css("height","");aDialog.popup.element.find("form, div.buttons-container").css("margin-bottom","0");aDialog.popup.changeSize(undefined,aDialog.popup.element.outerHeight());aDialog.hide();aDialog.show()};Confluence.TeamCalendars.populateTimeZoneDropDown=function(timeZoneSelect,timeZoneToSelect,onSuccess,onError){var spinner=$(".spinner",timeZoneSelect.parent());spinner.removeClass("hidden");$.ajax({type:"GET",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getRestBaseUrl()+"/timezones/calendar",success:function(timeZones){timeZoneSelect.html(Confluence.TeamCalendars.Templates.timeZoneDropDown(timeZones)).val(timeZoneToSelect);spinner.addClass("hidden");onSuccess()},error:function(XMLHttpRequest,textStatus,errorThrown){spinner.addClass("hidden");onError(XMLHttpRequest,textStatus,errorThrown)}})};Confluence.TeamCalendars.getRestBaseUrl=function(){return Confluence.getContextPath()+"/rest/calendar-services/1.0"};Confluence.TeamCalendars.getCalendarServiceBaseUrl=function(relativePath){return Confluence.TeamCalendars.getRestBaseUrl()+"/calendar"+relativePath};Confluence.TeamCalendars.mergeSubCalendarObjectsToArray=function(arrayWithSubCalendarObject){if(arrayWithSubCalendarObject&&$.isArray(arrayWithSubCalendarObject)){var mergeSubCalendarIntoContainingObject=function(objectContainingSubCalendar){$.extend(objectContainingSubCalendar,objectContainingSubCalendar.subCalendar);delete objectContainingSubCalendar.subCalendar};$.each(arrayWithSubCalendarObject,function(idx,arrayElement){mergeSubCalendarIntoContainingObject(arrayElement);$.each(arrayElement.childSubCalendars||[],function(childIdx,objectContainingChildSubCalendar){mergeSubCalendarIntoContainingObject(objectContainingChildSubCalendar)})})}var rearrangeSubCalendars=function(subCalendars){if(!(subCalendars&&subCalendars.length)){return}var subscriptionsParent={name:"Subscriptions",type:"subscription",dummy:true,id:"dummy"},subscriptionChildSubCalendars=[],rearrangedSubCalendars=[];$.each(subCalendars,function(idx,subCalendar){if(Confluence.TeamCalendars.isSubscriptionSubCalendar(subCalendar)){subscriptionChildSubCalendars.push(subCalendar)}else{rearrangedSubCalendars.push(subCalendar)}});if(subscriptionChildSubCalendars.length){subscriptionsParent.childSubCalendars=subscriptionChildSubCalendars;rearrangedSubCalendars.push(subscriptionsParent)}subCalendars.length=0;$.merge(subCalendars,rearrangedSubCalendars)};rearrangeSubCalendars(arrayWithSubCalendarObject);return arrayWithSubCalendarObject};Confluence.TeamCalendars.isRequireOauth=function(XMLHttpRequest){var authHeader=XMLHttpRequest.getResponseHeader("WWW-Authenticate")||"";var realmRegEx=/OAuth realm\=\"([^\"]+)\"/;var matches=realmRegEx.exec(authHeader);if(matches){return matches[1]}else{return null}};Confluence.TeamCalendars.setFieldErrors=function(container,fieldErrors){$("div.error",container).empty();if(!fieldErrors){return}var _fieldErrors=$.isArray(fieldErrors)?fieldErrors:[fieldErrors];if($.isArray(fieldErrors)){for(var fieldErrorIndex=0;fieldErrorIndex<_fieldErrors.length;++fieldErrorIndex){var fieldName=_fieldErrors[fieldErrorIndex].field;var _errorMessages=$.isArray(_fieldErrors[fieldErrorIndex].errorMessages)?_fieldErrors[fieldErrorIndex].errorMessages:[_fieldErrors[fieldErrorIndex].errorMessages];if(fieldName&&_errorMessages){var errorDiv=$("div."+fieldName+"-error");for(var errorMsgIndex=0;errorMsgIndex<_errorMessages.length;++errorMsgIndex){$(document.createElement("div")).text(_errorMessages[errorMsgIndex]).appendTo(errorDiv)}}}}};Confluence.TeamCalendars.setGenericErrors=function(container,message,errorClass){var errorPanel=$(".calendar-error",container);var _errorClass=errorClass||"general";var errorMessagesList=$("ul.error-messages",errorPanel);var errorMessageItem=$("li."+errorClass,errorMessagesList);if(message){if(!errorMessageItem.length){errorMessageItem=$(document.createElement("li")).addClass(_errorClass).appendTo(errorMessagesList)}if($.isArray(message)){if(message.length>1){var subMessagesList=$(document.createElement("ul"));$.each(message,function(index,value){$(document.createElement("li")).text(value).appendTo(subMessagesList)});subMessagesList.appendTo(errorMessageItem)}else{errorMessageItem.text(message[0])}}else{if($.isPlainObject(message)){var theMessage=message.message||"";if(message["status-code"]){errorMessageItem.text(message["status-code"]+" - "+theMessage)}else{errorMessageItem.text(theMessage)}}else{errorMessageItem.text(message)}}}else{errorMessageItem.remove()}if(errorMessagesList.children().length){errorMessagesList.removeClass("hidden");errorPanel.removeClass("hidden")}else{errorMessagesList.addClass("hidden");errorPanel.addClass("hidden")}};Confluence.TeamCalendars.showAjaxError=function(container,XMLHttpRequest,textStatus,errorThrown,errorClass){Confluence.TeamCalendars.setGenericErrors(container,("application/json"===XMLHttpRequest.getResponseHeader("Content-Type")?eval("("+XMLHttpRequest.responseText+")"):(errorThrown||textStatus||XMLHttpRequest.responseText||"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.")),errorClass)};Confluence.TeamCalendars.getUserTimeZone=function(){return $("input[name='userTimeZoneId']").val()||$("#team-calendars-user-timezone").attr("content")};Confluence.TeamCalendars.shouldShowTimezoneSetup=function(){return !$("#team-calendars-timezone-setup-dialog").length&&$("#team-calendars-show-timezone-setup").length};Confluence.TeamCalendars.suppressMessage=function(errorContainer,messageKey,successCallback){$.ajax({cache:false,data:{messageKey:messageKey},error:function(XMLHttpRequest,textStatus,errorThrown){Confluence.TeamCalendars.showAjaxError(errorContainer,XMLHttpRequest,textStatus,errorThrown,"error-config-update")},success:function(){Confluence.TeamCalendars.setGenericErrors(errorContainer,null,"error-config-update");if(successCallback&&$.isFunction(successCallback)){successCallback()}},type:"DELETE",url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/preferences/messagekey.json")})};Confluence.TeamCalendars.fireEventForAnalytics=function(eventName,properties){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:"teamcalendars."+eventName,properties:properties||{}})};Confluence.TeamCalendars.isPDLEnabled=function(){return AJS.Meta.getNumber("build-number")>=4000};Confluence.TeamCalendars.isJiraSubCalendar=function(subCalendar){return subCalendar.type==="jira"||subCalendar.subscriptionType==="jira"||subCalendar.type==="jira-agile-sprint"||subCalendar.subscriptionType==="jira-agile-sprint"||subCalendar.type==="jira-project-releases"||subCalendar.subscriptionType==="jira-project-releases"};Confluence.TeamCalendars.isSubscriptionSubCalendar=function(subCalendar){return subCalendar.type==="subscription"||subCalendar.subscriptionType==="subscription"};Confluence.TeamCalendars.isInternalSubscriptionSubCalendar=function(subCalendar){return subCalendar.type==="internal-subscription"};Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar=function(subCalendar){return subCalendar.dummy&&Confluence.TeamCalendars.isSubscriptionSubCalendar(subCalendar)};Confluence.TeamCalendars.isCalendarSearchDisabled=$("#team-calendars-search-disabled").length;Confluence.TeamCalendars.hasJiraLink=$("#team-calendars-has-jira-link").length;Confluence.TeamCalendars.updateDateDisplay=function(calendarDiv,displayHtml){$(".date-display",calendarDiv).html(displayHtml||"")};Confluence.TeamCalendars.isDisplayTimeFormat24hour=function(){return AJS.Meta.get("team-calendars-display-time-format")==="displayTimeFormat24"};Confluence.TeamCalendars.convertTimeAMTo24hour=function(timeConvert){if(timeConvert===null||timeConvert===undefined||Confluence.TeamCalendars.isDisplayTimeFormat24hour()){return timeConvert}var hours=parseInt(timeConvert.substr(0,2));if(timeConvert.indexOf("AM")!==-1&&hours===12){timeConvert=timeConvert.replace("12","0")}if(timeConvert.indexOf("PM")!==-1&&hours<12){timeConvert=timeConvert.replace(hours,(hours+12))}return timeConvert.replace(/(AM|PM)/,"").trim()};Confluence.TeamCalendars.showCalendarPopupHaveAnEmptySubcalendar=function(showPopularDialog,showCalendarDialog){$.ajax({dataType:"json",success:function(responseEntity){if(responseEntity){showPopularDialog()}else{showCalendarDialog()}},type:"GET",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/haspopular.json")})}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jquery.ui.resizable.js' */
(function(c){c.widget("ui.resizable",c.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var e=this,j=this.options;this.element.addClass("ui-resizable");c.extend(this,{_aspectRatio:!!(j.aspectRatio),aspectRatio:j.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:j.helper||j.ghost||j.animate?j.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css("position"))&&c.browser.opera){this.element.css({position:"relative",top:"auto",left:"auto"})}this.element.wrap(c('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=j.handles||(!c(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all"){this.handles="n,e,s,w,se,sw,ne,nw"}var k=this.handles.split(",");this.handles={};for(var f=0;f<k.length;f++){var h=c.trim(k[f]),d="ui-resizable-"+h;var g=c('<div class="ui-resizable-handle '+d+'"></div>');if(/sw|se|ne|nw/.test(h)){g.css({zIndex:++j.zIndex})}if("se"==h){g.addClass("ui-icon ui-icon-gripsmall-diagonal-se")}this.handles[h]=".ui-resizable-"+h;this.element.append(g)}}this._renderAxis=function(p){p=p||this.element;for(var m in this.handles){if(this.handles[m].constructor==String){this.handles[m]=c(this.handles[m],this.element).show()}if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=c(this.handles[m],this.element),o=0;o=/sw|ne|nw|se|n|s/.test(m)?n.outerHeight():n.outerWidth();var l=["padding",/ne|nw|n/.test(m)?"Top":/se|sw|s/.test(m)?"Bottom":/^e$/.test(m)?"Right":"Left"].join("");p.css(l,o);this._proportionallyResize()}if(!c(this.handles[m]).length){continue}}};this._renderAxis(this.element);this._handles=c(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!e.resizing){if(this.className){var i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)}e.axis=i&&i[1]?i[1]:"se"}});if(j.autoHide){this._handles.hide();c(this.element).addClass("ui-resizable-autohide").hover(function(){c(this).removeClass("ui-resizable-autohide");e._handles.show()},function(){if(!e.resizing){c(this).addClass("ui-resizable-autohide");e._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();var d=function(f){c(f).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){d(this.element);var e=this.element;e.after(this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);d(this.originalElement);return this},_mouseCapture:function(e){var f=false;for(var d in this.handles){if(c(this.handles[d])[0]==e.target){f=true}}return !this.options.disabled&&f},_mouseStart:function(f){var i=this.options,e=this.element.position(),d=this.element;this.resizing=true;this.documentScroll={top:c(document).scrollTop(),left:c(document).scrollLeft()};if(d.is(".ui-draggable")||(/absolute/).test(d.css("position"))){d.css({position:"absolute",top:e.top,left:e.left})}if(c.browser.opera&&(/relative/).test(d.css("position"))){d.css({position:"relative",top:"auto",left:"auto"})}this._renderProxy();var j=b(this.helper.css("left")),g=b(this.helper.css("top"));if(i.containment){j+=c(i.containment).scrollLeft()||0;g+=c(i.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:j,top:g};this.size=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalSize=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalPosition={left:j,top:g};this.sizeDiff={width:d.outerWidth()-d.width(),height:d.outerHeight()-d.height()};this.originalMousePosition={left:f.pageX,top:f.pageY};this.aspectRatio=(typeof i.aspectRatio=="number")?i.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var h=c(".ui-resizable-"+this.axis).css("cursor");c("body").css("cursor",h=="auto"?this.axis+"-resize":h);d.addClass("ui-resizable-resizing");this._propagate("start",f);return true},_mouseDrag:function(d){var g=this.helper,f=this.options,l={},p=this,i=this.originalMousePosition,m=this.axis;var q=(d.pageX-i.left)||0,n=(d.pageY-i.top)||0;var h=this._change[m];if(!h){return false}var k=h.apply(this,[d,q,n]),j=c.browser.msie&&c.browser.version<7,e=this.sizeDiff;if(this._aspectRatio||d.shiftKey){k=this._updateRatio(k,d)}k=this._respectSize(k,d);this._propagate("resize",d);g.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize()}this._updateCache(k);this._trigger("resize",d,this.ui());return false},_mouseStop:function(g){this.resizing=false;var h=this.options,l=this;if(this._helper){var f=this._proportionallyResizeElements,d=f.length&&(/textarea/i).test(f[0].nodeName),e=d&&c.ui.hasScroll(f[0],"left")?0:l.sizeDiff.height,j=d?0:l.sizeDiff.width;var m={width:(l.size.width-j),height:(l.size.height-e)},i=(parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left))||null,k=(parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top))||null;if(!h.animate){this.element.css(c.extend(m,{top:k,left:i}))}l.helper.height(l.size.height);l.helper.width(l.size.width);if(this._helper&&!h.animate){this._proportionallyResize()}}c("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",g);if(this._helper){this.helper.remove()}return false},_updateCache:function(d){var e=this.options;this.offset=this.helper.offset();if(a(d.left)){this.position.left=d.left}if(a(d.top)){this.position.top=d.top}if(a(d.height)){this.size.height=d.height}if(a(d.width)){this.size.width=d.width}},_updateRatio:function(g,f){var h=this.options,i=this.position,e=this.size,d=this.axis;if(g.height){g.width=(e.height*this.aspectRatio)}else{if(g.width){g.height=(e.width/this.aspectRatio)}}if(d=="sw"){g.left=i.left+(e.width-g.width);g.top=null}if(d=="nw"){g.top=i.top+(e.height-g.height);g.left=i.left+(e.width-g.width)}return g},_respectSize:function(k,f){var i=this.helper,h=this.options,q=this._aspectRatio||f.shiftKey,p=this.axis,s=a(k.width)&&h.maxWidth&&(h.maxWidth<k.width),l=a(k.height)&&h.maxHeight&&(h.maxHeight<k.height),g=a(k.width)&&h.minWidth&&(h.minWidth>k.width),r=a(k.height)&&h.minHeight&&(h.minHeight>k.height);if(g){k.width=h.minWidth}if(r){k.height=h.minHeight}if(s){k.width=h.maxWidth}if(l){k.height=h.maxHeight}var e=this.originalPosition.left+this.originalSize.width,n=this.position.top+this.size.height;var j=/sw|nw|w/.test(p),d=/nw|ne|n/.test(p);if(g&&j){k.left=e-h.minWidth}if(s&&j){k.left=e-h.maxWidth}if(r&&d){k.top=n-h.minHeight}if(l&&d){k.top=n-h.maxHeight}var m=!k.width&&!k.height;if(m&&!k.left&&k.top){k.top=null}else{if(m&&!k.top&&k.left){k.left=null}}return k},_proportionallyResize:function(){var j=this.options;if(!this._proportionallyResizeElements.length){return}var f=this.helper||this.element;for(var e=0;e<this._proportionallyResizeElements.length;e++){var g=this._proportionallyResizeElements[e];if(!this.borderDif){var d=[g.css("borderTopWidth"),g.css("borderRightWidth"),g.css("borderBottomWidth"),g.css("borderLeftWidth")],h=[g.css("paddingTop"),g.css("paddingRight"),g.css("paddingBottom"),g.css("paddingLeft")];this.borderDif=c.map(d,function(k,m){var l=parseInt(k,10)||0,n=parseInt(h[m],10)||0;return l+n})}if(c.browser.msie&&!(!(c(f).is(":hidden")||c(f).parents(":hidden").length))){continue}g.css({height:(f.height()-this.borderDif[0]-this.borderDif[2])||0,width:(f.width()-this.borderDif[1]-this.borderDif[3])||0})}},_renderProxy:function(){var e=this.element,h=this.options;this.elementOffset=e.offset();if(this._helper){this.helper=this.helper||c('<div style="overflow:hidden;"></div>');var d=c.browser.msie&&c.browser.version<7,f=(d?1:0),g=(d?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+g,height:this.element.outerHeight()+g,position:"absolute",left:this.elementOffset.left-f+"px",top:this.elementOffset.top-f+"px",zIndex:++h.zIndex});this.helper.appendTo("body").disableSelection()}else{this.helper=this.element}},_change:{e:function(f,e,d){return{width:this.originalSize.width+e}},w:function(g,e,d){var i=this.options,f=this.originalSize,h=this.originalPosition;return{left:h.left+e,width:f.width-e}},n:function(g,e,d){var i=this.options,f=this.originalSize,h=this.originalPosition;return{top:h.top+d,height:f.height-d}},s:function(f,e,d){return{height:this.originalSize.height+d}},se:function(f,e,d){return c.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[f,e,d]))},sw:function(f,e,d){return c.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[f,e,d]))},ne:function(f,e,d){return c.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[f,e,d]))},nw:function(f,e,d){return c.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[f,e,d]))}},_propagate:function(e,d){c.ui.plugin.call(this,e,[d,this.ui()]);(e!="resize"&&this._trigger(e,d,this.ui()))},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});c.extend(c.ui.resizable,{version:"1.8.1"});c.ui.plugin.add("resizable","alsoResize",{start:function(e,f){var d=c(this).data("resizable"),h=d.options;var g=function(i){c(i).each(function(){c(this).data("resizable-alsoresize",{width:parseInt(c(this).width(),10),height:parseInt(c(this).height(),10),left:parseInt(c(this).css("left"),10),top:parseInt(c(this).css("top"),10)})})};if(typeof(h.alsoResize)=="object"&&!h.alsoResize.parentNode){if(h.alsoResize.length){h.alsoResize=h.alsoResize[0];g(h.alsoResize)}else{c.each(h.alsoResize,function(i,j){g(i)})}}else{g(h.alsoResize)}},resize:function(f,h){var e=c(this).data("resizable"),i=e.options,g=e.originalSize,k=e.originalPosition;var j={height:(e.size.height-g.height)||0,width:(e.size.width-g.width)||0,top:(e.position.top-k.top)||0,left:(e.position.left-k.left)||0},d=function(l,m){c(l).each(function(){var p=c(this),q=c(this).data("resizable-alsoresize"),o={},n=m&&m.length?m:["width","height","top","left"];c.each(n||["width","height","top","left"],function(r,t){var s=(q[t]||0)+(j[t]||0);if(s&&s>=0){o[t]=s||null}});if(/relative/.test(p.css("position"))&&c.browser.opera){e._revertToRelativePosition=true;p.css({position:"absolute",top:"auto",left:"auto"})}p.css(o)})};if(typeof(i.alsoResize)=="object"&&!i.alsoResize.nodeType){c.each(i.alsoResize,function(l,m){d(l,m)})}else{d(i.alsoResize)}},stop:function(e,f){var d=c(this).data("resizable");if(d._revertToRelativePosition&&c.browser.opera){d._revertToRelativePosition=false;el.css({position:"relative"})}c(this).removeData("resizable-alsoresize-start")}});c.ui.plugin.add("resizable","animate",{stop:function(h,m){var n=c(this).data("resizable"),i=n.options;var g=n._proportionallyResizeElements,d=g.length&&(/textarea/i).test(g[0].nodeName),e=d&&c.ui.hasScroll(g[0],"left")?0:n.sizeDiff.height,k=d?0:n.sizeDiff.width;var f={width:(n.size.width-k),height:(n.size.height-e)},j=(parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left))||null,l=(parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top))||null;n.element.animate(c.extend(f,l&&j?{top:l,left:j}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var o={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};if(g&&g.length){c(g[0]).css({width:o.width,height:o.height})}n._updateCache(o);n._propagate("resize",h)}})}});c.ui.plugin.add("resizable","containment",{start:function(e,q){var s=c(this).data("resizable"),i=s.options,k=s.element;var f=i.containment,j=(f instanceof c)?f.get(0):(/parent/.test(f))?k.parent().get(0):f;if(!j){return}s.containerElement=c(j);if(/document/.test(f)||f==document){s.containerOffset={left:0,top:0};s.containerPosition={left:0,top:0};s.parentData={element:c(document),left:0,top:0,width:c(document).width(),height:c(document).height()||document.body.parentNode.scrollHeight}}else{var m=c(j),h=[];c(["Top","Right","Left","Bottom"]).each(function(p,o){h[p]=b(m.css("padding"+o))});s.containerOffset=m.offset();s.containerPosition=m.position();s.containerSize={height:(m.innerHeight()-h[3]),width:(m.innerWidth()-h[1])};var n=s.containerOffset,d=s.containerSize.height,l=s.containerSize.width,g=(c.ui.hasScroll(j,"left")?j.scrollWidth:l),r=(c.ui.hasScroll(j)?j.scrollHeight:d);s.parentData={element:j,left:n.left,top:n.top,width:g,height:r}}},resize:function(f,p){var s=c(this).data("resizable"),h=s.options,e=s.containerSize,n=s.containerOffset,l=s.size,m=s.position,q=s._aspectRatio||f.shiftKey,d={top:0,left:0},g=s.containerElement;if(g[0]!=document&&(/static/).test(g.css("position"))){d=n}if(m.left<(s._helper?n.left:0)){s.size.width=s.size.width+(s._helper?(s.position.left-n.left):(s.position.left-d.left));if(q){s.size.height=s.size.width/h.aspectRatio}s.position.left=h.helper?n.left:0}if(m.top<(s._helper?n.top:0)){s.size.height=s.size.height+(s._helper?(s.position.top-n.top):s.position.top);if(q){s.size.width=s.size.height*h.aspectRatio}s.position.top=s._helper?n.top:0}s.offset.left=s.parentData.left+s.position.left;s.offset.top=s.parentData.top+s.position.top;var k=Math.abs((s._helper?s.offset.left-d.left:(s.offset.left-d.left))+s.sizeDiff.width),r=Math.abs((s._helper?s.offset.top-d.top:(s.offset.top-n.top))+s.sizeDiff.height);var j=s.containerElement.get(0)==s.element.parent().get(0),i=/relative|absolute/.test(s.containerElement.css("position"));if(j&&i){k-=s.parentData.left}if(k+s.size.width>=s.parentData.width){s.size.width=s.parentData.width-k;if(q){s.size.height=s.size.width/s.aspectRatio}}if(r+s.size.height>=s.parentData.height){s.size.height=s.parentData.height-r;if(q){s.size.width=s.size.height*s.aspectRatio}}},stop:function(e,m){var p=c(this).data("resizable"),f=p.options,k=p.position,l=p.containerOffset,d=p.containerPosition,g=p.containerElement;var i=c(p.helper),q=i.offset(),n=i.outerWidth()-p.sizeDiff.width,j=i.outerHeight()-p.sizeDiff.height;if(p._helper&&!f.animate&&(/relative/).test(g.css("position"))){c(this).css({left:q.left-d.left-l.left,width:n,height:j})}if(p._helper&&!f.animate&&(/static/).test(g.css("position"))){c(this).css({left:q.left-d.left-l.left,width:n,height:j})}}});c.ui.plugin.add("resizable","ghost",{start:function(f,g){var d=c(this).data("resizable"),h=d.options,e=d.size;d.ghost=d.originalElement.clone();d.ghost.css({opacity:0.25,display:"block",position:"relative",height:e.height,width:e.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof h.ghost=="string"?h.ghost:"");d.ghost.appendTo(d.helper)},resize:function(e,f){var d=c(this).data("resizable"),g=d.options;if(d.ghost){d.ghost.css({position:"relative",height:d.size.height,width:d.size.width})}},stop:function(e,f){var d=c(this).data("resizable"),g=d.options;if(d.ghost&&d.helper){d.helper.get(0).removeChild(d.ghost.get(0))}}});c.ui.plugin.add("resizable","grid",{resize:function(d,l){var n=c(this).data("resizable"),g=n.options,j=n.size,h=n.originalSize,i=n.originalPosition,m=n.axis,k=g._aspectRatio||d.shiftKey;g.grid=typeof g.grid=="number"?[g.grid,g.grid]:g.grid;var f=Math.round((j.width-h.width)/(g.grid[0]||1))*(g.grid[0]||1),e=Math.round((j.height-h.height)/(g.grid[1]||1))*(g.grid[1]||1);if(/^(se|s|e)$/.test(m)){n.size.width=h.width+f;n.size.height=h.height+e}else{if(/^(ne)$/.test(m)){n.size.width=h.width+f;n.size.height=h.height+e;n.position.top=i.top-e}else{if(/^(sw)$/.test(m)){n.size.width=h.width+f;n.size.height=h.height+e;n.position.left=i.left-f}else{n.size.width=h.width+f;n.size.height=h.height+e;n.position.top=i.top-e;n.position.left=i.left-f}}}}});var b=function(d){return parseInt(d,10)||0};var a=function(d){return !isNaN(parseInt(d,10))}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/fullcalendar.js' */
/*!
 * FullCalendar v1.6.4
 * Docs & License: http://arshaw.com/fullcalendar/
 * (c) 2013 Adam Shaw
 */
(function(au,v){var N={defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:true,weekNumbers:false,weekNumberCalculation:"iso",weekNumberTitle:"W",allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:"start",endParam:"end",titleFormat:{month:"MMMM yyyy",week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:"dddd, MMM d, yyyy"},columnFormat:{month:"ddd",week:"ddd M/d",day:"dddd M/d"},timeFormat:{"":Confluence.TeamCalendars.isDisplayTimeFormat24hour()===true?"HH:mm":"h(:mm)t"},isRTL:false,firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],buttonText:{prev:"<span class='fc-text-arrow'>&lsaquo;</span>",next:"<span class='fc-text-arrow'>&rsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&laquo;</span>",nextYear:"<span class='fc-text-arrow'>&raquo;</span>",today:"today",month:"month",week:"week",day:"day"},theme:false,buttonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e"},unselectAuto:true,dropAccept:"*",handleWindowResize:true,supportPrint:true};var S={header:{left:"next,prev today",center:"",right:"title"},buttonText:{prev:"<span class='fc-text-arrow'>&rsaquo;</span>",next:"<span class='fc-text-arrow'>&lsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&raquo;</span>",nextYear:"<span class='fc-text-arrow'>&laquo;</span>"},buttonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w"}};var aC=au.fullCalendar={version:"1.6.4"};var af=aC.views={};au.fn.fullCalendar=function(aO){if(typeof aO=="string"){var aN=Array.prototype.slice.call(arguments,1);var aP;this.each(function(){var aR=au.data(this,"fullCalendar");if(aR&&au.isFunction(aR[aO])){var aQ=aR[aO].apply(aR,aN);if(aP===v){aP=aQ}if(aO=="destroy"){au.removeData(this,"fullCalendar")}}});if(aP!==v){return aP}return this}aO=aO||{};var aM=aO.eventSources||[];delete aO.eventSources;if(aO.events){aM.push(aO.events);delete aO.events}aO=au.extend(true,{},N,(aO.isRTL||aO.isRTL===v&&N.isRTL)?S:{},aO);this.each(function(aS,aQ){var aR=au(aQ);var aT=new t(aR,aO,aM);aR.data("fullCalendar",aT);aT.render()});return this};function aj(aM){au.extend(true,N,aM)}function t(a6,bd,bg){var bz=this;bz.options=bd;bz.render=bo;bz.destroy=bB;bz.refetchEvents=a1;bz.reportEvents=a3;bz.reportEventChange=bD;bz.rerenderEvents=aP;bz.changeView=aX;bz.select=bA;bz.unselect=aY;bz.prev=bk;bz.next=aO;bz.prevYear=bC;bz.nextYear=aN;bz.today=a7;bz.gotoDate=bn;bz.incrementDate=ba;bz.formatDate=function(bJ,bI){return D(bJ,bI,bd)};bz.formatDates=function(bK,bJ,bI){return k(bK,bJ,bI,bd)};bz.getDate=bb;bz.getView=bh;bz.option=bw;bz.trigger=bm;s.call(bz,bd,bg);var aM=bz.isFetchNeeded;var bG=bz.fetchEvents;var bx=a6[0];var aR;var bp;var a0;var bH;var aZ;var bl;var aU;var bq=0;var by=0;var bE=new Date();var bf=[];var aS;A(bE,bd.year,bd.month,bd.date);function bo(bP){if(!a0){be()}else{if(bu()){br();bF(bP)}}var bO=au("div.plugin-calendar .calendar-layout");var bL=au("div.plugin-calendar .calendar-panel");var bN=function(bQ){br();bF(bQ)};var bI=function(bQ){bO.css("width",bQ);bL.css("margin-right",0);bN()};var bK=function(){bO.css("width","");bL.css("margin-right","");var bQ=navigator.userAgent.indexOf("Chrome")>-1;if(!bQ){bN()}};if(bd.supportPrint){var bJ=Math.min(bO.width(),1200);if(window.matchMedia){var bM=window.matchMedia("print");bM.addListener(function(bQ){if(aZ.name!=="timeline"){if(bQ.matches){bI(bJ)}else{bK()}}})}au(window).bind("beforeprint",function(){if(aZ.name!=="timeline"){bI(bJ*0.75)}}).bind("afterprint",function(){if(aZ.name!=="timeline"){bK()}})}}function be(){bH=bd.theme?"ui":"fc";a6.addClass("fc");if(bd.isRTL){a6.addClass("fc-rtl")}else{a6.addClass("fc-ltr")}if(bd.theme){a6.addClass("ui-widget")}a0=au("<div class='fc-content' style='position:relative'/>").prependTo(a6);aR=new T(bz,bd);bp=aR.render();if(bp){a6.prepend(bp)}aX(bd.defaultView);if(bd.handleWindowResize){au(window).resize(a2)}if(!a5()){aW()}}function aW(){setTimeout(function(){if(!aZ.start&&a5()){bc()}},0)}function bB(){if(aZ){bm("viewDestroy",aZ,aZ,aZ.element);aZ.triggerEventDestroy()}au(window).unbind("resize",a2);aR.destroy();a0.remove();a6.removeClass("fc fc-rtl ui-widget")}function bu(){return a6.is(":visible")}function a5(){return au("body").is(":visible")}function aX(bI){if(!aZ||bI!=aZ.name){bs(bI)}}function bs(bI){by++;if(aZ){bm("viewDestroy",aZ,aZ,aZ.element);aY();aZ.triggerEventDestroy();aQ();aZ.element.remove();aR.deactivateButton(aZ.name)}aR.activateButton(bI);aZ=new af[bI](au("<div class='fc-view fc-view-"+bI+"' style='position:relative'/>").appendTo(a0),bz);bc();a4();by--}function bc(bI){if(!aZ.start||bI||bE<aZ.start||bE>=aZ.end){if(bu()){bF(bI)}}}function bF(bI){by++;if(aZ.start){bm("viewDestroy",aZ,aZ,aZ.element);aY();bi()}aQ();aZ.render(bE,bI||0);bv();a4();(aZ.afterRender||ar)();a8();bj();bm("viewRender",aZ,aZ,aZ.element);aZ.trigger("viewDisplay",bx);by--;aV()}function a9(){if(bu()){aY();bi();br();bv();aT()}}function br(){if(bd.contentHeight){aU=bd.contentHeight}else{if(bd.height){aU=bd.height-(bp?bp.height():0)-H(a0)}else{aU=Math.round(a0.width()/Math.max(bd.aspectRatio,0.5))}}}function bv(){if(aU===v){br()}by++;aZ.setHeight(aU);aZ.setWidth(a0.width());by--;bl=a6.outerWidth()}function a2(){if(!by){if(aZ.start){var bI=++bq;setTimeout(function(){if(bI==bq&&!by&&bu()){if(bl!=(bl=a6.outerWidth())){by++;a9();aZ.trigger("windowResize",bx);by--}}},200)}else{aW()}}}function a1(){bi();bt()}function aP(bI){bi();aT(bI)}function aT(bI){if(bu()){aZ.setEventData(bf);aZ.renderEvents(bf,bI);aZ.trigger("eventAfterAllRender")}}function bi(){aZ.triggerEventDestroy();aZ.clearEvents();aZ.clearEventData()}function aV(){if(!bd.lazyFetching||aM(aZ.visStart,aZ.visEnd)){bt()}else{aT()}}function bt(){bG(aZ.visStart,aZ.visEnd)}function a3(bI){bf=bI;aT()}function bD(bI){aP(bI)}function a8(){aR.updateTitle(aZ.title)}function bj(){var bI=new Date();if(bI>=aZ.start&&bI<aZ.end){aR.disableButton("today")}else{aR.enableButton("today")}}function bA(bK,bI,bJ){aZ.select(bK,bI,bJ===v?true:bJ)}function aY(){if(aZ){aZ.unselect()}}function bk(){if(aZ.prev){aZ.prev()}else{bc(-1)}}function aO(){if(aZ.next){aZ.next()}else{bc(1)}}function bC(){ai(bE,-1);bc()}function aN(){ai(bE,1);bc()}function a7(){if(aZ.gotoToday){aZ.gotoToday()}else{bE=new Date();bc()}}function bn(bJ,bK,bI){if(bJ instanceof Date){bE=O(bJ)}else{A(bE,bJ,bK,bI)}bc()}function ba(bJ,bI,bK){if(bJ!==v){ai(bE,bJ)}if(bI!==v){p(bE,bI)}if(bK!==v){aE(bE,bK)}bc()}function bb(){return O(bE)}function aQ(){a0.css({width:"100%",height:a0.height(),overflow:"hidden"})}function a4(){a0.css({width:"",height:"",overflow:""})}function bh(){return aZ}function bw(bI,bJ){if(bJ===v){return bd[bI]}if(bI=="height"||bI=="contentHeight"||bI=="aspectRatio"){bd[bI]=bJ;a9()}}function bm(bI,bJ){if(bd[bI]){return bd[bI].apply(bJ||bx,Array.prototype.slice.call(arguments,2))}}if(bd.droppable){au(document).bind("dragstart",function(bK,bL){var bI=bK.target;var bM=au(bI);if(!bM.parents(".fc").length){var bJ=bd.dropAccept;if(au.isFunction(bJ)?bJ.call(bI,bM):bM.is(bJ)){aS=bI;aZ.dragStart(aS,bK,bL)}}}).bind("dragstop",function(bI,bJ){if(aS){aZ.dragStop(aS,bI,bJ);aS=null}})}}function T(aP,aY){var aX=this;aX.render=aN;aX.destroy=aT;aX.updateTitle=aR;aX.activateButton=aM;aX.deactivateButton=aV;aX.disableButton=aO;aX.enableButton=aS;var aQ=au([]);var aU;function aN(){aU=aY.theme?"ui":"fc";var aZ=aY.header;if(aZ){aQ=au("<table class='fc-header' style='width:100%'/>").append(au("<tr/>").append(aW("left")).append(aW("center")).append(aW("right")));return aQ}}function aT(){aQ.remove()}function aW(aZ){var a1=au("<td class='fc-header-"+aZ+"'/>");var a0=aY.header[aZ];if(a0){au.each(a0.split(" "),function(a3){if(a3>0){a1.append("<span class='fc-header-space'/>")}var a2;au.each(this.split(","),function(a6,a5){if(a5=="title"){a1.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(a2){a2.addClass(aU+"-corner-right")}a2=null}else{var a4;if(aP[a5]){a4=aP[a5]}else{if(af[a5]){a4=function(){a7.removeClass(aU+"-state-hover");aP.changeView(a5)}}}if(a4){var a8=aY.theme?G(aY.buttonIcons,a5):null;var a9=G(aY.buttonText,a5);var a7=au("<span class='fc-button fc-button-"+a5+" "+aU+"-state-default'>"+(a8?"<span class='fc-icon-wrap'><span class='ui-icon ui-icon-"+a8+"'/></span>":a9)+"</span>").click(function(){if(!a7.hasClass(aU+"-state-disabled")){a4()}}).mousedown(function(){a7.not("."+aU+"-state-active").not("."+aU+"-state-disabled").addClass(aU+"-state-down")}).mouseup(function(){a7.removeClass(aU+"-state-down")}).hover(function(){a7.not("."+aU+"-state-active").not("."+aU+"-state-disabled").addClass(aU+"-state-hover")},function(){a7.removeClass(aU+"-state-hover").removeClass(aU+"-state-down")}).appendTo(a1);aL(a7);if(!a2){a7.addClass(aU+"-corner-left")}a2=a7}}});if(a2){a2.addClass(aU+"-corner-right")}})}return a1}function aR(aZ){aQ.find("h2").html(aZ)}function aM(aZ){aQ.find("span.fc-button-"+aZ).addClass(aU+"-state-active")}function aV(aZ){aQ.find("span.fc-button-"+aZ).removeClass(aU+"-state-active")}function aO(aZ){aQ.find("span.fc-button-"+aZ).addClass(aU+"-state-disabled")}function aS(aZ){aQ.find("span.fc-button-"+aZ).removeClass(aU+"-state-disabled")}}aC.sourceNormalizers=[];aC.sourceFetchers=[];var n={dataType:"json",cache:false};var W=1;function s(aS,a0){var a2=this;a2.isFetchNeeded=aU;a2.fetchEvents=a1;a2.addEventSource=aP;a2.removeEventSource=aQ;a2.updateEvent=a5;a2.renderEvent=aY;a2.removeEvents=bh;a2.clientEvents=bb;a2.normalizeEvent=aX;var a4=a2.trigger;var aM=a2.getView;var a7=a2.reportEvents;var a9={events:[]};var aN=[a9];var be,ba;var aO=0;var bf=0;var bd=0;var a3=[];for(var bc=0;bc<a0.length;bc++){a6(a0[bc])}function aU(bj,bi){return !be||bj<be||bi>ba}function a1(bm,bj){be=bm;ba=bj;a3=[];var bl=++aO;var bi=aN.length;bf=bi;for(var bk=0;bk<bi;bk++){aT(aN[bk],bl)}}function aT(bj,bi){a8(bj,function(bl){if(bi==aO){if(bl){if(aS.eventDataTransform){bl=au.map(bl,aS.eventDataTransform)}if(bj.eventDataTransform){bl=au.map(bl,bj.eventDataTransform)}for(var bk=0;bk<bl.length;bk++){bl[bk].source=bj;aX(bl[bk])}a3=a3.concat(bl)}bf--;if(!bf){a7(a3)}}})}function a8(bi,bs){var bn;var br=aC.sourceFetchers;var bp;for(bn=0;bn<br.length;bn++){bp=br[bn](bi,be,ba,bs);if(bp===true){return}else{if(typeof bp=="object"){a8(bp,bs);return}}}var bu=bi.events;if(bu){if(au.isFunction(bu)){aW();bu(O(be),O(ba),function(bw){bs(bw);bg()})}else{if(au.isArray(bu)){bs(bu)}else{bs()}}}else{var bj=bi.url;if(bj){var bt=bi.success;var bq=bi.error;var bk=bi.complete;var bv;if(au.isFunction(bi.data)){bv=bi.data()}else{bv=bi.data}var bm=au.extend({},bv||{});var bo=aJ(bi.startParam,aS.startParam);var bl=aJ(bi.endParam,aS.endParam);if(bo){bm[bo]=Math.round(+be/1000)}if(bl){bm[bl]=Math.round(+ba/1000)}aW();au.ajax(au.extend({},n,bi,{data:bm,success:function(bx){bx=bx||[];var bw=J(bt,this,arguments);if(au.isArray(bw)){bx=bw}bs(bx)},error:function(){J(bq,this,arguments);bs()},complete:function(){J(bk,this,arguments);bg()}}))}else{bs()}}}function aP(bi){bi=a6(bi);if(bi){bf++;aT(bi,aO)}}function a6(bi){if(au.isFunction(bi)||au.isArray(bi)){bi={events:bi}}else{if(typeof bi=="string"){bi={url:bi}}}if(typeof bi=="object"){aZ(bi);aN.push(bi);return bi}}function aQ(bi){aN=au.grep(aN,function(bj){return !aV(bj,bi)});a3=au.grep(a3,function(bj){return !aV(bj.source,bi)});a7(a3)}function a5(bn){var bl,bj=a3.length,bo,bi=aM().defaultEventEnd,bm=bn.start-bn._start,bk=bn.end?(bn.end-(bn._end||bi(bn))):0;for(bl=0;bl<bj;bl++){bo=a3[bl];if(bo._id==bn._id&&bo!=bn){bo.start=new Date(+bo.start+bm);if(bn.end){if(bo.end){bo.end=new Date(+bo.end+bk)}else{bo.end=new Date(+bi(bo)+bk)}}else{bo.end=null}bo.title=bn.title;bo.url=bn.url;bo.allDay=bn.allDay;bo.className=bn.className;bo.editable=bn.editable;bo.color=bn.color;bo.backgroundColor=bn.backgroundColor;bo.borderColor=bn.borderColor;bo.textColor=bn.textColor;aX(bo)}}aX(bn);a7(a3)}function aY(bj,bi){aX(bj);if(!bj.source){if(bi){a9.events.push(bj);bj.source=a9}a3.push(bj)}a7(a3)}function bh(bj){if(!bj){a3=[];for(var bi=0;bi<aN.length;bi++){if(au.isArray(aN[bi].events)){aN[bi].events=[]}}}else{if(!au.isFunction(bj)){var bk=bj+"";bj=function(bl){return bl._id==bk}}a3=au.grep(a3,bj,true);for(var bi=0;bi<aN.length;bi++){if(au.isArray(aN[bi].events)){aN[bi].events=au.grep(aN[bi].events,bj,true)}}}a7(a3)}function bb(bi){if(au.isFunction(bi)){return au.grep(a3,bi)}else{if(bi){bi+="";return au.grep(a3,function(bj){return bj._id==bi})}}return a3}function aW(){if(!bd++){a4("loading",null,true,aM())}}function bg(){if(!--bd){a4("loading",null,false,aM())}}function aX(bj){var bk=bj.source||{};var bi=aJ(bk.ignoreTimezone,aS.ignoreTimezone);bj._id=bj._id||(bj.id===v?"_fc"+W++:bj.id+"");if(bj.date){if(!bj.start){bj.start=bj.date}delete bj.date}bj._start=O(bj.start=aa(bj.start,bi));bj.end=aa(bj.end,bi);if(bj.end&&bj.end<=bj.start){bj.end=null}bj._end=bj.end?O(bj.end):null;if(bj.allDay===v){bj.allDay=aJ(bk.allDayDefault,aS.allDayDefault)}if(bj.className){if(typeof bj.className=="string"){bj.className=bj.className.split(/\s+/)}}else{bj.className=[]}}function aZ(bk){if(bk.className){if(typeof bk.className=="string"){bk.className=bk.className.split(/\s+/)}}else{bk.className=[]}var bj=aC.sourceNormalizers;for(var bi=0;bi<bj.length;bi++){bj[bi](bk)}}function aV(bj,bi){return bj&&bi&&aR(bj)==aR(bi)}function aR(bi){return((typeof bi=="object")?(bi.events||bi.url):"")||bi}}aC.addDays=aE;aC.cloneDate=O;aC.parseDate=aa;aC.parseISO8601=o;aC.parseTime=aI;aC.formatDate=D;aC.formatDates=k;var Q=["sun","mon","tue","wed","thu","fri","sat"],ax=86400000,al=3600000,U=60000;function ai(aN,aO,aM){aN.setFullYear(aN.getFullYear()+aO);if(!aM){e(aN)}return aN}function p(aP,aQ,aO){if(+aP){var aM=aP.getMonth()+aQ,aN=O(aP);aN.setDate(1);aN.setMonth(aM);aP.setMonth(aM);if(!aO){e(aP)}while(aP.getMonth()!=aN.getMonth()){aP.setDate(aP.getDate()+(aP<aN?1:-1))}}return aP}function aE(aP,aQ,aO){if(+aP){var aM=aP.getDate()+aQ,aN=O(aP);aN.setHours(9);aN.setDate(aM);aP.setDate(aM);if(!aO){e(aP)}aG(aP,aN)}return aP}function aG(aN,aM){if(+aN){while(aN.getDate()!=aM.getDate()){aN.setTime(+aN+(aN<aM?1:-1)*al)}}}function j(aM,aN){aM.setMinutes(aM.getMinutes()+aN);return aM}function e(aM){aM.setHours(0);aM.setMinutes(0);aM.setSeconds(0);aM.setMilliseconds(0);return aM}function O(aM,aN){if(aN){return e(new Date(+aM))}return new Date(+aM)}function g(){var aM=0,aN;do{aN=new Date(1970,aM++,1)}while(aN.getHours());return aN}function aB(aN,aM){return Math.round((O(aN,true)-O(aM,true))/ax)}function A(aN,aP,aM,aO){if(aP!==v&&aP!=aN.getFullYear()){aN.setDate(1);aN.setMonth(0);aN.setFullYear(aP)}if(aM!==v&&aM!=aN.getMonth()){aN.setDate(1);aN.setMonth(aM)}if(aO!==v){aN.setDate(aO)}}function aa(aN,aM){if(typeof aN=="object"){return aN}if(typeof aN=="number"){return new Date(aN*1000)}if(typeof aN=="string"){if(aN.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(aN)*1000)}if(aM===v){aM=true}return o(aN,aM)||(aN?new Date(aN):null)}return null}function o(aQ,aN){var aM=aQ.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!aM){return null}var aP=new Date(aM[1],0,1);if(aN||!aM[13]){var aO=new Date(aM[1],0,1,9,0);if(aM[3]){aP.setMonth(aM[3]-1);aO.setMonth(aM[3]-1)}if(aM[5]){aP.setDate(aM[5]);aO.setDate(aM[5])}aG(aP,aO);if(aM[7]){aP.setHours(aM[7])}if(aM[8]){aP.setMinutes(aM[8])}if(aM[10]){aP.setSeconds(aM[10])}if(aM[12]){aP.setMilliseconds(Number("0."+aM[12])*1000)}aG(aP,aO)}else{aP.setUTCFullYear(aM[1],aM[3]?aM[3]-1:0,aM[5]||1);aP.setUTCHours(aM[7]||0,aM[8]||0,aM[10]||0,aM[12]?Number("0."+aM[12])*1000:0);if(aM[14]){var aR=Number(aM[16])*60+(aM[18]?Number(aM[18]):0);aR*=aM[15]=="-"?1:-1;aP=new Date(+aP+(aR*60*1000))}}return aP}function aI(aO){if(typeof aO=="number"){return aO*60}if(typeof aO=="object"){return aO.getHours()*60+aO.getMinutes()}var aM=aO.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(aM){var aN=parseInt(aM[1],10);if(aM[3]){aN%=12;if(aM[3].toLowerCase().charAt(0)=="p"){aN+=12}}return aN*60+(aM[2]?parseInt(aM[2],10):0)}}function D(aN,aO,aM){return k(aN,null,aO,aM)}function k(aY,aX,aW,aZ){aZ=aZ||N;var aN=aY,aP=aX,aQ,aR=aW.length,aT,aO,aV,aS="";for(aQ=0;aQ<aR;aQ++){aT=aW.charAt(aQ);if(aT=="'"){for(aO=aQ+1;aO<aR;aO++){if(aW.charAt(aO)=="'"){if(aN){if(aO==aQ+1){aS+="'"}else{aS+=aW.substring(aQ+1,aO)}aQ=aO}break}}}else{if(aT=="("){for(aO=aQ+1;aO<aR;aO++){if(aW.charAt(aO)==")"){var aM=D(aN,aW.substring(aQ+1,aO),aZ);if(parseInt(aM.replace(/\D/,""),10)){aS+=aM}aQ=aO;break}}}else{if(aT=="["){for(aO=aQ+1;aO<aR;aO++){if(aW.charAt(aO)=="]"){var aU=aW.substring(aQ+1,aO);var aM=D(aN,aU,aZ);if(aM!=D(aP,aU,aZ)){aS+=aM}aQ=aO;break}}}else{if(aT=="{"){aN=aX;aP=aY}else{if(aT=="}"){aN=aY;aP=aX}else{for(aO=aR;aO>aQ;aO--){if(aV=aA[aW.substring(aQ,aO)]){if(aN){aS+=aV(aN,aZ)}aQ=aO-1;break}}if(aO==aQ){if(aN){aS+=aT}}}}}}}}return aS}var aA={s:function(aM){return aM.getSeconds()},ss:function(aM){return ac(aM.getSeconds())},m:function(aM){return aM.getMinutes()},mm:function(aM){return ac(aM.getMinutes())},h:function(aM){return aM.getHours()%12||12},hh:function(aM){return ac(aM.getHours()%12||12)},H:function(aM){return aM.getHours()},HH:function(aM){return ac(aM.getHours())},d:function(aM){return aM.getDate()},dd:function(aM){return ac(aM.getDate())},ddd:function(aN,aM){return aM.dayNamesShort[aN.getDay()]},dddd:function(aN,aM){return aM.dayNames[aN.getDay()]},M:function(aM){return aM.getMonth()+1},MM:function(aM){return ac(aM.getMonth()+1)},MMM:function(aN,aM){return aM.monthNamesShort[aN.getMonth()]},MMMM:function(aN,aM){return aM.monthNames[aN.getMonth()]},yy:function(aM){return(aM.getFullYear()+"").substring(2)},yyyy:function(aM){return aM.getFullYear()},t:function(aM){return aM.getHours()<12?"a":"p"},tt:function(aM){return aM.getHours()<12?"am":"pm"},T:function(aM){return aM.getHours()<12?"A":"P"},TT:function(aM){return aM.getHours()<12?"AM":"PM"},u:function(aM){return D(aM,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(aN){var aM=aN.getDate();if(aM>10&&aM<20){return"th"}return["st","nd","rd"][aM%10-1]||"th"},w:function(aN,aM){return aM.weekNumberCalculation(aN)},W:function(aM){return w(aM)}};aC.dateFormatters=aA;function w(aM){var aN;var aO=new Date(aM.getTime());aO.setDate(aO.getDate()+4-(aO.getDay()||7));aN=aO.getTime();aO.setMonth(0);aO.setDate(1);return Math.floor(Math.round((aN-aO)/86400000)/7)+1}aC.applyAll=J;function ao(aM){if(aM.end){return r(aM.end,aM.allDay)}else{return aE(O(aM.start),1)}}function r(aM,aN){aM=O(aM);return aN||aM.getHours()||aM.getMinutes()?aE(aM,1):e(aM)}function u(aN,aM,aO){aN.unbind("mouseover").mouseover(function(aS){var aR=aS.target,aT,aQ,aP;while(aR!=this){aT=aR;aR=aR.parentNode}if((aQ=aT._fci)!==v){aT._fci=v;aP=aM[aQ];aO(aP.event,aP.element,aP);au(aS.target).trigger(aS)}aS.stopPropagation()})}function av(aO,aP,aM){for(var aN=0,aQ;aN<aO.length;aN++){aQ=au(aO[aN]);aQ.width(Math.max(0,aP-i(aQ,aM)))}}function Z(aP,aM,aN){for(var aO=0,aQ;aO<aP.length;aO++){aQ=au(aP[aO]);aQ.height(Math.max(0,aM-H(aQ,aN)))}}function i(aN,aM){return ah(aN)+q(aN)+(aM?ag(aN):0)}function ah(aM){return(parseFloat(au.css(aM[0],"paddingLeft",true))||0)+(parseFloat(au.css(aM[0],"paddingRight",true))||0)}function ag(aM){return(parseFloat(au.css(aM[0],"marginLeft",true))||0)+(parseFloat(au.css(aM[0],"marginRight",true))||0)}function q(aM){return(parseFloat(au.css(aM[0],"borderLeftWidth",true))||0)+(parseFloat(au.css(aM[0],"borderRightWidth",true))||0)}function H(aN,aM){return z(aN)+aq(aN)+(aM?l(aN):0)}function z(aM){return(parseFloat(au.css(aM[0],"paddingTop",true))||0)+(parseFloat(au.css(aM[0],"paddingBottom",true))||0)}function l(aM){return(parseFloat(au.css(aM[0],"marginTop",true))||0)+(parseFloat(au.css(aM[0],"marginBottom",true))||0)}function aq(aM){return(parseFloat(au.css(aM[0],"borderTopWidth",true))||0)+(parseFloat(au.css(aM[0],"borderBottomWidth",true))||0)}function ar(){}function a(aN,aM){return aN-aM}function at(aM){return Math.max.apply(Math,aM)}function ac(aM){return(aM<10?"0":"")+aM}function G(aQ,aM){if(aQ[aM]!==v){return aQ[aM]}var aP=aM.split(/(?=[A-Z])/),aO=aP.length-1,aN;for(;aO>=0;aO--){aN=aQ[aP[aO].toLowerCase()];if(aN!==v){return aN}}return aQ[""]}function aH(aM){return aM.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function aL(aM){aM.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}function f(aM){aM.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last")}function L(aM,aN){aM.each(function(aO,aP){aP.className=aP.className.replace(/^fc-\w*/,"fc-"+Q[aN.getDay()])})}function R(aN,aO){var aM=aN.source||{};var aT=aN.color;var aR=aM.color;var aQ=aO("eventColor");var aU=aN.backgroundColor||aT||aM.backgroundColor||aR||aO("eventBackgroundColor")||aQ;var aP=aN.borderColor||aT||aM.borderColor||aR||aO("eventBorderColor")||aQ;var aV=aN.textColor||aM.textColor||aO("eventTextColor");var aS=[];if(aU){aS.push("background-color:"+aU)}if(aP){aS.push("border-color:"+aP)}if(aV){aS.push("color:"+aV)}return aS.join(";")}function J(aP,aQ,aN){if(au.isFunction(aP)){aP=[aP]}if(aP){var aO;var aM;for(aO=0;aO<aP.length;aO++){aM=aP[aO].apply(aQ,aN)||aM}return aM}}function aJ(){for(var aM=0;aM<arguments.length;aM++){if(arguments[aM]!==v){return arguments[aM]}}}af.timeline=y;function y(aN,aQ){var aM=this;aM.name="timeline";aM.render=aO;aM.title="";var aP=Confluence.TeamCalendars.getTimelineAdapter(aN,aQ.options.calendarPlugin,aQ.options.calendarDiv,aM);function aO(aR,aS){aP.setDate(aR)}aM.update=function(){aQ.refetchEvents(true)};aM.unselect=function(){};aM.setHeight=function(){};aM.setWidth=function(){};aM.clearEvents=function(){};aM.renderEvents=function(aR){aP.renderEvents(aR)};aM.trigger=function(aR,aS){return aQ.trigger.apply(aQ,[aR,aS||aM].concat(Array.prototype.slice.call(arguments,2),[aM]))};aM.next=function(){aP.next()};aM.prev=function(){aP.prev()};aM.gotoDate=function(aR){aQ.gotoDate(aR)};aM.triggerEventDestroy=function(){};aM.clearEventData=function(){};aM.setEventData=function(aR){aP.renderEvents(aR)};aM.element=au(".fc-view-timeline")}af.month=ad;function ad(aR,aQ){var aU=this;aU.render=aM;B.call(aU,aR,aQ,"month");var aN=aU.opt;var aO=aU.renderBasic;var aS=aU.skipHiddenDays;var aP=aU.getCellsPerWeek;var aT=aQ.formatDate;function aM(aX,a2){if(a2){p(aX,a2);aX.setDate(1)}var aV=aN("firstDay");var aW=O(aX,true);aW.setDate(1);var aY=p(O(aW),1);var a3=O(aW);aE(a3,-((a3.getDay()-aV+7)%7));aS(a3);var aZ=O(aY);aE(aZ,(7-aZ.getDay()+aV)%7);aS(aZ,-1,true);var a1=aP();var a0=Math.round(aB(aZ,a3)/7);if(aN("weekMode")=="fixed"){aE(aZ,(6-a0)*7);a0=6}aU.title=aT(aW,aN("titleFormat"));aU.start=aW;aU.end=aY;aU.visStart=a3;aU.visEnd=aZ;aO(a0,a1,true)}}af.basicWeek=aD;function aD(aR,aQ){var aU=this;aU.render=aM;B.call(aU,aR,aQ,"basicWeek");var aN=aU.opt;var aO=aU.renderBasic;var aT=aU.skipHiddenDays;var aP=aU.getCellsPerWeek;var aS=aQ.formatDates;function aM(aZ,a1){if(a1){aE(aZ,a1*7)}var a0=aE(O(aZ),-((aZ.getDay()-aN("firstDay")+7)%7));var aX=aE(O(a0),7);var aW=O(a0);aT(aW);var aV=O(aX);aT(aV,-1,true);var aY=aP();aU.start=a0;aU.end=aX;aU.visStart=aW;aU.visEnd=aV;aU.title=aS(aW,aE(O(aV),-1),aN("titleFormat"));aO(1,aY,false)}}af.basicDay=K;function K(aP,a0){var aY=this;aY.render=a5;var aV=0;B.call(aY,aP,a0,"basicDay");var aN=aY.opt,a4=aY.renderBasic,aT=aY.skipHiddenDays,aZ=a0.formatDate,aU=a0.options.calendarDiv,a2=a0.options.calendarPlugin,aW=1000*60*60*24,a3=parseInt(a2.getParameter(aU,"maxUpcomingDays")),aX=au("<div/>").appendTo(aP),aS=a2.getParameter(aU,"autoAdjustUpcomingEventsHeight")==="true",aM=a2.getParameter(aU,"hideMoreEventsButtonInUpcomingEventsOnClick")==="true",aO=function(){if(aS){aP.css({height:(au(".events-container",aX).height()+5)+"px",overflow:"hidden"})}},aR=false,a1=a3;var aQ=function(bh,bk,bf){aV=aV+1;aX.empty();if(bh.length){var bj=[],a9=new Date(),bb=new Date();aP.removeClass("no-event");au.each(bh,function(bn,bm){var bl=bm.allDay;if(bm.expandDates&&bm.end&&bm.end.getTime()-bm.start.getTime()>=aW){var bo=bm.end;a9.setTime(bm.start.getTime()+aW);if(bl){while(a9<=bo){bb.setTime(a9.getTime()+aW);if(a9>=bk&&bb<=bf){bj.push(au.extend({},bm,{start:new Date(a9.getTime()),end:new Date(bb.getTime()),expanded:true}))}a9.setTime(bb.getTime())}}else{while(a9<bo){bb.setTime(a9.getTime()+Math.min(bo.getTime()-a9.getTime(),aW));if(a9>=bk&&bb<=bf){bj.push(au.extend({},bm,{start:new Date(a9.getTime()),end:new Date(bb.getTime()),allDay:bb.getTime()-a9.getTime()>=aW,showLastIndicator:bb>=bo,expanded:true}))}a9.setTime(bb.getTime())}}}});au.each(bj,function(bl,bm){bh.push(bm)});bh.sort(function(bm,bn){var bl=bm.expanded===bn.expanded?0:(bm.expanded?1:-1);if(0==bl){bl=bm.allDay===bn.allDay?0:(bm.allDay?1:-1)}if(0===bl){bl=bm.start.getTime()-bn.start.getTime()}if(0==bl){bl=bm.title>bn.title?1:(bn.title>bm.title?-1:0)}if(0==bl){bl=bm.subCalendarId>bn.subCalendarId?1:(bn.subCalendarId>bm.subCalendarId?-1:0)}return bl});bh=au.grep(bh,function(bl){return bl.start>=bk});var a8={};au.each(bh,function(bq,bn){var bl=aZ(new Date(),"yyyyMMdd"),bm=aZ(bn.start,"yyyyMMdd"),bp=a8[bm],bo;if(!a8[bm]){bp={today:bm===bl,groupKey:bm,groupDay:bm.substring(6),dateFormatKey:bm.substring(6)+bm.substring(4,6)+bm.substring(0,4),events:[bn]};a8[bm]=bp}else{bo=bp.events;bo.push(bn)}});var bg=parseInt(a2.getParameter(aU,"maxEventsPerUpcomingDay")),bc={},ba={};au.each(a8,function(bl,bn){var bm=bn.events;if(bm&&bm.length&&bm.length>bg){bn.hiddenEventsCount=bm.length-bg;bn.events=bm.slice(0,bg)}bn.events=au.map(bn.events,function(bp){var bq=ba[bp.subCalendarId]||a2.getSubCalendar(aU,bp.subCalendarId),bo=ba[bq.parentId]||a2.getSubCalendar(aU,bq.parentId),br=au.extend({subCalendar:bq,parentSubCalendar:bo},bp);ba[bq.id]=bq;if(bo){ba[bo.id]=bo}bc[br.id]=br;return br})});var bi=[];au.each(a8,function(bl){bi.push(bl)});bi.sort(function(bl,bm){return bl>bm?1:(bm>bl?-1:0)});var a6=au("<div/>").html(Confluence.TeamCalendars.Templates.upcomingEvents({eventGroups:au.map(bi,function(bl){return a8[bl]})})),be=au(".more-events",a6).click(function(){var bm=au(".events-container",a6),bl=be.offset().top-bm.offset().top+bm.scrollTop(),bn=au(".toggleable",a6);if(bn.length){bn.removeClass("hidden toggleable");aP.animate({scrollTop:bl});if(aM){be.addClass("hidden");aP.css("overflow","auto")}else{aO()}}else{be.prop("disabled","disabled").text("Loading...");au.ajax({cache:false,converters:{"text json":function(bo){return bo}},data:{subCalendarIds:(function(){return au.map(au(".child-subcalendar",aU).filter(function(){return !au(this).hasClass("subcalendar-disabled")}),function(bo){return au(bo).data("subCalendarId")})})(),userTimeZoneId:Confluence.TeamCalendars.getUserTimeZone(),start:aZ(bk,"u"),daysMore:a1+=a3},dataFilter:function(bo){var bp=au.parseJSON(bo||"[]");au.each(bp,function(bq,br){a0.normalizeEvent(br)});return bp},dataType:"json",error:function(bo,bq,bp){a2.showAjaxError(aU,bo,bq,bp)},success:function(bo){bo=a2.getEventsTruncated(aU,bo||[],true);var bp=new Date(bk.getTime()+(a1*aW));aQ(bo,bk,bp);au(".more-events",aX).before(au("<div/>",{"class":"showing-events-till",text:AJS.format("Displaying events until {0}",aZ(bp,"dd MMM yyyy"))}));aO()},type:"GET",url:a2.getCalendarServiceBaseUrl(aU,"/events/multiplexed.json")})}return !(aR=true)});aX.append(a6);au(".event-description",a6).ThreeDots({max_rows:1});au(".events li",a6).each(function(bm){var bl=au(this);if(!aR&&bm>=10&&!bl.prev().length){var bn=bl.closest(".event-group");if(!bn.hasClass("toggleable")){bn.addClass("toggleable")}}a2.getEventDetailsDialog(aU,bc[au(this).attr("data-event-id")],bl.hover(function(){bl.addClass("highlighted");a2.hideInlineAuiDialogs()},function(){bl.removeClass("highlighted")}),{hideDelay:10000,noBind:false})});var a7=au(".toggleable",a6).addClass("hidden");if(a7.length||!aM){be.removeClass("hidden")}aO();var bd=function(bl,bn){var bm=bn.attr("data-group-date");bn.text(aZ(new Date(parseInt(bm.substring(4)),parseInt(bm.substring(2,4),10)-1,parseInt(bm.substring(0,2),10)),bl))};au(".other-days",a6).each(function(){bd("dddd",au(this))});au(".day",a6).each(function(){bd("dd",au(this))});au(".month",a6).each(function(){bd("MMM",au(this))})}else{if(aV>1){au("<div/>",{text:AJS.format("No upcoming events in the next {0} days",a3)}).appendTo(aX.empty())}else{au("<img>",{"class":"calendar-upcoming-spinner",src:Confluence.getContextPath()+"/images/icons/wait.gif"}).appendTo(aX.empty())}}};au("<div/>",{"class":"no-events-message",text:"Loading..."}).appendTo(aX);aY.renderEvents=function(a7){aP.css("MozUserSelect","text").attr("unselectable","off").unbind("selectstart.ui");var a6=new Date(aY.visStart.getTime()+aW*(a1=a3));aQ((function(bc,bb,ba){var a8=[];var a9=function(bd){if(bd.allDay){return(bd.start>=bb&&bd.start<ba)||(bd.start<bb&&bd.end>=bb)||(bd.start>=ba&&bd.start<ba)}else{return(bd.start>=bb&&bd.start<ba)||(bd.start<bb&&bd.end>bb)||(bd.start>=ba&&bd.start<ba)}};au.each(bc,function(be,bd){if(a9(bd)){a8.push(bd)}});return a8})(a7,aY.visStart,a6),aY.visStart,a6)};function a5(a7,a9){if(a9){aE(a7,a9)}aT(a7,a9<0?-1:1);var a8=O(a7,true);var a6=aE(O(a8),1);aY.title=aZ(a7,aN("titleFormat"));aY.start=aY.visStart=a8;aY.end=aY.visEnd=a6;a4(1,1,false)}}aj({weekMode:"fixed"});function B(a7,by,aZ){var bx=this;bx.renderBasic=br;bx.setHeight=bv;bx.setWidth=bG;bx.renderDayOverlay=bn;bx.defaultSelectionEnd=bm;bx.renderSelection=bz;bx.clearSelection=aM;bx.reportDayClick=a5;bx.dragStart=aR;bx.dragStop=a0;bx.defaultEventEnd=bL;bx.getHoverListener=function(){return aS};bx.colLeft=bN;bx.colRight=ba;bx.colContentLeft=bu;bx.colContentRight=bs;bx.getIsCellAllDay=function(){return true};bx.allDayRow=a4;bx.getRowCnt=function(){return be};bx.getColCnt=function(){return aU};bx.getColWidth=function(){return bj};bx.getDaySegmentContainer=function(){return a3};aF.call(bx,a7,by,aZ);c.call(bx);an.call(bx);am.call(bx);var bc=bx.opt;var bo=bx.trigger;var bJ=bx.renderOverlay;var aY=bx.clearOverlays;var bt=bx.daySelectionMousedown;var aN=bx.cellToDate;var bC=bx.dateToCell;var bq=bx.rangeToSegments;var bw=by.formatDate;var bd;var a6;var a1;var bh;var aX;var a8;var bk;var bi;var aP;var a3;var bK;var bM;var bj;var a2;var be,aU;var a9;var bA;var aS;var bD;var bE;var bO;var aV;var bb;var bB;var bl;aL(a7.addClass("fc-grid"));function br(bP,bQ,bR){be=bP;aU=bQ;a9=bR;bH();if(!bh){aQ()}bg()}function bH(){bO=bc("theme")?"ui":"fc";aV=bc("columnFormat");bb=bc("weekNumbers");bB=bc("weekNumberTitle");if(bc("weekNumberCalculation")!="iso"){bl="w"}else{bl="W"}}function aQ(){a3=au("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(a7)}function bg(){var bP=bp();if(bd){bd.remove()}bd=au(bP).appendTo(a7);a6=bd.find("thead");a1=a6.find(".fc-day-header");bh=bd.find("tbody");aX=bh.find("tr");a8=bh.find(".fc-day");bk=aX.find("td:first-child");bi=aX.eq(0).find(".fc-day > div");aP=aX.eq(0).find(".fc-day-content > div");f(a6.add(a6.find("tr")));f(aX);aX.eq(0).addClass("fc-first");aX.filter(":last").addClass("fc-last");a8.each(function(bR,bS){var bQ=aN(Math.floor(bR/aU),bR%aU);bo("dayRender",bx,bQ,au(bS))});aT(a8)}function bp(){var bP="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+aO()+bf()+"</table>";return bP}function aO(){var bS=bO+"-widget-header";var bR="";var bQ;var bP;bR+="<thead><tr>";if(bb){bR+="<th class='fc-week-number "+bS+"'>"+aH(bB)+"</th>"}for(bQ=0;bQ<aU;bQ++){bP=aN(0,bQ);bR+="<th class='fc-day-header fc-"+Q[bP.getDay()]+" "+bS+"'>"+aH(bw(bP,aV))+"</th>"}bR+="</tr></thead>";return bR}function bf(){var bR=bO+"-widget-content";var bS="";var bT;var bQ;var bP;bS+="<tbody>";for(bT=0;bT<be;bT++){bS+="<tr class='fc-week'>";if(bb){bP=aN(bT,0);bS+="<td class='fc-week-number "+bR+"'><div>"+aH(bw(bP,bl))+"</div></td>"}for(bQ=0;bQ<aU;bQ++){bP=aN(bT,bQ);bS+=aW(bP)}bS+="</tr>"}bS+="</tbody>";return bS}function aW(bR){var bQ=bO+"-widget-content";var bT=bx.start.getMonth();var bP=e(new Date());var bS="";var bU=["fc-day","fc-"+Q[bR.getDay()],bQ];if(bR.getMonth()!=bT){bU.push("fc-other-month")}if(+bR==+bP){bU.push("fc-today",bO+"-state-highlight")}else{if(bR<bP){bU.push("fc-past")}else{bU.push("fc-future")}}bS+="<td class='"+bU.join(" ")+"' data-date='"+bw(bR,"yyyy-MM-dd")+"'><div>";if(a9){bS+="<div class='fc-day-number'>"+bR.getDate()+"</div>"}bS+="<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>";return bS}function bv(bQ){bM=bQ;var bT=bM-a6.height();var bS;var bR;var bP;if(bc("weekMode")=="variable"){bS=bR=Math.floor(bT/(be==1?2:6))}else{bS=Math.floor(bT/be);bR=bT-bS*(be-1)}bk.each(function(bU,bV){if(bU<be){bP=au(bV);bP.find("> div").css("min-height",(bU==be-1?bR:bS)-H(bP))}})}function bG(bP){bK=bP;bD.clear();bE.clear();a2=0;if(bb){a2=a6.find("th.fc-week-number").outerWidth()}bj=Math.floor((bK-a2)/aU);av(a1.slice(0,-1),bj)}function aT(bP){bP.click(bI).mousedown(bt)}function bI(bQ){if(!bc("selectable")){var bP=o(au(this).data("date"));bo("dayClick",this,bP,true,bQ)}}function bn(bT,bU,bP){if(bP){bA.build()}var bQ=bq(bT,bU);for(var bR=0;bR<bQ.length;bR++){var bS=bQ[bR];aT(bF(bS.row,bS.leftCol,bS.row,bS.rightCol))}}function bF(bS,bT,bQ,bR){var bP=bA.rect(bS,bT,bQ,bR,a7);return bJ(bP,a7)}function bm(bP,bQ){return O(bP)}function bz(bP,bR,bQ){bn(bP,aE(O(bR),1),true)}function aM(){aY()}function a5(bR,bT,bS){var bP=bC(bR);var bQ=a8[bP.row*aU+bP.col];bo("dayClick",bQ,bR,bT,bS)}function aR(bR,bP,bQ){aS.start(function(bS){aY();if(bS){bF(bS.row,bS.col,bS.row,bS.col)}},bP)}function a0(bT,bQ,bR){var bP=aS.stop();aY();if(bP){var bS=aN(bP);bo("drop",bT,bS,true,bQ,bR)}}function bL(bP){return O(bP.start)}bA=new P(function(bP,bS){var bR,bT,bQ;a1.each(function(bV,bU){bR=au(bU);bT=bR.offset().left;if(bV){bQ[1]=bT}bQ=[bT];bS[bV]=bQ});bQ[1]=bT+bR.outerWidth();aX.each(function(bV,bU){if(bV<be){bR=au(bU);bT=bR.offset().top;if(bV){bQ[1]=bT}bQ=[bT];bP[bV]=bQ}});bQ[1]=bT+bR.outerHeight()});aS=new ap(bA);bD=new m(function(bP){return bi.eq(bP)});bE=new m(function(bP){return aP.eq(bP)});function bN(bP){return bD.left(bP)}function ba(bP){return bD.right(bP)}function bu(bP){return bE.left(bP)}function bs(bP){return bE.right(bP)}function a4(bP){return aX.eq(bP)}}function am(){var aN=this;aN.renderEvents=aM;aN.clearEvents=aO;Y.call(aN);function aM(aQ,aP){aN.renderDayEvents(aQ,aP)}function aO(){aN.getDaySegmentContainer().empty()}}af.agendaWeek=h;function h(aR,aQ){var aU=this;aU.render=aM;I.call(aU,aR,aQ,"agendaWeek");var aN=aU.opt;var aO=aU.renderAgenda;var aT=aU.skipHiddenDays;var aP=aU.getCellsPerWeek;var aS=aQ.formatDates;function aM(aZ,a1){if(a1){aE(aZ,a1*7)}var a0=aE(O(aZ),-((aZ.getDay()-aN("firstDay")+7)%7));var aX=aE(O(a0),7);var aW=O(a0);aT(aW);var aV=O(aX);aT(aV,-1,true);var aY=aP();aU.title=aS(aW,aE(O(aV),-1),aN("titleFormat"));aU.start=a0;aU.end=aX;aU.visStart=aW;aU.visEnd=aV;aO(aY)}}af.agendaDay=ay;function ay(aQ,aT){var aP=this;aP.render=aR;I.call(aP,aQ,aT,"agendaDay");var aO=aP.opt;var aM=aP.renderAgenda;var aN=aP.skipHiddenDays;var aS=aT.formatDate;function aR(aV,aX){if(aX){aE(aV,aX)}aN(aV,aX<0?-1:1);var aW=O(aV,true);var aU=aE(O(aW),1);aP.title=aS(aV,aO("titleFormat"));aP.start=aP.visStart=aW;aP.end=aP.visEnd=aU;aM(1)}}aj({allDaySlot:true,allDayText:"all-day",firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:Confluence.TeamCalendars.isDisplayTimeFormat24hour()===true?"HH:mm":"h(:mm)tt",timeFormat:{agenda:Confluence.TeamCalendars.isDisplayTimeFormat24hour()===true?"HH:mm{ - HH:mm}":"h:mm{ - h:mm}"},dragOpacity:{agenda:0.5},minTime:0,maxTime:24,slotEventOverlap:true});function I(cb,a2,bf){var bc=this;bc.renderAgenda=aY;bc.setWidth=bo;bc.setHeight=bk;bc.afterRender=bU;bc.defaultEventEnd=bT;bc.timePosition=ce;bc.getIsCellAllDay=bv;bc.allDayRow=bC;bc.getCoordinateGrid=function(){return bH};bc.getHoverListener=function(){return ca};bc.colLeft=b5;bc.colRight=bM;bc.colContentLeft=cf;bc.colContentRight=aU;bc.getDaySegmentContainer=function(){return a7};bc.getSlotSegmentContainer=function(){return aS};bc.getMinMinute=function(){return bj};bc.getMaxMinute=function(){return aO};bc.getSlotContainer=function(){return a5};bc.getRowCnt=function(){return 1};bc.getColCnt=function(){return bF};bc.getColWidth=function(){return aV};bc.getSnapHeight=function(){return b7};bc.getSnapMinutes=function(){return bs};bc.defaultSelectionEnd=bn;bc.renderDayOverlay=aQ;bc.renderSelection=b3;bc.clearSelection=bY;bc.reportDayClick=a9;bc.dragStart=aW;bc.dragStop=cc;aF.call(bc,cb,a2,bf);c.call(bc);an.call(bc);V.call(bc);var bA=bc.opt;var bD=bc.trigger;var br=bc.renderOverlay;var aP=bc.clearOverlays;var bt=bc.reportSelection;var b1=bc.unselect;var by=bc.daySelectionMousedown;var a4=bc.slotSegHtml;var ba=bc.cellToDate;var aX=bc.dateToCell;var bh=bc.rangeToSegments;var a8=a2.formatDate;var bP;var b8;var bW;var bV;var be;var aR;var aM;var bS;var bL;var cd;var a7;var b9;var b0;var bp;var a5;var aS;var aZ;var aT;var bw;var bJ;var bl;var aV;var bz;var bG;var bs;var a3;var b7;var bF;var bK;var bH;var ca;var bE;var bx;var bg={};var bq;var aN;var bj,aO;var a1;var bQ;var bB;var bu;aL(cb.addClass("fc-agenda"));function aY(cg){bF=cg;bI();if(!bP){bd()}else{bO()}}function bI(){bq=bA("theme")?"ui":"fc";aN=bA("isRTL");bj=aI(bA("minTime"));aO=aI(bA("maxTime"));a1=bA("columnFormat");bQ=bA("weekNumbers");bB=bA("weekNumberTitle");if(bA("weekNumberCalculation")!="iso"){bu="w"}else{bu="W"}bs=bA("snapMinutes")||bA("slotMinutes")}function bd(){var cl=bq+"-widget-header";var cg=bq+"-widget-content";var ck;var cn;var cj;var cm;var ci;var ch=bA("slotMinutes")%15==0;bO();cd=au("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(cb);if(bA("allDaySlot")){a7=au("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(cd);ck="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+cl+" fc-agenda-axis'>"+bA("allDayText")+"</th><td><div class='fc-day-content'><div style='position:relative'/></div></td><th class='"+cl+" fc-agenda-gutter'>&nbsp;</th></tr></table>";b9=au(ck).appendTo(cd);b0=b9.find("tr");bm(b0.find("td"));cd.append("<div class='fc-agenda-divider "+cl+"'><div class='fc-agenda-divider-inner'/></div>")}else{a7=au([])}bp=au("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(cd);a5=au("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(bp);aS=au("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(a5);ck="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>";cn=g();cm=j(O(cn),aO);j(cn,bj);bK=0;for(cj=0;cn<cm;cj++){ci=cn.getMinutes();ck+="<tr class='fc-slot"+cj+" "+(!ci?"":"fc-minor")+"'><th class='fc-agenda-axis "+cl+"'>"+((!ch||!ci)?a8(cn,bA("axisFormat")):"&nbsp;")+"</th><td class='"+cg+"'><div style='position:relative'>&nbsp;</div></td></tr>";j(cn,bA("slotMinutes"));bK++}ck+="</tbody></table>";aZ=au(ck).appendTo(a5);bZ(aZ.find("td"))}function bO(){var cg=b6();if(bP){bP.remove()}bP=au(cg).appendTo(cb);b8=bP.find("thead");bW=b8.find("th").slice(1,-1);bV=bP.find("tbody");be=bV.find("td").slice(0,-1);aR=be.find("> div");aM=be.find(".fc-day-content > div");bS=be.eq(0);bL=aR.eq(0);f(b8.add(b8.find("tr")));f(bV.add(bV.find("tr")))}function b6(){var cg="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+b4()+bX()+"</table>";return cg}function b4(){var cj=bq+"-widget-header";var ch;var ci="";var ck;var cg;ci+="<thead><tr>";if(bQ){ch=ba(0,0);ck=a8(ch,bu);if(aN){ck+=bB}else{ck=bB+ck}ci+="<th class='fc-agenda-axis fc-week-number "+cj+"'>"+aH(ck)+"</th>"}else{ci+="<th class='fc-agenda-axis "+cj+"'>&nbsp;</th>"}for(cg=0;cg<bF;cg++){ch=ba(0,cg);ci+="<th class='fc-"+Q[ch.getDay()]+" fc-col"+cg+" "+cj+"'>"+aH(a8(ch,a1))+"</th>"}ci+="<th class='fc-agenda-gutter "+cj+"'>&nbsp;</th></tr></thead>";return ci}function bX(){var ci=bq+"-widget-header";var cj=bq+"-widget-content";var cl;var cn=e(new Date());var ck;var co;var ch;var cg;var cm="";cm+="<tbody><tr><th class='fc-agenda-axis "+ci+"'>&nbsp;</th>";co="";for(ck=0;ck<bF;ck++){cl=ba(0,ck);cg=["fc-col"+ck,"fc-"+Q[cl.getDay()],cj];if(+cl==+cn){cg.push(bq+"-state-highlight","fc-today")}else{if(cl<cn){cg.push("fc-past")}else{cg.push("fc-future")}}ch="<td class='"+cg.join(" ")+"'><div><div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>";co+=ch}cm+=co;cm+="<td class='fc-agenda-gutter "+cj+"'>&nbsp;</td></tr></tbody>";return cm}function bk(cg){if(cg===v){cg=bJ}bJ=cg;bg={};var ci=bV.position().top;var ch=bp.position().top;var cj=Math.min(cg-ci,aZ.height()+ch+1);bL.height(cj-H(bS));cd.css("top",ci);bp.height(cj-ch-1);bG=aZ.find("tr:first").height()+1;a3=bA("slotMinutes")/bs;b7=bG/a3}function bo(cj){bw=cj;bE.clear();bx.clear();var cg=b8.find("th:first");if(b9){cg=cg.add(b9.find("th:first"))}cg=cg.add(aZ.find("th:first"));bl=0;av(cg.width("").each(function(ck,cl){bl=Math.max(bl,au(cl).outerWidth())}),bl);var ch=bP.find(".fc-agenda-gutter");if(b9){ch=ch.add(b9.find("th.fc-agenda-gutter"))}var ci=bp[0].clientWidth;bz=bp.width()-ci;if(bz){av(ch,bz);ch.show().prev().removeClass("fc-last")}else{ch.hide().prev().addClass("fc-last")}aV=Math.floor((ci-bl)/bF);av(bW.slice(0,-1),aV)}function bi(){var cj=g();var ch=O(cj);ch.setHours(bA("firstHour"));var ci=ce(cj,ch)+1;function cg(){bp.scrollTop(ci)}cg();setTimeout(cg,0)}function bU(){bi()}function bm(cg){cg.click(bN).mousedown(by)}function bZ(cg){cg.click(bN).mousedown(a0)}function bN(ck){if(!bA("selectable")){var ci=Math.min(bF-1,Math.floor((ck.pageX-bP.offset().left-bl)/aV));var ch=ba(0,ci);var cl=this.parentNode.className.match(/fc-slot(\d+)/);if(cl){var cj=parseInt(cl[1])*bA("slotMinutes");var cg=Math.floor(cj/60);ch.setHours(cg);ch.setMinutes(cj%60+bj);bD("dayClick",be[ci],ch,false,ck)}else{bD("dayClick",be[ci],ch,true,ck)}}}function aQ(ck,cl,cg){if(cg){bH.build()}var ch=bh(ck,cl);for(var ci=0;ci<ch.length;ci++){var cj=ch[ci];bm(a6(cj.row,cj.leftCol,cj.row,cj.rightCol))}}function a6(cj,ck,ch,ci){var cg=bH.rect(cj,ck,ch,ci,cd);return br(cg,cd)}function bb(ck,cp){for(var ci=0;ci<bF;ci++){var cl=ba(0,ci);var ch=aE(O(cl),1);var cj=new Date(Math.max(cl,ck));var co=new Date(Math.min(ch,cp));if(cj<co){var cn=bH.rect(0,ci,0,ci,a5);var cm=ce(cl,cj);var cg=ce(cl,co);cn.top=cm;cn.height=cg-cm;bZ(br(cn,a5))}}}bH=new P(function(co,cm){var ck,ch,cg;bW.each(function(cr,cq){ck=au(cq);ch=ck.offset().left;if(cr){cg[1]=ch}cg=[ch];cm[cr]=cg});cg[1]=ch+ck.outerWidth();if(bA("allDaySlot")){ck=b0;ch=ck.offset().top;co[0]=[ch,ch+ck.outerHeight()]}var cn=a5.offset().top;var cp=bp.offset().top;var cj=cp+bp.outerHeight();function cl(cq){return Math.max(cp,Math.min(cj,cq))}for(var ci=0;ci<bK*a3;ci++){co.push([cl(cn+b7*ci),cl(cn+b7*(ci+1))])}});ca=new ap(bH);bE=new m(function(cg){return aR.eq(cg)});bx=new m(function(cg){return aM.eq(cg)});function b5(cg){return bE.left(cg)}function cf(cg){return bx.left(cg)}function bM(cg){return bE.right(cg)}function aU(cg){return bx.right(cg)}function bv(cg){return bA("allDaySlot")&&!cg.row}function bR(cg){var ci=ba(0,cg.col);var ch=cg.row;if(bA("allDaySlot")){ch--}if(ch>=0){j(ci,bj+ch*bs)}return ci}function ce(ch,cl){ch=O(ch,true);if(cl<j(O(ch),bj)){return 0}if(cl>=j(O(ch),aO)){return aZ.height()}var cg=bA("slotMinutes"),ck=cl.getHours()*60+cl.getMinutes()-bj,cj=Math.floor(ck/cg),ci=bg[cj];if(ci===v){ci=bg[cj]=aZ.find("tr").eq(cj).find("td div")[0].offsetTop}return Math.max(0,Math.round(ci-1+bG*((ck%cg)/cg)))}function bC(cg){return b0}function bT(cg){var ch=O(cg.start);if(cg.allDay){return ch}return j(ch,bA("defaultEventMinutes"))}function bn(cg,ch){if(ch){return O(cg)}return j(O(cg),bA("slotMinutes"))}function b3(cg,ci,ch){if(ch){if(bA("allDaySlot")){aQ(cg,aE(O(ci),1),true)}}else{b2(cg,ci)}}function b2(cg,cm){var ck=bA("selectHelper");bH.build();if(ck){var ci=aX(cg).col;if(ci>=0&&ci<bF){var cj=bH.rect(0,ci,0,ci,a5);var cl=ce(cg,cg);var ch=ce(cg,cm);if(ch>cl){cj.top=cl;cj.height=ch-cl;cj.left+=2;cj.width-=5;if(au.isFunction(ck)){var cn=ck(cg,cm);if(cn){cj.position="absolute";aT=au(cn).css(cj).appendTo(a5)}}else{cj.isStart=true;cj.isEnd=true;aT=au(a4({title:"",start:cg,end:cm,className:["fc-select-helper"],editable:false},cj));aT.css("opacity",bA("dragOpacity"))}if(aT){bZ(aT);a5.append(aT);av(aT,cj.width,true);Z(aT,cj.height,true)}}}}else{bb(cg,cm)}}function bY(){aP();if(aT){aT.remove();aT=null}}function a0(cg){if(cg.which==1&&bA("selectable")){b1(cg);var ch;ca.start(function(cj,ci){bY();if(cj&&cj.col==ci.col&&!bv(cj)){var cl=bR(ci);var ck=bR(cj);ch=[cl,j(O(cl),bs),ck,j(O(ck),bs)].sort(a);b2(ch[0],ch[3])}else{ch=null}},cg);au(document).one("mouseup",function(ci){ca.stop();if(ch){if(+ch[0]==+ch[1]){a9(ch[0],false,ci)}bt(ch[0],ch[3],false,ci)}})}}function a9(cg,ci,ch){bD("dayClick",be[aX(cg).col],cg,ci,ch)}function aW(ci,cg,ch){ca.start(function(cj){aP();if(cj){if(bv(cj)){a6(cj.row,cj.col,cj.row,cj.col)}else{var cl=bR(cj);var ck=j(O(cl),bA("defaultEventMinutes"));bb(cl,ck)}}},cg)}function cc(cj,ch,ci){var cg=ca.stop();aP();if(cg){bD("drop",cj,bR(cg),bv(cg),ch,ci)}}}function V(){var bl=this;bl.renderEvents=aR;bl.clearEvents=a6;bl.slotSegHtml=a7;Y.call(bl);var a1=bl.opt;var a8=bl.trigger;var aP=bl.isEventDraggable;var bq=bl.isEventResizable;var br=bl.eventEnd;var bb=bl.eventElementHandlers;var bh=bl.setHeight;var aQ=bl.getDaySegmentContainer;var bt=bl.getSlotSegmentContainer;var aO=bl.getHoverListener;var aN=bl.getMaxMinute;var bc=bl.getMinMinute;var aU=bl.timePosition;var be=bl.getIsCellAllDay;var bg=bl.colContentLeft;var bd=bl.colContentRight;var aM=bl.cellToDate;var bi=bl.getColCnt;var a2=bl.getColWidth;var bk=bl.getSnapHeight;var aW=bl.getSnapMinutes;var aY=bl.getSlotContainer;var aZ=bl.reportEventElement;var aS=bl.showEvents;var a0=bl.hideEvents;var bo=bl.eventDrop;var a4=bl.eventResize;var a9=bl.renderDayOverlay;var aT=bl.clearOverlays;var bu=bl.renderDayEvents;var bm=bl.calendar;var bj=bm.formatDate;var a3=bm.formatDates;bl.draggableDayEvent=aX;function aR(bz,bx){var by,bw=bz.length,bA=[],bv=[];for(by=0;by<bw;by++){if(bz[by].allDay){bA.push(bz[by])}else{bv.push(bz[by])}}if(a1("allDaySlot")){bu(bA,bx);bh()}aV(a5(bv),bx)}function a6(){aQ().empty();bt().empty()}function a5(bF){var bD=bi(),bB=bc(),bw=aN(),bC,bz=au.map(bF,bs),bA,by,bx,bE,bv=[];for(bA=0;bA<bD;bA++){bC=aM(0,bA);j(bC,bB);bE=bf(bF,bz,bC,j(O(bC),bw-bB));bE=ak(bE);for(by=0;by<bE.length;by++){bx=bE[by];bx.col=bA;bv.push(bx)}}return bv}function bf(bH,bB,bx,bA){var by=[],bC,bE=bH.length,bw,bF,bD,bG,bI,bv,bz;for(bC=0;bC<bE;bC++){bw=bH[bC];bF=bw.start;bD=bB[bC];if(bD>bx&&bF<bA){if(bF<bx){bG=O(bx);bv=false}else{bG=bF;bv=true}if(bD>bA){bI=O(bA);bz=false}else{bI=bD;bz=true}by.push({event:bw,start:bG,end:bI,isStart:bv,isEnd:bz})}}return by.sort(x)}function bs(bv){if(bv.end){return O(bv.end)}else{return j(O(bv.start),a1("defaultEventMinutes"))}}function aV(bG,bH){var bL,bO=bG.length,bN,bJ,bD,bz,bA,bC,bx,bI,bv,bP,bB="",bQ,bM,by,bF,bE,bK=bt(),bw=a1("isRTL");for(bL=0;bL<bO;bL++){bN=bG[bL];bJ=bN.event;bD=aU(bN.start,bN.start);bz=aU(bN.start,bN.end);bA=bg(bN.col);bC=bd(bN.col);bx=bC-bA;bC-=bx*0.025;bx=bC-bA;bI=bx*(bN.forwardCoord-bN.backwardCoord);if(a1("slotEventOverlap")){bI=Math.max((bI-(20/2))*2,bI)}if(bw){bP=bC-bN.backwardCoord*bx;bv=bP-bI}else{bv=bA+bN.backwardCoord*bx;bP=bv+bI}bv=Math.max(bv,bA);bP=Math.min(bP,bC);bI=bP-bv;bN.top=bD;bN.left=bv;bN.outerWidth=bI;bN.outerHeight=bz-bD;bB+=a7(bJ,bN)}bK[0].innerHTML=bB;bQ=bK.children();for(bL=0;bL<bO;bL++){bN=bG[bL];bJ=bN.event;bM=au(bQ[bL]);by=a8("eventRender",bJ,bJ,bM);if(by===false){bM.remove()}else{if(by&&by!==true){bM.remove();bM=au(by).css({position:"absolute",top:bN.top,left:bN.left}).appendTo(bK)}bN.element=bM;if(bJ._id===bH){bn(bJ,bM,bN)}else{bM[0]._fci=bL}aZ(bJ,bM)}}u(bK,bG,bn);for(bL=0;bL<bO;bL++){bN=bG[bL];if(bM=bN.element){bN.vsides=H(bM,true);bN.hsides=i(bM,true);bF=bM.find(".fc-event-title");if(bF.length){bN.contentTop=bF[0].offsetTop}}}for(bL=0;bL<bO;bL++){bN=bG[bL];if(bM=bN.element){bM[0].style.width=Math.max(0,bN.outerWidth-bN.hsides)+"px";bE=Math.max(0,bN.outerHeight-bN.vsides);bM[0].style.height=bE+"px";bJ=bN.event;if(bN.contentTop!==v&&bE-bN.contentTop<10){bM.find("div.fc-event-time").text(bj(bJ.start,a1("timeFormat"))+" - "+bJ.title);bM.find("div.fc-event-title").remove()}a8("eventAfterRender",bJ,bJ,bM)}}}function a7(bA,bv){var bz="<";var bx=bA.url;var bw=R(bA,a1);var by=["fc-event","fc-event-vert"];if(aP(bA)){by.push("fc-event-draggable")}if(bv.isStart){by.push("fc-event-start")}if(bv.isEnd){by.push("fc-event-end")}by=by.concat(bA.className);if(bA.source){by=by.concat(bA.source.className||[])}if(bx){bz+="a href='"+aH(bA.url)+"'"}else{bz+="div"}bz+=" class='"+by.join(" ")+"' style='position:absolute;top:"+bv.top+"px;left:"+bv.left+"px;"+bw+"'><div class='fc-event-inner'><div class='fc-event-time'>"+aH(a3(bA.start,bA.end,a1("timeFormat")))+"</div><div class='fc-event-title'>"+aH(bA.title||"")+"</div></div><div class='fc-event-bg'></div>";if(bv.isEnd&&bq(bA)){bz+="<div class='ui-resizable-handle ui-resizable-s'>=</div>"}bz+="</"+(bx?"a":"div")+">";return bz}function bn(bx,bw,bv){var by=bw.find("div.fc-event-time");if(aP(bx)){ba(bx,bw,by)}if(bv.isEnd&&bq(bx)){bp(bx,bw,by)}bb(bx,bw)}function aX(bw,bF,bA){var bv=bA.isStart;var bG;var bE;var bI=true;var bz;var by=aO();var bB=a2();var bx=bk();var bH=aW();var bD=bc();bF.draggable({opacity:a1("dragOpacity","month"),revertDuration:a1("dragRevertDuration"),start:function(bJ,bK){a8("eventDragStart",bF,bw,bJ,bK);a0(bw,bF);bG=bF.width();by.start(function(bM,bL){aT();if(bM){bE=false;var bO=aM(0,bL.col);var bN=aM(0,bM.col);bz=aB(bN,bO);if(!bM.row){a9(aE(O(bw.start),bz),aE(ao(bw),bz));bC()}else{if(bv){if(bI){bF.width(bB-10);Z(bF,bx*Math.round((bw.end?((bw.end-bw.start)/U):a1("defaultEventMinutes"))/bH));bF.draggable("option","grid",[bB,1]);bI=false}}else{bE=true}}bE=bE||(bI&&!bz)}else{bC();bE=true}bF.draggable("option","revert",bE)},bJ,"drag")},stop:function(bK,bL){by.stop();aT();a8("eventDragStop",bF,bw,bK,bL);if(bE){bC();bF.css("filter","");aS(bw,bF)}else{var bJ=0;if(!bI){bJ=Math.round((bF.offset().top-aY().offset().top)/bx)*bH+bD-(bw.start.getHours()*60+bw.start.getMinutes())}bo(this,bw,bz,bJ,bI,bK,bL)}}});function bC(){if(!bI){bF.width(bG).height("").draggable("option","grid",null);bI=true}}}function ba(bI,bK,bx){var bD=bl.getCoordinateGrid();var bG=bi();var bP=a2();var bH=bk();var bC=aW();var bO;var bM;var bN,bF;var bv,by;var bw,bB;var bz;var bJ,bA;bK.draggable({scroll:false,grid:[bP,bH],axis:bG==1?"y":false,opacity:a1("dragOpacity"),revertDuration:a1("dragRevertDuration"),start:function(bQ,bR){E(bQ);a8("eventDragStart",bK,bI,bQ,bR);a0(bI,bK);bD.build();bO=bK.position();bM=bD.cell(bQ.pageX,bQ.pageY);bN=bF=true;bv=by=be(bM);bw=bB=0;bz=0;bJ=bA=0},drag:function(bU,bV){E(bU);var bQ=bD.cell(bU.pageX,bU.pageY);bN=!!bQ;if(bN){bv=be(bQ);bw=Math.round((bV.position.left-bO.left)/bP);if(bw!=bB){var bT=aM(0,bM.col);var bS=bM.col+bw;bS=Math.max(0,bS);bS=Math.min(bG-1,bS);var bR=aM(0,bS);bz=aB(bR,bT)}if(!bv){bJ=Math.round((bV.position.top-bO.top)/bH)*bC}}if(bN!=bF||bv!=by||bw!=bB||bJ!=bA){bL();bF=bN;by=bv;bB=bw;bA=bJ}bK.draggable("option","revert",!bN)},stop:function(bQ,bR){E(bQ);aT();a8("eventDragStop",bK,bI,bQ,bR);if(bN&&(bv||bz||bJ)){bo(this,bI,bz,bv?0:bJ,bv,bQ,bR)}else{bN=true;bv=false;bw=0;bz=0;bJ=0;bL();bK.css("filter","");bK.css(bO);aS(bI,bK)}}});function bL(){aT();if(bN){if(bv){bx.hide();bK.draggable("option","grid",null);a9(aE(O(bI.start),bz),aE(ao(bI),bz))}else{bE(bJ);bx.css("display","");bK.draggable("option","grid",[bP,bH])}}}function bE(bR){var bQ=j(O(bI.start),bR);var bS;if(bI.end){bS=j(O(bI.end),bR)}bx.text(a3(bQ,bS,a1("timeFormat")))}}function bp(bz,bx,bA){var by,bv;var bB=bk();var bw=aW();bx.resizable({handles:{s:".ui-resizable-handle"},grid:bB,start:function(bC,bD){by=bv=0;a0(bz,bx);a8("eventResizeStart",this,bz,bC,bD)},resize:function(bC,bD){by=Math.round((Math.max(bB,bx.height())-bD.originalSize.height)/bB);if(by!=bv){bA.text(a3(bz.start,(!by&&!bz.end)?null:j(br(bz),bw*by),a1("timeFormat")));bv=by}},stop:function(bC,bD){a8("eventResizeStop",this,bz,bC,bD);if(by){a4(this,bz,0,bw*by,bC,bD)}else{aS(bz,bx)}}})}}function ak(aM){var aO=F(aM);var aP=aO[0];var aN;X(aO);if(aP){for(aN=0;aN<aP.length;aN++){ab(aP[aN])}for(aN=0;aN<aP.length;aN++){M(aP[aN],0,0)}}return C(aO)}function F(aN){var aQ=[];var aP,aM;var aO;for(aP=0;aP<aN.length;aP++){aM=aN[aP];for(aO=0;aO<aQ.length;aO++){if(!aK(aM,aQ[aO]).length){break}}(aQ[aO]||(aQ[aO]=[])).push(aM)}return aQ}function X(aQ){var aP,aR;var aO,aM;var aN;for(aP=0;aP<aQ.length;aP++){aR=aQ[aP];for(aO=0;aO<aR.length;aO++){aM=aR[aO];aM.forwardSegs=[];for(aN=aP+1;aN<aQ.length;aN++){aK(aM,aQ[aN],aM.forwardSegs)}}}}function ab(aN){var aM=aN.forwardSegs;var aQ=0;var aP,aO;if(aN.forwardPressure===v){for(aP=0;aP<aM.length;aP++){aO=aM[aP];ab(aO);aQ=Math.max(aQ,1+aO.forwardPressure)}aN.forwardPressure=aQ}}function M(aN,aP,aQ){var aM=aN.forwardSegs;var aO;if(aN.forwardCoord===v){if(!aM.length){aN.forwardCoord=1}else{aM.sort(az);M(aM[0],aP+1,aQ);aN.forwardCoord=aM[0].backwardCoord}aN.backwardCoord=aN.forwardCoord-(aN.forwardCoord-aQ)/(aP+1);for(aO=0;aO<aM.length;aO++){M(aM[aO],0,aN.forwardCoord)}}}function C(aP){var aM=[];var aO,aQ;var aN;for(aO=0;aO<aP.length;aO++){aQ=aP[aO];for(aN=0;aN<aQ.length;aN++){aM.push(aQ[aN])}}return aM}function aK(aM,aP,aO){aO=aO||[];for(var aN=0;aN<aP.length;aN++){if(d(aM,aP[aN])){aO.push(aP[aN])}}return aO}function d(aN,aM){return aN.end>aM.start&&aN.start<aM.end}function az(aN,aM){return aM.forwardPressure-aN.forwardPressure||(aN.backwardCoord||0)-(aM.backwardCoord||0)||x(aN,aM)}function x(aN,aM){return aN.start-aM.start||(aM.end-aM.start)-(aN.end-aN.start)||(aN.event.title||"").localeCompare(aM.event.title)}function aF(a1,bl,aY){var bk=this;bk.element=a1;bk.calendar=bl;bk.name=aY;bk.opt=a6;bk.trigger=be;bk.isEventDraggable=aR;bk.isEventResizable=bq;bk.setEventData=bn;bk.clearEventData=aQ;bk.eventEnd=br;bk.reportEventElement=a4;bk.triggerEventDestroy=bd;bk.eventElementHandlers=bg;bk.showEvents=aT;bk.hideEvents=a5;bk.eventDrop=bo;bk.eventResize=a9;var bt=bk.defaultEventEnd;var bf=bl.normalizeEvent;var bp=bl.reportEventChange;var a3={};var aX={};var bs=[];var bb=bl.options;function a6(by,bw){var bx=bb[by];if(au.isPlainObject(bx)){return G(bx,bw||aY)}return bx}function be(bw,bx){return bl.trigger.apply(bl,[bw,bx||bk].concat(Array.prototype.slice.call(arguments,2),[bk]))}function aR(bw){var bx=bw.source||{};return aJ(bw.startEditable,bx.startEditable,a6("eventStartEditable"),bw.editable,bx.editable,a6("editable"))&&!a6("disableDragging")}function bq(bw){var bx=bw.source||{};return aJ(bw.durationEditable,bx.durationEditable,a6("eventDurationEditable"),bw.editable,bx.editable,a6("editable"))&&!a6("disableResizing")}function bn(by){a3={};var bx,bw=by.length,bz;for(bx=0;bx<bw;bx++){bz=by[bx];if(a3[bz._id]){a3[bz._id].push(bz)}else{a3[bz._id]=[bz]}}}function aQ(){a3={};aX={};bs=[]}function br(bw){return bw.end?O(bw.end):bt(bw)}function a4(bx,bw){bs.push({event:bx,element:bw});if(aX[bx._id]){aX[bx._id].push(bw)}else{aX[bx._id]=[bw]}}function bd(){au.each(bs,function(bw,bx){bk.trigger("eventDestroy",bx.event,bx.event,bx.element)})}function bg(bx,bw){bw.click(function(by){if(!bw.hasClass("ui-draggable-dragging")&&!bw.hasClass("ui-resizable-resizing")){return be("eventClick",this,bx,by)}}).hover(function(by){be("eventMouseover",this,bx,by)},function(by){be("eventMouseout",this,bx,by)})}function aT(bx,bw){a2(bx,bw,"show")}function a5(bx,bw){a2(bx,bw,"hide")}function a2(bz,by,bB){var bA=aX[bz._id],bx,bw=bA.length;for(bx=0;bx<bw;bx++){if(!by||bA[bx][0]!=by[0]){bA[bx][bB]()}}}function bo(bz,bx,by,bA,bD,bC,bB){var bE=bx.allDay;var bw=bx._id;a7(a3[bw],by,bA,bD);be("eventDrop",bz,bx,by,bA,bD,function(){a7(a3[bw],-by,-bA,bE);bp(bw)},bC,bB);bp(bw)}function a9(bC,bA,bx,bw,bz,bB){var by=bA._id;aZ(a3[by],bx,bw);be("eventResize",bC,bA,bx,bw,function(){aZ(a3[by],-bx,-bw);bp(by)},bz,bB);bp(by)}function a7(bA,by,bx,bB){bx=bx||0;for(var bC,bw=bA.length,bz=0;bz<bw;bz++){bC=bA[bz];if(bB!==v){bC.allDay=bB}j(aE(bC.start,by,true),bx);if(bC.end){bC.end=j(aE(bC.end,by,true),bx)}bf(bC,bb)}}function aZ(bA,by,bx){bx=bx||0;for(var bB,bw=bA.length,bz=0;bz<bw;bz++){bB=bA[bz];bB.end=j(aE(br(bB),by,true),bx);bf(bB,bb)}}bk.isHiddenDay=aV;bk.skipHiddenDays=aS;bk.getCellsPerWeek=bi;bk.dateToCell=bm;bk.dateToDayOffset=ba;bk.dayOffsetToCellOffset=aO;bk.cellOffsetToCell=a0;bk.cellToDate=aP;bk.cellToCellOffset=aM;bk.cellOffsetToDayOffset=bc;bk.dayOffsetToDate=bv;bk.rangeToSegments=bh;var a8=a6("hiddenDays")||[];var aN=[];var bu;var aU=[];var aW=[];var bj=a6("isRTL");(function(){if(a6("weekends")===false){a8.push(0,6)}for(var bx=0,bw=0;bx<7;bx++){aU[bx]=bw;aN[bx]=au.inArray(bx,a8)!=-1;if(!aN[bx]){aW[bw]=bx;bw++}}bu=bw;if(!bu){throw"invalid hiddenDays"}})();function aV(bw){if(typeof bw=="object"){bw=bw.getDay()}return aN[bw]}function bi(){return bu}function aS(bx,by,bw){by=by||1;while(aN[(bx.getDay()+(bw?by:0)+7)%7]){aE(bx,by)}}function aP(){var by=aM.apply(null,arguments);var bw=bc(by);var bx=bv(bw);return bx}function aM(bB,bz){var by=bk.getColCnt();var bx=bj?-1:1;var bw=bj?by-1:0;if(typeof bB=="object"){bz=bB.col;bB=bB.row}var bA=bB*by+(bz*bx+bw);return bA}function bc(bx){var bw=bk.visStart.getDay();bx+=aU[bw];return Math.floor(bx/bu)*7+aW[(bx%bu+bu)%bu]-bw}function bv(bw){var bx=O(bk.visStart);aE(bx,bw);return bx}function bm(by){var bx=ba(by);var bz=aO(bx);var bw=a0(bz);return bw}function ba(bw){return aB(bw,bk.visStart)}function aO(bx){var bw=bk.visStart.getDay();bx+=bw;return Math.floor(bx/7)*bu+aU[(bx%7+7)%7]-aU[bw]}function a0(bB){var bz=bk.getColCnt();var bx=bj?-1:1;var bw=bj?bz-1:0;var bA=Math.floor(bB/bz);var by=((bB%bz+bz)%bz)*bx+bw;return{row:bA,col:by}}function bh(bx,bM){var bA=bk.getRowCnt();var bK=bk.getColCnt();var bL=[];var bO=ba(bx);var bJ=ba(bM);var bN=aO(bO);var bB=aO(bJ)-1;for(var bC=0;bC<bA;bC++){var by=bC*bK;var bG=by+bK-1;var bH=Math.max(bN,by);var bz=Math.min(bB,bG);if(bH<=bz){var bw=a0(bH);var bI=a0(bz);var bF=[bw.col,bI.col].sort();var bD=bc(bH)==bO;var bE=bc(bz)+1==bJ;bL.push({row:bC,leftCol:bF[0],rightCol:bF[1],isStart:bD,isEnd:bE})}}return bL}}function Y(){var bt=this;bt.renderDayEvents=bA;bt.draggableDayEvent=a2;bt.resizableDayEvent=bn;var a7=bt.opt;var bk=bt.trigger;var aU=bt.isEventDraggable;var bw=bt.isEventResizable;var bx=bt.eventEnd;var a5=bt.reportEventElement;var bm=bt.eventElementHandlers;var aX=bt.showEvents;var a6=bt.hideEvents;var bv=bt.eventDrop;var bb=bt.eventResize;var bB=bt.getRowCnt;var bs=bt.getColCnt;var a9=bt.getColWidth;var a1=bt.allDayRow;var bz=bt.colLeft;var a3=bt.colRight;var br=bt.colContentLeft;var bp=bt.colContentRight;var bu=bt.dateToCell;var aV=bt.getDaySegmentContainer;var ba=bt.calendar.formatDates;var bl=bt.renderDayOverlay;var aY=bt.clearOverlays;var aO=bt.clearSelection;var aT=bt.getHoverListener;var bo=bt.rangeToSegments;var aR=bt.cellToDate;var aN=bt.cellToCellOffset;var bi=bt.cellOffsetToDayOffset;var bd=bt.dateToDayOffset;var aQ=bt.dayOffsetToCellOffset;function bA(bE,bD){var bC=a0(bE,false,true);ae(bC,function(bG,bF){a5(bG.event,bF)});aZ(bC,bD);ae(bC,function(bG,bF){bk("eventAfterRender",bG.event,bG.event,bF)})}function be(bD,bG,bF){var bC=a0([bD],true,false);var bE=[];ae(bC,function(bI,bH){if(bI.row===bG){bH.css("top",bF)}bE.push(bH[0])});return bE}function a0(bF,bJ,bH){var bG=aV();var bE=bJ?au("<div/>"):bG;var bC=a4(bF);var bD;var bI;by(bC);bD=bc(bC);bE[0].innerHTML=bD;bI=bE.children();if(bJ){bG.append(bI)}aW(bC,bI);ae(bC,function(bL,bK){bL.hsides=i(bK,true)});ae(bC,function(bL,bK){bK.width(Math.max(0,bL.outerWidth-bL.hsides))});ae(bC,function(bL,bK){bL.outerHeight=bK.outerHeight(true)});aS(bC,bH);return bC}function a4(bE){var bC=[];for(var bD=0;bD<bE.length;bD++){var bF=bj(bE[bD]);bC.push.apply(bC,bF)}return bC}function bj(bF){var bC=bF.start;var bG=ao(bF);var bD=bo(bC,bG);for(var bE=0;bE<bD.length;bE++){bD[bE].event=bF}return bD}function by(bD){var bG=a7("isRTL");for(var bF=0;bF<bD.length;bF++){var bH=bD[bF];var bI=(bG?bH.isEnd:bH.isStart)?br:bz;var bC=(bG?bH.isStart:bH.isEnd)?bp:a3;var bJ=bI(bH.leftCol);var bE=bC(bH.rightCol);bH.left=bJ;bH.outerWidth=bE-bJ}}function bc(bC){var bE="";for(var bD=0;bD<bC.length;bD++){bE+=a8(bC[bD])}return bE}function a8(bH){var bF="";var bE=a7("isRTL");var bG=bH.event;var bD=bG.url;var bI=["fc-event","fc-event-hori"];if(aU(bG)){bI.push("fc-event-draggable")}if(bH.isStart){bI.push("fc-event-start")}if(bH.isEnd){bI.push("fc-event-end")}bI=bI.concat(bG.className);if(bG.source){bI=bI.concat(bG.source.className||[])}var bC=R(bG,a7);if(bD){bF+="<a href='"+aH(bD)+"'"}else{bF+="<div"}bF+=" class='"+bI.join(" ")+"' style='position:absolute;left:"+bH.left+"px;"+bC+"'><div class='fc-event-inner'>";if(!bG.allDay&&bH.isStart){bF+="<span class='fc-event-time'>"+aH(ba(bG.start,bG.end,a7("timeFormat")))+"</span>"}bF+="<span class='fc-event-title'>"+aH(bG.title||"")+"</span></div>";if(bH.isEnd&&bw(bG)){bF+="<div class='ui-resizable-handle ui-resizable-"+(bE?"w":"e")+"'>&nbsp;&nbsp;&nbsp;</div>"}bF+="</"+(bD?"a":"div")+">";return bF}function aW(bD,bI){for(var bF=0;bF<bD.length;bF++){var bH=bD[bF];var bG=bH.event;var bE=bI.eq(bF);var bC=bk("eventRender",bG,bG,bE);if(bC===false){bE.remove()}else{if(bC&&bC!==true){bC=au(bC).css({position:"absolute",left:bH.left});bE.replaceWith(bC);bE=bC}bH.element=bE}}}function aS(bE,bG){var bH=aM(bE);var bC=bq();var bD=[];if(bG){for(var bF=0;bF<bC.length;bF++){bC[bF].height(bH[bF])}}for(var bF=0;bF<bC.length;bF++){bD.push(bC[bF].position().top)}ae(bE,function(bJ,bI){bI.css("top",bD[bJ.row]+bJ.top)})}function aM(bE){var bG=bB();var bL=bs();var bM=[];var bC=bh(bE);for(var bK=0;bK<bG;bK++){var bJ=bC[bK];var bI=[];for(var bH=0;bH<bL;bH++){bI.push(0)}for(var bD=0;bD<bJ.length;bD++){var bF=bJ[bD];bF.top=at(bI.slice(bF.leftCol,bF.rightCol+1));for(var bH=bF.leftCol;bH<=bF.rightCol;bH++){bI[bH]=bF.top+bF.outerHeight}}bM.push(at(bI))}return bM}function bh(bD){var bH=bB();var bG=[];var bC;var bF;var bE;for(bC=0;bC<bD.length;bC++){bF=bD[bC];bE=bF.row;if(bF.element){if(bG[bE]){bG[bE].push(bF)}else{bG[bE]=[bF]}}}for(bE=0;bE<bH;bE++){bG[bE]=aP(bG[bE]||[])}return bG}function aP(bD){var bF=[];var bC=bg(bD);for(var bE=0;bE<bC.length;bE++){bF.push.apply(bF,bC[bE])}return bF}function bg(bE){bE.sort(aw);var bD=[];for(var bF=0;bF<bE.length;bF++){var bG=bE[bF];for(var bC=0;bC<bD.length;bC++){if(!b(bG,bD[bC])){break}}if(bD[bC]){bD[bC].push(bG)}else{bD[bC]=[bG]}}return bD}function bq(){var bC;var bE=bB();var bD=[];for(bC=0;bC<bE;bC++){bD[bC]=a1(bC).find("div.fc-day-content > div")}return bD}function aZ(bD,bC){var bE=aV();ae(bD,function(bI,bG,bF){var bH=bI.event;if(bH._id===bC){bf(bH,bG,bI)}else{bG[0]._fci=bF}});u(bE,bD,bf)}function bf(bE,bC,bD){if(aU(bE)){bt.draggableDayEvent(bE,bC,bD)}if(bD.isEnd&&bw(bE)){bt.resizableDayEvent(bE,bC,bD)}bm(bE,bC)}function a2(bF,bE){var bD=aT();var bC;bE.draggable({delay:50,opacity:a7("dragOpacity"),revertDuration:a7("dragRevertDuration"),start:function(bG,bH){bk("eventDragStart",bE,bF,bG,bH);a6(bF,bE);bD.start(function(bJ,bI,bM,bN){bE.draggable("option","revert",!bJ||!bM&&!bN);aY();if(bJ){var bL=aR(bI);var bK=aR(bJ);bC=aB(bK,bL);bl(aE(O(bF.start),bC),aE(ao(bF),bC))}else{bC=0}},bG,"drag")},stop:function(bG,bH){bD.stop();aY();bk("eventDragStop",bE,bF,bG,bH);if(bC){bv(this,bF,bC,0,bF.allDay,bG,bH)}else{bE.css("filter","");aX(bF,bE)}}})}function bn(bF,bD,bE){var bC=a7("isRTL");var bH=bC?"w":"e";var bG=bD.find(".ui-resizable-"+bH);var bI=false;aL(bD);bD.mousedown(function(bJ){bJ.preventDefault()}).click(function(bJ){if(bI){bJ.preventDefault();bJ.stopImmediatePropagation()}});bG.mousedown(function(bR){if(bR.which!=1){return}bI=true;var bL=aT();var bP=bB();var bS=bs();var bK=bD.css("top");var bN;var bJ;var bQ=au.extend({},bF);var bM=aQ(bd(bF.start));aO();au("body").css("cursor",bH+"-resize").one("mouseup",bO);bk("eventResizeStart",this,bF,bR);bL.start(function(bU,bT){if(bU){var bX=aN(bT);var bW=aN(bU);bW=Math.max(bW,bM);bN=bi(bW)-bi(bX);if(bN){bQ.end=aE(bx(bF),bN,true);var bV=bJ;bJ=be(bQ,bE.row,bK);bJ=au(bJ);bJ.find("*").css("cursor",bH+"-resize");if(bV){bV.remove()}a6(bF)}else{if(bJ){aX(bF);bJ.remove();bJ=null}}aY();bl(bF.start,aE(ao(bF),bN))}},bR);function bO(bT){bk("eventResizeStop",this,bF,bT);au("body").css("cursor","");bL.stop();aY();if(bN){bb(this,bF,bN,0,bT)}setTimeout(function(){bI=false},0)}})}}function b(aN,aP){for(var aM=0;aM<aP.length;aM++){var aO=aP[aM];if(aO.leftCol<=aN.rightCol&&aO.rightCol>=aN.leftCol){return true}}return false}function ae(aM,aQ){for(var aO=0;aO<aM.length;aO++){var aP=aM[aO];var aN=aP.element;if(aN){aQ(aP,aN,aO)}}}function aw(aN,aM){return(aM.rightCol-aM.leftCol)-(aN.rightCol-aN.leftCol)||aM.event.allDay-aN.event.allDay||aN.event.start-aM.event.start||(aN.event.title||"").localeCompare(aM.event.title)}function an(){var aW=this;aW.select=aU;aW.unselect=aQ;aW.reportSelection=aM;aW.daySelectionMousedown=aT;var aO=aW.opt;var aP=aW.trigger;var aR=aW.defaultSelectionEnd;var aN=aW.renderSelection;var aV=aW.clearSelection;var aS=false;if(aO("selectable")&&aO("unselectAuto")){au(document).mousedown(function(aX){var aY=aO("unselectCancel");if(aY){if(au(aX.target).parents(aY).length){return}}aQ(aX)})}function aU(aX,aZ,aY){aQ();if(!aZ){aZ=aR(aX,aY)}aN(aX,aZ,aY);aM(aX,aZ,aY)}function aQ(aX){if(aS){aS=false;aV();aP("unselect",null,aX)}}function aM(aX,a0,aZ,aY){aS=true;aP("select",null,aX,a0,aZ,aY)}function aT(a1){var aZ=aW.cellToDate;var aY=aW.getIsCellAllDay;var aX=aW.getHoverListener();var a2=aW.reportDayClick;if(a1.which==1&&aO("selectable")){aQ(a1);var a0=this;var a3;aX.start(function(a5,a4){aV();if(a5&&aY(a5)){a3=[aZ(a4),aZ(a5)].sort(a);aN(a3[0],a3[1],true)}else{a3=null}},a1);au(document).one("mouseup",function(a4){aX.stop();if(a3){if(+a3[0]==+a3[1]){a2(a3[0],true,a4)}aM(a3[0],a3[1],true,a4)}})}}}function c(){var aP=this;aP.renderOverlay=aN;aP.clearOverlays=aM;var aO=[];var aQ=[];function aN(aS,aR){var aT=aQ.shift();if(!aT){aT=au("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>")}if(aT[0].parentNode!=aR[0]){aT.appendTo(aR)}aO.push(aT.css(aS).show());return aT}function aM(){var aR;while(aR=aO.shift()){aQ.push(aR.hide().unbind())}}}function P(aM){var aN=this;var aO;var aP;aN.build=function(){aO=[];aP=[];aM(aO,aP)};aN.cell=function(aQ,aW){var aV=aO.length;var aR=aP.length;var aS,aT=-1,aU=-1;for(aS=0;aS<aV;aS++){if(aW>=aO[aS][0]&&aW<aO[aS][1]){aT=aS;break}}for(aS=0;aS<aR;aS++){if(aQ>=aP[aS][0]&&aQ<aP[aS][1]){aU=aS;break}}return(aT>=0&&aU>=0)?{row:aT,col:aU}:null};aN.rect=function(aT,aV,aR,aS,aU){var aQ=aU.offset();return{top:aO[aT][0]-aQ.top,left:aP[aV][0]-aQ.left,width:aP[aS][1]-aP[aV][0],height:aO[aR][1]-aO[aT][0]}}}function ap(aR){var aP=this;var aQ;var aS;var aN;var aM;aP.start=function(aT,aU,aV){aS=aT;aN=aM=null;aR.build();aO(aU);aQ=aV||"mousemove";au(document).bind(aQ,aO)};function aO(aT){E(aT);var aU=aR.cell(aT.pageX,aT.pageY);if(!aU!=!aM||aU&&(aU.row!=aM.row||aU.col!=aM.col)){if(aU){if(!aN){aN=aU}aS(aU,aN,aU.row-aN.row,aU.col-aN.col)}else{aS(aU,aN)}aM=aU}}aP.stop=function(){au(document).unbind(aQ,aO);return aM}}function E(aM){if(aM.pageX===v){aM.pageX=aM.originalEvent.pageX;aM.pageY=aM.originalEvent.pageY}}function m(aN){var aM=this,aO={},aR={},aQ={};function aP(aS){return aO[aS]=aO[aS]||aN(aS)}aM.left=function(aS){return aR[aS]=aR[aS]===v?aP(aS).position().left:aR[aS]};aM.right=function(aS){return aQ[aS]=aQ[aS]===v?aM.left(aS)+aP(aS).width():aQ[aS]};aM.clear=function(){aO={};aR={};aQ={}}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jquery.ui.position.js' */
(function(f){f.ui=f.ui||{};var c=/left|center|right/,e="center",d=/top|center|bottom/,g="center",a=f.fn.position,b=f.fn.offset;f.fn.position=function(i){if(!i||!i.of){return a.apply(this,arguments)}i=f.extend({},i);var l=f(i.of),n=(i.collision||"flip").split(" "),m=i.offset?i.offset.split(" "):[0,0],k,h,j;if(i.of.nodeType===9){k=l.width();h=l.height();j={top:0,left:0}}else{if(i.of.scrollTo&&i.of.document){k=l.width();h=l.height();j={top:l.scrollTop(),left:l.scrollLeft()}}else{if(i.of.preventDefault){i.at="left top";k=h=0;j={top:i.of.pageY,left:i.of.pageX}}else{k=l.outerWidth();h=l.outerHeight();j=l.offset()}}}f.each(["my","at"],function(){var o=(i[this]||"").split(" ");if(o.length===1){o=c.test(o[0])?o.concat([g]):d.test(o[0])?[e].concat(o):[e,g]}o[0]=c.test(o[0])?o[0]:e;o[1]=d.test(o[1])?o[1]:g;i[this]=o});if(n.length===1){n[1]=n[0]}m[0]=parseInt(m[0],10)||0;if(m.length===1){m[1]=m[0]}m[1]=parseInt(m[1],10)||0;if(i.at[0]==="right"){j.left+=k}else{if(i.at[0]===e){j.left+=k/2}}if(i.at[1]==="bottom"){j.top+=h}else{if(i.at[1]===g){j.top+=h/2}}j.left+=m[0];j.top+=m[1];return this.each(function(){var r=f(this),q=r.outerWidth(),p=r.outerHeight(),o=f.extend({},j);if(i.my[0]==="right"){o.left-=q}else{if(i.my[0]===e){o.left-=q/2}}if(i.my[1]==="bottom"){o.top-=p}else{if(i.my[1]===g){o.top-=p/2}}o.left=parseInt(o.left);o.top=parseInt(o.top);f.each(["left","top"],function(t,s){if(f.ui.position[n[t]]){f.ui.position[n[t]][s](o,{targetWidth:k,targetHeight:h,elemWidth:q,elemHeight:p,offset:m,my:i.my,at:i.at})}});if(f.fn.bgiframe){r.bgiframe()}r.offset(f.extend(o,{using:i.using}))})};f.ui.position={fit:{left:function(h,i){var k=f(window),j=h.left+i.elemWidth-k.width()-k.scrollLeft();h.left=j>0?h.left-j:Math.max(0,h.left)},top:function(h,i){var k=f(window),j=h.top+i.elemHeight-k.height()-k.scrollTop();h.top=j>0?h.top-j:Math.max(0,h.top)}},flip:{left:function(i,j){if(j.at[0]==="center"){return}var l=f(window),k=i.left+j.elemWidth-l.width()-l.scrollLeft(),h=j.my[0]==="left"?-j.elemWidth:j.my[0]==="right"?j.elemWidth:0,m=-2*j.offset[0];i.left+=i.left<0?h+j.targetWidth+m:k>0?h-j.targetWidth+m:0},top:function(i,k){if(k.at[1]==="center"){return}var m=f(window),l=i.top+k.elemHeight-m.height()-m.scrollTop(),h=k.my[1]==="top"?-k.elemHeight:k.my[1]==="bottom"?k.elemHeight:0,j=k.at[1]==="top"?k.targetHeight:-k.targetHeight,n=-2*k.offset[1];i.top+=i.top<0?h+k.targetHeight+n:l>0?h+j+n:0}}};if(!f.offset.setOffset){f.offset.setOffset=function(l,i){if(/static/.test(f.curCSS(l,"position"))){l.style.position="relative"}var k=f(l),n=k.offset(),h=parseInt(f.curCSS(l,"top",true),10)||0,m=parseInt(f.curCSS(l,"left",true),10)||0,j={top:(i.top-n.top)+h,left:(i.left-n.left)+m};if("using" in i){i.using.call(l,j)}else{k.css(j)}};f.fn.offset=function(h){var i=this[0];if(!i||!i.ownerDocument){return null}if(h){return this.each(function(){f.offset.setOffset(this,h)})}return b.call(this)}}}(jQuery));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jquery.ui.autocomplete.js' */
(function(a){a.widget("ui.autocompleteTC",{options:{minLength:1,delay:300},_create:function(){var b=this,c=this.element[0].ownerDocument;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(d){var e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:b._move("previousPage",d);break;case e.PAGE_DOWN:b._move("nextPage",d);break;case e.UP:b._move("previous",d);d.preventDefault();break;case e.DOWN:b._move("next",d);d.preventDefault();break;case e.ENTER:if(b.menu.active){d.preventDefault()}case e.TAB:if(!b.menu.active){return}b.menu.select(d);break;case e.ESCAPE:b.element.val(b.term);b.close(d);break;case e.LEFT:case e.RIGHT:case e.SHIFT:case e.CONTROL:case e.ALT:break;default:clearTimeout(b.searching);b.searching=setTimeout(function(){b.search(null,d)},b.options.delay);break}}).bind("focus.autocomplete",function(){b.selectedItem=null;b.previous=b.element.val()}).bind("blur.autocomplete",function(d){clearTimeout(b.searching);b.closing=setTimeout(function(){b.close(d);b._change(d)},150)});this._initSource();this.response=function(){return b._response.apply(b,arguments)};this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo("body",c).menu({focus:function(e,f){var d=f.item.data("item.autocomplete");if(false!==b._trigger("focus",null,{item:d})){if(/^key/.test(e.originalEvent.type)){b.element.val(d.value)}}},selected:function(f,g){var e=g.item.data("item.autocomplete");if(false!==b._trigger("select",f,{item:e})){b.element.val(e.value)}b.close(f);var d=b.previous;if(b.element[0]!==c.activeElement){b.element.focus();b.previous=d}b.selectedItem=e},blur:function(d,e){if(b.menu.element.is(":visible")){b.element.val(b.term)}}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");if(a.fn.bgiframe){this.menu.element.bgiframe()}},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();a.Widget.prototype.destroy.call(this)},_setOption:function(b){a.Widget.prototype._setOption.apply(this,arguments);if(b==="source"){this._initSource()}},_initSource:function(){var c,b;if(a.isArray(this.options.source)){c=this.options.source;this.source=function(e,d){d(a.ui.autocompleteTC.filter(c,e.term))}}else{if(typeof this.options.source==="string"){b=this.options.source;this.source=function(e,d){a.getJSON(b,e,d)}}else{this.source=this.options.source}}},search:function(c,b){c=c!=null?c:this.element.val();if(c.length<this.options.minLength){return this.close(b)}clearTimeout(this.closing);if(this._trigger("search")===false){return}return this._search(c)},_search:function(b){this.term=this.element.addClass("ui-autocomplete-loading").val();this.source({term:b},this.response)},_response:function(b){if(b.length){b=this._normalize(b);this._suggest(b);this._trigger("open")}else{this.close()}this.element.removeClass("ui-autocomplete-loading")},close:function(b){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this._trigger("close",b);this.menu.element.hide();this.menu.deactivate()}},_change:function(b){if(this.previous!==this.element.val()){this._trigger("change",b,{item:this.selectedItem})}},_normalize:function(b){if(b.length&&b[0].label&&b[0].value){return b}return a.map(b,function(c){if(typeof c==="string"){return{label:c,value:c}}return a.extend({label:c.label||c.value,value:c.value||c.label},c)})},_suggest:function(b){var c=this.menu.element.empty().zIndex(this.element.zIndex()+1),d,e;this._renderMenu(c,b);this.menu.deactivate();this.menu.refresh();this.menu.element.show().position({my:"left top",at:"left bottom",of:this.element,collision:"none"});d=c.width("").width();e=this.element.width();c.width(Math.max(d,e))},_renderMenu:function(d,c){var b=this;a.each(c,function(e,f){b._renderItem(d,f)})},_renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append("<a>"+c.label+"</a>").appendTo(b)},_move:function(c,b){if(!this.menu.element.is(":visible")){this.search(null,b);return}if(this.menu.first()&&/^previous/.test(c)||this.menu.last()&&/^next/.test(c)){this.element.val(this.term);this.menu.deactivate();return}this.menu[c](b)},widget:function(){return this.menu.element}});a.extend(a.ui.autocompleteTC,{escapeRegex:function(b){return b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},filter:function(d,b){var c=new RegExp(a.ui.autocompleteTC.escapeRegex(b),"i");return a.grep(d,function(e){return c.test(e.label||e.value||e)})}})}(jQuery));(function(a){a.widget("ui.menu",{_create:function(){var b=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(!a(c.target).closest(".ui-menu-item a").length){return}c.preventDefault();b.select(c)});this.refresh()},refresh:function(){var c=this;var b=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");b.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(d){c.activate(d,a(this).parent())}).mouseleave(function(){c.deactivate()})},activate:function(e,d){this.deactivate();if(this.hasScroll()){var f=d.offset().top-this.element.offset().top,b=this.element.attr("scrollTop"),c=this.element.height();if(f<0){this.element.attr("scrollTop",b+f)}else{if(f>c){this.element.attr("scrollTop",b+f-c+d.height())}}}this.active=d.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",e,{item:d})},deactivate:function(){if(!this.active){return}this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null},next:function(b){this.move("next",".ui-menu-item:first",b)},previous:function(b){this.move("prev",".ui-menu-item:last",b)},first:function(){return this.active&&!this.active.prev().length},last:function(){return this.active&&!this.active.next().length},move:function(e,d,c){if(!this.active){this.activate(c,this.element.children(d));return}var b=this.active[e+"All"](".ui-menu-item").eq(0);if(b.length){this.activate(c,b)}else{this.activate(c,this.element.children(d))}},nextPage:function(d){if(this.hasScroll()){if(!this.active||this.last()){this.activate(d,this.element.children(":first"));return}var e=this.active.offset().top,c=this.element.height(),b=this.element.children("li").filter(function(){var f=a(this).offset().top-e-c+a(this).height();return f<10&&f>-10});if(!b.length){b=this.element.children(":last")}this.activate(d,b)}else{this.activate(d,this.element.children(!this.active||this.last()?":first":":last"))}},previousPage:function(c){if(this.hasScroll()){if(!this.active||this.first()){this.activate(c,this.element.children(":last"));return}var d=this.active.offset().top,b=this.element.height();result=this.element.children("li").filter(function(){var e=a(this).offset().top-d+b-a(this).height();return e<10&&e>-10});if(!result.length){result=this.element.children(":first")}this.activate(c,result)}else{this.activate(c,this.element.children(!this.active||this.first()?":last":":first"))}},hasScroll:function(){return this.element.height()<this.element.attr("scrollHeight")},select:function(b){this._trigger("selected",b,{item:this.active})}})}(jQuery));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jquery.ui.datepicker.js' */
(function($,undefined){$.extend($.ui,{datepicker:{version:"1.8.11"}});var PROP_NAME="datepicker";var dpuuid=new Date().getTime();function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=$('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')}$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",log:function(){if(this.debug){console.log.apply("",arguments)}},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=="div"||nodeName=="span");if(!target.id){this.uuid+=1;target.id="dp"+this.uuid}var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=="input"){this._connectDatepicker(target,inst)}else{if(inline){this._inlineDatepicker(target,inst)}}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:$('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return}this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});this._autoSize(inst);$.data(target,PROP_NAME,inst)},_attachments:function(input,inst){var appendText=this._get(inst,"appendText");var isRTL=this._get(inst,"isRTL");if(inst.append){inst.append.remove()}if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+"</span>");input[isRTL?"before":"after"](inst.append)}input.unbind("focus",this._showDatepicker);if(inst.trigger){inst.trigger.remove()}var showOn=this._get(inst,"showOn");if(showOn=="focus"||showOn=="both"){input.focus(this._showDatepicker)}if(showOn=="button"||showOn=="both"){var buttonText=this._get(inst,"buttonText");var buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==""?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0]){$.datepicker._hideDatepicker()}else{$.datepicker._showDatepicker(input[0])}return false})}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i}}return maxI};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?"monthNames":"monthNamesShort"))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?"dayNames":"dayNamesShort")))+20-date.getDay())}inst.input.attr("size",this._formatDate(inst,date).length)}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return}divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);inst.dpDiv.show()},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst)}extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY]}this._dialogInput.css("left",(this._pos[0]+20)+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv)}$.data(this._dialogInput[0],PROP_NAME,inst);return this},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else{if(nodeName=="div"||nodeName=="span"){$target.removeClass(this.markerClassName).empty()}}},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)})},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)});this._disabledInputs[this._disabledInputs.length]=target},_isDisabledDatepicker:function(target){if(!target){return false}for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target){return true}}return false},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=="string"){return(name=="defaults"?$.extend({},$.datepicker._defaults):(inst?(name=="all"?$.extend({},inst.settings):this._get(inst,name)):null))}var settings=name||{};if(typeof name=="string"){settings={};settings[name]=value}if(inst){if(this._curInst==inst){this._hideDatepicker()}var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate)}if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate)}this._attachments($(target),inst);this._autoSize(inst);this._setDateDatepicker(target,date);this._updateDatepicker(inst)}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst)}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst)}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault)}return(inst?this._getDate(inst):null)},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0])}else{$.datepicker._hideDatepicker()}return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target)}handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target)}handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M")}break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D")}handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M")}break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D")}handled=event.ctrlKey||event.metaKey;break;default:handled=false}}else{if(event.keyCode==36&&event.ctrlKey){$.datepicker._showDatepicker(this)}else{handled=false}}if(handled){event.preventDefault();event.stopPropagation()}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){var chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<" "||!chars||chars.indexOf(chr)>-1)}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst)}}catch(event){$.datepicker.log(event)}}return true},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!="input"){input=$("input",input.parentNode)[0]}if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input){return}var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){$.datepicker._curInst.dpDiv.stop(true,true)}var beforeShow=$.datepicker._get(inst,"beforeShow");extendRemove(inst.settings,(beforeShow?beforeShow.apply(input,[input,inst]):{}));inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value=""}if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight}var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")=="fixed";return !isFixed});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop}var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){var showAnim=$.datepicker._get(inst,"showAnim");var duration=$.datepicker._get(inst,"duration");var postProcess=function(){$.datepicker._datepickerShowing=true;var cover=inst.dpDiv.find("iframe.ui-datepicker-cover");if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}};inst.dpDiv.zIndex($(input).zIndex()+1);if($.effects&&$.effects[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[showAnim||"show"]((showAnim?duration:null),postProcess)}if(!showAnim||!duration){postProcess()}if(inst.input.is(":visible")&&!inst.input.is(":disabled")){inst.input.focus()}$.datepicker._curInst=inst}},_updateDatepicker:function(inst){var self=this;var borders=$.datepicker._getBorders(inst.dpDiv);inst.dpDiv.empty().append(this._generateHTML(inst));var cover=inst.dpDiv.find("iframe.ui-datepicker-cover");if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}inst.dpDiv.find("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a").bind("mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).removeClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).removeClass("ui-datepicker-next-hover")}}).bind("mouseover",function(){if(!self._isDisabledDatepicker(inst.inline?inst.dpDiv.parent()[0]:inst.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).addClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).addClass("ui-datepicker-next-hover")}}}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em")}else{inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("")}inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&inst.input[0]!=document.activeElement){inst.input.focus()}if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml)}origyearshtml=inst.yearshtml=null},0)}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value};return[parseFloat(convert(elem.css("border-left-width"))),parseFloat(convert(elem.css("border-top-width")))]},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+$(document).scrollLeft();var viewHeight=document.documentElement.clientHeight+$(document).scrollTop();offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,"isRTL");while(obj&&(obj.type=="hidden"||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?"previousSibling":"nextSibling"]}var position=$(obj).offset();return[position.left,position.top]},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME))){return}if(this._datepickerShowing){var showAnim=this._get(inst,"showAnim");var duration=this._get(inst,"duration");var postProcess=function(){$.datepicker._tidyDialog(inst);this._curInst=null};if($.effects&&$.effects[showAnim]){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[(showAnim=="slideDown"?"slideUp":(showAnim=="fadeIn"?"fadeOut":"hide"))]((showAnim?duration:null),postProcess)}if(!showAnim){postProcess()}var onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst])}this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if(!$.datepicker._curInst){return}var $target=$(event.target);if($target[0].id!=$.datepicker._mainDivId&&$target.parents("#"+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)){$.datepicker._hideDatepicker()}},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return}this._adjustInstDate(inst,offset+(period=="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst)},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear}else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear()}this._notifyChange(inst);this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst._selectingMonthYear=false;inst["selected"+(period=="M"?"Month":"Year")]=inst["draw"+(period=="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target)},_clickMonthYear:function(id){var target=$(id);var inst=this._getInst(target[0]);if(inst.input&&inst._selectingMonthYear){setTimeout(function(){inst.input.focus()},0)}inst._selectingMonthYear=!inst._selectingMonthYear},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return}var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear))},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,"")},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr)}this._updateAlternate(inst);var onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst])}else{if(inst.input){inst.input.trigger("change")}}if(inst.inline){this._updateDatepicker(inst)}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!="object"){inst.input.focus()}this._lastInput=null}},_updateAlternate:function(inst){var altField=this._get(inst,"altField");if(altField){var altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr)})}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""]},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments"}value=(typeof value=="object"?value.toString():value+"");if(value==""){return null}var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=="@"?14:(match=="!"?20:(match=="y"&&isDoubled?4:(match=="o"?3:2))));var digits=new RegExp("^\\d{1,"+size+"}");var num=value.substring(iValue).match(digits);if(!num){throw"Missing number at position "+iValue}iValue+=num[0].length;return parseInt(num[0],10)};var getName=function(match,shortNames,longNames){var names=(lookAhead(match)?longNames:shortNames);for(var i=0;i<names.length;i++){if(value.substr(iValue,names[i].length).toLowerCase()==names[i].toLowerCase()){iValue+=names[i].length;return i+1}}throw"Unknown name at position "+iValue};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat)){throw"Unexpected literal at position "+iValue}iValue++};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{checkLiteral()}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":var date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":var date=new Date((getNumber("!")-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral()}else{literal=true}break;default:checkLiteral()}}}if(year==-1){year=new Date().getFullYear()}else{if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+(year<=shortYearCutoff?0:-100)}}if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim){break}month++;day-=dim}while(true)}var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day){throw"Invalid date"}return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date){return""}var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num}}return num};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value])};var output="";var literal=false;if(date){for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{output+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",(date.getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000,3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100);break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'")){output+="'"}else{literal=true}break;default:output+=format.charAt(iFormat)}}}}return output},_possibleChars:function(format){var chars="";var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{chars+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'"}else{literal=true}break;default:chars+=format.charAt(iFormat)}}}return chars},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return}var dateFormat=this._get(inst,"dateFormat");var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){this.log(event);dates=(noDefault?"":dates)}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst)},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date()))},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst))}catch(e){}var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break}matches=pattern.exec(offset)}return new Date(year,month,day)};var newDate=(date==null||date===""?defaultDate:(typeof date=="string"?offsetString(date):(typeof date=="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=="Invalid Date"?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0)}return this._daylightSavingAdjust(newDate)},_daylightSavingAdjust:function(date){if(!date){return null}date.setHours(date.getHours()>12?date.getHours()+2:0);return date},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange){this._notifyChange(inst)}this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst))}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,"isRTL");var showButtonPanel=this._get(inst,"showButtonPanel");var hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext");var navigationAsDateFormat=this._get(inst,"navigationAsDateFormat");var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,"showCurrentAtPos");var stepMonths=this._get(inst,"stepMonths");var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--}if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+inst.id+"', -"+stepMonths+", 'M');\" title=\""+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>"));var nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+inst.id+"', +"+stepMonths+", 'M');\" title=\""+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>"));var currentText=this._get(inst,"currentText");var gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(inst,"closeText")+"</button>":"");var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+inst.id+"');\">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";var firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,"showWeek");var dayNames=this._get(inst,"dayNames");var dayNamesShort=this._get(inst,"dayNamesShort");var dayNamesMin=this._get(inst,"dayNamesMin");var monthNames=this._get(inst,"monthNames");var monthNamesShort=this._get(inst,"monthNamesShort");var beforeShowDay=this._get(inst,"beforeShowDay");var showOtherMonths=this._get(inst,"showOtherMonths");var selectOtherMonths=this._get(inst,"selectOtherMonths");var calculateWeek=this._get(inst,"calculateWeek")||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html="";for(var row=0;row<numMonths[0];row++){var group="";for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=" ui-corner-all";var calender="";if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1){switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass="";break}}calender+='">'}calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):"")+(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,"weekHeader")+"</th>":"");for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+dayNames[day]+'">'+dayNamesMin[day]+"</span></th>"}calender+=thead+"</tr></thead><tbody>";var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth)}var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var numRows=(isMultiMonth?6:Math.ceil((leadDays+daysInMonth)/7));var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+="<tr>";var tbody=(!showWeek?"":'<td class="ui-datepicker-week-col">'+this._get(inst,"calculateWeek")(printDate)+"</td>");for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()==currentDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()==today.getTime()?" ui-datepicker-today":""))+'"'+((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':"")+(unselectable?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+inst.id+"',"+printDate.getMonth()+","+printDate.getFullYear()+', this);return false;"')+">"+(otherMonth&&!showOtherMonths?"&#xa0;":(unselectable?'<span class="ui-state-default">'+printDate.getDate()+"</span>":'<a class="ui-state-default'+(printDate.getTime()==today.getTime()?" ui-state-highlight":"")+(printDate.getTime()==currentDate.getTime()?" ui-state-active":"")+(otherMonth?" ui-priority-secondary":"")+'" href="#">'+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate)}calender+=tbody+"</tr>"}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++}calender+="</tbody></table>"+(isMultiMonth?"</div>"+((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':""):"");group+=calender}html+=group}html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");inst._keyEvent=false;return html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,"changeMonth");var changeYear=this._get(inst,"changeYear");var showMonthAfterYear=this._get(inst,"showMonthAfterYear");var html='<div class="ui-datepicker-title">';var monthHtml="";if(secondary||!changeMonth){monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+"</span>"}else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+inst.id+"', this, 'M');\" onclick=\"DP_jQuery_"+dpuuid+".datepicker._clickMonthYear('#"+inst.id+"');\">";for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+='<option value="'+month+'"'+(month==drawMonth?' selected="selected"':"")+">"+monthNamesShort[month]+"</option>"}}monthHtml+="</select>"}if(!showMonthAfterYear){html+=monthHtml+(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")}inst.yearshtml="";if(secondary||!changeYear){html+='<span class="ui-datepicker-year">'+drawYear+"</span>"}else{var years=this._get(inst,"yearRange").split(":");var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year)};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||""));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+inst.id+"', this, 'Y');\" onclick=\"DP_jQuery_"+dpuuid+".datepicker._clickMonthYear('#"+inst.id+"');\">";for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+(year==drawYear?' selected="selected"':"")+">"+year+"</option>"}inst.yearshtml+="</select>";if(!$.browser.mozilla){html+=inst.yearshtml;inst.yearshtml=null}else{html+='<select class="ui-datepicker-year"><option value="'+drawYear+'" selected="selected">'+drawYear+"</option></select>"}}html+=this._get(inst,"yearSuffix");if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")+monthHtml}html+="</div>";return html},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=="Y"?offset:0);var month=inst.drawMonth+(period=="M"?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period=="D"?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=="M"||period=="Y"){this._notifyChange(inst)}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst])}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths=="number"?[1,numMonths]:numMonths))},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null)},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()))}return this._isInRange(inst,date)},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()))},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear}var date=(day?(typeof day=="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}});function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null||props[name]==undefined){target[name]=props[name]}}return target}function isArray(a){return(a&&(($.browser.safari&&typeof a=="object"&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))))}$.fn.datepicker=function(options){if(!this.length){return this}if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv);$.datepicker.initialized=true}var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=="string"&&(options=="isDisabled"||options=="getDate"||options=="widget")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}if(options=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}return this.each(function(){typeof options=="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)})};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.8.11";window["DP_jQuery_"+dpuuid]=$})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jquery.ThreeDots.js' */
(function(e){e.fn.ThreeDots=function(h){var g=this;if((typeof h=="object")||(h==undefined)){e.fn.ThreeDots.the_selected=this;var g=e.fn.ThreeDots.update(h)}return g};e.fn.ThreeDots.update=function(u){var k,t=null;var m,j,s,q,o;var l,i;var r,h,n;if((typeof u=="object")||(u==undefined)){e.fn.ThreeDots.c_settings=e.extend({},e.fn.ThreeDots.settings,u);var p=e.fn.ThreeDots.c_settings.max_rows;if(p<1){return e.fn.ThreeDots.the_selected}var g=false;jQuery.each(e.fn.ThreeDots.c_settings.valid_delimiters,function(v,w){if(((new String(w)).length==1)){g=true}});if(g==false){return e.fn.ThreeDots.the_selected}e.fn.ThreeDots.the_selected.each(function(){k=e(this);if(e(k).children("."+e.fn.ThreeDots.c_settings.text_span_class).length==0){return true}l=e(k).children("."+e.fn.ThreeDots.c_settings.text_span_class).get(0);var y=a(k,true);var x=e(l).text();d(k,l,y);var v=e(l).text();if((h=e(k).attr("threedots"))!=undefined){e(l).text(h);e(k).children("."+e.fn.ThreeDots.c_settings.e_span_class).remove()}r=e(l).text();if(r.length<=0){r=""}e(k).attr("threedots",x);if(a(k,y)>p){curr_ellipsis=e(k).append('<span style="white-space:nowrap" class="'+e.fn.ThreeDots.c_settings.e_span_class+'">'+e.fn.ThreeDots.c_settings.ellipsis_string+"</span>");while(a(k,y)>p){i=b(e(l).text());e(l).text(i.updated_string);t=i.word;n=i.del;if(n==null){break}}if(t!=null){var w=c(k,y);if((a(k,y)<=p-1)||(w)||(!e.fn.ThreeDots.c_settings.whole_word)){r=e(l).text();if(i.del!=null){e(l).text(r+n)}if(a(k,y)>p){e(l).text(r)}else{e(l).text(e(l).text()+t);if((a(k,y)>p+1)||(!e.fn.ThreeDots.c_settings.whole_word)||(v==t)||w){while((a(k,y)>p)){if(e(l).text().length>0){e(l).text(e(l).text().substr(0,e(l).text().length-1))}else{break}}}}}}}if(x==e(e(k).children("."+e.fn.ThreeDots.c_settings.text_span_class).get(0)).text()){e(k).children("."+e.fn.ThreeDots.c_settings.e_span_class).remove()}else{if((e(k).children("."+e.fn.ThreeDots.c_settings.e_span_class)).length>0){if(e.fn.ThreeDots.c_settings.alt_text_t){e(k).children("."+e.fn.ThreeDots.c_settings.text_span_class).attr("title",x)}if(e.fn.ThreeDots.c_settings.alt_text_e){e(k).children("."+e.fn.ThreeDots.c_settings.e_span_class).attr("title",x)}}}})}return e.fn.ThreeDots.the_selected};e.fn.ThreeDots.settings={valid_delimiters:[" ",",","."],ellipsis_string:"...",max_rows:2,text_span_class:"ellipsis_text",e_span_class:"threedots_ellipsis",whole_word:true,allow_dangle:false,alt_text_e:false,alt_text_t:false};function c(k,h){if(e.fn.ThreeDots.c_settings.allow_dangle==true){return false}var l=e(k).children("."+e.fn.ThreeDots.c_settings.e_span_class).get(0);var g=e(l).css("display");var i=a(k,h);e(l).css("display","none");var j=a(k,h);e(l).css("display",g);if(i>j){return true}else{return false}}function a(i,j){var g=typeof j;if((g=="object")||(g==undefined)){return e(i).height()/j.lh}else{if(g=="boolean"){var h=f(e(i));return{lh:h}}}}function b(k){var j;var i=e.fn.ThreeDots.c_settings.valid_delimiters;k=jQuery.trim(k);var g=-1;var h=null;var l=null;jQuery.each(i,function(m,o){if(((new String(o)).length!=1)||(o==null)){return false}var n=k.lastIndexOf(o);if(n!=-1){if(n>g){g=n;h=k.substring(g+1);l=o}}});if(g>0){return{updated_string:jQuery.trim(k.substring(0,g)),word:h,del:l}}else{return{updated_string:"",word:jQuery.trim(k),del:null}}}function f(h){e(h).append("<div id='temp_ellipsis_div' style='position:absolute; visibility:hidden'>H</div>");var g=e("#temp_ellipsis_div").height();e("#temp_ellipsis_div").remove();return g}function d(k,l,m){var q=e(l).text();var i=q;var o=e.fn.ThreeDots.c_settings.max_rows;var h,g,n,r,j;var p;if(a(k,m)<=o){return}else{p=0;curr_length=i.length;curr_middle=Math.floor((curr_length-p)/2);h=q.substring(p,p+curr_middle);g=q.substring(p+curr_middle);while(curr_middle!=0){e(l).text(h);if(a(k,m)<=(o)){j=Math.floor(g.length/2);n=g.substring(0,j);p=h.length;i=h+n;curr_length=i.length;e(l).text(i)}else{i=h;curr_length=i.length}curr_middle=Math.floor((curr_length-p)/2);h=q.substring(0,p+curr_middle);g=q.substring(p+curr_middle)}}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/calendar-data-cache.js' */
(function(c){var a=[];function b(h,g){var e=false;for(var f=0;f<g.length;f++){for(var d=0;d<a[h].data.length;d++){if(g[f].id===a[h].data[d].id){e=true;break}}if(!e){a[h].data.push(g[f])}e=false}}Confluence.TeamCalendars.CalendarDataCache={hasCalendar:function(d){return a[d]?true:false},getCalendarStart:function(d){if(a[d]){return a[d].start}return null},getCalendarEnd:function(d){if(a[d]){return a[d].end}return null},addDataToCalendar:function(e,f,g,d){if(!a[e]){a[e]={data:f}}else{b(e,f)}if(!a[e].start||g.getTime()<a[e].start.getTime()){a[e].start=g}if(!a[e].end||d.getTime()>a[e].end.getTime()){a[e].end=d}},removeCalendar:function(d){if(c.isArray(d)){c.each(d,function(f,e){if(c.isPlainObject(e)&&e.id&&typeof e.id==="string"){Confluence.TeamCalendars.CalendarDataCache.removeCalendar(e.id)}else{Confluence.TeamCalendars.CalendarDataCache.removeCalendar(e.toString())}})}else{delete a[d]}},removeAllCalendars:function(){a=[]},getCalendarData:function(d){if(!a[d]){return null}return a[d].data}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/calendar-plugin.js' */
jQuery(function(e){var c=Confluence.TeamCalendars.CalendarDataCache,b=false,a=function(){window.isTeamCalendarsLoaded=true},f={ajaxTimeout:Confluence.TeamCalendars.ajaxTimeout,i18nMessages:null,dialogSequence:0,ERROR_CLASS_EVENT_UPDATE:"error-event-update",ERROR_CLASS_EVENT_DELETE:"error-event-delete",ERROR_CLASS_SUB_CALENDAR_LIST:"error-subcalendar-refresh",ERROR_CLASS_SUB_CALENDAR_DELETE:"error-subcalendar-delete",ERROR_CLASS_SUB_CALENDAR_UPDATE:"error-subcalendar-update",ERROR_CLASS_SUB_CALENDAR_WATCH:"error-subcalendar-watch",ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS:"error-subcalendar-list-events-",ERROR_CLASS_SUB_CALENDAR_TOGGLE_EVENTS:"error-subcalendar-toggle-events-",ERROR_CLASS_CONFIG_UPDATE:"error-config-update",ERROR_CLASS_PRIVATE_URL:"error-private-url",ERROR_CLASS_RESET_PRIVATE_URLS:"error-reset-private-urls",PREF_LAST_ALL_DAY_USED:"pref-all-day-event-default",init:function(i){var h=function(l,n,k,j,o,m){if(!n.end&&!o){n.end=new Date(n.start.getTime()+(1000*60*60*2))}f.setProcessingEvent(l,true);f.setSuppressEventToolTip(i,true);f.updateEvent(l,(function(){var q=f.getSubCalendar(i,n.subCalendarId),p={subCalendarId:q.parentId,uid:n.id,eventType:n.eventType,originalStartDate:n.originalStart||"",what:n.title,url:n.workingUrl,dragAndDropUpdate:true,start:e.fullCalendar.formatDate(n.start,"ddMMyyyyHHmm"),end:e.fullCalendar.formatDate(n.end||n.start,"ddMMyyyyHHmm"),allDayEvent:o,where:n.where,description:n.description,freq:n.recur?n.recur.freq:"",byday:n.recur?n.recur.byDay:"",interval:n.recur?n.recur.interval:"",until:n.recur?n.recur.localizedUntil||"":"",recurrenceId:n.recurId||"",editAllInRecurrenceSeries:"false"};if(q.eventInviteesSupported){p.person=e.map(n.invitees||[],function(r){return r.id})}return p})(),function(p,r,q){f.showAjaxError(l,p,r,q,f.ERROR_CLASS_EVENT_UPDATE);m();f.setSuppressEventToolTip(l,false);f.setProcessingEvent(l,false)},function(q){if(q.success){f.setGenericErrors(l,null,f.ERROR_CLASS_EVENT_UPDATE);var p=q.event;e.each(f.getCalendarPanel(i).fullCalendar("clientEvents",n.id),function(s,r){r.localizedStartDate=p.localizedStartDate;r.localizedStartTime=p.localizedStartTime;r.localizedEndDate=p.localizedEndDate;r.localizedEndTime=p.localizedEndTime;r.recurId=p.recurId;r.invitees=p.invitees;r.iconUrl=p.iconUrl;r.confluenceFormattedStartDate=p.confluenceFormattedStartDate;r.expandDates=p.expandDates;if(p.extraProperties){r.extraProperties=p.extraProperties}});if(n.calendarReloadRequiredOnUpdate){f.reloadSubCalendar(i,[n.subCalendarId])}}else{f.setGenericErrors(l,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",f.ERROR_CLASS_EVENT_UPDATE);m()}f.setSuppressEventToolTip(l,false);f.setProcessingEvent(l,false)})};var g={calendarDiv:i,calendarPlugin:f,defaultView:f.getParameter(i,"defaultView")||"month",year:parseInt(f.getParameter(i,"startingYear")),month:parseInt(f.getParameter(i,"startingMonth")),date:parseInt(f.getParameter(i,"startingDay")),header:false,firstDay:f.getParameter(i,"firstDayOfWeek"),weekends:f.getParameter(i,"hideWeekends")==="false",viewRender:function(j){var k=function(){if(Confluence.TeamCalendars.isPDLEnabled()){e(".change-view",i).removeClass("active");e(".change-view-"+j.name,i).addClass("active")}else{e(".change-view",i).each(function(){e(this).closest("li").removeClass("active")});e(".change-view-"+j.name,i).closest("li").addClass("active")}};Confluence.TeamCalendars.updateDateDisplay(i,j.title);k();f.hideInlineAuiDialogs();if(j.name==="basicDay"){f.getCalendarPanel(i).addClass("borderless")}else{f.getCalendarPanel(i).removeClass("borderless")}if(f.isCalendarInEditMode(i)){var l=i.data("lastSelectedView");if(!l){i.data("lastSelectedView",j.name)}else{if(j.name!==l){i.data("lastSelectedView",j.name);e.ajax({cache:false,data:{view:j.name},dataType:"json",error:function(m,o,n){f.showAjaxError(i,m,o,n,f.ERROR_CLASS_CONFIG_UPDATE)},success:function(){f.setGenericErrors(i,null,f.ERROR_CLASS_CONFIG_UPDATE)},type:"PUT",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(i,"/preferences/view.json")})}}}},allDayText:"All day",firstHour:8,columnFormat:{week:"ddd d"},titleFormat:{week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d, yyyy}"},buttonText:{today:"Today",month:"Month",week:"Week",day:"List"},monthNames:f.getMonthNames(),monthNamesShort:f.getMonthNamesShort(),dayNames:f.getDayNames(),dayNamesShort:f.getDayNamesShort(),dayClick:function(k,l,j){if(e(".event-details-popup:visible").length===0){if(f.getSubCalendarsWhichCanAddEvents(i).length){Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:k,localizedStartTime:l?f.getDefaultStartTime(i):null,localizedEndTime:l?f.getDefaultEndTime(i):null,allDay:(function(){if(f.getCalendarPanel(i).fullCalendar("getView").name==="month"){return(i.data(f.PREF_LAST_ALL_DAY_USED)||l.toString())==="true"}return l})()},null,f,i).show()}}else{j.stopPropagation();f.hideInlineAuiDialogs()}},eventClick:function(k,j){f.setEventTooltipVisible(i);if(j.shiftKey){if(f.isEventEditable(i,k)){Confluence.TeamCalendars.Dialogs.getEditEventDialog(k,null,f,i).show()}return false}if((j.ctrlKey||j.metaKey)&&k.workingUrl){window.location=k.workingUrl;return false}f.getEventDetailsDialog(i,k,e(j.currentTarget)).show(j);return false},eventRender:function(k,m,j){if(k.disableResizing){e(".ui-resizable-handle",m).hide()}m.mousemove(function(n){m.data("mouseCoords",{pageX:n.pageX,pageY:n.pageY})}).hover(function(){setTimeout(function(){var n=m.data("mouseCoords");if(!f.isEventToolTipSuppressed(i)&&n){f.setEventTooltipVisible(i,k,n,true)}},5000)},function(){m.removeData("mouseCoords");f.setEventTooltipVisible(i);f.setSuppressEventToolTip(i,false)});e(".fc-event-time, .fc-event-title",m).css("color",m.css("color"));if("agendaWeek"===j.name){m.parent().addClass(k.allDay?"fc-agenda-head":"fc-agenda-body");if(!k.allDay){e(".fc-event-inner",m).css({"border-right-color":k.secondaryBorderColor||k.borderColor,"border-bottom-color":k.secondaryBorderColor||k.borderColor,"border-left-color":k.secondaryBorderColor||k.borderColor})}}if("month"===j.name||"agendaWeek"===j.name){var l;if(e.inArray("other",k.className)!==-1){if(k.shortTitle){l=k.shortTitle+": "+k.title}else{if(k.invitees&&k.invitees.length){l=k.invitees[0].displayName+": "+k.title}else{l=k.title}}}else{l=k.shortTitle||k.title}e(".fc-event-title",m).text(l);if("month"===j.name||("agendaWeek"===j.name&&k.allDay)){e(".fc-event-inner",m).before(Confluence.TeamCalendars.Templates.iconEventTypePrinting({eventType:k.className}))}}},eventDrop:function(m,k,j,n,l){if(f.isEventEditable(i,m)&&!f.isProcessingEvent(i)){h(i,m,k,j,n,l)}else{l()}},eventDragStart:function(){f.setSuppressEventToolTip(i,true);f.setEventTooltipVisible(i);f.hideInlineAuiDialogs()},eventDragEnd:function(){f.setSuppressEventToolTip(i,false)},eventResize:function(m,k,j,l){if(f.isEventEditable(i,m)&&!f.isProcessingEvent(i)){h(i,m,k,j,m.allDay,l)}else{l()}},eventResizeStart:function(){f.setSuppressEventToolTip(i,true);f.setEventTooltipVisible(i);f.hideInlineAuiDialogs()},eventResizeStop:function(){f.setSuppressEventToolTip(i,false)},loading:function(j){if(!j){a()}f.setSubCalendarSpinnerIconVisible(i,j)},selectable:true,selectHelper:true,select:function(j,m,l,k){if(!e(".event-details-popup:visible").length&&f.getSubCalendarsWhichCanAddEvents(i).length){Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:j,end:m,localizedStartTime:l?f.getDefaultStartTime(i):null,localizedEndTime:l?f.getDefaultEndTime(i):null,allDay:(function(){if(f.getCalendarPanel(i).fullCalendar("getView").name==="month"){return(i.data(f.PREF_LAST_ALL_DAY_USED)||l.toString())==="true"}return l})()},null,f,i).show()}else{if(k){k.stopPropagation()}f.hideInlineAuiDialogs()}}};if(f.getParameter(i,"width")){i.parent().css("width",f.getParameter(i,"width")+"px")}if(f.getParameter(i,"height")){g.height=parseInt(f.getParameter(i,"height"))}else{g.aspectRatio=1.9}this.getCalendarPanel(i).fullCalendar(g);this.initCalendarDiv(i)},getEventTypeNames:function(h){var g={"calendar3.subcalendar.type.parent":"Calendars","calendar3.subcalendar.type.local":"Events Calendars","calendar3.subcalendar.type.subscription":"Subscriptions","calendar3.subcalendar.type.jira":"JIRA Calendars","calendar3.subcalendar.type.people":"People Calendars","calendar3.subcalendar.type.other":"Events","calendar3.subcalendar.type.generic-people":"People","calendar3.subcalendar.type.travel":"Travel","calendar3.subcalendar.type.leaves":"Leave","calendar3.subcalendar.type.birthdays":"Birthdays","calendar3.subcalendar.type.jira-agile-sprint":"JIRA Agile Sprints","calendar3.subcalendar.type.jira-project-releases":"JIRA Project Releases","calendar3.subcalendar.type.jira-issue-dates":"JIRA Issue Dates","calendar3.subcalendar.type.unknown":"Unknown Type"};return g[h]?g[h]:g},getMonthNames:function(){return[f.getText("calendar3.month.long.january"),f.getText("calendar3.month.long.february"),f.getText("calendar3.month.long.march"),f.getText("calendar3.month.long.april"),f.getText("calendar3.month.long.may"),f.getText("calendar3.month.long.june"),f.getText("calendar3.month.long.july"),f.getText("calendar3.month.long.august"),f.getText("calendar3.month.long.september"),f.getText("calendar3.month.long.october"),f.getText("calendar3.month.long.november"),f.getText("calendar3.month.long.december")]},getMonthNamesShort:function(){return[f.getText("calendar3.month.short.january"),f.getText("calendar3.month.short.february"),f.getText("calendar3.month.short.march"),f.getText("calendar3.month.short.april"),f.getText("calendar3.month.short.may"),f.getText("calendar3.month.short.june"),f.getText("calendar3.month.short.july"),f.getText("calendar3.month.short.august"),f.getText("calendar3.month.short.september"),f.getText("calendar3.month.short.october"),f.getText("calendar3.month.short.november"),f.getText("calendar3.month.short.december")]},getDayNames:function(){return[f.getText("calendar3.day.long.sunday"),f.getText("calendar3.day.long.monday"),f.getText("calendar3.day.long.tuesday"),f.getText("calendar3.day.long.wednesday"),f.getText("calendar3.day.long.thursday"),f.getText("calendar3.day.long.friday"),f.getText("calendar3.day.long.saturday")]},getDayNamesShort:function(){return[f.getText("calendar3.day.short.sunday"),f.getText("calendar3.day.short.monday"),f.getText("calendar3.day.short.tuesday"),f.getText("calendar3.day.short.wednesday"),f.getText("calendar3.day.short.thursday"),f.getText("calendar3.day.short.friday"),f.getText("calendar3.day.short.saturday")]},hideInlineAuiDialogs:function(){e("body").trigger("click")},isEventToolTipSuppressed:function(g){return g.data("shouldSuppressEventToolTip")},setSuppressEventToolTip:function(h,g){h.data("shouldSuppressEventToolTip",g)},setEventTooltipVisible:function(j,i,g,k){if(k&&(this.isEventEditable(j,i)||i.workingUrl)){var h=e("body > .event-tooltip").length?e("body > .event-tooltip"):e("<div/>",{"class":"event-tooltip"}).appendTo(e("body"));e("p",h).remove();if(this.isEventEditable(j,i)){h.append(e("<p/>",{text:"Hold shift then click to bring up the edit dialog"}))}if(i.workingUrl){h.append(e("<p/>",{"class":"follow-hint",text:AJS.format("Control\/Command + click to go to {0}",i.workingUrl)}))}h.css({left:g.pageX+"px",top:(g.pageY+5)+"px"}).show()}else{e("body > .event-tooltip").hide()}},getText:function(g){return this.getI18nMessages()[g]},getI18nMessages:function(){if(!this.i18nMessages){this.i18nMessages={};e("fieldset input",e("<div/>",{html:e("#team-calendars-messages").html()})).each(function(){f.i18nMessages[this.name]=this.value})}return this.i18nMessages},getParameter:function(h,g){return this.getParameters(h)[g]},getParameters:function(h){if(!h.data("parameters")){var g={};e("fieldset.parameters input",h).each(function(){if(g[this.name]){if(e.isArray(g[this.name])){g[this.name].push(this.value)}else{g[this.name]=[g[this.name],this.value]}}else{g[this.name]=this.value}});h.data("parameters",g)}return h.data("parameters")},setParameter:function(j,g,i){j.removeData("parameters");var h=e("fieldset.parameters",j);e("input[name='"+g+"']",h).remove();if(e.isArray(i)){e.each(i,function(k,l){e("<input type='hidden'/>").attr("name",g).val(l).appendTo(h)})}else{e("<input type='hidden'/>").attr("name",g).val(i).appendTo(h)}},getCalendarPanel:function(g){return e(".calendar-panel .calendar",g)},getTimelineHeight:function(g){return f.getParameter(g,"timelineHeight")},getDefaultStartTime:function(g){return this.getParameter(g,"timeSuggestion")[16]},getDefaultEndTime:function(g){return this.getParameter(g,"timeSuggestion")[18]},reloadSubCalendar:function(g,h){if(!h){return}h=e.isArray(h)?h:[h];e(".sub-calendar-panel .subcalendar-item",g).each(function(){var j=e(this),n=j.data("subCalendarId"),l=e(".child-subcalendar",j),m=e.map(l,function(o){return e(o).data("subCalendarId")});if(e.inArray(n,h)!==-1){if(j.hasClass("subcalendar-disabled")){j.removeClass("subcalendar-disabled")}else{f.removeSubCalendarEventSource(g,e.map(m,function(o){c.removeCalendar(o);return o}))}e(".subcalendar-disabled",j).removeClass("subcalendar-disabled");var k=f.setSubCalendarEventsHidden(g,e.merge([n],e.merge([],m)),false);k.done(function(){if(Confluence.TeamCalendars.isSubscriptionSubCalendar(f.getSubCalendar(g,n))){c.removeCalendar(n);f.removeSubCalendarEventSource(g,n);f.addSubCalendarEventSource(g,n)}f.addSubCalendarEventSource(g,m)})}else{var i=[];l.filter(function(){return e.inArray(e(this).data("subCalendarId"),h)!==-1}).each(function(){var o=e(this),p=o.data("subCalendarId");c.removeCalendar(p);if(o.hasClass("subcalendar-disabled")){o.removeClass("subcalendar-disabled")}else{f.removeSubCalendarEventSource(g,p)}f.addSubCalendarEventSource(g,p);i.push(p)});if(i.length){f.setSubCalendarEventsHidden(g,i,false)}}})},makeAutoCompleteSearch:function(j,i,h,l,g,k){i.keydown(function(n){var m=e("li.active",l);if(27==n.keyCode){if(!l.hasClass("hidden")){l.addClass("hidden");return false}}if(38==n.keyCode){if(!l.hasClass("hidden")){if(m.length){if(m.prev().length){m.removeClass("active").prev().addClass("active")}}else{e(".aui-dropdown li:last",l).addClass("active")}return false}}if(40==n.keyCode){if(!l.hasClass("hidden")){if(m.length){if(m.next().length){m.removeClass("active").next().addClass("active")}}else{e(".aui-dropdown li:first",l).addClass("active")}return false}return false}if(13==n.keyCode){if(!l.hasClass("hidden")){e(".aui-dropdown li.active a",l).trigger("click");return false}}if(e.trim(i.val())){setTimeout(function(){if(!e.trim(i.val())){l.addClass("hidden");return}e.ajax({cache:false,data:e.extend({search:"name",spacekey:"",query:i.val()},h),dataType:"json",error:function(o,q,p){if(o.status!==400){f.showAjaxError(j,o,q,p)}},success:function(q){var r=e(document.createElement("ol"));var t=function(w){return o.id?f.getParameter(j,"baseUrl")+"/pages/viewpage.action?pageId="+encodeURIComponent(w.id):"#"};for(var v=0;v<q.group.length;++v){var p=q.group[v];if(p.result){for(var u=0;u<p.result.length;++u){var o=p.result[u];if(k&&!k(o)){continue}var s=e(document.createElement("li")).mouseover(function(){e("li.active",l).removeClass("active");e(this).addClass("active")});if(o.thumbnailLink){e(document.createElement("img")).attr("src",o.thumbnailLink.href).appendTo(s)}if(o.link&&o.link.length){e(document.createElement("span")).attr("title",o.title||(o.space?" "+o.space.name:"")).text(o.title).appendTo(e(document.createElement("a")).data("result",o).attr("href",t(o)||"").addClass(o.type?"content-type-"+o.type:"").click(function(){if(g){g(i,e(this))}l.addClass("hidden");return false}).appendTo(s))}s.appendTo(r)}}}if(r.children().length){e("li",r).each(function(w){if(w>4){e(this).remove()}});e(".aui-dropdown",l).empty().append(r);l.removeClass("hidden").dropDown("Standard")}else{l.addClass("hidden")}},timeout:f.ajaxTimeout,url:f.getParameter(j,"baseUrl")+"/rest/prototype/1/search.json"})},300)}}).focus(function(){if(i.hasClass("with-hint")){i.removeClass("with-hint").val("")}}).blur(function(){if(!e.trim(i.val())){i.addClass("with-hint").val("Confluence page or URL")}})},isProcessingEvent:function(g){return g.data("processingEvent")},setProcessingEvent:function(i,h,g){if(g){if(h){g.disableOkButton()}else{g.enableOkButton()}}i.data("processingEvent",h)},showAjaxError:function(h,i,k,j,g){if(!d){Confluence.TeamCalendars.showAjaxError(h,i,k,j,g)}},showRestrictedCalendarsWarning:function(g){e(".restricted-calendars-warning",g).removeClass("hidden")},deleteEvent:function(i,j,h,g){e.ajax({cache:false,data:j,dataType:"json",error:function(k,m,l){if(h){h(k,m,l)}},success:function(k){c.removeCalendar(j.subCalendarId);if(g){g(k)}},type:"DELETE",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(i,"/events.json")})},getCalendarServiceBaseUrl:function(h,g){return Confluence.TeamCalendars.getCalendarServiceBaseUrl(g)},getSubCalendars:function(i,j){var h=i.data("subCalendars")||[];if(j){var g=[];e.each(h,function(l,k){if(j(k)){g.push(k)}});return g}return h},isSubCalendarDeletable:function(h,g){return this.isCalendarInEditMode(h)&&g.deletable},isSubCalendarAdministratable:function(h,g){return this.isCalendarInEditMode(h)&&g.administrable},isSubCalendarEventsUpdatable:function(h,g){return this.isCalendarInEditMode(h)&&g.eventsEditable},canAddEventsToSubcalendar:function(h,g){return this.isSubCalendarEventsUpdatable(h,g)&&!Confluence.TeamCalendars.isJiraSubCalendar(g)},doesSubCalendarHaveRestrictions:function(g){return g.usersPermittedToView.length||g.groupsPermittedToView.length||g.usersPermittedToEdit.length||g.groupsPermittedToEdit.length},getSubCalendarsWhichCanAddEvents:function(g){return this.getSubCalendars(g,function(h){return f.canAddEventsToSubcalendar(g,h)})},getSubCalendar:function(h,i){var g=null;e.each(this.getSubCalendars(h),function(k,j){if(j.id===i){g=j;return false}else{g=e.grep(j.childSubCalendars||[],function(l){return l.id==i});if((g=g&&g.length?g[0]:null)){return false}}});return g},setSubCalendars:function(h,g){h.data("subCalendars",e.isArray(g)?g:(g?[g]:null))},initSubCalendarPanel:function(h){var g=function(i){Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:new Date(),localizedStartTime:f.getDefaultStartTime(i),localizedEndTime:f.getDefaultEndTime(i),allDay:(i.data(f.PREF_LAST_ALL_DAY_USED)||"true")==="true"},null,f,h).show()};e("#add-event-link").click(function(){g(h);return false});e(".toolbar-group-addevent .trigger-addevent, .calendar-toolbar .add-event",h).click(function(){g(h);return false});this.setSubCalendarSpinnerIconVisible(h,true);e("#add-calendar-link").click(function(){Confluence.TeamCalendars.Dialogs.getAddDialog(f.getRenderedMacroCallbackHandler(h));return false});this.refreshCachedSubCalendars(h,function(j){if("true"===f.getParameter(h,"showHiddenSubCalendars")&&e.isArray(j)){e.each(j,function(l,k){k.eventsHidden=false})}f.updateAvailableSubCalendarsInSubCalendarPanel(h);f.setSubCalendarSpinnerIconVisible(h,false);if(f.isCalendarInEditMode(h)){var i=function(){h.unbind("calendar-plugin.resized",i);if("true"===f.getParameter(h,"isShowCalendarWizard")){var l=function(){Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog({heading:"Welcome to Team Calendars!",callbackHandler:f.getRenderedMacroCallbackHandler(h)}).show()};var k=function(){f.getRenderedMacroCallbackHandler(h),{title:"Welcome to Team Calendars!",addClass:"create-calendar-first-time"}};Confluence.TeamCalendars.showCalendarPopupHaveAnEmptySubcalendar(l,k)}};h.bind("calendar-plugin.resized",i)}},function(){f.setSubCalendarSpinnerIconVisible(h,false)})},refreshCachedSubCalendars:function(j,g,h){var i={};if(f.getParameter(j,"include")){i.include=f.getParameter(j,"include")}e.ajax({cache:false,converters:{"text json":function(k){return k}},data:i,dataFilter:function(k){var l=e.parseJSON(k);if(l.success){f.mergeSubCalendarObjectsToArray(l.payload)}return l},dataType:"json",error:function(k,m,l){f.showAjaxError(j,k,m,l,f.ERROR_CLASS_SUB_CALENDAR_LIST);if(h){h(k,m,l)}},success:function(k){if(k.success){f.setSubCalendars(j,k.payload);if(g){g(k.payload)}f.setGenericErrors(j,null,f.ERROR_CLASS_SUB_CALENDAR_LIST)}else{f.setGenericErrors(j,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",f.ERROR_CLASS_SUB_CALENDAR_LIST)}},type:"GET",timeout:f.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars.json")})},mergeSubCalendarObjectsToArray:function(g){return Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(g)},setGenericErrors:function(h,i,g){Confluence.TeamCalendars.setGenericErrors(h,i,g)},shouldShowFeatureDiscoveryDialog:function(g,h){return f.getParameter(g,"showCalendarDiscoveryDialog")==="true"},setSubCalendarEventsHidden:function(h,i,g){i=e.isArray(i)?i:i;return e.ajax({cache:false,data:{subCalendarId:i},dataType:"json",type:g?"PUT":"DELETE",error:function(j,l,k){e.each(i,function(m,n){f.showAjaxError(h,j,l,k,f.ERROR_CLASS_SUB_CALENDAR_TOGGLE_EVENTS+f.getStringAsHex(n))})},success:function(){e.each(i,function(j,k){f.setGenericErrors(h,null,f.ERROR_CLASS_SUB_CALENDAR_TOGGLE_EVENTS+f.getStringAsHex(k))})},timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(h,"/preferences/events/hidden.json")})},updateAvailableSubCalendarsInSubCalendarPanel:function(s){var p=this;var j=e("div.sub-calendar-names",s),u=function(){if(f.getSubCalendarsWhichCanAddEvents(s).length){e("#add-event-menu").removeClass("hidden");e(".toolbar-group-addevent, .add-event-button",s).removeClass("hidden")}else{e("#add-event-menu").addClass("hidden");e(".toolbar-group-addevent, .add-event-button",s).addClass("hidden")}},n=function(){if("true"==f.getParameter(s,"readOnly")){e("#add-calendar-menu").addClass("hidden")}else{e("#add-calendar-menu").removeClass("hidden")}},r=function(){e("<div/>",{"class":"no-subcalendars-msg",text:"You haven\'t created or subscribed to any calendars"}).appendTo(j)},o=function(v){if(!Confluence.TeamCalendars.isInternalSubscriptionSubCalendar(v)&&Confluence.TeamCalendars.isJiraSubCalendar(v)){Confluence.TeamCalendars.Dialogs.getEditEventDialog({title:v.name,eventType:v.type+"-calendar",subCalendarId:v.id},v,f,s).show()}else{var x=Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog(v,f.getRenderedMacroCallbackHandler(s));var w=x.getCurrentPanel().body;Confluence.TeamCalendars.setFieldErrors(w,null);if(Confluence.TeamCalendars.subcalendar[v.type].dynamicDialogHeight){x.show()}else{Confluence.TeamCalendars.showDialogInUpdatedHeight(x)}e("input[name='name']",w).focus()}},g=function(x,y,v,w){f.setSubCalendarSpinnerIconVisible(s,true);e.ajax({cache:false,converters:{"text json":function(z){return z}},data:(function(){var z={subCalendarId:x.id,color:y};if(f.getParameter(s,"include")){z.include=f.getParameter(s,"include")}return z})(),dataType:"json",dataFilter:function(z){var A=e.parseJSON(z);if(A.success){f.mergeSubCalendarObjectsToArray(A.payload)}return A},error:function(z,B,A){f.showAjaxError(s,z,B,A,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);if(w){w(z,B,A)}f.setSubCalendarSpinnerIconVisible(s,false)},success:function(z){if(v){v(z)}f.setSubCalendarSpinnerIconVisible(s,false)},type:"POST",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(s,"/subcalendars/color.json")})},m=function(v){e(".child-subcalendar-name",v).filter(function(){return !e(this).attr("threedots")}).each(function(){e(this).attr("title",e(".ellipsis_text",this).text())})},l=function(v){return v.childSubCalendars&&v.childSubCalendars.length&&e.grep(v.childSubCalendars,function(w){return Confluence.TeamCalendars.isJiraSubCalendar(w)}).length===v.childSubCalendars.length},t=function(D){function z(N){var L=e(N),M=L.closest(".child-subcalendar");if(M.length){return f.getSubCalendar(s,M.data("subCalendarId"))}else{return D}}var y=function(L){e(L).filter(function(){var M=e("li.child-subcalendar:not(.subcalendar-disabled)",L);if(M.length===0){L.addClass("allchildsubcalendar-disabled")}else{L.removeClass("allchildsubcalendar-disabled")}})};var F=(function(){var M=e(Confluence.TeamCalendars.Templates.subCalendarPanelEntry({subCalendar:D,hideWatchMenuItem:f.getParameter(s,"hideWatchMenuItem")==="true",autoConvertSupported:f.isAutoConvertSupported(s),subCalendarClasses:f.getParameter(s,"subCalendarColorClass")})),L=e(".child-subcalendar",M);L.each(function(){var N=e(this),O=[N.data("subCalendarId")];e(".child-subcalendar-name",this).click(function(){var P=N.hasClass("subcalendar-disabled");if(P){N.removeClass("subcalendar-disabled");f.addSubCalendarEventSource(s,O);if(!Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar(D)){O.push(D.id)}f.setSubCalendarEventsHidden(s,O,false)}else{N.addClass("subcalendar-disabled");f.removeSubCalendarEventSource(s,O);f.setSubCalendarEventsHidden(s,O,true)}if(L.filter(function(){return e(this).hasClass("subcalendar-disabled")}).length){M.addClass("subcalendar-disabled");y(M)}else{M.removeClass("subcalendar-disabled")}return false});e(N).hover(function(){N.addClass("active-child-subcalendar")},function(){N.removeClass("active-child-subcalendar")})});e(".subcalendar-name",M).click(function(){var O,N=function(P){return e.map(P,function(Q){return e(Q).data("subCalendarId")})};if(M.hasClass("subcalendar-disabled")){M.removeClass("subcalendar-disabled");M.removeClass("allchildsubcalendar-disabled");O=N(L.removeClass("subcalendar-disabled"));if(!Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar(D)){O.push(D.id)}f.setSubCalendarEventsHidden(s,O,false);f.addSubCalendarEventSource(s,O)}else{M.addClass("subcalendar-disabled");M.addClass("allchildsubcalendar-disabled");O=N(L.addClass("subcalendar-disabled"));if(!Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar(D)){O.push(D.id)}f.setSubCalendarEventsHidden(s,O,true);f.removeSubCalendarEventSource(s,O)}});e(".children-toggle",M).click(function(){var N=e(this);if(N.hasClass("icon-section-closed")){M.addClass("expanded");m(M);N.removeClass("icon-section-closed").addClass("icon-section-opened")}else{if(N.hasClass("icon-section-opened")){M.removeClass("expanded");N.removeClass("icon-section-opened").addClass("icon-section-closed")}}});return M})(),B=function(){var L=e(".child-subcalendar",F),N=[],M=[];if(Confluence.TeamCalendars.isSubscriptionSubCalendar(D)){if(D.eventsHidden||e.inArray(D.id,M)!==-1){F.addClass("subcalendar-disabled");M.push(D.id)}else{if(!Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar(D)){N.push(D.id)}}}L.each(function(){var P=e(this),O=f.getSubCalendar(s,P.data("subCalendarId"));if(D.eventsHidden||O.eventsHidden||e.inArray(O.id,M)!==-1){P.addClass("subcalendar-disabled");M.push(O.id)}else{N.push(O.id)}});if(N.length){f.addSubCalendarEventSource(s,N)}if(M.length){F.addClass("subcalendar-disabled")}y(F)},C=function(){e(".subcalendar-addevent",F).click(function(L){var M=z(this);Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:new Date(),localizedStartTime:f.getDefaultStartTime(s),localizedEndTime:f.getDefaultEndTime(s),allDay:(s.data(f.PREF_LAST_ALL_DAY_USED)||"true")==="true",subCalendarId:M.id},M,f,s).show();L.preventDefault()})},H=function(){e(".subcalendar-edit, .subcalendar-view",F).click(function(L){o(z(this));L.preventDefault()})},K=function(){e(".subcalendar-restrict",F).click(function(L){f.getSubCalendarRestrictionsDialog(s,z(this)).show();L.preventDefault()})},A=function(){e(".subcalendar-icalexport",F).each(function(){e(this).attr("href",f.getCalendarServiceBaseUrl(s,"/export/subcalendar/"+encodeURIComponent(z(this).id)+".ics")+"?os_authType=basic")})},G=function(){var L=function(N,M){e.ajax({cache:false,data:{subCalendarId:D.id},dataType:"json",error:function(O,Q,P){f.showAjaxError(s,O,Q,P,f.ERROR_CLASS_SUB_CALENDAR_WATCH+f.getStringAsHex(D.id))},success:function(){if(M){M()}},type:N?"PUT":"DELETE",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(s,"/preferences/subcalendars/watch.json")})};e(".subcalendar-watch",F).click(function(M){L(true,function(){F.addClass("watched").removeClass("not-watched")});M.preventDefault()});e(".subcalendar-unwatch",F).click(function(M){L(false,function(){F.addClass("not-watched").removeClass("watched")});M.preventDefault()})},I=function(){var L=function(M){return M&&(Confluence.TeamCalendars.isJiraSubCalendar(M)||e.grep(M.childSubCalendars||[],function(N){return L(N)}).length)};e(".subcalendar-reload",F).click(function(M){var O=e(this).data("childSubCalendarId"),N=z(this);if(!f.isSubCalendarEventsUpdatable(s,N)||L(N)||Confluence.TeamCalendars.isSubscriptionSubCalendar(N)){e.ajax({cache:false,data:{subCalendarId:N.id},dataType:"json",error:function(P,R,Q){f.showAjaxError(s,P,R,Q,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(N.id))},success:function(P){f.setGenericErrors(s,null,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(N.id));if(P.success){f.reloadSubCalendar(s,N.id)}},type:"POST",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(s,"/subcalendars/admin/refresh.json")})}else{f.reloadSubCalendar(s,N.id)}M.preventDefault()})},E=function(){e(".subcalendar-remove",F).click(function(L){var M=z(this);if(f.isSubCalendarDeletable(s,M)){if(Confluence.TeamCalendars.isJiraSubCalendar(M)){f.deleteSubCalendar(s,M)}else{f.removeSubCalendarDialog(s,M)}}else{f.unsubscribeFromSubcalendar(s,M)}L.preventDefault()})},x=function(){e(".subcalendar-share, .subcalendar-share-or-embed",F).click(function(L){var M=f.getSubCalendarShareDialog(s,z(this));M.show();e(".share-address-field",M.getCurrentPanel().body).focus().select();L.preventDefault()})},J=function(){e(".subcalendar-subscribe",F).click(function(L){var N=z(this);if(f.getParameter(s,"privateUrlsEnabled")=="true"){f.getSubCalendarIcalAddressDialog(s,N).show()}else{var M=f.getSubCalendarBasicAuthIcalAddressDialog(s,N);M.show();e(".ical-address-basic-field",M.getCurrentPanel().body).focus().select()}L.preventDefault()})},w=function(){var L=function(){f.setProcessingSubCalendar(s,false)};e(".color-cell",F).click(function(){if(!f.isProcessingSubCalendar(s)){f.setProcessingSubCalendar(s,true);var O=e(this),N=O.closest(".child-subcalendar");if(N.length){var M=f.getSubCalendar(s,N.data("subCalendarId"));g(M,O.data("colour"),function(P){if(P.success){c.removeCalendar(M.id);f.setGenericErrors(s,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);f.setSubCalendars(s,P.payload);f.removeSubCalendarEventSource(s,M.id);f.updateAvailableSubCalendarsInSubCalendarPanel(s);N.removeClass().addClass("aui-dd-parent "+O.data("colour"))}else{f.setGenericErrors(s,"Unable to change the colour of the calendar. Please authenticate first.",f.ERROR_CLASS_SUB_CALENDAR_UPDATE)}L()},L)}}return false})},v=function(){e(".subcalendar-dropdown-menu",F).dropDown("Standard",{alignment:"right"})};B();C();H();K();A();G();I();E();x();J();w();v();return F},i=function(){e(".subcalendar-item .subcalendar-name",j).each(function(){e(this).attr("title",e(".ellipsis_text",this).text())})},q=function(x){var A=f.getParameter(s,"readOnly")==="true",z=f.getParameter(s,"isNotificationsEnabled")==="true",v=f.getParameter(s,"hideEditMenuItem")==="true",y=f.getParameter(s,"hideRemoveMenuItem")==="true",w=f.getParameter(s,"hideColorGrid")==="true";setMenuOptions=function(C,D){var F=Confluence.TeamCalendars.isJiraSubCalendar(C),B=Confluence.TeamCalendars.isSubscriptionSubCalendar(C),E=l(C);C.displayName=C.name;if(Confluence.TeamCalendars.isSubscriptionSubCalendar(C)&&!D){C.menuOptions={showMenu:false}}else{C.menuOptions={showMenu:true,showAddEvent:!A&&!F&&C.eventsEditable,showNotifications:z&&!D,showEdit:!v&&!A&&C.editable,showView:!v&&!A&&!C.editable,showRestrictions:!A&&C.administrable&&!F,showRemove:!y&&!A&&C.editable,showShareAndSubscribe:C.eventsViewable&&!F,showSubscribe:!E&&!F,showColourGrid:!w&&(B||F),showReload:C.reloadable}}};e.each(x,function(B,C){setMenuOptions(C,false);if(C.childSubCalendars){e.each(C.childSubCalendars,function(E,G){var D=G.typeKey;var F=p.getEventTypeNames(D);if(Confluence.TeamCalendars.isSubscriptionSubCalendar(G)||(Confluence.TeamCalendars.isJiraSubCalendar(G))){setMenuOptions(G,true)}else{G.menuOptions={showMenu:true,showColourGrid:true,showReload:true};G.displayName=F}})}})},h=function(v){return e.grep(v,function(w,x){return w.childSubCalendars!=null}).length};j.empty();u();n();var k=Confluence.TeamCalendars.getSortedSubCalendarsByTypeAndName(this.getSubCalendars(s));q(k);if(!h(k)){a()}if(!k.length){r()}e.each(k,function(v,w){j.append(t(w))});i();e(".child-subcalendar",j).each(function(){m(e(this))})},unsubscribeFromSubcalendar:function(h,g){if(!f.isProcessingSubCalendar(h)){f.setProcessingSubCalendar(h,true);f.setSubCalendarSpinnerIconVisible(h,true);if(g.subscriptionId){f._deleteSubCalendarInternal(h,g.id,function(i,k,j){f.showAjaxError(h,i,k,j,f.ERROR_CLASS_SUB_CALENDAR_DELETE);f.setSubCalendarSpinnerIconVisible(h,false);f.setProcessingSubCalendar(h,false)},function(i){if(i.success){f.setGenericErrors(h,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);e.each(e.merge([g],g.childSubCalendars||[]),function(k,j){f.setGenericErrors(h,null,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(j.id))});f.setGenericErrors(h,null,f.ERROR_CLASS_SUB_CALENDAR_DELETE);f.removeSubCalendarEventSource(h,g.id);f.removeSubCalendarEventSource(h,g.childSubCalendars);f.setSubCalendars(h,i.payload);f.updateAvailableSubCalendarsInSubCalendarPanel(h)}else{f.setGenericErrors(h,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",f.ERROR_CLASS_SUB_CALENDAR_DELETE)}f.setSubCalendarSpinnerIconVisible(h,false);f.setProcessingSubCalendar(h,false)})}else{e.ajax({cache:false,converters:{"text json":function(i){return i}},data:(function(){var i={subCalendarId:g.id};if(f.getParameter(h,"include")){i.include=f.getParameter(h,"include")}return i})(),dataType:"json",dataFilter:function(i){var j=e.parseJSON(i);if(j.success){f.mergeSubCalendarObjectsToArray(j.payload)}return j},error:function(i,k,j){f.showAjaxError(h,i,k,j);f.setSubCalendarSpinnerIconVisible(h,false);f.setProcessingSubCalendar(h,false)},success:function(i){f.setGenericErrors(h,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);f.removeSubCalendarEventSource(h,g.id);f.removeSubCalendarEventSource(h,g.childSubCalendars);f.setSubCalendars(h,i.payload);f.updateAvailableSubCalendarsInSubCalendarPanel(h);f.setSubCalendarSpinnerIconVisible(h,false);f.setProcessingSubCalendar(h,false)},type:"DELETE",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(h,"/preferences/subcalendars.json")})}}},getNextUnusedSubCalendarColor:function(l){var k=f.getSubCalendars(l);var j=f.getParameter(l,"subCalendarColorClass");for(var h=0;h<j.length;++h){var i=j[h];var m=false;for(var g=0;g<k.length;++g){if(i===k[g].color){m=true;break}}if(!m){return i}}return k.length?j[k.length%j.length]:"subcalendar-blue"},setProcessingSubCalendar:function(h,g){h.data("processingSubCalendar",g)},isProcessingSubCalendar:function(g){return g.data("processingSubCalendar")},getDeleteSubCalendarConfirmationDialog:function(i,g,h){var j=this.createDeleteSubCalendarConfirmationDialog(i,g,h);e("input[name='subCalendarId']",j.getCurrentPanel().body).val(g.id);return j},createDeleteSubCalendarConfirmationDialog:function(k,g,j){var h=new AJS.Dialog({height:290,width:550,id:"delete-calendar-dialog"});h.addHeader(Confluence.TeamCalendars.isJiraSubCalendar(g)?"Delete Event":"Delete Calendar");h.addPanel("Delete Calendar",Confluence.TeamCalendars.Templates.confirmRemoveSubCalendar({subCalendar:g,subscriberCount:j}),"delete-subcalendar-confirmation-panel");var i=h.getCurrentPanel().body;e("form.sub-calendar-delete-confirm",i).submit(function(){return false});h.addButton(Confluence.TeamCalendars.isJiraSubCalendar(g)?"Delete Event":"Delete Calendar",function(){if(!f.isProcessingSubCalendar(k)){f.setProcessingSubCalendar(k,true);var l=f.getSubCalendar(k,e("input[name='subCalendarId']",i).val());f._deleteSubCalendarInternal(k,l.subscriptionId||l.id,function(m,o,n){f.showAjaxError(k,m,o,n,f.ERROR_CLASS_SUB_CALENDAR_DELETE);h.remove();f.setSubCalendarSpinnerIconVisible(k,false);f.setProcessingSubCalendar(k,false)},function(m){if(m.success){f.setGenericErrors(k,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);e.each(e.merge([l],l.childSubCalendars||[]),function(o,n){f.setGenericErrors(k,null,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(n.id))});f.setGenericErrors(k,null,f.ERROR_CLASS_SUB_CALENDAR_DELETE);f.removeSubCalendarEventSource(k,l.id);f.removeSubCalendarEventSource(k,l.childSubCalendars);f.setSubCalendars(k,m.payload);f.updateAvailableSubCalendarsInSubCalendarPanel(k)}else{f.setGenericErrors(k,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",f.ERROR_CLASS_SUB_CALENDAR_DELETE)}h.remove();f.setSubCalendarSpinnerIconVisible(k,false);f.setProcessingSubCalendar(k,false)})}return false});h.addLink("Cancel",function(){h.remove();f.setSubCalendarSpinnerIconVisible(k,false);return false});return h},removeSubCalendarDialog:function(k,i){var h=e("#remove-calendar-dialog"),g;if(h){h.remove()}g=Confluence.TeamCalendars.isPDLEnabled()?230:200;h=new AJS.Dialog({width:512,height:g,id:"remove-calendar-dialog"});h.addHeader("Remove Calendar","subcalendar-remove-header calendar-dialog-panel");h.addPanel("subcalendar-remove-calendar",Confluence.TeamCalendars.Templates.removeSubCalendar(),"remove-subcalendar-form");var j=e(".calendar-to-remove",h.getPanel());j.attr("title",i.name);j.text(i.name);h.addButton("OK",function(){if(e("#deletecalendaroption:checked",h.getPanel()).length){f.deleteSubCalendar(k,i)}else{f.unsubscribeFromSubcalendar(k,i)}h.hide()});h.addLink("Cancel",function(){h.hide()});h.show()},deleteSubCalendar:function(h,g){if(!f.isProcessingSubCalendar(h)){f.setProcessingSubCalendar(h,true);f.setSubCalendarSpinnerIconVisible(h,true);e.ajax({cache:false,data:{subCalendarId:g.subscriptionId||g.id},dataType:"json",error:function(i,k,j){f.showAjaxError(h,i,k,j,f.ERROR_CLASS_SUB_CALENDAR_DELETE);f.setProcessingSubCalendar(h,false);f.setSubCalendarSpinnerIconVisible(h,false)},success:function(j){var m=h.data("subCalendarEditFormDialog");if(m){m.hide()}var n=f.getDeleteSubCalendarConfirmationDialog(h,g,j.subscriptionCount),k=n.getCurrentPanel().body,i=e(".calendar-to-delete",k);i.removeAttr("ThreeDots").empty().append(e(document.createElement("span")).addClass("ellipsis_text").text(g.name));f.setProcessingSubCalendar(h,false);var l=function(o){if(27===o.keyCode){f.setProcessingSubCalendar(h,false);f.setSubCalendarSpinnerIconVisible(h,false);e(document).unbind("keypress",l)}};e(document).keypress(l);n.show();i.ThreeDots()},type:"GET",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(h,"/subcalendars/links.json")})}},_deleteSubCalendarInternal:function(j,k,h,g){var i={subCalendarId:k};if(f.getParameter(j,"include")){i.include=f.getParameter(j,"include")}e.ajax({cache:false,converters:{"text json":function(l){return l}},data:i,dataFilter:function(l){var m=e.parseJSON(l);if(m.success){f.mergeSubCalendarObjectsToArray(m.payload)}return m},dataType:"json",error:function(l,n,m){if(h){h(l,n,m)}},success:function(l){if(g){g(l)}},type:"DELETE",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(j,"/subcalendars.json")})},addSubCalendarEventSource:function(h,j){if(!j){return}var i=Confluence.TeamCalendars.getAsArray(j),g=h.data("visibleEventSources")||{};e.each(i,function(l,k){if(!g[k]){g[k]=f.getSubCalendarEventSource(h,k);f.getCalendarPanel(h).fullCalendar("addEventSource",g[k])}});h.data("visibleEventSources",g)},removeSubCalendarEventSource:function(h,j){if(!j){return}var i=Confluence.TeamCalendars.getAsArray(j),g=h.data("visibleEventSources")||{};e.each(i,function(l,k){if(g[k]){f.getCalendarPanel(h).fullCalendar("removeEventSource",g[k]);g[k]=null}});h.data("visibleEventSources",g)},isHttpsServer:function(g){return f.getParameter(g,"baseUrl").substring(5,0).toLowerCase()!="https"},getSubCalendarEventSource:function(j,k){var h=j.data("eventSources")||{},g=function(l,n){var m=l.data("retrieveEventsQueue")||{};if(!m[n]){m[n]=[]}l.data("retrieveEventsQueue",m);return m[n]},i=h[k]||function(m,r,o){if(!(isNaN(m.getTime())||isNaN(r.getTime()))){if(c.hasCalendar(k)&&c.getCalendarStart(k).getTime()<m.getTime()&&c.getCalendarEnd(k).getTime()>r.getTime()){o(c.getCalendarData(k));return}var u=g(j,k);for(var q=0;q<u.length;++q){var t=u.shift();if(!t.aborted&&t.xhr.readyState!==4){try{t.xhr.abort()}catch(p){}t.xhr.aborted=true}}var s=new Date(m.getTime()-(1000*60*60*24*30)),v=new Date(r.getTime()+(1000*60*60*24*30)),l={subCalendarId:k,userTimeZoneId:Confluence.TeamCalendars.getUserTimeZone(),start:e.fullCalendar.formatDate(s,"u"),end:e.fullCalendar.formatDate(v,"u")},n=f.getSubCalendars(j,function(y){if(!y.childSubCalendar){return false}var x=false;e.each(y.childSubCalendar,function(z,A){if(A.id===k){x=true;return false}});return x});if(n.length){l.parentSubCalendarId=n[0].id}var w=e.ajax({cache:false,data:l,dataType:"json",error:function(C,z,B){if(Confluence.TeamCalendars.isRequireOauth(C)){var y=e.parseJSON(C.responseText),D=e(".jira-calendars-oauth-warnings",j),x=y.oAuthUrl,E=e("div",D).filter(function(){return x===e(this).data("oAuthUrl")}),A=function(){D.append(Confluence.TeamCalendars.Templates.requireOauthMessage({oAuthUrl:x,subCalendarIdsArrayJson:JSON.stringify([k]),subCalendarNamesArrayJson:JSON.stringify([y.subCalendarName]),subCalendarName:e("<div/>",{text:y.subCalendarName}).html()})).find(".approve-dance").click(function(){AppLinks.authenticateRemoteCredentials(y.oAuthUrl,function(){var G=e("div",D).filter(function(){return x===e(this).data("oAuthUrl")});f.reloadSubCalendar(j,G.data("subCalendarIds"));G.remove()},function(){alert("Approval unsuccessful. Could you please try again?")});return false})},F=function(){var H=E.data("subCalendarIds");if(e.inArray(k,H)===-1){H.push(k)}var G=E.data("subCalendarNames");if(e.inArray(y.subCalendarName,G)===-1){G.push(y.subCalendarName)}e("span.subcalendar-names",E.data("subCalendarIds",H).data("subCalendarNames",G)).text(G.join(", "))};if(!E.length){A()}else{F()}}else{if(C.status==403){if(f.getParameter(j,"showHiddenSubCalendars")==="true"){f.showRestrictedCalendarsWarning(j)}else{f.showAjaxError(j,C,z,B,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(k))}}else{if(z!=="abort"){f.showAjaxError(j,C,z,B,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(k))}}}o([])},success:function(C,y){var B=[];f.setGenericErrors(j,null,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(k));C=e.map(C||[],function(E){if(E.className==="greenhopper-sprint"&&!E.allDay){E.allDay=!E.allDay;E.allDayFlipped=true}return E});if(y==="success"&&C){B=f.getEventsTruncated(j,C)}o(B);c.addDataToCalendar(k,B,s,v);var A=f.getSubCalendar(j,k);if(A.warnings&&A.warnings.length){f.setGenericErrors(j,A.warnings,f.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+f.getStringAsHex(k))}var D=f.getParameter(j,"editSubCalendarId"),x=f.getParameter(j,"editEventUid");if(D&&x){var z=f.getCalendarPanel(j).fullCalendar("clientEvents",function(E){return E.subCalendarId===D&&E.id===x});if(z.length){f.setParameter(j,"editSubCalendarId","");f.setParameter(j,"editEventUid","");e("#calendar-dialog-panel").remove();Confluence.TeamCalendars.Dialogs.getEditEventDialog(z[0],A,f,j).show()}}},type:"GET",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(j,"/events.json")});u.push({xhr:w})}};h[k]=i;j.data("eventSources",h);return i},getEventsTruncated:function(t,u,n){var o=this.getCalendarPanel(t).fullCalendar("getView");var q=parseInt(this.getParameter(t,"maxEventsToDisplayPerCalendar"));var i={};e.each(u,function(w,v){if(!i[v.subCalendarId]){i[v.subCalendarId]=[]}i[v.subCalendarId].push(v)});var s=function(v){v.sort(function(x,z){var w=x._start||e.fullCalendar.parseISO8601(x.start,true);var y=z._start||e.fullCalendar.parseISO8601(z.start,true);return w.getTime()-y.getTime()})};var l=[];var r={};e.each(i,function(z,x){s(x);var w=o.visStart;var v;if(x.length>q){var y=-1;e.each(x,function(C,B){var A=B._start||e.fullCalendar.parseISO8601(B.start,true);if(A>=w){y=C;return false}});if(-1===y){v=x.slice(-q)}else{v=x.slice(y,Math.min(y+q,x.length))}l.push(f.getSubCalendar(t,x[0].subCalendarId).name)}else{v=x}r[z]=v});if(l.length){var k=e(".events-truncated-message-container",t);var m=function(v){v.sort(function(x,w){return x>w?1:(w>x?-1:0)})};var p=function(w){var v=e(document.createElement("ul"));e.each(w,function(x,y){v.append(e(document.createElement("li")).text(y))});return v};var j;if(n){m(l);j=p(l)}else{var g=e.map(e("ul li",k),function(v){return e(v).text()});e.each(l,function(v,w){if(-1===e.inArray(w,g)){g.push(w)}});m(g);j=p(g)}AJS.messages.warning(k.empty(),{title:"Some events were not shown in the calendars below because there were too many of them",body:e(document.createElement("div")).append(j).html()});var h=[];e.each(r,function(w,v){e.merge(h,v)});return h}else{return u}},isCalendarInEditMode:function(g){return this.getParameter(g,"readOnly")!=="true"},isEventEditable:function(h,g){return this.isCalendarInEditMode(h)&&this.isSubCalendarEventsUpdatable(h,this.getSubCalendar(h,g.subCalendarId))&&g.editable},isEventDeletable:function(i,h){var g=f.getSubCalendar(i,h.subCalendarId);return f.isEventEditable(i,h)&&!Confluence.TeamCalendars.isJiraSubCalendar(g)},getEventDetailsDialog:function(o,h,m,g){var k=f.getSubCalendar(o,h.subCalendarId),i=f.getSubCalendar(o,k.parentId),n=(function(){return(e.inArray(f.getCalendarPanel(o).fullCalendar("getView").name,["month","agendaWeek"])!==-1)||f.getParameter(o,"showSubCalendarNameInEventPopup")!=="true"})(),l=function(){return e("<div/>").html(Confluence.TeamCalendars.Templates.eventPopup({contextClass:n?"mycalendars":"",baseUrl:f.getParameter(o,"baseUrl"),event:e.extend(e.extend({},h),{colour:k.color,subCalendarDisplayName:i&&!Confluence.TeamCalendars.isSubscriptionSubCalendar(k)?i.name:k.name,subCalendarId:i?i.id:k.id,inviteesSupported:k.inviteesSupported})}))},j=AJS.InlineDialog(m,f.dialogSequence++,function(r,p,t){var q=l();e(".field-duration",q).each(function(){var u=e(this);if(h.localizedStartDate!==h.localizedEndDate){u.empty().text("Formatting...");f.formatDate(o,[h._start,h._end],"dd MMM",function(v){if(typeof v==="string"){u.text(v);return}if(h.allDayFlipped?!h.allDay:h.allDay){u.text(AJS.format("{0} - {1}",v[0],v[1]))}else{u.text(AJS.format("{0}, {1} - {2}, {3}",v[0],h.localizedStartTime,h.localizedEndTime,v[1]))}})}else{if(!((h.allDayFlipped?!h.allDay:h.allDay))){u.empty().text(h.localizedStartTime+" - "+h.localizedEndTime)}}});var s=e(".edit-controls",q);if(f.isEventEditable(o,h)){s.each(function(){if(f.getParameter(o,"redirectEditInEventPopup")==="true"){e(".event-edit",this).unbind("click").attr("href",f.getParameter(o,"baseUrl")+"/calendar/mycalendar.action?startDayOfMonth="+e.fullCalendar.formatDate(h.start,"d")+"&startMonthOfYear="+(parseInt(e.fullCalendar.formatDate(h.start,"M"))-1)+"&startYear="+e.fullCalendar.formatDate(h.start,"yyyy")+"&editSubCalendarId="+encodeURIComponent(f.getSubCalendar(o,h.subCalendarId).id)+"&editEventId="+encodeURIComponent(h.id)+"&editView=month")}else{e(".event-edit",this).unbind("click").click(function(){j.hide();var w=f.getSubCalendar(o,h.subCalendarId),v=Confluence.TeamCalendars.Dialogs.getEditEventDialog(e.extend({},h,{eventType:w.subscriptionType||w.type,subCalendarId:w.parentId}),null,f,o);v.show();return false})}var u=e(".event-delete",this);if(f.isEventDeletable(o,h)&&f.getParameter(o,"hideDeleteInEventPopup")==="false"){u.click(function(){j.hide();f.getEventDeleteConfirmationDialog(o,h).show();return false})}else{u.remove()}})}else{s.each(function(){e(".edit-control",this).remove()})}s.each(function(){e(".event-hyperlink-separator:first-child, .event-hyperlink-separator:last-child",this).remove()});q.appendTo(r.empty());t()},(function(){var p={hideDelay:0,noBind:true,isRelativeToMouse:true,showDelay:0,width:Confluence.TeamCalendars.isPDLEnabled()&&e.inArray("jira-version",h.className)!==-1?380:360,hideCallback:function(){f.setSuppressEventToolTip(o,false)},initCallback:function(){f.setSuppressEventToolTip(o,true)}};return g?e.extend(p,g):p})());j.addClass("event-display-dialog");return j},getEventDeleteConfirmationDialog:function(j,g){var l,h,k=function(n,m){if(!f.isProcessingEvent(j)){f.setProcessingEvent(j,true);f.deleteEvent(j,n,function(o,q,p){f.showAjaxError(j,o,q,p,f.ERROR_CLASS_EVENT_DELETE);m.hide();f.setProcessingEvent(j,false)},function(o){if(o.success){Confluence.TeamCalendars.fireEventForAnalytics("event.delete.default."+g.eventType+".context."+f.getParameter(j,"calendarContext"));f.setGenericErrors(j,null,f.ERROR_CLASS_EVENT_DELETE);if(n.singleInstance){f.getCalendarPanel(j).fullCalendar("removeEvents",[g.id])}else{var p=f.getSubCalendar(j,g.subCalendarId);f.reloadSubCalendar(j,p.parentId||p.id)}}else{f.setGenericErrors(j,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",f.ERROR_CLASS_EVENT_DELETE)}m.hide();f.setProcessingEvent(j,false)});return false}};if(g.recur){h=Confluence.TeamCalendars.isPDLEnabled()?270:210;l=new AJS.Dialog({width:550,height:h,id:"team-calendar-confirm-event-delete"});l.addHeader("Delete Recurring Event");l.addPanel("",Confluence.TeamCalendars.Templates.confirmRecurringEventDelete({elementIdSuffix:f.getParameter(j,"elementIdSuffix")}),"delete-event-confirmation-panel");var i=l.getCurrentPanel().body;e(".delete-this-instance-only",i).click(function(){k({subCalendarId:g.subCalendarId,uid:g.id,recurrenceId:g.recurId||"",originalStart:g.originalStart||"",singleInstance:true},l);return false});e(".delete-future-instances-only",i).click(function(){k({subCalendarId:g.subCalendarId,uid:g.id,recurUntil:e.fullCalendar.formatDate(g.start,"yyyyMMdd")},l);return false});e(".delete-all-instances",i).click(function(){k({subCalendarId:g.subCalendarId,uid:g.id},l);return false});l.addLink("Cancel",function(){l.hide();return false})}else{h=Confluence.TeamCalendars.isPDLEnabled()?170:130;l=new AJS.Dialog(280,h);l.addHeader("Delete Event");l.addPanel("",Confluence.TeamCalendars.Templates.confirmEventDelete(),"delete-event-confirmation-panel");l.addButton("Yes",function(){k({subCalendarId:g.subCalendarId,uid:g.id},l)});l.addLink("Cancel",function(){l.hide();return false})}return l},updateEvent:function(j,i,h,g){i.userTimeZoneId=Confluence.TeamCalendars.getUserTimeZone();this.setSubCalendarSpinnerIconVisible(j,true);e.ajax({cache:false,data:i,dataFilter:function(l){var k=e.parseJSON(l);if(k.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray([k.subCalendar])}return k},dataType:"text",error:function(k,m,l){if(h){h(k,m,l)}f.setSubCalendarSpinnerIconVisible(j,false)},success:function(l){var m=i.eventType,k=f.getParameter(j,"calendarContext");if(i.uid){Confluence.TeamCalendars.fireEventForAnalytics("event.update.default."+m+".context."+k)}else{Confluence.TeamCalendars.fireEventForAnalytics("event.create.default."+m+".context."+k)}c.removeCalendar(i.subCalendarId);c.removeCalendar(i.originalSubCalendarId);if(g){g(l)}f.setSubCalendarSpinnerIconVisible(j,false)},type:"PUT",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(j,"/events.json")})},setSubCalendarSpinnerIconVisible:function(h,i){var g=e(".calendar-panel .right-controls .spinner, .calendar-toolbar .spinner",h);var j=(g.data("loadingStackSize")||0)+(i?1:-1);if(j>0){g.removeClass("invisible")}else{g.addClass("invisible")}g.data("loadingStackSize",j)},addGeneralResizeListener:function(g){g.bind("resize.teamcalendars",function(){f.getCalendarPanel(g).fullCalendar("render");return false})},addDocumentationThemeSplitterResizeListener:function(g){e("#splitter").bind("resize",function(){g.trigger("resize.teamcalendars")})},addSidebarToggleListener:function(g){e("#personal-info-sidebar").bind("toggled",function(){g.trigger("resize.teamcalendars")})},initCalendarToolbar:function(g){e(".feedback-form-trigger",g).click(function(){var i=new AJS.Dialog(700,512);i.addHeader("Team Calendars Plugin Feedback");i.addPanel("","<div class='loading-message'></div><iframe src='https://atlassian.wufoo.com/forms/team-calendars-feedback/' frameborder='0'></iframe>","calendar-feedback-dialog-panel");var h=i.getCurrentPanel().body;var j=e(".loading-message",h).text("Loading...");e("iframe",h).load(function(){j.remove()});i.addCancel("Cancel",function(){i.hide();return false});i.show();return false});e(".change-view",g).click(function(){var h=e(this);f.getCalendarPanel(g).fullCalendar("changeView",h.data("viewName"));Confluence.TeamCalendars.fireEventForAnalytics("view."+h.data("analyticsViewName")+".render");return false});e(".today",g).click(function(){c.removeAllCalendars();f.getCalendarPanel(g).fullCalendar("today");return false});e(".page-prev",g).click(function(){var h=f.getCalendarPanel(g);delete h.fullCalendar("getView").daysMore;if(h.fullCalendar("getView").name==="basicDay"){h.fullCalendar("incrementDate",0,0,-parseInt(f.getParameter(g,"maxUpcomingDays")))}else{h.fullCalendar("prev")}return false});e(".page-next",g).click(function(){var h=f.getCalendarPanel(g);delete h.fullCalendar("getView").daysMore;if(h.fullCalendar("getView").name==="basicDay"){h.fullCalendar("incrementDate",0,0,parseInt(f.getParameter(g,"maxUpcomingDays")))}else{h.fullCalendar("next")}return false})},getStringAsHex:function(h){var j="";if(h){var g=h.length;for(var k=0;k<g;++k){var i=h.charCodeAt(k);j+=i.length>1?i:"0"+i}}return j},formatDate:function(l,i,k,h){if(h){var g=e.isArray(i);if(g&&!i.length){h();return}var j={date:e.map(g?i:[i],function(m){return e.fullCalendar.formatDate(m,"ddMMyyyyHHmm")}),pattern:k};e.ajax({cache:false,data:j,dataType:"json",error:function(){h(AJS.format("Unable to format date\/time {0}",j.date.join(", ")))},success:function(m){h(g?m:m[0])},timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(l,"/util/format/date.json")})}},initWhatsNew:function(i){var h=e(".whatsnew");if(h.length){h.removeClass("hidden");var g=function(j){Confluence.TeamCalendars.suppressMessage(i,"MESSAGE_KEY_PREFIX_WHATSNEW_"+f.getParameter(i,"pluginVersion"),function(){if(e.isFunction(j)){j()}})};e("button",h).click(function(){window.open(e(this).data("url"),"_blank");return false});e(".aui-iconfont-close-dialog",h).click(function(){g(function(){h.addClass("hidden")})})}},getSubCalendarRestrictionsDialog:function(n,i){var h=new AJS.Dialog(410,Confluence.TeamCalendars.isPDLEnabled()?380:300,"tc-restrictions-dialog");h.addHeader("Restrictions");h.addPanel("",Confluence.TeamCalendars.Templates.restrictSubCalendar({elementIdSuffix:f.getParameter(n,"elementIdSuffix"),pdlEnabled:Confluence.TeamCalendars.isPDLEnabled()}),"setup-calendar-panel");var j=e("form",h.getCurrentPanel().body);j.submit(function(){var r=function(t){return e.map(e(".permitted-entity",t),function(v){var u=e(v).data("entity");return e.isPlainObject(u)?u.id:null})};var s=function(t){return e.map(e(".permitted-entity",t),function(v){var u=e(v).data("entity");return typeof u==="string"?u:null})};var p={subCalendarId:e("input[name='subCalendarId']",j).val()};var q=e(".view-permissions",j);if(q.length){p.updateUsersPermittedToView=true;p.usersPermittedToView=r(q);if(!p.usersPermittedToView.length){delete p.usersPermittedToView}p.updateGroupsPermittedToView=true;p.groupsPermittedToView=s(q);if(!p.groupsPermittedToView.length){delete p.groupsPermittedToView}}var o=e(".edit-permissions",j);if(o.length){p.updateUsersPermittedToEdit=true;p.usersPermittedToEdit=r(o);if(!p.usersPermittedToEdit.length){delete p.usersPermittedToEdit}p.updateGroupsPermittedToEdit=true;p.groupsPermittedToEdit=s(o);if(!p.groupsPermittedToEdit.length){delete p.groupsPermittedToEdit}}if(f.getParameter(n,"include")){p.include=f.getParameter(n,"include")}if(!f.isProcessingSubCalendar(n)){f.setSubCalendarSpinnerIconVisible(n,true);e.ajax({cache:false,converters:{"text json":function(t){return t}},data:p,dataType:"json",dataFilter:function(t){var u=e.parseJSON(t);if(u.success){f.mergeSubCalendarObjectsToArray(u.payload)}return u},error:function(t,v,u){f.showAjaxError(n,t,v,u,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);f.setSubCalendarSpinnerIconVisible(n,false);f.setProcessingSubCalendar(n,false)},success:function(t){c.removeCalendar(i.id);f.setGenericErrors(n,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE);f.setSubCalendars(n,t.payload);f.updateAvailableSubCalendarsInSubCalendarPanel(n);f.setSubCalendarSpinnerIconVisible(n,false);f.setProcessingSubCalendar(n,false);h.hide()},type:"PUT",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(n,"/subcalendars/restrictions.json")})}return false});e("input[name='subCalendarId']",j).val(i.id||"");var l=function(p){var o=e(".permission-table",p);var q=e(".permitted-entities",o);if(e(".permitted-entity",q).length){p.addClass("has-restrictions");o.removeClass("hidden")}else{p.removeClass("has-restrictions");o.addClass("hidden")}};var k=function(o){return e("input[name='restriction-type']:checked",o).val()==="view"?e(".view-permissions",o):e(".edit-permissions",o)};var g=function(s,u,o){var q=k(s);var r=e(".permitted-entities",q);var t=function(v){return e(".permitted-entity",r).filter(function(){var w=e(this).data("entity");return e.isPlainObject(w)&&w.id===v.id}).length};var p;if(e.isPlainObject(u)){p=[u]}else{if(e.isArray(u)){p=u}}if(e.isArray(p)){e.each(p,function(w,v){if(!t(v)){var x=e(document.createElement("tr")).addClass("permitted-entity").append(e(document.createElement("td")).append(e(document.createElement("img")).attr("src",v.avatarUrl)).append(e(document.createElement("span")).text(v.fullName).append(e(document.createElement("span")).addClass("user-name").text("("+v.name+")")))).append(e(document.createElement("td")).addClass("delete-permitted-entity").append(e(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){e(this).closest("tr").remove();l(q);return false}))).data("entity",v);if(o){x.prependTo(r)}else{r.append(x)}}});e(".error",s).empty()}l(q)};var m=function(r,z,v,s){var p=k(r),u=e(".permitted-entities",p),w=function(A){return e(".permitted-entity",u).filter(function(){var B=e(this).data("entity");return(typeof B==="string")&&B===A}).length},y=function(A){if(Confluence.TeamCalendars.isPDLEnabled()){return e("<td/>").append(e("<span/>",{"class":"group",text:A}))}else{return e("<td/>").append(e("<img/>",{src:Confluence.getBaseUrl()+"/images/icons/group_16.gif"})).append(e("<span/>",{text:A}))}};if(z.length){var o=function(A){e.each(A,function(B,D){D=e.trim(D);if(D&&!w(D)){var C=e(document.createElement("tr")).addClass("permitted-entity").append(y(D)).append(e(document.createElement("td")).addClass("delete-permitted-entity").append(e(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){e(this).closest("tr").remove();l(p);return false}))).data("entity",D);if(s){C.prependTo(u)}else{u.append(C)}}})};var q=e(".error",r);if(v){var t;var x;e.ajax({cache:false,data:{groupNames:e.map(z,function(A){return e.trim(A)})},dataType:"json",success:function(A){t=A;x=e.map(z,function(B){return e.inArray(e.trim(B),t)===-1?e.trim(B):null});o(t);q.empty();if(x.length){q.text(AJS.format("Invalid group names(s) specified: {0}",x.join(", ")))}l(p)},type:"GET",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(n,"/util/validate/group.json")})}else{q.empty();o(z);l(p)}}};e(".field-group-permissions",j).each(function(){var o=e(this);e(".permissions-details",o).each(function(q){var r=e(this);var p=e(".autocomplete-user",o);p.bind("selected.autocomplete-user",function(t,s){g(o,{id:s.content.userKey||s.content.username,name:s.content.username,fullName:s.content.title,avatarUrl:s.content.thumbnailLink.href},true);p.val("")}).focus(function(){if(p.hasClass("with-hint")){p.removeClass("with-hint").val("")}}).blur(function(){if(!p.val()){p.addClass("with-hint").val("Enter user name")}}).keydown(function(s){if(s.keyCode===13&&!e(".autocomplete .aui-dropdown .active").length){setTimeout(function(){var t=p.val();if(t){m(o,t.split(","),true,true);p.val("")}else{j.submit()}},300);e(".autocomplete .aui-dropdown .no-results").trigger("click");return false}});e(".group-picker-trigger",r).click(function(){var s="Team_Calendars_group_picker_callback_"+f.getParameter(n,"elementIdSuffix")+"_"+q;window[s]=function(t){m(o,t.split(","),false,true)};window.open(f.getParameter(n,"baseUrl")+"/spaces/opengrouppicker.action?key=ds&startIndex=0&actionName=dosearchgroups.action&onPopupSubmit="+encodeURIComponent(s),s,"dependent=1,height=512,width=384,resizable=1,status=0").focus();return false})})});h.addButton("OK",function(){j.submit()});h.addLink("Cancel",function(){h.hide();return false});e(".field-group-permissions",j).each(function(){var p=e(this);var q=e(".option-view-restrictions",p);var o=e(".option-edit-restrictions",p);g(p,i.usersPermittedToEdit||[]);m(p,i.groupsPermittedToEdit||[]);o.removeAttr("checked");q.attr("checked","checked");g(p,i.usersPermittedToView||[]);m(p,i.groupsPermittedToView||[])});return h},getSubCalendarFeatureDiscoveryDialog:function(k,h){var g=Confluence.TeamCalendars.isPDLEnabled()?385:340,j=new AJS.Dialog({width:596,height:g,id:"team-calendars-feature-discovery-dialog"});j.addHeader("Congratulations, you have created a new Calendar!");j.addPanel("",Confluence.TeamCalendars.Templates.subCalendarFeatures({autoConvertSupported:f.getParameter(k,"autoConvertSupported")==="true",subCalendar:h}),"setup-calendar-panel");var i=j.getCurrentPanel().body;e(".add-event",i).click(function(){j.remove();var l=Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:new Date(),localizedStartTime:f.getDefaultStartTime(k),localizedEndTime:f.getDefaultEndTime(k),allDay:(k.data(f.PREF_LAST_ALL_DAY_USED)||"true")==="true",subCalendarId:h.id},h,f,k);l.show();return false});e(".restrict",i).click(function(){j.remove();f.getSubCalendarRestrictionsDialog(k,h).show();return false});e(".embed, .embed-or-share, .share",i).click(function(){j.remove();var l=f.getSubCalendarShareDialog(k,h);l.show();e(".share-address-field",l.getCurrentPanel().body).focus().select();return false});j.addLink("Close",function(){j.remove()});return j},isAutoConvertSupported:function(g){return this.getParameter(g,"autoConvertSupported")==="true"},getSubCalendarShareDialog:function(l,g){var k=f.doesSubCalendarHaveRestrictions(g),j=new AJS.Dialog({width:512,height:n()}),i,h;function n(){var o=(f.isAutoConvertSupported(l)&&!k)?170:150;if(Confluence.TeamCalendars.isPDLEnabled()){o+=60}return o}j.addHeader(this.isAutoConvertSupported(l)?"Share or Embed Calendar":"Share Calendar");j.addPanel("",Confluence.TeamCalendars.Templates.shareSubCalendar({elementIdSuffix:f.getParameter(l,"elementIdSuffix")}),"calendar-share-dialog-panel");j.addLink("Close",function(){j.hide();return false});i=j.getCurrentPanel().body;h=e(".share-restrictions-link",i);e(".share-address-field",j.getCurrentPanel().body).val(AJS.format("{0}/calendar/previewcalendar.action?subCalendarId={1}",f.getParameter(l,"baseUrl"),encodeURIComponent(g.subscriptionId||g.id)));if(k){if(f.isSubCalendarAdministratable(l,g)){h.click(function(){j.hide();f.getSubCalendarRestrictionsDialog(l,g).show()})}else{h.addClass("hidden")}}else{e(".description",i).addClass("hidden");var m=e(".autoconvert",i);if(f.isAutoConvertSupported(l)){m.removeClass("hidden")}else{m.addClass("hidden")}}return j},getResetUrlsDialog:function(k,i){var g=new AJS.Dialog({width:512,height:235,id:"calendar-reset-private-urls-dialog"}),h=function(){g.hide();g.remove()};g.addHeader("Reset Subscription");g.addPanel("",Confluence.TeamCalendars.Templates.resetSubCalendarPrivateUrl(),"calendar-private-url-reset-dialog-panel");var j=g.getCurrentPanel().body;g.addButton("Reset",function(){f.setSubCalendarSpinnerIconVisible(k,true);var m=e(".reset-progress",j).addClass("reset-in-progress");var l=e("#calendar-reset-private-urls-dialog .subcalendar-private-url-reset-button").attr("disabled","disabled");e.ajax({cache:false,success:function(){m.removeClass("reset-in-progress").addClass("reset-done");e("#calendar-reset-private-urls-dialog .reset-cancel").text("Close");l.removeAttr("disabled");f.setSubCalendarSpinnerIconVisible(k,false)},type:"POST",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(k,"/privateurl/reset/"+encodeURIComponent(i.id)),error:function(n,p,o){l.removeAttr("disabled");f.setSubCalendarSpinnerIconVisible(k,false);f.showAjaxError(k,n,p,o,f.ERROR_CLASS_RESET_PRIVATE_URLS)}})},"subcalendar-private-url-reset-button");g.addLink("Cancel",function(){h();return false},"reset-cancel");e(".calendar-title",j).text(i.name);e(".subscribe-to-calendar",j).click(function(){h();f.getSubCalendarIcalAddressDialog(k,i).show();return false});return g},getSubCalendarIcalAddressDialog:function(l,k){var g=f.isHttpsServer(l),j=new AJS.Dialog({width:512,height:m(),id:"calendar-ical-subscription-dialog"}),i=function(){j.hide();j.remove()};function m(){var n=g?379:286;if(Confluence.TeamCalendars.isPDLEnabled()){n+=20}return n}j.addHeader("Subscribe to Calendar");j.addPanel("",Confluence.TeamCalendars.Templates.subCalendarPrivateUrlSubscribe({elementIdSuffix:f.getParameter(l,"elementIdSuffix")}),"calendar-ical-subscription-dialog-panel");j.addLink("Cancel",function(){i();return false});var h=j.getCurrentPanel().body;e(".reset-subscription-url",h).click(function(){i();f.getResetUrlsDialog(l,k).show();return false});if(!g){e(".subscribe-or",h).remove();e(".subscribe-google-calendar",h).remove()}f.setSubCalendarSpinnerIconVisible(l,true);e.ajax({cache:false,success:function(n){e(".ical-address-field",h).val(n).focus().select();if(g){e("a.subscribe-google-calendar",h).attr({href:"https://www.google.com/calendar/render?cid="+encodeURIComponent(n),title:AJS.format("Subscribe to {0} from Google Calendar",k.name)})}f.setSubCalendarSpinnerIconVisible(l,false)},error:function(n,p,o){f.setSubCalendarSpinnerIconVisible(l,false);f.showAjaxError(l,n,p,o,f.ERROR_CLASS_PRIVATE_URL)},type:"GET",timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(l,"/subcalendar/privateurl/"+encodeURIComponent(k.id))});return j},getSubCalendarBasicAuthIcalAddressDialog:function(i,h){var g=new AJS.Dialog({width:512,height:260,id:"calendar-ical-subscription-dialog"});g.addHeader("Subscribe to Calendar");g.addPanel("",Confluence.TeamCalendars.Templates.subCalendarBasicAuthSubscribe({elementIdSuffix:f.getParameter(i,"elementIdSuffix")}),"calendar-ical-subscription-dialog-panel");g.addLink("Cancel",function(){g.hide();return false});e(".ical-address-basic-field",g.getCurrentPanel().body).val(f.getParameter(i,"baseUrl")+"/rest/calendar-services/1.0/calendar/export/subcalendar/"+encodeURIComponent(h.id)+".ics?os_authType=basic");return g},initCalendarDiv:function(h){var g=f.getRenderedMacroCallbackHandler(h);this.initCalendarToolbar(h);this.initSubCalendarPanel(h);this.addDocumentationThemeSplitterResizeListener(h);this.addSidebarToggleListener(h);this.addGeneralResizeListener(h);this.initWhatsNew(h);e(document).keydown(function(i){if(i.keyCode===27){f.getCalendarPanel(h).fullCalendar("unselect")}});if(Confluence.TeamCalendars.shouldShowTimezoneSetup()){Confluence.TeamCalendars.Dialogs.getTimeZoneSetupDialog(g).show()}else{g.showCalendarWizard()}},getRenderedMacroCallbackHandler:function(g){return{isProcessingSubCalendar:function(){return f.isProcessingSubCalendar(g)},setProcessingSubCalendar:function(h){return f.setProcessingSubCalendar(g,h)},setSubCalendarSpinnerIconVisible:function(h){return f.setSubCalendarSpinnerIconVisible(g,h)},getIncludedCalendars:function(){return f.getParameter(g,"include")},mergeSubCalendarObjectsToArray:function(h){return f.mergeSubCalendarObjectsToArray(h)},showAjaxUpdateError:function(h,j,i){f.showAjaxError(g,h,j,i,f.ERROR_CLASS_SUB_CALENDAR_UPDATE)},showAjaxError:function(i,k,j,h){f.showAjaxError(g,i,k,j,h)},setGenericUpdateError:function(){f.setGenericErrors(g,null,f.ERROR_CLASS_SUB_CALENDAR_UPDATE)},setGenericErrors:function(i,h){Confluence.TeamCalendars.setGenericErrors(g,null,h)},setParameter:function(h,i){f.setParameter(g,h,i)},getParameter:function(h){return f.getParameter(g,h)},setSubCalendars:function(h,i){f.setSubCalendars(g,i)},reloadSubCalendar:function(h){f.reloadSubCalendar(g,h)},getSubCalendars:function(){return f.getSubCalendars(g)},updateAvailableSubCalendarsInSubCalendarPanel:function(){f.updateAvailableSubCalendarsInSubCalendarPanel(g)},shouldShowFeatureDiscoveryDialog:function(h){return f.shouldShowFeatureDiscoveryDialog(g,h)},getSubCalendarFeatureDiscoveryDialog:function(h){f.getSubCalendarFeatureDiscoveryDialog(g,f.getSubCalendar(g,h)).show()},getNextCalendarColor:function(){return f.getNextUnusedSubCalendarColor(g)},isAutoWatchSet:function(){return f.getParameter(g,"autowatch")==="true"},refreshCachedSubCalendars:function(h,i){f.refreshCachedSubCalendars(g,h,i)},handleImport:function(h){this.refreshCachedSubCalendars(function(){f.updateAvailableSubCalendarsInSubCalendarPanel(g);if(f.shouldShowFeatureDiscoveryDialog(g)){f.getSubCalendarFeatureDiscoveryDialog(g,f.getSubCalendar(g,h)).show()}},function(i,k,j){f.showAjaxError(g,i,k,j,f.ERROR_CLASS_SUB_CALENDAR_UPDATE)})},isCalendarInEditMode:function(){return f.isCalendarInEditMode(g)},suppressMessage:function(i,h){Confluence.TeamCalendars.suppressMessage(g,i,h)},showCalendarWizard:function(){if("true"===f.getParameter(g,"isShowCalendarWizard")){var i=function(){Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog({heading:"Welcome to Team Calendars!",callbackHandler:f.getRenderedMacroCallbackHandler(g),id:"welcome-to-popular-dialog"}).show()};var h=function(){Confluence.TeamCalendars.Dialogs.getAddDialog(f.getRenderedMacroCallbackHandler(g),{title:"Welcome to Team Calendars!",addClass:"create-calendar-first-time"})};Confluence.TeamCalendars.showCalendarPopupHaveAnEmptySubcalendar(i,h)}},getSubCalendarsWhichCanAddEvents:function(){return f.getSubCalendarsWhichCanAddEvents(g)}}}};var d=false;AJS.$(window).bind("beforeunload",function(){d=true});e("div.plugin-calendar").each(function(){var j=e(this);if(!f.getParameter(j,"defaultView")){var g=f.getCalendarPanel(j).text("Loading...");e.ajax({cache:false,dataType:"json",error:function(){g.empty();f.init(j)},success:function(k){f.setParameter(j,"defaultView",k.view==="agendaDay"?"basicDay":k.view);g.empty();f.init(j)},timeout:f.ajaxTimeout,url:f.getCalendarServiceBaseUrl(j,"/preferences.json")})}else{var i=j.closest(".dashboard-calendar-container");if(i){var h=setInterval(function(){f.init(j);clearInterval(h)},100)}else{f.init(j)}}});e(document).keydown(function(g){var h=true;e(".aui-inline-dialog:visible:first .event-details-popup").each(function(){if(g.keyCode===8||g.keyCode===46){e(".event-delete",this).click();h=false}});return h})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/subcalendar-subscribe-dialog.js' */
(function(a){Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog=function(q){var c=q.callbackHandler;var d=function(t,v,s,w,r){var u=a(".results",t.getCurrentPanel().body);a.ajax({cache:false,converters:{"text json":function(x){return x}},data:v,dataFilter:function(x){var y=a.parseJSON(x);if(y.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(y.payload)}return y.payload},dataType:"json",error:function(z,x,y){if(w){w(v,u)}},success:function(y){u.empty();if(y&&y.length){var x=a(Confluence.TeamCalendars.Templates.calendarSearchResultTable()),z=a("tbody",x),A=function(B){z.append(a(Confluence.TeamCalendars.Templates.calendarSearchResult({name:B.name,description:B.description||"",relatedSpace:B.spaceName||"",numSubscribers:B.subscriberCount})).click(function(){var C=a(this),D=C.hasClass("active");if(D){C.removeClass("active");a(".subcalendar-select",C).removeAttr("checked")}else{C.addClass("active");a(".subcalendar-select",C).attr("checked","checked")}var E=true,F=a("tr.active",z);F.each(function(){if(a(this).data("subCalendar").watchable){E=false;return false}});if(F.length){g();n()}else{b();o()}if(!F.length||E){o()}else{if(!E&&!D){n()}}}).data("subCalendar",B))};a.each(y,function(C,B){if(Confluence.TeamCalendars.isDummySubscriptionParentSubCalendar(B)){a.each(B.childSubCalendars||[],function(D,E){A(E)})}else{A(B)}});u.append(x);a(".ellipsedColumn",x).each(function(){var C=a(this);var B=C.text();C.attr("title",B).ThreeDots({max_rows:1})});if(r){r(y)}}else{if(w){w(v,u)}}},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl(s)})};var f=(function(){var u=q.id!==undefined?q.id:"internal-subscription-calendar-dialog";var r=new AJS.Dialog({width:800,height:400,id:u});r.addHeader("Add Existing Team Calendar");r.addPanel("",Confluence.TeamCalendars.Templates.subscribeDialog(),"subscribe-to-subcalendars-panel");var s=r.getCurrentPanel().body;a("#subscribe-intro",s).append("To help you get started, here is a list of calendars. Select the ones you would like to subscribe to. If you don\'t see what you are looking for, \u003ca class=\"create-your-subcalendar\" href=\"#\">create a calendar\u003c\/a> of your own.");a(".create-your-subcalendar",s).click(function(){r.remove();var w=Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog("parent",c);Confluence.TeamCalendars.showDialogInUpdatedHeight(w);a("input[name='name']",w.getCurrentPanel().body).focus();return false});var v=a(".search",s);a(".form",v).submit(function(){return false});a("textarea[name='query']",v).text("Search").addClass("blank-search").keydown(function(w){if(w.keyCode===13){return false}var y=a(this),x=y.hasClass("blank-search")?y.removeClass("blank-search").val("").val():y.val();setTimeout(function(){var z=y.val();if(!y.hasClass("blank-search")&&z&&z!==x){v.addClass("searching");d(r,a.extend({term:z,limit:10,showSubscriberCount:true},q.searchParams||{}),"/search/subcalendars.json",function(B,A){v.removeClass("searching");b();o();A.empty().append(a(document.createElement("span")).addClass("no-subcalendars-found").text(AJS.format("No results found for {0}",B.term)))},function(){v.removeClass("searching");g()})}},300)}).blur(function(){var w=a(this);if(!a.trim(w.val())){w.addClass("blank-search").val("Search")}});if(r.addHelpText&&a.isFunction(r.addHelpText)){r.addHelpText(a(document.createElement("span")).addClass("show-popular").html("You can also browse \u003ca href=\"#\">popular calendars\u003c\/a>."));a("span.show-popular a",r.getCurrentPanel().page.buttonpanel).unbind("click").click(function(){r.remove();Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog({callbackHandler:c,heading:"Popular Team Calendars"}).show();return false});r.addHelpText(a(document.createElement("span")).addClass("show-search").html("You can also \u003ca href=\"#\">search for calendars\u003c\/a>."));a("span.show-search a",r.getCurrentPanel().page.buttonpanel).unbind("click").click(function(){r.remove();Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog(a.extend(a.extend({},q),{callbackHandler:c,heading:"Add Existing Team Calendar",showSearch:true})).show();return false})}var t=a(".dialog-button-panel",r.popup.element);if(!q.disableWatching){a(document.createElement("input")).attr({type:"checkbox",name:"watch"}).addClass("watch-selected-subcalendars").appendTo(t);a(document.createElement("span")).addClass("watch-select-subcalendars-label").text("Watch selected calendars").appendTo(t)}a("<img>",{"class":"spinner hidden",src:Confluence.getContextPath()+"/images/icons/wait.gif"}).appendTo(t);r.addButton("Add",function(){var w=a("tr.active",s);if(w.length&&!c.isProcessingSubCalendar()){c.setProcessingSubCalendar(true);c.setSubCalendarSpinnerIconVisible();b();o();p();a.ajax({cache:false,converters:{"text json":function(x){return x}},data:(function(){var x={color:c.getNextCalendarColor(),watchSubCalendars:a(".watch-selected-subcalendars",r.popup.element).is(":checked")};var y=[];w.each(function(){y.push(a(this).data("subCalendar").id)});x.subCalendarIds=y;if(c.getIncludedCalendars()){x.include=c.getIncludedCalendars()}return x})(),dataFilter:function(x){var y=a.parseJSON(x);if(y.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(y.payload)}return y},dataType:"json",error:function(x,z,y){Confluence.TeamCalendars.showAjaxError(s,x,z,y,"error-subcalendar-refresh");c.setProcessingSubCalendar(false);g();n();l()},success:function(x){if(!x.success){Confluence.TeamCalendars.setGenericErrors(s,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.","error-subcalendar-refresh");return}c.setSubCalendars(AJS.$.map(w,function(y){return a(y).data("subCalendar").id}).toString(),x.payload);c.updateAvailableSubCalendarsInSubCalendarPanel();Confluence.TeamCalendars.setGenericErrors(s,null,"error-subcalendar-refresh");r.remove();c.setProcessingSubCalendar(false)},type:"PUT",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars/subscribe.json")})}else{r.remove()}},"subscribe-to-subcalendar-button");r.addLink("Cancel",function(){r.remove();return false});return r})();var h=f.getCurrentPanel();var k=h.body;var b=function(){a(".subscribe-to-subcalendar-button","#internal-subscription-calendar-dialog").attr("disabled","disabled").addClass("ui-state-disabled")};var g=function(){a(".subscribe-to-subcalendar-button","#internal-subscription-calendar-dialog").removeAttr("disabled","disabled").removeClass("ui-state-disabled")};var o=function(){a(".watch-selected-subcalendars","#internal-subscription-calendar-dialog").disable()};var n=function(){a(".watch-selected-subcalendars","#internal-subscription-calendar-dialog").enable()};var p=function(){a(".spinner","#internal-subscription-calendar-dialog").removeClass("hidden")};var l=function(){a(".spinner","#internal-subscription-calendar-dialog").addClass("hidden")};var i=a.extend({heading:"Add Existing Team Calendar"},q);var j=h.page.header;j.empty().text(i.heading);if(i.showSearch){j.removeClass("welcome-heading-with-logo")}else{j.addClass("welcome-heading-with-logo")}if(Confluence.TeamCalendars.isPDLEnabled()){if(i.showSearch){k.removeClass("popular").addClass("search")}else{k.removeClass("search").addClass("popular")}}a(".results",k).empty();a(".mode",k).removeClass().addClass("mode"+(i.showSearch?"":" new-user"));var m=a(".watch-selected-subcalendars");o();if(c.isAutoWatchSet()){m.attr("checked","checked")}else{m.removeAttr("checked")}b();o();if(i.showSearch){if(Confluence.TeamCalendars.isCalendarSearchDisabled){a("#tc-subscribe-no-search-warning",k).removeClass("hidden");a(".search",k).addClass("hidden");d(f,{},"/search/subcalendars/all",l,function(){a("#tc-subscribe-no-search-warning .spinner",k).addClass("hidden")})}a("input[name='query']",k).val("");a(".dialog-tip .show-popular",h.page.buttonpanel).removeClass("hidden");a(".dialog-tip .show-search",h.page.buttonpanel).addClass("hidden")}else{var e=a(".preamble",k).addClass("loading");var l=function(){e.removeClass("loading")};d(f,a.extend({limit:10},q.searchParams||{}),"/search/subcalendars/popular",l,function(){l()});a(".dialog-tip .show-popular",h.page.buttonpanel).addClass("hidden");a(".dialog-tip .show-search",h.page.buttonpanel).removeClass("hidden")}return f}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/add-dialog.js' */
(function(b){var a;Confluence.TeamCalendars.Dialogs.getAddDialog=function(d,f){var g,c,e;g={title:"Add Calendar"};b.extend(g,f||{});if(!a){a=new AJS.Dialog(600,320,"add-calendar-dialog");a.addHeader(g.title);a.addPanel(g.title,Confluence.TeamCalendars.Templates.addDialog(),"add-calendar-panel");if(g.addClass){b("#add-calendar-dialog").addClass(g.addClass)}a.addCancel("Cancel",function(){a.hide();return false})}a.show();e=a.getCurPanel().body;b(".option-new",e).unbind().click(function(){var h=Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog("parent",d);Confluence.TeamCalendars.showDialogInUpdatedHeight(h);b("input[name='name']",h.getCurrentPanel().body).focus();a.hide()});b(".option-existing",e).unbind().click(function(){a.hide();var h=b("meta[name='ajs-page-id']").length>=1;var i=Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog(b.extend({callbackHandler:d,heading:h?"Add Existing Team Calendar":"Popular Team Calendars",showSearch:h,searchParams:{showSubCalendarsInView:h},disableWatching:h,id:"internal-subscription-calendar-dialog"}));Confluence.TeamCalendars.showDialogInUpdatedHeight(i)});b(".option-subscription",e).unbind().click(function(){a.hide();var h=Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog("subscription",d);Confluence.TeamCalendars.showDialogInUpdatedHeight(h);b("input[name='name']",h.getCurrentPanel().body).focus()});b(".option-import",e).unbind().click(function(){a.hide();var h=Confluence.TeamCalendars.Dialogs.getSubCalendarImportDialog(d);Confluence.TeamCalendars.showDialogInUpdatedHeight(h);b("input[name='name']",h.getCurrentPanel()).focus()})}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/add-from-macro-dialog.js' */
(function(a){Confluence.TeamCalendars.Dialogs.getAddDialogForMacro=function(d){var b=d.params?d.params.id:"";var c={isProcessingSubCalendar:function(){return false},setProcessingSubCalendar:function(e){},setSubCalendarSpinnerIconVisible:function(e){},getIncludedCalendars:function(){return b?b.split(","):[]},showAjaxUpdateError:function(e,g,f){Confluence.TeamCalendars.showAjaxError(a("#editor-messages"),e,g,f,"error-subcalendar-update")},showAjaxError:function(f,h,g,e){Confluence.TeamCalendars.showAjaxError(a("#editor-messages"),f,h,g,e)},setGenericErrors:function(f,e){Confluence.TeamCalendars.setGenericErrors(a("#editor-messages"),null,e)},setGenericUpdateError:function(){Confluence.TeamCalendars.setGenericErrors(a("#editor-messages"),null,"error-subcalendar-update")},setSubCalendars:function(e){if(!b){Confluence.TeamCalendars.fireEventForAnalytics("subcalendar.parent.embedded")}var f=e+(b?","+b:"");d.params=a.extend(d.params,{id:f});d.body="";AJS.Rte.BookmarkManager.restoreBookmark();var g=tinymce.confluence.MacroUtils.insertMacro({macro:d,contentId:Confluence.Editor.getContentId()});a.when(g).done(function(h){if(h){var i=new Confluence.TeamCalendars.HelpTip({body:"\u003ch3>Calendar added, what next?\u003c\/h3> \u003cp>Embed additional calendars, or modify the look of them, by pressing \u003cstrong>\'Edit\'\u003c\/strong> when selecting this.\u003c\/p>\u003cp>When you are ready, save your page to start adding events!\u003c\/p>",anchor:a(h),id:"first-calendar-help-tip"});i.show()}})},setParameter:function(e,f){},getParameter:function(e){},reloadSubCalendar:function(e){},getSubCalendars:function(){return d.params},updateAvailableSubCalendarsInSubCalendarPanel:function(){},shouldShowFeatureDiscoveryDialog:function(){return false},getSubCalendarFeatureDiscoveryDialog:function(e){},getNextCalendarColor:function(){return""},isAutoWatchSet:function(){return false},refreshCachedSubCalendars:function(f,e){},handleImport:function(e){this.setSubCalendars(e)},isCalendarInEditMode:function(){return true},suppressMessage:function(f,e){Confluence.TeamCalendars.suppressMessage(a("#editor-messages"),f,e)},showCalendarWizard:function(){Confluence.TeamCalendars.Dialogs.getAddDialog(c)},getSubCalendarsWhichCanAddEvents:function(){return[]}};if(Confluence.TeamCalendars.shouldShowTimezoneSetup()){Confluence.TeamCalendars.Dialogs.getTimeZoneSetupDialog(c).show()}else{AJS.Rte.BookmarkManager.storeBookmark();Confluence.TeamCalendars.Dialogs.getAddDialog(c,{title:"Insert Calendar"})}}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/calendar-edit-dialog.js' */
(function(a){Confluence.TeamCalendars.getEditCalendarDialogHelper=function(d,c,b){var h,g=a(".form-mode",d),f=a("input[name='spaceKey']",d),e=a("input[name='spaceKeyAutocomplete']",d);return{initSpaceDropDown:function(){e.bind("selected.autocomplete-content",function(j,i){f.val(i.content.key);a(this).val(i.content.name);a(".spaceKeyAutocomplete-error",d).empty()})},initTimeZoneSelect:function(){a("select[name='timeZoneIdSelect']",d).change(function(){a("input[name='timeZoneId']",d).val(a("option:selected",this).val())})},initCloseButton:function(i){i.addLink("Cancel",function(){i.remove();return false})},initOkButton:function(i,j){j.addButton(i,function(){d.submit();return false},"submit");h=j.popup.element.find(".submit")},populateTimeZoneDropDown:function(i){var j=c?c.timeZoneId:Confluence.TeamCalendars.getUserTimeZone();h.disable();Confluence.TeamCalendars.populateTimeZoneDropDown(a("#timeZoneIdSelect",i.body),j,function(){h.enable()},function(k,m,l){b.showAjaxError(k,m,l)})},disableOkButton:function(i){h.text(i).attr("disabled","disabled").addClass("ui-state-disabled")},enableOkButton:function(i){h.text(i).removeAttr("disabled").removeClass("ui-state-disabled")},isNewCalendar:function(){return c?false:true},resetFieldErrors:function(){Confluence.TeamCalendars.setFieldErrors(d.body,null)},setFormModeEdit:function(){g.removeClass().addClass("form-mode edit")},setFormModeCreate:function(){g.removeClass().addClass("form-mode create")},setFormModeReadOnly:function(){g.removeClass().addClass("form-mode read-only")},setHeading:function(j,i){return i.getCurrentPanel().page.header.empty().text(j).addClass("calendar-heading")},setSubCalendarIdField:function(i){a("input[name='subCalendarId']",d).val(i)},setNameField:function(i){a("input[name='name']",d).val(i)},setDescriptionField:function(i){a("textarea[name='description']",d).val(i)},setColorField:function(i){a("input[name='color']",d).val(i)},setSpaceKeyField:function(i){f.val(i)},setSpaceKeyAutocompleteField:function(i){e.val(i)},setTimeZoneIdField:function(i){a("input[name='timeZoneId']",d).val(i)},setTimeZoneIdDisplayField:function(i){a(".timeZoneIdDisplay",d).text(i)},setSubscriptionIdField:function(i){a("input[name='subscriptionId']",d).val(i)},setLocationField:function(i){a("input[name='location']",d).val(i)},setUserNameField:function(i){a("input[name='username']",d).val(i)},setSpaceToDefault:function(){f.val(AJS.Meta.get("space-key")||"");e.val(AJS.Meta.get("space-name")||"")}}};Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog=function(e,d){var c=(typeof e==="string")?e:e.type,f,h=Confluence.TeamCalendars.subcalendar[c],g=new AJS.ConfluenceDialog({width:h.dialogWidth||521,height:h.dialogHeight||350,onSubmit:function(){f.submit();return false},id:"edit-calendar-dialog"}),b=h.getDialog(g,a.isPlainObject(e)?e:null,d);g.popup.element.css("overflow","visible");f=b.initializeForm();f.submit(function(){if(d.isProcessingSubCalendar()){return false}d.setProcessingSubCalendar(true);d.setSubCalendarSpinnerIconVisible(true);b.onSubmitStart();var i=b.getFormDataAsAjaxData();if(d.getIncludedCalendars()){i.include=d.getIncludedCalendars()}var j=i.subCalendarId;a.ajax({cache:false,converters:{"text json":function(k){return k}},data:i,dataFilter:function(k){var l=a.parseJSON(k);if(l.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(l.payload)}return l},dataType:"json",error:function(k,m,l){d.showAjaxUpdateError(k,m,l);b.onSubmitEnd();d.setSubCalendarSpinnerIconVisible(false);d.setProcessingSubCalendar(false)},success:function(l){d.setGenericUpdateError();if(l.success){Confluence.TeamCalendars.setFieldErrors(f,null);var k=j;if(k){d.setSubCalendars(j,l.payload);d.reloadSubCalendar(j)}else{j=l.modifiedSubCalendarId;a("input[name='subCalendarId']",f).val(j);d.setSubCalendars(j,l.payload)}d.updateAvailableSubCalendarsInSubCalendarPanel();b.onSubmitEnd();g.remove();d.setSubCalendarSpinnerIconVisible(false);if(!k&&d.shouldShowFeatureDiscoveryDialog(j)){d.getSubCalendarFeatureDiscoveryDialog(j)}}else{Confluence.TeamCalendars.setFieldErrors(f,l.fieldErrors);b.onSubmitEnd();d.setSubCalendarSpinnerIconVisible(false);if(!h.dynamicDialogHeight){Confluence.TeamCalendars.showDialogInUpdatedHeight(g)}}d.setProcessingSubCalendar(false)},type:"PUT",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars.json")});return false});return g}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/child-subcalendars.js' */
(function(a){if(!window.Confluence.TeamCalendars.subcalendar){window.Confluence.TeamCalendars.subcalendar={}}window.Confluence.TeamCalendars.subcalendar.other={getDialog:function(){AJS.log("Tried to call getDialog on child calendar type. This should not happen.")},weight:1,typeName:"Events Calendars"};window.Confluence.TeamCalendars.subcalendar.travel=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:2,typeName:"Travel"});window.Confluence.TeamCalendars.subcalendar.leaves=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:3,typeName:"Leave"});window.Confluence.TeamCalendars.subcalendar.birthdays=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:4,typeName:"Birthdays"});window.Confluence.TeamCalendars.subcalendar["jira-agile-sprint"]=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:6,typeName:"JIRA Agile Sprints"});window.Confluence.TeamCalendars.subcalendar["jira-project-releases"]=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:7,typeName:"JIRA Project Releases"});window.Confluence.TeamCalendars.subcalendar["jira-issue-dates"]=a.extend({},window.Confluence.TeamCalendars.subcalendar.other,{weight:8,typeName:"JIRA Issue Dates"})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/parent-subcalendar.js' */
(function(a){if(!window.Confluence.TeamCalendars.subcalendar){window.Confluence.TeamCalendars.subcalendar={}}if(!window.Confluence.TeamCalendars.subcalendar.parent){window.Confluence.TeamCalendars.subcalendar.parent={getDialog:function(f,c,b){var d,e;var g=function(){var i=f.getCurrentPanel();e.resetFieldErrors();e.populateTimeZoneDropDown(i);var h=a("select[name='timeZoneIdSelect']",d);if(e.isNewCalendar()){e.setFormModeCreate();e.setHeading("Create Calendar",f);e.setSubCalendarIdField("");e.setNameField("");e.setDescriptionField("");e.setColorField(b.getNextCalendarColor());e.setSpaceToDefault();e.setTimeZoneIdField("")}else{e.setFormModeEdit();e.setHeading(c.name,f);e.setSubCalendarIdField(c.id);e.setNameField(c.name);e.setDescriptionField(c.description);e.setColorField(c.color);e.setSpaceKeyField(c.spaceKey);e.setSpaceKeyAutocompleteField(c.spaceName);e.setTimeZoneIdField(c.timeZoneId)}var j=a("input[name='name'], textarea[name='description'], input[name='spaceKeyAutocomplete']",d);if(b.isCalendarInEditMode()){j.removeAttr("readonly");h.removeAttr("disabled")}else{e.setFormModeReadOnly();j.attr("readonly","readonly");h.attr("disabled","disabled")}};return{initializeForm:function(){f.addHeader("Create Calendar");f.addPanel("",Confluence.TeamCalendars.Templates.editLocalCalendar(),"calendar-dialog-panel");d=a("form.sub-calendar-edit-form",f.getCurrentPanel().body);e=Confluence.TeamCalendars.getEditCalendarDialogHelper(d,c,b);e.initSpaceDropDown();e.initTimeZoneSelect();e.initOkButton("OK",f);e.initCloseButton(f);g();return d},getFormDataAsAjaxData:function(){return{type:"parent",subCalendarId:a("input[name='subCalendarId']",d).val(),name:a("input[name='name']",d).val(),description:a("textarea[name='description']",d).val(),color:a("input[name='color']",d).val(),spaceKey:a("input[name='spaceKeyAutocomplete']",d).val()?a("input[name='spaceKey']",d).val():"",timeZoneId:a("input[name='timeZoneId']",d).val()||a("select[name='timeZoneIdSelect'] option:selected",d).val()}},onSubmitStart:function(){e.disableOkButton("Adding...")},onSubmitEnd:function(){e.enableOkButton("OK")}}},weight:1,typeName:"Calendars"}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jira-subcalendar.js' */
(function(a){if(!window.Confluence.TeamCalendars.subcalendar){window.Confluence.TeamCalendars.subcalendar={}}if(!window.Confluence.TeamCalendars.subcalendar.jira){window.Confluence.TeamCalendars.subcalendar.jira={weight:5,typeName:"JIRA Calendars",getDialog:function(){AJS.log("Confluence.TeamCalendars.subcalendar.jira.should never be called")}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/subscription-subcalendar.js' */
(function(a){if(!window.Confluence.TeamCalendars.subcalendar){window.Confluence.TeamCalendars.subcalendar={}}if(!window.Confluence.TeamCalendars.subcalendar.subscription){window.Confluence.TeamCalendars.subcalendar.subscription={getDialog:function(f,c,b){var e,d;var g=function(){e.resetFieldErrors();var h=function(){return a(document.createElement("div")).addClass("calendar-dialog-help-link").append(a(document.createElement("a")).attr("href","http:\/\/confluence.atlassian.com\/x\/YQ1cDg").attr("target","_blank").text("Help"))};if(e.isNewCalendar()){e.setFormModeCreate();e.setHeading("Subscribe",f).append(h());e.setSubCalendarIdField("");e.setNameField("");e.setDescriptionField("");e.setColorField(b.getNextCalendarColor());e.setSpaceToDefault();e.setLocationField("");e.setUserNameField("");e.setTimeZoneIdDisplayField("")}else{e.setFormModeEdit();e.setHeading(c.name,f).append(h());e.setSubCalendarIdField(c.id);e.setNameField(c.name);e.setDescriptionField(c.description);e.setColorField(c.color);e.setSpaceKeyField(c.spaceKey);e.setSpaceKeyAutocompleteField(c.spaceName);e.setLocationField(c.sourceLocation);e.setUserNameField(c.userName||"");e.setTimeZoneIdDisplayField(c.timeZoneId)}var i=a("input[name='name'], textarea[name='description'], input[name='spaceKeyAutocomplete'], input[name='location'], input[name='username'], input[name='password']",d);if(b.isCalendarInEditMode()){i.removeAttr("readonly")}else{e.setFormModeReadOnly();i.attr("readonly","readonly")}};return{initializeForm:function(){f.addHeader("Subscribe");f.addPanel("",Confluence.TeamCalendars.Templates.editSubscriptionSubcalendar(),"calendar-dialog-panel");d=a("form.sub-calendar-edit-form",f.getCurrentPanel().body);e=Confluence.TeamCalendars.getEditCalendarDialogHelper(d,c,b);e.initOkButton("Subscribe",f);e.initCloseButton(f);g();return d},getFormDataAsAjaxData:function(){return{type:"subscription",subCalendarId:a("input[name='subCalendarId']",d).val(),name:a("input[name='name']",d).val(),description:a("textarea[name='description']",d).val(),color:a("input[name='color']",d).val(),spaceKey:a("input[name='spaceKeyAutocomplete']",d).val()?a("input[name='spaceKey']",d).val():"",location:a("input[name='location']",d).val(),userName:a("input[name='username']",d).val(),password:a("input[name='password']",d).val()}},onSubmitStart:function(){e.disableOkButton("Subscribing")},onSubmitEnd:function(){e.enableOkButton("Subscribe")}}},weight:6,typeName:"Subscriptions"}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/internal-subscription-subcalendar.js' */
(function(a){if(!window.Confluence.TeamCalendars.subcalendar){window.Confluence.TeamCalendars.subcalendar={}}if(!window.Confluence.TeamCalendars.subcalendar["internal-subscription"]){window.Confluence.TeamCalendars.subcalendar["internal-subscription"]={getDialog:function(f,c,b){var e,d;var g=function(){e.resetFieldErrors();if(e.isNewCalendar()){e.setFormModeCreate();e.setHeading("New calendar",f);e.setSubCalendarIdField("");e.setSubscriptionIdField("");e.setNameField("");e.setDescriptionField("");e.setColorField(b.getNextCalendarColor());e.setTimeZoneIdDisplayField("")}else{e.setFormModeEdit();e.setHeading(c.name,f);e.setSubCalendarIdField(c.id);e.setSubscriptionIdField(c.subscriptionId||"");e.setNameField(c.name);e.setDescriptionField(c.description);e.setColorField(c.color);e.setTimeZoneIdDisplayField(c.timeZoneId);if(!(c.restrictable&&c.administrable)){a(".field-group-permissions",d).remove()}}var h=a("textarea[name='description']",d);if(b.isCalendarInEditMode()){h.removeAttr("readonly")}else{e.setFormModeReadOnly();h.attr("readonly","readonly")}};return{initializeForm:function(){f.addHeader("New calendar");f.addPanel("",Confluence.TeamCalendars.Templates.editInternalSubcalendar(),"calendar-dialog-panel");d=a("form.sub-calendar-edit-form",f.getCurrentPanel().body);e=Confluence.TeamCalendars.getEditCalendarDialogHelper(d,c,b);e.initOkButton("OK",f);e.initCloseButton(f);g();return d},getFormDataAsAjaxData:function(){return{type:"internal-subscription",subCalendarId:a("input[name='subCalendarId']",d).val(),name:a("input[name='name']",d).val(),description:a("textarea[name='description']",d).val(),color:a("input[name='color']",d).val(),location:"subscription://"+a("input[name='subscriptionId']",d).val()}},onSubmitStart:function(){e.disableOkButton("Adding...")},onSubmitEnd:function(){e.enableOkButton("OK")}}},weight:1000,typeName:"Unknown Type"}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/import-subcalendar.js' */
(function(a){Confluence.TeamCalendars.Dialogs.getSubCalendarImportDialog=function(c){var b;d();e();function e(){var f=b.getCurrentPanel().body;a("input[name='name'], textarea[name='description'], input[name='spaceKey'], input[name='spaceKeyAutocomplete']",f).val("");a("input[name='color']",f).val(c.getNextCalendarColor());a(".field-group .error",f).empty()}function d(){var h,k=function(){h.submit();return false};b=new AJS.ConfluenceDialog({height:350,width:512,onSubmit:k,id:"import-calendar-dialog"});b.addHeader("Import calendar");b.addPanel("",Confluence.TeamCalendars.Templates.importSubcalendar(),"calendar-dialog-panel");h=a("form.sub-calendar-import-form",b.getCurrentPanel().body);b.addButton("Import",k,"submit");b.addLink("Cancel",function(){b.remove();return false});var j=b.getCurrentPanel().body;var f=a(".sub-calendar-import-form",j);a("input[name='spaceKeyAutocomplete']",f).bind("selected.autocomplete-content",function(n,m){a("input[name='spaceKey']",f).val(m.content.key);a(this).val(m.content.name)});a(".subcalendar-cancel",f).click(function(){b.remove();return false});var l=a(".loading-icon",f);var g=b.popup.element.find(".submit");var i=a(".subcalendar-import-result",f).load(function(){if(a(this).data("activated")){var p=this.contentWindow||this.contentDocument;p=p.document?p.document:p;var n=AJS.$(p).find(".subcalendar-id").text();if(a(".import-timezone-required",p).length){g.attr("disabled","disabled").addClass("ui-state-disabled");a(".tc-need-timezone").show();a(".tc-field-group-timezone").show();Confluence.TeamCalendars.populateTimeZoneDropDown(a(".tc-field-group-timezone .timeZone"),Confluence.TeamCalendars.getUserTimeZone(),function(){g.removeAttr("disabled").removeClass("ui-state-disabled")},function(){c.showAjaxError(XMLHttpRequest,textStatus,errorThrown)});Confluence.TeamCalendars.showDialogInUpdatedHeight(b)}else{if(!a(".import-successful",p).length){var m=[];a(".field-errors input",p).each(function(){m.push({field:this.name,errorMessages:[this.value]})});if(m.length){Confluence.TeamCalendars.setFieldErrors(f,m);Confluence.TeamCalendars.showDialogInUpdatedHeight(b)}var o=[];a(".action-error",p).each(function(){o.push(a(this).text())});if(o.length){Confluence.TeamCalendars.setGenericErrors(j,o,"error-subcalendar-update")}}else{b.remove();c.handleImport(n)}}g.removeAttr("disabled").removeClass("ui-state-disabled");l.addClass("hidden");c.setSubCalendarSpinnerIconVisible(false);c.setProcessingSubCalendar(false)}});a(".back-button",f).click(function(){b.remove();Confluence.TeamCalendars.Dialogs.getAddDialog(c,{calendarDiv:calendarDiv});return false});f.submit(function(){c.setProcessingSubCalendar(true);c.setSubCalendarSpinnerIconVisible(true);l.removeClass("hidden");g.attr("disabled","disabled").addClass("ui-state-disabled");i.data("activated",true)})}return b}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/user-timezone-setup.js' */
(function(a){Confluence.TeamCalendars.Dialogs.getTimeZoneSetupDialog=function(e){var b,g,f=function(){var i=b.getCurrentPanel().body,h=a("#userTimeZoneSetupSelect",i),j=a(".field-group-timezone .spinner",i),k=a(".set-timezone-button",i);k.disable();c.addClass("loading");a.ajax({type:"GET",url:Confluence.TeamCalendars.getRestBaseUrl()+"/timezones/user",success:function(l){h.html(Confluence.TeamCalendars.Templates.timeZoneDropDown(l)).val(Confluence.TeamCalendars.getUserTimeZone()).removeAttr("disabled");c.removeClass("loading");k.enable()},error:function(l,n,m){e.showAjaxError(l,n,m);c.removeClass("loading")},timeout:Confluence.TeamCalendars.ajaxTimeout})};b=new AJS.Dialog({width:512,height:Confluence.TeamCalendars.isPDLEnabled()?220:200,id:"team-calendars-timezone-setup-dialog"});b.addHeader("Setup Team Calendars");b.addPanel("",Confluence.TeamCalendars.Templates.userTimezoneSetup(),"setup-calendar-panel");g=b.getCurrentPanel().body;var d=a(".user-time-zone-desc",g).text(AJS.format("Your time zone is currently set to {0}. If that is not your time zone, please select the right one.",Confluence.TeamCalendars.getUserTimeZone()));var c=a(".user-time-zone-select",g);a("select",c.removeClass("hidden")).change(function(){c.addClass("loading");var i=a(".set-timezone-button").attr("disabled","disabled");var h=a("option:selected",this);a.ajax({cache:false,data:{timeZoneId:h.val()},error:function(j,l,k){e.showAjaxError(j,l,k,"error-config-update");i.removeAttr("disabled");c.removeClass("loading")},success:function(){e.setGenericErrors(null,"error-config-update");e.setParameter("userTimeZoneId",h.val());d.text(AJS.format("Your time zone is currently set to {0}. If that is not your time zone, please select the right one.",Confluence.TeamCalendars.getUserTimeZone()));i.removeAttr("disabled");c.removeClass("loading")},type:"PUT",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/preferences/timezone.json")})});b.addButton("OK",function(){b.hide();b.remove();e.showCalendarWizard()},"set-timezone-button");f();e.suppressMessage("MESSAGE_KEY_TIMEZONE_SETUP");return b}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/remove-jira-events-dialog.js' */
(function(a){Confluence.TeamCalendars.getRemoveJiraEventsDialog=function(f,e,c){var b;b=new AJS.Dialog(400,250);b.addHeader("Remove JIRA events?");b.addPanel("",Confluence.TeamCalendars.Templates.confirmRemoveJiraEvents({childName:c.name,parentName:f.getSubCalendar(e,c.parentId).name}),"remove-jira-events-confirmation-panel");b.addButton("Remove",function(){d();b.remove()});b.addCancel("Cancel",function(){b.remove()});b.show();function d(){f.setSubCalendarSpinnerIconVisible(e,true);f.setProcessingSubCalendar(e,true);f._deleteSubCalendarInternal(e,c.subscriptionId||c.id,function(g,i,h){f.showAjaxError(e,g,i,h,f.ERROR_CLASS_SUB_CALENDAR_DELETE);f.setSubCalendarSpinnerIconVisible(e,false);f.setProcessingSubCalendar(e,false)},function(g){f.removeSubCalendarEventSource(e,c.id);f.setSubCalendars(e,g.payload);f.updateAvailableSubCalendarsInSubCalendarPanel(e);f.setSubCalendarSpinnerIconVisible(e,false);f.setProcessingSubCalendar(e,false)})}}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/event-edit/event-field-handlers.js' */
(function(b){function a(e,c){var d=e instanceof b?e:b(e);d.datepicker(c)}Confluence.TeamCalendars.FieldHandler={text:function(h,c,e,g,f,d){return{add:function(){c.append(Confluence.TeamCalendars.Templates.Fields.text({id:h.id,label:h.label,required:h.required,readOnly:h.readOnly}))},init:function(){b("#"+h.id+"-text",c).val(e[h.property]||"").keydown(function(){var j=b(this),i=j.val();if(!j.data("valueChangedByUser")){setTimeout(function(){if(i!==j.val()){j.data("valueChangedByUser",true)}},300)}})},setData:function(i){d.getField(c,h.id).val(i)},getData:function(){var i={};i[h.id]=d.getField(c,h.id).val();return i},getElementId:function(){return"#field-text-"+h.id}}},textarea:function(h,c,e,g,f,d){return{add:function(){c.append(Confluence.TeamCalendars.Templates.Fields.textarea({id:h.id,size:h.size,required:h.required,label:h.label,readOnly:h.readOnly}))},init:function(){b("#"+h.id+"-textarea",c).val(e[h.property]||"")},getData:function(){var i={};i[h.id]=b("textarea[name="+h.id+"]",c).val();return i},getElementId:function(){return"#field-textarea-"+h.id}}},page:function(h,c,e,g,f,d){return{add:function(){c.append(Confluence.TeamCalendars.Templates.Fields.page({id:h.id,label:h.label,required:h.required,readOnly:h.readOnly}))},init:function(){b("#"+h.id+"-text",c).val(e[h.property]||"");g.makeAutoCompleteSearch(f,b("input[name='"+h.id+"']",c),{type:["page","blogpost"]},b("."+h.id+"-suggestions",c),function(j,i){j.val(i.attr("href"))})},getData:function(){var j={},i=d.getField(c,h.id);j[h.id]=i.hasClass("with-hint")?"":i.val();return j},getElementId:function(){return"#field-page-"+h.id}}},when:function(h,c,e,g,f,d){return{add:function(){var k,l,i,j;c.append(Confluence.TeamCalendars.Templates.Fields.when({id:h.id,disableStartDateTime:h.disableStartDateTime,disableEndDateTime:h.disableEndDateTime,disableAllDay:h.disableAllDay}));k=d.getField(c,"startTime");l=d.getField(c,"endTime");i=d.getField(c,"allDayEvent");j=g.getParameter(f,"timeSuggestion");k.autocompleteTC({source:j,minLength:2});l.autocompleteTC({source:j,minLength:2});i.click(function(){if(this.checked){k.addClass("hidden");l.addClass("hidden")}else{k.removeClass("hidden");l.removeClass("hidden");if(!k.val()){k.val(g.getDefaultStartTime(f))}if(!l.val()){l.val(g.getDefaultEndTime(f))}}})},init:function(){b(".start, .end",c).each(function(){var m=b(this);a(m,{dateFormat:"ddmmyy",dayNames:g.getDayNames(),dayNamesMin:g.getDayNamesShort(),dayNamesShort:g.getDayNamesShort(),firstDay:g.getParameter(f,"firstDayOfWeek"),monthNames:g.getMonthNames(),monthNamesShort:g.getMonthNamesShort(),beforeShow:function(){b("#ui-datepicker-div").addClass("tc-datepicker")},onClose:function(){b("#ui-datepicker-div").removeClass("tc-datepicker")},onSelect:function(r){var p=b.datepicker.parseDate("ddmmyy",r);if(m.hasClass("start")){var o=b(".end",c),q=new Date(parseInt(m.data("date"))),n=new Date(o.data("date")-(q.getTime()-p.getTime()));o.datepicker("option","defaultDate",n);o.datepicker("setDate",n);o.data("date",n.getTime()).val(function(){g.formatDate(f,n,"date",function(s){o.val(s)});return "Formatting..."})}m.datepicker("option","defaultDate",p);m.datepicker("setDate",p);m.data("date",p.getTime()).val(function(){g.formatDate(f,p,"date",function(s){m.val(s)});return "Formatting..."})},showAnim:""})});var k=d.getField(c,"startTime"),l=d.getField(c,"endTime"),i=d.getField(c,"allDayEvent"),j=function(n,m,p){var o=b("input[name="+n+"]",c);o.datepicker("option","defaultDate",m);o.datepicker("setDate",m);o.data("date",m.getTime()).val(p||function(){g.formatDate(f,m,"date",function(q){o.val(q)});return "Formatting..."})};e.start&&j("startDate",e.start,e.localizedStartDate);j("endDate",e.end||e.start,e.localizedEndDate);if(e.allDay){k.val("").addClass("hidden");l.val("").addClass("hidden");i.attr("checked","checked")}else{k.val(Confluence.TeamCalendars.convertTimeAMTo24hour(e.localizedStartTime)||function(){g.formatDate(f,e.start,"time",function(m){k.val(m)});return "Formatting..."}).removeClass("hidden");l.val(Confluence.TeamCalendars.convertTimeAMTo24hour(e.localizedEndTime)||function(){g.formatDate(f,e.end||new Date(e.start.getTime()+3600000),"time",function(m){l.val(m)});return "Formatting..."}).removeClass("hidden");i.removeAttr("checked","checked")}},getData:function(){return{startDate:d.getField(c,"startDate").val(),startTime:d.getField(c,"startTime").val(),endDate:d.getField(c,"endDate").val(),endTime:d.getField(c,"endTime").val(),allDayEvent:d.getField(c,"allDayEvent").is(":checked")}},getElementId:function(){return"#field-when"}}},repeats:function(h,c,e,g,f,d){return{add:function(){var l,o,n,j,i,k,m;c.append(Confluence.TeamCalendars.Templates.Fields.repeats({id:h.id}));l=b("select[name='calendar']",c);o=b("select[name='freq-select']",c);n=b("input[name='interval']",c);j=b(".recur-ends",c);i=b(".recur-ends-never",j);k=b(".recur-ends-until",j);m=b("input[name='until']",j);b("input[name='editthisinstanceonly']",c).click(function(){if(b(this).is(":checked")){d.disableCalSelect();l.attr("disabled","disabled");o.attr("disabled","disabled");n.attr("readonly","readonly");i.attr("disabled","disabled");k.attr("disabled","disabled");m.attr("readonly","readonly").datepicker("disable")}else{d.enableCalSelect();o.removeAttr("disabled");n.removeAttr("readonly");if(b("option:selected",o).val()){i.removeAttr("disabled");k.removeAttr("disabled");if(k.is(":checked")){m.removeAttr("readonly").datepicker("enable")}else{m.datepicker("disable")}}}});o.change(function(){var s=b("option:selected",this).val();var p=b("input[name='freq']",c);var q=b("input[name='byday']",c);var r=b(".interval-container",c);if(s){if(s==="WEEKLY-BYDAY"){n.attr("readonly","readonly").val("1");r.addClass("hidden");p.val("WEEKLY");q.val("MO,TU,WE,TH,FR")}else{n.removeAttr("readonly").val("1");r.removeClass("hidden");p.val(s);q.val("")}j.removeClass("hidden");i.removeAttr("disabled");if(k.removeAttr("disabled").is(":checked")){m.removeAttr("disabled").removeAttr("readonly")}}else{n.val("1");r.addClass("hidden");j.addClass("hidden");i.attr("disabled","disabled");k.attr("disabled","disabled");m.val("").attr("disabled","disabled").attr("readonly","readonly");p.val("");q.val("")}n.trigger("keydown")});n.keydown(function(){setTimeout(function(){var r=b("option:selected",o).val();var q=b(".interval-label",c);var p=b.trim(n.val());if(/^[1-9]\d*$/.test(p)||p==="0"){if(r==="DAILY"){q.text(parseInt(p)>1?"days":"day")}else{if(r==="WEEKLY"){q.text(parseInt(p)>1?"weeks":"week")}else{if(r==="MONTHLY"){q.text(parseInt(p)>1?"months":"month")}else{if(r==="YEARLY"){q.text(parseInt(p)>1?"years":"year")}}}}}else{q.text("")}},300)});b(".recur-ends-never",c).click(function(){m.val("").attr("disabled","disabled").attr("readonly","readonly").datepicker("disable")});b(".recur-ends-until",c).click(function(){m.removeAttr("disabled","disabled").removeAttr("readonly").datepicker("enable")})},init:function(){var i=b(".recur-ends .datepicker-field",c);a(i,{dateFormat:"ddmmyy",dayNames:g.getDayNames(),dayNamesMin:g.getDayNamesShort(),dayNamesShort:g.getDayNamesShort(),firstDay:g.getParameter(f,"firstDayOfWeek"),monthNames:g.getMonthNames(),monthNamesShort:g.getMonthNamesShort(),beforeShow:function(){b("#ui-datepicker-div").addClass("tc-datepicker")},onClose:function(){b("#ui-datepicker-div").removeClass("tc-datepicker")},onSelect:function(n){var m=b(this),l=b.datepicker.parseDate("ddmmyy",n);m.datepicker("option","defaultDate",l);m.datepicker("setDate",l);m.data("date",l.getTime()).val(function(){g.formatDate(f,l,"date",function(o){m.val(o)});return "Formatting..."})},showAnim:""});var j=function(l){return !l.id};var k=function(){d.getField(c,"recurrenceId").val(e.recurId||"");var r=d.getField(c,"freq").val("");var y=d.getField(c,"byday").val("");var p=d.getField(c,"interval").val("1").attr("readonly","readonly");var s=p.closest(".interval-container");var u=d.getSelect(c,"freq-select");b("option",u.attr("disabled","disabled")).removeAttr("selected");var v=d.getField(c,"editthisinstanceonly");var z=v.closest(".edit-this-instance-only-container");var w=b(".recur-ends",c);var x=d.getField(c,"recur-end").removeAttr("checked").attr("disabled","disabled");var q=d.getField(c,"until").attr("disabled","disabled").attr("readonly","readonly").val("");q.datepicker("disable");if(!j(e)&&e.recur){d.disableCalSelect();z.removeClass("hidden");v.attr("checked","checked");var m=e.recur.freq;var t=e.recur.byDay;var n=e.recur.interval;w.removeClass("hidden");r.val(m||"");y.val(t||"");if(t){b("option[value='WEEKLY-BYDAY']",u).attr("selected","selected");s.addClass("hidden")}else{b("option[value='"+m+"']",u).attr("selected","selected");s.removeClass("hidden");p.val(n||"1")}var l=e.recur.until;if(l){b(x[1]).attr("checked","checked");q.removeAttr("disabled");var o=b.fullCalendar.parseDate(l);q.datepicker("setDate",o);q.datepicker("option","defaultDate",o);q.val(e.recur.localizedUntil||function(){g.formatDate(f,o,"date",function(A){q.val(A)});return "Formatting..."})}else{b(x[0]).attr("checked","checked")}}else{if(j(e)&&e.recur){u.removeAttr("disabled");u.val(e.recur.freq).change();b(x[0]).attr("checked","checked")}else{d.enableCalSelect();z.addClass("hidden");b("option:first",u.removeAttr("disabled")).attr("selected","selected");s.addClass("hidden");w.addClass("hidden");b(x[0]).attr("checked","checked")}}};k()},getData:function(){var i=d.getField(c,"until");return{freq:d.getField(c,"freq").val(),byday:d.getField(c,"byday").val(),interval:d.getField(c,"interval").val()||"",until:i.val(),repeatEnds:!(i.attr("readonly")||i.attr("disabled")),recurrenceId:d.getField(c,"recurrenceId").val(),editAllInRecurrenceSeries:!d.getField(c,"editthisinstanceonly").is(":checked")}},getElementId:function(){return"#field-repeats"}}},user:function(h,c,e,g,f,d){return{add:function(){c.append(Confluence.TeamCalendars.Templates.Fields.user({id:h.id,label:h.label,required:h.required}));Confluence.runBinderComponents()},init:function(){var k=b(".invitees",c),j=function(){b(this).closest("li").remove();if(!b("li",k).length){k.addClass("hidden")}},i=function(){b(".invitee-left",k).filter(function(){return !b(this).attr("threedots")}).ThreeDots({max_rows:1,text_span_class:"invitee-name-display",whole_word:false})};b("#"+h.id+"-user-picker",c).bind("selected.autocomplete-user",function(p,n){var m=n.content.userKey||n.content.username,l,q=b(".invitee",k).filter(function(){return b(this).data("entity").id===m}).length>0;if(!q){if(b("li",k).length==3){k.addClass("boxed")}l=b(Confluence.TeamCalendars.Templates.Fields.userSelection({fullName:n.content.title,userName:n.content.username,imgPath:n.content.thumbnailLink.href}));l.data("entity",{id:m,displayName:n.content.title}).find(".delete-invitee").click(j);k.prepend(l).removeClass("hidden");i()}b(this).val("").focus();var o=b(".who-error",c);if(o.children().length){o.empty()}});if(e.invitees&&e.invitees.length){b.each(e.invitees,function(m,l){k.append(b(Confluence.TeamCalendars.Templates.Fields.userSelection({fullName:l.displayName,userName:l.name,imgPath:l.avatarIconUrl})).data("entity",{id:l.id,displayName:l.displayName}))});b(".delete-invitee",k.removeClass("hidden")).unbind("click").click(j);i()}},getData:function(){var i={};var j=b(".invitee",c);if(j.length){i.person=b.map(j,function(k){return b(k).data("entity").id})}if(h.setTitle){i.what=j.length?b.map(j,function(k){return b(k).data("entity").displayName}).join(", "):""}return i},getElementId:function(){return"#field-user-"+h.id}}},getEventField:function(k,h,c,m,l,e,g){var i=Confluence.TeamCalendars.FieldHandler[k.type](k,h,c,m,l,e);var f=b(i.getElementId(),h);if(f.length){if(k.required){var j=f.find("label:first span.icon-required");if(j.length===0){f.find("label:first").append(b("<span/>",{"class":"aui-icon icon icon-required"}))}}else{f.find("label:first span.icon-required").remove()}h.append(f.show());if(k.type==="repeats"&&k.defaultRecur){var d=b("select[name='freq-select']",h);d.val("YEARLY").change()}}else{i.add();i.init()}if(k.copyto&&g!=undefined){i.setData(g)}return i}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/event-edit/jira-event-field-handler.js' */
(function(f){function b(h){return f(".tc-jira-server",h)}function e(h,j,i){f.ajax({cache:false,dataType:"json",error:function(k,m,l){h(k,m,l)},success:function(k){j(k)},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.getBaseUrl()+"/rest/calendar-services/1.0/jira/"+encodeURIComponent(i)+"/query/options.json"})}function d(j,i,h){if(h.eventType=="jira-calendar"||h.eventType=="jira-agile-sprint-calendar"||h.eventType=="jira-project-releases-calendar"){return j.getSubCalendar(i,h.subCalendarId)}return null}function a(l,i,k,n,m){var j=f.parseJSON(l.responseText);var h=f(".oauth-error",i).empty().removeClass("hidden");k.disableOkButton({buttonText:"OK"});f(document.createElement("div")).addClass("oauth-approve aui-message hint").html(AJS.format("\u003ca href=\"#\" class=\"approve-dance\">{0}\u003c\/a> to see list of projects",f(document.createElement("span")).text("Login & Approve").html())).appendTo(h).find(".approve-dance").click(function(){AppLinks.authenticateRemoteCredentials(j.oAuthUrl,function(){n.removeClass("hidden");h.addClass("hidden");k.enableOkButton();m()},function(){alert("Approval unsuccessful. Could you please try again?")});return false})}Confluence.TeamCalendars.FieldHandler["jira-hidden-fields"]=function(m,h,j,l,k,i){return{add:function(){h.append(Confluence.TeamCalendars.Templates.hiddenJiraFields())},init:function(){var o=d(l,k,j),n=l.getRenderedMacroCallbackHandler(k),p=Confluence.TeamCalendars.getEditCalendarDialogHelper(h,o,n);if(!o||!o.id){p.setSubCalendarIdField("");p.setNameField("");p.setColorField("");p.setSpaceToDefault()}else{p.setSubCalendarIdField(o.id);p.setNameField(o.name);p.setColorField(o.color);p.setSpaceKeyField(o.spaceKey)}},getData:function(){}}};Confluence.TeamCalendars.FieldHandler["jira-server-select"]=function(m,h,j,l,k,i){return{add:function(){h.append(Confluence.TeamCalendars.Templates.Fields.serverSelector());b(h).disable()},init:function(){var o=b(h),p=f(".field-group-jira-server .spinner");function n(r){var q=d(l,k,j);f.each(r.jiraLinks,function(s,t){var u=f("<option/>",{value:t.id,text:t.name,"data-display-url":t.displayUrl});if(r.jiraLinks.length===1){u.prop("selected",true);var v=o.parent();v.children().hide();v.css("min-height",0);f(".oauth-error",v).show()}u.appendTo(o)});if(r.jiraLinks.length>1){f(".field-group-jira-server",h).removeClass("hidden")}if(q&&q.applicationId){o.val(q.applicationId)}}o.change(function(){AJS.trigger("server-select-change.teamcalendars",h)});f.ajax({cache:false,error:function(q,s,r){l.showAjaxError(h.parent().parent(),q,s,r)},success:function(q){n(q);AJS.trigger("server-select-ready.teamcalendars",h)},complete:function(){o.enable();p.hide()},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/jiraLinks")})},getData:function(){}}};Confluence.TeamCalendars.FieldHandler["jira-project-select"]=function(m,h,j,l,k,i){return{add:function(){h.append(Confluence.TeamCalendars.Templates.Fields.projectSelector());f(".tc-jira-project",h).disable()},init:function(){function o(s){var r=f(".tc-jira-project",h),t=f(".field-group-jira-project .spinner"),q=i.getSelectedEventType(),p=function(){var w=f("input[name='name']",h),u=d(l,k,j),v=function(x){if(!w.data("valueChangedByUser")){return x}return w.val()};if(!u){if(q==="jira-agile-sprint-calendar"){w.val(v(AJS.format("{0} - Sprints",f("option:selected",r).text())))}else{if(q==="jira-project-releases-calendar"){w.val(v(AJS.format("{0} - Releases",f("option:selected",r).text())))}}}};r.change(p).disable();t.show();e(function(u,w,v){t.hide();if(Confluence.TeamCalendars.isRequireOauth(u)){r.empty();a(u,h,i,r,function(){o(s)})}else{r.enable();l.showAjaxError(h.parent().parent(),u,w,v)}},function(u){var w=u.projects,x=r.empty(),v=d(l,k,j);t.hide();r.enable();f.each(w,function(y,z){f(document.createElement("option")).val(z.key).text(z.name).appendTo(x)});if(v){x.val(v.projectKey)}else{p()}},s)}function n(p){if(p.id===h[0].id){f(".oauth-approve",h).remove();o(b(h).val())}}AJS.bind("server-select-ready.teamcalendars",function(q,p){n(p)});AJS.bind("server-select-change.teamcalendars",function(q,p){n(p)})},getData:function(){}}};Confluence.TeamCalendars.FieldHandler["jira-dates"]=function(m,h,j,l,k,i){return{add:function(){h.append(Confluence.TeamCalendars.Templates.editJiraCalendar())},init:function(){var t=d(l,k,j),q=l.getRenderedMacroCallbackHandler(k),u=f("select[name='project']",h),v=function(){if(!t){var w=f("input[name='name']",h);w.val(function(){if(!w.data("valueChangedByUser")){return AJS.format("{0} - Issues",f("option:selected",u).text())}return w.val()})}};u.change(v);var r=function(x){var w=f(".field-group-jira-show",h);if(x){w.css("display","none")}else{w.css("display","block")}};var s=function(){var C=f(".form-mode",h),x=b(h),w=f(".jira-query-options .option-project",h),A=f("select[name='project']",w),z=f(".timeZoneIdDisplay",h),y=Confluence.TeamCalendars.getEditCalendarDialogHelper(h,t,q);Confluence.TeamCalendars.setFieldErrors(h,null);f("input[name='searchFilterName']",h).addClass("with-hint").val("Search filter");f("textarea[name='jql']",h).addClass("with-hint").val("JQL query");if(!t||!t.id){y.setFormModeCreate();y.setSubCalendarIdField("");y.setNameField("");y.setDescriptionField("");y.setColorField("");y.setSpaceToDefault();y.setTimeZoneIdDisplayField("");z.hide();p(null,function(){n(function(){v()})})}else{y.setFormModeEdit();y.setSubCalendarIdField(t.id);y.setNameField(t.name);y.setDescriptionField(t.description);y.setColorField(t.color);y.setSpaceKeyField(t.spaceKey);y.setSpaceKeyAutocompleteField(t.spaceName);p(null,function(){var G=f(".jira-query-options",h),F="option-project-selected option-search-filter-selected option-jql-selected",E;f(".matrix input.radio",G).removeAttr("checked");if(t.projectKey){var I=false;f("option",A).removeAttr("selected").each(function(){var J=f(this);if(J.val()===t.projectKey){J.attr("selected","selected");I=true;return false}});if(!I){A.append(f(document.createElement("option")).val(t.projectKey).text(t.projectName||t.projectKey).attr("selected","selected"))}f(".radio-project input.radio",G.removeClass(F).addClass("option-project-selected")).attr("checked","checked");E=w.data("hiddenDateFields")}else{if(t.searchFilterId){var D=f(".option-search-filter",G);f("input[name='searchFilter']",D).val(t.searchFilterId);f("input[name='searchFilterName']",D).removeClass("with-hint").val(t.searchFilterName||t.searchFilterId);f(".radio-search-filter input.radio",G.removeClass(F).addClass("option-search-filter-selected")).attr("checked","checked");E=D.data("hideDateFields")}else{if(t.jql){var H=f(".option-jql",G);f("textarea[name='jql']",H).removeClass("with-hint").val(t.jql);f(".radio-jql input.radio",G.removeClass(F).addClass("option-jql-selected")).attr("checked","checked")}}}n(function(){var K=f(".field-group-jira-show .single-dates .date-fields div.checkbox",h),J={},L=t.dateFieldNames||[];f(".date-fields input",h).removeAttr("checked");K.each(function(){var N=f("input",this),M=N.val();if(f.inArray(M,L)!==-1){N.attr("checked","checked")}J[M]=f("label",this).text()});f.each(t.durations||[],function(M,S){var N=J[S.startDateFieldName||""],R=J[S.endDateFieldName||""];if(N&&R){var Q=f(".field-group-jira-show .duration .date-fields",h),P=S.startDateFieldName+"/"+S.endDateFieldName,O="duration-"+P;f("<div/>",{"class":"checkbox"}).append(f("<input/>",{id:O,name:"dateFieldName",type:"checkbox",value:P,checked:"checked"})).append(f("<label/>",{"for":O,html:AJS.format("Start: {0}",f("<span/>",{text:N}).html())+"<br>"+AJS.format("End: {0}",f("<span/>",{text:R}).html())})).appendTo(Q);Q.parent().addClass("has-selected-duration")}});if(E){r(E)}})});z.text(t.timeZoneId)}var B=f("input[name='name'], input[name='description'], input[name='spaceKeyAutocomplete'], input[name='searchFilterName'], textarea[name='jql']",h);if(q.isCalendarInEditMode()){B.removeAttr("readonly");x.removeAttr("disabled");A.removeAttr("disabled")}else{C.removeClass().addClass("form-mode read-only");B.attr("readonly","readonly");x.attr("disabled","disabled");A.attr("disabled","disabled")}};var o=function(){f("select[name='server']",h).change(function(){var y=f("select[name='server'] option:selected",h);if(y.length&&y.val()){p(null,function(){n()})}});f("input[name='spaceKeyAutocomplete']",h).bind("selected.autocomplete-content",function(z,y){f("input[name='spaceKey']",h).val(y.content.key);f(this).val(y.content.name);f(".spaceKeyAutocomplete-error",h).empty()});f(".jira-query-options .query-group input.radio",h).change(function(){var A=f(this).val(),z=f(".jira-query-options",h).removeClass("option-project-selected option-search-filter-selected option-jql-selected").addClass(A+"-selected"),y=f("."+A,z);f("input",y).focus(function(){var B=f(this);if(B.hasClass("with-hint")){B.removeClass("with-hint").val("")}});if("option-jql"===A){f("textarea",y).trigger("keydown",[true])}n(function(){r(y.data("hideDateFields")||!f(".option-value",y).val());var B=f(".duration",h);if(f(".date-fields",B).children().length){B.addClass("has-selected-duration")}else{B.removeClass("has-selected-duration")}})});var x=f(".option-search-filter",h);var w=f(".search-filter-suggestions",x);f("input[name='searchFilterName']",x).keydown(function(){var y=f(this);var z=y.val();setTimeout(function(){var B=y.val();if(!B||B!==z){w.empty()}if(B!==z){B=B.toLowerCase();var D=f.grep(y.data("searchFilters")||[],function(E){return E.name.toLowerCase().indexOf(B)!==-1});if(D.length){var A=f(document.createElement("div")).addClass("dropdown-container").append(f(document.createElement("div")).addClass("aui-dd-parent").append(f(document.createElement("a")).addClass("aui-dd-trigger").attr("href","#").text("Show autocomplete")).append(f(document.createElement("ul")).addClass("aui-dropdown")));var C=f(".aui-dropdown",A).appendTo(f(".aui-dd-parent",A));f.each(D,function(F,E){var G=f(document.createElement("li")).append(f(document.createElement("a")).attr("href","#").text(E.name)).data("searchFilter",E).appendTo(C).click(function(){y.val(E.name);f("input[name='searchFilter']",x).val(E.id);f(".error",x).empty();n()});if(E.description){G.attr("title",E.description)}});A.appendTo(w).dropDown("Standard",{alignment:"left"});w.removeClass("hidden")}}},300)});f("select[name='project']",h).change(function(){n()});f(".jira-query-options input[name='searchFilterName']",h).keydown(function(z){var C=z.keyCode;var y=f(this);if(!(C===38||C===40||C===13)){setTimeout(function(){h.click();var E=y.val().toLowerCase();if(E){var D=y.data("searchFilters");if(D&&f.isArray(D)){var F=f(".search-filter-suggestions .aui-dropdown li",h).each(function(){var G=f(this);if(G.data("searchFilter").name.toLowerCase().indexOf(E)===-1){G.addClass("hidden")}else{G.removeClass("hidden")}});if(F.filter(function(){return !f(this).hasClass("hidden")}).length){f(".search-filter-suggestions .aui-dd-trigger",h).trigger("click")}}}},300)}else{if(C===13){z.preventDefault();var B=f(".search-filter-suggestions .aui-dropdown li.active",h);if(B.length){var A=B.data("searchFilter");y.val(A.name);f("input[name='searchFilter']",h).val(A.id);f(".option-search-filter .error",h).empty();h.click();n()}}}});f(".add-duration",h).unbind().click(function(){AJS.log("Open Jira Duration Dialog");var A=new AJS.Dialog({height:423,width:520,id:"add-jira-duration-dialog"});A.addHeader("Add duration between issue dates");A.addPanel("",Confluence.TeamCalendars.Templates.editJiraSubCalendarDurations(),"calendar-dialog-panel");var F=A.getCurrentPanel().body,E=f(".field-group-jira-show .duration .date-fields",h),C=f(".field-group-jira-show .single-dates .date-fields",h);A.addSubmit("Add",function(){var J=f(".duration-start select option:selected",F),H=f(".duration-end select option:selected",F),I=J.val()+"/"+H.val(),L=f("div.checkbox",E).filter(function(){return f("input",this).val()==I});if(L.length){f("input",L).attr("checked","checked")}else{var K="duration-"+I;f("<div/>",{"class":"checkbox"}).append(f("<input/>",{id:K,type:"checkbox",name:"dateFieldName",value:I,checked:"checked"})).append(f("<label/>",{"for":K,html:AJS.format("Start: {0}",J.html())+"<br>"+AJS.format("End: {0}",H.html())})).prependTo(E);E.parent().addClass("has-selected-duration")}A.remove();i.show()});A.addCancel("Cancel",function(){A.remove();i.show()});var z=f.map(f("div.checkbox",C).filter(function(){return f(this).data("mappableAsDuration")}),function(H){return f("<option/>",{value:f("input",H).val(),text:f("label",H).text()})}),B=f(".duration-start select",F),G=f(".duration-end select",F),y=function(I,H){if(H&&I&&H!==I){i.enableOkButton()}else{i.disableOkButton()}};f.each(z,function(I,H){f(H).appendTo(B).clone().appendTo(G)});if(!z.length){f(".duration-fields",F).addClass("hidden");f(".add-fields",f(".no-selectable-date-fields",F).removeClass("hidden")).html(AJS.format("If you are a JIRA administrator, you \u003ca href=\"{0}\/secure\/admin\/ViewCustomFields.jspa\" target=\"_blank\">can create custom date fields\u003c\/a> and they will appear as options for issue start and end dates.",f(".field-group-jira-server select option:checked",h).data("display-url")))}var D=function(H,J){var I=f("option:selected",J).val();f("option",J).filter(function(){return f(this).val()}).remove();f.each(z,function(L,K){if(K.val()!==H){K.clone().appendTo(J)}});f("option",J).removeAttr("selected").filter(function(){return f(this).val()===I}).attr("selected","selected")};B.change(function(){var H=f("option:selected",this).val();D(H,G);y(H,f("option:selected",G).val())});G.change(function(){var H=f("option:selected",this).val();D(H,B);y(H,f("option:selected",B).val())});i.hide();A.show();return false});f(".subcalendar-cancel",h).click(function(){i.remove();return false});return h};var p=function(A,E){var B=f(".jira-query-options",h);var D=f(".query-group input.radio",B).attr("disabled","disabled").removeAttr("checked","checked");var w=f(".field-group .project-select-label",B);var z=f(".query-group",B);var G=f(".compatibility-group, .field-group-jira-show",B);var y=f(".form-mode",h).addClass("jira-query-options-loading");var x=b(h).val();var C=function(H,J,I){y.removeClass("jira-query-options-loading");z.addClass("hidden");w.removeClass("hidden");G.addClass("hidden");if(Confluence.TeamCalendars.isRequireOauth(H)){a(H,h,i,G,s)}else{if(A&&f.isFunction(A)){A(H,J,I)}}};var F=function(J){G.removeClass("hidden");y.removeClass("jira-query-options-loading");D.removeAttr("disabled","disabled");if(!J.searchRequests){f(".radio-search-filer input",h).attr("disabled","disabled")}if(!B.hasClass("option-project-selected")){B.removeClass("option-search-filter-selected option-jql-selected").addClass("option-project-selected")}f(".radio-project input",B).attr("checked","checked");if(J.jqlNotSupported){z.addClass("hidden");w.removeClass("hidden")}else{w.addClass("hidden");z.removeClass("hidden");var P=new Date().getTime();var I="jql-"+P;f("textarea[name='jql']",B).before(f(document.createElement("textarea")).attr({autocomplete:"off",cols:"20",id:I,name:"jql",rows:1,wrap:"off"}).addClass("textarea with-hint").focus(function(){var T=f(this);if(T.hasClass("with-hint")){T.removeClass("with-hint").val("")}}).val("JQL query")).remove();var Q=/.+\/jql\/autocomplete.json\?fieldName=[^&]+&fieldValue=.*/;var S=f(".jqlAutoCompleteSpinner",B);B.ajaxSend(function(V,U,T){if(Q.test(T.url||"")){S.removeClass("hidden")}}).ajaxComplete(function(V,U,T){if(Q.test(T.url||"")){S.addClass("hidden")}});f(".option-jql label",B).attr("for",I);var M="jql-error-"+P;f(".jql-error",B).before(f(document.createElement("div")).addClass("error jql-error").attr("id",M)).remove();f(".dropdown-ready",B).remove();JIRA.JQLAutoComplete({fieldID:I,parser:JIRA.JQLAutoComplete.MyParser(f.parseJSON(J.jqlReservedKeywordsJson||"[]")),queryDelay:0.65,jqlFieldNames:f.parseJSON(J.visibleFieldNamesJson||"[]"),jqlFunctionNames:f.parseJSON(J.visibleFunctionNamesJson||"[]"),minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:false,errorID:M,jiraApplicationId:b().val(),baseUrl:Confluence.getBaseUrl()});f("textarea[name='jql']",h).keydown(function(V,U){var W=f(this);var T=W.val();if(U||V.keyCode!==27){setTimeout(function(){var Y=W.val();var Z=f(".jql-error",h);if(Y&&!W.hasClass("with-hint")&&(U||Y!==T)){f.ajax({cache:false,data:{jql:Y},error:function(){Z.empty().text("Unable to validate JQL against selected JIRA instance.")},success:function(ad){var ac=f(".jql-ok",h),ab=f(".jql-bad",h),aa=f(".duration",h);if(ad.valid){ac.removeClass("hidden");ab.addClass("hidden");n(function(){aa.addClass("can-add-duration");if(f(".date-fields div.checkbox",aa).length){aa.addClass("has-selected-duration")}else{aa.removeClass("has-selected-duration")}});W.focus()}else{ac.addClass("hidden");ab.removeClass("hidden");f(".date-fields",h).empty();r(true);aa.removeClass("can-add-duration")}},type:"POST",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.getBaseUrl()+"/rest/calendar-services/1.0/jira/"+encodeURIComponent(b(h).val())+"/jql/validate.json"})}},300)}else{var X=f(".option-jql .suggestions",B);if(X.is(":visible")){X.hide();return false}}})}var R=J.searchRequests;var L=f(".option-search-filter",h);var H=f("input[name='searchFilterName']",L).removeData("searchFilters");if(R&&f.isArray(R)&&R.length){H.data("searchFilters",R);f(".option-content",L.removeData("hideDateFields")).removeClass("disabled")}else{H.attr("disabled","disabled");f(".option-content",L.data("hideDateFields",true)).addClass("disabled")}var K=J.projects;var O=f(".option-project",h);if(K&&f.isArray(K)&&K.length){var N=f("select",O).empty();f.each(K,function(T,U){f(document.createElement("option")).val(U.key).text(U.name).appendTo(N)});f(".option-content",O.removeData("hideDateFields")).removeClass("disabled")}else{f(".option-content",O.data("hideDateFields",true)).addClass("disabled")}if(!J.dateRangeSupported){f(".duration",h).css("visibility","hidden")}else{f(".duration",h).css("visibility","visible")}i.enableOkButton();if(E&&f.isFunction(E)){E(J)}};e(C,F,x)};var n=function(y){var x=f(".field-group-jira-show div.checkbox",h).filter(function(){return f("input",this).is(":checked")}),C=f(".jira-query-options .matrix .radio:checked",h).val(),F=f(".duration",h),A={},w="";if("option-project"===C){w="/project/"+encodeURIComponent(f(".jira-query-options .option-project select option:selected",h).val())}else{if("option-search-filter"===C){var B=f(".jira-query-options .option-search-filter input[name='searchFilter']",h).val();if(B){w="/filter/"+encodeURIComponent(B)}}else{if("option-jql"==C){A.query=f(".jira-query-options .option-jql textarea",h).val()||"";if(A.query){w="/jql"}}}}F.removeClass("can-add-duration");if(w){var D=f(".date-fields-spinner-container",h).removeClass("hidden"),E=f(".single-dates .date-fields",h).empty(),z=f(".date-fields",F).empty();f.ajax({cache:false,data:A,dataType:"json",error:function(){D.addClass("hidden");f(".dateFieldName-error",h).text("Error retrieving list of date fields.")},success:function(I){D.addClass("hidden");var J=f("<div/>"),H=f.map(x,function(K){return f("input",K).val()}),G=f.map(I,function(K){return K.key});f.each(I,function(L,K){f("<div/>",{"class":"checkbox"}).append(f("<input/>",{id:"option-"+K.key,name:"dateFieldName",type:"checkbox",value:K.key,checked:f.inArray(K.key,H)!==-1})).append(f("<label/>",{"for":"option-"+K.key,text:K.name})).data("mappableAsDuration",K.customfield||K.key==="duedate"||K.key==="created"||K.key==="resolution").appendTo(J)});x.filter(function(){var L=f("input",this).val();if(L.indexOf("/")!==-1){var K=L.split("/",2);return K.length==2&&f.inArray(K[0],G)!==-1&&f.inArray(K[1],G)!==-1}return false}).appendTo(z.empty());J.appendTo(E.empty());if(J.children().length){r(false);F.addClass("can-add-duration")}else{F.removeClass("can-add-duration")}if(y&&f.isFunction(y)){y(I)}},timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.getBaseUrl()+"/rest/calendar-services/1.0/jira/"+encodeURIComponent(b(h).val())+"/date-fields"+w+".json"})}else{if(y&&f.isFunction(y)){y()}}};AJS.bind("server-select-ready.teamcalendars",function(){o();s()});AJS.bind("server-select-change.teamcalendars",function(){o();s()})},getData:function(){}}};function g(l,h,k,m,j){function i(){if(!f("input[name='subCalendarId']",h).val()){Confluence.TeamCalendars.fireEventForAnalytics("event.create.default."+l.type+".context."+k.getParameter("calendarContext"),{})}}if(k.isProcessingSubCalendar()){return false}k.setSubCalendarSpinnerIconVisible(true);i();if(k.getIncludedCalendars()){l.include=k.getIncludedCalendars()}var n=l.subCalendarId;f.ajax({cache:false,converters:{"text json":function(o){return o}},data:l,dataFilter:function(o){var p=f.parseJSON(o);if(p.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray(p.payload)}return p},dataType:"json",error:function(o,q,p){k.showAjaxUpdateError(o,q,p);k.setSubCalendarSpinnerIconVisible(false);m()},success:function(p){k.setGenericUpdateError();if(p.success){Confluence.TeamCalendars.setFieldErrors(h,null);var o=n;if(o){k.setSubCalendars(n,p.payload);k.reloadSubCalendar(n)}else{n=p.modifiedSubCalendarId;k.setSubCalendars(n,p.payload)}j();k.setSubCalendarSpinnerIconVisible(false);if(!p.modifiedSubCalendarId&&k.shouldShowFeatureDiscoveryDialog(n)){k.getSubCalendarFeatureDiscoveryDialog(n)}}else{Confluence.TeamCalendars.setFieldErrors(h,p.fieldErrors);k.setSubCalendarSpinnerIconVisible(false);m()}},type:"PUT",timeout:Confluence.TeamCalendars.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars.json")});return false}function c(h,i,k,l,j){return{type:j,parentId:k,subCalendarId:f("input[name='subCalendarId']",h).val(),name:i,description:"",color:f("input[name='color']",h).val(),spaceKey:"",location:"jira://"+encodeURIComponent(b(h).val()||"")+"?projectKey="+encodeURIComponent(f("select[name='tc-jira-project'] option:selected",h).val())+"&dateFieldName="+l}}Confluence.TeamCalendars.CustomSubmitter={JiraIssues:{submitForm:function(h,k,l,j,i,m){function n(){var s="",p=f(".field-group-jira-show .date-fields div.checkbox").filter(function(){return f("input:checked",this).length});f.each(p,function(){var u=f("input",this).val();if(u.indexOf("/")!==-1){var t=u.split("/",2);if(s){s+="&"}s+="duration="+encodeURIComponent(t[0]+"/"+t[1])}else{if(s){s+="&"}s+="dateFieldName="+encodeURIComponent(u)}});var q={type:"jira",parentId:l,subCalendarId:f("input[name='subCalendarId']",h).val(),name:k,description:"",color:f("input[name='color']",h).val(),spaceKey:""},o="jira://"+encodeURIComponent(b(h).val()||"")+"?",r=f(".jira-query-options .matrix input.radio:checked",h).val();if("option-project"===r){o+="projectKey="+encodeURIComponent(f("select[name='project'] option:selected",h).val())}else{if("option-search-filter"===r){o+="searchFilterId="+f("input[name='searchFilter']",h).val()}else{o+="jql="+encodeURIComponent(f("textarea[name='jql']",h).val())}}if(s){o+="&"+s}q.location=o;return q}g(n(),h,j,m,i)}},JiraAgileSprints:{submitForm:function(h,k,l,j,i,m){var n=c(h,k,l,"sprint","jira-agile-sprint");g(n,h,j,m,i)}},JiraProjectReleases:{submitForm:function(h,k,l,j,i,m){var n=c(h,k,l,"versiondue","jira-project-releases");g(n,h,j,m,i)}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/event-edit/event-edit-dialog.js' */
(function(d){var f,e,b,c={};var a={disableCalSelect:function(){a.getSelect("calendar").disable();a.getSelect("event-type").disable()},enableCalSelect:function(){a.getSelect("calendar").enable();a.getSelect("event-type").enable()},getField:function(g,h){return d("input[name='"+h+"']",g)},getSelect:function(g,h){return d("select[name='"+h+"']",g)},getTextArea:function(g,h){return d("textarea[name='"+h+"']",g)},show:function(){b.show()},hide:function(){b.hide()},remove:function(){b.remove()},getEditEventDialog:function(v,r,i,y){var s,p,h,B,m,w=[],C,x=Confluence.TeamCalendars.LocalStorage;if(b&&b.isVisible()){return b}if(b){b.remove();b=null;AJS.log("Warning: old event edit dialog was not destroyed before creating a new one.")}f=i;e=y;m=Confluence.TeamCalendars.EventTypes;function A(D){return D=="jira-calendar"||D=="jira-agile-sprint-calendar"||D=="jira-project-releases-calendar"}function j(E){var D=E.eventType;return D=="jira"||D=="jira-agile-sprint"||D=="jira-project-releases"}function q(D){var E={};d.each(D,function(F,G){if(G===undefined){E[F]=""}else{E[F]=G}});return E}function o(K,E){var L,D,H,I,M,G,J,F;if(f.isProcessingEvent(e)){return false}f.setProcessingEvent(e,true,s);L=a.getField(B,"originalSubCalendarId").val();D=a.getField(B,"originalStartDate").val();H=d("option:selected",a.getSelect(B,"calendar")).val();I=a.getField(B,"uid").val();J=a.getSelect(B,"event-type").val();F=m[J];M=a.getField(B,"allDayEvent").is(":checked");G=a.getField(B,"until");x.setItem("last-selected-calendar",H);x.setItem("last-selected-calendar-type",J);if(!I){e.data(f.PREF_LAST_ALL_DAY_USED,M.toString())}if(F.customHandler){F.customHandler.submitForm(K,a.getField(K,"name").val(),H,f.getRenderedMacroCallbackHandler(e),function(){b.remove();f.setProcessingEvent(e,false,s);f.updateAvailableSubCalendarsInSubCalendarPanel(e)},function(){f.setProcessingEvent(e,false,s)});return}f.updateEvent(e,(function(){var N={originalSubCalendarId:L,originalStartDate:D,subCalendarId:H,uid:I,eventType:J};d.each(E,function(O,P){d.extend(N,q(P.getData()))});return N})(),function(N,P,O){f.getCalendarPanel(e).fullCalendar("unselect");f.showAjaxError(e,N,P,O,f.ERROR_CLASS_EVENT_UPDATE);f.setProcessingEvent(e,false,s)},function(O){f.getCalendarPanel(e).fullCalendar("unselect");f.setGenericErrors(e,null,f.ERROR_CLASS_EVENT_UPDATE);if(O.success){Confluence.TeamCalendars.setFieldErrors(K,null);var P=f.getSubCalendar(e,O.subCalendar.id);if(!P){var N=f.getSubCalendar(e,O.subCalendar.parentId);P=O.subCalendar;N.childSubCalendars=d.merge([P],N.childSubCalendars||[]);f.updateAvailableSubCalendarsInSubCalendarPanel(e);f.addSubCalendarEventSource(e,P.id)}else{f.reloadSubCalendar(e,P.id)}if(L&&L!==P.id){f.reloadSubCalendar(e,L)}b.remove()}else{Confluence.TeamCalendars.setFieldErrors(K,O.fieldErrors)}f.setProcessingEvent(e,false,s)});return false}function u(E,F){var G=f.getSubCalendarsWhichCanAddEvents(e);G.sort(function(M,L){var K=M.name.toLowerCase(),J=L.name.toLowerCase();return K===J?0:(K>J?1:0)});var I=a.getSelect(E,"calendar");d.each(G,function(K,J){I.append(d("<option/>",{value:J.id,text:J.name}))});if(G.length===1){I.parent().hide()}if(F.subCalendarId){var D=f.getSubCalendar(e,F.subCalendarId);if(D){I.val(D.parentId||F.subCalendarId)}}else{var H=x.getItem("last-selected-calendar");if(H){I.val(H)}}if(j(F)){I.disable()}}function l(E){var D=d("<div/>",{"class":"tc-event-type-item"}).append(d("<span/>",{"class":E.id})).append(d("<span/>",{text:E.text}));return d("<div/>").append(D).html()}function n(E){var D=a.getSelect(E,"event-type");d.each(m,function(F,G){if(v.id||!G.hiddenFromEventCreation){D.append(d("<option/>",{value:G.id,text:G.name}))}});if(AJS.$.fn.auiSelect2){d(".event-edit #event-type").auiSelect2({formatSelection:l,formatResult:l,minimumResultsForSearch:-1});if(v.id){if(AJS.Meta.get("build-number")>=4520){d("#event-type").auiSelect2("enable",false)}else{d("#event-type").auiSelect2("disable")}}}D.change(z).val(v.eventType||x.getItem("last-selected-calendar-type")||"other").trigger("change")}function g(){a.getField(B,"uid").val(v.id||"");a.getField(B,"originalStartDate").val(v.originalStart||"");a.getField(B,"originalSubCalendarId").val(v.subCalendarId||"")}function z(E){var D=E.target.value;k(D);if(!A(D)){a.getSelect(B,"event-type").data("previous",D)}}function k(L){var H=m[L].fields,E=[],N=d("#event-fields-container"),I=A(L),K=I?d("#"+L+"-event-fields",N):d("#tc-event-fields",N),J=a.getSelect(B,"event-type").val(),F=a.getSelect(B,"event-type").data("previous"),D;d.each(d.grep(H,function(O){return O.type==="repeats"&&O.defaultRecur}),function(O,P){if(!v.id){v.recur=P.defaultRecur}});if(v&&(v.id||A(v.eventType))){a.getSelect(B,"event-type").attr("disabled","disabled")}if(!I&&F){var M=m[F].fields;d.each(d.grep(M,function(O){return O.type==="text"&&O.copyto}),function(P,O){D=a.getField(K,O.id).val()})}d(".event-fields",N).each(function(){d(this).hide()});if(K.length&&I){K.show();E=w[L]}else{if(K.length){K.show();d("#tc-event-fields >div").hide()}else{if(I){K=d("<div/>",{id:L+"-event-fields","class":"event-fields"})}else{K=d("<div/>",{id:"tc-event-fields","class":"event-fields"})}N.append(K)}d.each(H,function(O,P){if(I){E[O]=Confluence.TeamCalendars.FieldHandler[P.type](P,K,v,f,e,a);E[O].add();E[O].init()}else{E[O]=Confluence.TeamCalendars.FieldHandler.getEventField(P,K,v,f,e,a,D)}});w[L]=E}var G=function(){return c[J]!==false};if(G()){s.enableOkButton()}else{s.disableOkButton({buttonText:"OK"})}s.unbind("submit").submit(function(){o(K,E);return false})}AJS.bind("remove.dialog",function(E,D){if(D.dialog.id=="edit-event-dialog"){b=null}});p=function(){s.submit();return false};h=function(){b.remove();return false};b=new AJS.ConfluenceDialog({id:"edit-event-dialog",width:580,height:700,onSubmit:p});b.addHeader(v.title||"Create event");b.addButton("OK",p,"submit");b.addLink("Cancel",h);C=b.popup.element.find(".submit");b.addPanel("",Confluence.TeamCalendars.Templates.eventEdit(),"calendar-dialog-panel");B=b.getCurrentPanel().body;var t=function(D){c[a.getSelect(B,"event-type").val()]=D};s=d("form[name='event-edit']",B);s.disableOkButton=function(D){var E=d.extend({buttonText:"Adding..."},D);C.text(E.buttonText).attr("disabled","disabled").addClass("ui-state-disabled");t(false)};s.enableOkButton=function(D){var E=d.extend({buttonText:"OK"},D);C.removeAttr("disabled").removeClass("ui-state-disabled").text(E.buttonText);t(true)};u(B,v);n(B);g();b.disableOkButton=s.disableOkButton;b.enableOkButton=s.enableOkButton;return b},disableOkButton:function(g){b.disableOkButton(g)},enableOkButton:function(g){b.enableOkButton(g)},getSelectedEventType:function(){return this.getSelect(b.popup.element,"event-type").val()}};Confluence.TeamCalendars.Dialogs.getEditEventDialog=a.getEditEventDialog}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/event-edit/event-types.js' */
(function(b){var a={fields:[{type:"user",id:"who",label:"Who",required:true,property:"what",setTitle:true},{type:"when",id:"people"},{type:"repeats",id:"people"},{type:"text",id:"description",property:"description",label:"Summary",copyto:"what"},{type:"page",id:"url",property:"workingUrl",label:"Related page"}]};Confluence.TeamCalendars.EventTypes={travel:b.extend({},a,{id:"travel",name:"Travel"}),leaves:b.extend({},a,{id:"leaves",name:"Leave"}),birthdays:b.extend(true,{},a,{id:"birthdays",name:"Birthday",fields:[{},{},{defaultRecur:{freq:"YEARLY"}}]}),jira:{id:"jira",name:"JIRA Issue Dates",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},"jira-agile-sprint":{id:"jira-agile-sprint",name:"JIRA Agile Sprints",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},"jira-project-releases":{id:"jira-project-releases",name:"JIRA Project Releases",hiddenFromEventCreation:true,fields:[{type:"text",id:"what",property:"title",label:"What",required:true,readOnly:true},{type:"when",id:"simple",disableEndDateTime:true,disableAllDay:true},{type:"page",id:"url",property:"workingUrl",label:"Related page",readOnly:true},{type:"textarea",id:"description",property:"description",label:"Description",size:5,readOnly:true}]},other:{id:"other",name:"Event",fields:[{type:"text",id:"what",property:"title",label:"What",required:true,copyto:"description"},{type:"user",id:"who",label:"Who",property:"what"},{type:"when",id:"simple"},{type:"repeats",id:"simple"},{type:"text",id:"where",property:"where",label:"Where"},{type:"page",id:"url",property:"workingUrl",label:"Related page"},{type:"textarea",id:"description",property:"description",label:"Description",size:5}]},"jira-calendar":{id:"jira-calendar",name:"JIRA Issue Dates",customHandler:Confluence.TeamCalendars.CustomSubmitter.JiraIssues,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"text",id:"name",property:"name",required:true,label:"Name"},{type:"jira-dates",id:"jira-dates"}]},"jira-agile-sprint-calendar":{id:"jira-agile-sprint-calendar",name:"JIRA Agile Sprints",customHandler:Confluence.TeamCalendars.CustomSubmitter.JiraAgileSprints,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-hidden-fields",id:"",property:"",required:true,label:""},{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"jira-project-select",id:"project",property:"project",label:"Project",required:true},{type:"text",id:"name",property:"title",required:true,label:"Name"}]},"jira-project-releases-calendar":{id:"jira-project-releases-calendar",name:"JIRA Project Releases",customHandler:Confluence.TeamCalendars.CustomSubmitter.JiraProjectReleases,hiddenFromEventCreation:!Confluence.TeamCalendars.hasJiraLink,fields:[{type:"jira-hidden-fields",id:"",property:"",required:true,label:""},{type:"jira-server-select",id:"server",property:"server",label:"Server",required:true},{type:"jira-project-select",id:"project",property:"project",label:"Project",required:true},{type:"text",id:"name",property:"title",required:true,label:"Name"}]}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/local-storage.js' */
Confluence.TeamCalendars.LocalStorage=(function(e){var c=function(){return{getItem:function(h){e.cookie(h)},setItem:function(i,j,h){e.cookie(i,j,h)}}}();var g="team-calendars",a=Confluence.storageManager?Confluence.storageManager(g):(localStorage?localStorage:c),b=AJS.Meta.get("remote-user"),d="confluence."+b+"."+g;var f=function(h){return Confluence.storageManager?h:d+"."+h};return{getItem:function(h){return a.getItem(f(h))},setItem:function(i,j,h){a.setItem(f(i),j,h)}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/user-timezone-setup.soy' */
// This file was automatically generated from user-timezone-setup.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.userTimezoneSetup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="user-time-zone-desc"></div><div class="user-time-zone-select hidden"><select name="userTimeZoneSetupSelect" id="userTimeZoneSetupSelect" disabled="disabled"></select>&nbsp;<img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/timezone-drop-down.soy' */
// This file was automatically generated from timezone-drop-down.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.timeZoneDropDown = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var timeZoneList3 = opt_data.timeZones;
  var timeZoneListLen3 = timeZoneList3.length;
  for (var timeZoneIndex3 = 0; timeZoneIndex3 < timeZoneListLen3; timeZoneIndex3++) {
    var timeZoneData3 = timeZoneList3[timeZoneIndex3];
    output.append('<option value=', soy.$$escapeHtml(timeZoneData3.name), '>', soy.$$escapeHtml(timeZoneData3.name), ' (', soy.$$escapeHtml(timeZoneData3.offset), ')</option>');
  }
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-panel-entry.soy' */
// This file was automatically generated from subcalendar-panel-entry.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.subCalendarPanelEntry = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="subcalendar-item ', (opt_data.subCalendar.watchable && ! opt_data.hideWatchMenuItem) ? (opt_data.subCalendar.watchedViaContent) ? 'watching-via-content' : (opt_data.subCalendar.watched) ? 'watched' : 'not-watched' : '', '" data-sub-calendar-id="', soy.$$escapeHtml(opt_data.subCalendar.id), '"><div class="subcalendar-info"><div class="subcalendar-name"><span class="ellipsis_text">', soy.$$escapeHtml(opt_data.subCalendar.displayName), '</span></div></div>');
  if (opt_data.subCalendar.childSubCalendars && opt_data.subCalendar.childSubCalendars.length) {
    output.append('<ul class="child-subcalendars">');
    var childSubCalendarList21 = opt_data.subCalendar.childSubCalendars;
    var childSubCalendarListLen21 = childSubCalendarList21.length;
    for (var childSubCalendarIndex21 = 0; childSubCalendarIndex21 < childSubCalendarListLen21; childSubCalendarIndex21++) {
      var childSubCalendarData21 = childSubCalendarList21[childSubCalendarIndex21];
      output.append('<li class="child-subcalendar ', (childSubCalendarData21.subscriptionType) ? ' ' + soy.$$escapeHtml(childSubCalendarData21.subscriptionType) : soy.$$escapeHtml(childSubCalendarData21.type), '" data-sub-calendar-id="', soy.$$escapeHtml(childSubCalendarData21.id), '" data-parent-sub-calendar-id="', soy.$$escapeHtml(childSubCalendarData21.parentId), '"><div class="child-subcalendar-color ', soy.$$escapeHtml(childSubCalendarData21.color), '"/><div class="child-subcalendar-name">');
      if (childSubCalendarData21.subscriptionType) {
        Confluence.TeamCalendars.Templates.iconSubCalendarPrinting({eventType: childSubCalendarData21.subscriptionType}, output);
      } else {
        Confluence.TeamCalendars.Templates.iconSubCalendarPrinting({eventType: childSubCalendarData21.type}, output);
      }
      output.append('<span class="ellipsis_text">', soy.$$escapeHtml(childSubCalendarData21.displayName), '</span></div>');
      if (childSubCalendarData21.menuOptions.showMenu) {
        Confluence.TeamCalendars.Templates.subCalendarPopupMenu({subCalendar: opt_data.subCalendar, autoConvertSupported: opt_data.autoConvertSupported, subCalendarClasses: opt_data.subCalendarClasses, isParent: false}, output);
      }
      Confluence.TeamCalendars.Templates.subCalendarPopupMenu({subCalendar: childSubCalendarData21, autoConvertSupported: opt_data.autoConvertSupported, subCalendarClasses: opt_data.subCalendarClasses}, output);
      output.append('</li>');
    }
    output.append('</ul>');
  }
  if (opt_data.subCalendar.menuOptions.showMenu) {
    Confluence.TeamCalendars.Templates.subCalendarPopupMenu({subCalendar: opt_data.subCalendar, autoConvertSupported: opt_data.autoConvertSupported, subCalendarClasses: opt_data.subCalendarClasses, isParent: true}, output);
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.subCalendarPopupMenu = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="subcalendar-dropdown-menu ', (opt_data.isParent) ? 'parent-subCalendar' : '', '"><div class="aui-dd-parent"><div class="aui-dd-trigger"><span class="invisible"></span></div><ul class="aui-dropdown">', (opt_data.subCalendar.menuOptions.showAddEvent) ? '<li><a href="#" class="subcalendar-addevent" title="' + soy.$$escapeHtml("Add a calendar event") + '">' + soy.$$escapeHtml("Add Event") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showNotifications) ? '<li class="subcalendar-watch section-end"><a href="#" title="' + soy.$$escapeHtml("Watch this calendar") + '">' + soy.$$escapeHtml("Watch") + '</a></li><li class="subcalendar-unwatch section-end"><a href="#" title="' + soy.$$escapeHtml("Stop watching this calendar") + '">' + soy.$$escapeHtml("Stop Watching") + '</a></li><li class="subcalendar-watching section-end"><a href="#" title="' + soy.$$escapeHtml("You\x27re watching this calendar via pages") + '">' + soy.$$escapeHtml("Watching") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showView) ? '<li><a href="#" class="subcalendar-view" title="' + soy.$$escapeHtml("View calendar details") + '">' + soy.$$escapeHtml("View Calendar") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showEdit) ? '<li><a href="#" class="subcalendar-edit" title="' + soy.$$escapeHtml("Edit calendar details") + '">' + soy.$$escapeHtml("Edit") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showRestrictions) ? '<li><a href="#" class="subcalendar-restrict" title="' + soy.$$escapeHtml("Restrict access to calendar") + '">' + soy.$$escapeHtml("Restrictions") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showRemove) ? '<li class="section-end"><a href="#" class="subcalendar-remove" title="' + soy.$$escapeHtml("Remove calendar") + '">' + soy.$$escapeHtml("Remove...") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showShareAndSubscribe) ? ((opt_data.autoConvertSupported) ? '<li><a href="#" class="subcalendar-share-or-embed" title="' + soy.$$escapeHtml("Share calendar with others") + '">' + soy.$$escapeHtml("Share or Embed") + '</a></li>' : '<li><a href="#" class="subcalendar-share" title="' + soy.$$escapeHtml("Share calendar with others") + '">' + soy.$$escapeHtml("Share") + '</a></li>') + ((opt_data.subCalendar.menuOptions.showSubscribe) ? '<li><a href="#" class="subcalendar-subscribe" title="' + soy.$$escapeHtml("Subscribe to calendar with calendar programs") + '">' + soy.$$escapeHtml("Subscribe") + '</a></li>' : '') + '<li><a href="#" class="subcalendar-icalexport" title="' + soy.$$escapeHtml("Export calendar in iCalendar format") + '">' + soy.$$escapeHtml("Export to iCalendar") + '</a></li>' : '', (opt_data.subCalendar.menuOptions.showReload) ? '<li class="section-end"><a href="#" class="subcalendar-reload" title="' + soy.$$escapeHtml("Refresh calendar") + '">' + soy.$$escapeHtml("Refresh") + '</a></li>' : '');
  if (opt_data.subCalendar.menuOptions.showColourGrid) {
    Confluence.TeamCalendars.Templates.subCalendarColourGrid(opt_data, output);
  }
  output.append('</ul></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.subCalendarColourGrid = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="color-grid"><div class="color-cells">');
  var subCalendarColorClassList165 = opt_data.subCalendarClasses;
  var subCalendarColorClassListLen165 = subCalendarColorClassList165.length;
  for (var subCalendarColorClassIndex165 = 0; subCalendarColorClassIndex165 < subCalendarColorClassListLen165; subCalendarColorClassIndex165++) {
    var subCalendarColorClassData165 = subCalendarColorClassList165[subCalendarColorClassIndex165];
    output.append('<div class="', soy.$$escapeHtml(subCalendarColorClassData165), ' color-cell ', (subCalendarColorClassIndex165 % 7 == 0) ? ' clear' : '', '" data-colour="', soy.$$escapeHtml(subCalendarColorClassData165), '"></div>');
  }
  output.append('<div class="clear"></div></div></li>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-fields.soy' */
// This file was automatically generated from event-fields.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }
if (typeof Confluence.TeamCalendars.Templates.Fields == 'undefined') { Confluence.TeamCalendars.Templates.Fields = {}; }


Confluence.TeamCalendars.Templates.Fields.text = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-', soy.$$escapeHtml(opt_data.id), '" id="field-text-', soy.$$escapeHtml(opt_data.id), '"><label for="', soy.$$escapeHtml(opt_data.id), '">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</label><input type="text" class="text" name="', soy.$$escapeHtml(opt_data.id), '" id="', soy.$$escapeHtml(opt_data.id), '-text" value="" ', (opt_data.readOnly) ? ' readonly="readonly"' : '', '><div class="error ', soy.$$escapeHtml(opt_data.id), '-error"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.textarea = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-', soy.$$escapeHtml(opt_data.id), '" id="field-textarea-', soy.$$escapeHtml(opt_data.id), '"><label for="', soy.$$escapeHtml(opt_data.id), '">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</label><textarea name="', soy.$$escapeHtml(opt_data.id), '" id="', soy.$$escapeHtml(opt_data.id), '-textarea" class="textarea" rows="', soy.$$escapeHtml(opt_data.size), '" ', (opt_data.readOnly) ? ' readonly="readonly"' : '', '></textarea><div class="error ', soy.$$escapeHtml(opt_data.id), '-error"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.page = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-', soy.$$escapeHtml(opt_data.id), ' field-group-eventlink" id="field-page-', soy.$$escapeHtml(opt_data.id), '"><label for="', soy.$$escapeHtml(opt_data.id), '">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</label><input type="text" class="text" name="', soy.$$escapeHtml(opt_data.id), '" id="', soy.$$escapeHtml(opt_data.id), '-text" value="" ', (opt_data.readOnly) ? ' readonly="readonly"' : '', '><div class="', soy.$$escapeHtml(opt_data.id), '-suggestions aui-dd-parent hidden" ><div class="aui-dropdown"></div></div><div class="error ', soy.$$escapeHtml(opt_data.id), '-error"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.when = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('\t<div id="field-when"><fieldset class="date-select"><legend><span>', soy.$$escapeHtml("When"), '<span class="aui-icon icon-required"></span></span></legend><div class="field-group"><label for="startDate">', soy.$$escapeHtml("Start date"), '</label><input class="datepicker-field date-field start text" type="text" name="startDate" id="', soy.$$escapeHtml(opt_data.id), '-startDate" size="10" value="" autocomplete="off" ', (opt_data.disableStartDateTime) ? ' disabled="disabled"' : '', '><label for="startTime">', soy.$$escapeHtml("Start time"), '</label><input type="text" class="time-field text" name="startTime" id="', soy.$$escapeHtml(opt_data.id), '-startTime" size="8" ', (opt_data.disableStartDateTime) ? ' disabled="disabled"' : '', '><span>', soy.$$escapeHtml("to"), '</span><label for="endTime">', soy.$$escapeHtml("End date"), '</label><input type="text" class="time-field text" name="endTime" id="', soy.$$escapeHtml(opt_data.id), '-endTime" size="8" ', (opt_data.disableEndDateTime) ? ' disabled="disabled"' : '', '><label for="endDate">', soy.$$escapeHtml("End time"), '</label><input class="datepicker-field date-field end text" type="text" name="endDate" id="', soy.$$escapeHtml(opt_data.id), '-endDate" size="10" value="" autocomplete="off" ', (opt_data.disableEndDateTime) ? ' disabled="disabled"' : '', '><div class="error when-error"></div></div></fieldset><div class="field-group field-group-allday"><label for="allDayEvent">', soy.$$escapeHtml("All day event"), '</label><input type="checkbox" class="checkbox" name="allDayEvent" id="', soy.$$escapeHtml(opt_data.id), '-allDayEvent" value="true" ', (opt_data.disableAllDay) ? ' disabled="disabled"' : '', '></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.repeats = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('\t<div id="field-repeats"><input type="hidden" name="freq" value=""><input type="hidden" name="byday" value=""><input type="hidden" name="recurrenceId" value=""><div class="field-group edit-this-instance-only-container hidden"><label for="editthisinstanceonly">', soy.$$escapeHtml("Edit this instance only"), '</label><input type="checkbox" class="checkbox" name="editthisinstanceonly" id="editthisinstanceonly" value="true" checked="checked"></div><div class="field-group field-group-frequency"><label for="freq-select">', soy.$$escapeHtml("Repeat"), '</label><select name="freq-select" id="', soy.$$escapeHtml(opt_data.id), '-freq-select" class="select"><option value="">', soy.$$escapeHtml("Does not repeat"), '</option><option value="DAILY">', soy.$$escapeHtml("Daily"), '</option><option value="WEEKLY-BYDAY">', soy.$$escapeHtml("Weekdays"), '</option><option value="WEEKLY">', soy.$$escapeHtml("Weekly"), '</option><option value="MONTHLY">', soy.$$escapeHtml("Monthly"), '</option><option value="YEARLY">', soy.$$escapeHtml("Yearly"), '</option></select></div><div class="hidden field-group interval-container"><label for="interval">', soy.$$escapeHtml("Repeat every"), '</label><input type="text" class="text" name="interval" id="', soy.$$escapeHtml(opt_data.id), '-interval" maxlength="2"><span class="interval-label"></span><div class="error interval-error"></div></div><fieldset class="date-select recur-ends hidden"><legend><span>', soy.$$escapeHtml("Ends"), '</span></legend><div class="field-group"><label for="recur-end-never">', soy.$$escapeHtml("Never"), '</label><input type="radio" class="radio recur-ends-never" name="recur-end" id="', soy.$$escapeHtml(opt_data.id), '-recur-end-never" checked="checked"><span class="label">', soy.$$escapeHtml("Never"), '</span><label for="recur-end-until">', soy.$$escapeHtml("Until"), '</label><input type="radio" class="radio recur-ends-until" name="recur-end" id="', soy.$$escapeHtml(opt_data.id), '-recur-end-until" disabled="disabled"><span class="label">', soy.$$escapeHtml("Until"), '</span><input class="datepicker-field date-field text" type="text" class="" name="until" id="', soy.$$escapeHtml(opt_data.id), '-until" value="" size="10" disabled="disabled"  autocomplete="off"><div class="error until-error"></div></div></fieldset></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.user = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-group-', soy.$$escapeHtml(opt_data.id), '" id="field-user-', soy.$$escapeHtml(opt_data.id), '"><label for="', soy.$$escapeHtml(opt_data.id), '">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</label><input type="text" class="text autocomplete-user" name="', soy.$$escapeHtml(opt_data.id), '" id="', soy.$$escapeHtml(opt_data.id), '-user-picker" value="" data-max="10" data-none-message="', soy.$$escapeHtml("No users found."), '" data-template="{title}"><ul class="invitees hidden"></ul><div class="error ', soy.$$escapeHtml(opt_data.id), '-error"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.userSelection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="invitee" title="', soy.$$escapeHtml(opt_data.fullName), ' (', soy.$$escapeHtml(opt_data.userName), ')"><div class="invitee-left" threedots="', soy.$$escapeHtml(opt_data.fullName), ' (', soy.$$escapeHtml(opt_data.userName), ')"><img src="', soy.$$escapeHtml(opt_data.imgPath), '"><span class="invitee-name-display">', soy.$$escapeHtml(opt_data.fullName), '<span class="user-name">(', soy.$$escapeHtml(opt_data.userName), ')</span></span></div><div class="invitee-right"><a class="delete-invitee" title="', soy.$$escapeHtml("Delete"), '"></a></div><div class="clear"></div></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.serverSelector = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-group-jira field-group-jira-server" id="field-serverSelector"><label for="tc-jira-server">', soy.$$escapeHtml("Server"), '<span class="aui-icon icon-required"></span></label><select name="tc-jira-server" class="select tc-jira-server"></select><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><div class="error server-error"></div><div class="error oauth-error hidden"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.Fields.projectSelector = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="field-group field-group-jira field-group-jira-project" id="field-projectSelector"><label for="tc-jira-project">', soy.$$escapeHtml("Project"), '<span class="aui-icon icon-required"></span></label><select name="tc-jira-project" class="select tc-jira-project"></select><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><div class="error project-error"></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-local-subcalendar.soy' */
// This file was automatically generated from edit-local-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.editLocalCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId" value=""><input type="hidden" name="timeZoneId" value=""><input type="hidden" name="type" value="local"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="form-mode create"><div class="subcalendar-type subcalendar-local"><div class="field-group field-group-name"><label for="name">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"></span></label><input name="name" id="name" type="text" class="text" value="" autocomplete="off"><div class="error name-error"></div></div><div class="field-group field-group-description"><label for="description">', soy.$$escapeHtml("Description"), '</label><textarea name="description" id="description" rows="5" class="textarea"></textarea></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">', soy.$$escapeHtml("Related space"), '</label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="', soy.$$escapeHtml("No spaces found"), '" data-template="{key}"><div class="description">', soy.$$escapeHtml("Linking a calendar to a space makes it easier to find."), '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group field-group-timezone"><label for="timeZoneIdSelect">', soy.$$escapeHtml("Time zone"), '</label><select name="timeZoneIdSelect" id="timeZoneIdSelect" class="select"></select><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><div class="error timeZoneId-error"></div></div><div class="field-group field-group-timezone-display"><label>', soy.$$escapeHtml("Time zone"), '</label><span class="timeZoneIdDisplay field-value"></span></div><div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml("Error(s) occurred."), '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-people-subcalendar.soy' */
// This file was automatically generated from edit-people-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.editPeopleCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId" value=""><input type="hidden" name="timeZoneId" value=""><input type="hidden" name="type" value="people"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="form-mode create"><div class="subcalendar-type subcalendar-people"><div class="field-group field-group-name"><label for="name">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"></span></label><input name="name" id="name" type="text" class="text" value="" autocomplete="off"><div class="error name-error"></div></div><div class="field-group field-group-description"><label for="description">', soy.$$escapeHtml("Description"), '</label><textarea name="description" id="description" rows="5" class="textarea"></textarea></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">', soy.$$escapeHtml("Related space"), '</label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="', soy.$$escapeHtml("No spaces found"), '"><div class="description">', soy.$$escapeHtml("Linking a calendar to a space makes it easier to find."), '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group field-group-timezone"><label for="timeZoneIdSelect">', soy.$$escapeHtml("Time zone"), '</label><select name="timeZoneIdSelect" id="timeZoneIdSelect" class="select"></select><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><div class="error timeZoneId-error"></div></div><div class="field-group field-group-timezone-display"><label>', soy.$$escapeHtml("Time zone"), '</label><span class="timeZoneIdDisplay field-value"></span></div><div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml("Error(s) occurred."), '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-subscription-subcalendar.soy' */
// This file was automatically generated from edit-subscription-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.editSubscriptionSubcalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId" value=""><input type="hidden" name="type" value="subscription"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="form-mode create"><div class="subcalendar-type subcalendar-subscription"><div class="field-group field-group-name"><label for="name">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"></span></label><input name="name" id="name" type="text" class="text" value="" autocomplete="off"><div class="error name-error"></div></div><div class="field-group field-group-description"><label for="description">', soy.$$escapeHtml("Description"), '</label><textarea name="description" id="description" rows="5" class="textarea"></textarea></div><div class="field-group field-group-url"><label for="location">', soy.$$escapeHtml("URL"), '<span class="aui-icon icon-required"></span></label><input name="location" id="location" type="text" class="text" autocomplete="off"><div class="description">', soy.$$escapeHtml("iCal URL"), '</div><div class="error location-error"></div></div><div class="field-group field-group-username"><label for="username">', soy.$$escapeHtml("User name"), '</label><input name="username" id="username" type="text" class="text"></div><div class="field-group field-group-password"><label for="password">', soy.$$escapeHtml("Password"), '</label><input name="password" id="password" type="password" class="password"></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">', soy.$$escapeHtml("Related space"), '</label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="', soy.$$escapeHtml("No spaces found"), '"><div class="description">', soy.$$escapeHtml("Linking a calendar to a space makes it easier to find."), '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group field-group-timezone-display"><label>', soy.$$escapeHtml("Time zone"), '</label><span class="timeZoneIdDisplay field-value"></span></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-internal-subscription-subcalendar.soy' */
// This file was automatically generated from edit-internal-subscription-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.editInternalSubcalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId" value=""><input type="hidden" name="type" value="internal-subscription"><input type="hidden" name="color" value=""><input type="hidden" name="subscriptionId" value=""><div class="form-mode create"><div class="subcalendar-type subcalendar-interal-subscription"><div class="field-group field-group-name"><label for="name">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"></span></label><input name="name" id="name" type="text" class="text" value="" autocomplete="off" readonly="readonly"><div class="error name-error"></div></div><div class="field-group field-group-description"><label for="description">', soy.$$escapeHtml("Description"), '</label><textarea name="description" id="description" rows="5" class="textarea"></textarea></div><div class="field-group field-group-timezone-display"><label>', soy.$$escapeHtml("Time zone"), '</label><span class="timeZoneIdDisplay field-value"></span></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-jira-subcalendar.soy' */
// This file was automatically generated from edit-jira-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.hiddenJiraFields = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="hidden" name="subCalendarId" value=""><input type="hidden" name="type" value="jira"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value="">');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.editJiraCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId" value=""><input type="hidden" name="type" value="jira"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="form-mode create"><div class="subcalendar-type subcalendar-jira"><div class="jira-query-options option-project-selected"><fieldset class="group loading-dummy"><legend><span>', soy.$$escapeHtml("Display"), ' <span class="aui-icon icon-required"></span></span></legend><div class="matrix"><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"></div></fieldset><fieldset class="group query-group"><legend><span>', soy.$$escapeHtml("Display"), ' <span class="aui-icon icon-required"></span></span></legend><div class="matrix"><div class="radio radio-project"><input class="radio" type="radio" id="query-by-project" name="query-type" checked="checked" value="option-project"><label for="query-by-project">', soy.$$escapeHtml("Project"), '</label></div><div class="radio radio-search-filter trailing-option"><input class="radio" type="radio" id="query-by-searchfilter" name="query-type" value="option-search-filter"><label for="query-by-searchfilter">', soy.$$escapeHtml("Saved filter"), '</label></div><div class="radio radio-jql trailing-option"><input class="radio" type="radio" id="query-by-jql" name="query-type" value="option-jql"><label for="query-by-jql">', soy.$$escapeHtml("JQL (advanced)"), '</label></div></div><div class="field-group hidden"><div class="error jiraQueryOptions-error"></div></div></fieldset><div class="field-group compatibility-group" style="position: relative;"><label for="project" class="hidden project-select-label">', soy.$$escapeHtml("Project"), '<span class="aui-icon icon-required"></span></label><div class="option-project option disableable-option"><div class="option-content"><select class="select content option-value" name="project" id="project"></select><div class="unavailable-message field-value">', soy.$$escapeHtml("No projects found. Please create a project first."), '</div></div><div class="error project-error"></div></div><div class="option-search-filter option disableable-option"><input type="text" class="text option-value hidden" id="searchFilter" name="searchFilter"><label for="searchFilter" class="hidden">', soy.$$escapeHtml("Saved filter"), '</label><div class="option-content"><input type="text" class="text content" id="searchFilterName" name="searchFilterName"><label for="searchFilterName" class="hidden">', soy.$$escapeHtml("Saved filter"), '</label><div class="unavailable-message field-value">', soy.$$escapeHtml("No search filters found. Please create a JIRA search filter."), '</div><div class="search-filter-suggestions hidden"></div><div class="error searchFilterId-error"></div></div></div><div class="option-jql option"><textarea rows="20" cols="20" class="textarea option-value" id="jql" name="jql" wrap="off" autocomplete="off"></textarea><img class="jqlAutoCompleteSpinner hidden" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><div class="clear"></div><label for="jql" class="hidden">', soy.$$escapeHtml("JQL (advanced)"), '</label><div class="error jql-error" id="jql-error"></div><div class="invisible jql-status"><div class="jql-ok hidden">', soy.$$escapeHtml("Valid"), ' <a href="http://confluence.atlassian.com/x/ghGyCg" target="_blank">', soy.$$escapeHtml("JQL"), '</a></div><div class="jql-bad hidden">', soy.$$escapeHtml("Invalid"), ' <a href="http://confluence.atlassian.com/x/ghGyCg" target="_blank">', soy.$$escapeHtml("JQL"), '</a></div></div></div></div><div class="date-fields-spinner-container hidden"><img src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><span>', soy.$$escapeHtml("Loading dates to display..."), '</span></div><fieldset class="group field-group-jira field-group-jira-show hidden"><legend><span>', soy.$$escapeHtml("Show"), '</span></legend><div class="dates"><div class="single-dates"><p class="subtitle">', soy.$$escapeHtml("Single date:"), '</p><div class="date-fields"></div></div><div class="duration"><p class="subtitle">', soy.$$escapeHtml("Date range:"), '</p><div class="date-fields"></div><p class="duration-desc">', soy.$$escapeHtml("Display the time between a start and end date for an issue."), '</p><a href="#" class="add-duration">', soy.$$escapeHtml("Add start and end date..."), '</a></div><div class="clear"></div></div><div class="error dateFieldName-error"></div></fieldset><div class="field-group field-group-timezone-display"><label>', soy.$$escapeHtml("Time zone"), '</label><span class="timeZoneIdDisplay field-value"></span></div></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/edit-jira-subcalendar-duration.soy' */
// This file was automatically generated from edit-jira-subcalendar-duration.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.editJiraSubCalendarDurations = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class="intro">', "You can visualise the duration between two issue dates in Team Calendars. To do this, select your desired fields below or \x3ca href\x3d\x22https://confluence.atlassian.com/x/8QESCw\x22 target\x3d\x22_blank\x22\x3elearn more about creating custom dates\x3c/a\x3e.", '</p><div class="duration-fields"><div class="duration-start"><select name="start-field"><option value="">', soy.$$escapeHtml("Select start date..."), '</option></select></div><div class="duration-end"><select name="end-field"><option value="">', soy.$$escapeHtml("Select end date..."), '</option></select></div><div class="clear"></div></div><div class="no-selectable-date-fields hidden"><p>', soy.$$escapeHtml("No custom dates found for the selected JIRA query."), '</p><p class="add-fields"></p></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/import-subcalendar.soy' */
// This file was automatically generated from import-subcalendar.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.importSubcalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml("Error(s) occurred."), '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="aui-message warning tc-need-timezone hidden"><p class="title"><span class="aui-icon icon-warning"></span><strong>', soy.$$escapeHtml("Unable to determine calendar timezone"), '</strong></p><p>', soy.$$escapeHtml("The timezone for this calendar could not be determined. Please set the timezone below."), '</p></div><form name="importSubCalendarForm" class="sub-calendar-import-form aui" method="POST" action="', soy.$$escapeHtml(""), '/plugins/calendar/importsubcalendar.action" enctype="multipart/form-data" target="import-iframe-sink"><input type="hidden" name="calendarId" value=""><input type="hidden" name="decorator" value="none"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="field-group"><label for="import-name">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"></span></label><input name="name" id="import-name" type="text" class="text" value="" autocomplete="off"><div class="error name-error"></div></div><div class="field-group"><label for="import-description">', soy.$$escapeHtml("Description"), '</label><textarea name="description" id="import-description" rows="5" class="textarea"></textarea></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">', soy.$$escapeHtml("Space"), '</label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="', soy.$$escapeHtml("No spaces found"), '"><div class="description">', soy.$$escapeHtml("Linking a calendar to a space makes it easier to find."), '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group"><label for="ical-file">', soy.$$escapeHtml("Upload iCal"), '<span class="aui-icon icon-required"></span></label><input type="file" class="file upfile" name="file_0" size="25"><div class="error file_0-error"></div></div><div class="field-group tc-field-group-timezone hidden"><label for="timeZone">', soy.$$escapeHtml("Time zone"), '<span class="aui-icon icon-required"></span></label><select name="timeZoneId" class="select timeZone"></select><img class="spinner" src="/confluence/images/icons/wait.gif"><div class="error timeZoneId-error"></div></div><iframe class="subcalendar-import-result hidden" name="import-iframe-sink" src="', soy.$$escapeHtml(""), '/fourohfour.action"></iframe></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-features-dialog.soy' */
// This file was automatically generated from subcalendar-features-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.subCalendarFeatures = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="feature-discovery"><p class="didyouknow description">', soy.$$escapeHtml("Did you know you can also:"), '</p><div class="features-table-container', (! opt_data.autoConvertSupported) ? ' noautoconvert' : '', '"><table cellspacing="0" class="', soy.$$escapeHtml(opt_data.subCalendar.type), '"><tbody><tr class="features"><td class="feature add-event"><a class="feature-icon" alt="', soy.$$escapeHtml("Add"), '">', soy.$$escapeHtml("Add"), '</a><p class="title">', soy.$$escapeHtml("Add"), '</p><p class="feature-description">', soy.$$escapeHtml("Add events to your calendar."), '</p></td><td class="feature restrict"><a class="feature-icon" alt="', soy.$$escapeHtml("Restrict"), '">', soy.$$escapeHtml("Restrict"), '</a><p class="title">', soy.$$escapeHtml("Restrict"), '</p><p class="feature-description">', soy.$$escapeHtml("Restrict the calendar\x27s visibility so that only certain people can see or edit it."), '</p></td><td class="feature embed"><a class="feature-icon" alt="', soy.$$escapeHtml("Embed"), '">', soy.$$escapeHtml("Embed"), '</a><p class="title">', soy.$$escapeHtml("Embed"), '</p><p class="feature-description">', soy.$$escapeHtml("Embed the calendar on a page or blog post."), '</p></td><td class="feature embed-or-share"><a class="feature-icon" alt="', soy.$$escapeHtml("Embed or share"), '">', soy.$$escapeHtml("Embed or share"), '</a><p class="title">', soy.$$escapeHtml("Embed or share"), '</p><p class="feature-description">', soy.$$escapeHtml("Share calendar with others."), '</p></td><td class="feature share"><a class="feature-icon" alt="', soy.$$escapeHtml("Share"), '">', soy.$$escapeHtml("Share"), '</a><p class="title">', soy.$$escapeHtml("Share"), '</p><p class="feature-description">', soy.$$escapeHtml("Share the calendar with other people for them to subscribe to."), '</p></td></tr></tbody></table></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-share-dialog.soy' */
// This file was automatically generated from subcalendar-share-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.shareSubCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div><label for="share-address-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" class="share-address-label">', soy.$$escapeHtml("Calendar link:"), '</label><input type="text" name="share-address" id="share-address-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" class="share-address-field"><div class="description autoconvert hidden">', soy.$$escapeHtml("Copy the link to share the Calendar with others or paste the link on a Confluence page to embed the calendar in your content."), '</div><div class="description icon-lock">', "Restrictions apply to this calendar. \x3ca class\x3d\x22share-restrictions-link\x22 href\x3d\x22#\x22\x3eCheck restrictions.\x3c/a\x3e", '</div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-basic-subscribe-dialog.soy' */
// This file was automatically generated from subcalendar-basic-subscribe-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.subCalendarBasicAuthSubscribe = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div><label for="ical-address-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" class="ical-address-label">', soy.$$escapeHtml("Calendar Address:"), '</label><input type="text" name="ical-address" id="ical-address-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" class="ical-address-basic-field"></div><p>', AJS.format("You can subscribe to this Confluence calendar from your calendar application. Copy the calendar address above and \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3efollow the instructions for the calendar application you wish to use\x3c/a\x3e. Events from JIRA will not appear in this calendar feed.","http://confluence.atlassian.com/x/ewn2Dg"), '</p>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-privateurl-subscribe-dialog.soy' */
// This file was automatically generated from subcalendar-privateurl-subscribe-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.subCalendarPrivateUrlSubscribe = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', AJS.format("Add to Outlook, iCal or other calendar applications by copying the link below and following the \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3einstructions\x3c/a\x3e.","http://confluence.atlassian.com/x/_wJKE"), '</p><input type="text" name="ical-address" id="ical-address-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" class="ical-address-field"><div class="subscribe-or">', soy.$$escapeHtml("or"), '</div><a class="subscribe-google-calendar" href="#" target="_blank"></a><p class="private-url-warning">', "Note: This subscription link is private. If you have accidentally shared your subscription link \x3ca href\x3d\x22#\x22 class\x3d\x22reset-subscription-url\x22\x3eyou should reset it\x3c/a\x3e. Events from JIRA will not appear in this calendar feed.", '</p>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-privateurl-reset-dialog.soy' */
// This file was automatically generated from subcalendar-privateurl-reset-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.resetSubCalendarPrivateUrl = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class="reset-reason">', "Your subscription link for \x3cstrong class\x3d\x22calendar-title\x22\x3e\x3c/strong\x3e is private. If you have accidentally shared this link with others you may want to reset it.", '</p><p class="reset-implication">', soy.$$escapeHtml("Resetting the link to this calendar will mean you will need to re-subscribe to the calendar from your calendar application."), '</p><div class="reset-progress"><div class="resetting"><img class="progress-icon" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><span class="progress-description">', soy.$$escapeHtml("Resetting..."), '</span></div><div class="reset"><img class="progress-icon" src="', soy.$$escapeHtml(""), '/images/icons/bullet_done.gif"><span class="progress-description">', soy.$$escapeHtml("Subscription link has been reset."), ' <a href="#" class="subscribe-to-calendar">', soy.$$escapeHtml("Subscribe to this calendar"), '</a>.</span></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-restrict-dialog.soy' */
// This file was automatically generated from subcalendar-restrict-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.restrictSubCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="editSubCalendarForm" class="sub-calendar-edit-form aui" method="POST" action="#"><input type="hidden" name="subCalendarId"><div class="field-group-permissions"><div class="permissions-type-select"><input type="radio" name="restriction-type" class="radio option-view-restrictions" id="option-view-restrictions-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" value="view"><span>', soy.$$escapeHtml("Restrict viewing"), '</span><input type="radio" name="restriction-type" class="radio option-edit-restrictions" id="option-edit-restrictions-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" value="edit" checked="checked"><span>', soy.$$escapeHtml("Restrict editing"), '</span></div><div class="permissions-details"><div class="permissions-input"><div class="user-picker-container"><input name="permissionsUserPicker" id="permissionsUserPicker-', soy.$$escapeHtml(opt_data.elementIdSuffix), '" type="text" class="text autocomplete-user with-hint" value="', soy.$$escapeHtml("Enter user name"), '" autocomplete="off" data-none-message="', soy.$$escapeHtml("No user found. Press \x27enter\x27 to input as group."), '" data-template="{title}" data-max="3"></div><div class="group-picker-container"><span class="or-text">', soy.$$escapeHtml("or"), '</span><a class="group-picker-trigger" href="#">', (opt_data.pdlEnabled) ? '<span class="icon icon-group"></span><span>' + soy.$$escapeHtml("Group...") + '</span>' : '<img class="group-picker-icon" src="' + soy.$$escapeHtml("") + '/images/icons/group_16.gif"><span>' + soy.$$escapeHtml("Group...") + '</span>', '</a><div class="clear"></div></div></div><div class="clear"></div><div class="error permissions-error"></div><div class="view-permissions">', (opt_data.pdlEnabled) ? '<span class="aui-icon-small aui-iconfont-view"></span>' : '', '<span class="no-view-restrictions">', soy.$$escapeHtml("No view restrictions defined for this calendar"), '</span><span class="restricted-viewing-to">', soy.$$escapeHtml("Viewing restricted to:"), '</span><table class="permission-table hidden"><tbody class="permitted-entities"></tbody></table></div><div class="clear"></div><div class="edit-permissions"><div class="no-edit-restrictions">', soy.$$escapeHtml("No edit restrictions defined for this calendar"), '</div><div class="restricted-editing-to">', soy.$$escapeHtml("Editing restricted to:"), '</div><table class="permission-table hidden"><tbody class="permitted-entities"></tbody></table></div></div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-remove-dialog.soy' */
// This file was automatically generated from subcalendar-remove-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.removeSubCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="sub-calendar-remove aui" action="#" method="POST"><h3>', "What would you like to do with \x26quot;\x3cspan class\x3d\x22calendar-to-remove\x22\x3e\x3c/span\x3e\x26quot;?", '</h3><fieldset class="group radios"><div class="radio"><input class="radio" type="radio" name="remove" id="removefromviewoption" checked="checked"><label for="removefromviewoption">', soy.$$escapeHtml("Remove this calendar from my calendar view."), '</label></div><div class="radio"><input class="radio" type="radio" name="remove" id="deletecalendaroption" ><label for="deletecalendaroption">', soy.$$escapeHtml("Permanently delete this calendar for all users."), '</label></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/subcalendar-remove-confirm-dialog.soy' */
// This file was automatically generated from subcalendar-remove-confirm-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.confirmRemoveSubCalendar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="sub-calendar-delete-confirm aui" action="#" method="POST"><input type="hidden" name="subCalendarId" value=""><p><strong>', "Are you sure you want to delete \x26quot;\x3cspan class\x3d\x22calendar-to-delete\x22\x3e\x3c/span\x3e\x26quot;?", (opt_data.subscriberCount > 0) ? (opt_data.subscriberCount > 1) ? '<span class="has-subscribers-warning"> ' + soy.$$escapeHtml(AJS.format("There are {0} people subscribed to this calendar.",opt_data.subscriberCount)) + '</span>' : '<span class="has-subscribers-warning"> ' + soy.$$escapeHtml("There is 1 person subscribed to this calendar.") + '</span>' : '', '</strong></p>', (opt_data.subCalendar.subscriptionType == 'jira' || opt_data.subCalendar.type == 'jira') ? soy.$$escapeHtml("Removing this calendar will not change anything in JIRA. This calendar is only a view of it. The same view can be recreated again, if so desired, with the same parameters.") : '<p>' + soy.$$escapeHtml("All subscribers will be sent an iCalendar export of this calendar.") + '</p><p>' + AJS.format("If you need to restore the calendar at any time, simply choose the \x26quot;{0}\x26quot; option when adding a new calendar.","Import Calendar") + '</p>', '<div class="clear"></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/jira-subcalendar-remove-confirm-dialog.soy' */
// This file was automatically generated from jira-subcalendar-remove-confirm-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.confirmRemoveJiraEvents = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="delete-jira-events-hint"><p>', soy.$$escapeHtml(AJS.format("Are you sure you want to remove \x27\x27{0}\x27\x27 from \x27\x27{1}\x27\x27?",opt_data.childName,opt_data.parentName)), '</p></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/calendar-search-result.soy' */
// This file was automatically generated from calendar-search-result.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.calendarSearchResultTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<table class="confluenceTable"><thead><tr><th class="subcalendar-checkbox"></th><th class="subcalendar-name">', soy.$$escapeHtml("Calendar"), '</th><th class="subcalendar-description">', soy.$$escapeHtml("Description"), '</th><th class="subcalendar-space">', soy.$$escapeHtml("Related space"), '</th><th class="subcalendar-subscribercount">', soy.$$escapeHtml("Subscribers"), '</th></tr></thead><tbody></tbody></table>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.calendarSearchResult = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<tr><td class="confluenceTd"><input type="checkbox" class="subcalendar-select"></td><td class="confluenceTd subcalendar-name"><div class="ellipsedColumn" title="', soy.$$escapeHtml(opt_data.name), '" threedots="', soy.$$escapeHtml(opt_data.name), '"><span class="ellipsis_text">', soy.$$escapeHtml(opt_data.name), '</span></div></td><td class="confluenceTd subcalendar-description"><div class="ellipsedColumn" title="', soy.$$escapeHtml(opt_data.description), '" threedots="', soy.$$escapeHtml(opt_data.description), '"><span class="ellipsis_text">', soy.$$escapeHtml(opt_data.description), '</span></div></td><td class="confluenceTd subcalendar-space"><div class="ellipsedColumn" title="', soy.$$escapeHtml(opt_data.relatedSpace), '" threedots="', soy.$$escapeHtml(opt_data.relatedSpace), '"><span class="ellipsis_text">', soy.$$escapeHtml(opt_data.relatedSpace), '</span></div></td><td class="confluenceTd"><div class="ellipsedColumn" title="', soy.$$escapeHtml(opt_data.numSubscribers), '" threedots="', soy.$$escapeHtml(opt_data.numSubscribers), '"><span class="ellipsis_text">', soy.$$escapeHtml(opt_data.numSubscribers), '</span></div></td></tr>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/timeline-view.js' */
(function(a){Confluence.TeamCalendars.getTimelineAdapter=function(E,r,m,x){var n,e,p,B,c,q,g,u,l,J,w,b,L=null,j,y=null,G=500,i=0.2,K;n=r;e=m;p=E;B=x;c=1000*60*60*24*7;q=new Date();g=new Date(q.getTime()-c*2);u=new Date(q.getTime()+c*2);B.visStart=g;B.visEnd=u;l=g;J=u;function t(S){var O,Q,R,V,U=function(){if(j){R=j.dom.frame.scrollTop;V=a(j.dom.content).height()}},P=function(){var W=a(j.dom.content).height()-V;if(W>0){j.dom.frame.scrollTop=R+W}else{j.dom.frame.scrollTop=R}},T=function(){if(K){var W=a("<div/>");a.each(S,function(Z,X){var Y=W.empty().html(X.content).find("[data-event-id]").data("event-id");if(Y===K.id){j.setSelection([{row:Z}],true)}});K=null}};O=n.getTimelineHeight(e)||G;Q={width:"99%",height:"auto",viewHeight:O+"px",minHeight:O,editable:true,enableKeys:true,axisOnTop:false,showNavigation:true,style:"box",start:g,end:u,intervalMin:1000*60*60*6,intervalMax:c*4*3,months:n.getMonthNames(),days:n.getDayNames()};U();j=new links.Timeline(p[0]);links.events.addListener(j,"select",o);links.events.addListener(j,"change",v);links.events.addListener(j,"rangechange",C);links.events.addListener(j,"rangechanged",F);links.events.addListener(j,"add",z);links.events.addListener(j,"moved",s);j.draw(S,Q);P();T();C()}function C(){A()}function o(O){var Q=M(),P=a(".timeline-event-box.timeline-event-selected");if(!Q){return}if(!P.length){P=a(".timeline-event-range.timeline-event-selected")}if(!d(Q)){j.setSelection([])}if(Q.disableResizing){a(".timeline-event-range-drag-left, .timeline-event-range-drag-right").addClass("hidden")}else{a(".timeline-event-range-drag-left, .timeline-event-range-drag-right").removeClass("hidden")}L=n.getEventDetailsDialog(e,Q,P);L[0].style.zIndex=1000;L.show();if(P.position().left<0){setTimeout(function(){var R=P.parent().offset().left;L.offset({left:R})},0)}}function v(){var Q=M(),P=H(),O=D(Q,P);K=Q;if(!d(Q)){j.cancelChange()}else{n.setSubCalendarSpinnerIconVisible(e,true);n.updateEvent(e,O,function(R,T,S){n.setSubCalendarSpinnerIconVisible(e,false);n.showAjaxError(e,R,T,S,n.ERROR_CLASS_EVENT_UPDATE)},function(R){n.setSubCalendarSpinnerIconVisible(e,false);if(R.success){y=Q.subCalendarId;n.reloadSubCalendar(e,Q.subCalendarId)}else{Confluence.TeamCalendars.setGenericErrors(e,I(R.fieldErrors),n.ERROR_CLASS_EVENT_UPDATE)}})}A()}function F(){var O=j.getVisibleChartRange();k(O.start.getTime(),O.end.getTime())}function f(Q,P){if(!Q&&!P){var O=j.getVisibleChartRange();Q=new Date(O.start);P=new Date(O.end)}Confluence.TeamCalendars.updateDateDisplay(e,a.fullCalendar.formatDate(Q,"dd MMM")+" &mdash; "+a.fullCalendar.formatDate(P,"dd MMM, yyyy"))}function k(Q,P){var O=(P-Q)/2;g=new Date(Q);u=new Date(P);if(l.getTime()>Q||J.getTime()<P){l.setTime(Q-O);J.setTime(P+O);B.visStart=l;B.visEnd=J;B.update()}f(g,u)}function z(O){Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:O.start,localizedStartTime:n.getDefaultStartTime(e),localizedEndTime:n.getDefaultEndTime(e),allDay:true},null,n,e).show()}function s(){A()}function d(O){return n.isEventEditable(e,O)}function h(){var P=undefined;var O=j.getSelection();if(O.length){if(O[0].row!=undefined){P=O[0].row}}return P}function M(){return w[h()]}function H(){return b[h()]}function A(){L&&L.hide()}function I(O){return a.map(O,function(P,Q){return P.field+" : "+P.errorMessages.toString()})}function N(P){function O(S){var R;if(!S.allDay){return S.end}if(S.className[0]=="jira-version"){return null}R=S.end||new Date(S.start.getTime());R=new Date(R.getTime());R.setHours(R.getHours()+23);R.setMinutes(59);R.setSeconds(59);return R}function Q(T){var S=T.className[0];function R(){if(a.inArray("jira-version",T.className)!==-1){return T.title}if(a.inArray("other",T.className)!==-1){if(T.shortTitle){return T.shortTitle+": "+T.title}else{if(T.invitees&&T.invitees.length){return T.invitees[0].displayName+": "+T.title}else{return T.title}}}else{return T.shortTitle||T.title}}switch(S){case"birthdays":return Confluence.TeamCalendars.Templates.timelineEventContentWithEventTypeIcon({eventId:T.id,className:S,title:R()});break;case"travel":case"leaves":case"other":if(T.invitees&&T.invitees.length){if(T.invitees.length>1){return Confluence.TeamCalendars.Templates.timelineEventContent({eventId:T.id,iconClass:"people",title:R()})}else{return Confluence.TeamCalendars.Templates.timelineEventContentSingleInvitee({eventId:T.id,iconUrl:T.iconUrl,title:R()})}}else{return Confluence.TeamCalendars.Templates.defaultTimelineEventContent({eventId:T.id,title:T.title})}break;case"jira-issue":case"jira-version":case"greenhopper-sprint":return Confluence.TeamCalendars.Templates.timelineEventContent({eventId:T.id,iconClass:S,title:R()});break}return Confluence.TeamCalendars.Templates.defaultTimelineEventContent({eventId:T.id,title:T.title})}return a.map(P,function(R){return{start:R.start,end:O(R),content:Q(R),className:R.colorScheme}})}function D(O,Q){var P={},R=n.getSubCalendar(e,O.subCalendarId);if(O.className[0]=="jira-version"||(O.allDay&&Q.end.getHours()==23&&Q.end.getMinutes()==59)){P.allDayEvent=true;if(Q.end){Q.end.setHours(0);Q.end.setMinutes(0);Q.end.setSeconds(0)}}else{P.allDayEvent=false}P.subCalendarId=R.parentId;P.uid=O._id;P.originalStartDate=O.originalStart||"";P.what=O.title;P.url=O.workingUrl;P.start=a.fullCalendar.formatDate(Q.start,"ddMMyyyyHHmm");P.end=a.fullCalendar.formatDate(Q.end||Q.start,"ddMMyyyyHHmm");P.where=O.where;P.description=O.description;P.freq=O.recur?O.recur.freq:"";P.byday=O.recur?O.recur.byDay:"";P.interval=O.recur?O.recur.interval:"";P.until=O.recur?O.recur.localizedUntil||"":"";P.recurrenceId=O.recurId||"";P.editAllInRecurrenceSeries="false";P.dragAndDropUpdate=true;P.eventType=O.eventType;if(R.eventInviteesSupported){P.person=a.map(O.invitees||[],function(S){return S.id})}return P}return{renderEvents:function(P){var O=a.map(P,function(Q){return Q.subCalendarId});if(y&&a.inArray(y,O)===-1){y=null;return}w=P;b=N(P);t(b);f()},setDate:function(O){var P=u.getTime()-g.getTime();g=new Date(O.getTime()-(P/2));u=new Date(O.getTime()+(P/2));k(g.getTime(),u.getTime())},next:function(){j.move(i);F()},prev:function(){j.move(-i);F()},gotoToday:function(){j.setVisibleChartRangeNow();F()}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/require-oauth-message.soy' */
// This file was automatically generated from require-oauth-message.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.requireOauthMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="oauth-approve aui-message hint" data-o-auth-url="', soy.$$escapeHtml(opt_data.oAuthUrl), '" data-sub-calendar-ids="', soy.$$escapeHtml(opt_data.subCalendarIdsArrayJson), '" data-sub-calendar-names="', soy.$$escapeHtml(opt_data.subCalendarNamesArrayJson), '">', AJS.format("\x3ca href\x3d\x22#\x22 class\x3d\x22approve-dance\x22\x3e{0}\x3c/a\x3e to see events of \x3cspan class\x3d\x22subcalendar-names\x22\x3e{1}\x3c/span\x3e","Login \x26 Approve",opt_data.subCalendarName), '</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jira/globals.js' */
if(!window.JIRA){window.JIRA={}}if(!window.JIRA.begetObject){window.JIRA.begetObject=function(b){var a=function(){};a.prototype=b;return new a()}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jira/Dropdown.js' */
JIRA.Dropdown=function(){var a=[];return{addInstance:function(){a.push(this)},hideInstances:function(){var b=this;jQuery(a).each(function(){if(b!==this){this.hideDropdown()}})},getHash:function(){if(!this.hash){this.hash={container:this.dropdown,hide:this.hideDropdown,show:this.displayDropdown}}return this.hash},displayDropdown:function(){if(JIRA.Dropdown.current===this){return}this.hideInstances();JIRA.Dropdown.current=this;this.dropdown.css({display:"block"});this.displayed=true;var b=this.dropdown;setTimeout(function(){var d=jQuery(window);var c=b.offset().top+b.attr("offsetHeight")-d.height()+10;if(d.scrollTop()<c){jQuery("html,body").animate({scrollTop:c},300,"linear")}},100)},hideDropdown:function(){if(this.displayed===false){return}JIRA.Dropdown.current=null;this.dropdown.css({display:"none"});this.displayed=false},init:function(b,d){var c=this;this.addInstance(this);this.dropdown=jQuery(d);this.dropdown.css({display:"none"});jQuery(document).keydown(function(f){if(f.keyCode===9){c.hideDropdown()}});if(b.target){jQuery.aop.before(b,function(){if(!c.displayed){c.displayDropdown()}})}else{c.dropdown.css("top",jQuery(b).outerHeight()+"px");b.click(function(f){if(!c.displayed){c.displayDropdown();f.stopPropagation()}else{c.hideDropdown()}f.preventDefault()})}jQuery(document.body).click(function(){if(c.displayed){c.hideDropdown()}})}}}();JIRA.Dropdown.Standard=function(a,c){var b=JIRA.begetObject(JIRA.Dropdown);b.init(a,c);return b};JIRA.Dropdown.AutoComplete=function(a,c){var b=JIRA.begetObject(JIRA.Dropdown);b.init=function(d,e){this.addInstance(this);this.dropdown=jQuery(e).click(function(f){f.stopPropagation()});this.dropdown.css({display:"none"});if(d.target){jQuery.aop.before(d,function(){if(!b.displayed){b.displayDropdown()}})}else{d.click(function(f){if(!b.displayed){b.displayDropdown();f.stopPropagation()}})}jQuery(document.body).click(function(){if(b.displayed){b.hideDropdown()}})};b.init(a,c);return b};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jira/JiraAutoComplete.js' */
JIRA.AutoComplete=function(){var c;var b=function(e,d){if(b.t){clearTimeout(b.t);b.t=undefined}b.t=setTimeout(e,d*1000)};var a={9:true,13:true,14:true,25:true,27:true,38:true,40:true,224:true};return{dispatcher:function(){},getSavedResponse:function(){},saveResponse:function(){},renderSuggestions:function(){},disable:function(){this.disabled=true},enable:function(){this.disabled=false},set:function(e){for(var d in e){if(e.hasOwnProperty(d)){this[d]=e[d]}}},completeField:function(d){if(d){this.field.val(d).focus()}},textToSuggestionCursorPosition:function(){return this.field.val()},_makeRequest:function(d){var e=this,f=AJS.$.extend({},d);if(this.pendingRequest){this.pendingRequest.abort()}f.complete=function(){e.pendingRequest=null};f.error=function(g){if(!g.aborted&&g.status!==0&&d.error){d.error.apply(this,arguments)}};f.timeout=Confluence.TeamCalendars.ajaxTimeout;return this.pendingRequest=AJS.$.ajax(f)},addSuggestionControls:function(h){var m=this;var l=function(q,i){var r=(m.autoSelectFirst===false)?-1:0;if(m.allowArrowCarousel){if(q>i){return r}else{if(q<r){return i}else{return q}}}else{if(q>i){return i}else{if(q<r){m.responseContainer.scrollTop(0);return r}else{return q}}}};var d=function(i){if(m.selectedIndex!==undefined&&m.selectedIndex>-1){m.suggestionNodes[m.selectedIndex][0].removeClass("active")}m.selectedIndex=l(i,m.suggestionNodes.length-1);if(m.selectedIndex>-1){m.suggestionNodes[m.selectedIndex][0].addClass("active")}};var p=function(){return m.suggestionNodes&&m.suggestionNodes[m.selectedIndex]&&m.suggestionNodes[m.selectedIndex][0].hasClass("active")};var n=function(i){if(m.responseContainer.is(":visible")){if(i.keyCode===13){if(p()&&!m.pendingRequest){m.completeField(m.suggestionNodes[m.selectedIndex][1])}i.preventDefault()}}};var g=function(s){if(m.responseContainer.is(":visible")){if(m.field[0]!==document.activeElement){m.field.focus()}if(s.keyCode===40){d(m.selectedIndex+1);if(m.selectedIndex>=0){var q=m.responseContainer.height();var i=m.suggestionNodes[m.selectedIndex][0].position().top+m.suggestionNodes[m.selectedIndex][0].outerHeight();if(i-q>0){m.responseContainer.scrollTop(m.responseContainer.scrollTop()+i-q+2)}}else{m.responseContainer.scrollTop(0)}s.preventDefault()}else{if(s.keyCode===38){d(m.selectedIndex-1);if(m.selectedIndex>=0){var r=m.suggestionNodes[m.selectedIndex][0].position().top;if(r<0){m.responseContainer.scrollTop(m.responseContainer.scrollTop()+r-2)}}s.preventDefault()}else{if(s.keyCode===9){if(p()){m.completeField(m.suggestionNodes[m.selectedIndex][1]);s.preventDefault()}else{m.dropdownController.hideDropdown()}}}}}};if(h.length){this.selectedIndex=0;this.suggestionNodes=h;for(var k=0;k<m.suggestionNodes.length;k++){var o={instance:this,index:k};this.suggestionNodes[k][0].bind("mouseover",o,j).bind("mouseout",o,f).bind("click",o,e)}if(!this.keyboardHandlerBinded){jQuery(this.field).keypress(n);if(jQuery.browser.mozilla){jQuery(this.field).keypress(g)}else{jQuery(this.field).keydown(g)}this.keyboardHandlerBinded=true}if(m.autoSelectFirst===false){d(-1)}else{d(0)}c=this}function j(i){if(m.dropdownController.displayed){d(i.data.index)}}function f(i){if(i.data.index===0){m.selectedIndex=-1}jQuery(this).removeClass("active")}function e(i){m.completeField(m.suggestionNodes[i.data.index][1])}},clearResponseContainer:function(){this.responseContainer.empty();this.suggestionNodes=undefined},delay:b,buildResponseContainer:function(){var d=this.field.parent().addClass("atlassian-autocomplete");this.responseContainer=jQuery(document.createElement("div"));this.responseContainer.addClass("suggestions").css({top:this.field.outerHeight()+"px"}).appendTo(d)},keyUpHandler:(function(){var d=jQuery.browser.msie&&jQuery.browser.version==8;function e(){if(!this.responseContainer){this.buildResponseContainer()}this.dispatcher(this.field.val())}return function(f){if(this.field.val().length>=this.minQueryLength){if(!(f.keyCode in a)||(this.responseContainer&&!this.responseContainer.is(":visible")&&(f.keyCode==38||f.keyCode==40))){if(d){b(jQuery.proxy(e,this),0.2)}else{e.call(this)}}}return f}})(),addMultiSelectAdvice:function(f){var e=this;var d=function(h){if(!d.isAlerting){d.isAlerting=true;var g=jQuery(document.createElement("div")).css({"float":"left",display:"none"}).addClass("warningBox").html("Oops! You have already entered the value <em>"+h+"</em>").appendTo(e.field.parent()).show("fast",function(){e.delay(function(){g.hide("fast",function(){g.remove();d.isAlerting=false})},4)})}};jQuery.aop.before({target:this,method:"dispatcher"},function(h){var g=this.field.val();h[0]=jQuery.trim(g.slice(g.lastIndexOf(f)+1));return h});jQuery.aop.before({target:this,method:"completeField"},function(h){var j=h[0],i=this.field.val().split(f);var g=jQuery(i).map(function(){return jQuery.trim(this)}).get();if(!this.allowDuplicates&&new RegExp("(?:^|[\\s"+f+"])"+j+"\\s*"+f).test(this.field.val())){d(j);g[g.length-1]=""}else{g[g.length-1]=j;g[g.length]=""}h[0]=g.join(f.replace(/([^\s]$)/,"$1 "));return h})},addDropdownAdvice:function(){var d=this;jQuery.aop.after({target:this,method:"buildResponseContainer"},function(e){this.dropdownController=JIRA.Dropdown.AutoComplete({target:this,method:"renderSuggestions"},this.responseContainer);if(AJS.$.browser.msie){jQuery.aop.before({target:this.dropdownController,method:"displayDropdown"},function(){d.field.parent().addClass("atlassian-autocomplete")});jQuery.aop.after({target:this.dropdownController,method:"hideDropdown"},function(){d.field.parent().removeClass("atlassian-autocomplete")})}jQuery.aop.after({target:this.dropdownController,method:"hideDropdown"},function(){this.dropdown.removeClass("dropdown-ready")});return e});jQuery.aop.after({target:this,method:"renderSuggestions"},function(e){if(e&&e.length>0){this.dropdownController.displayDropdown();if(this.maxHeight&&this.dropdownController.dropdown.attr("scrollHeight")>this.maxHeight){this.dropdownController.dropdown.css({height:this.maxHeight,overflowX:"visible",overflowY:"scroll"})}else{if(this.maxHeight){this.dropdownController.dropdown.css({height:"",overflowX:"",overflowY:""})}}this.dropdownController.dropdown.addClass("dropdown-ready")}else{this.dropdownController.hideDropdown()}return e});jQuery.aop.after({target:this,method:"completeField"},function(e){this.dropdownController.hideDropdown();return e});jQuery.aop.after({target:this,method:"keyUpHandler"},function(f){if((!(this.field.val().length>=this.minQueryLength)||f.keyCode===27)&&this.dropdownController&&this.dropdownController.displayed){this.dropdownController.hideDropdown();if(f.keyCode===27){f.stopPropagation()}}return f})},init:function(d){var e=this;this.set(d);this.field=this.field||jQuery("#"+this.fieldID);this.field.attr("autocomplete","off").keyup(function(f){if(!e.disabled){e.keyUpHandler(f)}}).keydown(function(g){var f=27;if(g.keyCode===f&&e.responseContainer&&e.responseContainer.is(":visible")){g.preventDefault()}}).click(function(f){if(c===e){f.stopPropagation()}}).blur(function(){if(e.pendingRequest){e.pendingRequest.abort()}});this.addDropdownAdvice();if(d.delimChar){this.addMultiSelectAdvice(d.delimChar)}}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/js/jira/JQLAutoComplete.js' */
(function(){var F=[{value:"=",displayName:"="},{value:"!=",displayName:"!="},{value:"~",displayName:"~"},{value:"<=",displayName:"&lt;="},{value:">=",displayName:"&gt;="},{value:">",displayName:"&gt;"},{value:"<",displayName:"&lt;"},{value:"!~",displayName:"!~"},{value:"is not",displayName:"is not"},{value:"is",displayName:"is"},{value:"not in",displayName:"not in"},{value:"in",displayName:"in"},{value:"was",displayName:"was"},{value:"was not",displayName:"was not"},{value:"was in",displayName:"was in"},{value:"was not in",displayName:"was not in"},{value:"changed",displayName:"changed"}];var o=[{value:"AND",displayName:"AND"},{value:"OR",displayName:"OR"}];var x=[{value:"AND",displayName:"AND"},{value:"OR",displayName:"OR"},{value:"ORDER BY",displayName:"ORDER BY"}];var s=[{value:"ASC",displayName:"ASC"},{value:"DESC",displayName:"DESC"}];var t=[{value:"EMPTY",displayName:"EMPTY",types:["java.lang.Object"]}];var E=[{value:"NOT",displayName:"NOT"}];var i=[{value:"AFTER",displayName:"AFTER",type:"java.util.Date",supportsList:"false"},{value:"BEFORE",displayName:"BEFORE",type:"java.util.Date",supportsList:"false"},{value:"BY",displayName:"BY",type:"com.opensymphony.user.User",supportsList:"false",auto:"true"},{value:"DURING",displayName:"DURING",type:"java.util.Date",supportsList:"true"},{value:"ON",displayName:"ON",type:"java.util.Date",supportsList:"false"}];var n=i.concat([{value:"FROM",displayName:"FROM",type:"java.lang.String",supportsList:"true",auto:"true"},{value:"TO",displayName:"TO",type:"java.lang.String",supportsList:"true",auto:"true"}]);var y=i.concat(x);var k=i.concat(o);var v=n.concat(x);var p=n.concat(o);var h=/^AND\s/i;var A=/^OR\s/i;var e=/^NOT\s/i;var w=/^\s+not/i;var d=/^\s+in/i;var m=/^\s+(not\s+in|not|in)/i;var u=/^\s*,/;var r=/^\s+asc/i;var H=/^\s+desc/i;var l=/^order\s+by/i;var D=/^\s/;var g=/^u[a-fA-F0-9]{4}/;var z=/^\s-\scf\[\d\d\d\d\d\]/;var c=/[\r\n]/;var a=/\d/;var G=/[^=!~<>(),\s&|]/;var f=/[{}*\/%+$#@?.;\][]/;var b=/[\s(]/;var C=/[^trn"'\\\s]/;var q=/^NO?$/i;var B=/^IN?$/i;var j=/^(after|before|by|during|from|on|to)/i;JIRA.JQLAutoComplete=function(T){var N=JIRA.begetObject(JIRA.AutoComplete);var I=T.parser;var U;var J=jQuery.grep(T.jqlFieldNames,function(V){return V.searchable});var P=jQuery.grep(T.jqlFieldNames,function(V){return V.orderable});var R=T.jqlFunctionNames;var M=jQuery("#"+T.errorID);var Q=0;var K=jQuery("#jqlcolumnnum");var S=jQuery("#jqlrownum");var L=T.jiraApplicationId;var O=T.baseUrl;N.textToSuggestionCursorPosition=function(){return this.field.selectionRange().textBefore};N.pushSuggestionsOnHtmlStack=function(ab,Z,ac,Y,V){var X=Math.min(15,ab.length);for(var aa=0;aa<X;aa++){var W;var ae;if(ab[aa].value){var ad=ab[aa];if(U&&V){W=((U.getNeedsOpenParen())?"(":"")+ad.value}else{W=ad.value}ae=ad.displayName}else{ae=ab[aa];W=displayName}Z.push(W);ac.push('<li id="',Y,aa,'">',ae,"</li>")}};N.renderSuggestions=function(W,Y,V){var Z=[];if(W instanceof Array){if(W.length<1&&(Y&&Y.length<1)&&(V&&V.length<1)){return Z}var X=["<ul>"];if(V&&V.length>0){N.pushSuggestionsOnHtmlStack(V,Z,X,"jql_operator_suggest_",false)}N.pushSuggestionsOnHtmlStack(W,Z,X,"jql_value_suggest_",true);if(Y&&Y.length>0){N.pushSuggestionsOnHtmlStack(Y,Z,X,"jql_function_suggest_",false)}X.push("</ul>");N.responseContainer.html(X.join("")).find("li").each(function(aa){Z[aa]=[jQuery(this),Z[aa]]});N.addSuggestionControls(Z)}return Z};N.completeField=function(X){var Y=N.getReplacementStartIndex(U,X);var V=N.getReplacementEndIndex(U,Y);N.replaceValue(Y,V,X);var W=I.parse(this.field.val());N.updateParseIndicator(W)};N.prepareOperandSuggestions=function(aa,ad,ac,Y,Z){if(aa){var W=Q;var V=(Z==null)?((U.getLastOperand()===null)?"":N.stripEscapeCharacters(U.getLastOperand())):Z;var ab=ad+":"+V;var X={fieldName:N.stripEscapeCharacters(ad)};if(U.getLastOperand()!==null||Z!==null){X.fieldValue=V}if(!N.getSavedResponse(ab)){N.dropdownController.dropdown.removeClass("dropdown-ready");this.delay(function(){N._makeRequest({url:O+"/rest/calendar-services/1.0/jira/"+encodeURIComponent(L)+"/jql/autocomplete.json",dataType:"json",data:X,success:function(ae){var af;if(ae!==null&&ae.results!==null){af=ae.results}else{af=[]}N.saveResponse(ab,af);N.renderSuggestionsForOperands(V,af,ac,Y,W)},error:function(){N.renderSuggestionsForOperands(V,[],ac,Y,W)}})},N.queryDelay)}else{N.renderSuggestionsForOperands(V,N.getSavedResponse(ab),ac,Y,W)}}else{N.renderSuggestionsForOperands(N.stripEscapeCharacters(U.getLastOperand()),[],ac,Y,Q)}};N.preparePredicateSuggestions=function(ab,V){var Z=Q;if(typeof V=="undefined"){V=null}var Y=N.slimListForPredicates(V,R,ab);N.boldMatchingString(V,Y);var W=(V==null)?((U.getLastOperand()===null)?"":N.stripEscapeCharacters(U.getLastOperand())):V;var aa=ab+":"+W;var X={predicateName:N.stripEscapeCharacters(ab)};if(U.getLastOperand()!==null||V!==null){X.predicateValue=W}if(U.getLastFieldName()!==null){X.fieldName=U.getLastFieldName();aa=U.getLastFieldName()+":"+aa}if(N.predicateSupportsAutoComplete(ab)){if(!N.getSavedResponse(aa)){N.dropdownController.dropdown.removeClass("dropdown-ready");this.delay(function(){N._makeRequest({url:O+"/rest/calendar-services/1.0/jira/"+encodeURIComponent(L)+"/jql/autocomplete.json",dataType:"json",data:X,success:function(ac){var ad;if(ac!==null&&ac.results!==null){ad=ac.results}else{ad=[]}N.saveResponse(aa,ad);N.renderSuggestions(ad,Y)},error:function(){N.renderSuggestionsForOperands(W,[])}})},N.queryDelay)}else{N.renderSuggestions(N.getSavedResponse(aa),Y)}}else{N.renderSuggestions([],Y)}};N.incompleteOperator=function(){var V=U.getTokens();if(V==null||V.length<2){return""}else{var V=N.textToSuggestionCursorPosition().split(" ");if(V.length>2){return V[V.length-1]}}return""};N.incompletePredicateValue=function(){var V=U.getTokens();if(V==null||V.length<3){return""}else{var V=N.textToSuggestionCursorPosition().split(/[\s(,]+/);if(V.length>3){return V[V.length-1]}}return""};N.dispatcher=function(X){var af=this;var V=jQuery(af.field).selectionRange();var ad=X.substring(0,V.start);U=I.parse(ad).getResult();Q++;if(U.getNeedsField()){af.renderSuggestionsFromMap(af.stripEscapeCharacters(U.getLastFieldName()),J,E,true)}else{if(U.getNeedsOperatorOrOperand()){var W=U.getLastOperator();var Z=W.length;var Y=(W.length>0)?ad.substr(U.getLastOperatorStartIndex()):null;var ai=(af.isEmptyOnlyOperator(U.getLastOperator()))?t:R;var ac=af.getSuggestionsForOperators(Y,F);if(Z>0){var ab=W.length-(W.replace(/\s+/g,"")).length;U.setLastOperandStartIndex(U.getLastOperatorStartIndex()+Z+ab+1)}if(ac&&ac.length>0){var ag=U.getTokens();var ah=af.incompleteOperator();af.prepareOperandSuggestions(true,U.getLastFieldName(),ai,ac,ah)}}else{if(U.getNeedsOperator()){af.renderSuggestionsForOperators(U.getLastOperator(),F)}else{if(U.getNeedsPredicateOperand()){var ak=U.getLastWasPredicate();af.preparePredicateSuggestions(ak,af.stripEscapeCharacters(U.getLastOperand()))}else{if(U.getNeedsLogicalOperator()){if(U.getNeedsWasPredicate()){if(U.getNeedsOrderBy()){var aj=(U.getLastOrderBy()===null)?U.getLastWasPredicate():U.getLastOrderBy();if(U.getLastOperator()=="was"){af.renderSuggestionsFromMap(aj,y,false)}else{af.renderSuggestionsFromMap(aj,v,false)}}else{if(U.getLastOperator()=="was"){af.renderSuggestionsFromMap(U.getLastWasPredicate(),k,false)}else{af.renderSuggestionsFromMap(U.getLastWasPredicate(),p,false)}}}else{if(U.getNeedsOrderBy()){var aj=(U.getLastOrderBy()===null)?U.getLastLogicalOperator():U.getLastOrderBy();af.renderSuggestionsFromMap(aj,x,false)}else{af.renderSuggestionsFromMap(U.getLastLogicalOperator(),o,false)}}}else{if(U.getNeedsOrderByField()){af.renderSuggestionsFromMap(af.stripEscapeCharacters(U.getLastOrderByFieldName()),P,true)}else{if(U.getNeedsOrderByDirection()){af.renderSuggestionsFromMap(U.getLastOrderByDirection(),s,false)}else{if(U.getNeedsOperand()){var al=U.getLastFieldName();var ae=false;if(!af.isEmptyOnlyOperator(U.getLastOperator())){for(var aa=0;aa<J.length;aa++){if(af.equalsIgnoreCase(U.getUnquotedString(J[aa].value),al)||(J[aa].cfid&&af.equalsIgnoreCase(J[aa].cfid,al))){ae=J[aa].auto;break}}}var ai=(af.isEmptyOnlyOperator(U.getLastOperator()))?t:R;af.prepareOperandSuggestions(ae,al,ai,{})}else{af.dropdownController.hideDropdown()}}}}}}}}af.parse(X)};N.stripEscapeCharacters=function(Y){if(Y==null){return Y}var V="";var X=Y.split("");for(var W=0;W<X.length;W++){if(X[W]=="\\"){if(!g.test(Y.substring(W,Y.length))){W++;if(W>=Y.length){break}}}V+=X[W]}return V};N.parse=function(W){var V=I.parse(W);N.updateParseIndicator(V);N.updateColumnLineCount();return V.getResult()};N.renderSuggestionsFromMap=function(W,Y,X,Z){if(!X){X={}}var V=N.slimListForMapResults(W,Y,Z);var aa=N.slimListForMapResults(W,X,Z);N.boldMatchingString(W,aa);N.boldMatchingString(W,V);N.renderSuggestions(V,aa);if(V.length===0&&aa.length===0){N.dropdownController.hideDropdown()}};N.getSuggestionsForOperators=function(W,Z){var V=N.slimListForMapResults(W,Z,false);var aa=U.getLastFieldName();var Y;for(var X=0;X<J.length;X++){if(N.equalsIgnoreCase(U.getUnquotedString(J[X].value),aa)||(J[X].cfid&&N.equalsIgnoreCase(J[X].cfid,aa))){Y=J[X].operators;break}}if(Y){V=jQuery.grep(V,function(ab){return jQuery.inArray(ab.value,Y)>-1})}N.boldMatchingString(W,V);return V};N.renderSuggestionsForOperators=function(W,X){var V=N.getSuggestionsForOperators(W,X);N.renderSuggestions(V);if(V.length===0){N.dropdownController.hideDropdown()}};N.renderSuggestionsForOperands=function(W,X,Z,V,aa){if(aa===Q){var Y=N.slimListForFunctionResults(W,Z,U.getLastOperator());N.boldMatchingString(W,Y);N.renderSuggestions(X,Y,V);if(X.length===0&&Y.length===0&&V.length==0){N.dropdownController.hideDropdown()}}};N.boldMatchingString=function(W,Z){if(W==null||Z.length===0){return}var aa=W.length;for(var X=0,ab=aa;X<ab;X++){switch(W.charAt(X)){case"<":case">":aa+=3;break;case"&":aa+=4;break;case'"':aa+=5;break}}for(var Y=0;Y<Z.length;Y++){if(Z[Y].displayName){var V=Z[Y].displayName;Z[Y]={value:Z[Y].value,displayName:"<b>"+V.substring(0,aa)+"</b>"+V.substring(aa)}}else{Z[Y]={value:Z[Y],displayName:"<b>"+Z[Y].substring(0,aa)+"</b>"+Z[Y].substring(aa)}}}};N.htmlEscape=function(W){if(W==null){return null}var V="";var Y=W.split("");for(var X=0;X<Y.length;X++){if(Y[X]==="<"){V+="&lt;"}else{if(Y[X]===">"){V+="&gt;"}else{if(Y[X]==="&"){V+="&amp;"}else{if(Y[X]==='"'){V+="&quot;"}else{V+=Y[X]}}}}}return V},N.getReplacementStartIndex=function(V,W){var X=jQuery(this.field);var Y;if(V.getNeedsField()){Y=V.getLastFieldNameStartIndex()}else{if(V.getNeedsOperatorOrOperand()){if(V.getNeedsOperator()&&N.isWasOperator(W)){Y=V.getLastOperatorStartIndex()}else{Y=V.getLastOperandStartIndex()}}else{if(V.getNeedsOperand()){Y=V.getLastOperandStartIndex()}else{if(V.getNeedsOperator()){Y=V.getLastOperatorStartIndex()}else{if(V.getNeedsOrderByField()){Y=V.getLastOrderByFieldNameStartIndex()}else{if(V.getNeedsOrderByDirection()){Y=V.getLastOrderByDirectionStartIndex()}else{if(V.getNeedsPredicateOperand()){Y=V.getLastOperandStartIndex()}else{if(V.getNeedsLogicalOperator()){if(V.getLastLogicalOperatorStartIndex()!==null&&V.getLastLogicalOperatorStartIndex()!==0){Y=V.getLastLogicalOperatorStartIndex()}else{if(V.getLastOrderBy()!==null&&V.getLastOrderByStartIndex()!==0){Y=V.getLastOrderByStartIndex()}else{if(V.getLastWasPredicate()!=null&&V.getLastWasPredicateStartIndex()!==0){Y=V.getLastWasPredicateStartIndex()}else{if(V.getMustBeOperatorOrPredicate()===true){Y=X.selectionRange().start}else{Y=X.selectionRange().start-1}}}}}else{if(V.getNeedsWasPredicate()){Y=V.getLastWasPredicateStartIndex()}else{Y=X.selectionRange().start-1}}}}}}}}}return Y!=null?Y:X.selectionRange().start};N.getReplacementEndIndex=function(ah,V){var ag=jQuery(this.field);var W=ag.selectionRange();var Z=null;if(W.start===W.end&&W.end!==this.field.val().length){var aa=ah.getTokens().length-1;var Y=I.parse(this.field.val());if(!Y.getParseError()){var X=Y.getResult().getTokens()[aa];if(X!==null&&X!=="("&&X!==")"){var af=this.field.val();var ac=af.substring(V,af.length);var ae=ac.split("");var ad=0;for(var ab=0;ab<ae.length;ab++){if(D.test(ae[ab])){ad++}else{break}}Z=V+X.length+ad}}}if(Z===null){Z=W.end}if(Z<V){N.replaceValue(V,Z," ");Z=V}return Z};N.replaceValue=function(Z,V,Y){var X=jQuery(this.field);X.selectionRange(Z,V);X.selection(Y);var W=X.selectionRange().end;X.selectionRange(W,W)};N.slimListForMapResults=function(V,Y,Z){var X=N.htmlEscape(V);var W=jQuery.grep(Y,function(aa){return N.startsWithIgnoreCaseNullsMeanAll(X,aa.displayName)});if(!Z){if(W.length===1&&!N.startsWithNotEqualsIgnoreCaseNullMeansAll(X,W[0].displayName)){return{}}}return W};N.slimListForFunctionResults=function(V,aa,X){var ab=U.getLastFieldName();var Z;for(var Y=0;Y<J.length;Y++){if(N.equalsIgnoreCase(U.getUnquotedString(J[Y].value),ab)||(J[Y].cfid&&N.equalsIgnoreCase(J[Y].cfid,ab))){Z=J[Y].types;break}}var W=jQuery.grep(aa,function(ac){if((ac.isList&&!N.isListSupportingOperator(X))||(!ac.isList&&N.isListSupportingOperator(X))){return false}if(Z){var ae=jQuery.inArray("java.lang.Object",ac.types)>-1||jQuery.inArray("java.lang.Object",Z)>-1;for(var ad=0;ad<Z.length&&!ae;ad++){ae=jQuery.inArray(Z[ad],ac.types)!==-1}if(!ae){return false}}else{return false}return N.startsWithIgnoreCaseNullsMeanAll(V,ac.value)||N.startsWithIgnoreCaseNullsMeanAll(V,ac.displayName)});if(W.length===1&&!N.startsWithNotEqualsIgnoreCaseNullMeansAll(V,W[0].displayName)){return{}}return W};N.slimListForPredicates=function(Y,ab,W){var V;var X;for(var aa=0;aa<n.length;aa++){if(N.equalsIgnoreCase(U.getUnquotedString(n[aa].value),W)){V=n[aa].type;X=n[aa].supportsList;break}}var Z=jQuery.grep(ab,function(ac){if(typeof ac.isList!="undefined"){if((ac.isList&&!!X)||(!ac.isList&&X)){return false}}var ad=jQuery.inArray(V,ac.types)!==-1;return ad?N.startsWithIgnoreCaseNullsMeanAll(Y,ac.value)||N.startsWithIgnoreCaseNullsMeanAll(Y,ac.displayName):false});if(Z.length===1&&!N.startsWithNotEqualsIgnoreCaseNullMeansAll(Y,Z[0].displayName)){return{}}return Z};N.predicateSupportsAutoComplete=function(V){var X;for(var W=0;W<n.length;W++){if(N.equalsIgnoreCase(U.getUnquotedString(n[W].value),V)){X=n[W].auto;break}}return X};N.isListSupportingOperator=function(V){return V==="in"||V==="not in"||V=="was not in"||V=="was in"};N.isEmptyOnlyOperator=function(V){return V==="is"||V==="is not"};N.isWasOperator=function(V){return V==="was"||V==="was in"||V=="was not in"||V=="was not"};N.isChangedOperator=function(V){return V==="changed"};N.startsWithIgnoreCaseNullsMeanAll=function(V,W){if(W===null||V===null){return true}if(W.length<V.length){return false}else{return V.toLowerCase()==W.substr(0,V.length).toLowerCase()}};N.startsWithNotEqualsIgnoreCaseNullMeansAll=function(V,Y){if(Y===null||V===null){return true}if(Y.length<V.length){return false}else{var W=V.toLowerCase()==Y.substr(0,V.length).toLowerCase();if(W){var X=null;if(z.test(Y.substr(V.length,Y.length))){X=Y.substr(0,V.length)}else{X=Y}return V.toLowerCase()!=X.toLowerCase()}return false}};N.equalsIgnoreCase=function(W,V){if(W===null&&V===null){return true}else{if(W===null||W===null){return false}else{return W.toLowerCase()===V.toLowerCase()}}};N.getSavedResponse=function(V){if(!this.requested){this.requested={}}return this.requested[V]};N.saveResponse=function(W,V){if(typeof W==="string"&&typeof V==="object"){if(!this.requested){this.requested={}}this.requested[W]=V}};N.startsWithIgnoreCase=function(V,W){if(W===null||V===null||W.length<V.length){return false}else{return V.toLowerCase()==W.substr(0,V.length).toLowerCase()}};N.updateParseIndicator=function(V){if(V.getParseError()){M.attr("title",V.getResult().getParseErrorMsg()).removeClass("jqlgood").addClass("jqlerror")}else{M.attr("title","").removeClass("jqlerror").addClass("jqlgood")}};N.updateColumnLineCount=function(){var aa=jQuery(N.field);var Z=0;if(N.field[0]===document.activeElement){var ab=aa.selectionRange();Z=ab.start}else{Z=N.field[0].value.length}var V=1;var X=1;var Y=N.field.val();for(var W=0;W<Z;W++){if(c.test(Y.charAt(W))){V++;X=1}else{X++}}K.text(X);S.text(V)};N.init(T);return N};JIRA.JQLAutoComplete.MyParser=function(J){var I=J;return{parse:function(K){var L=JIRA.JQLAutoComplete.Token();L.init(K);this.jql(L);return L},orderByClause:function(L){var M=L.remainingString();var N=M.match(l);if(N){var K=M.substring(0,N[0].length);L.consumeCharacters(K.length);L.getResult().setLastOrderBy(K,L);if(!L.isComplete()){M=L.remainingString();if(D.test(M)){this.chewWhitespace(L);this.orderByFields(L)}else{L.getResult().resetLogicalOperators();L.setParseError()}}else{L.getResult().resetLogicalOperators();L.setParseError()}}else{L.consumeCharacters(M.length);L.getResult().setLastOrderBy(M,L);L.setParseError()}},orderByFields:function(K){this.orderByField(K);this.chewWhitespace(K);if(K.isComplete()){if(!K.getResult().getNeedsOrderByField()){K.getResult().setLastOrderByDirection("",K)}}else{var L=K.remainingString();if(this.startsWithIgnoreCase(",",L)){K.consumeCharacter();this.orderByFields(K);this.chewWhitespace(K)}else{L=K.remainingString();if(L!==null){K.consumeCharacters(L.length)}K.getResult().setNeedsOrderByDirection();K.getResult().setLastOrderByDirection(L,K);K.setParseError()}}},orderByField:function(K){this.chewWhitespace(K);var M=this.fieldName(K);if(M.length!==0){K.getResult().setLastOrderByFieldName(M,K);var L=K.remainingString();if(!K.isComplete()&&!u.test(L)){if(r.test(L)){this.chewWhitespace(K);K.consumeCharacters(3);K.getResult().setLastOrderByDirection("asc",K);K.getResult().setNeedsOrderByComma()}else{if(H.test(L)){this.chewWhitespace(K);K.consumeCharacters(4);K.getResult().setLastOrderByDirection("desc",K);K.getResult().setNeedsOrderByComma()}else{K.getResult().setNeedsOrderByDirection()}}}else{K.getResult().setNeedsOrderByField();this.chewWhitespace(K)}}else{K.getResult().setLastOrderByFieldName("",K);K.getResult().setNeedsOrderByField();K.setParseError()}},jql:function(K){this.orClause(K);var L=K.remainingString();if(this.startsWithIgnoreCase("ord",L)){this.orderByClause(K)}},orClause:function(K){while(!K.isComplete()&&!this.startsWithIgnoreCase(")",K.remainingString())){this.chewWhitespace(K);var L=K.remainingString();if(this.startsWithIgnoreCase("ord",L)){break}if(K.getResult().getMustBeOperatorOrPredicate()){K.getResult().resetLastPredicates()}else{K.getResult().resetLogicalOperators();this.andClause(K)}if(!K.isComplete()&&K.getResult().getLastLogicalOperator()===null){if(K.getResult().getNeedsWasPredicate()){this.predicateClause(K)}if(K.isComplete()){return}L=K.remainingString();if(this.startsWithIgnoreCase("ord",L)){break}else{if(L!==null&&(A.test(L)||this.startsWithIgnoreCase("|",L)||this.startsWithIgnoreCase("||",L))){if(this.startsWithIgnoreCase("||",L)){K.getResult().setLastLogicalOperator("||",K.getTokenStringIdx());K.consumeCharacters(2)}else{if(A.test(L)){K.getResult().setLastLogicalOperator("OR",K.getTokenStringIdx());K.consumeCharacters(3)}else{K.getResult().setLastLogicalOperator("|",K.getTokenStringIdx());K.consumeCharacters(1)}}K.getResult().resetTerminalClause();if(K.isComplete()){K.setParseError()}K.getResult().setNeedsField()}else{if(!this.startsWithIgnoreCase(")",L)||!K.getInParens()){this.chewWhitespace(K);var N=(L===null)?K.getMaxTokenStringIdx():K.getMaxTokenStringIdx()-L.length;var M;if(L!=null){M=L.split(" ");K.getResult().setLastLogicalOperator(M[0],N);K.getResult().setLastWasPredicate(M[0],K);K.getResult().setNeedsLogicalOperator(K)}if(K.getResult().getLastWasOperator()==null){K.setParseError()}else{if(M!=null){if(j.test(M[0])){K.getResult().setLastLogicalOperator(null);K.getResult().resetNeedsPredicateOperand()}else{if(h.test(L)){K.consumeCharacters(4);K.getResult().resetTerminalClause();K.getResult().setNeedsField()}if(K.isComplete()||M.length==1){K.setParseError()}}}}}}}}}},andClause:function(K){this.chewWhitespace(K);this.notClause(K);if(!K.isComplete()&&K.getResult().getLastLogicalOperator()===null){this.chewWhitespace(K);var L=K.remainingString();if(L!==null&&(h.test(L)||this.startsWithIgnoreCase("&",L)||this.startsWithIgnoreCase("&&",L))){if(this.startsWithIgnoreCase("&&",L)){K.getResult().setLastLogicalOperator("&&",K.getTokenStringIdx());K.consumeCharacters(2)}else{if(this.startsWithIgnoreCase("&",L)){K.getResult().setLastLogicalOperator("&",K.getTokenStringIdx());K.consumeCharacters(1)}else{K.getResult().setLastLogicalOperator("AND",K.getTokenStringIdx());K.consumeCharacters(4)}}K.getResult().resetTerminalClause();if(K.isComplete()){K.setParseError()}K.getResult().setNeedsField()}else{K.getResult().setNeedsLogicalOperator(K);if(K.isComplete()){K.getResult().setLastLogicalOperator(null,K.getMaxTokenStringIdx())}}}},notClause:function(K){this.chewWhitespace(K);if(!K.isComplete()){this.chewWhitespace(K);var L=K.remainingString();if(L!==null&&(e.test(L)||this.startsWithIgnoreCase("!",L))){K.getResult().needsField=false;if(this.startsWithIgnoreCase("!",L)){K.getResult().setLastLogicalOperator("!",K.getTokenStringIdx());K.consumeCharacters(1)}else{K.getResult().setLastLogicalOperator("NOT",K.getTokenStringIdx());K.consumeCharacters(4)}K.getResult().resetTerminalClause();if(K.isComplete()){K.setParseError()}K.getResult().setNeedsField()}else{this.terminalClause(K)}}else{this.terminalClause(K);K.setParseError()}},predicateClause:function(K){this.chewWhitespace(K);if(!K.isComplete()){var L=K.remainingString();var M=L.split(/[\s(]+/);if(L!==null){K.getResult().setMustBeOperatorOrPredicate(false);if(this.startsWithLogicalOperator(L)){if(M.length==1){K.setParseError();K.getResult().resetLogicalOperators();return}return}K.getResult().resetNeedsPredicateOperand();K.consumeCharacters(M[0].length);K.getResult().setLastWasPredicate(M[0],K);if(M.length==1){K.setParseError();return}if(this.wasPredicateComplete(M[0])){K.getResult().setNeedsPredicateOperand();this.predicateOperand(K)}else{K.setParseError()}}}else{K.setParseError()}},predicateOperand:function(L){this.chewWhitespace(L);var K=this.collectPredicateOperands(L);if(K==null||K==""){L.getResult().setLastOperandStartIndex(L.getTokenStringIdx());L.setParseError()}if(L.remainingString()!=null){L.getResult().resetNeedsPredicateOperand();L.getResult().resetLastPredicates();L.getResult().setMustBeOperatorOrPredicate(true);L.getResult().setNeedsLogicalOperator(L);this.chewWhitespace(L)}},collectPredicateOperands:function(L){if(L.getResult().getLastWasPredicate()==="DURING"){L.getResult().setNeedsOpenParen(true)}var K=this.listOperand(L,true);if(K.length===0){K=this.functionOperand(L);if(K.length===0){K=this.singleValueOperand(L)}else{L.getResult().setNeedsOpenParen(false)}}else{L.getResult().setNeedsOpenParen(false)}return L.getResult().getUnquotedString(K)},terminalClause:function(M){M.getResult().resetTerminalClause();this.chewWhitespace(M);var N=M.remainingString();if(this.startsWithIgnoreCase("(",N)){M.getResult().addToken("(");M.setInParens();M.consumeCharacter();this.orClause(M);this.chewWhitespace(M);N=M.remainingString();if(this.startsWithIgnoreCase(")",N)){M.getResult().addToken(")");M.consumeCharacter();M.setOutOfParens();if(M.isComplete()){M.getResult().resetLogicalOperators();M.getResult().resetLastPredicates()}}else{M.setParseError()}}else{this.field(M);if(!M.isComplete()){this.oper(M);if(!M.isComplete()){if(M.getResult().getLastWasOperator()==="changed"){M.getResult().setNeedsLogicalOperator(M);return}this.operand(M);if(M.getResult().getOperandComplete()){var K=M.getResult().getLastWasOperator();M.getResult().setNeedsNothing();if(K){M.getResult().setLastWasOperator(K)}}else{if(M.isComplete()&&!M.getResult().getNeedsListComma()){M.getResult().setNeedsOperand()}}}else{if(M.getResult().getLastOperator()=="was"||M.getResult().getLastOperator()=="was not"){M.getResult().setNeedsOperandOrOperator()}else{if(M.getResult().getLastWasOperator()==="changed"){var L=M.currentCharacter();if(L!==null&&b.test(L)){M.getResult().setNeedsLogicalOperator(M)}else{M.getResult().resetLogicalOperators()}return}else{M.getResult().setNeedsOperator()}}M.setParseError()}}else{M.getResult().setNeedsField();M.setParseError()}}},field:function(K){var L=this.fieldName(K);if(L.length!==0){K.getResult().setLastFieldName(L,K)}else{if(K.getResult().getLastFieldName()===null){remainingString=K.remainingString();K.getResult().setNeedsField();K.getResult().setLastFieldName(remainingString,K);K.setParseError()}}},fieldName:function(M){this.chewWhitespace(M);var O=M.remainingString();if(this.startsWithIgnoreCase("cf",O)){var L=M.getTokenStringIdx();var K=M.remainingString();M.consumeCharacters(2);this.chewWhitespace(M);O=M.remainingString();if(this.startsWithIgnoreCase("[",O)){M.consumeCharacter();O=M.remainingString();var N=this.numberValue(M);if(N.length!==0){this.chewWhitespace(M);O=M.remainingString();if(this.startsWithIgnoreCase("]",O)){M.consumeCharacter();return K.substring(0,M.getTokenStringIdx()-L)}}}M.setParseError();return K}else{return this.fieldOrFunctionName(M)}},oper:function(M){this.chewWhitespace(M);var N=M.remainingString();var L=this.getLongestOperatorMatch(N,F);if(L!==null){M.getResult().setLastOperator(L,M.getTokenStringIdx());if(this.isWasOperator(L)||this.isChangedOperator(L)){M.getResult().setLastWasOperator(L)}M.consumeCharacters(L.length);if(L=="in"||L=="is"||L=="is not"||L=="not in"||L=="was"||L=="was not"||L=="was in"||L=="was not in"){var K=M.currentCharacter();if(K!==null&&!b.test(K)){M.setParseError()}}if(L=="was"){M.getResult().setNeedsOperandOrOperator();this.chewWhitespace(M);var N=M.remainingString();if(N!=null&&(q.test(N)||B.test(N))){M.setParseError()}}else{if(L=="was not"){M.getResult().setNeedsOperandOrOperator();this.chewWhitespace(M);var N=M.remainingString();if(N!=null&&(B.test(N))){M.setParseError()}}else{if(L=="changed"){M.getResult().setNeedsLogicalOperator(M)}else{M.getResult().setNeedsOperand()}}}}else{if(M.getResult().getLastOperator()===null){var O=(N===null)?M.getMaxTokenStringIdx():M.getMaxTokenStringIdx()-N.length;M.getResult().setLastOperator(N,O);M.getResult().setNeedsOperator();M.setParseError()}}},operand:function(L){this.chewWhitespace(L);if(L.getResult().getLastOperator()==="in"||L.getResult().getLastOperator()==="not in"||L.getResult().getLastOperator()==="was not in"||L.getResult().getLastOperator()==="was in"){L.getResult().setNeedsOpenParen(true)}var K=this.listOperand(L,true);if(K.length===0){K=this.functionOperand(L);if(K.length===0){K=this.singleValueOperand(L)}else{L.getResult().setNeedsOpenParen(false)}}else{L.getResult().setNeedsOpenParen(false)}if(K===null||K.length===0){var M=L.remainingString();L.getResult().setLastOperand(M,L);L.getResult().setNeedsOperand();L.setParseError()}if(K.length!==0){return K}return""},singleValueOperand:function(L){var K=this.stringValue(L);if(K.length!==0){L.getResult().setLastOperand(K,L);if(K.toLowerCase()!="empty"&&K.toLowerCase()!="null"&&this.isReservedWord(K.toLowerCase())){L.setParseError()}return K}return""},functionOperand:function(N){var M=N.getTokenStringIdx();var O=this.fieldOrFunctionName(N);this.chewWhitespace(N);var L=this.listOperand(N,false);if(O.length!==0&&L.length!==0){var K=O+L;N.getResult().setLastOperand(K,N);return K}else{N.backTrackToIdx(M);return""}},listOperand:function(L,M){if(L.currentCharacter()=="("){L.consumeCharacter();var K=this.collectListValues(L,M);var N="("+K;this.chewWhitespace(L);if(L.currentCharacter()==")"){L.consumeCharacter();N+=")";if(N=="()"&&M){L.getResult().setLastOperand(N,L)}if(M){L.getResult().setOperandComplete();L.getResult().resetNeedsPredicateOperand()}}else{L.setParseError()}return N}else{return""}},collectListValues:function(M,N){if(N){M.getResult().setNeedsOperand()}this.chewWhitespace(M);var K=(N)?this.operand(M):this.stringValue(M);if(K.length!==0){if(this.chewWhitespace(M)&&N){M.getResult().setNeedsListComma()}if(M.currentCharacter()==","){M.consumeCharacter();var L=this.collectListValues(M,N);if(L.length===0){M.setParseError()}return K+", "+L}else{return K}}else{return""}},startsWithIgnoreCase:function(K,L){if(L===null||K===null||L.length<K.length){return false}else{return K.toLowerCase()==L.substr(0,K.length).toLowerCase()}},startsWithLogicalOperator:function(K){if(K===null){return false}else{return this.startsWithOr(K)||this.startsWithAnd(K)||this.startsWithNot(K)||this.startsWithBraces(K)}},startsWithOr:function(K){return this.startsWithIgnoreCase("|",K)||this.startsWithIgnoreCase("||",K)||this.startsWithIgnoreCase("or",K)},startsWithAnd:function(K){return this.startsWithIgnoreCase("&",K)||this.startsWithIgnoreCase("&&",K)||this.startsWithIgnoreCase("and",K)},startsWithNot:function(K){return this.startsWithIgnoreCase("!",K)||this.startsWithIgnoreCase("not",K)},startsWithBraces:function(K){return this.startsWithIgnoreCase("(",K)||this.startsWithIgnoreCase(")",K)},chewWhitespace:function(M){var L=false;var K=M.currentCharacter();while(K!==null&&D.test(K)){M.consumeCharacter();K=M.currentCharacter();L=true}return L},getLongestOperatorMatch:function(O,K){var L=null;if(this.startsWithIgnoreCase("is",O)){var N=O.substring(2).match(w);if(N){L=O.substring(0,N[0].length+2)}else{L="is"}}if(this.startsWithIgnoreCase("was",O)){var N=O.substring(3).match(m);if(N){L=O.substring(0,N[0].length+3)}else{L="was"}}else{if(this.startsWithIgnoreCase("not",O)){var P=O.substring(3).match(d);if(P){L=O.substring(0,P[0].length+3)}}else{for(var M=0;M<K.length;M++){if(this.startsWithIgnoreCase(K[M].value,O)){if(L===null||F[M].value.length>L){L=F[M].value}}}}}return L},getValueMinusExtraWhitespace:function(N){if(N===null){return null}var O="";var P=true;var L=N.split("");for(var M=0;M<L.length;M++){var K=L[M];if(D.test(K)){if(P){P=false;O=O+K}}else{P=true;O=O+K}}return O},fieldOrFunctionName:function(L){var K=this.stringValue(L);if(K==='""'||K==="''"){L.setParseError()}if(this.isReservedWord(K.toLowerCase())){L.setParseError()}return K},isReservedWord:function(K){return jQuery.inArray(K,I)!==-1},isWasOperator:function(K){return K==="was"||K==="was in"||K=="was not in"||K=="was not"},isChangedOperator:function(K){return K==="changed"},stringValue:function(M){var K="";var P=false;var N=false;var L=M.currentCharacter();while(L!==null&&(P||N||G.test(L))){K=K+L;M.consumeCharacter();if(L=="\\"){L=M.currentCharacter();if(L===null){M.setParseError();break}else{if(C.test(L)){var O=M.remainingString();if(!g.test(O)){M.setParseError();break}}}K=K+L;M.consumeCharacter()}else{if(f.test(L)&&!(P||N)){M.setParseError();break}else{if(L=='"'&&!N){P=!P}else{if(L=="'"&&!P){N=!N}}}}L=M.currentCharacter()}if(M.isComplete()&&(P||N)){M.setParseError()}return K},numberValue:function(L){var M="";this.chewWhitespace(L);var K=L.currentCharacter();while(K!==null){if(a.test(K)){M=M+K;L.consumeCharacter()}else{break}K=L.currentCharacter()}return M},wasPredicateComplete:function(L){var O=false;var N=n.length;for(var M=0,K=N;M<K;++M){if(L.toLowerCase()==n[M].value.toLowerCase()){O=true;break}}return O}}};JIRA.JQLAutoComplete.ParseResult=function(){var J=[];var I=0;return{getTokens:function(){return J},addToken:function(K){J[I++]=K},setLastFieldName:function(L,K){this.fieldNameStartIndex=(L===null)?K.getMaxTokenStringIdx():(K.getTokenStringIdx()-L.length);this.lastFieldName=this.getUnquotedString(L);J[I++]=L},getLastFieldName:function(){return this.lastFieldName},getLastFieldNameStartIndex:function(){return this.fieldNameStartIndex},setLastOrderByFieldName:function(L,K){this.orderByFieldNameStartIndex=(L===null)?K.getMaxTokenStringIdx():(K.getTokenStringIdx()-L.length);this.lastOrderByFieldName=this.getUnquotedString(L);this.lastOrderByDirection=null;J[I++]=L},getLastOrderByFieldName:function(){return this.lastOrderByFieldName},getLastOrderByFieldNameStartIndex:function(){return this.orderByFieldNameStartIndex},setLastOrderByDirection:function(L,K){this.orderByDirectionStartIndex=(L===null)?K.getMaxTokenStringIdx():(K.getTokenStringIdx()-L.length);this.lastOrderByDirection=L;J[I++]=L},getLastOrderByDirection:function(){return this.lastOrderByDirection},getLastOrderByDirectionStartIndex:function(){return this.orderByDirectionStartIndex},setNeedsField:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=true;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false;this.needsWasPredicate=false;this.lastWasOperator=null},getNeedsField:function(){return this.needsField},setNeedsOrderByField:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=true;this.needsOrderByDirection=false;this.lastOrderByDirection=null;this.needsListComma=false},getNeedsOrderByField:function(){return this.needsOrderByField},setNeedsOrderByDirection:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=true;this.needsListComma=false},getNeedsOrderByDirection:function(){return this.needsOrderByDirection},setNeedsOrderByComma:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},setNeedsListComma:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=true},getNeedsListComma:function(){return this.needsListComma},setLastOperator:function(K,L){this.lastOperator=K;this.operatorStartIndex=L;J[I++]=K},setLastWasOperator:function(K){this.lastWasOperator=K},getLastWasOperator:function(){return this.lastWasOperator},getLastOperator:function(){return this.lastOperator},getLastOperatorStartIndex:function(){return this.operatorStartIndex},setLastOperand:function(L,K){this.operandStartIndex=(L===null)?K.getMaxTokenStringIdx():(K.getTokenStringIdx()-L.length);this.lastOperand=this.getUnquotedString(L);J[I++]=L},getLastOperand:function(){return this.lastOperand},setNeedsOperand:function(){this.needsField=false;this.needsOperator=false;this.needsLogicalOperator=false;this.needsOperand=true;this.needsOrderBy=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},setNeedsOperandOrOperator:function(){this.needsField=false;this.needsOperator=true;this.needsLogicalOperator=false;this.needsOperand=true;this.needsOrderBy=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},getNeedsOperand:function(){return this.needsOperand},setNeedsPredicateOperand:function(){this.needsPredicateOperand=true},resetNeedsPredicateOperand:function(){this.needsPredicateOperand=false;this.needsOperand=false},getNeedsPredicateOperand:function(){return this.needsPredicateOperand},getLastOperandStartIndex:function(){return this.operandStartIndex},setLastOperandStartIndex:function(K){this.operandStartIndex=K},setLastLogicalOperator:function(K,L){this.lastLogicalOperator=K;this.logicalOperatorStartIndex=L;J[I++]=K},setNeedsOperator:function(){this.needsField=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsOperator=true;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},getNeedsOperatorOrOperand:function(){return this.needsOperator&&this.needsOperand},getNeedsOperator:function(){return this.needsOperator},getLastLogicalOperator:function(){return this.lastLogicalOperator},getLastLogicalOperatorStartIndex:function(){return this.logicalOperatorStartIndex},setNeedsLogicalOperator:function(K){this.needsLogicalOperator=true;this.needsOperator=false;this.needsOperand=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false;this.needsOrderBy=!K.getInParens();if(this.lastWasOperator!=null){this.needsWasPredicate=true}},setNeedsOpenParen:function(K){this.needsOpenParen=K},getNeedsOpenParen:function(){return this.needsOpenParen},getNeedsLogicalOperator:function(){return this.needsLogicalOperator},getNeedsOrderBy:function(){return this.needsOrderBy},getNeedsWasPredicate:function(){return this.needsWasPredicate},setLastWasPredicate:function(K,L){this.wasPredicateStartIndex=(K===null)?L.getMaxTokenStringIdx():(L.getTokenStringIdx()-K.length);this.lastWasPredicate=K;J[I++]=K},getLastWasPredicate:function(){return this.lastWasPredicate},resetLastPredicates:function(){this.lastLogicalOperator=null;this.lastWasPredicate=null;this.lastOperand=null;this.wasPredicateStartIndex=null;this.operandStartIndex=null},getLastWasPredicateStartIndex:function(){return this.wasPredicateStartIndex},setLastOrderBy:function(L,K){this.orderByStartIndex=(L===null)?K.getMaxTokenStringIdx():(K.getTokenStringIdx()-L.length);this.lastOrderBy=L;J[I++]=L},getLastOrderBy:function(){return this.lastOrderBy},getLastOrderByStartIndex:function(){return this.orderByStartIndex},resetLogicalOperators:function(){this.lastLogicalOperator=null;this.logicalOperatorStartIndex=null;this.needsLogicalOperator=null},getUnquotedString:function(K){var L=K!=null&&K.length>=3&&K.charAt(K.length-2)!="\\";if(K!=null&&K.charAt(0)=='"'){K=K.substring(1,K.length);if(K.charAt(K.length-1)=='"'&&L){K=K.substring(0,K.length-1)}}else{if(K!=null&&K.charAt(0)=="'"){K=K.substring(1,K.length);if(K.charAt(K.length-1)=="'"&&L){K=K.substring(0,K.length-1)}}}return K},setParseError:function(K){this.parseError=true;this.parseErrorMsg=K},getParseError:function(){return this.parseError},getParseErrorMsg:function(){return this.parseErrorMsg},setNeedsNothing:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsOpenParen=false;this.needsListComma=false;this.needsWasPredicate=null;this.needsPredicateOperand=null;this.mustBeOperatorOrPredicate=null;this.lastWasOperator=null},setOperandComplete:function(){this.operandComplete=true},getOperandComplete:function(){return this.operandComplete},setMustBeOperatorOrPredicate:function(K){this.mustBeOperatorOrPredicate=K},getMustBeOperatorOrPredicate:function(){return this.mustBeOperatorOrPredicate},resetTerminalClause:function(){this.lastFieldName=null;this.fieldNameStartIndex=null;this.needsField=null;this.lastOperator=null;this.operatorStartIndex=null;this.needsOperator=null;this.lastOperand=null;this.operandStartIndex=null;this.needsOperand=null;this.operandComplete=null;this.needsOpenParen=null;this.needsListComma=false;this.mustBeOperatorOrPredicate=null},init:function(){this.lastFieldName=null;this.fieldNameStartIndex=null;this.needsField=null;this.lastOperator=null;this.operatorStartIndex=null;this.needsOperator=null;this.lastOperand=null;this.operandStartIndex=null;this.needsOperand=null;this.lastLogicalOperator=null;this.logicalOperatorStartIndex=null;this.lastOrderByFieldName=null;this.lastOrderByFieldNameStartIndex=null;this.lastOrderByDirection=null;this.lastOrderByDirectionStartIndex=null;this.orderByStartIndex=null;this.lastOrderBy=null;this.needsOrderBy=null;this.needsOrderByField=null;this.needsOrderByDirection=null;this.operandComplete=null;this.needsOpenParen=null;this.needsListComma=null;this.wasPredicateStartIndex=null;this.lastWasPredicate=null;this.needsWasPredicate=null;this.needsPredicateOperand=null;this.mustBeOperatorOrPredicate=null;this.lastWasOperator=null}}};JIRA.JQLAutoComplete.Token=function(){return{init:function(I){this.tokenStringIdx=0;this.tokenString=I;this.parseError=false;this.parseErrorMsg=null;this.result=JIRA.JQLAutoComplete.ParseResult();this.result.init();this.inParens=0},consumeCharacter:function(){this.tokenStringIdx++},consumeCharacters:function(I){this.tokenStringIdx=this.tokenStringIdx+I},backTrackToIdx:function(I){this.tokenStringIdx=I;this.parseError=false;this.parseErrorMsg=null;this.result.parseError=false;this.result.parseErrorMsg=null},getTokenStringIdx:function(){return this.tokenStringIdx},currentCharacter:function(){if(this.tokenStringIdx>=this.tokenString.length){return null}return this.tokenString.charAt(this.tokenStringIdx)},remainingString:function(){if(this.tokenStringIdx>=this.tokenString.length){return null}return this.tokenString.substr(this.tokenStringIdx,this.tokenString.length)},getMaxTokenStringIdx:function(){return this.tokenString.length},isComplete:function(){if(this.parseError){return true}return this.tokenStringIdx>=this.tokenString.length},setInParens:function(){this.inParens++},setOutOfParens:function(){if(this.inParens!==0){this.inParens--}},getInParens:function(){return this.inParens!==0},setParseError:function(){this.parseError=true;var J=((this.tokenStringIdx-9)<0)?0:this.tokenStringIdx-9;var I=this.tokenString.substring(J,this.tokenStringIdx-1);this.result.setParseError("..."+I+"^"+this.tokenString.substring(this.tokenStringIdx,this.tokenString.length))},getParseError:function(){return this.parseError},getResult:function(){return this.result}}};jQuery(function(){jQuery(".jql-autocomplete-params").each(function(){var N={};jQuery(this).find("input").each(function(){var O=jQuery(this);N[O.attr("id")]=O.val()});var K=JSON.parse(jQuery("#jqlFieldz").text());var L=JSON.parse(jQuery("#jqlFunctionNamez").text());var M=JSON.parse(jQuery("#jqlReservedWordz").text());var J=JIRA.JQLAutoComplete({fieldID:"jqltext",parser:JIRA.JQLAutoComplete.MyParser(M),queryDelay:0.65,jqlFieldNames:K,jqlFunctionNames:L,minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:false,errorID:"jqlerrormsg"});var I=jQuery("#jqltext");I.unbind("keypress",submitOnEnter).keypress(function(O){if(J.dropdownController===null||!J.dropdownController.displayed||J.selectedIndex<0){if(O.keyCode==13&&!O.ctrlKey&&!O.shiftKey){jQuery("#jqlform").submit();return false}else{return true}}});J.buildResponseContainer();J.parse(I.text());J.updateColumnLineCount();I.click(function(){J.dropdownController.hideDropdown()})})})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/timeline-event-content.soy' */
// This file was automatically generated from timeline-event-content.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.timelineEventContentSingleInvitee = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="user-icon-container"><img class="user-icon" src="', soy.$$escapeHtml(opt_data.iconUrl), '" data-event-id="', soy.$$escapeHtml(opt_data.eventId), '"><span class="single_person">', soy.$$escapeHtml(opt_data.title), '</span></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.timelineEventContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="timeline-event-content-container">');
  Confluence.TeamCalendars.Templates.iconEventTimelinePrinting({eventType: opt_data.iconClass}, output);
  output.append('<div class="event-content-with-icon ', soy.$$escapeHtml(opt_data.iconClass), '-icon" data-event-id="', soy.$$escapeHtml(opt_data.eventId), '">', soy.$$escapeHtml(opt_data.title), '</div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.timelineEventContentWithEventTypeIcon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="timeline-event-content-container ', soy.$$escapeHtml(opt_data.className), '">');
  Confluence.TeamCalendars.Templates.iconEventTimelinePrinting({eventType: opt_data.className}, output);
  output.append('<div class="event-content" data-event-id="', soy.$$escapeHtml(opt_data.eventId), '">', soy.$$escapeHtml(opt_data.title), '</div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.defaultTimelineEventContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="timeline-event-content-container"><span data-event-id="', soy.$$escapeHtml(opt_data.eventId), '">', soy.$$escapeHtml(opt_data.title), '</span></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/add-dialog.soy' */
// This file was automatically generated from add-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.addDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="add-calendar subcalendar-wizard"><div><ul class="add-calendar-options"><li class="option-new"><div class="title">', soy.$$escapeHtml("Add New Calendar"), '</div></li><li class="option-import"><div class="title">', soy.$$escapeHtml("Import Calendar"), '</div></li></ul><ul class="add-calendar-options"><li class="option-existing"><div class="title">', soy.$$escapeHtml("Add Existing Calendar"), '</div></li><li class="option-subscription"><div class="title">', soy.$$escapeHtml("Subscribe by URL"), '</div></li></ul></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/calendar-subscribe-dialog.soy' */
// This file was automatically generated from calendar-subscribe-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.subscribeDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="subscribe-to-subcalendar"><div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml("Error(s) occurred."), '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="mode"><div id="tc-subscribe-no-search-warning" class="hidden loading"><span>', soy.$$escapeHtml("The version of Confluence you are using does not allow calendars to be searched. Here is a list of all calendars you may subscribe to."), '</span><img src="', soy.$$escapeHtml(""), '/images/icons/wait.gif" class="spinner"></div><div class="preamble"><span id="subscribe-intro"></span><img src="', soy.$$escapeHtml(""), '/images/icons/wait.gif" class="spinner"></div><div class="search"><form class="aui"><textarea name="query" class="textarea" rows="1"></textarea></form><img class="spinner" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"></div></div></div><div class="results"></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-delete-confirm-dialog.soy' */
// This file was automatically generated from event-delete-confirm-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.confirmEventDelete = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml("Are you sure? This cannot be undone"), '</p>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-delete-recurring-confirm-dialog.soy' */
// This file was automatically generated from event-delete-recurring-confirm-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.confirmRecurringEventDelete = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="delete-recurring-event-options"><li><input type="button" value="', soy.$$escapeHtml("This instance only"), '" class="delete-this-instance-only delete-button aui-button"><span class="delete-description">', soy.$$escapeHtml("All other events in this series will remain unchanged."), '</span></li><li><input type="button" value="', soy.$$escapeHtml("All future instances"), '" class="delete-future-instances-only delete-button aui-button"><span class="delete-description">', soy.$$escapeHtml("This and all future instances will be removed."), '</span></li><li class="last-delete-option"><input type="button" value="', soy.$$escapeHtml("All in the series"), '" class="delete-all-instances delete-button aui-button"><span class="delete-description">', soy.$$escapeHtml("The entire series will be removed."), '</span></li></ul>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-edit-dialog.soy' */
// This file was automatically generated from event-edit-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventEdit = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="event-edit" class="aui event-edit" method="POST" action="#"><input type="hidden" name="uid" value=""><input type="hidden" name="originalStartDate" value=""><input type="hidden" name="originalSubCalendarId" value=""><div class="event-type subcalendar-event"><div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml("Error(s) occurred."), '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="field-group field-group-calendar"><label for="calendar">', soy.$$escapeHtml("Calendar"), '<span class="aui-icon icon-required"></span></label><select name="calendar" id="calendar" class="sub-calendar-select select"></select></div><div class="field-group field-group-event-type"><label for="event-type">', soy.$$escapeHtml("Event Type"), '<span class="aui-icon icon-required"></span></label><select name="event-type" id="event-type" class="event-type-select select"></select><div class="error type-error"></div></div><div id="event-fields-container"></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-popup-issue.soy' */
// This file was automatically generated from event-popup-issue.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventPopupIssue = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="event-field labeled-field field-jira-date"><span class="field-label">', soy.$$escapeHtml("What"), ':</span><div class="field-value">', soy.$$escapeHtml(opt_data.event.extraProperties.dateField), '</div></div><div class="event-field labeled-field field-jira-assignee"><span class="field-label">', soy.$$escapeHtml("Assignee"), ':</span><div class="field-value', (opt_data.event.extraProperties.assigneeProfileUrl) ? ' assignee-with-link' : '', '"><span class="plain-assignee-name">', soy.$$escapeHtml(opt_data.event.extraProperties.assigneeName), '</span>', (opt_data.event.extraProperties.assigneeProfileUrl) ? '<a class="assignee-profile-link" href="' + soy.$$escapeHtml(opt_data.event.extraProperties.assigneeProfileUrl) + '">' + soy.$$escapeHtml(opt_data.event.extraProperties.assigneeName) + '</a>' : '', '</div></div><div class="event-field labeled-field field-jira-status"><span class="field-label">', soy.$$escapeHtml("Status"), ':</span><div class="field-value">', soy.$$escapeHtml(opt_data.event.extraProperties.statusText), '</div></div><div class="event-field field-duration"><div class="time"></div><div class="day-duration">', (opt_data.event.extraProperties.resolved == 'true') ? soy.$$escapeHtml(opt_data.event.localizedEndDate) : soy.$$escapeHtml(opt_data.event.extraProperties.jiraIssueDisplayDayDuration), '</div></div><div class="event-field field-event-links edit-controls"><a class="event-edit edit-control" href="#">', soy.$$escapeHtml("Edit"), '</a> <span class="event-hyperlink-separator">&middot;</span> <a href="', soy.$$escapeHtml(opt_data.event.extraProperties.issueLink), '" class="event-hyperlink" target="_blank">', soy.$$escapeHtml("View Issue"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-popup-version.soy' */
// This file was automatically generated from event-popup-version.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventPopupVersion = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="event-field field-duration"><div class="time"></div><div class="day-duration">', (opt_data.event.extraProperties.resolved == 'true') ? soy.$$escapeHtml(opt_data.event.localizedEndDate) : soy.$$escapeHtml(opt_data.event.extraProperties.jiraVersionDisplayDayDuration), '</div></div><div class="event-field field-event-links edit-controls"><a class="event-edit edit-control" href="#">', soy.$$escapeHtml("Edit"), '</a> <span class="event-hyperlink-separator">&middot;</span> <a href="', soy.$$escapeHtml(opt_data.event.extraProperties.summaryLink), '" class="event-hyperlink" target="_blank">', soy.$$escapeHtml("Summary"), '</a> <span class="event-hyperlink-separator">&middot;</span> <a href="', soy.$$escapeHtml(opt_data.event.extraProperties.viewIssuesLink), '" class="event-hyperlink" target="_blank">', soy.$$escapeHtml("View Issues"), '</a> <span class="event-hyperlink-separator">&middot;</span> <a href="', soy.$$escapeHtml(opt_data.event.extraProperties.releaseNotesLink), '" class="event-hyperlink" target="_blank">', soy.$$escapeHtml("Release Notes"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-popup-sprint.soy' */
// This file was automatically generated from event-popup-sprint.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventPopupSprint = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="event-field field-duration"><div class="time"></div><div class="all-day-label">', soy.$$escapeHtml("All day"), '</div></div><div class="event-field field-event-links"><div class="', (opt_data.event.extraProperties.sprintHomePageUrl) ? 'with-sprint-homepage' : 'no-sprint-homepage', '"><a href="', soy.$$escapeHtml(opt_data.event.extraProperties.viewBoardsUrl), '" class="event-hyperlink" target="_blank">', soy.$$escapeHtml("View Sprint"), '</a>', (opt_data.event.extraProperties.sprintHomePageUrl) ? '<span class="sprintHomePageUrlContainer"> &middot; <a href="' + soy.$$escapeHtml(opt_data.event.extraProperties.sprintHomePageUrl) + '" class="event-hyperlink" target="_blank">' + soy.$$escapeHtml("Sprint Home Page") + '</a></span>' : '', '</div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/event-popup.soy' */
// This file was automatically generated from event-popup.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.eventPopup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="event-details-popup ', soy.$$escapeHtml(opt_data.contextClass), '"><div class="', soy.$$escapeHtml(opt_data.event.className), '"><div class="event-icon-container"><img class="event-icon" src="', soy.$$escapeHtml(opt_data.event.iconUrl), '"></div><div class="event-fields"><div class="event-field field-subcalendar-name"><span class="lozenge ', soy.$$escapeHtml(opt_data.event.colour), '">', soy.$$escapeHtml(opt_data.event.subCalendarDisplayName), '</span><div class="name"><a href="', soy.$$escapeHtml(opt_data.baseUrl), '/calendar/previewcalendar.action?subCalendarId=', soy.$$escapeHtml(opt_data.event.subCalendarId), '">', soy.$$escapeHtml(opt_data.event.subCalendarDisplayName), '</a></div></div><div class="event-field field-summary">', soy.$$escapeHtml(opt_data.event.title), '</div>', (opt_data.event.where) ? '<div class="event-field field-location">' + soy.$$escapeHtml(opt_data.event.where) + '</div>' : '');
  if (opt_data.event.inviteesSupported && opt_data.event.invitees && opt_data.event.invitees.length > 1) {
    output.append('<div class="event-field field-invitees">');
    var inviteeList30 = opt_data.event.invitees;
    var inviteeListLen30 = inviteeList30.length;
    for (var inviteeIndex30 = 0; inviteeIndex30 < inviteeListLen30; inviteeIndex30++) {
      var inviteeData30 = inviteeList30[inviteeIndex30];
      output.append('<img class="invitee" src="', soy.$$escapeHtml(inviteeData30.avatarIconUrl), '" title="', soy.$$escapeHtml(inviteeData30.displayName), '">');
    }
    output.append('</div>');
  }
  if (opt_data.event.workingUrl) {
    output.append('<div class="event-field field-link">');
    var eventLink__soy41 = new soy.StringBuilder((! opt_data.event.urlAlias) ? soy.$$escapeHtml(opt_data.event.workingUrl) : soy.$$escapeHtml(opt_data.event.urlAlias));
    eventLink__soy41 = eventLink__soy41.toString();
    output.append('<a class="event-link" href="', soy.$$escapeHtml(opt_data.event.workingUrl), '" title="', soy.$$escapeHtml(eventLink__soy41), '">', soy.$$escapeHtml(eventLink__soy41), '</a></div>');
  }
  output.append((opt_data.event.description) ? '<div class="event-field field-description">' + ((opt_data.event.descriptionRendered) ? opt_data.event.descriptionRendered : soy.$$escapeHtml(opt_data.event.description)) + '</div>' : '');
  if (opt_data.event.extraPropertiesTemplate) {
    output.append('<div class="extra-fields">');
    switch (opt_data.event.extraPropertiesTemplate) {
      case 'event-details-version':
        Confluence.TeamCalendars.Templates.eventPopupVersion(opt_data, output);
        break;
      case 'event-details-issue':
        Confluence.TeamCalendars.Templates.eventPopupIssue(opt_data, output);
        break;
      case 'event-details-sprint':
        Confluence.TeamCalendars.Templates.eventPopupSprint(opt_data, output);
        break;
    }
    output.append('</div>');
  }
  output.append('<div class="event-field field-duration"><div class="time"></div><div class="all-day-label">', soy.$$escapeHtml("All day"), '</div></div><div class="event-field field-event-links edit-controls"><a class="event-edit edit-control" href="#">', soy.$$escapeHtml("Edit"), '</a> <span class="event-hyperlink-separator">&middot;</span> <a class="event-delete edit-control" href="#">', soy.$$escapeHtml("Delete"), '</a></div></div></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/upcoming-events.soy' */
// This file was automatically generated from upcoming-events.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.upcomingEvents = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dashboard-calendar"><div class="events-container"><ul class="group-list">');
  var eventGroupList4 = opt_data.eventGroups;
  var eventGroupListLen4 = eventGroupList4.length;
  for (var eventGroupIndex4 = 0; eventGroupIndex4 < eventGroupListLen4; eventGroupIndex4++) {
    var eventGroupData4 = eventGroupList4[eventGroupIndex4];
    output.append('<li class="event-group"><div class="group-details-container"><div class="group-details"><div class="group-headline', (eventGroupData4.today == true) ? ' today-headline' : '', '"><span class="other-days" data-group-date="', soy.$$escapeHtml(eventGroupData4.dateFormatKey), '">', soy.$$escapeHtml("Formatting..."), '</span><span class="today">', soy.$$escapeHtml("Today"), '</span></div><ul class="events">');
    var eventList16 = eventGroupData4.events;
    var eventListLen16 = eventList16.length;
    for (var eventIndex16 = 0; eventIndex16 < eventListLen16; eventIndex16++) {
      var eventData16 = eventList16[eventIndex16];
      output.append('<li data-event-id="', soy.$$escapeHtml(eventData16.id), '" data-sub-calendar-name="', soy.$$escapeHtml(eventData16.subCalendar.name), '"><div class="event-details"><div class="event-subcalendar ', soy.$$escapeHtml(eventData16.subCalendar.color), '" title="', soy.$$escapeHtml(eventData16.subCalendar.name), '"></div>', (eventData16.mediumIconUrl) ? '<img class="event-icon" src="' + soy.$$escapeHtml(eventData16.mediumIconUrl) + '">' : '<img class="event-icon" src="' + soy.$$escapeHtml(eventData16.iconUrl) + '">', '<strong class="event-name">', soy.$$escapeHtml(eventData16.title), '</strong><span class="event-subcalendar-name">', (eventData16.parentSubCalendar) ? soy.$$escapeHtml(eventData16.parentSubCalendar.name) : soy.$$escapeHtml(eventData16.subCalendar.name), '</span><div class="event-description">', (eventData16.descriptionRendered) ? '<span class="ellipsis_text">' + eventData16.descriptionRendered + '</span>' : (eventData16.description) ? '<span class="ellipsis_text">' + soy.$$escapeHtml(eventData16.description) + '</span>' : '', '</div></div><div class="clear"></div>', (eventIndex16 == eventListLen16 - 1) ? (0 < eventGroupData4.hiddenEventsCount) ? (1 < eventGroupData4.hiddenEventsCount) ? '<div class="x-more-events">' + soy.$$escapeHtml(AJS.format("And {0} more events...",eventGroupData4.hiddenEventsCount)) + '</div>' : '<div class="x-more-events">' + soy.$$escapeHtml(AJS.format("And {0} more event...",eventGroupData4.hiddenEventsCount)) + '</div>' : '' : '', '</li>');
    }
    output.append('</ul></div></div><div class="group-date', (eventGroupData4.today) ? ' first-group-date' : '', '"><div class="day" data-group-date="', soy.$$escapeHtml(eventGroupData4.dateFormatKey), '">', soy.$$escapeHtml(eventGroupData4.groupDay), '</div><div class="month" data-group-date="', soy.$$escapeHtml(eventGroupData4.dateFormatKey), '"></div></div><div class="event-group-clear"></div></li>');
  }
  output.append('</ul><a href="#" class="more-events hidden">', soy.$$escapeHtml("More"), '</a></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/calendar-printing.soy' */
// This file was automatically generated from calendar-printing.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.iconEventTypePrinting = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('\t');
  var size__soy4 = '12';
  var className__soy5 = 'iconEventPrint';
  if (opt_data.eventType == 'jira-issue' || opt_data.eventType == 'jira-version') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'jira', size: size__soy4, className: className__soy5}, output);
  } else if (opt_data.eventType == 'greenhopper-sprint') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'green_hopper_sprint', size: size__soy4, className: className__soy5}, output);
  } else {
    if (opt_data.eventType != 'subscription') {
      Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: opt_data.eventType, size: size__soy4, className: className__soy5}, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.iconSubCalendarPrinting = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('\t');
  var size__soy26 = '16';
  var className__soy27 = 'iconSubCalendarPrint';
  if (opt_data.eventType == 'jira-project-releases') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'version_closed', size: size__soy26, className: className__soy27}, output);
  } else if (opt_data.eventType == 'jira-agile-sprint') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'greenhopper_sprint', size: size__soy26, className: className__soy27}, output);
  } else if (opt_data.eventType == 'leaves') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'leave', size: size__soy26, className: className__soy27}, output);
  } else {
    if (opt_data.eventType != 'subscription') {
      Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: opt_data.eventType, size: size__soy26, className: className__soy27}, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.iconEventTimelinePrinting = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var size__soy52 = '16';
  var className__soy53 = 'iconJiraEventTimelinePrint';
  if (opt_data.eventType == 'jira-issue') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'jira', size: size__soy52, className: className__soy53}, output);
  } else if (opt_data.eventType == 'jira-version') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'version_closed', size: size__soy52, className: className__soy53}, output);
  } else if (opt_data.eventType == 'greenhopper-sprint') {
    Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: 'greenhopper-sprint', size: size__soy52, className: className__soy53}, output);
  } else {
    if (opt_data.eventType != 'subscription') {
      Confluence.TeamCalendars.Templates.renderImagePrinting({imageName: opt_data.eventType, size: '12', className: 'iconEventTimelinePrint'}, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.renderImagePrinting = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('\t<img class="', soy.$$escapeHtml(opt_data.className), '" src="', soy.$$escapeHtml(""), '/download/resources/com.atlassian.confluence.extra.team-calendars:calendar-resources/img/', soy.$$escapeHtml(opt_data.imageName), '_', soy.$$escapeHtml(opt_data.size), '.png" alt="" />');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:macro-button-panel-resources', location = 'com/atlassian/confluence/extra/calendar3/js/calendar-macro-button-panel.js' */
(function(a){AJS.bind("init.rte",function(){var b={initViewButtons:function(){a.each(b.getButtonIdToViewMap(),function(d,c){AJS.Confluence.PropertyPanel.Macro.registerButtonHandler(d,function(g,f){var h=a(f);AJS.Rte.getEditor().selection.select(h[0]);AJS.Rte.BookmarkManager.storeBookmark();tinymce.confluence.MacroUtils.insertMacro({contentId:Confluence.Editor.getContentId(),macro:{name:b.getMacroName(h),params:a.extend(b.parseMacroParams(h),{defaultView:c}),defaultParameterValue:"",body:""}})})})},initAddButton:function(){AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("add-subcalendar",function(d,c){var f=a(c);Confluence.TeamCalendars.Dialogs.getAddDialogForMacro({name:b.getMacroName(f),params:b.parseMacroParams(f),defaultParameterValue:"",body:""})})},parseMacroParams:function(f){var c=f.attr("data-macro-parameters")||"",d=c.split("|"),e={};if(d){a.each(d,function(h,g){var i=g.split("=",2);if(i.length>0){e[i[0]]=i.length>1?i[1]:""}})}return e},getMacroName:function(c){return c.attr("data-macro-name")},getButtonIdToViewMap:function(){return{"calendar-view-month":"month","calendar-view-week":"week","calendar-view-list":"list","calendar-view-upcoming":"upcoming","calendar-view-timeline":"timeline"}},initViewButtonHighlight:function(){AJS.bind("created.property-panel",function(d,c){var f=b.parseMacroParams(a(c.anchor))["defaultView"]||"month";if(f==="upcoming"){f="list"}a(".macro-property-panel-calendar-view-"+f,c.panel).addClass("selected")})}};b.initViewButtons();b.initAddButton();b.initViewButtonHighlight()})})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:autoconvert-resources', location = 'com/atlassian/confluence/extra/calendar3/js/team-calendars-autoconvert.js' */
(function(b){var a=function(){if(window.tinymce&&window.tinymce.plugins&&window.tinymce.plugins.Autoconvert&&window.tinymce.plugins.Autoconvert.autoConvert&&window.tinymce.plugins.Autoconvert.autoConvert.addHandler&&b.isFunction(window.tinymce.plugins.Autoconvert.autoConvert.addHandler)){window.tinymce.plugins.Autoconvert.autoConvert.addHandler(function(f,e,c){var d=f.queryKey||{};if(/\/calendar\/previewcalendar.action$/.test(f.path)&&d.subCalendarId){window.tinymce.plugins.Autoconvert.convertMacroToDom({name:"calendar",params:{id:d.subCalendarId}},c,c)}else{return c()}})}};b(a);AJS.bind("init.rte",a)})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:helptip-resources', location = 'com/atlassian/confluence/extra/calendar3/js/HelpTip.js' */
(function(f){function b(){return false}function d(){return true}var l=0,g=new Date().getTime();var k=Confluence.TeamCalendars.getRestBaseUrl()+"/tips";function h(n){n=""+(n||"");return n.replace(/\./g,"-")}function j(o,n){if(AJS.EventQueue&&n&&n.attributes.id){var q={};var p=h(n.attributes.id);q.name="helptips."+p+"."+o;q.properties={};AJS.EventQueue.push(q)}}function c(){return"c"+g+(l++)}var a={dismissedTipIds:[],loaded:f.Deferred(),url:function(){return k},sync:function(o,n){o||(o="get");n||(n=null);return f.ajax(this.url(),{type:o,context:this,dataType:"json",contentType:"application/json",data:n&&JSON.stringify(n),processData:false}).promise()},fetch:function(){var n=this.sync();n.done(function(o){f.merge(this.dismissedTipIds,o);this.loaded.resolve()});return n.promise()},show:function(n){this.loaded.done(n)},dismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=true}else{this.dismissedTipIds.push(o);this.sync("post",{id:o})}},undismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=false}else{this.dismissedTipIds.splice(f.inArray(o,this.dismissedTipIds),1);this.sync("delete",{id:o})}},isDismissed:function(n){var o=n.attributes.id;return(o)?f.inArray(o,this.dismissedTipIds)>=0:n._dismissed}};var e=Confluence.TeamCalendars.HelpTip=function(n){var o;this.attributes=f.extend({},n);this.attributes.id||(this.attributes.id=false);if(this.attributes.body){this.attributes.bodyHtml=this.attributes.body;delete this.attributes.body}this.cid=c();o=this.attributes.anchor;delete this.attributes.anchor;this.view=(o)?new i(this,o):new m(this);this.view.$el.addClass("tc-aui-help-tip")};Confluence.TeamCalendars.HelpTip.Manager=a;f.extend(e.prototype,{show:function(){var n=this;Confluence.TeamCalendars.HelpTip.Manager.show(function(){if(!n.isDismissed()){n.view.show();j("shown",n)}})},dismiss:function(){var n=h(arguments[0]||"programmatically");this.view.dismiss();if(!this.isDismissed()){Confluence.TeamCalendars.HelpTip.Manager.dismiss(this);j("dismissed."+n,this)}},isVisible:function(){return this.view.$el.is(":visible")},isDismissed:function(){return Confluence.TeamCalendars.HelpTip.Manager.isDismissed(this)}});var i=function(o,n){this.initialize(o,n)};f.extend(i.prototype,{initialize:function(t,s){var p=this;var r=9;var o=AJS.$("#rte").height()-s.offset().top;var n=200;var q=o<n;var u=f(AJS.Rte.getEditor().getDoc()).scrollTop();this.model=t;this.beforeHide=b;this.closeButton=f(Confluence.TeamCalendars.Templates.tipClose());this.closeButton.click(function(v){t.dismiss("close-button");v.preventDefault()});this.popup=AJS.InlineDialog(s,t.cid,function(x,w,v){x.html(Confluence.TeamCalendars.Templates.tipContent(t.attributes));x.append(p.closeButton);x.unbind("mouseover mouseout");x.find(".tc-helptip-link").click(function(){j("learn-more.clicked",t)});v()},{container:"#content",noBind:true,onTop:q,preHideCallback:function(){return p.beforeHide()},calculatePositions:function(v,y,z,x){var w=AJS.InlineDialog.opts.calculatePositions(v,y,z,x);if(q){w.popupCss.top=f("#rte").offset().top+s.offset().top-v.height()-r}else{w.popupCss.top=f("#rte").offset().top+(s.offset().top-u)+s.height()+r}w.popupCss.left=s.offset().left;w.displayAbove=q;return w}});this._popupHide=this.popup.hide;this.popup.hide=b;this.$el=f(this.popup[0]);AJS.$(document).bind("showLayer",function(x,w,v){if(w==="inlineDialog"&&v.id===t.cid){AJS.InlineDialog.current=null;AJS.$(document.body).unbind("click."+t.cid+".inline-dialog-check");v._validateClickToClose=b;v.hide=b}})},show:function(){var n=this.popup,o=function(p){if(!n.has(p.target).length){n.shadow.remove();n.remove()}};n.show();AJS.$("#full-height-container").click(o);AJS.Rte.getEditor().onClick.add(o)},dismiss:function(){this.beforeHide=d;this._popupHide()}});var m=function(n){this.initialize(n)};f.extend(m.prototype,{initialize:function(){this.$el=f("<div></div>")},show:function(){},dismiss:function(){}});a.fetch()})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:helptip-resources', location = 'com/atlassian/confluence/extra/calendar3/templates/HelpTip.soy' */
// This file was automatically generated from HelpTip.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.tipContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.title) ? '<h4 class="tc-helptip-title">' + soy.$$escapeHtml(opt_data.title) + '</h4>' : '', '<div class="tc-helptip-body">', opt_data.bodyHtml, '</div>', (opt_data.url) ? '<a class="tc-helptip-link" href="' + soy.$$escapeHtml(opt_data.url) + '" target="_blank">' + soy.$$escapeHtml("Learn more") + '</a>' : '');
  return opt_sb ? '' : output.toString();
};


Confluence.TeamCalendars.Templates.tipClose = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button class="tc-helptip-close aui-button aui-style"><span>', soy.$$escapeHtml("Got it, thanks!"), '</span></button>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout.soy' */
// This file was automatically generated from page-layout.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PageLayout == 'undefined') { Confluence.Templates.PageLayout = {}; }


Confluence.Templates.PageLayout.contentLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="contentLayout"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.cellLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.smallCellLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell aside"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.headerLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="header"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.footerLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="footer"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.columnLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.emptyLayout2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="contentLayout2">');
  Confluence.Templates.PageLayout.emptySection2(null, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.emptySection2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout single" data-layout="single">');
  Confluence.Templates.PageLayout.cell2({type: 'normal'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.newSection2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout single" data-layout="single">');
  Confluence.Templates.PageLayout.cell2({type: 'normal'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.cell2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell ', soy.$$escapeHtml(opt_data.type), '" data-type="', soy.$$escapeHtml(opt_data.type), '"><div class="innerCell">', (opt_data.content) ? opt_data.content : '', '</div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/tinymce-page-layout.js' */
(function($) {

    var updateDropDown = function(to) {
        var menu = $('#pagelayout-menu'),
            iconChecks = $('.icon-check', menu);

        updateDropDown = function(to){
            var fromCheck = iconChecks.not('.hidden'),
                toCheck = iconChecks.siblings('.' + to.name).siblings();

            fromCheck.addClass('hidden');
            toCheck.removeClass('hidden');
        };
        updateDropDown(to);
    };

    function isPageLayout2(ed) {
        var $body = $(ed.getBody());
        if($body.children('.contentLayout').length) {
            // PL1 - no migration yet, so don't support PL2, regardless of dark feature setting
            return false;
        }
        if($body.children('.contentLayout2').length) {
            // PL2 has been created at some point enable regardless of dark feature
            return true;
        }
        return true;
    }

    tinymce.create('tinymce.plugins.PageLayoutPlugin', {
        init: function(ed) {
            var pageLayout;
            this.ed = ed;

            if(AJS.Meta.get('content-type') === "comment") {
                // No page layout support for comments
                return;
            }

            function selectionSetContentCallback() {
                AJS.log('selectionSetContentCallback');
                if(!isPageLayout2(ed)) {
                    if (!tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(pageLayout.getLayout())) {
                        // we only need to call this focus stuff if a page layout exists on the page. (affects IE and gecko)
                        if(!tinymce.webkit) {
                            ed.focus();
                            ed.dom.getRoot().focus();
                        }
                    }
                }
            }

            function focusIfGecko(){
                if (tinymce.isGecko) {
                    setTimeout(function(){
                        ed.focus();
                        ed.dom.getRoot().focus();
                    }, 1);
                }
            }

            function setContentCallback(){
                var pl1Toolbar = $('#pagelayout-menu').parent();
                var pl2Toolbar = $('#page-layout-2-group');
                if(isPageLayout2(ed)) {
                    pl1Toolbar.addClass('hidden');
                    pl2Toolbar.removeClass('hidden');

                    pageLayout = new tinymce.plugins.PageLayoutPlugin.PageLayout2(ed);

                    // quick edit build is breaking in Bamboo (firefox, linux) if
                    // we don't set contenteditable here.
                    // TODO: this behaviour deserves needs some further investigation: CONFDEV-18312
                    if (tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody()) {
                        $(ed.getBody()).attr('contenteditable', 'true');
                    }
             } else {
                    pl1Toolbar.removeClass('hidden');
                    pl2Toolbar.addClass('hidden');

                    pageLayout = new tinymce.plugins.PageLayoutPlugin.PageLayout(ed);

                    if (tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(pageLayout.getLayout())){
                        pageLayout.body.attr('contenteditable', 'true');
                    } else {
                        // we only need to call this focus stuff if a page layout exists on the page.
                        focusIfGecko();
                    }
                    updateDropDown(pageLayout.getLayout());
                }
            }

            ed.onInit.add(function(){
                // CONFDEV-7758 - default undo state does not include page layouts with contenteditable true - so reset it
                ed.undoManager.clear();
                ed.undoManager.add();
                setContentCallback();

                //CONFDEV-7078 Arrow keys breaks in page layouts. turning it on and off again brings back the arrow keys
                //and makes them work once more. This needs to occur once the page is setup. Hence the setTimeout

                AJS.bind("rte-ready",function() {
                    var contentEditable = $('[contenteditable="true"]', ed.getBody());
                    var autoFocus = AJS.Meta.get('editor-auto-focus') !== false;

                    contentEditable.attr('contenteditable', 'false');
                    contentEditable.attr('contenteditable', 'true');

                    if (autoFocus) {
                        ed.focus();
                    }
                });

                ed.selection.onSetContent.add(selectionSetContentCallback);

                if(isPageLayout2(ed)) {
                    ed.undoManager.onUndo.add(function(){
                        if (tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody()){
                            pageLayout.body.attr('contenteditable', 'true');
                        }
                        focusIfGecko();
                    });
                };
            });

            $("#pagelayout-menu").delegate('li.dropdown-item a', 'click', function() {
                ed.execCommand("mcePageLayout", false, tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions(this));
            });

            ed.addCommand("mcePageLayoutInitialize", function() {
                ed.undoManager.add();
                pageLayout.createInitialLayoutIfNone();
            });

            ed.addCommand("mcePageLayout", function(ui, options) {
                ed.undoManager.add();
                pageLayout.setLayout(options);
                updateDropDown(pageLayout.getLayout());
            });

            ed.addCommand("mcePageLayoutAddSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.addSection) {
                    pageLayout.addSection(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutChangeSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.changeSection) {
                    pageLayout.changeSection(options && options.layout, options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutRemoveSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.removeSection) {
                    pageLayout.removeSection(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutMoveSectionUp", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.moveSectionUp) {
                    pageLayout.moveSectionUp(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutMoveSectionDown", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.moveSectionDown) {
                    pageLayout.moveSectionDown(options && options.section);
                }
            });

            ed.onSetContent.add(setContentCallback);

            // CONFDEV-6938 Ensure the entire cell is a clickable area.
            ed.onClick.add(function(ed, e) {
                var $target = $(e.target),
                    cells, toStart;
                if ($target.is("div.cell")) {
                    $target.children(".innerCell").focus();
                }

                if (tinymce.isWebKit && (e.target === ed.getBody() || e.target === ed.getBody().parentNode)) {
                    cells = $target.find(".innerCell");
                    if (cells.length) {
                        ed.execCommand('selectAll');
                        //If the body was clicked (usually below the page layout) collapse to end otherwise collapse to start.
                        toStart = e.target !== ed.getBody();
                        ed.selection.collapse(toStart);
                    }
                }
            });

            // CONFDEV-6327 Handle backspace and delete keys to ensure page layouts always contain
            // a paragraph. As the deletion occurs on keypress and we are adding in the empty paragraph
            // on keyup, a 'jump' is noticeable as the page layout cell is resized for its content, tracked
            // as CONFDEV-6426.
            !tinymce.isIE9 && ed.onKeyUp.add(function(ed, e){
                var keyCode = e.keyCode,
                    startContainer, cell;
                if (keyCode != 8 && keyCode != 46) {
                    return true;
                }

                startContainer = ed.selection.getRng(true).startContainer;
                if($(startContainer).closest('.contentLayout,.contentLayout2', ed.getBody()).length) {
                    cell = $(startContainer).closest(".innerCell");
                    if(cell && cell.length && ed.dom.isEmpty(cell.clone()[0])) {
                        cell.html('<p><br data-mce-bogus="1"></p>');

                        ed.selection.select(cell[0], true);
                        ed.selection.collapse(true);
                    }
                }
            });
        },

        execCommand: function(command, ui, options){
            if (command === 'selectAll') {
                var ed = this.ed,
                    body = ed.getBody(),
                    cells, first, last, rng;


                if (ed.dom.getAttrib(body, 'contenteditable') == "true"){
                    //will cause the execCommand to fall through to TinyMCE implementation
                    return false;
                }

                cells = ed.dom.select('.innerCell', body);
                first = cells[0];
                last = cells[cells.length - 1];
                rng = ed.dom.createRng();

                rng.setStart(first, 0);
                rng.setEnd(last, last.childNodes.length);
                ed.selection.setRng(rng);
                return true;
            }

            return false;
        },

        getInfo: function() {
            return {
                longname: 'Page Layout Plugin',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
    });
    tinymce.PluginManager.add('pagelayoutplugin', tinymce.plugins.PageLayoutPlugin);

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout.js' */
/**
 * PageLayout object is a singleton created in the current editor's namespace which maintains state
 * representative of the currently layout used by the editor.
 */

(function($) {
    /**
     * Constructor for the PageLayout object. There is one of these per editor instance.
     *
     * param editor
     * constructor
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout = function (editor) {
        this.editor = editor;
        this.body = $(editor.getBody());
        var layoutElement = $('.contentLayout', this.body);

        if (layoutElement.length) {
            updateLegacyLayout(layoutElement);
            setupLayout(layoutElement, this.body, this.editor);

            this.editor.undoManager.add();
        }
	};

    tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT = {name: "pagelayout-none", columns: 0};

    /*****
     * INSTANCE METHODS
     */

    /**
     * Sets the layout of the current editor to the provided layout.
     *
     * param layout object representing the layout that the current editor should be converted too
     * it is structured as follows:
     * {
     *   name: name of the layout
     *   header: boolean
     *   footer: boolean
     *   columns: array length represents the number of columns and each index n is a string to be added
     *            to the classname of the nth column
     * }
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.prototype.setLayout = function (layout) {
        var newLayoutElement,
            layoutElement = $('.contentLayout', this.body),
            currentLayout = tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions(layoutElement);
        if (currentLayout.name === layout.name) {
            return;
        }
        AJS.trigger('analyticsEvent', {name: 'PageLayoutEvent.pageLayoutChanged', data: {name: layout.name}});

        if (layoutElement.length === 1) {
            // todo I think the assumption that layoutElement will be accurate here is incorrect in light of undo
            newLayoutElement = layoutElement.clone();
        } else {
            newLayoutElement = createLayoutElement(this.editor, this.body);
        }

        updateLegacyLayout(newLayoutElement);
        convertColumns(layout, newLayoutElement);
        layout.header ? addHeader(newLayoutElement) : removeHeader(newLayoutElement);
        layout.footer ? addFooter(newLayoutElement) : removeFooter(newLayoutElement);

        if(tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(layout)) {
            newLayoutElement = newLayoutElement.contents().unwrap();
            this.body.attr('contenteditable', 'true');
            layoutElement = "";
        } else {
            setupLayout(newLayoutElement, this.body, this.editor);
            newLayoutElement.attr('data-atlassian-layout', JSON.stringify(layout));
            layoutElement = newLayoutElement;
        }

        drawLayout(this.body, newLayoutElement);
        tinymce.isIE && this.editor.dom.setRoot();
        focus(this.editor);
    };

    tinymce.plugins.PageLayoutPlugin.PageLayout.prototype.getLayout = function () {
        var layoutElement = $('.contentLayout', this.body);
        return layoutElement.length && layoutElement.attr('data-atlassian-layout')
            ? JSON.parse(layoutElement.attr('data-atlassian-layout'))
            : tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT;
    };

    /*****
     * STATIC METHODS
     */

    /**
     * Given an element, parse the JSON inside of the data-atlassian-layout attribute which contains a
     * simple layout object.
     *
     * @param element
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions = function(element) {
        var $element = element.jquery ? element : $(element),
            layoutJson = $element.attr("data-atlassian-layout");
        return layoutJson ? JSON.parse(layoutJson) : tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT;
    };

    /**
     * Returns true if the layout provided needs the body node to be content editable.
     *
     * @param layout The layout to check.
     * @return {Boolean} True if this layout requires body node to be content editable.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody = function(layout){
        return !(layout.header || layout.footer || layout.columns);
    };

    /*****
     * PRIVATE METHODS
     */

    /**
     * Returns the html content of the given element. Returns an empty string if the
     * the element is empty (i.e. consists only of empty <p><br></p> structures).
     *
     * param element Can be a jQuery object or a DOM element.
     */
    var getContents = function (element) {
        var $element = element.jquery? element : $(element);
        if (!!$element.length) {
            var childNodes = $element[0].childNodes;
            for (var i = 0; i < childNodes.length; i++) {
                var thisNode = childNodes[i];
                if (!((thisNode.nodeName == "P") && (thisNode.childNodes.length == 1) && (thisNode.firstChild.nodeName == "BR"))) {
                    return $element.html();
                }
            }
        }
        return "";
    };

    /**
     * CONFDEV-6926: IE8 requires an extra div inside cell in order to have the appropriate layout. Older layouts did not
     * have this div. The disrepency causes older lyout's to break. This function looks for older layouts
     * and manually injects the new div to resolve this issue.
     *
     */
    var updateLegacyLayout = function (layoutElement) {
        var cells, cell, content;

        cells = $('.cell, .header, .footer', layoutElement);

        for(var i=0, ii=cells.length; i<ii; i++) {
            cell = $(cells[i]);
            content = cell.html();
            
            if(!$('.innerCell', cell).length) {
                cell.removeAttr('contenteditable');
                cell.html('<div class="innerCell">' + content + '</div>');
            }
        }
    };

    /**
     * Makes the correct elements content editable and puts minimally sufficient content in each
     *
     * param layout
     */
    var setupLayout = function (layout, body, editor) {
        body.attr("contenteditable", 'false');
        var layoutSelector = ".innerCell",
            defaultCellContents = tinymce.isIE9 ? '<p></p>' : '<p><br /></p>';

        // add at least an empty paragraph to the sections
        $(layoutSelector, layout).each(function() {
            var $this = $(this);
            $this.attr("contenteditable", "true");

            if (!$this.children().length) {
                $this.append(defaultCellContents);
            }
        });
        // CONFDEV-6815 Focus the div element instead of the body for IE8 so the focus() method does not fail.
        tinymce.isIE && body.delegate(layoutSelector, 'focus.pageLayout', function () {
            // CONFDEV-7362 setRoot does not exist as a function when this code is first run. As a result we
            // need to set the root_element manually.
            editor.dom.settings.root_element = this;
        });
    };

    /**
     * Add a header to the provided layout
     * param layout
     */
    var addHeader = function (layout) {
        if ($('.header', layout).length)
            return;

        layout.prepend(Confluence.Templates.PageLayout.headerLayout());
    };

    /**
     * Remove the header from the provided layout
     * param layout
     */
    var removeHeader = function (layout) {
        var header = $('.header', layout),
            firstCol = getFirstColumn(layout),
            content = getContents($('.innerCell',header));

        if(firstCol.length) {
            firstCol.prepend(content);
            header.remove();
        }
        else {
            header.replaceWith(content);
        }
    };

    /**
     * Add a footer to the provided layout
     * param layout
     */
    var addFooter = function (layout) {
        if ($('.footer', layout).length)
            return;

        layout.append(Confluence.Templates.PageLayout.footerLayout());
    };

    /**
     * Remove the footer from the provided layout
     * param layout
     */
    var removeFooter = function (layout) {
        var footer = $('.footer', layout),
            lastCol = getLastColumn(layout),
            content = getContents($('.innerCell', footer));

        if(lastCol.length) {
            lastCol.append(content);
            footer.remove();
        }
        else {
            footer.replaceWith(content);
        }
    };

    var getColumnCount = function (layout){
        return $('.columnLayout > .cell', layout).length;
    };

    /**
     * Get the first column of the provided layout
     * param layout
     */
    var getFirstColumn = function (layout) {
        return $('.columnLayout > .cell:first-child .innerCell', layout);
    };

    /**
     * Get the last column of the provided layout
     * param layout
     */
    var getLastColumn = function(layout) {
        return $('.columnLayout > .cell:last-child .innerCell', layout);
    };

    var addColumn = function (layout) {
        return $('.columnLayout', layout).append(Confluence.Templates.PageLayout.cellLayout());
    };

    var removeAllColumns = function (layout) {
        var content = "";
        $('.columnLayout > .cell', layout).each(function() {
            content += getContents($('.innerCell', this));
        });

        $('.columnLayout', layout).replaceWith(content);
    };

    var mergeColumns = function (from, to) {
        var content = getContents(from);
        to.append(content);
        from.parent().remove();
    };

    /**
     * Converts to the passed layout to the number and type of passed columns.
     *
     * param toLayout Array representing the columns that the layout is to be converted to. Length represents
     *   the number of columns and each index n is a string to be added to the classname of the nth column
     * param layout
     */
    var convertColumns = function (toLayout, layout) {
        var columnCount = getColumnCount(layout),
            name = toLayout.name,
            columns = toLayout.columns,
            content, numCols;

        if (columnCount == 0) { //first time applying a layout
            content = layout.html();
            layout.html(Confluence.Templates.PageLayout.columnLayout());
            while (columnCount !== columns.length) {
                addColumn(layout);
                columnCount++;
            }
        }

        /* CONFDEV-6137 Because IE8 compat mode doesn't support table layout we need to be able
           To determine how many columns we have and alter our widths appropriately. This piece
           of code adds a class to make this possible.

           Slice off beginning and end. account for layout names without end portions (pagelayout-none)
         */
        numCols = name.substring(name.indexOf('-') + 1);
        numCols = numCols.substring(0, Math.max(0, numCols.indexOf('-')) || undefined);

        $('.columnLayout', layout).attr('class', 'columnLayout ' + numCols + 'Columns');

        if (columns) {
            $('.columnLayout > .cell', layout).each(function(index, column){
                (columns[index] !== undefined) && $(column).attr('class', 'cell ' + columns[index]);
            });

            while(columnCount !== columns.length) {
                if (columnCount < columns.length) {
                    addColumn(layout);
                    columnCount++;
                } else {
                    mergeColumns($('.columnLayout .cell:nth-child(' + (columnCount) + ') .innerCell', layout),
                        $('.columnLayout > .cell:nth-child(' + (columnCount-1) + ') .innerCell', layout));
                    columnCount--;
                }
            }
        } else {
            removeAllColumns(layout);
        }

        content && getFirstColumn(layout).html(content);
    };

    /**
     * Replaces the body content with the layout
     *
     * param body
     * param layout
     */
    var drawLayout = function (body, layout){
        body.empty().append(layout);
    };

    /**
     * Creates a layout element within which a new page layout can be constructed
     *
     * param editor
     * param body
     */
    var createLayoutElement = function (editor, body){
        var layout = createElementInEditor(Confluence.Templates.PageLayout.contentLayout(), editor);
        return layout.html(body.html());
    };

    /**
     * Sets focus to the first p in the body.
     */
    var focus = function (editor) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = $('[contenteditable="true"]', editor.getBody()),
            p;

        if (ce.length) {
            editor.focus();
            ce[0].focus();

            p = ce.children()[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
        } else {
            editor.focus();
        }
    };

    /**
     * Creates an html element in the context of the editor
     *
     * param html
     * param editor
     */
    var createElementInEditor = function(html, editor) {
        var div = editor.dom.create('div');
        div.innerHTML = html;
        return $(div).children();
    };
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout-2.js' */
/**
 * PageLayout object is a singleton created in the current editor's namespace which maintains state
 * representative of the currently layout used by the editor.
 */

(function($) {

    var EVENT_PREFIX = "editor.page-layout.";
    var EMPTY_CELL_CONTENT = tinymce.isIE9 ? '<p></p>' : '<p><br /></p>';
    var EMPTY_BODY_CONTENT = '<p></p>';

    /**
     * Constructor for the PageLayout object. There is one of these per editor instance.
     *
     * param editor
     * constructor
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2 = function (editor) {
        this.editor = editor;
        this.body = $(editor.getBody());
        var layoutElement = this.body.find('.contentLayout2');

        if (layoutElement.length) {
            setupLayout(layoutElement, this.body, this.editor);
            this.editor.undoManager.add();
        }
	};

    /*****
     * INSTANCE METHODS
     */

    /**
     * Adds a section layout below the current cursor position
     *
     * @param section section to add a new section after, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.add-section event. eventData is is { section: newSection }.
     */

    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.addSection = function(section) {
        var self = this;
        var newSection = $(Confluence.Templates.PageLayout.newSection2());
        var curSection = section || findNearestSection(this.body, this.editor, true);

        if (!curSection.length){
            this.createInitialLayoutIfNone();
            return;
        }

        // let's create a section of the same type as the selected one
        var layoutFromCurrentSection = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get(curSection.attr('data-layout'));
        this.editor.undoManager.ignore(function(){
            configureSection(newSection, layoutFromCurrentSection, self.body, self.editor);
            curSection.after(newSection);
        });

        focusSection(this.editor, newSection);

        AJS.trigger(EVENT_PREFIX + "add-section", {
            section: newSection
        });
    };

    /**
    * Configures a section with a given layout.
    *
    * @param section
    * @param layout
    * @param body
    * @param editor
    */
    function configureSection(curSection, layout, body, editor)
    {
        var cells = curSection.find('.cell');
        var cellsLength = cells.length;
        var newCells = $();
        var newCellsLength = layout.cells.length;
        var contents = [];
        var newContents = [];
        var i, len, cell;

        curSection.attr('class', 'columnLayout'); // reset class
        curSection.addClass(layout.id);
        curSection.attr('data-layout', layout.id);

        for (i = 0, len = cellsLength; i < len; i++) {
            cell = cells.eq(i).detach();
            contents.push(getContents(cell.children('.innerCell')));
        }

        for (i = 0, len = newCellsLength; i < len; i++) {
            newCells = newCells.add(Confluence.Templates.PageLayout.cell2({ type: layout.cells[i].type || '' }));
        }

        if (cellsLength <= newCellsLength) {
            // simple case 1-to-1
            newContents = contents;
        }
        else {
            // need to combine some cells
            newContents = contents.slice(0, newCellsLength);
            for (i = newCellsLength, len = cellsLength; i < len; i++) {
                newContents[newCellsLength - 1] += contents[i];
            }
        }

        // CONFDEV-18166. Make sure we attach the new cells to the DOM before
        // filling its content to avoid rendering problems in IE8
        curSection.prepend(newCells);

        for (i = 0, len = newCellsLength; i < len; i++) {
            newCells.eq(i).find('.innerCell').html(newContents[i]);
        }

        setupLayout(curSection, body, editor);
    }

    /**
     * Changes the layout of the section, will attempt to conserve the contents of the section.
     *
     * @param layout one of tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts
     * @param section section to change layout form, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.change-layout event.
     * eventData is is { section: section, originalLayout: { ... }, currentLayout: { ... } }.
     * originalLayout and currentLayout are one of tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.changeSection = function(layout, section) {
        var self = this;

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout()){
            this.createInitialLayoutIfNone();
        }

        var curSection = section || findNearestSection(this.body, this.editor, false);
        if(!curSection.length) {
            return;
        }
        var originalLayout = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get(curSection.attr('data-layout'));

        this.editor.undoManager.ignore(function(){
            configureSection(curSection, layout, self.body, self.editor);
        });
        focusSection(this.editor, curSection);

        AJS.trigger(EVENT_PREFIX + "change-layout", {
            section: curSection,
            originalLayout: originalLayout,
            currentLayout: layout
        });
    };

    /**
     * Removes a section, content in section is lost. If last section an empty single column section is
     * put in its place.
     *
     * @param section section to remove, or if missing, the section where the caret is located.
     *
     * Triggers a editor.page-layout.remove-section event. eventData is is {}.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.removeSection = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);

        var nextSiblingSection = curSection.next(),
            prevSiblingSection = curSection.prev(),
            newSectionToFocusOn;

        if (nextSiblingSection.length) {
            newSectionToFocusOn = nextSiblingSection;
            curSection.remove();
        } else if(prevSiblingSection.length) {
            newSectionToFocusOn = prevSiblingSection;
            curSection.remove();
        } else {
            // we don't have any other sibling so we can delete the *parent* contentLayout, regardless
            curSection.closest('.contentLayout2').remove();

            // check for any other contentLayout anywhere in the document.
            var otherSectionInTheDocument = this.body.find('.contentLayout2').find('.columnLayout').first();
            if (otherSectionInTheDocument.length){
                // CONF-30193
                // be aware that this scenario is not actually supported on PL2 but we should handled it (corrupted content?)
                newSectionToFocusOn = otherSectionInTheDocument;
            }
            else {
                // this was the last section of the whole document, so we remove the whole PL thing and hide de toolbar
                removeContentAndRestoreContentEditable(this.editor);
                hidePLToolbar();
            }
        }

        if (newSectionToFocusOn && newSectionToFocusOn.length) {
            focusSection(this.editor, newSectionToFocusOn);
        }

        AJS.trigger(EVENT_PREFIX + "remove-section", { });


        function hidePLToolbar() {
            var $plButton = $('#rte-button-pagelayout-2');
            if ($plButton.hasClass('active')) {
                $plButton.click();
            }
        }

        function removeContentAndRestoreContentEditable(ed){
            // hide toolbar, toogle off page layouts functionality
            ed.getBody().setAttribute('contenteditable', true);
            ed.setContent(EMPTY_BODY_CONTENT);
            focus(ed);
        }
    };

    /**
     * Moves the section above the section before it.
     *
     * @param section section to move, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.move-section-up event. eventData is is { section: section }.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.moveSectionUp = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);
        var prevSection = curSection.prev();
        if(prevSection.length) {
            curSection.detach();
            prevSection.before(curSection);
            focusSection(this.editor, curSection);
        }
        AJS.trigger(EVENT_PREFIX + "move-section-up", { section: curSection });
    };

    /**
     * Moves the section below the section currently after it.
     *
     * @param section section to move, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.move-section-down event. eventData is is { section: section }.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.moveSectionDown = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);
        var nextSection = curSection.next();
        if(nextSection.length) {
            curSection.detach();
            nextSection.after(curSection);
            focusSection(this.editor, curSection);
        }
        AJS.trigger(EVENT_PREFIX + "move-section-down", { section: curSection });
    };

    /**
     * Page layouts "lazy" initialization.
     *
     * Makes sure a default, empty layout is created if none exists.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.createInitialLayoutIfNone = function() {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout()) {
            AJS.log('initializing PL2 layout...');

            var layoutElement = $(Confluence.Templates.PageLayout.emptyLayout2());
            var innerCell = layoutElement.find('.innerCell');
            var content = this.body.children().detach();

            innerCell.append(content);

            this.body.append(layoutElement);

            setupLayout(layoutElement, this.body, this.editor);

            focus(this.editor);
        }
    };

    /*****
     * STATIC METHODS
     */

    /**
     * Determines if the current page is a Page Layout 2 page.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout = function() {
        var body = $(AJS.Rte.getEditor().getBody());
        return !!body.find('div.contentLayout2').length;
    };

    /**
     * Returns true if the layout provided needs the body node to be content editable.
     *
     * @param layout The layout to check.
     * @return {Boolean} True if this layout requires body node to be content editable.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody = function(){
        return !tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout();
    };

    /*************
     * STATIC VALUES
     */

    /**
     * Array of layouts.
     *
     * Order will affect button render order.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts = [
        {
            id: 'single',
            name: "Single column section",
            cells: [
                { type: 'normal' }
            ]
        },
        {
            id: 'two-equal',
            name: "Two column section",
            cells: [
                { type: 'normal' },
                { type: 'normal' }
            ]
        },
        {
            id: 'two-left-sidebar',
            name: "Two column section with left side-bar",
            cells: [
                { type: 'aside' },
                { type: 'normal' }
            ]
        },
        {
            id: 'two-right-sidebar',
            name: "Two column section with right side-bar",
            cells: [
                { type: 'normal' },
                { type: 'aside' }
            ]
        },
        {
            id: 'three-equal',
            name: "Three column section",
            cells: [
                { type: 'normal' },
                { type: 'normal' },
                { type: 'normal' }
            ]
        },
        {
            id: 'three-with-sidebars',
            name: "Three column section with side-bars",
            cells: [
                { type: 'sidebars' },
                { type: 'normal' },
                { type: 'sidebars' }
            ]
        }
    ];

    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get = function(id) {
        var layouts = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts;
        for(var i = 0, len = layouts.length; i < len; i++) {
            if(layouts[i].id === id) {
                return layouts[i];
            }
        }
        return null;
    };

    /**
     * Will find the nearest section in the page.
     *
     * @param defaultToLast will return the last section if caret is not inside a section
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.findNearestSection = function(defaultToLast) {
        var editor = AJS.Rte.getEditor();
        var body = $(editor.getBody());
        return findNearestSection(body, editor, defaultToLast);
    };

    /*****
     * PRIVATE METHODS
     */

    /**
     * Returns the html content of the given element. Returns an empty string if the
     * the element is empty (i.e. consists only of empty <p><br></p> structures).
     *
     * param element Can be a jQuery object or a DOM element.
     */
    var getContents = function (element) {
        var $element = $(element);
        if (!!$element.length) {
            var childNodes = $element[0].childNodes;
            for (var i = 0; i < childNodes.length; i++) {
                var thisNode = childNodes[i];
                if (!((thisNode.nodeName == "P") && (thisNode.childNodes.length == 1) && (thisNode.firstChild.nodeName == "BR"))) {
                    return $element.html();
                }
            }
        }
        return "";
    };

    /**
     * Will find the nearest section in the page.
     *
     * @param body
     * @param editor
     * @param defaultToLast will return the last section if caret is not inside a section
     */
    var findNearestSection = function(body, editor, defaultToLast) {
        var startNode = $(editor.selection.getRng(true).startContainer);
        var nearestSection = startNode.closest('.columnLayout');
        if(!nearestSection.length && defaultToLast) {
            // caret not in section, find last
            nearestSection = body.find('.columnLayout').last();
        }
        return nearestSection;
    };

    /**
     * Makes the correct elements content editable and puts minimally sufficient content in each
     *
     * param layout
     */
    var setupLayout = function (layout, body, editor) {
        body.attr("contenteditable", 'false');
        var layoutSelector = ".innerCell",
            defaultCellContents = EMPTY_CELL_CONTENT;

        // add at least an empty paragraph to the sections
        $(layoutSelector, layout).each(function() {
            var $this = $(this);
            $this.attr("contenteditable", "true");

            if (!$this.children().length) {
                $this.append(defaultCellContents);
            }
        });
        // CONFDEV-6815 Focus the div element instead of the body for IE8 so the focus() method does not fail.
        tinymce.isIE && body.delegate(layoutSelector, 'focus.pageLayout', function () {
            // CONFDEV-7362 setRoot does not exist as a function when this code is first run. As a result we
            // need to set the root_element manually.
            editor.dom.settings.root_element = this;
        });
    };

    /**
     * Sets focus to the first p in the body.
     */
    var focus = function (editor) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = $('[contenteditable="true"]', editor.getBody()),
            p;

        if (ce.length) {
            editor.focus();
            ce[0].focus();

            p = ce.children()[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
        } else {
            editor.focus();
        }
    };

    /**
     * Sets focus into the first p of the first cell in the specified section
     */
    var focusSection = function(editor, section) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = section.find('[contenteditable="true"]').first(),
            target = ce.children(),
            p;
        if(target.length) {
            editor.focus();
            ce[0].focus();
            p = target[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
            AJS.Rte.showElement(p);
        } else {
            editor.focus();
        }
    };

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/tinymce-page-layout-toolbar.js' */
/**
 * Toolbar based implementation for editing page layouts.
 */
(function($) {
    if(AJS.Meta.get('content-type') === "comment") {
        // No page layout support for comments
        return;
    }

    function updateToolbarState(section) {
        section = section || tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.findNearestSection();
        var sectionType = section.attr('data-layout');
        var layoutButtons = $('#rte-toolbar-row-pl2-toolbar').find('.layouts button');
        var buttonForLayout = layoutButtons.find('.' + "pl2-layout-" + sectionType).closest('.aui-button');
        if(buttonForLayout.hasClass('active'))
            return; // already set
        layoutButtons.filter('.active').removeClass('active');
        buttonForLayout.addClass('active');
    }

    AJS.$(document).bind("initContextToolbars.Toolbar", function(e, editor) {
        var getLang = function(key) {
            var title = editor.getLang(key),
                shortcut = editor.getLang(key + "_shortcut", "");
            if (shortcut) {
                title += " (" + shortcut + ")";
            }
            return title;
        };

        var $doc = AJS.$(document);
        var $plButton = $('#rte-button-pagelayout-2');
        var toolbarId = 'pl2-toolbar';

        $plButton.click(function(e) {
            // TODO should add hide / show event to custom toolbar.
            e.preventDefault();
            if(!$plButton.hasClass('active')) {
                $doc.trigger("createContextToolbarRow.Toolbar", { id: toolbarId, buttons: Confluence.Editor.PageLayoutToolbar.Buttons, topToolbar: true, animate: true});
                updateToolbarState();
                editor.execCommand("mcePageLayoutInitialize");
            } else {
                $doc.trigger("removeContextToolbarRow.Toolbar", { id: toolbarId, animate : true });
            }
            $plButton.toggleClass('active');
        });

        editor.onNodeChange.add(function(ed, cm, n) {
            var section = $(n).closest('.columnLayout');
            updateToolbarState(section);
        });

        var classPrefix =  "pl2-";

        var layouts = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts;
        var layoutButtons = [];

        for(var i = 0, l = layouts.length; i < l; i++) {
            (function(layout) {
                layoutButtons.push(new Confluence.Editor.Toolbar.Components.Button({
                    text : layout.name,
                    iconClass : "icon-fat " + classPrefix + "layout-" + layout.id,
                    click : function() {
                        editor.execCommand("mcePageLayoutChangeSection", false, {
                            layout: layout
                        });
                    }
                }));
            })(layouts[i]);
        }

        Confluence.Editor.PageLayoutToolbar = {
            Buttons:[
                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Add section",
                        id: "add-layout-section",
                        tooltip : "Add a new section below",
                        iconClass : classPrefix + "layout-add-section",
                        click : function() {
                            AJS.log('add layout section');
                            editor.execCommand("mcePageLayoutAddSection");
                        }
                    }),
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Remove section",
                        tooltip : "Remove the current section",
                        iconClass : classPrefix + "layout-remove-section",
                        click : function() {
                            AJS.log('remove layout section');
                            editor.execCommand("mcePageLayoutRemoveSection");
                        }
                    })
                ]),

                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Move up",
                        tooltip : "Move section up",
                        iconClass : classPrefix + "layout-move-section-up",
                        click : function() {
                            AJS.log('move-section-up');
                            editor.execCommand("mcePageLayoutMoveSectionUp");
                        }
                    }),
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Move down",
                        tooltip : "Move section down",
                        iconClass : classPrefix + "layout-move-section-down",
                        click : function() {
                            AJS.log('move-section-down');
                            editor.execCommand("mcePageLayoutMoveSectionDown");
                        }
                    })
                ]),
                new Confluence.Editor.Toolbar.Components.Group(layoutButtons, {
                    id: 'pagelayout2-toolbar',
                    text: "Apply layout",
                    groupClass: 'layouts' }
                ),

                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        text : "Close toolbar",
                        iconClass : "icon-close",
                        click : function() {
                            $plButton.click();
                        }
                    })
                ], { groupClass: 'close' })
            ],

            // takes an array of {type: tinymceEvent, shouldTrigger: function, callback: function, missed: function }
            Events: [
            ]
        };
    });

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.balsamiq.confluence.plugins.mockups:editor-web-resource', location = 'includes/editor/balsamiqmockups.js' */
try{AJS.bind("init.rte",function(){(function(A){BalsamiqMockups=function(){};
BalsamiqMockups.prototype.launchBalsamiqMockupsEditor=function(C){AJS.Rte.BookmarkManager.storeBookmark();
AJS.$("#header").css("display","none");
AJS.$(".ia-splitter-left").css("display","none");
var D;
var B;
if(C&&C.params&&C.params.Name){D=C.params.Name;
if(C.params.Version){B=C.params.Version
}else{B="-1"
}BM4C.lastMacroParams=C.params
}BM4C.openEditor(D,B)
};
BalsamiqMockups.prototype.openEditor=function(B,F){var D;
var C;
BM4C.inserting=(B==null);
if(B==null){D="do=insert"
}else{D="do=edit&amp;mockup="+B+"&amp;version="+F
}var E;
if(AJS.params.pageId=="0"){E="draft="+AJS.Meta.get("content-id")
}else{E="page="+AJS.params.pageId
}C=typeof (AJS.contextPath())=="undefined"?"":AJS.contextPath();
AJS.$(document.documentElement).append('<iframe id="balsamiq_mockups_editor_iframe" src="'+C+"/plugins/servlet/mockups?"+D+"&amp;"+E+'" style="position:fixed;left:0px;top:0px;border:none;background:#FFFFFF;" frameborder="0" width="100%" height="100%"></iframe>')
};
BalsamiqMockups.prototype.closeEditor=function(C,E){AJS.$("#balsamiq_mockups_editor_iframe").remove();
AJS.$("#header").css("display","block");
AJS.$(".ia-splitter-left").css("display","block");
if(C){var D,B;
B=E||1;
if(BM4C.inserting){D={Name:C,Version:B}
}else{D=BM4C.lastMacroParams;
D.Version=B
}var F={contentId:Confluence.Editor.getContentId(),macro:{name:"mockup",params:D,defaultParameterValue:"",body:""}};
AJS.Rte.getEditor().focus();
AJS.Rte.BookmarkManager.restoreBookmark();
tinyMCE.confluence.MacroUtils.insertMacro(F)
}};
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-size-small",function(C,B){BM4C.editMacroSize(B,"s")
});
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-size-medium",function(C,B){BM4C.editMacroSize(B,"m")
});
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-size-original",function(C,B){BM4C.editMacroSize(B,"o")
});
BalsamiqMockups.prototype.editMacroSize=function(B,F){var C=AJS.$(B);
AJS.Rte.getEditor().selection.select(C[0]);
AJS.Rte.BookmarkManager.storeBookmark();
var E=BM4C.getMacroParams(C);
if(F=="o"){delete E.Width
}else{E.Width=((F=="s")?120:600)
}var D={contentId:Confluence.Editor.getContentId(),macro:{name:"mockup",params:E,defaultParameterValue:"",body:""}};
tinyMCE.confluence.MacroUtils.insertMacro(D)
};
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-align-left",function(C,B){BM4C.editMacroAlign(B,"l")
});
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-align-center",function(C,B){BM4C.editMacroAlign(B,"c")
});
AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("balsamiq-mockups-macro-prop-align-right",function(C,B){BM4C.editMacroAlign(B,"r")
});
BalsamiqMockups.prototype.editMacroAlign=function(B,F){var C=AJS.$(B);
AJS.Rte.getEditor().selection.select(C[0]);
AJS.Rte.BookmarkManager.storeBookmark();
var E=BM4C.getMacroParams(C);
if(F=="c"){delete E.Alignment
}else{E.Alignment=((F=="l")?"Left":"Right")
}var D={contentId:Confluence.Editor.getContentId(),macro:{name:"mockup",params:E,defaultParameterValue:"",body:""}};
tinyMCE.confluence.MacroUtils.insertMacro(D)
};
BalsamiqMockups.prototype.getMacroParams=function(C){var B={};
if(C.data("macro-parameters")){A.each(C.data("macro-parameters").split("|"),function(D,E){var F=E.split("=");
B[F[0]]=F[1]
})
}return B
};
BM4C=new BalsamiqMockups();
AJS.MacroBrowser.setMacroJsOverride("mockup",{opener:BM4C.launchBalsamiqMockupsEditor});
if(window.location.search.indexOf("openBalsamiq=true")!=-1){BM4C.launchBalsamiqMockupsEditor()
}}(AJS.$))
})
}catch(err){if(console&&console.log){console.log("Error loading balsamiqmockups.js");
console.log(err)
}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.balsamiq.confluence.plugins.mockups:balsamiq-plugin-editor-web-resource', location = 'includes/editor/balsamiq.plugin.editor.js' */
var bmse=(function(){var N=false,G=false,E=false,K=false,D=false,L,H=function(){var O=document.getElementById("balsamiq_mockups_editor_iframe");
return O?O.contentDocument:document
},M=function(){var O=document.getElementById("balsamiq_mockups_editor_iframe");
return O?O.contentWindow:window
},J=function(O){var Q=H(),P=M();
return(navigator.appName.indexOf("Microsoft")!==-1)?P[O]:Q[O]
},I=function(O){if(D&&console){console.log(O)
}},A=function(){I("confirmExit submitting:"+K+" dirty:"+E);
if(!K&&E){return"You will lose the changes made to this mockup."
}},C=function(O){if(G){var Q=(navigator.userAgent.indexOf("Firefox")!==-1)?-O.detail:O.wheelDelta/40,P={x:O.screenX,y:O.screenY,delta:Q,ctrlKey:O.ctrlKey,altKey:O.altKey,shiftKey:O.shiftKey};
I("JS::handleWheel");
J("editor").handleWheel(P)
}},B=function(R){if((R.ctrlKey||R.metaKey||R.altKey)&&N===true){var P={219:"[",221:"]",189:"-",187:"+"}[R.keyCode]||String.fromCharCode(R.keyCode).toLowerCase(),Q=(R.ctrlKey?"1":"0")+(R.metaKey?"1":"0")+(R.altKey?"1":"0")+(R.shiftKey?"1":"0")+P,O=false;
I("JS::keyboardHandler");
if(navigator.userAgent.indexOf("Safari")!==-1&&(R.keyCode===91||R.keyCode===93)){O=true
}else{if(J("editor").sendKeystroke(Q)){O=true
}}if(O){if(R.stopPropagation){R.stopPropagation()
}R.cancelBubble=true;
if(R.preventManipulation){R.preventManipulation()
}if(R.preventDefault){R.preventDefault()
}R.returnValue=false
}}},F=function(){var Q=H(),P=M(),O;
if(P.addEventListener){O=(navigator.userAgent.indexOf("Firefox")!==-1)?"DOMMouseScroll":"mousewheel";
P.addEventListener(O,C,false)
}if(Q.addEventListener){Q.addEventListener("keydown",B,false);
Q.addEventListener("keypress",B,false)
}};
return{isEditorViewReady:function(){return G
},passKeys:function(O){N=(O==="true");
I("passKeys: "+O)
},editorViewReady:function(){G=true;
J("editor").focus();
I("base editorViewReady");
F()
},getFlashMovie:J,trace:I,enableLogs:function(O){D=O
},enableEditorLogs:function(O){J("editor").enableLogs(O)
},setDirty:function(O){I("setDirty "+O);
E=O
},isDirty:function(){return E
},setDirtyByID:function(P,O){I("setDirtyByID "+P+" "+O)
},setSubmitting:function(){I("setSubmitting");
K=true
},onClose:function(){M().onbeforeunload=L
},setAutosaveEnabled:function(O){L=M().onbeforeunload;
if(O){M().onbeforeunload=null
}else{M().onbeforeunload=A
}I("setAutosaveEnabled "+O)
},updateTitle:function(O){document.title=O;
I("updatingTitle "+O)
}}
}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.components:editor-notifications', location = '/includes/js/components/editor-notifications.js' */
AJS.bind("init.rte",function(d){var b="editor-notification-container";var e="editor-notification-message";var a=AJS.$('<div class="editor-notifications-container"></div>').attr("id",b);var c=AJS.$("<div></div>").attr("id",e);a.append(c);AJS.$("#wysiwyg").after(a);AJS.Confluence.EditorNotification={notify:function(f,g,i){AJS.messages[f]("#"+e,{body:g,closeable:true,shadowed:true});var h=AJS.$(".aui-message",a).last();if(!i){i=5000}else{i*=1000}setTimeout(function(){h.fadeOut("fast",function(){h.closeMessage();h=null})},i)}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:paste-resources', location = 'js/clipboard-access.js' */
(function(){

AJS.toInit(function($) {
    "use strict";
    var pasteHandler;
    pasteHandler = {
        initializeEditor: function() {
            if (AJS && AJS.Rte && AJS.Rte.BootstrapManager) {
                AJS.Rte.BootstrapManager.addOnInitCallback(function () {

                    var ed = AJS.Rte.getEditor();
                    if (ed) {
                        ed.onPaste.add(function (editor, e) {
                            if (pasteHandler.onPaste(e))
                                return true;
                            else {
                                tinymce.dom.Event.cancel(e);
                                return false;
                            }
                        });
                    }
                    else {
                        AJS.log("Could not getEditor from adapter");
                    }
                });
            }
            else {
                AJS.log("Could not initialize pasteHandler on Confluence.Editor");
            }
        },

        /**
         * searches the wysiwyg text area for embedded image data URLs and attaches them to the document
         * via the upload, then removes the data URI
         */
        pasteFromDataURL: function() {
            //firefox 4.0 inserts images as data urls
            var embeddedImgs = $('img[src^="data:image"]', tinymce.activeEditor.getDoc());
            $.each(embeddedImgs, function() {
                var imgNode = this;
                var data = imgNode.src.substring(22, imgNode.src.length);

                // calculate the unencoded image size, accounting for potential padding.
                var size = (data.length * 3) / 4;
                //count padded bytes, last two characters might be padding with the '=' char
                var paddedBytes = 0;
                for (var len = data.length, i = len - 1; data[i] == "="; i--) {
                    paddedBytes++;
                }

                AJS.Confluence.Uploader.upload([
                    pasteHandler.createUploadFile(data, size - paddedBytes, "base64")
                ]);
            });

            //remove all embedded images
            embeddedImgs.remove();
        },

        /**
         * onPaste handler, Either uses webkits clipboardData object on the paste event, or interprets
         * the data uri that has been embedded in the page by firefox.
         */
        onPaste: function(event) {
            // firefox 4.0 propagates paste events by inserting a data url into the content editable area.
            if ($.browser.mozilla && parseInt($.browser.version) >= 2) {
                //calls pasteFromDataURL at the end of the current render queue, i.e. once the current firefox paste event has completed.
                setTimeout(pasteHandler.pasteFromDataURL, 0);
                return true;
            } else if (event && event.clipboardData) {
                // webkit exposes a clipboardData object on the paste event
                // currently this only works on a mac, see: http://code.google.com/p/chromium/issues/detail?id=86085
                return pasteHandler.pasteFromEvent(event);
            }
            return true;
        },

        showClipboardAccessError: function() {
            new AJS.Dialog({
                width: 400,
                closeOnOutsideClick: true
            })
                .addPanel("alert", $("<div />", { text: "Your browser does not support pasting images from the clipboard." }))
                .addButton("OK", function(dialog) { dialog.remove(); })
                .show()
                .updateHeight();
        },

        /**
         * chrome supports clipboard data on the paste event, can read the image straight from it.
         * @param event
         */
        pasteFromEvent : function(event) {
            if (event && event.clipboardData) {

                if (event.clipboardData.items) {
                    var dataTransferItem = event.clipboardData.items[0];
                    if (!dataTransferItem || dataTransferItem.kind != "file")
                        return true;

                    var dataFile = dataTransferItem.getAsFile();
                    var uploadFile = pasteHandler.createUploadFile(dataFile, dataFile.size)
                    AJS.Confluence.Uploader.upload([uploadFile]);
                    return false;
                } else {
                    // Safari (and possibly other browsers) will
                    // allow the image to be pasted, but the data
                    // URI is not placed as the image's `src`
                    // attribute. It replaces it with a custom
                    // protocol, which can't be accessed via JavaScript.
                    setTimeout(function(me) {
                        var webkitFakeUrlImages = $("img[src^='webkit-fake-url://']", tinymce.activeEditor.getDoc());
                        if (webkitFakeUrlImages.length) {
                            webkitFakeUrlImages.remove();
                            me.showClipboardAccessError();
                        }
                    }, 0, this);
                }
            }
            return true;
        },

        /**
         * creates an upload file with an optionally specified encoding
         * @param data - the data to be uploaded, either as binary or base64 encoded
         * @param sz - the size of the decoded image
         * @param encoding - optional encoding, only base64 is currently supported.
         */
        createUploadFile: function(data, sz, encoding) {
            var curDate = new Date();
            var month = curDate.getMonth() + 1;
            return {
                fileName: "image" + curDate.getFullYear() + "-" + month + "-" + curDate.getDate() + " " +
                        curDate.getHours() + ":" + curDate.getMinutes() + ":" + curDate.getSeconds() + ".png",
                fileSize: sz,
                slice : function(offset, length) {
                    return data.slice(offset, offset + length);
                },
                getAsBinary : function() {
                    return data;
                },
                getData : function() {
                    return data;
                },
                encoding : encoding
            }
        }
    };

    pasteHandler.initializeEditor($);
    return pasteHandler;
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-confluence', location = 'js/autoconvert/transformers/confluencepaste.js' */
(function(){

AJS.bind("init.rte", function() {
	var pasteHandler =function(uri, node, done){
		if (!isConfluence(uri)) {
			done();
			return;
		}

        var stripContextPath = function(uri){
            return AJS.contextPath() ? uri.path.substring(AJS.contextPath().length + 1) : uri.path.substring(1);
        };

		var path = stripContextPath(uri),
			parts = decodeURIComponent(path).split('/'),
			linkString;

        // All URIs provided by the parseUri function should have *at least* an empty queryKey object but we'll guard
        // anyway.
        uri.queryKey = uri.queryKey || {};

        var addAnchorSuffix = function (linkString, uri) {
            if (!uri.anchor || uri.anchor.indexOf('comment-') === 0) {
                // Ignore anchors for focused comments; they're handled by the $ wiki markup.
                return linkString;
            }
            return linkString + '#' + uri.anchor.substring(uri.anchor.indexOf('-') + 1);
        }

        if (uri.queryKey.focusedCommentId) {
            //http://localhost:8080/confluence/display/ds/Home&focusedCommentId=1212425#comment-1212425
            //http://localhost:8080/confluence/pages/viewpage.action?pageId=32784&focusedCommentId=1212425#comment-1212425
            linkString = '$' + uri.queryKey.focusedCommentId;
            // HACK - although the anchor may be added it is currently ignored by the wiki converter.
            // In fact the "$12345" comment linkString above will be converted to a hard href, see CONF-24415.
            linkString = addAnchorSuffix(linkString, uri);
        } else if (uri.queryKey.pageId) {
            //http://localhost:8080/confluence/pages/viewpage.action?pageId=32784
            linkString = '$' + uri.queryKey.pageId;
            linkString = addAnchorSuffix(linkString, uri);
        }
        else if (parts[0] === 'display') {
            if (parts.length === 2 && parts[1].indexOf('~') === 0) {
                //http://localhost:8080/confluence/display/~admin
                linkString = parts[1];
            } else if (parts.length === 3) {
                //http://localhost:8080/confluence/display/ds/Home
                linkString =  parts[1] + ':' + parts[2].replace(/\+/g, ' ');
                linkString = addAnchorSuffix(linkString, uri);
            } else if (parts.length === 4 && parts[1] === "status") {
                //http://localhost:8080/confluence/display/status/admin/1212424
                linkString = '$' + parts[3];
            } else if (parts.length === 6) {
                //http://localhost:8080/confluence/display/ds/2011/10/27/jwafej+again+dog
                linkString = parts[1] + ':' + '/' + parts[2] + '/' + parts[3] + '/' + parts[4] + '/' + parts[5].replace(/\+/g, ' ');
                linkString = addAnchorSuffix(linkString, uri);
            }
        } else if (parts[0] == 'users') {
            if (parts.length == 2 && parts[1] == 'viewuserprofile.action') {
                // http://localhost:8090/confluence/users/viewuserprofile.action?username=admin
                linkString = '~' + uri.queryKey.username;
            } else if (parts.length == 2 && parts[1] == 'viewmyprofile.action') {
                linkString = '~' + AJS.Meta.get('remote-user');
            }
        }

        if (!linkString) {
            // Nothing matches this Confluence URI, leave it alone.
			done();
			return;
		}

		linkString = "[" + linkString + "]";
		tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup(
			linkString,
			function(data){
				done(AJS.$(data).children()[0]);
			},
			function(){
				done();
			});
	};

	var isConfluence = function(uri){
		var isConfluence = true;
		isConfluence = isConfluence && uri.authority === document.location.host;
		isConfluence = isConfluence && (!AJS.contextPath() || uri.path.indexOf(AJS.contextPath()) === 0);
		return isConfluence;
	};


	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-youtu.be-rewrite', location = 'js/autoconvert/transformers/youtube.js' */
(function(){

AJS.bind("init.rte", function() {    
    tinymce.plugins.Autoconvert.autoConvert.addHandler(function(uri, node, done){
        if (uri.host.match('.*youtu\.be.*')) {
            var vidId = uri.path.substr(1);
            var newurl = "http://youtube.com/watch?v=" + vidId;
            done (AJS.$(node).attr("href", newurl).html(newurl));
        } else { 
            done();
        }
    });
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-skitch', location = 'js/autoconvert/transformers/skitchpaste.js' */
(function(){

AJS.bind("init.rte", function() {
	AJS.Editor.SkitchPaste = {
		pasteHandler : function(uri,node, done){
			if (uri.host == 'www.skitch.com' || uri.host == 'skitch.com'){
				AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/skitchembed?url=' + uri.source, function(data){
					if (data && data.url){
						done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + data.url + '" data-image-src="' + data.url + '"/>')[0]);
					}
					else{
						done();
					}
				});
			}
			else{
				done();
			}
		}
	}
	tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.SkitchPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-cloudapp', location = 'js/autoconvert/transformers/cloudapppaste.js' */
(function(){
AJS.bind("init.rte", function() {
    AJS.Editor.CloudAppPaste = {
        pasteHandler : function(uri, node, done){
            if (uri.host == 'cl.ly') {
                AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/cloudappembed?resource=' + uri.path.substr(1), function(data){
					if (data){
                        switch(data.item_type) {
                            case 'image' :
                                var image = AJS.escapeHtml(data.content_url);
						        done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + image + '" data-image-src="' + image + '"/>')[0]);
                                break;
                            case 'bookmark' :
                                node.text(data.name);
                                node.attr('href', AJS.escapeHtml(data.redirect_url));
                                done(node);
                                break;
                        }
                        return;
					}
					else{
						done();
					}
				});
            } else {
                done();
                return;
            }
        }
    };
    tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.CloudAppPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-openphoto', location = 'js/autoconvert/transformers/openphoto.js' */
(function(){

AJS.bind("init.rte", function() {
    AJS.Editor.OpenPhotoPaste = {
        pasteHandler : function(uri, node, done){
            var openPhoto = uri.host.indexOf('openphoto.me'),
                dir = uri.directory,
                user, photoId;

            if (openPhoto !== -1 && openPhoto !== 0) {
                user = uri.host.substr(0, openPhoto - 1);
                photoId = dir.substr(dir.indexOf('photo/') + 6);
                photoId = photoId.substr(0, photoId.indexOf('/'));
                AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/openphotoembed?user=' + user + '&photo=' + photoId, function(data){
                    var image;
                    if (data && data.code == 200){
                        image = AJS.escapeHtml(data.result["path600x600"]);
                        done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + image + '" data-image-src="' + image + '"/>')[0]);
                        return;
					}
					else{
						done();
					}
				});
            } else {
                done();
                return;
            }
        }
    };
    tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.OpenPhotoPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-widget-connector', location = 'js/autoconvert/transformers/widgetpaste.js' */
AJS.bind("init.rte", function() {
    var pasteRegexes = [/youtube.com\/watch\?/, /vimeo.com\/[0-9]+/, /maps.google(.[a-z]+)+\/maps/, /[^\.]\.wufoo\.com\/(?:forms|reports)/];

	function pasteHandler(uri, node, done){
        var urlSrc = decodeURI(uri.source);

        for (var i = 0; i < pasteRegexes.length; i++){
            if (urlSrc.match(pasteRegexes[i])){
                var macro = {name:'widget', params: {url: urlSrc}};
                tinymce.plugins.Autoconvert.convertMacroToDom(macro, done, done);
                return;
            }
        }
        done();
    }

	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-widget-connector', location = 'js/autoconvert/transformers/flickrpaste.js' */
(function(){
AJS.bind("init.rte", function() {
    var tagPathRegex = /^\/photos\/tags\/[^/]+/,
        setPathRegex = /^\/photos\/[^/]+\/sets\/[0-9]+/,
        photoPathRegex = /^\/photos\/[^/]+\/[0-9]+/,
        pasteHandler = function(uri, node, done) {
            var decodedPath;

            if (uri.host.match(/flickr.com/)) {
                decodedPath = decodeURIComponent(uri.path);
                if (decodedPath.match(tagPathRegex) ||
                    decodedPath.match(setPathRegex) ||
                    decodedPath.match(photoPathRegex)) {
                    macro = {name:'widget', params: {url: decodeURI(uri.source)}};
                    tinymce.plugins.Autoconvert.convertMacroToDom(macro, done, done);
                }
                else {
                    done();
                }
            }
            else {
                done();
            }
		};
	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-shortcut-links', location = 'js/autoconvert/transformers/shortcutlinks.js' */
(function(){

AJS.bind("init.rte", function() {    
    var shortcutLinkConfigurations = [];
    var contextPath;
    if (AJS.contextPath()) {
        contextPath = AJS.contextPath();
    } else {
        contextPath = "";
    }

    var loadShortcutLinkConfiguration = function () {
        AJS.$.ajax({
            url: contextPath + "/rest/autoconvert/latest/shortcutlinkconfigurations",
            type: "GET",
            dataType: "json",
            success: function(data) {
                shortcutLinkConfigurations = data["configurations"];
                for (var i = 0; i < shortcutLinkConfigurations.length; i++) {
                    var config = shortcutLinkConfigurations[i];
                    try {
                        config.regex = new RegExp(translateToRegex(config.expandedValue, config.defaultAlias));
                    } catch(e) {
                        console.log('Failed to generated regex for ' + config);
                    }
                }
            },
            error: function(response)
            {
                console.log('Failed to load shortcut link configurations ' + response.statusText);
            }
        });
    }

    var translateToRegex = function (expandedValue, defaultAlias) {
        if (expandedValue.indexOf("%s") >= 0)
        {
            return expandedValue.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&").replace("%s", "(.*)");
        }
        return expandedValue.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") + "(.*)";
    };

	var pasteHandler = function(uri, node, done){
		if (uri.source !== node.text()) {
			done();
			return;
		}
        for (var i = 0; i < shortcutLinkConfigurations.length; i++) {
            var shortcutLinkConfig = shortcutLinkConfigurations[i];
            var matches = uri.source.match(shortcutLinkConfig.regex);
            if (matches) {
                var q = matches[1];
                if (shortcutLinkConfig.defaultAlias) {
                    var newText = shortcutLinkConfig.defaultAlias.replace(/%s/, q);
                    done(AJS.$(node).text(newText));
                    return;
                }
                done(AJS.$(node).text(q));
                return;
            }
        }
		done();
	};
	
	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
	setTimeout(function(){
		loadShortcutLinkConfiguration();
	}, 0);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-google-redirect', location = 'js/autoconvert/transformers/google-redirect-convert.js' */
(function(){
AJS.bind("init.rte", function() {
	var pasteHandler = function(uri, node, done){
        if (uri.host.match(/google.*/) && uri.path === "/url" && uri.queryKey && uri.queryKey.url) {
            var newUri = decodeURIComponent(uri.queryKey.url);
            node = AJS.$(node);
            // currently need to do both of these due to the editor storage format
            node.attr('href', newUri);
            node.attr('data-mce-href', newUri);
            node.text(newUri);
            done(node);
        } else {
            done();
        }

	};

	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/reliable-save.js' */
(function(B){var A=function(){if(!AJS.DarkFeatures.isEnabled("editor.ajax.save")){return 
}var M="rte_safe_save_offline_error_container";
function L(){Confluence.Editor.UI.toggleSavebarBusy(true,true)
}function K(){Confluence.Editor.UI.toggleSavebarBusy(false)
}Confluence.Editor=Confluence.Editor||{};
Confluence.Editor.SafeSave=Confluence.Editor.SafeSave||{};
Confluence.Editor.SafeSave._internal=Confluence.Editor.SafeSave._internal||{};
Confluence.Editor.SafeSave._internal.onSuccessfulResponse=function(O){AJS.trigger("rte.safe-save.success",O);
var N=O.redirectUrl;
if(!N){AJS.logError("expected redirectUrl field not found in response");
return 
}if(N.indexOf("/")!=0){window.location=N
}else{window.location=AJS.params.contextPath+N
}};
function D(Q,P){var N=Confluence.getContextPath()+"/rest/tinymce/1/content/"+Q+".json";
var O=B.ajax({url:N,cache:false});
O.success(function(R){P(null,R.atlToken)
});
O.error(function(){P("error accessing the rest endpoint")
})
}function J(O){AJS.trigger("rte.safe-save.invalid",O);
for(var N=0;
N<O.length;
N++){Confluence.Editor.addErrorMessage("validation",O[N])
}K()
}var H=false;
function G(N){if(N.status===403){AJS.trigger("rte.safe-save.invalid-xsrf-token");
if(!H){D(AJS.Meta.get("content-id"),function(P,O){H=true;
if(P){Confluence.Editor.addErrorMessage(M,"There was an error processing the request.");
AJS.logError(P)
}else{AJS.log("xsrf token updated");
B("input[name=atl_token]",F).val(O);
AJS.Meta.set("atl-token",O);
AJS.trigger("analyticsEvent",{name:"reliable-save-xsrf-token-expired"});
K();
Confluence.Editor.UI.saveButton.click()
}});
return 
}}H=false;
AJS.trigger("rte.safe-save.error");
Confluence.Editor.addErrorMessage(M,"Unable to communicate with server. Saving is not possible at the moment.");
Confluence.Editor.heartbeatType.recovery();
K()
}function C(){return Confluence.Editor.UI.isFormEnabled()
}var F=B("form.editor");
if(!F.length){return 
}var I=F.attr("action");
I=I.replace("docreatepage.action","docreatepage_ajax.action");
I=I.replace("doeditpage.action","doeditpage_ajax.action");
I=I.replace("docreateblogpost.action","docreateblogpost_ajax.action");
I=I.replace("doeditblogpost.action","doeditblogpost_ajax.action");
if(I.indexOf("_ajax")==-1){AJS.logError("no ajaxified action found on safe-save plugin");
return 
}F.attr("action",I);
F.ajaxForm({beforeSubmit:C,error:G,success:function(Q,O,P,N){H=false;
Confluence.Editor.heartbeatType.normal();
if(Q.actionErrors){J(Q.actionErrors)
}else{Confluence.Editor.SafeSave._internal.onSuccessfulResponse(Q)
}}});
AJS.log("reliable save ready!");
var E=false;
AJS.bind("rte.heartbeat-error",function(N,O){AJS.log("reliable-save: heartbeat - error");
Confluence.Editor.addErrorMessage(M,"Unable to communicate with server. Saving is not possible at the moment.");
E=true;
L()
});
AJS.bind("rte.heartbeat",function(N){if(E){AJS.log("reliable-save: heartbeat - back to business!");
AJS.$("#"+M).fadeOut().remove();
E=false;
K()
}})
};
AJS.bind("rte.init.ui",A)
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/ajax-login.js' */
AJS.toInit(function(E){if(!AJS.DarkFeatures.isEnabled("ajax.login")){return 
}AJS.log("AJAX login support enabled");
var B=false;
var G;
var D;
var M;
var N=[];
var L=E.ajax;
var J=AJS.Meta.get("remote-user");
var I=AJS.Meta.get("base-url");
var C=AJS.Meta.get("context-path");
var K="ajaxlogincomplete.action";
var H=AJS.Meta.get("context-path")+"/login.action?os_destination=%2F"+K;
function F(P,Q){var R=P&&P.url;
return J&&(!Q||Q&&!Q.preventAjaxLogin)&&R&&(I&&R.indexOf(I)===0||C&&R.indexOf(C)===0)
}function O(P,R,Q){AJS.log("Using authenticatingPromise");
var S={abort:function(){Q.abort.apply(Q,arguments)
},getAllResponseHeaders:function(){Q.getAllResponseHeaders.apply(Q,arguments)
},getResponseHeader:function(){Q.getResponseHeader.apply(Q,arguments)
},overrideMimeType:function(){Q.overrideMimeType.apply(Q,arguments)
},readyState:Q.readyState,setRequestHeader:function(Z,a){Q.setRequestHeader.apply(Q,arguments)
},state:function(){Q.state.apply(Q,arguments)
},status:Q.status,statusCode:function(){Q.statusCode.apply(Q,arguments)
},statusText:Q.statusText};
var X=E.Deferred();
X.promise(S);
S.success=S.done;
S.error=S.fail;
function W(Z){var a=Z.getResponseHeader("X-AUSERNAME");
return J===a
}function Y(c){for(var b=0,a=c.length;
b<a;
b++){var Z=c[b];
AJS.log("Rerunning ajax query to: "+Z.url,Z);
L.call(E,Z.url,Z.settings).done(function(){AJS.log("Rerunning done");
Z.deferred.resolve(arguments)
}).fail(function(){AJS.log("Rerunning failed");
Z.deferred.reject(arguments)
})
}}function U(c){for(var b=0,a=c.length;
b<a;
b++){var Z=c[b];
AJS.log("Executing with original response for: "+Z.url,Z);
Z.defaultCallback&&Z.defaultCallback()
}}function V(a){N.push({deferred:X,url:P,settings:R,defaultCallback:a});
if(B){return 
}M=false;
if(!G){G=new AJS.Dialog(840,700);
G.addPanel("ajax-login","ajax-login-content","ajax-login-panel",1);
var Z=E(".ajax-login-panel");
D=E("<iframe></iframe>");
D.bind("load",function(c){var b=D[0].contentDocument.location.pathname;
if(b&&b.indexOf("/"+K)>=0){B=false;
M=true;
G.hide();
D.attr("src","about:blank")
}});
Z.append(D);
E(document).bind("hideLayer",function(d,c,b){if(c==="popup"&&b===G.popup){AJS.log("hiding login dialog");
if(M){Y(N);
N=[]
}else{U(N);
N=[]
}}})
}D.attr("src",H);
G.show();
B=true
}function T(b,d,Z,a){function c(){S.readyState=b.readyState;
S.status=b.status;
S.statusText=b.statusText;
if(b.responseXML){S.responseXML=b.responseXML
}else{S.responseText=b.responseText
}d.apply(Z,a)
}if(W(b)){c()
}else{V(c)
}}Q.done(function(Z,b,a){T(a,X.resolve,X,arguments)
});
Q.fail(function(a,b,Z){T(a,X.reject,X,arguments)
});
return S
}function A(P,Q){var R=L.call(E,P,Q);
if(F(P,Q)){return O(P,Q,R)
}return R
}E.ajax=A
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:ConfluenceSortableTablesEditorPlugin', location = 'js/editor_plugin_src.js' */
(function ($) {
    /**
     * The only thing this plugin does is check on paste to see if a sortable table has been pasted
     * from a view page and if it has, revert it back into something the editor has an easy time manipulating.
     */
    tinymce.create('tinymce.plugins.ConfluenceSortableTablesPlugin', {
        init: function (ed) {
            $(document).bind('postPaste', function (e, pl, o) {
                var tables = $('.tablesorter', o.node);
                tables.each(function(i, current){
                    var thead = $(current).find('thead'),
                        tbody, firstTr;

                    if (thead.length !== 1) {
                        return;
                    }
                    thead = thead[0];

                    if (thead.nodeName === 'THEAD' && thead.childNodes.length === 1) {
                        firstTr = thead.removeChild(thead.childNodes[0]);
                        tbody = $(current).find('tbody')[0];
                        current.removeChild(thead);
                        tbody.insertBefore(firstTr, tbody.childNodes[0]);
                    }
                });
            });
        },
        getInfo: function () {
            return {
                longname: 'ConfluenceSortableTablesPlugin',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
    });

    tinymce.PluginManager.add('confluencesortabletablesplugin', tinymce.plugins.ConfluenceSortableTablesPlugin);
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:common-resources', location = 'templates/extra/jira/common.js' */
AJS.JiraIssues={Remote:{}};var appLinksI18n={entries:{}};jQuery(document).ready(function(){AJS.JiraIssues=jQuery.extend(AJS.JiraIssues||{},{bindOAuthLink:function(c,f){var e={onSuccess:function(){f()},onFailure:function(){}};var d=c.attr("href");c.click(function(g){AppLinks.authenticateRemoteCredentials(d,e.onSuccess,e.onFailure);g.preventDefault()})},getOAuthRealm:function(f){var d=f.getResponseHeader("WWW-Authenticate")||"";var c=/OAuth realm\=\"([^\"]+)\"/;var e=c.exec(d);if(e){return e[1]}else{return null}}});jQuery("a.static-oauth-init").each(function(){AJS.JiraIssues.bindOAuthLink(jQuery(this),function(){window.location.reload()})});jQuery("a.anonymous-init").each(function(f,e){var c=encodeURIComponent(window.location.pathname.replace(Confluence.getContextPath(),""));var d=Confluence.getContextPath()+"/login.action?os_destination="+c;$(e).attr("href",d)});var a=function(j){var e=AJS.JiraIssues.Remote[j];var h="";for(var g=0;g<e.length;g++){h=h+(e[g].key+(g<e.length-1?",":""))}var d=function(l){var i="issuekey in ("+l+")";var m="/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+encodeURIComponent(i)+"&returnMax=true";var k=contextPath+"/plugins/servlet/issue-retriever?appId="+j+"&url="+encodeURIComponent(m)+"&columns=summary&columns=type&columns=resolution&columns=status";return k};var f=function(k){var i=AJS.$("item",k);i.each(function(){var u=AJS.$("link",this).text();var v=AJS.$("key",this).text();var r=AJS.$("summary",this).text();var s=AJS.$("type",this);var m=AJS.$("resolution",this);var w=m.attr("id")!="-1";var o=AJS.$("status",this);var n=AJS.$(".unknown-jira-issue."+v);for(var p=0;p<n.length;p++){var t=AJS.$("<a style=\"background-image: url('"+s.attr("iconUrl")+'\')" href="'+u+'"></a>');t.text(v);var l=AJS.$('<span class="jira-status"></span>');l.text(o.text().toUpperCase());var q=AJS.$('<span class="jira-issue'+(w?" resolved":"")+'" ></span>');q.append(t);q.append(document.createTextNode(" - "+r+" - "));q.append(l);AJS.$(n[p]).replaceWith(q)}})};var c=d(h);AJS.$.ajax({url:c,success:f,error:function(l){if(l.status==401){var k=AJS.JiraIssues.getOAuthRealm(l);if(k){var i={};AJS.$(e).each(function(){if(!i[this.key]){i[this.key]=true;var m=AJS.$('<span class="oauth-msg"> - <a class="oauth-init" href="'+k+'">'+"Authenticate"+"</a> "+"to see issue details"+"</span>");AJS.$(".unknown-jira-issue."+this.key).addClass("single-issue-oauth").append(m)}});AJS.JiraIssues.bindOAuthLink(AJS.$(".single-issue-oauth a.oauth-init"),function(){window.location.reload()})}}else{if(l.status==400&&e.length>1){AJS.$(e).each(function(){var m=this.key;var n=d(m);AJS.$.ajax({url:n,success:f,error:function(p){var o=AJS.$(".unknown-jira-issue."+m);o.removeClass("single-issue-oauth");AJS.$(".oauth-msg",o).remove();o.addClass("jira-error")}})})}}}})};AJS.$(".unknown-jira-issue").each(function(e,f){var d=AJS.$(f);var g=d.attr("data-app-link");var c=d.attr("data-key");AJS.JiraIssues.Remote[g]=AJS.JiraIssues.Remote[g]||[];AJS.JiraIssues.Remote[g].push({key:c})});for(var b in AJS.JiraIssues.Remote){a(b)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:refresh-resources', location = '/jira/refresh.js' */
(function(b){var c={REFRESH_STATE_STARTED:1,REFRESH_STATE_DONE:2,REFRESH_STATE_FAILED:3,refreshs:[],init:function(){a.getAll().each(function(){c.registerRefresh(this.getRefresh())});b.each(this.refreshs,function(d,e){var f=a.get(e.id);f.getRefreshButton().bind("click",e,c.handleRefreshClick);f.getRefreshLink().bind("click",e,c.handleRefreshClick)})},replaceRefresh:function(e,d){b.each(this.refreshs,function(g,h){if(h.id===e){c.refreshs.splice(g,1);var j=a.get(d);var f=j.getRefresh();c.registerRefresh(f);j.getRefreshButton().bind("click",f,c.handleRefreshClick);j.getRefreshLink().bind("click",f,c.handleRefreshClick);return}})},registerRefresh:function(d){if(!(d instanceof c.Refresh)){throw "Refresh object must be an instance of RefreshMacro.Refresh"}c.refreshs.push(d)},handleRefreshClick:function(g){var d=g.data;var f=a.get(d.id);f.getMacroPanel().html(d.loadingMsg);f.updateRefreshVisibility(c.REFRESH_STATE_STARTED);c.processRefresh(d)},processRefresh:function(d){AJS.$.ajax({type:"POST",dataType:"html",url:Confluence.getContextPath()+"/plugins/servlet/jiraRefreshRenderer",data:{pageId:d.pageId,wikiMarkup:d.wiki},success:function(f){var e=b(f).attr("id");if(e){e=e.replace("refresh-module-","");a.get(d.id).getContentModule().replaceWith(f);new c.CallbackSupport(d).callback(e)}else{new c.CallbackSupport(d).errorHandler(f)}},error:function(f,g,e){new c.CallbackSupport(d).errorHandler(e)}})}};c.Refresh=function(e,d){this.id=e;this.wiki=d;this.pageId=arguments.length>2?arguments[2]:null;this.loadingMsg=arguments.length>3?arguments[3]:null};c.CallbackSupport=function(d){this.refresh=d;this.module=b("#refresh-module-"+d.id)};c.CallbackSupport.prototype={errorHandler:function(e){var f=a.get(this.refresh.id);var d=AJS.format("There was a problem rendering this section: {0}",e);f.getMacroPanel().html("<p>"+d+"</p>");f.updateRefreshVisibility(c.REFRESH_STATE_FAILED)},callback:function(d){c.replaceRefresh(this.refresh.id,d)}};var a=function(){if(arguments.length==1){this.id=arguments[0]}};a.prototype.getRefresh=function(){return new c.Refresh(this.id,this.getWikiMarkup(),this.getPageId(),this.getMacroPanel().html())};a.get=function(e){var d=b("#refresh-"+e);if(!d){return null}return new a(e)};a.getAll=function(){return b("div.refresh-macro").map(function(){var d=this.id.replace("refresh-","");return a.get(d)})};a.prototype.getMacroPanel=function(){return b("#refresh-"+this.id)};a.prototype.getContentModule=function(){return b("#refresh-module-"+this.id)};a.prototype.getPageId=function(){return b("#refresh-page-id-"+this.id).val()};a.prototype.getWikiMarkup=function(){return b("#refresh-wiki-"+this.id).val()};a.prototype.getRefreshButton=function(){return b("#refresh-issues-button-"+this.id)};a.prototype.getRefreshLink=function(){return b("#refresh-issues-link-"+this.id)};a.prototype.getJiraIssuesArea=function(){return b("#jira-issues-"+this.id)};a.prototype.getIssuesCountArea=function(){return b("#total-issues-count-"+this.id)};a.prototype.updateRefreshVisibility=function(d){if(d===c.REFRESH_STATE_STARTED){this.getJiraIssuesArea().hide();this.getRefreshButton().hide();this.getRefreshLink().hide();this.getIssuesCountArea().hide();this.getMacroPanel().show()}else{if(d===c.REFRESH_STATE_FAILED){this.getRefreshButton().show();this.getRefreshLink().show()}else{if(d===c.REFRESH_STATE_DONE){}}}};b(function(){c.init()})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:web-resources', location = 'resources/flexigrid/flexigrid.js' */
(function($){$.addFlex=function(t,p){if(t.grid){return false}p=$.extend({height:200,width:"auto",striped:true,novstripe:false,minwidth:30,minheight:80,resizable:true,url:false,method:"POST",dataType:"xml",errormsg:"Connection Error",usepager:false,nowrap:true,page:1,total:1,useRp:true,rp:15,rpOptions:[10,15,20,25,40],title:false,pagestat:"Displaying {from} to {to} of {total} items",procmsg:"Processing, please wait ...",query:"",qtype:"",nomsg:"No items",minColToggle:1,showToggleBtn:true,hideOnSubmit:true,autoload:true,blockOpacity:0.5,onToggleCol:false,onChangeSort:false,onSuccess:false,onSubmit:false,onReload:false},p);$(t).show().attr({cellPadding:0,cellSpacing:0,border:0}).removeAttr("width");var g={hset:{},rePosDrag:function(){var cdleft=0-this.hDiv.scrollLeft;if(this.hDiv.scrollLeft>0){cdleft-=Math.floor(p.cgwidth/2)}$(g.cDrag).css({top:g.hDiv.offsetTop+1});var cdpad=this.cdpad;$("div",g.cDrag).hide();$("thead tr:first th:visible",this.hDiv).each(function(){var n=$("thead tr:first th:visible",g.hDiv).index(this);var cdpos=parseInt($("div",this).width());var ppos=cdpos;if(cdleft==0){cdleft-=Math.floor(p.cgwidth/2)}cdpos=cdpos+cdleft+cdpad;$("div:eq("+n+")",g.cDrag).css({left:cdpos+"px"}).show();cdleft=cdpos})},fixHeight:function(newH){newH=false;if(!newH){newH=$(g.bDiv).height()}var hdHeight=$(this.hDiv).height();$("div",this.cDrag).each(function(){$(this).height(newH+hdHeight)});var nd=parseInt($(g.nDiv).height());if(nd>newH){$(g.nDiv).height(newH).width(200)}else{$(g.nDiv).height("auto").width("auto")}$(g.block).css({height:newH,marginBottom:(newH*-1)});var hrH=g.bDiv.offsetTop+newH;if(p.height!="auto"&&p.resizable){hrH=g.vDiv.offsetTop}$(g.rDiv).css({height:hrH})},dragStart:function(dragtype,e,obj){if(dragtype=="colresize"){$(g.nDiv).hide();$(g.nBtn).hide();var n=$("div",this.cDrag).index(obj);var ow=$("th:visible div:eq("+n+")",this.hDiv).width();$(obj).addClass("dragging").siblings().hide();$(obj).prev().addClass("dragging").show();this.colresize={startX:e.pageX,ol:parseInt(obj.style.left),ow:ow,n:n};$("body").css("cursor","col-resize")}else{if(dragtype=="vresize"){var hgo=false;$("body").css("cursor","row-resize");if(obj){hgo=true;$("body").css("cursor","col-resize")}this.vresize={h:p.height,sy:e.pageY,w:p.width,sx:e.pageX,hgo:hgo}}else{if(dragtype=="colMove"){$(g.nDiv).hide();$(g.nBtn).hide();this.hset=$(this.hDiv).offset();this.hset.right=this.hset.left+$("table",this.hDiv).width();this.hset.bottom=this.hset.top+$("table",this.hDiv).height();this.dcol=obj;this.dcoln=$("th",this.hDiv).index(obj);this.colCopy=document.createElement("div");this.colCopy.className="colCopy";this.colCopy.innerHTML=obj.innerHTML;if($.browser.msie){this.colCopy.className="colCopy ie"}$(this.colCopy).css({position:"absolute","float":"left",display:"none",textAlign:obj.align});$("body").append(this.colCopy);$(this.cDrag).hide()}}}$("body").noSelect()},dragMove:function(e){if(this.colresize){var n=this.colresize.n;var diff=e.pageX-this.colresize.startX;var nleft=this.colresize.ol+diff;var nw=this.colresize.ow+diff;if(nw>p.minwidth){$("div:eq("+n+")",this.cDrag).css("left",nleft);this.colresize.nw=nw}}else{if(this.vresize){var v=this.vresize;var y=e.pageY;var diff=y-v.sy;if(!p.defwidth){p.defwidth=p.width}if(p.width!="auto"&&!p.nohresize&&v.hgo){var x=e.pageX;var xdiff=x-v.sx;var newW=v.w+xdiff;if(newW>p.defwidth){this.gDiv.style.width=newW+"px";p.width=newW}}var newH=v.h+diff;if((newH>p.minheight||p.height<p.minheight)&&!v.hgo){this.bDiv.style.height=newH+"px";p.height=newH;this.fixHeight(newH)}v=null}else{if(this.colCopy){$(this.dcol).addClass("thMove").removeClass("thOver");if(e.pageX>this.hset.right||e.pageX<this.hset.left||e.pageY>this.hset.bottom||e.pageY<this.hset.top){$("body").css("cursor","move")}else{$("body").css("cursor","pointer")}$(this.colCopy).css({top:e.pageY+10,left:e.pageX+20,display:"block"})}}}},dragEnd:function(){if(this.colresize){var n=this.colresize.n;var nw=this.colresize.nw;$("th:visible div:eq("+n+")",this.hDiv).css("width",nw);$("tr",this.bDiv).each(function(){$("td:visible div:eq("+n+")",this).css("width",nw)});this.hDiv.scrollLeft=this.bDiv.scrollLeft;$("div:eq("+n+")",this.cDrag).siblings().show();$(".dragging",this.cDrag).removeClass("dragging");this.rePosDrag();this.fixHeight();this.colresize=false}else{if(this.vresize){this.vresize=false}else{if(this.colCopy){$(this.colCopy).remove();if(this.dcolt!=null){if(this.dcoln>this.dcolt){$("th:eq("+this.dcolt+")",this.hDiv).before(this.dcol)}else{$("th:eq("+this.dcolt+")",this.hDiv).after(this.dcol)}this.switchCol(this.dcoln,this.dcolt);$(this.cdropleft).remove();$(this.cdropright).remove();this.rePosDrag()}this.dcol=null;this.hset=null;this.dcoln=null;this.dcolt=null;this.colCopy=null;$(".thMove",this.hDiv).removeClass("thMove");$(this.cDrag).show()}}}$("body").css("cursor","default");$("body").noSelect(false)},toggleCol:function(cid,visible){var ncol=$("th[axis='col"+cid+"']",this.hDiv)[0];var n=$("thead th",g.hDiv).index(ncol);var cb=$("input[value="+cid+"]",g.nDiv)[0];if(visible==null){visible=ncol.hide}if($("input:checked",g.nDiv).length<p.minColToggle&&!visible){return false}if(visible){ncol.hide=false;$(ncol).show();cb.checked=true}else{ncol.hide=true;$(ncol).hide();cb.checked=false}$("tbody tr",t).each(function(){if(visible){$("td:eq("+n+")",this).show()}else{$("td:eq("+n+")",this).hide()}});this.rePosDrag();if(p.onToggleCol){p.onToggleCol(cid,visible)}return visible},switchCol:function(cdrag,cdrop){$("tbody tr",t).each(function(){if(cdrag>cdrop){$("td:eq("+cdrop+")",this).before($("td:eq("+cdrag+")",this))}else{$("td:eq("+cdrop+")",this).after($("td:eq("+cdrag+")",this))}});if(cdrag>cdrop){$("tr:eq("+cdrop+")",this.nDiv).before($("tr:eq("+cdrag+")",this.nDiv))}else{$("tr:eq("+cdrop+")",this.nDiv).after($("tr:eq("+cdrag+")",this.nDiv))}if($.browser.msie&&$.browser.version<7){$("tr:eq("+cdrop+") input",this.nDiv)[0].checked=true}this.hDiv.scrollLeft=this.bDiv.scrollLeft},scroll:function(){this.hDiv.scrollLeft=this.bDiv.scrollLeft;this.rePosDrag()},addData:function(data){if(p.preProcess){data=p.preProcess(data)}$(".pReload",this.pDiv).removeClass("loading");this.loading=false;if(!data){$(".pPageStat",this.pDiv).html(p.errormsg);return false}if(p.dataType=="xml"){p.total=+$("rows total",data).text()}else{p.total=data.total}if(p.total==0){$("tr, a, td, div",t).unbind();$(t).empty();p.pages=1;p.page=1;this.buildpager();$(".pPageStat",this.pDiv).html(p.nomsg);return false}p.pages=Math.ceil(p.total/p.rp);if(p.dataType=="xml"){p.page=+$("rows page",data).text()}else{p.page=data.page}this.buildpager();var tbody=document.createElement("tbody");if(p.dataType=="json"){$.each(data.rows,function(i,row){var tr=document.createElement("tr");if(i%2&&p.striped){tr.className="erow"}if(row.id){tr.id="row"+row.id}$("thead tr:first th",g.hDiv).each(function(){var td=document.createElement("td");var idx=$(this).attr("axis").substr(3);td.align=this.align;td.innerHTML=row.cell[idx];td.nowrap=this.nowrap;$(tr).append(td);td=null});if($("thead",this.gDiv).length<1){for(idx=0;idx<cell.length;idx++){var td=document.createElement("td");td.innerHTML=row.cell[idx];$(tr).append(td);td=null}}$(tbody).append(tr);tr=null})}else{if(p.dataType=="xml"){i=1;$("rows row",data).each(function(){i++;var tr=document.createElement("tr");if(i%2&&p.striped){tr.className="erow"}var nid=$(this).attr("id");if(nid){tr.id="row"+nid}nid=null;var robj=this;$("thead tr:first th",g.hDiv).each(function(){var td=document.createElement("td");var idx=$(this).attr("axis").substr(3);td.align=this.align;td.innerHTML=$("cell:eq("+idx+")",robj).text();$(tr).append(td);td=null});if($("thead",this.gDiv).length<1){$("cell",this).each(function(){var td=document.createElement("td");td.innerHTML=$(this).text();$(tr).append(td);td=null})}$(tbody).append(tr);tr=null;robj=null})}}$("tr",t).unbind();$(t).empty();$(t).append(tbody);this.addCellProp();this.addRowProp();this.rePosDrag();if(p.onSuccess){p.onSuccess(data)}if(p.hideOnSubmit){$(g.block).remove()}this.hDiv.scrollLeft=this.bDiv.scrollLeft;if($.browser.opera){$(t).css("visibility","visible")}tbody=null;data=null;i=null},changeSort:function(th){if(this.loading){return true}$(g.nDiv).hide();$(g.nBtn).hide();if(p.sortname==$(th).attr("abbr")){if(p.sortorder=="asc"){p.sortorder="desc"}else{p.sortorder="asc"}}$(th).addClass("sorted").siblings().removeClass("sorted");$(".sdesc",this.hDiv).removeClass("sdesc");$(".sasc",this.hDiv).removeClass("sasc");$("div",th).addClass("s"+p.sortorder);p.sortname=$(th).attr("abbr");if(p.onChangeSort){p.onChangeSort(p.sortname,p.sortorder)}else{this.populate()}},buildpager:function(){$(".pcontrol input",this.pDiv).val(p.page);$(".pcontrol span",this.pDiv).html(p.pages);var r1=(p.page-1)*p.rp+1;var r2=r1+p.rp-1;if(p.total<r2){r2=p.total}var stat=p.pagestat;stat=stat.replace(/{from}/,r1);stat=stat.replace(/{to}/,r2);stat=stat.replace(/{total}/,p.total);$(".pPageStat",this.pDiv).html(stat);if(p.pages==1){var groupIndex=0;if(p.useRp){groupIndex--}if(p.searchitems){groupIndex--}$(".pGroup",g.pDiv).each(function(){if(groupIndex>=0&&groupIndex<3){$(this).css("opacity","0.3");$(".pButton",this).each(function(){$(this).css("cursor","default");$(this).hover(function(){$(this).css({border:"0px",width:"22px",height:"22px",cursor:"default"});$("span",this).each(function(){$(this).css({border:"0px",width:"22px",height:"22px",cursor:"default"})})},function(){})});$("input",this).each(function(){$(this).attr("readonly","true")})}groupIndex++})}else{$(g.gDiv).find(".pFirst, .pPrev").each(function(){if(p.page==1){$(this).removeClass("pBtnOver");$(this).css({cursor:"default",opacity:"0.3"})}else{$(this).css({cursor:"pointer",opacity:"1.0"})}});$(g.gDiv).find(".pLast, .pNext").each(function(){if(p.page==p.pages){$(this).removeClass("pBtnOver");$(this).css({cursor:"default",opacity:"0.3"})}else{$(this).css({cursor:"pointer",opacity:"1.0"})}})}},populate:function(){if(this.loading){return true}if(p.onSubmit){var gh=p.onSubmit();if(!gh){return false}}this.loading=true;if(!p.url){return false}$(".pPageStat",this.pDiv).html(p.procmsg);$(".pReload",this.pDiv).addClass("loading");$(g.block).css({top:g.bDiv.offsetTop});if(p.hideOnSubmit){$(this.gDiv).prepend(g.block)}if($.browser.opera){$(t).css("visibility","hidden")}if(!p.newp){p.newp=1}if(p.page>p.pages){p.page=p.pages}var param=[{name:"page",value:p.newp},{name:"rp",value:p.rp},{name:"sortname",value:p.sortname},{name:"sortorder",value:p.sortorder},{name:"query",value:p.query},{name:"qtype",value:p.qtype}];if(p.params){for(var pi=0;pi<p.params.length;pi++){param[param.length]=p.params[pi]}}$.ajax({type:p.method,url:p.url,data:param,dataType:"text",success:function(data){var obj=data;if(p.dataType=="json"&&$.isPlainObject&&!$.isPlainObject(data)){obj=eval("("+data+")")}g.addData(obj)},error:function(xmlhttprequest,textmsg,error){try{if(p.onError){p.onError(xmlhttprequest,textmsg,error)}}catch(e){}}})},doSearch:function(){p.query=$("input[name=q]",g.sDiv).val();p.qtype=$("select[name=qtype]",g.sDiv).val();p.newp=1;this.populate()},changePage:function(ctype){if(this.loading){return true}switch(ctype){case"first":p.newp=1;break;case"prev":if(p.page>1){p.newp=parseInt(p.page)-1}break;case"next":if(p.page<p.pages){p.newp=parseInt(p.page)+1}break;case"last":p.newp=p.pages;break;case"input":var nv=parseInt($(".pcontrol input",this.pDiv).val());if(isNaN(nv)){nv=1}if(nv<1){nv=1}else{if(nv>p.pages){nv=p.pages}}$(".pcontrol input",this.pDiv).val(nv);p.newp=nv;break}if(p.newp==p.page){return false}if(p.onChangePage){p.onChangePage(p.newp)}else{this.populate()}},addCellProp:function(){$("tbody tr td",g.bDiv).each(function(){var tdDiv=document.createElement("div");var n=$("td",$(this).parent()).index(this);var pth=$("th:eq("+n+")",g.hDiv).get(0);if(pth!=null){if(p.sortname==$(pth).attr("abbr")&&p.sortname){this.className="sorted"}$(tdDiv).css({textAlign:pth.align,width:$("div:first",pth)[0].style.width});if(pth.hide){$(this).css("display","none")}}if(this.nowrap==false){$(tdDiv).css("white-space","normal")}if(this.innerHTML==""){this.innerHTML="&nbsp;"}tdDiv.innerHTML=this.innerHTML;var prnt=$(this).parent()[0];var pid=false;if(prnt.id){pid=prnt.id.substr(3)}if(pth!=null){if(pth.process){pth.process(tdDiv,pid)}}$(this).empty().append(tdDiv).removeAttr("width")})},getCellDim:function(obj){var ht=parseInt($(obj).height());var pht=parseInt($(obj).parent().height());var wt=parseInt(obj.style.width);var pwt=parseInt($(obj).parent().width());var top=obj.offsetParent.offsetTop;var left=obj.offsetParent.offsetLeft;var pdl=parseInt($(obj).css("paddingLeft"));var pdt=parseInt($(obj).css("paddingTop"));return{ht:ht,wt:wt,top:top,left:left,pdl:pdl,pdt:pdt,pht:pht,pwt:pwt}},addRowProp:function(){$("tbody tr",g.bDiv).each(function(){$(this).click(function(e){var obj=(e.target||e.srcElement);if(obj.href||obj.type){return true}$(this).toggleClass("trSelected");if(p.singleSelect){$(this).siblings().removeClass("trSelected")}}).mousedown(function(e){if(e.shiftKey){$(this).toggleClass("trSelected");g.multisel=true;this.focus();$(g.gDiv).noSelect()}}).mouseup(function(){if(g.multisel){g.multisel=false;$(g.gDiv).noSelect(false)}}).hover(function(e){if(g.multisel){$(this).toggleClass("trSelected")}},function(){});if($.browser.msie&&$.browser.version<7){$(this).hover(function(){$(this).addClass("trOver")},function(){$(this).removeClass("trOver")})}})},pager:0};if(p.colModel){thead=document.createElement("thead");tr=document.createElement("tr");for(i=0;i<p.colModel.length;i++){var cm=p.colModel[i];var th=document.createElement("th");th.innerHTML=cm.display;if(cm.name&&cm.sortable){$(th).attr("abbr",cm.name)}$(th).attr("axis","col"+i);if(cm.align){th.align=cm.align}if(cm.width){$(th).attr("width",cm.width)}if(cm.hide){th.hide=true}if(cm.process){th.process=cm.process}if(cm.nowrap!=undefined){th.nowrap=cm.nowrap}else{th.nowrap=p.nowrap}$(tr).append(th)}$(thead).append(tr);$(t).prepend(thead)}g.options=p;g.gDiv=document.createElement("div");g.mDiv=document.createElement("div");g.hDiv=document.createElement("div");g.bDiv=document.createElement("div");g.vDiv=document.createElement("div");g.rDiv=document.createElement("div");g.cDrag=document.createElement("div");g.block=document.createElement("div");g.nDiv=document.createElement("div");g.nBtn=document.createElement("div");g.iDiv=document.createElement("div");g.tDiv=document.createElement("div");g.sDiv=document.createElement("div");if(p.usepager){g.pDiv=document.createElement("div")}g.hTable=document.createElement("table");g.gDiv.className="flexigrid";if(p.width!="auto"){g.gDiv.style.width=p.width+"px"}if($.browser.msie){$(g.gDiv).addClass("ie")}if(p.novstripe){$(g.gDiv).addClass("novstripe")}$(t).before(g.gDiv);$(g.gDiv).append(t);if(p.buttons){g.tDiv.className="tDiv";var tDiv2=document.createElement("div");tDiv2.className="tDiv2";for(i=0;i<p.buttons.length;i++){var btn=p.buttons[i];if(!btn.separator){var btnDiv=document.createElement("div");btnDiv.className="fbutton";btnDiv.innerHTML="<div><span>"+btn.name+"</span></div>";if(btn.bclass){$("span",btnDiv).addClass(btn.bclass).css({paddingLeft:20})}btnDiv.onpress=btn.onpress;btnDiv.name=btn.name;if(btn.onpress){$(btnDiv).click(function(){this.onpress(this.name,g.gDiv)})}$(tDiv2).append(btnDiv);if($.browser.msie&&$.browser.version<7){$(btnDiv).hover(function(){$(this).addClass("fbOver")},function(){$(this).removeClass("fbOver")})}}else{$(tDiv2).append("<div class='btnseparator'></div>")}}$(g.tDiv).append(tDiv2);$(g.tDiv).append("<div style='clear:both'></div>");$(g.gDiv).prepend(g.tDiv)}g.hDiv.className="hDiv";$(t).before(g.hDiv);g.hTable.cellPadding=0;g.hTable.cellSpacing=0;$(g.hDiv).append('<div class="hDivBox"></div>');$("div",g.hDiv).append(g.hTable);var thead=$("thead:first",t).get(0);if(thead){$(g.hTable).append(thead)}thead=null;if(!p.colmodel){var ci=0}$("thead tr:first th",g.hDiv).each(function(){var thdiv=document.createElement("div");if($(this).attr("abbr")){$(this).click(function(e){if(!$(this).hasClass("thOver")){return false}var obj=(e.target||e.srcElement);if(obj.href||obj.type){return true}g.changeSort(this)});if($(this).attr("abbr")==p.sortname){this.className="sorted";thdiv.className="s"+p.sortorder}}if(this.hide){$(this).hide()}if(!p.colmodel){$(this).attr("axis","col"+ci++)}$(thdiv).css({textAlign:this.align,width:this.width+"px"});thdiv.innerHTML=this.innerHTML;$(this).empty().append(thdiv).removeAttr("width").mousedown(function(e){g.dragStart("colMove",e,this)}).hover(function(){if(!g.colresize&&!$(this).hasClass("thMove")&&!g.colCopy){$(this).addClass("thOver")}if($(this).attr("abbr")!=p.sortname&&!g.colCopy&&!g.colresize&&$(this).attr("abbr")){$("div",this).addClass("s"+p.sortorder)}else{if($(this).attr("abbr")==p.sortname&&!g.colCopy&&!g.colresize&&$(this).attr("abbr")){var no="";if(p.sortorder=="asc"){no="desc"}else{no="asc"}$("div",this).removeClass("s"+p.sortorder).addClass("s"+no)}}if(g.colCopy){var n=$("th",g.hDiv).index(this);if(n==g.dcoln){return false}if(n<g.dcoln){$(this).append(g.cdropleft)}else{$(this).append(g.cdropright)}g.dcolt=n}else{if(!g.colresize){var nv=$("th:visible",g.hDiv).index(this);var onl=parseInt($("div:eq("+nv+")",g.cDrag).css("left"));var nw=parseInt($(g.nBtn).width())+parseInt($(g.nBtn).css("borderLeftWidth"));nl=onl-nw+Math.floor(p.cgwidth/2);$(g.nDiv).hide();$(g.nBtn).hide();$(g.nBtn).css({left:nl,top:g.hDiv.offsetTop}).show();var ndw=parseInt($(g.nDiv).width());$(g.nDiv).css({top:g.bDiv.offsetTop});if((nl+ndw)>$(g.gDiv).width()){$(g.nDiv).css("left",onl-ndw+1)}else{$(g.nDiv).css("left",nl)}if($(this).hasClass("sorted")){$(g.nBtn).addClass("srtd")}else{$(g.nBtn).removeClass("srtd")}}}},function(){$(this).removeClass("thOver");if($(this).attr("abbr")!=p.sortname){$("div",this).removeClass("s"+p.sortorder)}else{if($(this).attr("abbr")==p.sortname){var no="";if(p.sortorder=="asc"){no="desc"}else{no="asc"}$("div",this).addClass("s"+p.sortorder).removeClass("s"+no)}}if(g.colCopy){$(g.cdropleft).remove();$(g.cdropright).remove();g.dcolt=null}})});g.bDiv.className="bDiv";$(t).before(g.bDiv);$(g.bDiv).css({height:(p.height=="auto")?"auto":p.height+"px"}).scroll(function(e){g.scroll()}).append(t);if(p.height=="auto"){$("table",g.bDiv).addClass("autoht")}g.addCellProp();g.addRowProp();var cdcol=$("thead tr:first th:first",g.hDiv).get(0);if(cdcol!=null){g.cDrag.className="cDrag";g.cdpad=0;g.cdpad+=(isNaN(parseInt($("div",cdcol).css("borderLeftWidth")))?0:parseInt($("div",cdcol).css("borderLeftWidth")));g.cdpad+=(isNaN(parseInt($("div",cdcol).css("borderRightWidth")))?0:parseInt($("div",cdcol).css("borderRightWidth")));g.cdpad+=(isNaN(parseInt($("div",cdcol).css("paddingLeft")))?0:parseInt($("div",cdcol).css("paddingLeft")));g.cdpad+=(isNaN(parseInt($("div",cdcol).css("paddingRight")))?0:parseInt($("div",cdcol).css("paddingRight")));g.cdpad+=(isNaN(parseInt($(cdcol).css("borderLeftWidth")))?0:parseInt($(cdcol).css("borderLeftWidth")));g.cdpad+=(isNaN(parseInt($(cdcol).css("borderRightWidth")))?0:parseInt($(cdcol).css("borderRightWidth")));g.cdpad+=(isNaN(parseInt($(cdcol).css("paddingLeft")))?0:parseInt($(cdcol).css("paddingLeft")));g.cdpad+=(isNaN(parseInt($(cdcol).css("paddingRight")))?0:parseInt($(cdcol).css("paddingRight")));$(g.bDiv).before(g.cDrag);var cdheight=$(g.bDiv).height();var hdheight=$(g.hDiv).height();$(g.cDrag).css({top:-hdheight+"px"});$("thead tr:first th",g.hDiv).each(function(){var cgDiv=document.createElement("div");$(g.cDrag).append(cgDiv);if(!p.cgwidth){p.cgwidth=$(cgDiv).width()}$(cgDiv).css({height:cdheight+hdheight}).mousedown(function(e){g.dragStart("colresize",e,this)});if($.browser.msie&&$.browser.version<7){g.fixHeight($(g.gDiv).height());$(cgDiv).hover(function(){g.fixHeight();$(this).addClass("dragging")},function(){if(!g.colresize){$(this).removeClass("dragging")}})}})}if(p.striped){$("tbody tr:odd",g.bDiv).addClass("erow")}if(p.resizable&&p.height!="auto"){g.vDiv.className="vGrip";$(g.vDiv).mousedown(function(e){g.dragStart("vresize",e)}).html("<span></span>");$(g.bDiv).after(g.vDiv)}if(p.resizable&&p.width!="auto"&&!p.nohresize){g.rDiv.className="hGrip";$(g.rDiv).mousedown(function(e){g.dragStart("vresize",e,true)}).html("<span></span>").css("height",$(g.gDiv).height());if($.browser.msie&&$.browser.version<7){$(g.rDiv).hover(function(){$(this).addClass("hgOver")},function(){$(this).removeClass("hgOver")})}$(g.gDiv).append(g.rDiv)}if(p.usepager){g.pDiv.className="pDiv";g.pDiv.innerHTML='<div class="pDiv2"></div>';$(g.bDiv).after(g.pDiv);var html=' <div class="pGroup"> <div class="pFirst pButton"><span></span></div><div class="pPrev pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pcontrol">Page <input type="text" size="4" value="1" /> of <span> 1 </span></span></div> <div class="btnseparator"></div> <div class="pGroup"> <div class="pNext pButton"><span></span></div><div class="pLast pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"> <div class="pReload pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pPageStat"></span></div>';$("div",g.pDiv).html(html);$(".pReload",g.pDiv).click(function(){if(p.onReload){var gh=p.onReload();if(!gh){return false}}g.populate()});$(".pFirst",g.pDiv).click(function(){g.changePage("first")});$(".pPrev",g.pDiv).click(function(){g.changePage("prev")});$(".pNext",g.pDiv).click(function(){g.changePage("next")});$(".pLast",g.pDiv).click(function(){g.changePage("last")});$(".pcontrol input",g.pDiv).keydown(function(e){if(e.keyCode==13){g.changePage("input")}});$(".pReload",g.pDiv).hover(function(){$(this).addClass("pBtnOver")},function(){$(this).removeClass("pBtnOver")});$(".pFirst, .pPrev").hover(function(){if(!(p.page&&p.page==1)){$(this).addClass("pBtnOver")}},function(){$(this).removeClass("pBtnOver")});$(".pLast, .pNext").hover(function(){if(!(p.page&&p.pages&&p.page==p.pages)){$(this).addClass("pBtnOver")}},function(){$(this).removeClass("pBtnOver")});if(p.useRp){var opt="";for(var nx=0;nx<p.rpOptions.length;nx++){if(p.rp==p.rpOptions[nx]){sel='selected="selected"'}else{sel=""}opt+="<option value='"+p.rpOptions[nx]+"' "+sel+" >"+p.rpOptions[nx]+"&nbsp;&nbsp;</option>"}$(".pDiv2",g.pDiv).prepend("<div class='pGroup'><select name='rp'>"+opt+"</select></div> <div class='btnseparator'></div>");$("select",g.pDiv).change(function(){if(p.onRpChange){p.onRpChange(+this.value)}else{p.newp=1;p.rp=+this.value;g.populate()}})}if(p.searchitems){$(".pDiv2",g.pDiv).prepend("<div class='pGroup'> <div class='pSearch pButton'><span></span></div> </div>  <div class='btnseparator'></div>");$(".pSearch",g.pDiv).click(function(){$(g.sDiv).slideToggle("fast",function(){$(".sDiv:visible input:first",g.gDiv).trigger("focus")})});g.sDiv.className="sDiv";sitems=p.searchitems;var sopt="";for(var s=0;s<sitems.length;s++){if(p.qtype==""&&sitems[s].isdefault==true){p.qtype=sitems[s].name;sel='selected="selected"'}else{sel=""}sopt+="<option value='"+sitems[s].name+"' "+sel+" >"+sitems[s].display+"&nbsp;&nbsp;</option>"}if(p.qtype==""){p.qtype=sitems[0].name}$(g.sDiv).append("<div class='sDiv2'>Quick Search <input type='text' size='30' name='q' class='qsbox' /> <select name='qtype'>"+sopt+"</select> <input type='button' value='Clear' /></div>");$("input[name=q],select[name=qtype]",g.sDiv).keydown(function(e){if(e.keyCode==13){g.doSearch()}});$("input[value=Clear]",g.sDiv).click(function(){$("input[name=q]",g.sDiv).val("");p.query="";g.doSearch()});$(g.bDiv).after(g.sDiv)}}$(g.pDiv,g.sDiv).append("<div style='clear:both'></div>");if(p.title){g.mDiv.className="mDiv";g.mDiv.innerHTML='<div class="ftitle">'+p.title+"</div>";$(g.gDiv).prepend(g.mDiv);if(p.showTableToggleBtn){$(g.mDiv).append('<div class="ptogtitle" title="Minimize/Maximize Table"><span></span></div>');$("div.ptogtitle",g.mDiv).click(function(){$(g.gDiv).toggleClass("hideBody");$(this).toggleClass("vsble")})}}g.cdropleft=document.createElement("span");g.cdropleft.className="cdropleft";g.cdropright=document.createElement("span");g.cdropright.className="cdropright";g.block.className="gBlock";var gh=$(g.bDiv).height();var gtop=g.bDiv.offsetTop;$(g.block).css({width:g.bDiv.style.width,height:gh,background:"white",position:"relative",marginBottom:(gh*-1),zIndex:1,top:gtop,left:"0px"});$(g.block).fadeTo(0,p.blockOpacity);if($("th",g.hDiv).length){g.nDiv.className="nDiv";g.nDiv.innerHTML="<table cellpadding='0' cellspacing='0'><tbody></tbody></table>";$(g.nDiv).css({marginBottom:(gh*-1),display:"none",top:gtop}).noSelect();var cn=0;$("th div",g.hDiv).each(function(){var kcol=$("th[axis='col"+cn+"']",g.hDiv)[0];var chk='checked="checked"';if(kcol.style.display=="none"){chk=""}$("tbody",g.nDiv).append('<tr><td class="ndcol1"><input type="checkbox" '+chk+' class="togCol" value="'+cn+'" /></td><td class="ndcol2">'+this.innerHTML+"</td></tr>");cn++});if($.browser.msie&&$.browser.version<7){$("tr",g.nDiv).hover(function(){$(this).addClass("ndcolover")},function(){$(this).removeClass("ndcolover")})}$("td.ndcol2",g.nDiv).click(function(){if($("input:checked",g.nDiv).length<=p.minColToggle&&$(this).prev().find("input")[0].checked){return false}return g.toggleCol($(this).prev().find("input").val())});$("input.togCol",g.nDiv).click(function(){if($("input:checked",g.nDiv).length<p.minColToggle&&this.checked==false){return false}$(this).parent().next().trigger("click")});$(g.gDiv).prepend(g.nDiv);$(g.nBtn).addClass("nBtn").html("<div></div>").attr("title","Hide/Show Columns").click(function(){$(g.nDiv).toggle();return true});if(p.showToggleBtn){$(g.gDiv).prepend(g.nBtn)}}$(g.iDiv).addClass("iDiv").css({display:"none"});$(g.bDiv).append(g.iDiv);$(g.bDiv).hover(function(){$(g.nDiv).hide();$(g.nBtn).hide()},function(){if(g.multisel){g.multisel=false}});$(g.gDiv).hover(function(){},function(){$(g.nDiv).hide();$(g.nBtn).hide()});$(document).mousemove(function(e){g.dragMove(e)}).mouseup(function(e){g.dragEnd()}).hover(function(){},function(){g.dragEnd()});if($.browser.msie&&$.browser.version<7){$(".hDiv,.bDiv,.mDiv,.pDiv,.vGrip,.tDiv, .sDiv",g.gDiv).css({width:"100%"});$(g.gDiv).addClass("ie6");if(p.width!="auto"){$(g.gDiv).addClass("ie6fullwidthbug")}}g.rePosDrag();g.fixHeight();t.p=p;t.grid=g;if(p.url&&p.autoload){g.populate()}return t};var docloaded=false;$(document).ready(function(){docloaded=true});$.fn.flexigrid=function(p){return this.each(function(){if(!docloaded){$(this).hide();var t=this;$(document).ready(function(){$.addFlex(t,p)})}else{$.addFlex(this,p)}})};$.fn.flexReload=function(p){return this.each(function(){if(this.grid&&this.p.url){this.grid.populate()}})};$.fn.flexOptions=function(p){return this.each(function(){if(this.grid){$.extend(this.p,p)}})};$.fn.flexToggleCol=function(cid,visible){return this.each(function(){if(this.grid){this.grid.toggleCol(cid,visible)}})};$.fn.flexAddData=function(data){return this.each(function(){if(this.grid){this.grid.addData(data)}})};$.fn.noSelect=function(p){if(p==null){prevent=true}else{prevent=p}if(prevent){return this.each(function(){if($.browser.msie||$.browser.safari){$(this).bind("selectstart",function(){return false})}else{if($.browser.mozilla){$(this).css("MozUserSelect","none");$("body").trigger("focus")}else{if($.browser.opera){$(this).bind("mousedown",function(){return false})}else{$(this).attr("unselectable","on")}}}})}else{return this.each(function(){if($.browser.msie||$.browser.safari){$(this).unbind("selectstart")}else{if($.browser.mozilla){$(this).css("MozUserSelect","inherit")}else{if($.browser.opera){$(this).unbind("mousedown")}else{$(this).removeAttr("unselectable","on")}}}})}}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:web-resources', location = 'templates/extra/jira/jiraIssues.js' */
jQuery(document).ready(function(){var a=jQuery.extend(window.JiraIssues||{},{ADG_ENABLED:AJS.Meta.getNumber("build-number")>=4000,ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO:14/11,fixMenusShowingUnderWidgetInIE:function(){if(jQuery.browser.msie){jQuery("ul.ajs-menu-bar li.ajs-menu-item").each(function(){jQuery(this).hover(function(){jQuery("div.ajs-drop-down",jQuery(this)).parents().each(function(){var c=jQuery(this);var b=c.css("position");if(b&&b!="auto"){c.addClass("ajs-menu-bar-z-index-fix-for-ie")}})},function(){jQuery("div.ajs-drop-down",jQuery(this)).parents().removeClass("ajs-menu-bar-z-index-fix-for-ie")})})}},onSuccessFunction:function(d){if(!jQuery("fieldset input[name='height']",d).length){var b=jQuery(".bDiv table[id^='jiraissues_table']",d)[0];var e=b.grid;var c=b.clientHeight+jQuery(".hDiv",d)[0].clientHeight;jQuery(".bDiv",d).css("height",c+"px");e.options.height=c;e.fixHeight(c)}},onErrorFunction:function(h,c,b,n,f){var o=jQuery("#"+c);var g=b+": ";if(n.status=="200"){g+=f}else{g+=n.responseText}var i=n.getResponseHeader("WWW-Authenticate")||"";if(n.status=="401"&&i.indexOf("OAuth")!=-1){var m=/OAuth realm\=\"([^\"]+)\"/;var e=m.exec(i);if(e){o.empty();a.bigMessageFunction(c,'<a class="oauth-init" href="'+e[1]+'">'+"Authenticate"+"</a> "+"to retrieve your issues"+"</span>");jQuery(".bmDiv",h).css({"z-index":2});var j={onSuccess:function(){window.location.reload()},onFailure:function(){}};var l=jQuery(".oauth-init",o.parent());var d=l.attr("href");l.click(function(p){AppLinks.authenticateRemoteCredentials(d,j.onSuccess,j.onFailure);p.preventDefault()});AJS.$(".gBlock").remove()}}else{if(n.status=="400"){a.bigMessageFunction(c,"The JIRA server was not able to process the search. This may indicate a problem with the syntax of this macro. Alternatively, if this table is requesting specific issue keys, you may not have permission to view one of these issues. ")}else{var k=jQuery("iframe.jiraissues_errorMsgSandbox",h);k.load(function(){var r=this.contentWindow||this.contentDocument;var q=jQuery((r.document?r.document:r).body);jQuery("a",q).each(function(){this.target="_top"});jQuery(".pPageStat",h).empty().text(q.text());var p=jQuery("div.bmDiv",h)[0];k.removeClass("hidden");k.css({height:p.clientHeight+"px",width:p.clientWidth+"px"})});k[0].src=jQuery("fieldset input[name='retrieverUrlHtml']",h).val();a.bigMessageFunction(c,k)}}jQuery(h).find(".pReload").removeClass("loading");o[0].grid.loading=false;jQuery(h).find(".pButton").each(function(){jQuery(this).removeClass("pBtnOver");jQuery(this).css({cursor:"default",opacity:"0.3"})});jQuery(h).find("span.pcontrol input").attr("readonly","true")},onReloadFunction:function(b,d,c){jQuery(".bmDiv",d).remove();jQuery(".bmDistance",d).remove();c.onSubmit=function(){a.reloadOnSubmitFunction(b,c);return true}},reloadOnSubmitFunction:function(b,c){c.params=[{name:"useCache",value:false}];c.onSubmit=function(){a.onSubmitFunction(b,c);return true}},onSubmitFunction:function(b,c){c.params=[{name:"useCache",value:b}]},showTrustWarningsFunction:function(d,c){var b=jQuery(d).children(".trusted_warnings");if(c.trustedMessage){b.find("td:last").html(c.trustedMessage);b.css("display","block")}else{b.css("display","none")}},preProcessFunction:function(e,b,d,c,f){if(d){a.showTrustWarningsFunction(e,c)}if(c.total==0){jQuery(".pPageStat",e).html(f);a.bigMessageFunction(b,f);jQuery(".pReload",e).removeClass("loading");return}},bigMessageFunction:function(e,f){var d=jQuery("<div></div>");var b=jQuery("<div></div>");d.addClass("bmDistance");b.addClass("bmDiv");if(typeof f=="string"){b.html("<p><strong>"+f+"</strong></p>")}else{f.appendTo(b)}var c=jQuery("#"+e);c.after(b).after(d)},getParamsFrom:function(c){var b={};c.children("input").each(function(){b[jQuery(this).attr("name")]=jQuery(this).attr("value")});return b},initializeColumnWidth:function(f,p){var d={},m=function(i){return a.ADG_ENABLED?Math.round(i*a.ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO):i};if(!(p&&p.length)){return d}var h=37,n=11,k=f.width()-(h+(p.length*n)),j=false,q=false,o=0,c=m(140);for(var l=0,e=p.length;l<e;l++){var g=p[l].name;switch(g){case"summary":j=true;o++;break;case"description":q=true;o++;break;case"type":o++;d[g]=30;k-=30;break;case"priority":o++;d[g]=50;k-=50;break;case"status":o++;d[g]=m(100);k-=m(100);break;case"key":o++;d[g]=m(90);k-=m(90);break;case"comments":case"attachments":case"version":case"component":case"resolution":o++;d[g]=m(80);k-=m(80);break;default:d[g]=c}}if(j||q){k-=(c*(p.length-o));var b=250;if(j&&q){d.summary=Math.max(k/2,b);d.description=Math.max(k/2,b)}else{if(j){d.summary=Math.max(k,b)}else{d.description=Math.max(k,b)}}}else{if(!j&&!q&&(p.length>o)){c=k/(p.length-o);for(l=0;l<e;l++){if(!{resolution:true,key:true,type:true,priority:true,status:true}[p[l]]){d[p[l]]=c}}}}return d}});a.fixMenusShowingUnderWidgetInIE();jQuery(".jiraissues_table").each(function(f,j){var k=jQuery(j),h=k.children("fieldset"),e=a.getParamsFrom(h),c="jiraissues_table_"+f;k.append('<table id="'+c+'" style="display:none"></table>');k.css("width",e.width);var d=[];h.children(".columns").each(function(l){var m=jQuery(this).hasClass("nowrap");d[l]={display:this.name,name:this.value,nowrap:m,sortable:true,align:"left"}});var b=a.initializeColumnWidth(k,d);jQuery.each(d,function(l,m){m.width=b[m.name]});var g=jQuery("<div></div>");jQuery("<a></a>").attr({rel:"nofollow",href:e.clickableUrl}).text(e.title).appendTo(g);jQuery("#"+c).flexigrid({url:e.retrieverUrlHtml,method:"GET",dataType:"json",colModel:d,sortname:e.sortField,sortorder:e.sortOrder,usepager:true,title:g.html(),page:parseInt(e.requestedPage,10),useRp:false,rp:parseInt(e.resultsPerPage,10),showTableToggleBtn:true,height:(function(){return e.height?parseInt(e.height,10):480})(),onSuccess:function(){a.onSuccessFunction(j)},onSubmit:function(){a.onSubmitFunction(e.useCache,this);return true},preProcess:function(i){a.preProcessFunction(j,c,e.showTrustWarnings,i,e.nomsg);return i},onError:function(m,l,i){a.onErrorFunction(j,c,e.jiraissuesError,m,l,i)},onReload:function(){a.onReloadFunction(e.useCache,j,this);return true},errormsg:e.errormsg,pagestat:e.pagestat,procmsg:e.procmsg,nomsg:e.nomsg})});jQuery(".jiraissues_count").each(function(b,d){var c=jQuery(d);jQuery.ajax({cache:false,type:"GET",url:c.find(".url").text(),data:{useCache:c.find(".use-cache").text(),rp:c.find(".rp").text(),showCount:"true"},success:function(f){var e=c.find(".result");if(f>1){e.text(AJS.format("{0} issues",f))}else{e.text(AJS.format("{0} issue",f))}e.removeClass("hidden");jQuery(".calculating, .error, .data",c).remove()},error:function(h){var f=jQuery(".error",c).removeClass("hidden"),g=h.getResponseHeader("WWW-Authenticate")||"",j=false;if(h.status===401&&g.indexOf("OAuth")!=-1){var e=/OAuth realm\=\"([^\"]+)\"/,i=e.exec(g);if(i){f.empty().append($("<a/>",{href:i[1],"class":"oauth-init"}).text("Authenticate").click(function(){AppLinks.authenticateRemoteCredentials(i[1],function(){window.location.reload()},function(){});return false})).append($("<span/>",{text:" "+"to retrieve your issues"}));j=true}}if(!j){f.text(AJS.format(f.text(),h.status))}jQuery(".calculating, .result, .data",c).remove()}})})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:about', location = '/includes/js/about/about-page.js' */
AJS.toInit(function(d){var a=d("#confluence-about-link"),b;var c=function(){var f=AJS.Meta.get("version-number").match(/^\d+\.\d+/),h="Atlassian Confluence and Confluence Plugins",g=AJS.Meta.get("context-path")+"/aboutconfluence.action",e=new AJS.ConfluenceDialog({id:"about-confluence-dialog",closeOnOutsideClick:true});e.addHeader(h);e.addCancel("Close",function(){e.hide()});d.get(g,function(i){e.addPanel("default",i,"about-page-content")});return e};a.click(function(f){f.preventDefault();d(this).removeClass("interactive");if(b==null){b=c()}b.show()})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:analytics-support', location = '/includes/js/analytics-support/ga-analytics-support.js' */
(function(e){AJS.Confluence.Analytics=AJS.Confluence.Analytics||{};var f=/([^\?]+)[\?]?([^#]*)[#]?(.*)/;var b=["source","urlPath","queryParams","anchor"];function g(k){var j={};var m=f.exec(k);if(m){for(var l=0;l<b.length;l++){j[b[l]]=m[l]}j.queryParams=c(j.queryParams)}return j}function h(j){if(e.isEmptyObject(j)){return""}else{return(!j.urlPath?"":j.urlPath)+(e.isEmptyObject(j.queryParams)?"":"?"+i(j.queryParams))+(!j.anchor?"":"#"+j.anchor)}}function c(n){var m={};if(n){var l=n.split("&");for(var k=0;k<l.length;k++){var j=l[k].split("=");if(!m[j[0]]){m[j[0]]=[]}m[j[0]].push(l[k].substring(j[0].length+1))}}return m}function i(k){var m="";for(var l in k){for(var j=0;j<k[l].length;j++){m+="&"+l;if(k[l][j]){m+="="+k[l][j]}}}return m.substring(1)}function a(k,l){var j=g(k);if(!e.isEmptyObject(j)){j.queryParams.src=[l]}return h(j)}AJS.Confluence.Analytics.srcRemovedUrl=function(k){var j=g(k);delete j.queryParams.src;return h(j)};function d(){return e('script[src$="/ga.js"]').length>0}AJS.Confluence.Analytics.setAnalyticsSource=function(j,k){if(d()){j.attr("href",function(m,l){return a(l,encodeURIComponent(k))})}};AJS.toInit(function(j){if(window.history&&window.history.replaceState){if(d()){if(_gaq){_gaq.push(function(){window.history.replaceState(null,"",AJS.Confluence.Analytics.srcRemovedUrl(document.URL))})}else{AJS.log("ERROR: Could not queue src parameter URL clean up task: _gaq is not defined but Google Analytics is activated.")}}else{window.history.replaceState(null,"",AJS.Confluence.Analytics.srcRemovedUrl(document.URL))}}})}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:requirements-resources', location = 'com/atlassian/confluence/plugins/requirements/soy/how-to.soy' */
// This file was automatically generated from how-to.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Requirements == 'undefined') { Confluence.Blueprints.Requirements = {}; }


Confluence.Blueprints.Requirements.howTo = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="howto-content-wrapper"><h2>', soy.$$escapeHtml("With product requirements you can\u2026"), '</h2><ol class="howto-steps horizontal"><li class="howto-step"><div><h3>', soy.$$escapeHtml("Define document properties"), '</h3><p class="howto-description">', soy.$$escapeHtml("Add properties like status and owner to your document to make it easy to organise and sort your product requirements."), '</p></div></li><li class="howto-step"><div><h3>', soy.$$escapeHtml("Create requirements"), '</h3><p class="howto-description">', soy.$$escapeHtml("The customisable template brings structure and consistency to your product requirements. If you use JIRA you can create stories right from the requirements page."), '</p></div></li><li class="howto-step"><div><h3>', soy.$$escapeHtml("Track progress"), '</h3><p class="howto-description">', soy.$$escapeHtml("See the status of all your requirements at a glance. Sort by properties like status and release, or access linked JIRA issues from your requirements pages."), '</p></div></li></ol></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:requirements-resources', location = 'com/atlassian/confluence/plugins/requirements/soy/user-mention.soy' */
// This file was automatically generated from user-mention.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Requirements == 'undefined') { Confluence.Templates.Requirements = {}; }


Confluence.Templates.Requirements.userMention = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.username) ? '<p><ac:link><ri:user ri:username="' + soy.$$escapeHtml(opt_data.username) + '" /></ac:link></p>' : '<p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml("Person responsible") + '</ac:placeholder></p>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources', location = 'com/atlassian/confluence/plugins/jirareports/js/jirareports.js' */
Confluence.Blueprints.JiraReport=(function(e){var j;var b;var d="jirareports-changelog-static";var h="jirareports-changelog-dynamic";var a="-1";var k=function(m){var o=Confluence.Blueprints.JiraReport.servers;for(var n=0;n<o.length;n++){if(o[n].id===m){return o[n]}}return null};var i=function(m,p){var o;for(var n=0;n<b.length;n++){o=b[n];if(typeof o[m]==="function"){if(p){o[m].apply(null,Array.prototype.slice.call(p))}else{o[m]()}}}};var l=function(m){m.authUrl=null;j.oauthForm.addClass("hidden");i("onAuthenticatedSuccess")};var f=function(s,p,o){var q=[];if((s.val()!==a)&&!s.select2("enable")){q.push("project = '",c(s.val()),"'");if(!p.select2("enable")){var n=p.find('option[value!="'+a+'"]:selected');var t=n.length;if(t>0){var m="";for(var r=0;r<n.length;r++){m=m+g(n[r])+", "}q.push(" AND fixVersion in (",m.substring(0,m.length-2),")")}}}return q.join("")};var g=function(n){var m="";var o=c(n.text);if(o==="No Version"&&n.value==="EMPTY"){m=n.value}else{m="'"+o+"'"}return m};var c=function(m){return m.replace(/'/g,"\\'")};return{REPORT_TYPE_CHANGE_LOG:1,REPORT_TYPE_STATUS:2,prepareData:function(){AJS.$.ajax({dataType:"json",url:Confluence.getContextPath()+"/rest/jiraanywhere/1.0/servers",async:false}).done(function(m){Confluence.Blueprints.JiraReport.servers=m;AJS.$.each(m,function(n,o){if(o.selected){Confluence.Blueprints.JiraReport.primaryServer=o}})})},init:function(n,m){b=m;j={server:n.$container.find("#jira-reports-servers"),project:n.$container.find("#jira-reports-project"),version:n.$container.find("#jira-reports-fix-version"),title:n.$container.find("#jira-reports-page-title"),spaceKey:n.wizardData.spaceKey,textSearch:n.$container.find("#jira-query"),oauthForm:n.$container.find("#oauth-form"),errorForm:n.$container.find("#error-form"),switchSearchType:n.$container.find("#switch-search-type")};j.switchSearchType.click(function(p){var o=j.switchSearchType.hasClass("simple");if(o){j.textSearch.val(f(j.project,j.version,j.selectedReportType));j.textSearch.removeClass("placeholded");j.switchSearchType.removeClass("simple").addClass("advanced").text("Switch to simple")}else{j.switchSearchType.removeClass("advanced").addClass("simple").text("Switch to advanced")}n.$container.find("#advanced-jira-search").toggleClass("hidden",!o);n.$container.find("#simple-jira-search").toggleClass("hidden",o);n.$container.find("#inforWarning").empty()});i("init",[j,n.$container]);j.server.change(function(){Confluence.Blueprints.JiraReport.checkOauthForm(k(j.server.val()));i("onServerChange")})},loadServers:function(){var m=Confluence.Blueprints.JiraReport.servers;if(m.length===1){j.server.parent().addClass("hidden")}Confluence.Blueprints.JiraReport.checkOauthForm(Confluence.Blueprints.JiraReport.primaryServer);j.server.append(Confluence.Blueprints.JiraReports.Dialog.serverOptions({servers:m}));j.project.trigger("servers-load-completed")},validateForm:function(m){if(m.$container.find("#simple-jira-search").hasClass("hidden")){return Confluence.Blueprints.JiraReport.DynamicDialog.validateForm(m)}return Confluence.Blueprints.JiraReport.StaticDialog.validateForm(m)},checkOauthForm:function(m){if(m&&m.authUrl){j.oauthForm.removeClass("hidden");j.oauthForm.click(function(n){AppLinks.authenticateRemoteCredentials(m.authUrl,function(){l(m)});n.preventDefault()})}else{j.oauthForm.addClass("hidden")}},setupChangeLogSubmitData:function(m){if(j.switchSearchType.hasClass("simple")){m.pageData.contentTemplateKey=d;m.pageData.multiVersion=Confluence.Blueprints.JiraReport.StaticDialog.getMultiVersion()}else{m.pageData.contentTemplateKey=h}},setupStatusReportSubmitData:function(m){if(j.switchSearchType.hasClass("simple")){m.pageData.dialogMode="simple";m.pageData["jira-query"]=Confluence.Blueprints.JiraReport.StaticDialog.getStaticJiraQuery(m)}},setSelectedReportType:function(m){j.selectedReportType=m}}})(AJS.$);Confluence.Blueprints.JiraReport.StaticDialog=(function(j){var b;var n=Confluence.getContextPath()+"/rest/jirareports/1.0/";var k=401;var p="-1";var F=5;var h=4;var x=255;var E="\u2026";var t={};var l=function(G){G.empty();G.append(Confluence.Blueprints.JiraReports.Dialog.defaultOption({defaultValue:p}));G.auiSelect2("val",p)};var D=function(G){G.empty();G.auiSelect2("val",p)};var r=function(G){D(G);G.auiSelect2("enable",false)};var i=function(G){G.empty();G.append(Confluence.Blueprints.JiraReports.Dialog.loadingOption());G.auiSelect2("val","loading")};var z=function(G){G.auiSelect2("enable",true)};var s=function(G){G.auiSelect2("enable",false);i(G)};var m=function(G,H){AJS.$(G).attr("tabindex",H)};var f=function(G,H){if(H===b.project.val()){b.errorForm.empty();D(b.version);b.version.append(Confluence.Blueprints.JiraReports.Dialog.versionOptions({versions:G}));z(b.version)}};var a=function(H,G){if(G===b.server.val()){b.errorForm.empty();l(b.project);b.project.append(Confluence.Blueprints.JiraReports.Dialog.projectOptions({projects:H}));z(b.project)}};var c=function(){b.project.bind("servers-load-completed",Confluence.Blueprints.JiraReport.StaticDialog.loadProjects);b.project.change(function(){if(b.project.val()===p){D(b.version);o()}else{B(b.project);Confluence.Blueprints.JiraReport.StaticDialog.loadVersions();q(b.project.find("option:selected").text())}});b.project.on("select2-opening",function(){if(b.project.val()===p){b.project.find('option[value="'+p+'"]').addClass("hidden")}});b.version.change(function(){var G=b.project.find("option:selected").text();if(!b.version.val()){q(G)}else{if(b.version.val().length>1){q(G)}else{var H=b.version.find("option:selected").text();q(G+" "+H,true)}}});b.title.change(function(){u()})};var o=function(){b.title.val("");B(b.title)};var u=function(G){if(G===undefined){G=b.title.val()}if(G===""){return true}if(!Confluence.Blueprint.canCreatePage(b.spaceKey,G)){e(b.title,"A page with this name already exists.");return false}B(b.title);return true};var w=function(H,G){if(j.trim(H.val())===p){e(b.project,G);return false}return true};var C=function(H){if(!Confluence.Blueprint.canCreatePage(b.spaceKey,H)){var I;for(var G=1;G<=F;G++){I=H.concat(" (",G,")");if(Confluence.Blueprint.canCreatePage(b.spaceKey,I)){B(b.title);return I}}e(b.title,"A page with this name already exists.")}else{B(b.title)}return H};var q=function(H,G){if(G&&H.length<x-h){b.title.val(C(H));return}if(H.length>x){H=H.substr(0,x-1)+E}b.title.val(H);u(H)};var e=function(G,H){G.focus().siblings(".error").text(H)};var B=function(G){G.siblings(".error").empty()};var g=function(H,G){return{width:"300px",containerCssClass:H,dropdownCssClass:G,formatResult:function(I,J,K){J.attr("title",I.text);return j.fn.select2.defaults.formatResult.apply(this,arguments)}}};var y=function(G,H){AJS.$(G+" .select2-input").attr("placeholder",H)};var v=function(G){if(G==="timeout"){return "Connection Timeout."}return "Can not connect to JIRA server."};var d=function(H,G){l(H);b.errorForm.empty();b.errorForm.append(Confluence.Blueprints.JiraReports.Dialog.showErrorMessage({message:v(G)}));z(H)};var A=function(G){return G.select2("val")};return{init:function(G){b=G;b.project.auiSelect2(g("select2-project-container","select2-project-dropdown"));b.version.auiSelect2(g("select2-version-container","select2-version-dropdown"));y(".select2-project-dropdown","Filter Project ...");y(".select2-version-dropdown","Filter Fix Version ...");m(".select2-project-container > .aui-select2-choice",10);m(".select2-version-container > .aui-select2-choice",10);c(this);t={}},validateForm:function(H){H.$container.find(".error").empty();var I=w(b.project,"Project field is required");var G=u()&&I;if(G){H.pageData["jira-server-name"]=b.server.find("option:selected").text();H.pageData["jira-server-id"]=b.server.find("option:selected").val();return true}return false},onServerChange:function(){this.loadProjects(false);r(b.version);o()},onAuthenticatedSuccess:function(){this.loadProjects(true);o()},loadProjects:function(H){var G=b.server.val();s(b.project);if(!H&&t[G]){a(t[G],G);r(b.version)}else{AJS.$.ajax({dataType:"json",url:n+"appLink/"+G+"/projects",timeout:AJS.Meta.getNumber("connection-timeout")}).done(function(I){t[G]=I;a(I,G)}).fail(function(K,J){if(K.status===k){var I=j.parseJSON(K.responseText);t[G]=I;a(I,G)}else{if(G===b.server.val()){d(b.project,J)}}})}},loadVersions:function(){s(b.version);var G=b.project.val();AJS.$.ajax({dataType:"json",url:n+"appLink/"+b.server.val()+"/project/"+G+"/versions",timeout:AJS.Meta.getNumber("connection-timeout")}).done(function(H){f(H,G)}).fail(function(I,H){if(I.status===k){f(j.parseJSON(I.responseText),G)}else{if(G===b.project.val()){d(b.version,H)}}})},getStaticJiraQuery:function(I){var H="";if(b.project.val()!==p){H+="project = "+b.project.val();if(b.version.val()){var G=[];j(b.version.val()).each(function(J,K){G.push("'"+b.version.find("option[value='"+K+"']").text()+"'")});H+=" and fixVersion in ("+G.join(",")+")"}}return H},getMultiVersion:function(){return A(b.version).join(",")}}})(AJS.$);Confluence.Blueprints.JiraReport.DynamicDialog=(function(i){var e,c;var j=/=|!=|~|>|<|!~| is | in | was | changed /i;var m=/\s*([A-Z][A-Z]+)-[0-9]+\s*/;var d=function(p){p.focus().siblings(".error").empty()};var l=function(){c.find("#inforWarning").empty()};var b=function(p){l();c.find("#inforWarning").append(p)};var h=function(p){var q;if(p.serverIndex!==-1){e.server.val(Confluence.Blueprints.JiraReport.servers[p.serverIndex].id);e.server.trigger("change");if(p.jqlQuery.length>0){q=p.jqlQuery}}else{b(Confluence.Blueprints.JiraReports.Dialog.noServerWarning({isAdministrator:AJS.Meta.get("is-confluence-admin"),contentPath:Confluence.getContextPath()}))}return q};var o=function(p){var q=decodeURIComponent(p);var s=AJS.JQLHelper.findServerIndexFromUrl(q,Confluence.Blueprints.JiraReport.servers);if(s!==-1){e.server.val(Confluence.Blueprints.JiraReport.servers[s].id);e.server.trigger("change");var r=function(u){b(Confluence.Blueprints.JiraReports.Dialog.warning({infor:"The URL filter is not available to you, perhaps it has been deleted or had its permissions changed."}));e.textSearch.val('summary ~ "'+p+'" OR description ~ "'+p+'"')};var t=function(u){if(u.jql){e.textSearch.val(u.jql)}else{r()}};AJS.JQLHelper.getJqlQueryFromJiraFilter(q,Confluence.Blueprints.JiraReport.servers[s].id,t,r)}else{b(Confluence.Blueprints.JiraReports.Dialog.noServerWarning({isAdministrator:AJS.Meta.get("is-confluence-admin"),contentPath:Confluence.getContextPath()}));e.textSearch.val('summary ~ "'+p+'" OR description ~ "'+p+'"')}};var g=function(p,q){return p.hasClass("placeholded")&&p.val()===q};var k=function(q){if(i.trim(q)!==""&&!g(e.textSearch,"Search URL, saved filter, JQL ")){if(q.indexOf("http")===0&&AJS.JQLHelper.isFilterUrl(q)){o(q)}else{if(q.indexOf("http")===0&&AJS.JQLHelper.isIssueUrlOrXmlUrl(q)){var p=AJS.JQLHelper.getJqlAndServerIndexFromUrl(decodeURIComponent(q),Confluence.Blueprints.JiraReport.servers);if(h(p)){e.textSearch.val(p.jqlQuery)}else{e.textSearch.val('summary ~ "'+q+'" OR description ~ "'+q+'"')}}else{if(q.indexOf("http")!==0&&q.match(j)){e.textSearch.val(q)}else{if(q.match(m)){e.textSearch.val("key="+q)}else{e.textSearch.val('summary ~ "'+q+'" OR description ~ "'+q+'"')}}}}}};var f=function(){d(e.textSearch);l();setTimeout(function(){var p=e.textSearch.val();k(p)},100)};var n=function(p,q){var r=c.find(p);if(i.trim(r.val())===""){r.focus().siblings(".error").html(q);return false}return true};var a=function(){if(e.title.val()!==""&&!Confluence.Blueprint.canCreatePage(e.spaceKey,e.title.val())){return false}return true};return{init:function(p,q){e=p;c=q;e.textSearch.bind("paste",f);e.textSearch.bind("change",f)},onServerChange:function(){e.textSearch.val("");e.textSearch.siblings(".error").empty();c.find(".warning").empty()},validateForm:function(p){if(!n("#jira-query","JIRA Query field is required")){return false}if(!a()){return false}p.pageData["jira-server-name"]=e.server.find("option:selected").text();p.pageData["jira-server-id"]=e.server.find("option:selected").val();if(!e.textSearch.val().match(j)){k(e.textSearch.val());p.pageData["jira-query"]=e.textSearch.val()}return true}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources', location = 'com/atlassian/confluence/plugins/jirareports/js/jirareports-wizard.js' */
(function(c){function h(m,l){var k=c("#jirareports-select-type");var j=k.find(".template");if(Confluence.Blueprints.JiraReport.servers.length===0){j.addClass("disable disable-element");var i=Confluence.Blueprints.JiraReports.Dialog.showMessageNoAppLink({isAdministrator:AJS.Meta.get("is-confluence-admin"),contentPath:Confluence.getContextPath()});l.$container.find(".warningAppLink").append(i);c(".create-dialog-create-button:visible").addClass("hidden")}else{j.click(function(){c(this).siblings().removeClass("selected");c(this).addClass("selected")}).dblclick(function(){c(".create-dialog-create-button:visible").click()});k.attr("tabindex",0).keydown(function(o){var n=k.find(".selected");if(o.keyCode==38){o.preventDefault();n.removeClass("selected");n.prev().length?n.prev().addClass("selected"):j.last().addClass("selected")}else{if(o.keyCode==40){o.preventDefault();n.removeClass("selected");n.next().length?n.next().addClass("selected"):j.first().addClass("selected")}}});setTimeout(function(){j.first().click();k.focus()},0)}}function g(k,j){var i=j.$container.find(".selected").attr("id");if(i==="jirareports-select-changelog"){j.nextPageId="changelogPageId";j.wizardData.jiraReportType=Confluence.Blueprints.JiraReport.REPORT_TYPE_CHANGE_LOG}else{if(i==="jirareports-select-statusreport"){j.nextPageId="statusreportPageId";j.wizardData.jiraReportType=Confluence.Blueprints.JiraReport.REPORT_TYPE_STATUS}else{return false}}}function e(k,j){var i=[Confluence.Blueprints.JiraReport.DynamicDialog,Confluence.Blueprints.JiraReport.StaticDialog];Confluence.Blueprints.JiraReport.init(j,i);Confluence.Blueprints.JiraReport.loadServers();Confluence.Blueprints.JiraReport.setSelectedReportType(j.wizardData.jiraReportType)}function f(j,i){e(j,i);c("#jira-report-type").parents(".field-group").addClass("hidden")}function d(j,i){if(Confluence.Blueprints.JiraReport.validateForm(i)){Confluence.Blueprints.JiraReport.setupChangeLogSubmitData(i);return true}return false}function a(j,i){if(!Confluence.Blueprints.JiraReport.validateForm(i)){return false}Confluence.Blueprints.JiraReport.setupStatusReportSubmitData(i);i.pageData["statusreport-type"]="jirareports-statusreport-dynamic";i.pageData["issues-list-type"]="dynamic";i.pageData.contentTemplateKey="jirareports-statusreport"}function b(){Confluence.Blueprints.JiraReport.prepareData()}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-item",function(i){i.on("pre-render.selectreportPageId",b);i.on("post-render.selectreportPageId",h);i.on("submit.selectreportPageId",g);i.on("post-render.changelogPageId",e);i.on("submit.changelogPageId",d);i.on("post-render.statusreportPageId",f);i.on("submit.statusreportPageId",a)})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources', location = 'com/atlassian/confluence/plugins/jirareports/soy/dialogs.soy' */
// This file was automatically generated from dialogs.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.JiraReports == 'undefined') { Confluence.Blueprints.JiraReports = {}; }
if (typeof Confluence.Blueprints.JiraReports.Dialog == 'undefined') { Confluence.Blueprints.JiraReports.Dialog = {}; }


Confluence.Blueprints.JiraReports.Dialog.selectreport = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="template-select-container-body loadable"><div class="warningAppLink"></div><ol id="jirareports-select-type" class="jirareports-templates"><li class="template" id="jirareports-select-changelog"><img class="template-preview" src="', soy.$$escapeHtml(""), '/download/resources/com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources/icon-changelog-48.png"><div class="template-meta"><div class="template-name">', soy.$$escapeHtml("Change Log"), '</div><div class="template-description">', soy.$$escapeHtml("Create a report with a list of JIRA issues for a project, release or specific query."), '</div></div></li><li class="template" id="jirareports-select-statusreport"><img class="template-preview" src="', soy.$$escapeHtml(""), '/download/resources/com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources/icon-statusreport-48.png"><div class="template-meta"><div class="template-name">', soy.$$escapeHtml("Status Report"), '</div><div class="template-description">', soy.$$escapeHtml("Create a report with charts to communicate the status of your release with stakeholders."), '</div></div></li></ol></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.changelog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui change-log-form" method="post" action="#"><fieldset><div id="error-form"/><div class="hidden" id="oauth-form"><div class="aui-message-container"><div class="aui-message info"><span class="aui-icon icon-info"></span>', soy.$$escapeHtml("You are viewing this selected server as anonymous. You may want to"), '&nbsp;<a href="#">', soy.$$escapeHtml("Login \x26 Approve"), '</a></div></div></div><div class="field-group"><label for="jira-reports-servers">', soy.$$escapeHtml("Server"), '</label><select id="jira-reports-servers" class="select long-field" name="jira-reports-servers" /></div><div id="simple-jira-search"><div class="field-group"><label for="jira-reports-project">', soy.$$escapeHtml("Project"), '<span class="aui-icon icon-required"> required</span></label><select id="jira-reports-project" name="jira-reports-project"><option value=\'-1\' selected=\'selected\'>', soy.$$escapeHtml("Select"), '</option></select><div class="error"></div></div><div class="field-group" id="versions-field"><label for="jira-reports-fix-version">', soy.$$escapeHtml("Fix version(s)"), '</label><select id="jira-reports-fix-version" multiple="true" class="select long-field" disabled="disabled" placeholder="', soy.$$escapeHtml("Leave empty to get all versions"), '"></select></div></div><div id="advanced-jira-search" class="hidden"><div class="field-group"><label for="jira-query">', soy.$$escapeHtml("JIRA Query"), '<span class="aui-icon icon-required"> required</span></label><input id="jira-query" class="text long-field" type="text" name="jira-query" title="name" placeholder="', soy.$$escapeHtml("Search URL, saved filter, JQL "), '" maxlength="255"><div id="inforWarning" class="error"></div></div></div><div class="field-group"><a id="switch-search-type" href="#" class="simple">', soy.$$escapeHtml("Switch to advanced"), '</a></div><div class="field-group"><br><label for="jira-reports-page-title">', soy.$$escapeHtml("Title"), '</label><input id="jira-reports-page-title" class="text long-field" type="text" name="title" title="title" maxlength="255"><div class="error"></div></div><div id="advanced-jira-search" class="hidden"><div class="field-group"><div class="checkbox"><input class="checkbox" type="checkbox" id="jira-report-type" name="jira-report-type" checked="checked" value="dynamic" /><label for="jira-report-type">', soy.$$escapeHtml("Automatically update issue status and"), '</label></br><label for="jira-report-type">', soy.$$escapeHtml("summaries from JIRA"), '</label></div></div></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.leftmenuchangelog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="page-menu-item selected" id="simple-jira-search"><button class="item-button">', soy.$$escapeHtml("jirareports.changelog.menu.simple.search"), '</button></li><li class="page-menu-item" id="advanced-jira-search"><button class="item-button">', soy.$$escapeHtml("jirareports.changelog.menu.advanced.search"), '</button></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.statusreport = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div><div>Change log report</div><div>Status report</div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.warning = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml(opt_data.infor), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.noServerWarning = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', (opt_data.isAdministrator == true) ? AJS.format("No server found match with your URL. \x3ca id\x3d\x22open_applinks\x22 target\x3d\x22_blank\x22 href\x3d\x22{0}/admin/listapplicationlinks.action\x22\x3e Click here \x3c/a\x3e to set this up",opt_data.contentPath) : AJS.format("No server found match with your URL. Contact your administrator \x3ca id\x3d\x22open_applinks\x22 target\x3d\x22_blank\x22 href\x3d\x22{0}/wiki/contactadministrators.action\x22\x3e here \x3c/a\x3e to set this up for you.",opt_data.contentPath), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.showMessageNoAppLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message error">', (opt_data.isAdministrator == true) ? AJS.format("Your confluence has not been configured to connect to JIRA. Click \x3ca id\x3d\x22open_applinks\x22 target\x3d\x22_blank\x22 href\x3d\x22{0}/admin/listapplicationlinks.action\x22\x3e here \x3c/a\x3e to set your connection.",opt_data.contentPath) : AJS.format("Your confluence has not been configured to connect to JIRA. Contact your administrator \x3ca id\x3d\x22open_applinks\x22 target\x3d\x22_blank\x22 href\x3d\x22{0}/wiki/contactadministrators.action\x22\x3e here \x3c/a\x3e to set this up for you.",opt_data.contentPath), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.showErrorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message error"><p class="title"><span class="aui-icon icon-error"></span><strong>', soy.$$escapeHtml(opt_data.message), '</strong></p></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.defaultOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="', soy.$$escapeHtml(opt_data.defaultValue), '" selected="selected">', soy.$$escapeHtml("Select"), '</option>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.loadingOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="loading" selected="selected">', soy.$$escapeHtml("Loading..."), '</option>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.serverOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var serverList91 = opt_data.servers;
  var serverListLen91 = serverList91.length;
  for (var serverIndex91 = 0; serverIndex91 < serverListLen91; serverIndex91++) {
    var serverData91 = serverList91[serverIndex91];
    output.append((serverData91.selected) ? '<option value="' + soy.$$escapeHtml(serverData91.id) + '" selected="selected">' + soy.$$escapeHtml(serverData91.name) + '</option>' : '<option value="' + soy.$$escapeHtml(serverData91.id) + '">' + soy.$$escapeHtml(serverData91.name) + '</option>');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.projectOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var projectList107 = opt_data.projects;
  var projectListLen107 = projectList107.length;
  for (var projectIndex107 = 0; projectIndex107 < projectListLen107; projectIndex107++) {
    var projectData107 = projectList107[projectIndex107];
    output.append('<option value="', soy.$$escapeHtml(projectData107.key), '">', soy.$$escapeHtml(projectData107.name), '</option>');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Dialog.versionOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var versionsLeng__soy115 = opt_data.versions.length;
  output.append((versionsLeng__soy115 > 0) ? '<option value="EMPTY">' + soy.$$escapeHtml("No Version") + '</option>' : '');
  var iLimit121 = versionsLeng__soy115;
  for (var i121 = 0; i121 < iLimit121; i121++) {
    var version__soy122 = opt_data.versions[versionsLeng__soy115 - i121 - 1];
    output.append('<option value="', soy.$$escapeHtml(version__soy122.id), '">', soy.$$escapeHtml(version__soy122.name), '</option>');
  }
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:jirareports-resources', location = 'com/atlassian/confluence/plugins/jirareports/soy/jirareport-templates.soy' */
// This file was automatically generated from jirareport-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.JiraReports == 'undefined') { Confluence.Blueprints.JiraReports = {}; }
if (typeof Confluence.Blueprints.JiraReports.Template == 'undefined') { Confluence.Blueprints.JiraReports.Template = {}; }


Confluence.Blueprints.JiraReports.Template.jiraissues = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="jira"><ac:parameter ac:name="serverId">', soy.$$escapeHtml(opt_data.serverId), '</ac:parameter><ac:parameter ac:name="server">', soy.$$escapeHtml(opt_data.server), '</ac:parameter><ac:parameter ac:name="', soy.$$escapeHtml(opt_data.keyJQL), '">', soy.$$escapeHtml(opt_data.valJQL), '</ac:parameter>', (opt_data.isCount) ? '<ac:parameter ac:name="count">true</ac:parameter>' : '', '</ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Template.piechart = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p><h3>', soy.$$escapeHtml(opt_data.titleType), (opt_data.statType == 'statuses') ? opt_data.totalIssues : '', '</h3></p><p><ac:macro ac:name="jirachart"><ac:parameter ac:name="serverId">', soy.$$escapeHtml(opt_data.serverId), '</ac:parameter><ac:parameter ac:name="server">', soy.$$escapeHtml(opt_data.server), '</ac:parameter><ac:parameter ac:name="jql">', soy.$$escapeHtml(opt_data.jql), '</ac:parameter><ac:parameter ac:name="statType">', soy.$$escapeHtml(opt_data.statType), '</ac:parameter><ac:parameter ac:name="width">', soy.$$escapeHtml(opt_data.width), '</ac:parameter><ac:parameter ac:name="border">', soy.$$escapeHtml(opt_data.border), '</ac:parameter><ac:parameter ac:name="chartType">pie</ac:parameter></ac:macro></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Template.createFromTemplateMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="create-from-template"><ac:parameter ac:name="blueprintModuleCompleteKey">', soy.$$escapeHtml(opt_data.blueprintKey), '</ac:parameter><ac:parameter ac:name="buttonLabel">', soy.$$escapeHtml("Add JIRA Report"), '</ac:parameter><ac:parameter ac:name="spaceKey">', soy.$$escapeHtml(opt_data.spaceKey), '</ac:parameter><ac:parameter ac:name="templateName">', soy.$$escapeHtml(opt_data.blueprintKey), '</ac:parameter></ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Template.errortimeout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p><ac:placeholder><strong>', soy.$$escapeHtml("Cannot get data from JIRA Server due to connection timeout."), '</strong></ac:placeholder></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.JiraReports.Template.releaseTitle = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:placeholder>', soy.$$escapeHtml("Insert release name here."), '</ac:placeholder>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:moment', location = '/includes/js/moment/moment.js' */
(function(Q,r){var V,y="1.7.0",ab=Math.round,ac,N={},C="en",M=(typeof module!=="undefined"&&module.exports),o="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),v=/^\/?Date\((\-?\d+)/i,k=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?)/g,q=/(LT|LL?L?L?)/g,ae=/(^\[)|(\\)|\]$/g,ad=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,g=/\d\d?/,O=/\d{1,3}/,P=/\d{3}/,F=/\d{1,4}/,H=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,b=/Z|[\+\-]\d\d:?\d\d/i,s=/T/i,I=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,d="YYYY-MM-DDTHH:mm:ssZ",h=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],A=/([\+\-]|\d\d)/gi,m="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),X={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000},l={},G={M:"(a=t.month()+1)",MMM:'v("monthsShort",t.month())',MMMM:'v("months",t.month())',D:"(a=t.date())",DDD:"(a=new Date(t.year(),t.month(),t.date()),b=new Date(t.year(),0,1),a=~~(((a-b)/864e5)+1.5))",d:"(a=t.day())",dd:'v("weekdaysMin",t.day())',ddd:'v("weekdaysShort",t.day())',dddd:'v("weekdays",t.day())',w:"(a=new Date(t.year(),t.month(),t.date()-t.day()+5),b=new Date(a.getFullYear(),0,4),a=~~((a-b)/864e5/7+1.5))",YY:"p(t.year()%100,2)",YYYY:"p(t.year(),4)",a:"m(t.hours(),t.minutes(),!0)",A:"m(t.hours(),t.minutes(),!1)",H:"t.hours()",h:"t.hours()%12||12",m:"t.minutes()",s:"t.seconds()",S:"~~(t.milliseconds()/100)",SS:"p(~~(t.milliseconds()/10),2)",SSS:"p(t.milliseconds(),3)",Z:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(a/60),2)+":"+p(~~a%60,2)',ZZ:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(10*a/6),4)'},E="DDD w M D d".split(" "),u="M D H h m s w".split(" ");while(E.length){ac=E.pop();G[ac+"o"]=G[ac]+"+o(a)"}while(u.length){ac=u.pop();G[ac+ac]="p("+G[ac]+",2)"}G.DDDD="p("+G.DDD+",3)";function t(ag,i,ah){this._d=ag;this._isUTC=!!i;this._a=ag._a||null;ag._a=null;this._lang=ah||false}function af(ai){var ak=this._data={},al=ai.years||ai.y||0,ag=ai.months||ai.M||0,i=ai.weeks||ai.w||0,ao=ai.days||ai.d||0,am=ai.hours||ai.h||0,aj=ai.minutes||ai.m||0,an=ai.seconds||ai.s||0,ah=ai.milliseconds||ai.ms||0;this._milliseconds=ah+an*1000+aj*60000+am*3600000;this._days=ao+i*7;this._months=ag+al*12;ak.milliseconds=ah%1000;an+=W(ah/1000);ak.seconds=an%60;aj+=W(an/60);ak.minutes=aj%60;am+=W(aj/60);ak.hours=am%24;ao+=W(am/24);ao+=i*7;ak.days=ao%30;ag+=W(ao/30);ak.months=ag%12;al+=W(ag/12);ak.years=al;this._lang=false}function W(i){if(i<0){return Math.ceil(i)}else{return Math.floor(i)}}function aa(ah,ag){var i=ah+"";while(i.length<ag){i="0"+i}return i}function S(ah,aj,ai){var ag=aj._milliseconds,ak=aj._days,al=aj._months,i;if(ag){ah._d.setTime(+ah+ag*ai)}if(ak){ah.date(ah.date()+ak*ai)}if(al){i=ah.date();ah.date(1).month(ah.month()+al*ai).date(Math.min(i,ah.daysInMonth()))}}function B(i){return Object.prototype.toString.call(i)==="[object Array]"}function R(ak,aj){var ag=Math.min(ak.length,aj.length),ah=Math.abs(ak.length-aj.length),al=0,ai;for(ai=0;ai<ag;ai++){if(~~ak[ai]!==~~aj[ai]){al++}}return al+ah}function j(ag,aj){var ai,ah;for(ai=1;ai<7;ai++){ag[ai]=(ag[ai]==null)?(ai===2?1:0):ag[ai]}ag[7]=aj;ah=new Q(0);if(aj){ah.setUTCFullYear(ag[0],ag[1],ag[2]);ah.setUTCHours(ag[3],ag[4],ag[5],ag[6])}else{ah.setFullYear(ag[0],ag[1],ag[2]);ah.setHours(ag[3],ag[4],ag[5],ag[6])}ah._a=ag;return ah}function x(aj,ah){var ai,ag,ak=[];if(!ah&&M){ah=require("./lang/"+aj)}for(ai=0;ai<o.length;ai++){ah[o[ai]]=ah[o[ai]]||N.en[o[ai]]}for(ai=0;ai<12;ai++){ag=V([2000,ai]);ak[ai]=new RegExp("^"+(ah.months[ai]||ah.months(ag,""))+"|^"+(ah.monthsShort[ai]||ah.monthsShort(ag,"")).replace(".",""),"i")}ah.monthsParse=ah.monthsParse||ak;N[aj]=ah;return ah}function w(i){var ag=(typeof i==="string")&&i||i&&i._lang||null;return ag?(N[ag]||x(ag)):V}function L(i){return G[i]?("'+("+G[i]+")+'"):i.replace(ae,"").replace(/\\?'/g,"\\'")}function Z(i){return w().longDateFormat[i]||i}function U(ah){var i="var a,b;return '"+ah.replace(k,L)+"';",ag=Function;return new ag("t","v","o","p","m",i)}function p(i){if(!l[i]){l[i]=U(i)}return l[i]}function K(i,ah){var ai=w(i);function ag(ak,aj){return ai[ak].call?ai[ak](i,ah):ai[ak][aj]}while(q.test(ah)){ah=ah.replace(q,Z)}if(!l[ah]){l[ah]=U(ah)}return l[ah](i,ag,ai.ordinal,aa,ai.meridiem)}function f(i){switch(i){case"DDDD":return P;case"YYYY":return F;case"S":case"SS":case"SSS":case"DDD":return O;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return H;case"Z":case"ZZ":return b;case"T":return s;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return g;default:return new RegExp(i.replace("\\",""))}}function e(aj,ah,ag,ai){var i;switch(aj){case"M":case"MM":ag[1]=(ah==null)?0:~~ah-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++){if(w().monthsParse[i].test(ah)){ag[1]=i;break}}break;case"D":case"DD":case"DDD":case"DDDD":if(ah!=null){ag[2]=~~ah}break;case"YY":ah=~~ah;ag[0]=ah+(ah>70?1900:2000);break;case"YYYY":ag[0]=~~Math.abs(ah);break;case"a":case"A":ai.isPm=((ah+"").toLowerCase()==="pm");break;case"H":case"HH":case"h":case"hh":ag[3]=~~ah;break;case"m":case"mm":ag[4]=~~ah;break;case"s":case"ss":ag[5]=~~ah;break;case"S":case"SS":case"SSS":ag[6]=~~(("0."+ah)*1000);break;case"Z":case"ZZ":ai.isUTC=true;i=(ah+"").match(A);if(i&&i[1]){ai.tzh=~~i[1]}if(i&&i[2]){ai.tzm=~~i[2]}if(i&&i[0]==="+"){ai.tzh=-ai.tzh;ai.tzm=-ai.tzm}break}}function J(ai,am){var ag=[0,0,1,0,0,0,0],ah={tzh:0,tzm:0},al=am.match(k),aj,ak;for(aj=0;aj<al.length;aj++){ak=(f(al[aj]).exec(ai)||[])[0];ai=ai.replace(f(al[aj]),"");e(al[aj],ak,ag,ah)}if(ah.isPm&&ag[3]<12){ag[3]+=12}if(ah.isPm===false&&ag[3]===12){ag[3]=0}ag[3]+=ah.tzh;ag[4]+=ah.tzm;return j(ag,ah.isUTC)}function z(ak,am){var ah,an=ak.match(ad)||[],al,ao=99,aj,ag,ai;for(aj=0;aj<am.length;aj++){ag=J(ak,am[aj]);al=K(new t(ag),am[aj]).match(ad)||[];ai=R(an,al);if(ai<ao){ao=ai;ah=ag}}return ah}function Y(ag){var ai="YYYY-MM-DDT",ah;if(I.exec(ag)){for(ah=0;ah<4;ah++){if(h[ah][1].exec(ag)){ai+=h[ah][0];break}}return b.exec(ag)?J(ag,ai+" Z"):J(ag,ai)}return new Q(ag)}function T(ag,ai,ah,aj,ak){var i=ak.relativeTime[ag];return(typeof i==="function")?i(ai||1,!!ah,ag,aj):i.replace(/%d/i,ai||1)}function D(ah,i,ag){var am=ab(Math.abs(ah)/1000),ai=ab(am/60),al=ab(ai/60),an=ab(al/24),aj=ab(an/365),ak=am<45&&["s",am]||ai===1&&["m"]||ai<45&&["mm",ai]||al===1&&["h"]||al<22&&["hh",al]||an===1&&["d"]||an<=25&&["dd",an]||an<=45&&["M"]||an<345&&["MM",ab(an/30)]||aj===1&&["y"]||["yy",aj];ak[2]=i;ak[3]=ah>0;ak[4]=ag;return T.apply({},ak)}V=function(ag,ai){if(ag===null||ag===""){return null}var ah,i;if(V.isMoment(ag)){return new t(new Q(+ag._d),ag._isUTC,ag._lang)}else{if(ai){if(B(ai)){ah=z(ag,ai)}else{ah=J(ag,ai)}}else{i=v.exec(ag);ah=ag===r?new Q():i?new Q(+i[1]):ag instanceof Q?ag:B(ag)?j(ag):typeof ag==="string"?Y(ag):new Q(ag)}}return new t(ah)};V.utc=function(i,ag){if(B(i)){return new t(j(i,true),true)}if(typeof i==="string"&&!b.exec(i)){i+=" +0000";if(ag){ag+=" Z"}}return V(i,ag).utc()};V.unix=function(i){return V(i*1000)};V.duration=function(i,aj){var ai=V.isDuration(i),ah=(typeof i==="number"),ak=(ai?i._data:(ah?{}:i)),ag;if(ah){if(aj){ak[aj]=i}else{ak.milliseconds=i}}ag=new af(ak);if(ai){ag._lang=i._lang}return ag};V.humanizeDuration=function(i,ag,ah){return V.duration(i,ag===true?null:ag).humanize(ag===true?true:ah)};V.version=y;V.defaultFormat=d;V.lang=function(ai,ag){var ah;if(!ai){return C}if(ag||!N[ai]){x(ai,ag)}if(N[ai]){for(ah=0;ah<o.length;ah++){V[o[ah]]=N[ai][o[ah]]}V.monthsParse=N[ai].monthsParse;C=ai}};V.langData=w;V.isMoment=function(i){return i instanceof t};V.isDuration=function(i){return i instanceof af};V.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(i,ag,ah){if(i>11){return ah?"pm":"PM"}else{return ah?"am":"AM"}},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(ag){var i=ag%10;return(~~(ag%100/10)===1)?"th":(i===1)?"st":(i===2)?"nd":(i===3)?"rd":"th"}});V.fn=t.prototype={clone:function(){return V(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var i=this;return[i.year(),i.month(),i.date(),i.hours(),i.minutes(),i.seconds(),i.milliseconds(),!!this._isUTC]},isValid:function(){if(this._a){return !R(this._a,(this._a[7]?V.utc(this):this).toArray())}return !isNaN(this._d.getTime())},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(i){return K(this,i?i:V.defaultFormat)},add:function(i,ah){var ag=ah?V.duration(+ah,i):V.duration(i);S(this,ag,1);return this},subtract:function(i,ah){var ag=ah?V.duration(+ah,i):V.duration(i);S(this,ag,-1);return this},diff:function(am,ah,ao){var i=this._isUTC?V(am).utc():V(am).local(),aj=(this.zone()-i.zone())*60000,an=this._d-i._d-aj,al=this.year()-i.year(),ak=this.month()-i.month(),ai=this.date()-i.date(),ag;if(ah==="months"){ag=al*12+ak+ai/30}else{if(ah==="years"){ag=al+(ak+ai/30)/12}else{ag=ah==="seconds"?an/1000:ah==="minutes"?an/60000:ah==="hours"?an/3600000:ah==="days"?an/86400000:ah==="weeks"?an/604800000:an}}return ao?ag:ab(ag)},from:function(ag,i){return V.duration(this.diff(ag)).lang(this._lang).humanize(!i)},fromNow:function(i){return this.from(V(),i)},calendar:function(){var ai=this.diff(V().sod(),"days",true),ah=this.lang().calendar,ag=ah.sameElse,i=ai<-6?ag:ai<-1?ah.lastWeek:ai<0?ah.lastDay:ai<1?ah.sameDay:ai<2?ah.nextDay:ai<7?ah.nextWeek:ag;return this.format(typeof i==="function"?i.apply(this):i)},isLeapYear:function(){var i=this.year();return(i%4===0&&i%100!==0)||i%400===0},isDST:function(){return(this.zone()<V([this.year()]).zone()||this.zone()<V([this.year(),5]).zone())},day:function(ag){var i=this._isUTC?this._d.getUTCDay():this._d.getDay();return ag==null?i:this.add({d:ag-i})},startOf:function(i){switch(i.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(i){return this.startOf(i).add(i.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return V.utc([this.year(),this.month()+1,0]).date()},lang:function(i){if(i===r){return w(this)}else{this._lang=i;return this}}};function n(i,ag){V.fn[i]=function(ah){var ai=this._isUTC?"UTC":"";if(ah!=null){this._d["set"+ai+ag](ah);return this}else{return this._d["get"+ai+ag]()}}}for(ac=0;ac<m.length;ac++){n(m[ac].toLowerCase(),m[ac])}n("year","FullYear");V.duration.fn=af.prototype={weeks:function(){return W(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(ah){var ai=+this,i=this.lang().relativeTime,ag=D(ai,!ah,this.lang());if(ah){ag=(ai<=0?i.past:i.future).replace(/%s/i,ag)}return ag},lang:V.fn.lang};function a(i){V.duration.fn[i]=function(){return this._data[i]}}function c(i,ag){V.duration.fn["as"+i]=function(){return +this/ag}}for(ac in X){if(X.hasOwnProperty(ac)){c(ac,X[ac]);a(ac.toLowerCase())}}c("Weeks",604800000);if(M){module.exports=V}if(typeof ender==="undefined"){this["moment"]=V}if(typeof define==="function"&&define.amd){define("moment",[],function(){return V})}}).call(this,Date);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:retrospective-resources', location = 'com/atlassian/confluence/plugins/retrospectives/js/retrospectives-wizard.js' */
(function(c){function b(f,d){Confluence.Blueprints.Restrospectives.init(d)}function a(f,d){return Confluence.Blueprints.Restrospectives.validateRetroForm()}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-software-blueprints:retrospectives-item",function(d){d.on("post-render.retrospectivePageId",b);d.on("submit.retrospectivePageId",a)})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:retrospective-resources', location = 'com/atlassian/confluence/plugins/retrospectives/js/retrospectives.js' */
Confluence.Blueprints.Restrospectives=(function(d){var h;var e="YYYY-MM-DD";var c=function(i){i.siblings(".error").empty()};var b=function(i,j){i.focus().siblings(".error").text(j)};var g=function(){if(h.title.val()===""){return true}if(!Confluence.Blueprint.canCreatePage(h.spaceKey,h.title.val())){b(h.title,"A page with this name already exists.");return false}c(h.title);return true};var f=function(){h.title.change(g)};var a=function(){var j=d("meta[name=confluence-request-time]").attr("content");var i=moment(parseFloat(j)).format(e);h.title.val(i+" "+"Retrospective")};return{init:function(i){h={title:i.$container.find("#retro-title"),participants:i.$container.find("#retro-participants"),spaceKey:i.wizardData.spaceKey};f();a()},validateRetroForm:function(){return g()}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:retrospective-resources', location = 'com/atlassian/confluence/plugins/retrospectives/soy/dialogs.soy' */
// This file was automatically generated from dialogs.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Retrospectives == 'undefined') { Confluence.Blueprints.Retrospectives = {}; }
if (typeof Confluence.Blueprints.Retrospectives.Dialog == 'undefined') { Confluence.Blueprints.Retrospectives.Dialog = {}; }


Confluence.Blueprints.Retrospectives.Dialog.retrospective = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui retrospective" method="post" action="#"><fieldset><div class="field-group"><label for="retro-title">', soy.$$escapeHtml("Title"), '</label><input id="retro-title" class="text long-field" type="text" name="retro-title" title="title" maxlength="255"><div class="error"/></div><div class="field-group"><label for="retro-participants">', soy.$$escapeHtml("Participants"), '</label><input id="retro-participants" class="text long-field autocomplete-multiuser" type="text" name="retro-participants" data-autofill-user="true" placeholder="', soy.$$escapeHtml("Add the participants of this retrospective"), '"></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-software-blueprints:retrospective-resources', location = 'com/atlassian/confluence/plugins/blueprints/common/common.soy' */
// This file was automatically generated from common.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Common == 'undefined') { Confluence.Blueprints.Common = {}; }


Confluence.Blueprints.Common.userList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul>');
  var nameList4 = opt_data.names;
  var nameListLen4 = nameList4.length;
  for (var nameIndex4 = 0; nameIndex4 < nameListLen4; nameIndex4++) {
    var nameData4 = nameList4[nameIndex4];
    output.append('<li><ac:link><ri:user ri:username="', soy.$$escapeHtml(nameData4), '" /></ac:link></li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Common.userTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var nameList11 = opt_data.names;
  var nameListLen11 = nameList11.length;
  for (var nameIndex11 = 0; nameIndex11 < nameListLen11; nameIndex11++) {
    var nameData11 = nameList11[nameIndex11];
    output.append('<tr><td><ac:macro ac:name="profile-picture"><ac:parameter ac:name="User">', soy.$$escapeHtml(nameData11), '</ac:parameter></ac:macro><br></br><ac:link><ri:user ri:username="', soy.$$escapeHtml(nameData11), '" /></ac:link></td><td/><td/></tr>');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Common.users = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var nameList19 = opt_data.names;
  var nameListLen19 = nameList19.length;
  for (var nameIndex19 = 0; nameIndex19 < nameListLen19; nameIndex19++) {
    var nameData19 = nameList19[nameIndex19];
    output.append('<ac:link><ri:user ri:username="', soy.$$escapeHtml(nameData19), '" /></ac:link>&nbsp;');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Common.createFromTemplateMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="create-from-template"><ac:parameter ac:name="blueprintModuleCompleteKey">', soy.$$escapeHtml(opt_data.blueprintKey), '</ac:parameter><ac:parameter ac:name="buttonLabel">', soy.$$escapeHtml(opt_data.buttonLabel), '</ac:parameter><ac:parameter ac:name="spaceKey">', soy.$$escapeHtml(opt_data.spaceKey), '</ac:parameter><ac:parameter ac:name="templateName">', soy.$$escapeHtml(opt_data.blueprintKey), '</ac:parameter></ac:macro>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-blueprints:confluence-team-space-blueprint-resources', location = 'com/atlassian/confluence/plugins/team/js/confluence-team-space-blueprints.js' */
AJS.bind("blueprint.wizard-register.ready",function(){function a(d,c){c.pageData.ContentPageTitle=c.pageData.name;return Confluence.SpaceBlueprint.CommonWizardBindings.submit(d,c)}function b(d,c){c.soyRenderContext.atlToken=AJS.Meta.get("atl-token");c.soyRenderContext.showSpacePermission=false}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-space-blueprints:team-space-blueprint-item",function(c){c.on("submit.teamSpaceId",a);c.on("pre-render.teamSpaceId",b);c.on("post-render.teamSpaceId",Confluence.SpaceBlueprint.CommonWizardBindings.postRender)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-blueprints:confluence-team-space-blueprint-resources', location = 'com/atlassian/confluence/plugins/team/soy/dialog-page.soy' */
// This file was automatically generated from dialog-page.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.SpaceBlueprints == 'undefined') { Confluence.SpaceBlueprints = {}; }
if (typeof Confluence.SpaceBlueprints.Team == 'undefined') { Confluence.SpaceBlueprints.Team = {}; }


Confluence.SpaceBlueprints.Team.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="decisions-form" class="common-space-form aui">');
  Confluence.Templates.Blueprints.CreateSpace.createSpaceFormFields({showSpacePermission: false, fieldErrors: opt_data.fieldErrors, name: opt_data.name, spaceKey: opt_data.spaceKey}, output);
  output.append('<fieldset><div class="field-group"><label for="team-members">', soy.$$escapeHtml("Team members"), '</label><input id="team-members" class="text long-field autocomplete-multiuser" type="text" name="members" placeholder="', soy.$$escapeHtml("Add your team members"), '" data-autofill-user="true"/></div><div class="field-group"><label for="team-description">', soy.$$escapeHtml("Description"), '</label><textarea id="team-description" class="textarea long-field" rows="3" type="text" name="description" placeholder="', soy.$$escapeHtml("Let others know what this space is for"), '"></textarea></div></fieldset><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-blueprints:confluence-documentation-space-blueprint-resources', location = 'com/atlassian/confluence/plugins/documentation/js/confluence-documentation-space-blueprint.js' */
AJS.bind("blueprint.wizard-register.ready",function(){function b(d,c){c.pageData.ContentPageTitle=c.pageData.name;return Confluence.SpaceBlueprint.CommonWizardBindings.submit(d,c)}function a(d,c){c.soyRenderContext.atlToken=AJS.Meta.get("atl-token");c.soyRenderContext.showSpacePermission=false}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-space-blueprints:documentation-space-blueprint-item",function(c){c.on("submit.documentationSpaceId",b);c.on("pre-render.documentationSpaceId",a);c.on("post-render.documentationSpaceId",Confluence.SpaceBlueprint.CommonWizardBindings.postRender)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-blueprints:confluence-documentation-space-blueprint-resources', location = 'com/atlassian/confluence/plugins/documentation/soy/dialog-page.soy' */
// This file was automatically generated from dialog-page.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.SpaceBlueprints == 'undefined') { Confluence.SpaceBlueprints = {}; }
if (typeof Confluence.SpaceBlueprints.Documentation == 'undefined') { Confluence.SpaceBlueprints.Documentation = {}; }


Confluence.SpaceBlueprints.Documentation.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="documentation-space-form" class="common-space-form aui">');
  Confluence.Templates.Blueprints.CreateSpace.createSpaceFormFields({showSpacePermission: false, fieldErrors: opt_data.fieldErrors, name: opt_data.name, key: opt_data.key}, output);
  output.append('<fieldset><div class="field-group"><label for="documentation-description">', soy.$$escapeHtml("Description"), '</label><textarea id="documentation-description" class="textarea long-field" rows="3" type="text" name="spaceDesc" placeholder="', soy.$$escapeHtml("Briefly describe the documentation in this space"), '"></textarea></div></fieldset><input type="hidden" name="noPageTitlePrefix" value="true" /><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'templates/recently.soy' */
// This file was automatically generated from recently.soy.
// Please don't edit this file by hand.

if (typeof RY == 'undefined') { var RY = {}; }
if (typeof RY.Templates == 'undefined') { RY.Templates = {}; }


RY.Templates.body = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="recently-viewed" class="aui-group"><div class="aui-item"><div class="top"><div class="filter"><form class="aui"><input class="filter-input text" type="text" placeholder="', "Filter", '"></form></div></div><div class="pages"></div><div class="recently-viewed-spinner" id="', soy.$$escapeHtmlAttribute(opt_data.spinnerId), '"></div></div></div>');
  return opt_sb ? '' : output.toString();
};


RY.Templates.pageCollection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="groups"></div><div class="empty"></div>');
  return opt_sb ? '' : output.toString();
};


RY.Templates.pageGroup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h3>', soy.$$escapeHtml(opt_data.title), '</h3><ul/>');
  return opt_sb ? '' : output.toString();
};


RY.Templates.pageItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="page-icon"><a href=', soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)), ' class="icon icon-', soy.$$escapeHtmlAttribute(opt_data.type), '"></a></div><div class="page-title"><a class="ellipsis" href=', soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)), '>', soy.$$escapeHtml(opt_data.title), ' - ', soy.$$escapeHtml(opt_data.space), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/util.js' */
var RY=RY||{};(function(){var b=new Date();var c=new Date(b).getTime();var a=new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime();var d=new Date(b.getFullYear(),b.getMonth(),b.getDate()-1).getTime();RY.util=RY.Util={analytics:{trackDialogOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-dialog-open"})},trackPageOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-page-open"})}},quote:function(e){return(e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},diffInDays:function(g,f){var e=1000*60*60*24;return Math.floor((g-f)/e)},daysSince:function(e){if(e>=a){return 0}else{if(e>=d){return 1}else{return RY.util.diffInDays(c,e)}}},formatDate:function(e){if(e>=a){e="Today"}else{if(e>=d){e="Yesterday"}else{var f=RY.util.diffInDays(c,e);e=AJS.format("{0} days ago",f)}}return e},wait:function(h,j,f){var i,k,e;var g=function(){k=setTimeout(function(){h.apply(f,e)},j)};return function(){e=arguments;var l=new Date();if(i&&l-i<j){clearTimeout(k)}g();i=l}}}}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page-storage.js' */
var RY=RY||{};RY.RecentPageStorage=function(h){var f="com.atlassian.confluence.plugins.recently.viewed.pages.v1";var d=100;var c={};var b=function(){var i=function(k,l){if(k==="lastSeen"&&_.isString(l)){if(AJS.$.browser.msie){l=l.replace(/\-/g,"/");l=l.replace(/T.*$/,"")}return new Date(l).getTime()}else{return l}};try{c=JSON.parse(h.getItem(f),i)||{}}catch(j){c={}}return c};var g=function(){var i=_.values(c);var k=i.length-d;if(k>0){var j=_.sortBy(i,function(l){return l.lastSeen});_.times(k,function(){var l=j.shift();delete c[l.id]})}};var e=function(){g();try{h.setItem(f,JSON.stringify(c))}catch(i){}};this.addCurrentPage=function(i){if(!(i.id&&i.title)){return}b();a(i);e()};var a=function(i){var j=c[i.id];if(!j){c[i.id]=j={}}j=_.extend(j,i);j.lastSeen=new Date().getTime();j.count=j.count+1||1};this.getPages=function(){return _.values(b())}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/filter.js' */
var RY=RY||{};RY.FilterView=Backbone.View.extend({className:"filter",events:{"input .filter-input":"onInput","keyup .filter-input":"onInput","keydown .filter-input":"onKeydown"},initialize:function(){_.bindAll(this,"render","onInput","onKeydown","search");this.navigationEvents=this.options.navigationEvents;this.onInput=RY.util.wait(this.onInput,100,this)},render:function(){this.$input=this.$(".filter-input");return this},onInput:function(a){if(a&&_.contains([37,38,39,40],a.which)){return}this.search()},onKeydown:function(a){switch(a.which){case 13:this.navigationEvents.trigger("select");a.preventDefault();a.stopPropagation();break;case 38:this.navigationEvents.trigger("previous");a.preventDefault();break;case 40:this.navigationEvents.trigger("next");a.preventDefault();break}},search:function(){var a=this.$input.val();this.collection.search(a)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page.js' */
var RY=RY||{};RY.Page=Backbone.Model.extend({href:function(){return AJS.contextPath()+this.get("url")},daysSinceLastSeen:function(){return RY.util.daysSince(this.get("lastSeen"))}});RY.PageCollection=Backbone.Collection.extend({model:RY.Page,url:AJS.contextPath()+"/rest/recentlyviewed/1.0/recent",search:function(b){var a;if(AJS.$.trim(b).length===0){a=this.models}else{var c=b.match(/[^\s-]+/g);a=this.filter(function(f){var g=f.get("title");var e=f.get("space");var d=(g+e).toLowerCase();return _.all(c,function(h){return d.indexOf(h.toLowerCase())!==-1})})}this.trigger("filter",a,b);return a},comparator:function(a){return -(a.get("lastSeen"))}});RY.PageView=Backbone.View.extend({tagName:"li",className:"ry-page",template:RY.Templates.pageItem,initialize:function(){_.bindAll(this,"hide","show","render")},hide:function(){this.$el.hide().removeClass("shown")},show:function(){this.$el.show().addClass("shown")},render:function(){var a=this.model.toJSON();a.href=this.model.href();this.$el.html(this.template(a));return this}});RY.PageGroupView=Backbone.View.extend({className:"group",template:RY.Templates.pageGroup,initialize:function(){_.bindAll(this,"hide","hideAll","show","showBorder","showPages","add","render");this.title=this.options.title;this.modelViews={}},hide:function(){this.$el.hide()},hideAll:function(){this.$el.removeClass("border").hide();_.invoke(_.values(this.modelViews),"hide")},show:function(){this.$el.show()},showBorder:function(){this.$el.addClass("border")},showPages:function(a){var c=this;var b=false;_.each(a,function(e){var d=c.modelViews[e.cid];if(d){b=true;d.show()}});if(b){this.show()}return b},add:function(b){var a=new RY.PageView({model:b});this.modelViews[b.cid]=a;this.$list.append(a.render().el)},render:function(){this.$el.html(this.template({title:this.title}));this.$list=this.$("ul");return this}});RY.PageNavigator=function(a,e,c){var g=null;function f(){return a.find("li.shown")}function b(i){pageItems=f();var h=pageItems.index(pageItems.filter(".highlight"));if(g){g.removeClass("highlight")}i+=h;if(i<0){i=pageItems.length-1}if(i>=pageItems.length){i=0}g=pageItems.eq(i);g.addClass("highlight")}function d(){if(!g.length){return}var k=e;var l=k.children();var j=k.height();var i=g.outerHeight(true);var h=g.position().top;if(h<0){if(f().index(g)===0){k.scrollTop(0);return}k.scrollTop(g.offset().top-l.offset().top)}else{if(h>j){k.scrollTop(g.offset().top-l.offset().top-j+i)}}}c.on("select",function(){if(g&&g.is(":visible")){RY.util.analytics.trackPageOpen();var h=g.find(".page-title a").attr("href");window.location=h}},this);c.on("previous",function(){b(-1);d()},this);c.on("next",function(){b(1);d()},this)};RY.PageCollectionView=Backbone.View.extend({template:RY.Templates.pageCollection,events:{"click .page-title a":RY.util.analytics.trackPageOpen},initialize:function(){_.bindAll(this,"checkEmpty","filter","_groupForPage","addOne","showEmptyMessage","clearEmptyMessage","addAll","render");this.modelViews={};this.collection.on("reset",this.addAll,this);this.collection.on("add",this.addOne,this);this.collection.on("filter",this.filter,this)},checkEmpty:function(a,e){var f=this.collection.isEmpty();var b=a.length===0;if(f||b){var c;if(f){c="Sorry mate, looks like you haven\'t visited any pages yet."}else{var d=AJS.contextPath()+"/dosearchsite.action?queryString="+encodeURIComponent(e);c=AJS.format("We didn\'\'t find any matching pages in your history. \u003ca href=\"{0}\">Click here\u003c\/a> to search for this term instead.",d)}this.showEmptyMessage(c)}else{this.clearEmptyMessage()}},filter:function(b,d){d=d||"";this.checkEmpty(b,d);var a=[this.$today,this.$yesterday,this.$older];_.invoke(a,"hideAll");var c=[];_.each(a,function(f){var e=f.showPages(b);if(e){c.push(f)}});if(c.length>1){c.pop();_.invoke(c,"showBorder")}},_groupForPage:function(a){var b=a.daysSinceLastSeen();if(b===0){return this.$today}else{if(b===1){return this.$yesterday}else{return this.$older}}},addOne:function(a){var b=this._groupForPage(a);b.add(a)},showEmptyMessage:function(a){this.$(".empty").html(AJS.$("<p>").html(a))},clearEmptyMessage:function(){this.$(".empty").html("")},addAll:function(){this.collection.each(this.addOne)},render:function(){this.$el.html(this.template());this.$today=new RY.PageGroupView({title:"Today"});this.$yesterday=new RY.PageGroupView({title:"Yesterday"});this.$older=new RY.PageGroupView({title:"Older"});var a=this.$(".groups");a.append(this.$today.render().el);a.append(this.$yesterday.render().el);a.append(this.$older.render().el);_.invoke([this.$today,this.$yesterday,this.$older],"hideAll");return this}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/quicknav/util.js' */
var RYQ=RYQ||{};(function(){RYQ.util={analytics:{trackQuickNavOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-open"})},trackQuickNavPageOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-click-page"})},trackQuickNavRecentlyDialogOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-click-more-recent"})}}}}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/quicknav/quicknav.js' */
var RYQ=RYQ||{};RYQ.QuickNavEntry=Backbone.Model.extend({classNameByType:{blogpost:"content-type-blogpost",page:"content-type-page"},parse:function(a){return{className:this.classNameByType[a.type],name:a.title,href:AJS.contextPath()+a.url,id:a.id,spaceName:a.space,lastSeen:a.lastSeen}}},{escape:function(b){var a=_.map(b,_.clone);_.each(a,function(c){c.name=_.escape(c.name);c.spaceName=_.escape(c.spaceName)});return a}});RYQ.QuickNavEntryCollection=Backbone.Collection.extend({model:RYQ.QuickNavEntry,url:AJS.contextPath()+"/rest/recentlyviewed/1.0/recent?limit=8",search:function(b){var a;if(AJS.$.trim(b).length===0){a=this.models}else{var c=b.match(/[^\s-]+/g);a=this.filter(function(e){var f=e.get("name");var d=f.toLowerCase();return _.all(c,function(g){return d.indexOf(g.toLowerCase())!==-1})})}this.trigger("filter",a);return a},comparator:function(a){return -(a.get("lastSeen"))}});(function(a){RYQ.QuickNav=Backbone.View.extend({initialize:function(){this.moreLink={className:"recently-viewed",href:"#",name:"More recently viewed pages..."};this.$input=a("#quick-search-query");this.makeDropdown();this.addShowHideHandlers();this.getHistory=_.once(this._getHistory);_.bindAll(this,"makeDropdown","addSearchResultBoostingHandler","_getHistory","render","addShowHideHandlers","_getItemsToShow","showQuickResults","onQuickSearch")},makeDropdown:function(){var c=function(d){a("a",d).each(function(){var g=a(this);var e=g.find("span");var f=AJS.dropDown.getAdditionalPropertyValue(e,"spaceName");if(f&&!g.is(".content-type-spacedesc")){g.after(g.clone().attr("class","space-name").html(f));g.parent().addClass("with-space-name")}})};var b=this;this.$dropdown=AJS.inputDrivenDropdown({dropdownPlacement:function(d){b.$input.closest("form").find(".quick-nav-drop-down").append(d)},dropdownPostprocess:function(d){c(d)},ajsDropDownOptions:{className:"recently-viewed-dropdown"}})},addSearchResultBoostingHandler:function(){var b=this;a(window).on("quicksearch.ajax-success",function(g,f){var d=f.url.match("/json/contentnamesearch.action");var c=f.url.match(/rest\/quicknav\/\d\/search/);if(d||c){b.onQuickSearch(g,f)}})},_getHistory:function(){return this.collection.fetch().done(this.addSearchResultBoostingHandler)},render:function(){var b=this.getHistory();b.done(_.bind(function(){if(AJS.dropDown.current==null&&this.collection.length!==0&&this.$input.val().length===0){this.showQuickResults()}},this));var c=this.$input;c.trigger("quick-search-loading-start");b.always(function(){c.trigger("quick-search-loading-stop")})},addShowHideHandlers:function(){var b=this;this.$input.on("focus",function(){b.render()}).on("click",function(c){c.stopPropagation();b.render()}).on("keyup",function(f){var c=f.which===27;var g=f.which===13;var d=a(this).val().length!==0;if(d||c){if(b.$dropdown.dd&&b.$dropdown.dd.$.is(":visible")){b.$dropdown.hide()}}else{if(!g){b.render()}}})},_getItemsToShow:function(){var c=this.collection.toJSON();var b=c.length>0&&c[0].id==AJS.Meta.get("page-id");if(b){c.shift()}return c},showQuickResults:function(){var b=RYQ.QuickNavEntry.escape(this._getItemsToShow());this.$dropdown.show([b,[this.moreLink]],"","");a(".recently-viewed-dropdown").on("click",".recently-viewed",function(c){c.preventDefault();a("#view-user-history-link").click();RYQ.util.analytics.trackQuickNavRecentlyDialogOpen()});a(".recently-viewed-dropdown").on("click",".with-space-name",function(c){RYQ.util.analytics.trackQuickNavPageOpen()});RYQ.util.analytics.trackQuickNavOpen()},onQuickSearch:function(l,f){var o=f.json.query;var c=_.map(this.collection.search(o),function(e){return e.attributes});c=RYQ.QuickNavEntry.escape(c);if(c.length==0){return}var m=f.json.contentNameMatches;var p=-1;for(var g=0;g<m.length;g++){var n=m[g][0].className;if(n=="content-type-blogpost"||n=="content-type-page"){p=g;break}}if(p!=-1){var h=m[p];var b=Math.min(h.length>4?2:6-h.length,c.length);h.unshift.apply(h,_(c).first(b));m[p]=_.uniq(h,function(e){return +e.id});if(h.length>6){var k=6-b;for(var d=k;d>0;d--){h.pop()}}}else{m.unshift(_(c).first(6))}}})}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:main-resources', location = 'js/main.js' */
var RY=RY||{};AJS.toInit(function(a){a("#view-user-history-link").unbind("click");a("#view-user-history-link").click(function(i){i.preventDefault();var d=new AJS.Dialog({width:600,height:500,id:"recently-viewed-dialog",closeOnOutsideClick:true});var c="recently-viewed-spinner-"+Math.random();var h=a(RY.Templates.body({spinnerId:c}));d.addHeader("Recently viewed pages");d.addPanel("SinglePanel",h);d.addLink("Close",function(e){e.hide()});var f=a("<div>",{"class":"dialog-tip"}).text("Hint: type \"g\" and then \"r\" anywhere to quickly open this menu");d.popup.element.find(".dialog-button-panel").append(f);var j=new RY.PageCollection();var b=new RY.PageCollectionView({collection:j});h.find(".pages").html(b.render().el);var g=Raphael.spinner(c,16,"#707070");j.fetch({success:function(){g();var k=_.extend({},Backbone.Events);var l=new RY.PageNavigator(b.$el,h.parent(),k);var e=new RY.FilterView({collection:j,el:h.find(".filter"),navigationEvents:k}).render();e.search()}});d.gotoPanel(0);d.show();RY.util.analytics.trackDialogOpen()})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:main-resources', location = 'js/quicknav/main.js' */
var RYQ=RYQ||{};AJS.toInit(function(){var b=new RYQ.QuickNavEntryCollection();var a=new RYQ.QuickNav({collection:b})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-plugin:data', location = 'js/data/data.js' */
(function(){if(!window.WRM){window.WRM={}}var a={};function b(d){if(!d){return d}return JSON.parse(d)}function c(e,d){return Object.prototype.hasOwnProperty.call(e,d)}WRM.data=function(d){if(!c(a,d)){if(WRM._unparsedData&&c(WRM._unparsedData,d)){var g=WRM._unparsedData[d];try{a[d]=b(g);WRM._unparsedData[d]=undefined}catch(f){console&&console.log&&console.log("JSON Error parsing data with key "+d+": "+f)}}else{a[d]=null}}return a[d]}}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.aui.staging:content-ready', location = 'js/content-ready.js' */

// This has been added to directly to confluence to make it into confluence 5.0; it should be remove
// once contentReady is in AUI.

(function($) {

    var EVENT = 'content.ready'; // event name used in underlying event implementation

    // Check it's not already defined, eg when it's added to AUI plugin
    if (AJS.contentReady) {
        return;
    }

    /**
     * Binds an event handler to be called when content is ready.
     *
     * Usage:
     *
     * AJS.contentReady(fn)
     * called whenever content is ready
     *
     * AJS.contentReady(selector, fn)
     * called whenever content has been added that matches the given selector.
     * If the selector matches no elements, the handler will not be called.
     *
     * fn is always called with the first argument as a jQuery element.
     * Optional arguments can be passed by the triggering code.
     */
    AJS.contentReady = function() {
        var handler, boundSelector;
        if (1 === arguments.length) {
            handler = arguments[0];
        }
        else if (2 === arguments.length) {
            boundSelector = arguments[0];
            handler = arguments[1];
        }
        $(AJS).on(EVENT, function(e) {
            var args = Array.prototype.slice.call(arguments, 1),
                $element = args[0];
            if (boundSelector) {
                var $matched;
                if ($element.is(boundSelector)) {
                    $matched = $element;
                }
                else {
                    $matched = $element.find(boundSelector);
                }
                if ($matched.length) {
                    args[0] = $matched;
                    handler.apply(this, args);
                }
            }
            else {
                handler.apply(this, args);
            }
        });
    };

    /**
     * Triggers all bound contentReady event handlers.
     *
     * Usage:
     *
     * AJS.triggerContentReady($el, args...)
     * Calls all contentReady event handlers with the given element.
     * The $el argument is jQuery element and is required.
     * args... are optional arguments passed through to event handlers.
     */
    AJS.triggerContentReady = function() {
        $(AJS).trigger(EVENT, arguments);
    };

    /**
     * contentReady is always triggered on document ready. It is triggered with the body as the context.
     * Developers can set AJS.contentReady.onReadyArgs as a single value or array; these are passed
     * to handlers that are executed on ready.
     */
    $(function() {
        var args = [$("body")];
        if (AJS.contentReady.onReadyArgs) {
            args = args.concat(AJS.contentReady.onReadyArgs);
        }
        AJS.triggerContentReady.apply(this, args);
    });

}(AJS.$));

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:analytics', location = 'analytics/analytics.js' */
var _gaq=_gaq||[];AJS.$(function(){_gaq.push(["navlinks._setAccount","UA-20272869-14"]);_gaq.push(["navlinks._setDomainName","none"]);_gaq.push(["navlinks._setAllowLinker",true]);_gaq.push(["navlinks._setDetectTitle",false]);_gaq.push(["navlinks._trackPageview",location.pathname]);AJS.$.ajax(AJS.contextPath()+"/rest/nav-links-analytics-data/1.0/",{success:function(a){_gaq.push(["navlinks._setCustomVar",1,"isUserAdmin",a.isUserAdmin?"true":"false",2])}})});(function(a){function b(e,g,d,c,f){AJS.log("Firing analytics event"+(c?" - synchronous":""));AJS.log("  Category: "+e);AJS.log("  Action:   "+g);AJS.log("  Label:    "+d);if(f!==undefined){AJS.log("  Value:    "+f)}}a.trackEvent=function(d,f,c,e){if(e===undefined){b(d,f,c,false);_gaq.push(["navlinks._trackEvent",d,f,c])}else{b(d,f,c,false,e);_gaq.push(["navlinks._trackEvent",d,f,c,e])}if(AJS.EventQueue){AJS.EventQueue.push({name:d+"."+f,properties:{label:c,value:e}})}};a.getCurrentApplication=function(){if(window.Confluence!==undefined){return"confluence"}else{if(window.BAMBOO!==undefined){return"bamboo"}else{if(window.JIRA!==undefined){return"jira"}else{return""}}}}}(window.NL=(window.NL||{})));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:analytics', location = 'analytics/help-analytics.js' */
(function(c,b){function a(g,d,f){try{b.trackEvent("helpmenu",g,d,f)}catch(h){AJS.log("failed to track analytics event, category: helpmenu, action: "+g+", label: "+d+", value: "+f)}}c(function(){var d=c("#system-help-menu-content,#help-menu-link-content,#bamboo\\.global\\.header-help\\.menu");d.bind({"aui-dropdown2-show":function(f){a("show","")},"aui-dropdown2-hide":function(f){a("hide","")}}).find("a").unbind(".analytics").bind("click.analytics",function(){var e=this.attributes.href;a("linkFollowed",typeof e==="object"?e.value:e)}).addClass("interactive")})}(jQuery,window.NL=(window.NL||{})));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher == 'undefined') { navlinks.templates.appswitcher = {}; }


navlinks.templates.appswitcher.linkSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.list.length > 0) {
    output.append('<div class="aui-nav-heading sidebar-section-header">', soy.$$escapeHtml(opt_data.title), '</div><ul class="aui-nav nav-links">');
    var linkList8 = opt_data.list;
    var linkListLen8 = linkList8.length;
    for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
      var linkData8 = linkList8[linkIndex8];
      navlinks.templates.appswitcher.applicationsItem(linkData8, output);
    }
    output.append('</ul>');
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(opt_data.link), '" class="interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span></a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(opt_data.link), '" class="interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span>', (opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '', '</a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-error">', "Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">', soy.$$escapeHtml("Application Links"), '</div><div class="app-switcher-loading">', "Loading\x26hellip;", '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">', soy.$$escapeHtml("Shortcuts"), '</div><div class="app-switcher-loading">', "Loading\x26hellip;", '</div></div></nav></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.trigger = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">', soy.$$escapeHtml("Linked Applications"), '</span>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-title">');
  aui.avatar.avatar({size: 'large', avatarImageUrl: opt_data.avatarUrl, isProject: true, title: opt_data.name}, output);
  output.append('<div class="sidebar-project-name">', soy.$$escapeHtml(opt_data.name), '</div></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var dropdownList__soy74 = new soy.StringBuilder();
  navlinks.templates.appswitcher.dropdownList({list: opt_data.links}, dropdownList__soy74);
  dropdownList__soy74 = dropdownList__soy74.toString();
  aui.dropdown2.dropdown2({menu: {'id': opt_data.id, 'content': dropdownList__soy74, 'extraClasses': 'aui-style-default sidebar-customize-section'}, trigger: {'showIcon': false, 'content': '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>', 'container': '#app-switcher'}}, output);
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="sidebar-admin-links">');
  var linkList82 = opt_data.list;
  var linkListLen82 = linkList82.length;
  for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
    var linkData82 = linkList82[linkIndex82];
    output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(linkData82.href), '" title="', soy.$$escapeHtml(linkData82.title), '"><span class="nav-link-label">', soy.$$escapeHtml(linkData82.label), '</span></a></li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.switcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (true) {
    if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
      var sidebarContents__soy97 = new soy.StringBuilder();
      navlinks.templates.appswitcher.sidebarContents(null, sidebarContents__soy97);
      sidebarContents__soy97 = sidebarContents__soy97.toString();
      var triggerContent__soy99 = new soy.StringBuilder();
      navlinks.templates.appswitcher.trigger(null, triggerContent__soy99);
      triggerContent__soy99 = triggerContent__soy99.toString();
      navlinks.templates.appswitcher.sidebar({sidebar: {'id': 'app-switcher', 'content': sidebarContents__soy97}, trigger: {'showIcon': false, 'content': triggerContent__soy99}}, output);
      output.append('<script>\n                (function (NL) {\n                    var initialise = function () {\n                        new NL.SideBar({\n                            sidebarContents: \'#app-switcher\'\n                        });\n                    };\n                    if (NL.SideBar) {\n                        initialise();\n                    } else {\n                        NL.onInit = initialise;\n                    }\n                }(window.NL = (window.NL || {})));\n                window.NL.isUserAdmin = ', soy.$$escapeHtml(false), '<\/script>');
    } else {
      navlinks.templates.appswitcher_old.switcher(null, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.sidebar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="sidebar-trigger app-switcher-trigger" aria-owns="', soy.$$escapeHtml(opt_data.sidebar.id), '" aria-haspopup="true">', opt_data.trigger.content, '</a><div id=', soy.$$escapeHtml(opt_data.sidebar.id), ' class="app-switcher-sidebar aui-style-default sidebar-offscreen">', opt_data.sidebar.content, '</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(c,a){a.SideBar=function(d){var e=this;this.$sidebar=null;d=c.extend({sidebarContents:null},d);this.getLinks=function(){return c.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateAppLinks).fail(this.showAppSwitcherError)};this.populateProjectHeader=function(g,f){e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({avatarUrl:f,name:g}))};this.getProjectData=function(){var f=c(".project-shortcut-dialog-trigger"),g=f.data("key"),h=f.data("entity-type");if(f.size()==0||!g||!h){c(".app-switcher-shortcuts").remove();return}var j,i;i=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+g,cache:false,data:{entityType:h},dataType:"json"});j=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+g,cache:false,data:{entityType:h},dataType:"json"});c.when(i,j).then(function(l,k){e.updateProjectShortcuts(l,k,{key:g,entityType:h,name:f.data("name"),avatarUrl:f.find("img").prop("src")})},e.showProjectShortcutsError)};this.getSidebar=function(){if(!this.$sidebar){this.$sidebar=c(d.sidebarContents)}return this.$sidebar};this.addApplicationsCog=function(){c(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-applications-admin-dropdown",links:[{href:AJS.contextPath()+"/plugins/servlet/customize-application-navigator",label:"Customize navigator",title:"Add new entries, hide existing or restrict who sees what"},{href:AJS.contextPath()+"/plugins/servlet/applinks/listApplicationLinks",label:"Manage application links",title:"Link to more Atlassian applications"}]}))};this.addProjectShortcutsCog=function(f,h){var g=[{href:AJS.contextPath()+"/plugins/servlet/custom-content-links-admin?entityKey="+f,label:"Customize shortcuts",title:""}];if(e.entityMappings[h]){g.push({href:e.generateEntityLinksUrl(f,e.entityMappings[h]),label:"Manage product links",title:""})}e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-project-shortcuts-admin-dropdown",links:g}))};this.updateAppLinks=function(f){c(function(){e.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({title:"Application Links",list:f}));if(a.isUserAdmin){e.addApplicationsCog()}e.bindAnalyticsHandlers(e.getSidebar(),f)})};this.updateProjectShortcuts=function(i,g,h){var j=i[0].shortcuts,f=g[0].shortcuts;e.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({title:"Shortcuts",list:j.concat(f)}));if(a.isUserAdmin){e.addProjectShortcutsCog(h.key,h.entityType)}e.populateProjectHeader(h.name,h.avatarUrl);e.bindAnalyticsHandlers(e.getSidebar(),data)};this.entityMappings={"confluence.space":"com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType","jira.project":"com.atlassian.applinks.api.application.jira.JiraProjectEntityType","bamboo.project":"com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType","stash.project":"com.atlassian.applinks.api.application.stash.StashProjectEntityType"};this.generateEntityLinksUrl=function(f,g){if(g===e.entityMappings["confluence.space"]){return AJS.contextPath()+"/spaces/listentitylinks.action?typeId="+g+"&key="+f}else{return AJS.contextPath()+"/plugins/servlet/applinks/listEntityLinks/"+g+"/"+f}};this.showAppSwitcherError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.showProjectShortcutsError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.retryLoading=function(f){this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());this.getLinks();this.getProjectData();f&&f.stopPropagation()};this.trackEvent=function(h,f,g){try{a.trackEvent("appswitcher-new",h,f,g)}catch(i){AJS.log("failed to track analytics event, category: appswitcher, action: "+h+", label: "+f+", value: "+g)}};this.bindAnalyticsHandlers=function(f,g){};this.getLinks();c(this.getProjectData);this.toggleSidebar=function(h){var i=e.getSidebar(),g=c("body"),f=c(window.document);if(!g.hasClass("app-switcher-open")){var k=c("#header");i.css("left",-i.width());i.parent("body").length||i.appendTo("body");b({data:i});i.animate({left:0},300);function j(l){var n=l.target&&c(l.target),m=l.keyCode;if(l.originalEvent===h.originalEvent){return}if(n&&!m&&!(n.closest(i).length||n.closest(k).length)&&h.which==1&&!(l.shiftKey||l.ctrlKey||l.metaKey)){e.toggleSidebar()}else{if(m===27){e.toggleSidebar()}}}f.on("click.appSwitcher",j);f.on("keydown.appSwitcher",j);f.on("scroll.appSwitcher",i,b)}else{f.off(".appSwitcher")}g.toggleClass("app-switcher-open")};c("#header").on("click",".app-switcher-trigger",this.toggleSidebar)};function b(f){var d=c(document).scrollTop(),g=c("#header"),e=(g.height()+g.offset().top)-d;if(e>=0){f.data.css({top:e,position:"fixed"})}else{f.data.css({top:0,left:0,position:"fixed"})}}if(a.onInit){a.onInit()}}(jQuery,window.NL=(window.NL||{})));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
(function(b,a){a.AppSwitcher=function(c){var d=AJS.contextPath()+"/plugins/servlet/customize-application-navigator";var e=this;this.$dropdown=null;c=b.extend({dropdownContents:null},c);this.getLinks=function(){return b.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateDropdown).fail(this.showError)};this.getDropdown=function(){if(!this.$dropdown){this.$dropdown=b(c.dropdownContents)}return this.$dropdown};this.updateDropdown=function(f){b(function(){e.getDropdown().html(navlinks.templates.appswitcher_old.applications({apps:f,showAdminLink:a.isUserAdmin,adminLink:d}));e.bindAnalyticsHandlers(e.getDropdown(),f)})};this.showError=function(){b(function(){e.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher",".app-switcher-retry",b.proxy(e.retryLoading,e))})};this.retryLoading=function(f){this.getDropdown().html(navlinks.templates.appswitcher_old.loading());this.getLinks();f&&f.stopPropagation()};this.trackEvent=function(h,f,g){try{a.trackEvent("appswitcher-new",h,f,g)}catch(i){AJS.log("failed to track analytics event, category: appswitcher, action: "+h+", label: "+f+", value: "+g)}};this.bindAnalyticsHandlers=function(i,h){function g(){var l=0;for(var j in h){var k=h[j];if(k.custom){l+=1}}return l}var f=g();i.on({"aui-dropdown2-show":function(j){e.trackEvent("show",a.getCurrentApplication(),h.length)},"aui-dropdown2-hide":function(j){e.trackEvent("hide",a.getCurrentApplication(),h.length)}});i.off(".analytics").on("click.analytics","a",function(j){e.trackEvent("appSelected",b(this).attr("href"),h.length)})};this.getLinks()};if(a.onInit){a.onInit()}}(jQuery,window.NL=(window.NL||{})));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher_old == 'undefined') { navlinks.templates.appswitcher_old = {}; }


navlinks.templates.appswitcher_old.applications = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.apps, listClass: 'nav-links', showDescription: opt_data.showDescription}, output);
  if (opt_data.custom) {
    navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.custom, showDescription: opt_data.showDescription}, output);
  }
  if (opt_data.showAdminLink) {
    navlinks.templates.appswitcher_old.adminSection(opt_data, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.list.length > 0) {
    var param19 = new soy.StringBuilder('<ul', (opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '', '>');
    var linkList27 = opt_data.list;
    var linkListLen27 = linkList27.length;
    for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
      var linkData27 = linkList27[linkIndex27];
      navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentData(linkData27, {showDescription: opt_data.showDescription}), param19);
    }
    param19.append('</ul>');
    aui.dropdown2.section({content: param19.toString()}, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link', (opt_data.self) ? ' nav-link-local' : '', '"><a href="', soy.$$escapeHtml(opt_data.link), '" class="aui-dropdown2-radio interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span>', (opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '', '</a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.dropdown2.section({content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + "Configure\x26hellip;" + '</span></a></li></ul>'}, output);
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-error">', "Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.loading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-loading">', "Loading\x26hellip;", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">', soy.$$escapeHtml("Linked Applications"), '</span>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (true) {
    var loadingContent__soy81 = new soy.StringBuilder();
    navlinks.templates.appswitcher_old.loading(null, loadingContent__soy81);
    loadingContent__soy81 = loadingContent__soy81.toString();
    var triggerContent__soy83 = new soy.StringBuilder();
    navlinks.templates.appswitcher_old.trigger(null, triggerContent__soy83);
    triggerContent__soy83 = triggerContent__soy83.toString();
    aui.dropdown2.dropdown2({menu: {'id': 'app-switcher', 'content': loadingContent__soy81, 'extraClasses': 'aui-style-default'}, trigger: {'showIcon': false, 'content': triggerContent__soy83, 'extraClasses': 'app-switcher-trigger'}}, output);
    output.append('<script>\n            (function (NL) {\n                var initialise = function () {\n                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.\n                    window.atlassian = window.atlassian || window.aui;\n                    new NL.AppSwitcher({\n                        dropdownContents: \'#app-switcher\'\n                    });\n                };\n                if (NL.AppSwitcher) {\n                    initialise();\n                } else {\n                    NL.onInit = initialise;\n                }\n            }(window.NL = (window.NL || {})));\n            window.NL.isUserAdmin = ', soy.$$escapeHtml(false), '<\/script>');
  }
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-knowledge-base:space-kb-web-resource', location = 'js/kb-space-dialog-wizard.js' */
AJS.bind("blueprint.wizard-register.ready",function(){function a(d,c){c.pageData.ContentPageTitle=c.pageData.name;return Confluence.SpaceBlueprint.CommonWizardBindings.submit(d,c)}function b(d,c){c.soyRenderContext.atlToken=AJS.Meta.get("atl-token");c.soyRenderContext.showSpacePermission=false}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-knowledge-base:kb-blueprint-item",function(c){c.on("submit.kbSpaceId",a);c.on("pre-render.kbSpaceId",b);c.on("post-render.kbSpaceId",Confluence.SpaceBlueprint.CommonWizardBindings.postRender)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-knowledge-base:space-kb-web-resource', location = 'soy/space.soy' */
// This file was automatically generated from space.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.SpaceBlueprints == 'undefined') { Confluence.SpaceBlueprints = {}; }
if (typeof Confluence.SpaceBlueprints.KnowledgeBase == 'undefined') { Confluence.SpaceBlueprints.KnowledgeBase = {}; }


Confluence.SpaceBlueprints.KnowledgeBase.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="kb-space-form" class="common-space-form aui">');
  Confluence.Templates.Blueprints.CreateSpace.createSpaceFormFields({showSpacePermission: false, fieldErrors: opt_data.fieldErrors, name: opt_data.name, spaceKey: opt_data.spaceKey}, output);
  output.append('<fieldset><div class="field-group"><label for="kb-space-desc">', soy.$$escapeHtml("Description"), '</label><textarea id="kb-space-desc" class="textarea long-field" rows="3" type="text" name="description" placeholder="', soy.$$escapeHtml("What is this knowledge base for?"), '"></textarea></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.SpaceBlueprints.KnowledgeBase.livesearchMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:structured-macro ac:name="livesearch"><ac:parameter ac:name="additional">page excerpt</ac:parameter><ac:parameter ac:name="placeholder">', soy.$$escapeHtml("Search for a solution"), '</ac:parameter>', (opt_data.spaceKey) ? '<ac:parameter ac:name="spaceKey"><ri:space ri:space-key="' + soy.$$escapeHtml(opt_data.spaceKey) + '"/></ac:parameter>' : '', '<ac:parameter ac:name="type">page</ac:parameter><ac:parameter ac:name="size">large</ac:parameter></ac:structured-macro>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:common', location = '/js/namespace.js' */
window.Confluence||(window.Confluence={});window.Confluence.UI||(window.Confluence.UI={});window.Confluence.UI.Components||(window.Confluence.UI.Components={});window.Confluence.UI.Components.SpacePicker||(window.Confluence.UI.Components.SpacePicker={});window.Confluence.UI.Components.LabelPicker||(window.Confluence.UI.Components.LabelPicker={});window.Confluence.UI.Components.Pagination||(window.Confluence.UI.Components.Pagination={});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:label-picker', location = '/js/label-picker.js' */
(function(c,a){var e=/[:;,\.\?&\[\(\)#\^\*@!<>\]]/g;var b=function(h){var i=_.uniq(h.match(e));return i.join(" ")};var g=function(h){var i=_.map(h.contentNameMatches[0],function(j){return{id:j.name,text:j.name}});return _.sortBy(i,function(j){return j.text.toLowerCase()})};var d=function(h){return function(i){return c.extend({query:i},h)}};var f={placeholder:"Add labels",multiple:true,minimumInputLength:1,maximumSelectionSize:20,tokenSeparators:[" ",","],formatInputTooShort:function(i,h){return "Start typing to search for a label"},formatSelectionTooBig:function(h){return AJS.format("You can only input {0} labels",h)},formatResult:function(h){return Confluence.UI.Components.LabelPicker.templates.labelResult({label:{labelName:h.text,isNew:h.isNew}})},formatNoMatches:function(i){var h=b(i);if(h){return Confluence.UI.Components.LabelPicker.templates.labelInvalid({inputValue:i,invalidCharacters:h})}else{return "Add labels"}},createSearchChoice:function(i){if(!i){return null}var h=b(i);if(h){return null}return{id:i,text:i,isNew:true}},ajax:{data:d(),dataType:"json",url:Confluence.getContextPath()+"/labels/autocompletelabel.action",results:function(h){return{results:g(h)}},quietMillis:300},dropdownCssClass:"labels-dropdown",containerCssClass:"labels-autocomplete"};a.build=function(i){var h=c.extend({},f,i);if(i&&i.queryOpts){h.ajax.data=d(i.queryOpts);delete h.queryOpts}return h}}(AJS.$,window.Confluence.UI.Components.LabelPicker));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:label-picker', location = '/soy/label-picker.soy' */
// This file was automatically generated from label-picker.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.LabelPicker == 'undefined') { Confluence.UI.Components.LabelPicker = {}; }
if (typeof Confluence.UI.Components.LabelPicker.templates == 'undefined') { Confluence.UI.Components.LabelPicker.templates = {}; }


Confluence.UI.Components.LabelPicker.templates.labelResult = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.label.isNew) ? soy.$$escapeHtml(AJS.format("\x22{0}\x22 - add a new label",opt_data.label.labelName)) : soy.$$escapeHtml(opt_data.label.labelName));
  return opt_sb ? '' : output.toString();
};


Confluence.UI.Components.LabelPicker.templates.labelInvalid = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var inputValueHtml__soy9 = new soy.StringBuilder('<b>', soy.$$escapeHtml(opt_data.inputValue), '</b>');
  inputValueHtml__soy9 = inputValueHtml__soy9.toString();
  var invalidCharactersHtml__soy13 = new soy.StringBuilder('<b>', soy.$$escapeHtml(opt_data.invalidCharacters), '</b>');
  invalidCharactersHtml__soy13 = invalidCharactersHtml__soy13.toString();
  output.append(AJS.format("{0} contains invalid characters {1}",inputValueHtml__soy9,invalidCharactersHtml__soy13));
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-knowledge-base:kb-article-resources', location = 'soy/kb-articles.soy' */
// This file was automatically generated from kb-articles.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Plugin == 'undefined') { Confluence.Blueprints.Plugin = {}; }
if (typeof Confluence.Blueprints.Plugin.KnowledgeBaseArticle == 'undefined') { Confluence.Blueprints.Plugin.KnowledgeBaseArticle = {}; }


Confluence.Blueprints.Plugin.KnowledgeBaseArticle.wizardPage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="kb-article-wizard-page-form" class="aui"><fieldset><div class="field-group"><label for="kb-article-title">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required">', soy.$$escapeHtml("$WIZARD_FORM_FIELD_REQUIRED_I18N"), '</span></label><input id="kb-article-title" class="text  long-field" type="text" name="title" title="title" placeholder="', soy.$$escapeHtml("Title of your article."), '" maxlength="255"><div class="error"></div></div><div class="field-group"><label>', soy.$$escapeHtml("Labels"), '</label><input id="kb-article-labels" class="text select2-input long-field" type="text" name="labelsString" title="labelsString" placeholder="', soy.$$escapeHtml("Topics this article covers (e.g. \x22printer\x22)."), '"><div class="error"></div></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Plugin.KnowledgeBaseArticle.contentbylabelMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:structured-macro ac:name="contentbylabel"><ac:parameter ac:name="showLabels">false</ac:parameter><ac:parameter ac:name="max">5</ac:parameter><ac:parameter ac:name="sort">modified</ac:parameter><ac:parameter ac:name="reverse">true</ac:parameter><ac:parameter ac:name="labels">', soy.$$escapeHtml(opt_data.labels), '</ac:parameter><ac:parameter ac:name="showSpace">false</ac:parameter><ac:parameter ac:name="spaces"><ri:space ri:space-key="', soy.$$escapeHtml(opt_data.spaceKey), '" /></ac:parameter><ac:parameter ac:name="type">page</ac:parameter></ac:structured-macro>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-knowledge-base:kb-article-resources', location = 'js/kb-articles-dialog-wizard.js' */
AJS.toInit(function(c){function a(i,g){var h=g.$container;var f=c("#kb-article-labels",h);f.auiSelect2(Confluence.UI.Components.LabelPicker.build({separator:" ",queryOpts:{spaceKey:g.wizardData.spaceKey}}))}function d(j,h){var i=j,e=i.find("#kb-article-title"),g=c.trim(e.val()),f;i.find(".error").html("");if(!g){f="Title is required."}else{if(!Confluence.Blueprint.canCreatePage(h,g)){f="A page with this name already exists."}}if(f){e.focus().siblings(".error").html(f);return false}return true}function b(g,f){return d(f.$container,f.wizardData.spaceKey)}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-knowledge-base:kb-how-to-item",function(e){e.on("post-render.kb-how-to-wizard",a);e.on("submit.kb-how-to-wizard",b)});Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-knowledge-base:kb-troubleshooting-item",function(e){e.on("post-render.kb-troubleshooting-wizard",a);e.on("submit.kb-troubleshooting-wizard",b)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:common-template-resources', location = 'com/atlassian/confluence/plugins/blueprint/common/soy/common-templates.soy' */
// This file was automatically generated from common-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Common == 'undefined') { Confluence.Blueprints.Common = {}; }
if (typeof Confluence.Blueprints.Common.Index == 'undefined') { Confluence.Blueprints.Common.Index = {}; }


Confluence.Blueprints.Common.Index.detailsSummaryMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="detailssummary"><ac:parameter ac:name="label">', soy.$$escapeHtml(opt_data.label), '</ac:parameter><ac:parameter ac:name="spaces">', soy.$$escapeHtml(opt_data.spaces), '</ac:parameter><ac:parameter ac:name="firstcolumn">', soy.$$escapeHtml(opt_data.firstcolumn), '</ac:parameter><ac:parameter ac:name="headings">', soy.$$escapeHtml(opt_data.headings), '</ac:parameter><ac:parameter ac:name="blankTitle">', soy.$$escapeHtml(opt_data.blankTitle), '</ac:parameter><ac:parameter ac:name="blankDescription">', soy.$$escapeHtml(opt_data.blankDescription), '</ac:parameter><ac:parameter ac:name="contentBlueprintId">', soy.$$escapeHtml(opt_data.contentBlueprintId), '</ac:parameter><ac:parameter ac:name="blueprintModuleCompleteKey">', soy.$$escapeHtml(opt_data.blueprintModuleCompleteKey), '</ac:parameter><ac:parameter ac:name="createButtonLabel">', soy.$$escapeHtml(opt_data.createButtonLabel), '</ac:parameter></ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Common.Index.createFromTemplateMacro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="create-from-template"><ac:parameter ac:name="blueprintModuleCompleteKey">', soy.$$escapeHtml(opt_data.moduleKey), '</ac:parameter><ac:parameter ac:name="buttonLabel">', soy.$$escapeHtml(opt_data.buttonLabel), '</ac:parameter><ac:parameter ac:name="spaceKey">', soy.$$escapeHtml(opt_data.spaceKey), '</ac:parameter><ac:parameter ac:name="templateName">', soy.$$escapeHtml(opt_data.templateName), '</ac:parameter></ac:macro>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:file-list-resources', location = 'com/atlassian/confluence/plugins/filelist/soy/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.FileList == 'undefined') { Confluence.Templates.FileList = {}; }


Confluence.Templates.FileList.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="file-list-form" class="aui"><fieldset><div class="field-group"><label for="file-list-page-title">', soy.$$escapeHtml("Name"), '<span class="aui-icon icon-required"> required</span></label><input id="file-list-page-title" class="text long-field" type="text" name="title" placeholder="', soy.$$escapeHtml("Title of your file list"), '" maxlength="255"><div class="error"></div></div><div class="field-group"><label for="file-list-page-description">', soy.$$escapeHtml("Description"), '</label><textarea id="file-list-page-description" class="textarea long-field" name="description" rows="6" placeholder="', soy.$$escapeHtml("Description which will appear at the top of file list"), '"></textarea></div><div class="field-group"><label for="file-list-restrictions">', soy.$$escapeHtml("Restrictions"), '</label><input id="file-list-restrictions" class="text long-field autocomplete-multiuser" type="text" name="viewPermissionsUsers" placeholder="', soy.$$escapeHtml("Restrict to users"), '"></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:file-list-resources', location = 'com/atlassian/confluence/plugins/filelist/js/create-file-list-listener.js' */
(function(b){function c(h,g){var d=h.find("#file-list-page-title"),f=b.trim(d.val()),e;if(!f){e="Name is required."}else{if(!Confluence.Blueprint.canCreatePage(g,f)){e="A page with this name already exists."}}if(e){d.focus().siblings(".error").html(e);return false}return true}function a(d,e){return c(e.$container,e.wizardData.spaceKey)}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-business-blueprints:file-list-item",function(d){d.on("submit.file-list-page1",a)})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/how-to.soy' */
// This file was automatically generated from how-to.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Meeting == 'undefined') { Confluence.Blueprints.Meeting = {}; }
if (typeof Confluence.Blueprints.Meeting.Notes == 'undefined') { Confluence.Blueprints.Meeting.Notes = {}; }


Confluence.Blueprints.Meeting.Notes.howTo = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h1>', soy.$$escapeHtml("With meeting notes you can..."), '</h1><ol class="howto-steps"><li class="howto-step"><div><h3>', soy.$$escapeHtml("Crowd-source your agenda"), '</h3><p>', soy.$$escapeHtml("Distribute an agenda and keep meetings focused."), '</p></div></li><li class="howto-step"><div><h3>', soy.$$escapeHtml("Capture meeting minutes"), '</h3><p>', soy.$$escapeHtml("Take notes and make them available to everyone."), '</p></div></li><li class="howto-step"><div><h3>', soy.$$escapeHtml("Create and assign tasks"), '</h3><p>', soy.$$escapeHtml("Assign action items for attendees to work on afterward."), '</p></div></li></ol>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/user-mention.soy' */
// This file was automatically generated from user-mention.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Meeting == 'undefined') { Confluence.Templates.Meeting = {}; }
if (typeof Confluence.Templates.Meeting.Notes == 'undefined') { Confluence.Templates.Meeting.Notes = {}; }


Confluence.Templates.Meeting.Notes.userMention = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.username) ? '<li><p><ac:link><ri:user ri:username="' + soy.$$escapeHtml(opt_data.username) + '" /></ac:link></p></li><li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml("@mention a person to add them as an attendee and they will be notified.") + '</ac:placeholder></p></li>' : '<li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml("@mention a person to add them as an attendee and they will be notified.") + '</ac:placeholder></p></li>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:decisions-resources', location = 'com/atlassian/confluence/plugins/decisions/soy/decisions-templates.soy' */
// This file was automatically generated from decisions-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Decisions == 'undefined') { Confluence.Blueprints.Decisions = {}; }


Confluence.Blueprints.Decisions.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="decisions-form" class="aui"><fieldset><div class="field-group"><label for="decisions-status">', soy.$$escapeHtml("Status"), '</label><select class="select long-field" id="decisions-status" name="status"><option value="GREY">', soy.$$escapeHtml("Not started"), '</option><option value="YELLOW">', soy.$$escapeHtml("In progress"), '</option><option value="GREEN">', soy.$$escapeHtml("Decided"), '</option></select></div><div class="field-group"><label for="decisions-page-title">', soy.$$escapeHtml("Decision"), '<span class="aui-icon icon-required"> required</span></label><input id="decisions-page-title" class="text long-field" type="text" name="title" placeholder="', soy.$$escapeHtml("What are you deciding?"), '" maxlength="255"><div class="error"></div></div><div class="field-group"><label for="decisions-owner">', soy.$$escapeHtml("Owner"), '</label><input id="decisions-owner" type="text" class="text long-field autocomplete-multiuser" name="owner" placeholder="', soy.$$escapeHtml("Who should make the final decision?"), '" data-autofill-user="true"></div><div class="field-group"><label for="decisions-stakeholders">', soy.$$escapeHtml("Stakeholders"), '</label><input id="decisions-stakeholders" class="text long-field autocomplete-multiuser" type="text" name="stakeholders" placeholder="', soy.$$escapeHtml("Who needs to help make this decision?"), '"></div><div class="field-group"><label for="decisions-due-date">', soy.$$escapeHtml("Due date"), '</label><input id="decisions-due-date" class="datepicker-field date-field text" type="text" name="due-date" size="10" autocomplete="off"></div><div class="field-group"><label for="decisions-background">', soy.$$escapeHtml("Background"), '</label><textarea id="decisions-background" class="textarea long-field" rows="3" name="background" placeholder="', soy.$$escapeHtml("What details are important in making this decision?"), '"></textarea></div><div class="field-group"><label for="decisions-final-decision">', soy.$$escapeHtml("Outcome"), '</label><textarea id="decisions-final-decision" class="textarea long-field" rows="3" name="final-decision" placeholder="', soy.$$escapeHtml("What did you decide?"), '"></textarea></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Decisions.mentionXml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var nameList35 = opt_data.names;
  var nameListLen35 = nameList35.length;
  for (var nameIndex35 = 0; nameIndex35 < nameListLen35; nameIndex35++) {
    var nameData35 = nameList35[nameIndex35];
    output.append('<ac:link><ri:user ri:username="', soy.$$escapeHtml(nameData35), '" /></ac:link>&nbsp;');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Decisions.mentionsPlaceholder = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:placeholder ac:type="mention">', soy.$$escapeHtml(opt_data.placeholderText), '</ac:placeholder>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Decisions.placeholder = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:placeholder>', soy.$$escapeHtml(opt_data.placeholderText), '</ac:placeholder>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Decisions.statusTemplate = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="status"><ac:parameter ac:name="title">', soy.$$escapeHtml(opt_data.status), '</ac:parameter><ac:parameter ac:name="colour">', soy.$$escapeHtml(opt_data.statusColour), '</ac:parameter></ac:macro>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:decisions-resources', location = 'com/atlassian/confluence/plugins/decisions/js/create-decisions-listener.js' */
(function(c){function d(i,h){var e=i.find("#decisions-page-title"),g=c.trim(e.val()),f;if(!g){f="Decision is required."}else{if(!Confluence.Blueprint.canCreatePage(h,g)){f="A page with this name already exists."}}if(f){e.focus().siblings(".error").html(f);return false}return true}function a(e,f){return d(f.$container,f.wizardData.spaceKey)}function b(e,f){c("#decisions-due-date").datepicker({dateFormat:"yy/mm/dd"});c("#decisions-status").on("change",function(){var h=c("#decisions-final-decision");var g=c("label[for=decisions-final-decision]");if(c(this).find(":selected").val()=="GREEN"){h.css({display:"inline"});g.css({display:"inline"})}else{h.css({display:"none"});g.css({display:"none"})}})}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-business-blueprints:decisions-blueprint-item",function(e){e.on("post-render.decisions-page1",b);e.on("submit.decisions-page1",a)})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-resources', location = 'com/atlassian/confluence/plugins/sharelinks/soy/sharelinks-templates.soy' */
// This file was automatically generated from sharelinks-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Sharelinks == 'undefined') { Confluence.Blueprints.Sharelinks = {}; }


Confluence.Blueprints.Sharelinks.dialogForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" id="sharelinks-form" class="aui"><fieldset><div class="field-group"><label for="sharelinks-url">', soy.$$escapeHtml("Link"), '<span class="aui-icon icon-required"> required</span></label><input id="sharelinks-url" class="text long-field" type="text" name="url" placeholder="', soy.$$escapeHtml("Paste a link to any website"), '"/><div class="error"></div></div><div class="field-group"><label for="sharelinks-title">', soy.$$escapeHtml("Title"), '<span class="aui-icon icon-required"> required</span></label><input id="sharelinks-title" class="text long-field" type="text" name="title" title="title" placeholder="', soy.$$escapeHtml("Title of the page"), '" maxlength="255"><div class="error"></div></div><div class="field-group"><label for="sharelinks-label">', soy.$$escapeHtml("Topics"), '</label><input id="sharelinks-label" class="text select2-input long-field" type="text" name="label" placeholder="', soy.$$escapeHtml("Topics for the shared link"), '" /></div><div class="field-group"><label for="sharelinks-sharewith">', soy.$$escapeHtml("Share with"), '</label><input id="sharelinks-sharewith" class="text long-field autocomplete-multiuser" type="text" name="sharewith" placeholder="', soy.$$escapeHtml("Share this page with users"), '"/></div><div class="field-group"><label for="sharelinks-comment">', soy.$$escapeHtml("Comment"), '</label><textarea id="sharelinks-comment" class="textarea long-field" rows="4" type="text" name="comment" placeholder="', soy.$$escapeHtml("Share your thoughts about this link"), '"></textarea></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.previewLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="sharelinks-preview">');
  if (opt_data.linkMetaData.title) {
    output.append('<h3 class="sharelinks-preview-title">', soy.$$escapeHtml(opt_data.linkMetaData.title), '</h3>');
    if (opt_data.linkMetaData.imageURL) {
      output.append('<div class="sharelinks-preview-image"><img src="', soy.$$escapeHtml(opt_data.linkMetaData.imageURL), '"/></div>');
    } else {
      var noImagePreviewContent__soy37 = new soy.StringBuilder();
      Confluence.Blueprints.Sharelinks.noImagePreview(null, noImagePreviewContent__soy37);
      noImagePreviewContent__soy37 = noImagePreviewContent__soy37.toString();
      output.append(noImagePreviewContent__soy37);
    }
    output.append((opt_data.linkMetaData.description) ? '<p>' + soy.$$escapeHtml(opt_data.linkMetaData.description) + '</p>' : '');
  } else {
    var previewUnavailableContent__soy47 = new soy.StringBuilder();
    Confluence.Blueprints.Sharelinks.previewUnavailable(null, previewUnavailableContent__soy47);
    previewUnavailableContent__soy47 = previewUnavailableContent__soy47.toString();
    output.append(previewUnavailableContent__soy47);
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.previewVideoLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="sharelinks-preview"><h3 class="sharelinks-preview-title">', soy.$$escapeHtml(opt_data.linkMetaData.title), '</h3><div class="sharelinks-preview-video">');
  if (opt_data.linkMetaData.imageURL) {
    output.append('<span class="sharelinks-preview-image"><img src="', soy.$$escapeHtml(opt_data.linkMetaData.imageURL), '"/><span class="sharelinks-preview-camera-icon sharelinks-camera-with-image"></span></span>');
  } else {
    output.append('<div>');
    var noImagePreviewContent__soy63 = new soy.StringBuilder();
    Confluence.Blueprints.Sharelinks.noImagePreview(null, noImagePreviewContent__soy63);
    noImagePreviewContent__soy63 = noImagePreviewContent__soy63.toString();
    output.append(noImagePreviewContent__soy63, '<span class="sharelinks-preview-camera-icon sharelinks-camera-with-no-image"></span></div>');
  }
  output.append('</div>', (opt_data.linkMetaData.description) ? '<p>' + soy.$$escapeHtml(opt_data.linkMetaData.description) + '</p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.previewLoading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="sharelinks-preview-loading"><span class="aui-icon aui-icon-wait"></span>&nbsp;', soy.$$escapeHtml("Loading preview\u2026"), '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.metaDataHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="sharelinks-link-meta-data"><ac:macro ac:name="panel"><ac:rich-text-body>', (opt_data.linkMetaData.imageURL) ? '<h3><ac:image ac:align="right"><ri:url ri:value=\'' + soy.$$escapeHtml(opt_data.linkMetaData.imageURL) + '\' /></ac:image></h3>' : '', '<p><ac:image ac:width=\'16\'><ri:url ri:value="', soy.$$escapeHtml(opt_data.faviconURL), '" /></ac:image>&nbsp;<a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml(opt_data.linkMetaData.excerptedURL), '</a></p>', (opt_data.linkMetaData.description) ? '<blockquote><p>' + soy.$$escapeHtml(opt_data.descriptionMessage) + '</p></blockquote>' : '<p style="text-align: left;"><span style="color: rgb(128,128,128);"><em>' + soy.$$escapeHtml(opt_data.descriptionMessage) + '</em></span></p>', '<p><strong><a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml("Open link"), '</a></strong></p></ac:rich-text-body></ac:macro></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.previewError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="sharelinks-preview">');
  var previewUnavailableContent__soy109 = new soy.StringBuilder();
  Confluence.Blueprints.Sharelinks.previewUnavailable(null, previewUnavailableContent__soy109);
  previewUnavailableContent__soy109 = previewUnavailableContent__soy109.toString();
  output.append(previewUnavailableContent__soy109, '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.videoMetaDataHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ac:macro ac:name="panel"><ac:rich-text-body><ac:macro ac:name="section"><ac:rich-text-body><ac:macro ac:name="column"><ac:parameter ac:name="width">50%</ac:parameter><ac:rich-text-body><p><ac:image ac:width=\'16\'><ri:url ri:value="', soy.$$escapeHtml(opt_data.faviconURL), '" /></ac:image>&nbsp;<a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml(opt_data.linkMetaData.excerptedURL), '</a></p>', (opt_data.linkMetaData.description) ? '<blockquote><p>' + soy.$$escapeHtml(opt_data.linkMetaData.description) + '</p></blockquote>' : '', '<p><strong><a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml("Open link"), '</a></strong></p></ac:rich-text-body></ac:macro><ac:macro ac:name="column"><ac:parameter ac:name="width">50%</ac:parameter><ac:rich-text-body><p>', (opt_data.isSupportedMediaDomain) ? '<ac:macro ac:name="widget"><ac:parameter ac:name="url">' + soy.$$escapeHtml(opt_data.linkMetaData.sourceURL) + '</ac:parameter><ac:parameter ac:name="width">350</ac:parameter><ac:parameter ac:name="height">240</ac:parameter></ac:macro>' : '<ac:image ac:width="300"><ri:url ri:value="' + soy.$$escapeHtml(opt_data.linkMetaData.imageURL) + '" /></ac:image>', '</p></ac:rich-text-body></ac:macro></ac:rich-text-body></ac:macro></ac:rich-text-body></ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.twitterMetaDataHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.linkMetaData.description) {
    output.append('<div class="sharelinks-twitter-content"><p><ac:image ac:width=\'16\'><ri:url ri:value="', soy.$$escapeHtml(opt_data.faviconURL), '" /></ac:image>&nbsp;<a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml(opt_data.linkMetaData.excerptedURL), '</a></p><p><ac:macro ac:name="widget"><ac:parameter ac:name="url">', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '</ac:parameter></ac:macro></p><p><strong><a href="', soy.$$escapeHtml(opt_data.linkMetaData.sourceURL), '">', soy.$$escapeHtml("Open link"), '</a></strong></p></div>');
  } else {
    Confluence.Blueprints.Sharelinks.metaDataHtml(opt_data, output);
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.bookmarkletGuideOnWizard = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var bookmarkletLinkParam__soy163 = new soy.StringBuilder();
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink(opt_data, bookmarkletLinkParam__soy163);
  bookmarkletLinkParam__soy163 = bookmarkletLinkParam__soy163.toString();
  output.append('<p>', bookmarkletLinkParam__soy163, '</p><p>', soy.$$escapeHtml("It will appear like this in your browser."), '</p><div class="bookmarklet-guide-picture"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.bookmarkletGuide = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var bookmarkletMacroParam__soy173 = new soy.StringBuilder('<ac:macro ac:name="sharelinks-urlmacro"/>');
  bookmarkletMacroParam__soy173 = bookmarkletMacroParam__soy173.toString();
  output.append('<ac:macro ac:name="info"><ac:parameter ac:name="icon">false</ac:parameter><ac:rich-text-body><p><ac:emoticon ac:name="information" />&nbsp;', AJS.format("Tip: share a link from anywhere by dragging this button \u2192 {0} to your browser bookmarks toolbar. Once added to your toolbar, click it to share links with your team.",bookmarkletMacroParam__soy173), '</p></ac:rich-text-body></ac:macro>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.noImagePreview = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class="image-unavailable"><span class="no-image-picture"></span>', soy.$$escapeHtml("No image available"), '</p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Blueprints.Sharelinks.previewUnavailable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class="link-unavailable"><span class="preview-unavailable-picture"></span>', soy.$$escapeHtml("Link preview unavailable"), '</p>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-resources', location = 'com/atlassian/confluence/plugins/sharelinks/js/sharelinks-creation-wizard.js' */
(function(i){var d=false;function g(s,r){var q=false;if(k(s,!q)){q=true}if(f(s,r,!q)){q=true}return !q}function k(u,q){var t=u.find("#sharelinks-url");var s=i.trim(t.val());var r="";if(!s){r="URL is required"}else{if(d){r="URL syntax is invalid"}}return j(t,r,q)}function f(w,u,s){var r=w.find("#sharelinks-title");var v=i.trim(r.val());var t="";if(!v){t="Title is required"}else{if(!Confluence.Blueprint.canCreatePage(u,v)){t="A page with this name already exists";var q=Confluence.Blueprints.Sharelinks.Analytics.errorTypes.value.duplicatedPage;Confluence.Blueprints.Sharelinks.Analytics.triggerErrorTypes(q)}}return j(r,t,s)}function j(s,r,q){s.siblings(".error").html(r);if(r&&q){s.focus()}return r}var p;function a(u,v){var s=g(v.$container,v.wizardData.spaceKey);if(s){var r=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.noComment;var x=i("#sharelinks-comment").val();x=i.trim(x);if(x){r=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.comment}Confluence.Blueprints.Sharelinks.Analytics.triggerSubmitData(r);var q=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.noEditTitle;if(p!==i("#sharelinks-title").val()){q=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.editTitle}Confluence.Blueprints.Sharelinks.Analytics.triggerSubmitData(q);var w=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.noShare;var t=i("#sharelinks-sharewith").val();t=i.trim(t);if(t){w=Confluence.Blueprints.Sharelinks.Analytics.submitData.value.share}Confluence.Blueprints.Sharelinks.Analytics.triggerSubmitData(w)}v.wizardData.parentPageId=-1;return s}var e;function h(s,t){e="";i("#sharelinks-url").bind("paste",function(){setTimeout(function(){l(t.$container,t.wizardData.spaceKey,true)},0)});i("#sharelinks-url").change(function(){l(t.$container,t.wizardData.spaceKey,false)});i("#sharelinks-title").change(function(){if(i("#sharelinks-title").siblings(".error").html!=""){f(t.$container,t.wizardData.spaceKey,false)}});var u=i(".dialog-wizard-page-description,.create-dialog-page-description");var q=AJS.Meta.get("base-url")+"/plugins/sharelinksbookmarklet/bookmarklet.action";var r=Confluence.Blueprints.Sharelinks.bookmarkletGuideOnWizard({bookmarkletActionURL:q});i(r).appendTo(u);Confluence.Blueprints.Sharelinks.autocompleteMultiLabel.build(i("#sharelinks-label"));i(".create-dialog-sharelinks-page1 .sharelinks-urlmacro-button").click(function(){alert("Drag this link to your toolbar");return false})}function c(q,r){i.ajax({type:"get",dataType:"json",url:Confluence.getContextPath()+"/rest/sharelinks/1.0/can-create-comment",data:{spaceKey:r.wizardData.spaceKey},success:function(t){if(!t){var s=i("#sharelinks-comment");s.attr("disabled","disabled");s.attr("placeholder","Sorry, you don\'t have permission to add comments in this space")}}})}Confluence.Blueprint.setWizard("com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-blueprint-item",function(q){q.on("post-render.sharelinks-page1",h);q.on("post-render.sharelinks-page1",c);q.on("submit.sharelinks-page1",a)});function b(u){var y=255;var q=180;var t=o(u.title,y);var s=i("#sharelinks-title");s.val(t);s.removeClass("placeholded");var x=i.extend({},u);x.title=o(x.title,q);var w=Confluence.Blueprints.Sharelinks.Analytics.linkTypes.value.noContent;var r;if(u.videoURL){r=Confluence.Blueprints.Sharelinks.previewVideoLink({linkMetaData:x});w=Confluence.Blueprints.Sharelinks.Analytics.linkTypes.value.video}else{r=Confluence.Blueprints.Sharelinks.previewLink({linkMetaData:x});if(u.imageURL){w=Confluence.Blueprints.Sharelinks.Analytics.linkTypes.value.image}else{if(u.title){w=Confluence.Blueprints.Sharelinks.Analytics.linkTypes.value.noVideoImage}}}var v=i(".create-dialog-page-description,.dialog-wizard-page-description");v.empty();i(r).appendTo(v);Confluence.Blueprints.Sharelinks.Analytics.triggerLinkTypes(w)}function o(r,q){if(null!=r&&q<r.length){r=r.substring(0,q-1)+"\u2026"}return r}function m(r,q){r.attr("disabled","disabled");q.attr("disabled","disabled")}function n(r,q){r.removeAttr("disabled");q.removeAttr("disabled")}function l(z,w,s){var r=i("#sharelinks-url"),v=r.val(),q=i("#sharelinks-title");v=i.trim(v);if(v){var x=Confluence.getContextPath()+"/rest/sharelinks/1.0/link";if(v!==e){e=v;var t=i(".create-dialog-page-description,.dialog-wizard-page-description").empty();var y=Confluence.Blueprints.Sharelinks.previewLoading();var A=i(y).appendTo(t);m(r,q);i.ajax({type:"get",url:x,data:{url:v},success:function(B,C){A.remove();b(B);d=false;g(z,w);n(r,q)},error:function(E,B,D){n(r,q);if(400==E.status){A.remove();d=true;k(z,false)}else{A.remove();var C=Confluence.Blueprints.Sharelinks.previewError();i(C).appendTo(t);d=false;g(z,w)}}});var u;if(s){u=Confluence.Blueprints.Sharelinks.Analytics.inputTypes.value.pasteUrl}else{u=Confluence.Blueprints.Sharelinks.Analytics.inputTypes.value.typeUrl}Confluence.Blueprints.Sharelinks.Analytics.triggerInputTypes(u)}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-resources', location = 'com/atlassian/confluence/plugins/sharelinks/js/sharelinks-analytics.js' */
Confluence.Blueprints.Sharelinks.Analytics={inputTypes:{name:"blueprints.sharelinks.input",value:{pasteUrl:{type:"paste-url"},typeUrl:{type:"type-url"}}},linkTypes:{name:"blueprints.sharelinks.link",value:{video:{link:"video"},image:{link:"image"},noVideoImage:{link:"no-video-image"},noContent:{link:"no-content"}}},errorTypes:{name:"blueprints.sharelinks.error",value:{duplicatedPage:{error:"page-duplicated"}}},submitData:{name:"blueprints.sharelinks.submit",value:{editTitle:{submit:"edit-title"},noEditTitle:{submit:"no-edit-title"},comment:{submit:"comment"},noComment:{submit:"no-comment"},share:{submit:"share"},noShare:{submit:"no-share"}}},triggerInputTypes:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:Confluence.Blueprints.Sharelinks.Analytics.inputTypes.name,properties:a})},triggerLinkTypes:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:Confluence.Blueprints.Sharelinks.Analytics.linkTypes.name,properties:a})},triggerErrorTypes:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:Confluence.Blueprints.Sharelinks.Analytics.errorTypes.name,properties:a})},triggerSubmitData:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:Confluence.Blueprints.Sharelinks.Analytics.submitData.name,properties:a})}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-resources', location = 'com/atlassian/confluence/plugins/sharelinks/soy/sharelinks-label.soy' */
// This file was automatically generated from sharelinks-label.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Sharelinks == 'undefined') { Confluence.Blueprints.Sharelinks = {}; }


Confluence.Blueprints.Sharelinks.labelResult = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.label.isNew) ? soy.$$escapeHtml(AJS.format("\x22{0}\x22 - add a new topic",opt_data.label.labelName)) : soy.$$escapeHtml(opt_data.label.labelName));
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-resources', location = 'com/atlassian/confluence/plugins/sharelinks/js/sharelinks-label.js' */
Confluence.Blueprints.Sharelinks.autocompleteMultiLabel=(function(a){function b(c){c.auiSelect2(Confluence.UI.Components.LabelPicker.build({formatInputTooShort:function(){return "Start typing to search for a topic"},formatResult:function(d){return Confluence.Blueprints.Sharelinks.labelResult({label:{labelName:d.text,isNew:d.isNew}})}}))}return{build:b}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.balsamiq.confluence.plugins.mockups:blueprint-web-resource', location = 'includes/editor/blueprintcallback.js' */
try{if(AJS&&AJS.Confluence&&AJS.Confluence.Blueprint){AJS.Confluence.Blueprint.setDirectCallback("com.balsamiq.confluence.plugins.mockups:blueprint-item",function(B,A){A.finalUrl=Confluence.getContextPath()+"/pages/createpage.action?spaceKey="+encodeURIComponent(A.spaceKey)+"&openBalsamiq=true"
})
}}catch(err){if(console&&console.log){console.log("Error loading blueprintcallback.js");
console.log(err)
}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks=(function(a){a.ApplicationHeader=function(b){b.Cog=(function(){var c=function(){var d=AJS.$("#system-admin-menu-content");if(d.length>0){return d}var e=AJS.$("#admin-menu-link-content");if(e.length>0){return e}return AJS.$("#bamboo\\.global\\.header-admin\\.menu")};return{getDropdown:c}}());return b}(a.ApplicationHeader||{});return a}(NavLinks||{}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.projectshortcuts == 'undefined') { navlinks.templates.projectshortcuts = {}; }


navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.localShortcuts && opt_data.localShortcuts.length > 0) {
    navlinks.templates.projectshortcuts.dialogContentShortcuts({shortcuts: opt_data.localShortcuts, listClass: 'projectshortcut-links'}, output);
  }
  if (opt_data.remoteShortcuts != null) {
    if (opt_data.remoteShortcuts.length > 0) {
      output.append('<h2 class="projectshortcuts-heading">Related Links</h2>');
      navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentData(opt_data.remoteShortcuts, {shortcuts: opt_data.remoteShortcuts, listClass: 'projectshortcut-links'}), output);
    }
  } else {
    navlinks.templates.projectshortcuts.dialogLoading(null, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="', soy.$$escapeHtml(opt_data.logoUrl), '"><h2 class="dialog-title">', soy.$$escapeHtml(opt_data.title), '</h2></div><div class="project-content-wrapper">', opt_data.contentHtml, '</div></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul', (opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '', '>');
  var shortcutList35 = opt_data.shortcuts;
  var shortcutListLen35 = shortcutList35.length;
  for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
    var shortcutData35 = shortcutList35[shortcutIndex35];
    output.append('<li', (shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '', '>');
    navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35, output);
    output.append('</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml(opt_data.link), '"', (opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '', '>', soy.$$escapeHtml(opt_data.label), '</a>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="projectshortcuts-loading">', (opt_data != null && opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '', '</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e,h){var j,l={},o="key",b="name",k="entity-type";function n(r,p,q){try{h.trackEvent("projectshortcuts",r,p,q)}catch(s){AJS.log("failed to track analytics event, category: projectshortcuts, action: "+r+", label: "+p+", value: "+q)}}function f(u){var p=e(this),q=p.data(o),s=p.data(b),r=p.data(k);if(typeof q==="undefined"){return}u.preventDefault();j=new AJS.Dialog({width:600,keypressListener:function(w){if(w.which==jQuery.ui.keyCode.ESCAPE){j.remove()}},id:"project-shortcuts-dialog"}).addCancel("Close",function(){j.remove();n("hide",h.getCurrentApplication())}).addPanel("",navlinks.templates.projectshortcuts.headingWrapper({title:s,logoUrl:i(),contentHtml:navlinks.templates.projectshortcuts.dialogLoading({text:"Retrieving links"})})).show();c(j);if(!l[q]){l[q]={entity:{title:s},localShortcuts:null,remoteShortcuts:null};d(AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+q,{entityType:r}).done(v);d(AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+q,{entityType:r}).done(t).fail(function(){var w=j.getCurrentPanel().body.find(".project-content-wrapper");w.find(".projectshortcuts-loading").remove();AJS.messages.error(w,{body:"Could not retrieve remote project shortcuts",closeable:false});c(j)})}else{m(l[q])}function v(w){l[q].localShortcuts=w.shortcuts;m(l[q])}function t(w){l[q].remoteShortcuts=w.shortcuts;m(l[q])}n("show",h.getCurrentApplication())}function i(){return e(".project-shortcut-dialog-trigger img").attr("src")}function g(p){p.getCurrentPanel().body.find("a").unbind(".analytics").bind("click.analytics",function(){var q=this.attributes.href;n("navLinkFollowed",typeof q==="object"?q.value:q)})}function m(p){if(p.localShortcuts){j.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({title:p.entity.title,logoUrl:i(),contentHtml:navlinks.templates.projectshortcuts.dialogContent(p)}));g(j);c(j)}}function a(r){var q=210;if(!r||r.length<=q){return r}var p=q;while(p>0&&r.charAt(p)!=" "){p--}if(p==0){p=q}r=r.substring(0,p);if(r.length>=p){r=r+"..."}return r}function c(p){var s=p.popup.element,r=s.find(".dialog-panel-body"),q=s.find(".dialog-components");r.height("auto");s.height(q.outerHeight()-1);e(".aui-shadow").remove()}function d(p,q){return e.ajax({url:p,cache:false,data:q,dataType:"json"})}e(document).on("click",".project-shortcut-dialog-trigger",f)}(jQuery,window.NL=(window.NL||{})));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups=AJS.Popups||{};AJS.Popups.DisplayController=function(){var c=[];var a=false;var b=false;AJS.toInit(function(){setTimeout(function(){AJS.Popups.DisplayController.render()},0)});return{request:function(d){c.push(d);if(a&&b===false){this.render()}},render:function(){c.sort(function(e,d){return e.weight-d.weight});a=true;if(c.length!==0){b=true;c[0].show()}}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'js/space-menu.js' */
AJS.toInit(function(a){var d=a(Confluence.Templates.BrowseSpaces.spacesLink());a("#space-directory-link").replaceWith(a(d));var b=a("#space-menu-link"),c=function(e){a("#space-menu-link-content").html(e.template);AJS.trigger("spacemenu-loaded");a("#create-space-header").click(function(){AJS.trigger("analyticsEvent",{name:"create-space-from-header"});Confluence.SpaceBlueprint.Dialog.launch();return false})};b.click(function(){if(!a("#space-menu-link-content .aui-dropdown2-section").length){a.ajax({url:Confluence.getContextPath()+"/rest/ia/1.0/spacesmenu",type:"GET",dataType:"json",cache:false,success:c})}return false})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'soy/space-menu.soy' */
// This file was automatically generated from space-menu.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.BrowseSpaces == 'undefined') { Confluence.Templates.BrowseSpaces = {}; }


Confluence.Templates.BrowseSpaces.spacesLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a id="space-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="space-menu-link-content" title="', soy.$$escapeHtml("Spaces"), '"><span class="browse">', soy.$$escapeHtml("Spaces"), '</span><span class="aui-icon-dropdown"></span></a><div id="space-menu-link-content" class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" aria-hidden="false"></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:space-ia-analytics', location = 'js/space-ia-analytics.js' */
(function(d){var c=RegExp("(.+[?&])src=.+?(&.+|$)");var e;if(AJS.Confluence.Analytics&&AJS.Confluence.Analytics.setAnalyticsSource){e=AJS.Confluence.Analytics.setAnalyticsSource}else{e=function(h,i){if(b()){_.each(h,function(j){d(j).attr("href",g(d(j).attr("href"),i))})}}}function g(h,j){if(h&&(h.charAt(0)!="#")){var i=c.exec(h);if(!i){if(h.indexOf("?")>-1){h=h+"&src="+j}else{h=h+"?src="+j}}else{h=i[1]+"src="+j+i[2]}}return h}function b(){var h=d(document.getElementsByTagName("script"));var i=false;h.each(function(k,j){if(d(j).attr("src")&&d(j).attr("src").indexOf("google-analytics.com/ga.js")!=-1){i=true;return false}});return i}function f(){var i=d(".acs-side-bar a:not(.external_link a, #acs-configure-link)");e(i,"sidebar");var h=d(".quick-links-section li:not(.external_link) a");e(h,"spaceshortcut");var j=d(".ia-secondary-container a:not(.more-children-link)");if(d(".ia-secondary-container").data("tree-type")=="pages"){e(j,"contextnavchildmode")}else{if(d(".ia-secondary-container").data("tree-type")=="page-tree"){e(j,"contextnavpagetreemode")}else{e(j,"contextnav")}}}function a(h){return function(){AJS.trigger("analyticsEvent",{name:"space-ia-nav",data:{linkType:h}})}}AJS.bind("sidebar.exit-configure-mode",f);AJS.bind("sidebar.flyout-triggered",function(i,h){a("flyout-triggered."+h.flyout)()});AJS.bind("spacemenu-loaded",function(){e(d("#space-menu-link-content a"),"spacemenu")});AJS.bind("sidebar.spacetools-loaded",function(){e(d("#inline-dialog-space-tools a:not(.configure-sidebar)"),"spacetools")});AJS.bind("pagetree-children-loaded",f);AJS.toInit(function(h){h(".ia-secondary-container .more-children-link").click(a("context-nav.more-children"));f()})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/js/request-access.js' */
AJS.toInit(function(e){var b=AJS.Meta.get("page-id"),c=e("#page-restricted-container"),a=AJS.Meta.get("remote-user"),d=e("#page-restricted-container button");if(c.length){e("#breadcrumbs").hide();e("#title-text.with-breadcrumbs").hide();if(d.length){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.request.access.to.page.view",data:{pageId:b,requestAccessUser:a}})}}d.click(function(){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.request.access.to.page",data:{pageId:b,requestAccessUser:a}});d.attr("aria-disabled","true");var f,g=e("<span class='aui-icon aui-icon-wait'>Loading, please wait</span>");d.replaceWith(g);e.ajax({url:Confluence.getContextPath()+"/rest/request-access/latest/page/restriction/"+b,success:function(h){f=e(Confluence.Request.Access.result({success:true}));c.removeClass("page-restricted");c.addClass("access-requested")},error:function(h,i){f=e(Confluence.Request.Access.result({success:false}))},complete:function(){g.replaceWith(f)}})})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/js/grant-access.js' */
AJS.toInit(function(f){var h=f(".grant-access button"),a=f(".grant-access"),i=f(".grant-access span"),b=f(".grant-access p"),c=AJS.Meta.get("page-id"),g=AJS.Meta.get("remote-user"),d=e("username");if(h.length){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.grant.access.to.page.view",data:{pageId:c,grantAccessUser:g,requestAccessUser:d}})}h.click(function(){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.grant.access.to.page",data:{pageId:c,grantAccessUser:g,requestAccessUser:d}});h.attr("aria-disabled","true");i.removeClass("icon-info").addClass("aui-icon-wait");b.html("Loading, please wait");f.ajax({url:Confluence.getContextPath()+"/rest/request-access/latest/page/restriction/"+c,type:"POST",contentType:"application/json; charset=utf-8",data:d,success:function(j){a.removeClass("info").addClass("success");i.removeClass("aui-icon-wait").addClass("icon-success");b.html(j)},error:function(j,k){a.removeClass("info").addClass("warning");i.removeClass("aui-icon-wait").addClass("icon-warning");b.html(j.responseText)}})});function e(l){var j=window.location.search.substring(1),k,n,m=j.split("&");for(k=0;k<m.length;k++){n=m[k].split("=");if(n[0]==l){return unescape(n[1])}}return null}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/templates/soy/request-access.soy' */
// This file was automatically generated from request-access.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Request == 'undefined') { Confluence.Request = {}; }
if (typeof Confluence.Request.Access == 'undefined') { Confluence.Request.Access = {}; }


Confluence.Request.Access.result = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="request-access">', (opt_data.success) ? '<span class="aui-icon aui-icon-small aui-iconfont-approve" data-unicode="UTF+E005" original-title=""></span>' + soy.$$escapeHtml("Your request has been sent. If approved you will receive an email shortly.") : '<span class="aui-icon aui-icon-small aui-iconfont-error" data-unicode="UTF+E011" original-title=""></span>' + soy.$$escapeHtml("Your request for access has not been sent. Contact your space admin."), '</div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:code-macro-editor', location = '/scripts/code-macro-languages.js' */
(function(d){var b=function(){};b.prototype.fields={string:{language:function(h,f){var g=d(Confluence.Templates.MacroBrowser.macroParameterSelect());var e=d("select",g);if(f==null){f={}}f.setValue=function(k){var j=e.find("option[value='"+k+"']");if(j.length==0){var i=d("<option/>");i.val(k);i.text(k);e.append(i)}};a(e);return new AJS.MacroBrowser.Field(g,e,f)}}};AJS.MacroBrowser.Macros.code=new b();function a(e){c(function(g){if(!g.length){AJS.log("Configured code macro languages result was not in the expected format.");return}var f=e.val();e.empty();e.append(d("<option/>").attr("value",""));d.each(g,function(h,j){var i=d("<option />");i.val(j.aliases[0]);i.text(j.friendlyName);e.append(i)});e.val(f)},function(g,h,f){AJS.log("Failed to retrieve syntax highlighters from Confluence "+h+" - "+f)})}function c(f,e){AJS.$.ajax({async:true,url:AJS.params.contextPath+"/plugins/newcode/getlanguages.action",dataType:"json",timeout:10000,error:function(h,i,g){if(e&&typeof(e)=="function"){e(h,i,g)}},success:function(g){if(f&&typeof(f)=="function"){f(g)}}})}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/rpc.js' */
var gadgets=gadgets||{};gadgets.rpc=function(){var CALLBACK_NAME="__cb";var DEFAULT_NAME="";var FE_G2C_CHANNEL="__g2c_rpc";var FE_C2G_CHANNEL="__c2g_rpc";var services={};var iframePool=[];var relayUrl={};var useLegacyProtocol={};var authToken={};var callId=0;var callbacks={};var setup={};var sameDomain={};var params={};if(gadgets.util){params=gadgets.util.getUrlParameters()}authToken[".."]=params.rpctoken||params.ifpctok||0;function getRelayChannel(){return typeof window.postMessage==="function"?"wpm":typeof document.postMessage==="function"?"dpm":navigator.product==="Gecko"?"fe":"ifpc"}function setupChannel(){if(relayChannel==="dpm"||relayChannel==="wpm"){window.addEventListener("message",function(packet){process(gadgets.json.parse(packet.data))},false)}}var relayChannel=getRelayChannel();setupChannel();services[DEFAULT_NAME]=function(){throw new Error("Unknown RPC service: "+this.s)};services[CALLBACK_NAME]=function(callbackId,result){var callback=callbacks[callbackId];if(callback){delete callbacks[callbackId];callback(result)}};function setupFrame(frameId){if(setup[frameId]){return }if(relayChannel==="fe"){try{var frame=document.getElementById(frameId);frame[FE_G2C_CHANNEL]=function(args){process(gadgets.json.parse(args))}}catch(e){}}setup[frameId]=true}function encodeLegacyData(args){var stringify=gadgets.json.stringify;var argsEscaped=[];for(var i=0,j=args.length;i<j;++i){argsEscaped.push(encodeURIComponent(stringify(args[i])))}return argsEscaped.join("&")}function process(rpc){if(rpc&&typeof rpc.s==="string"&&typeof rpc.f==="string"&&rpc.a instanceof Array){if(authToken[rpc.f]){if(authToken[rpc.f]!=rpc.t){if(AJS.debug){console.log("Invalid auth token received for operation: "+rpc.s)}return }}if(rpc.c){rpc.callback=function(result){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}var result=(services[rpc.s]||services[DEFAULT_NAME]).apply(rpc,rpc.a);if(rpc.c&&typeof result!="undefined"){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}}function callFrameElement(targetId,serviceName,from,rpcData,callArgs){try{if(from!=".."){var fe=window.frameElement;if(typeof fe[FE_G2C_CHANNEL]==="function"){if(typeof fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]!=="function"){fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]=function(args){process(gadgets.json.parse(args))}}fe[FE_G2C_CHANNEL](rpcData);return }}else{var frame=document.getElementById(targetId);if(typeof frame[FE_G2C_CHANNEL]==="function"&&typeof frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL]==="function"){frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL](rpcData);return }}}catch(e){}callIfpc(targetId,serviceName,from,rpcData,callArgs)}function callIfpc(targetId,serviceName,from,rpcData,callArgs){var relay=gadgets.rpc.getRelayUrl(targetId);if(!relay){throw new Error("No relay file assigned for IFPC")}var src=null;if(useLegacyProtocol[targetId]){src=[relay,"#",encodeLegacyData([from,callId,1,0,encodeLegacyData([from,serviceName,"","",from].concat(callArgs))])].join("")}else{src=[relay,"#",targetId,"&",from,"@",callId,"&1&0&",encodeURIComponent(rpcData)].join("")}emitInvisibleIframe(src)}function emitInvisibleIframe(src){var iframe;for(var i=iframePool.length-1;i>=0;--i){var ifr=iframePool[i];try{if(ifr&&(ifr.recyclable||ifr.readyState==="complete")){ifr.parentNode.removeChild(ifr);if(window.ActiveXObject){iframePool[i]=ifr=null;iframePool.splice(i,1)}else{ifr.recyclable=false;iframe=ifr;break}}}catch(e){}}if(!iframe){iframe=document.createElement("iframe");iframe.style.border=iframe.style.width=iframe.style.height="0px";iframe.style.visibility="hidden";iframe.style.position="absolute";iframe.onload=function(){this.recyclable=true};iframePool.push(iframe)}iframe.src=src;setTimeout(function(){document.body.appendChild(iframe)},0)}function callSameDomain(target,rpc){if(typeof sameDomain[target]==="undefined"){sameDomain[target]=false;var targetEl=null;if(target===".."){targetEl=parent}else{targetEl=frames[target]}try{sameDomain[target]=targetEl.gadgets.rpc.receiveSameDomain}catch(e){}}if(typeof sameDomain[target]==="function"){sameDomain[target](rpc);return true}return false}if(gadgets.config){function init(config){if(config.rpc.parentRelayUrl.substring(0,7)==="http://"){relayUrl[".."]=config.rpc.parentRelayUrl}else{var params=document.location.search.substring(0).split("&");var parentParam="";for(var i=0,param;param=params[i];++i){if(param.indexOf("parent=")===0){parentParam=decodeURIComponent(param.substring(7));break}}relayUrl[".."]=parentParam+config.rpc.parentRelayUrl}useLegacyProtocol[".."]=!!config.rpc.useLegacyProtocol}var requiredConfig={parentRelayUrl:gadgets.config.NonEmptyStringValidator};gadgets.config.register("rpc",requiredConfig,init)}return{register:function(serviceName,handler){if(serviceName==CALLBACK_NAME){throw new Error("Cannot overwrite callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot overwrite default service:"+" use registerDefault")}services[serviceName]=handler},unregister:function(serviceName){if(serviceName==CALLBACK_NAME){throw new Error("Cannot delete callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot delete default service:"+" use unregisterDefault")}delete services[serviceName]},registerDefault:function(handler){services[""]=handler},unregisterDefault:function(){delete services[""]},call:function(targetId,serviceName,callback,var_args){++callId;targetId=targetId||"..";if(callback){callbacks[callId]=callback}var from="..";if(targetId===".."){from=window.name}var rpc={s:serviceName,f:from,c:callback?callId:0,a:Array.prototype.slice.call(arguments,3),t:authToken[targetId]};if(callSameDomain(targetId,rpc)){return }var rpcData=gadgets.json.stringify(rpc);var channelType=relayChannel;if(useLegacyProtocol[targetId]){channelType="ifpc"}switch(channelType){case"dpm":var targetDoc=targetId===".."?parent.document:frames[targetId].document;targetDoc.postMessage(rpcData);break;case"wpm":var targetWin=targetId===".."?parent:frames[targetId];targetWin.postMessage(rpcData,relayUrl[targetId]);break;case"fe":callFrameElement(targetId,serviceName,from,rpcData,rpc.a);break;default:callIfpc(targetId,serviceName,from,rpcData,rpc.a);break}},getRelayUrl:function(targetId){return relayUrl[targetId]},setRelayUrl:function(targetId,url,opt_useLegacy){relayUrl[targetId]=url;useLegacyProtocol[targetId]=!!opt_useLegacy},setAuthToken:function(targetId,token){authToken[targetId]=token;setupFrame(targetId)},getRelayChannel:function(){return relayChannel},receive:function(fragment){if(fragment.length>4){process(gadgets.json.parse(decodeURIComponent(fragment[fragment.length-1])))}},receiveSameDomain:function(rpc){rpc.a=Array.prototype.slice.call(rpc.a);window.setTimeout(function(){process(rpc)},0)}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/util.js' */
Function.prototype.inherits=function(parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;this.superClass_=parentCtor.prototype;this.prototype=new tempCtor();this.prototype.constructor=this};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/json.js' */
var gadgets=gadgets||{};gadgets.json=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("")};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i])||"null")}return"["+a.join(",")+"]"}for(k in value){if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}return false}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/gadgets-core.js' */
var gadgets=gadgets||{};gadgets.error={};gadgets.error.SUBCLASS_RESPONSIBILITY="subclass responsibility";gadgets.error.TO_BE_DONE="to be done";gadgets.log=function(message){if(window.console&&console.log){console.log(message)}else{var logEntry=document.createElement("div");logEntry.className="gadgets-log-entry";logEntry.innerHTML=message;document.body.appendChild(logEntry)}};gadgets.Extensible=function(){};gadgets.Extensible.prototype.setDependencies=function(dependencies){for(var p in dependencies){this[p]=dependencies[p]}};gadgets.Extensible.prototype.getDependencies=function(name){return this[name]};gadgets.UserPrefStore=function(){};gadgets.UserPrefStore.prototype.getPrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.UserPrefStore.prototype.savePrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.DefaultUserPrefStore=function(){gadgets.UserPrefStore.call(this)};gadgets.DefaultUserPrefStore.inherits(gadgets.UserPrefStore);gadgets.DefaultUserPrefStore.prototype.getPrefs=function(gadget){};gadgets.DefaultUserPrefStore.prototype.savePrefs=function(gadget){};gadgets.GadgetService=function(){};gadgets.GadgetService.prototype.setHeight=function(elementId,height){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setTitle=function(gadget,title){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setUserPref=function(id){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.IfrGadgetService=function(){gadgets.GadgetService.call(this);var service=this;gadgets.rpc.register("resize_iframe",function(){service.setHeight.apply(this,arguments)});gadgets.rpc.register("set_pref",function(){service.setUserPref.apply(this,arguments)});gadgets.rpc.register("set_title",function(){service.setTitle.apply(this,arguments)});gadgets.rpc.register("requestNavigateTo",function(){service.requestNavigateTo.apply(this,arguments)})};gadgets.IfrGadgetService.inherits(gadgets.GadgetService);gadgets.IfrGadgetService.prototype.setHeight=function(height){if(height>gadgets.container.maxheight_){height=gadgets.container.maxheight_}var element=document.getElementById(this.f);if(element){element.style.height=height+"px"}};gadgets.IfrGadgetService.prototype.requestNavigateTo=function(view,opt_params){var id=this.getGadgetIdFromModuleId(this.f);var url=this.getUrlForView(view);if(opt_params){var paramStr=JSON.stringify(opt_params);if(paramStr.length>0){url+="&appParams="+encodeURIComponent(paramStr)}}if(url&&document.location.href.indexOf(url)==-1){document.location.href=url}};gadgets.IfrGadgetService.prototype.getUrlForView=function(view){if(view==="canvas"){return"/canvas"}else{if(view==="profile"){return"/profile"}else{return null}}};gadgets.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(moduleId){return parseInt(moduleId.match(/_([0-9]+)$/)[1],10)};gadgets.LayoutManager=function(){};gadgets.LayoutManager.prototype.getGadgetChrome=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.StaticLayoutManager=function(){gadgets.LayoutManager.call(this)};gadgets.StaticLayoutManager.inherits(gadgets.LayoutManager);gadgets.StaticLayoutManager.prototype.setGadgetChromeIds=function(gadgetChromeIds){this.gadgetChromeIds_=gadgetChromeIds};gadgets.StaticLayoutManager.prototype.getGadgetChrome=function(gadget){var chromeId=this.gadgetChromeIds_[gadget.id];return chromeId?document.getElementById(chromeId):null};gadgets.FloatLeftLayoutManager=function(layoutRootId){gadgets.LayoutManager.call(this);this.layoutRootId_=layoutRootId};gadgets.FloatLeftLayoutManager.inherits(gadgets.LayoutManager);gadgets.FloatLeftLayoutManager.prototype.getGadgetChrome=function(gadget){var layoutRoot=document.getElementById(this.layoutRootId_);if(layoutRoot){var chrome=document.createElement("div");chrome.className="gadgets-gadget-chrome";chrome.style.cssFloat="left";layoutRoot.appendChild(chrome);return chrome}else{return null}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.gadgets:macro-browser-for-gadgetsplugin', location = 'script/gadget-macro-browser.js' */
AJS.toInit(function ($) {
    var overrides = {};

    overrides.postPreview = function (iframe, macro) {
        var hasAJS = iframe.contentWindow.AJS;
        var userPreferencesMap = {};
        var keyValuePairs = $("#macro-param-div-preferences input").val().split("&");
        for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
            var keyValue = keyValuePairs[i].split("=");
            try {
                userPreferencesMap[decodeURI(keyValue[0])] = decodeURI(keyValue[1]);
            } catch(e) {
                //Do nothing, just skip it. It's not essential that we capture all preferences, and not all are valid
                //to be decoded as a URI
            }
        }
        if (macro.needsConfig && hasAJS) {
            var bodyConfigured = !!userPreferencesMap["isConfigured"];

            if (!bodyConfigured) {
                var okButton = $("#macro-browser-dialog .dialog-button-panel .ok");
                $("#save-warning-span").addClass("gadget-not-configured-warning").text("Please complete the configuration in the preview area first").removeClass("hidden");
                okButton.prop("disabled", true);
            }
        }
    };

    overrides.beforeParamsSet = function(selectedParams, inserting) {
        var userPreferences = selectedParams["preferences"];
        if (!inserting && userPreferences) {
            var keyValuePairs = userPreferences.split("&");
            for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
                var keyValue = keyValuePairs[i].split("=");
                selectedParams[decodeURI(keyValue[0])] = decodeURI(keyValue[1]);
            }
        }

        return selectedParams;
    };

    overrides.updateMacroParametersForPreview = function(params) {
        params["forceWrite"] = true;
        return params;
    };

    overrides.manipulateMarkup = function (macro) {
        if(AJS.MacroBrowser.gadgetPrefsChanged){
            var container = top.document.getElementById("macro-insert-container");
            var preferencesInput = $("#macro-param-div-preferences input", container);
            var baseVal = "";
            for (var key in AJS.MacroBrowser.gadgetPrefs)
            {
                if (baseVal.length != 0)
                {
                    baseVal += "&";
                }
                baseVal = baseVal + encodeURI(key) + "=" + encodeURI(AJS.MacroBrowser.gadgetPrefs[key]);
            }
            preferencesInput.val(baseVal);
        }
    };

    //Adds special behaviour for "gadget" macros : only considered the same if they share the same url as the selected macro
    overrides.getMacroDetailsFromSelectedMacro = function(metadataList, selectedMacroToUse) {
        var selectedUrl = selectedMacroToUse.params["url"];
        for (var i = 0, lm = metadataList.length; i < lm; i++) {
            var tempMacro = metadataList[i];
            if (tempMacro.macroName == selectedMacroToUse.name) {
                for (var j = 0; j < tempMacro.formDetails.parameters.length; j++) {
                    if (tempMacro.formDetails.parameters[j].name == "url") {
                        if (tempMacro.formDetails.parameters[j].defaultValue == selectedUrl) {
                            return tempMacro;
                        }
                    }
                }
            }
        }
    };

    //Add special handling to intepret and merge existing body params for opensocial preference gadgets
    overrides.beforeParamsRetrieved = function(paramMap, macro, sharedParamMap) {
        var result="";

        if (macro.nonHiddenUserPrefs) {
            var first = true;
            //reparse the possible existing key value pairs
            var userPreferenceMap = {},
                previousPreferences = paramMap["preferences"];

            if (previousPreferences) {
                var keyValuePairs = previousPreferences.split("&");
                for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
                    var keyValue = keyValuePairs[i].split("=");
                    var userPrefKey = decodeURI(keyValue[0]);
                    var userPrefValue = decodeURI(keyValue[1]);
                    userPreferenceMap[userPrefKey] = userPrefValue;
                }
            }

            //New values take precedence over existing values
            for (var param1 in sharedParamMap) {
                userPreferenceMap[param1] = sharedParamMap[param1];
            }

            var isDefaultValue = function (macro, name, value)
            {
                var params = macro.formDetails.parameters;
                for (var i = 0; i < params.length; i++)
                {
                    if (params[i].name == name)
                    {
                        return value == params[i].defaultValue;
                    }
                }
                //Not necessarily bad ... could be a param we don't have metadata for
                AJS.log("Unable to find matching param for " + name);
                return false;
            };

            for (var param in userPreferenceMap) {
                if (!isDefaultValue(macro, param, userPreferenceMap[param]))
                {
                    if (!first)
                    {
                        result += "&";
                    }
                    first = false;
                    result = result + encodeURI(param) + "=" + encodeURI(userPreferenceMap[param]);
                }
            }

            paramMap["preferences"] = result;
        }

        return paramMap;
    };

    AJS.MacroBrowser.setMacroJsOverride("gadget", overrides);
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.officeconnector:macro-browser-smart-fields', location = 'javascript/office-connector-macro-fields.js' */
(function(B){var A=function(C){this.fileTypes=C
};
A.prototype.beforeParamsSet=function(E,C){if(!E.page&&!(E.date||E.space)){if(AJS.params.contentType=="page"||AJS.params.contentType=="blogpost"){E.page=B("#content-title").val()
}else{if(AJS.params.contentType=="comment"){E.page=AJS.params.pageTitle
}}}if(E.date){var D=E.date.split("/");
E.page=["",D[2],D[0],D[1],E.page].join("/")
}if(E.space){E.page=E.space+":"+E.page
}return E
};
A.prototype.beforeParamsRetrieved=function(E){if(E.page){var D=E.page.split(":");
if(D.length>1){E.space=D[0];
E.page=D[1]
}var C=E.page.split("/");
if(C.length>1){E.date=[C[2],C[3],C[1]].join("/");
E.page=C[4]
}if(((AJS.params.contentType=="page"||AJS.params.contentType=="blogpost")&&E.page==B("#content-title").val())||(AJS.params.contentType=="comment"&&E.page==AJS.params.pageTitle)){delete E.page
}}return E
};
A.prototype.fields={attachment:function(F){var C=function(G){var I={};
var H=G.split(":",2);
I.spaceKey=((H.length==2)&&H[0])||AJS.params.spaceKey;
I.title=H[H.length-1];
if(I.title.indexOf("/")==0){I.postingDay=I.title.substr(1,10);
I.title=I.title.substr(12)
}if(I.title==B("#content-title").val()){I.title=""
}if(!I.title){if(AJS.params.newPage){I.draftId=AJS.params.contentId
}else{I.pageId=AJS.params.pageId
}}return I
};
var D={fileTypes:this.fileTypes};
var E=AJS.MacroBrowser.ParameterFields.attachment(F,D);
E.dependencyUpdated=function(I,H){AJS.log("attachment:dependencyUpdated called: "+I+", "+H);
var G=C(H);
this.getData(G)
};
return E
},spacekey:function(C){return AJS.MacroBrowser.ParameterFields._hidden(C,{})
},date:function(C){return AJS.MacroBrowser.ParameterFields._hidden(C,{})
},"confluence-content":function(D){var C={dependencies:["name"]};
return AJS.MacroBrowser.ParameterFields["confluence-content"](D,C)
}};
AJS.MacroBrowser.Macros.viewdoc=new A(["doc","docx"]);
AJS.MacroBrowser.Macros.viewpdf=new A(["pdf"]);
AJS.MacroBrowser.Macros.viewxls=new A(["xls","xlsx"]);
AJS.MacroBrowser.Macros.viewppt=new A(["ppt","pptx"]);
AJS.MacroBrowser.Macros.viewfile={updateSelectedMacro:function(D){var F=D.params[""]||D.params.name;
if(F){var E=F.lastIndexOf(".");
if(E>0){var C=F.substring(E+1);
if(C){(C=="doc")&&(C=="docx")&&(D.name="viewdoc");
(C=="pdf")&&(D.name="viewpdf");
(C=="ppt")&&(C=="pptx")&&(D.name="viewppt");
(C=="xls")&&(C=="xlsx")&&(D.name="viewxls")
}}}}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:macro-browser-web-resources', location = 'com/atlassian/confluence/extra/calendar3/js/macro-browser.js' */
(function(e){var c=function(){a("space-calendar")();a("team-calendar")();a("calendar")()};function b(f){return function(g){if(g.params){AJS.MacroBrowser.setMacroJsOverride(f,{opener:null,fields:d(),postPreview:a(f)});tinymce.confluence.macrobrowser.editMacro(AJS.Editor.Adapter.getEditor().selection.getNode())}else{Confluence.TeamCalendars.Dialogs.getAddDialogForMacro(g)}}}function a(f){return function(){AJS.MacroBrowser.setMacroJsOverride(f,{opener:b(f),fields:d()})}}function d(){return{string:{id:function(j,g){var f;if(AJS.MacroBrowser.makeParameterDiv){f=AJS.MacroBrowser.makeParameterDiv({},{name:"id",type:"string"})}else{f=AJS.MacroBrowser.ParameterFields.string(j,g).paramDiv}var h=e("<input/>",{"class":"subcalendars-select",type:"hidden"});var k=e("input",f).addClass("hidden").after(h);var i=function(m){if(m){var l=e.isArray(m)?m.join(","):m;k.val(l);if(!k.data("renderedInitialSelection")){k.data("renderedInitialSelection",true);e.ajax({cache:false,data:{subCalendarIds:l},dataType:"json",success:function(n){if(n&&e.isArray(n)){h.select2("data",e.map(n,function(o){return{id:o.id,text:e("<span/>",{text:o.name}).html()}}))}},timeout:Confluence.TeamCalendars.ajaxTimeout,url:AJS.params.contextPath+"/rest/calendar-services/1.0/calendar/util/format/subcalendar/ids.json"})}}else{k.val("")}k.trigger("change")};h.change(function(){i(e.trim(h.select2("val")))}).select2({minimumInputLength:1,formatNoMatches:function(l){return e("<div/>").append(e("<span/>",{text:AJS.format("No calendars found with {0}.",l||"")})).html()},formatInputTooShort:function(){return e("<div/>").append(e("<span/>",{text:"Start typing for suggestions"})).html()},multiple:true,query:function(l){e.ajax({cache:false,data:{term:l.term,limit:5,showSubCalendarsInView:"true"},dataType:"json",success:function(m){l.callback({results:(function(){if(m.payload&&m.payload.length){return e.map(m.payload,function(n){return{id:n.subCalendar.id,text:e("<span/>",{text:n.subCalendar.name}).html()}})}return[]})(),more:false});e(".select2-drop-active").addClass("select2-drop")},timeout:Confluence.TeamCalendars.ajaxTimeout,url:AJS.params.contextPath+"/rest/calendar-services/1.0/calendar/search/subcalendars.json"})}});e(".select2-container",f).after(e("<div/>",{"class":"id-desc",html:"Start typing for calendar suggestions or \u003cspan class=\"add-subcalendar\">add a new calendar\u003c\/span>."}).click(function(){AJS.MacroBrowser.close();Confluence.TeamCalendars.Dialogs.getAddDialogForMacro({name:e("#macro-insert-container .macro-name").val(),params:(function(){var l={};e(".macro-param-input").each(function(){var m=e(this);l[m.attr("id").substring(12)]=m.attr("type")==="checkbox"?m.prop("checked"):m.val()});return l})(),defaultParameterValue:""})}));return AJS.MacroBrowser.Field(f,k,e.extend({setValue:function(l){i(l)}}),g)}}}}AJS.bind("init.rte",c)})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:macro-browser-web-resources', location = 'com/atlassian/confluence/extra/calendar3/eventmacro/js/macro-browser.js' */
AJS.MacroBrowser.setMacroJsOverride("event",{beforeParamsRetrieved:function(b,c,a){var d=AJS.$("#macro-param-id").val();if(!d){d=Math.random().toString(36).substring(2);AJS.$("#macro-param-id").val(d);b.id=d}return b}});AJS.MacroBrowser.getMacroJsOverride("event").fields={};AJS.MacroBrowser.getMacroJsOverride("event").fields.string={id:function(a){return AJS.MacroBrowser.ParameterFields._hidden(a,{})}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.macros.core:macro-browser-smart-fields', location = 'javascript/confluence-core-macro-fields.js' */
(function($) {
   AJS.MacroBrowser.activateSmartFieldsAttachmentsOnPage("multimedia", ["swf", "avi", "mov", "mp4", "mpeg", "mpg", "wmv", "wma", "mp3","ram","rm"]);
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'ch.bitvoodoo.confluence.plugins.panelbox:macro-browser-smart-fields', location = 'ch/bitvoodoo/confluence/plugins/panelbox/templates/javascript/panelbox-macro-fields.js' */
AJS.bind("init.rte",function(){var A=function(B,C){this.parameterName=B;
this.enumValues=C
};
A.prototype.fields={"enum":function(C){if(C.name==this.parameterName){C.enumValues=this.enumValues
}var B=AJS.MacroBrowser.ParameterFields["enum"](C,null);
return B
}};
AJS.MacroBrowser.overrideMacroBrowserEnumFields=function(D,B,C){AJS.MacroBrowser.setMacroJsOverride(D,new A(B,C))
};
AJS.$.getJSON(AJS.params.contextPath+"/rest/panelbox/1.0/",function(C){var B=[];
AJS.$.each(C,function(D,E){B.push(E.name)
});
AJS.MacroBrowser.overrideMacroBrowserEnumFields("panelbox","name",B)
})
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


